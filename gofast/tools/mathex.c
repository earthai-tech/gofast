/* Generated by Cython 3.0.9 */

/* BEGIN: Cython Metadata
{
    "distutils": {
        "include_dirs": [
            "/home/daniel/.local/lib/python3.10/site-packages/numpy/core/include"
        ],
        "name": "gofast.tools.mathex",
        "sources": [
            "gofast/tools/mathex.pyx"
        ]
    },
    "module_name": "gofast.tools.mathex"
}
END: Cython Metadata */

#ifndef PY_SSIZE_T_CLEAN
#define PY_SSIZE_T_CLEAN
#endif /* PY_SSIZE_T_CLEAN */
#if defined(CYTHON_LIMITED_API) && 0
  #ifndef Py_LIMITED_API
    #if CYTHON_LIMITED_API+0 > 0x03030000
      #define Py_LIMITED_API CYTHON_LIMITED_API
    #else
      #define Py_LIMITED_API 0x03030000
    #endif
  #endif
#endif

#include "Python.h"
#ifndef Py_PYTHON_H
    #error Python headers needed to compile C extensions, please install development version of Python.
#elif PY_VERSION_HEX < 0x02070000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
    #error Cython requires Python 2.7+ or Python 3.3+.
#else
#if defined(CYTHON_LIMITED_API) && CYTHON_LIMITED_API
#define __PYX_EXTRA_ABI_MODULE_NAME "limited"
#else
#define __PYX_EXTRA_ABI_MODULE_NAME ""
#endif
#define CYTHON_ABI "3_0_9" __PYX_EXTRA_ABI_MODULE_NAME
#define __PYX_ABI_MODULE_NAME "_cython_" CYTHON_ABI
#define __PYX_TYPE_MODULE_PREFIX __PYX_ABI_MODULE_NAME "."
#define CYTHON_HEX_VERSION 0x030009F0
#define CYTHON_FUTURE_DIVISION 1
#include <stddef.h>
#ifndef offsetof
  #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
#endif
#if !defined(_WIN32) && !defined(WIN32) && !defined(MS_WINDOWS)
  #ifndef __stdcall
    #define __stdcall
  #endif
  #ifndef __cdecl
    #define __cdecl
  #endif
  #ifndef __fastcall
    #define __fastcall
  #endif
#endif
#ifndef DL_IMPORT
  #define DL_IMPORT(t) t
#endif
#ifndef DL_EXPORT
  #define DL_EXPORT(t) t
#endif
#define __PYX_COMMA ,
#ifndef HAVE_LONG_LONG
  #define HAVE_LONG_LONG
#endif
#ifndef PY_LONG_LONG
  #define PY_LONG_LONG LONG_LONG
#endif
#ifndef Py_HUGE_VAL
  #define Py_HUGE_VAL HUGE_VAL
#endif
#define __PYX_LIMITED_VERSION_HEX PY_VERSION_HEX
#if defined(GRAALVM_PYTHON)
  /* For very preliminary testing purposes. Most variables are set the same as PyPy.
     The existence of this section does not imply that anything works or is even tested */
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #define CYTHON_COMPILING_IN_LIMITED_API 0
  #define CYTHON_COMPILING_IN_GRAAL 1
  #define CYTHON_COMPILING_IN_NOGIL 0
  #undef CYTHON_USE_TYPE_SLOTS
  #define CYTHON_USE_TYPE_SLOTS 0
  #undef CYTHON_USE_TYPE_SPECS
  #define CYTHON_USE_TYPE_SPECS 0
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #if PY_VERSION_HEX < 0x03050000
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #undef CYTHON_USE_UNICODE_INTERNALS
  #define CYTHON_USE_UNICODE_INTERNALS 0
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #undef CYTHON_AVOID_BORROWED_REFS
  #define CYTHON_AVOID_BORROWED_REFS 1
  #undef CYTHON_ASSUME_SAFE_MACROS
  #define CYTHON_ASSUME_SAFE_MACROS 0
  #undef CYTHON_UNPACK_METHODS
  #define CYTHON_UNPACK_METHODS 0
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_GIL
  #define CYTHON_FAST_GIL 0
  #undef CYTHON_METH_FASTCALL
  #define CYTHON_METH_FASTCALL 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #ifndef CYTHON_PEP487_INIT_SUBCLASS
    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
  #endif
  #undef CYTHON_PEP489_MULTI_PHASE_INIT
  #define CYTHON_PEP489_MULTI_PHASE_INIT 1
  #undef CYTHON_USE_MODULE_STATE
  #define CYTHON_USE_MODULE_STATE 0
  #undef CYTHON_USE_TP_FINALIZE
  #define CYTHON_USE_TP_FINALIZE 0
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
  #endif
#elif defined(PYPY_VERSION)
  #define CYTHON_COMPILING_IN_PYPY 1
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #define CYTHON_COMPILING_IN_LIMITED_API 0
  #define CYTHON_COMPILING_IN_GRAAL 0
  #define CYTHON_COMPILING_IN_NOGIL 0
  #undef CYTHON_USE_TYPE_SLOTS
  #define CYTHON_USE_TYPE_SLOTS 0
  #ifndef CYTHON_USE_TYPE_SPECS
    #define CYTHON_USE_TYPE_SPECS 0
  #endif
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #if PY_VERSION_HEX < 0x03050000
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #undef CYTHON_USE_UNICODE_INTERNALS
  #define CYTHON_USE_UNICODE_INTERNALS 0
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #undef CYTHON_AVOID_BORROWED_REFS
  #define CYTHON_AVOID_BORROWED_REFS 1
  #undef CYTHON_ASSUME_SAFE_MACROS
  #define CYTHON_ASSUME_SAFE_MACROS 0
  #undef CYTHON_UNPACK_METHODS
  #define CYTHON_UNPACK_METHODS 0
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_GIL
  #define CYTHON_FAST_GIL 0
  #undef CYTHON_METH_FASTCALL
  #define CYTHON_METH_FASTCALL 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #ifndef CYTHON_PEP487_INIT_SUBCLASS
    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
  #endif
  #if PY_VERSION_HEX < 0x03090000
    #undef CYTHON_PEP489_MULTI_PHASE_INIT
    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
  #endif
  #undef CYTHON_USE_MODULE_STATE
  #define CYTHON_USE_MODULE_STATE 0
  #undef CYTHON_USE_TP_FINALIZE
  #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1 && PYPY_VERSION_NUM >= 0x07030C00)
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
  #endif
#elif defined(CYTHON_LIMITED_API)
  #ifdef Py_LIMITED_API
    #undef __PYX_LIMITED_VERSION_HEX
    #define __PYX_LIMITED_VERSION_HEX Py_LIMITED_API
  #endif
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #define CYTHON_COMPILING_IN_LIMITED_API 1
  #define CYTHON_COMPILING_IN_GRAAL 0
  #define CYTHON_COMPILING_IN_NOGIL 0
  #undef CYTHON_CLINE_IN_TRACEBACK
  #define CYTHON_CLINE_IN_TRACEBACK 0
  #undef CYTHON_USE_TYPE_SLOTS
  #define CYTHON_USE_TYPE_SLOTS 0
  #undef CYTHON_USE_TYPE_SPECS
  #define CYTHON_USE_TYPE_SPECS 1
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #undef CYTHON_USE_ASYNC_SLOTS
  #define CYTHON_USE_ASYNC_SLOTS 0
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #undef CYTHON_USE_UNICODE_INTERNALS
  #define CYTHON_USE_UNICODE_INTERNALS 0
  #ifndef CYTHON_USE_UNICODE_WRITER
    #define CYTHON_USE_UNICODE_WRITER 0
  #endif
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #undef CYTHON_ASSUME_SAFE_MACROS
  #define CYTHON_ASSUME_SAFE_MACROS 0
  #undef CYTHON_UNPACK_METHODS
  #define CYTHON_UNPACK_METHODS 0
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_GIL
  #define CYTHON_FAST_GIL 0
  #undef CYTHON_METH_FASTCALL
  #define CYTHON_METH_FASTCALL 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #ifndef CYTHON_PEP487_INIT_SUBCLASS
    #define CYTHON_PEP487_INIT_SUBCLASS 1
  #endif
  #undef CYTHON_PEP489_MULTI_PHASE_INIT
  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #undef CYTHON_USE_MODULE_STATE
  #define CYTHON_USE_MODULE_STATE 1
  #ifndef CYTHON_USE_TP_FINALIZE
    #define CYTHON_USE_TP_FINALIZE 0
  #endif
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
  #endif
#elif defined(Py_GIL_DISABLED) || defined(Py_NOGIL)
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_CPYTHON 0
  #define CYTHON_COMPILING_IN_LIMITED_API 0
  #define CYTHON_COMPILING_IN_GRAAL 0
  #define CYTHON_COMPILING_IN_NOGIL 1
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #undef CYTHON_USE_PYTYPE_LOOKUP
  #define CYTHON_USE_PYTYPE_LOOKUP 0
  #ifndef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #undef CYTHON_USE_PYLIST_INTERNALS
  #define CYTHON_USE_PYLIST_INTERNALS 0
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #undef CYTHON_USE_UNICODE_WRITER
  #define CYTHON_USE_UNICODE_WRITER 0
  #undef CYTHON_USE_PYLONG_INTERNALS
  #define CYTHON_USE_PYLONG_INTERNALS 0
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #undef CYTHON_FAST_THREAD_STATE
  #define CYTHON_FAST_THREAD_STATE 0
  #undef CYTHON_FAST_PYCALL
  #define CYTHON_FAST_PYCALL 0
  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
  #endif
  #ifndef CYTHON_USE_TP_FINALIZE
    #define CYTHON_USE_TP_FINALIZE 1
  #endif
  #undef CYTHON_USE_DICT_VERSIONS
  #define CYTHON_USE_DICT_VERSIONS 0
  #undef CYTHON_USE_EXC_INFO_STACK
  #define CYTHON_USE_EXC_INFO_STACK 0
#else
  #define CYTHON_COMPILING_IN_PYPY 0
  #define CYTHON_COMPILING_IN_CPYTHON 1
  #define CYTHON_COMPILING_IN_LIMITED_API 0
  #define CYTHON_COMPILING_IN_GRAAL 0
  #define CYTHON_COMPILING_IN_NOGIL 0
  #ifndef CYTHON_USE_TYPE_SLOTS
    #define CYTHON_USE_TYPE_SLOTS 1
  #endif
  #ifndef CYTHON_USE_TYPE_SPECS
    #define CYTHON_USE_TYPE_SPECS 0
  #endif
  #ifndef CYTHON_USE_PYTYPE_LOOKUP
    #define CYTHON_USE_PYTYPE_LOOKUP 1
  #endif
  #if PY_MAJOR_VERSION < 3
    #undef CYTHON_USE_ASYNC_SLOTS
    #define CYTHON_USE_ASYNC_SLOTS 0
  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
    #define CYTHON_USE_ASYNC_SLOTS 1
  #endif
  #ifndef CYTHON_USE_PYLONG_INTERNALS
    #define CYTHON_USE_PYLONG_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_PYLIST_INTERNALS
    #define CYTHON_USE_PYLIST_INTERNALS 1
  #endif
  #ifndef CYTHON_USE_UNICODE_INTERNALS
    #define CYTHON_USE_UNICODE_INTERNALS 1
  #endif
  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
    #undef CYTHON_USE_UNICODE_WRITER
    #define CYTHON_USE_UNICODE_WRITER 0
  #elif !defined(CYTHON_USE_UNICODE_WRITER)
    #define CYTHON_USE_UNICODE_WRITER 1
  #endif
  #ifndef CYTHON_AVOID_BORROWED_REFS
    #define CYTHON_AVOID_BORROWED_REFS 0
  #endif
  #ifndef CYTHON_ASSUME_SAFE_MACROS
    #define CYTHON_ASSUME_SAFE_MACROS 1
  #endif
  #ifndef CYTHON_UNPACK_METHODS
    #define CYTHON_UNPACK_METHODS 1
  #endif
  #ifndef CYTHON_FAST_THREAD_STATE
    #define CYTHON_FAST_THREAD_STATE 1
  #endif
  #ifndef CYTHON_FAST_GIL
    #define CYTHON_FAST_GIL (PY_MAJOR_VERSION < 3 || PY_VERSION_HEX >= 0x03060000 && PY_VERSION_HEX < 0x030C00A6)
  #endif
  #ifndef CYTHON_METH_FASTCALL
    #define CYTHON_METH_FASTCALL (PY_VERSION_HEX >= 0x030700A1)
  #endif
  #ifndef CYTHON_FAST_PYCALL
    #define CYTHON_FAST_PYCALL 1
  #endif
  #ifndef CYTHON_PEP487_INIT_SUBCLASS
    #define CYTHON_PEP487_INIT_SUBCLASS 1
  #endif
  #if PY_VERSION_HEX < 0x03050000
    #undef CYTHON_PEP489_MULTI_PHASE_INIT
    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
  #endif
  #ifndef CYTHON_USE_MODULE_STATE
    #define CYTHON_USE_MODULE_STATE 0
  #endif
  #if PY_VERSION_HEX < 0x030400a1
    #undef CYTHON_USE_TP_FINALIZE
    #define CYTHON_USE_TP_FINALIZE 0
  #elif !defined(CYTHON_USE_TP_FINALIZE)
    #define CYTHON_USE_TP_FINALIZE 1
  #endif
  #if PY_VERSION_HEX < 0x030600B1
    #undef CYTHON_USE_DICT_VERSIONS
    #define CYTHON_USE_DICT_VERSIONS 0
  #elif !defined(CYTHON_USE_DICT_VERSIONS)
    #define CYTHON_USE_DICT_VERSIONS  (PY_VERSION_HEX < 0x030C00A5)
  #endif
  #if PY_VERSION_HEX < 0x030700A3
    #undef CYTHON_USE_EXC_INFO_STACK
    #define CYTHON_USE_EXC_INFO_STACK 0
  #elif !defined(CYTHON_USE_EXC_INFO_STACK)
    #define CYTHON_USE_EXC_INFO_STACK 1
  #endif
  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
    #define CYTHON_UPDATE_DESCRIPTOR_DOC 1
  #endif
#endif
#if !defined(CYTHON_FAST_PYCCALL)
#define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
#endif
#if !defined(CYTHON_VECTORCALL)
#define CYTHON_VECTORCALL  (CYTHON_FAST_PYCCALL && PY_VERSION_HEX >= 0x030800B1)
#endif
#define CYTHON_BACKPORT_VECTORCALL (CYTHON_METH_FASTCALL && PY_VERSION_HEX < 0x030800B1)
#if CYTHON_USE_PYLONG_INTERNALS
  #if PY_MAJOR_VERSION < 3
    #include "longintrepr.h"
  #endif
  #undef SHIFT
  #undef BASE
  #undef MASK
  #ifdef SIZEOF_VOID_P
    enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
  #endif
#endif
#ifndef __has_attribute
  #define __has_attribute(x) 0
#endif
#ifndef __has_cpp_attribute
  #define __has_cpp_attribute(x) 0
#endif
#ifndef CYTHON_RESTRICT
  #if defined(__GNUC__)
    #define CYTHON_RESTRICT __restrict__
  #elif defined(_MSC_VER) && _MSC_VER >= 1400
    #define CYTHON_RESTRICT __restrict
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_RESTRICT restrict
  #else
    #define CYTHON_RESTRICT
  #endif
#endif
#ifndef CYTHON_UNUSED
  #if defined(__cplusplus)
    /* for clang __has_cpp_attribute(maybe_unused) is true even before C++17
     * but leads to warnings with -pedantic, since it is a C++17 feature */
    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
      #if __has_cpp_attribute(maybe_unused)
        #define CYTHON_UNUSED [[maybe_unused]]
      #endif
    #endif
  #endif
#endif
#ifndef CYTHON_UNUSED
# if defined(__GNUC__)
#   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
#     define CYTHON_UNUSED __attribute__ ((__unused__))
#   else
#     define CYTHON_UNUSED
#   endif
# elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
#   define CYTHON_UNUSED __attribute__ ((__unused__))
# else
#   define CYTHON_UNUSED
# endif
#endif
#ifndef CYTHON_UNUSED_VAR
#  if defined(__cplusplus)
     template<class T> void CYTHON_UNUSED_VAR( const T& ) { }
#  else
#    define CYTHON_UNUSED_VAR(x) (void)(x)
#  endif
#endif
#ifndef CYTHON_MAYBE_UNUSED_VAR
  #define CYTHON_MAYBE_UNUSED_VAR(x) CYTHON_UNUSED_VAR(x)
#endif
#ifndef CYTHON_NCP_UNUSED
# if CYTHON_COMPILING_IN_CPYTHON
#  define CYTHON_NCP_UNUSED
# else
#  define CYTHON_NCP_UNUSED CYTHON_UNUSED
# endif
#endif
#ifndef CYTHON_USE_CPP_STD_MOVE
  #if defined(__cplusplus) && (\
    __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600))
    #define CYTHON_USE_CPP_STD_MOVE 1
  #else
    #define CYTHON_USE_CPP_STD_MOVE 0
  #endif
#endif
#define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)
#ifdef _MSC_VER
    #ifndef _MSC_STDINT_H_
        #if _MSC_VER < 1300
            typedef unsigned char     uint8_t;
            typedef unsigned short    uint16_t;
            typedef unsigned int      uint32_t;
        #else
            typedef unsigned __int8   uint8_t;
            typedef unsigned __int16  uint16_t;
            typedef unsigned __int32  uint32_t;
        #endif
    #endif
    #if _MSC_VER < 1300
        #ifdef _WIN64
            typedef unsigned long long  __pyx_uintptr_t;
        #else
            typedef unsigned int        __pyx_uintptr_t;
        #endif
    #else
        #ifdef _WIN64
            typedef unsigned __int64    __pyx_uintptr_t;
        #else
            typedef unsigned __int32    __pyx_uintptr_t;
        #endif
    #endif
#else
    #include <stdint.h>
    typedef uintptr_t  __pyx_uintptr_t;
#endif
#ifndef CYTHON_FALLTHROUGH
  #if defined(__cplusplus)
    /* for clang __has_cpp_attribute(fallthrough) is true even before C++17
     * but leads to warnings with -pedantic, since it is a C++17 feature */
    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
      #if __has_cpp_attribute(fallthrough)
        #define CYTHON_FALLTHROUGH [[fallthrough]]
      #endif
    #endif
    #ifndef CYTHON_FALLTHROUGH
      #if __has_cpp_attribute(clang::fallthrough)
        #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
      #elif __has_cpp_attribute(gnu::fallthrough)
        #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
      #endif
    #endif
  #endif
  #ifndef CYTHON_FALLTHROUGH
    #if __has_attribute(fallthrough)
      #define CYTHON_FALLTHROUGH __attribute__((fallthrough))
    #else
      #define CYTHON_FALLTHROUGH
    #endif
  #endif
  #if defined(__clang__) && defined(__apple_build_version__)
    #if __apple_build_version__ < 7000000
      #undef  CYTHON_FALLTHROUGH
      #define CYTHON_FALLTHROUGH
    #endif
  #endif
#endif
#ifdef __cplusplus
  template <typename T>
  struct __PYX_IS_UNSIGNED_IMPL {static const bool value = T(0) < T(-1);};
  #define __PYX_IS_UNSIGNED(type) (__PYX_IS_UNSIGNED_IMPL<type>::value)
#else
  #define __PYX_IS_UNSIGNED(type) (((type)-1) > 0)
#endif
#if CYTHON_COMPILING_IN_PYPY == 1
  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x030A0000)
#else
  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000)
#endif
#define __PYX_REINTERPRET_FUNCION(func_pointer, other_pointer) ((func_pointer)(void(*)(void))(other_pointer))

#ifndef CYTHON_INLINE
  #if defined(__clang__)
    #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
  #elif defined(__GNUC__)
    #define CYTHON_INLINE __inline__
  #elif defined(_MSC_VER)
    #define CYTHON_INLINE __inline
  #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define CYTHON_INLINE inline
  #else
    #define CYTHON_INLINE
  #endif
#endif

#define __PYX_BUILD_PY_SSIZE_T "n"
#define CYTHON_FORMAT_SSIZE_T "z"
#if PY_MAJOR_VERSION < 3
  #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
  #define __Pyx_DefaultClassType PyClass_Type
  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#else
  #define __Pyx_BUILTIN_MODULE_NAME "builtins"
  #define __Pyx_DefaultClassType PyType_Type
#if CYTHON_COMPILING_IN_LIMITED_API
    static CYTHON_INLINE PyObject* __Pyx_PyCode_New(int a, int p, int k, int l, int s, int f,
                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
                                                    PyObject *fv, PyObject *cell, PyObject* fn,
                                                    PyObject *name, int fline, PyObject *lnos) {
        PyObject *exception_table = NULL;
        PyObject *types_module=NULL, *code_type=NULL, *result=NULL;
        #if __PYX_LIMITED_VERSION_HEX < 0x030B0000
        PyObject *version_info;
        PyObject *py_minor_version = NULL;
        #endif
        long minor_version = 0;
        PyObject *type, *value, *traceback;
        PyErr_Fetch(&type, &value, &traceback);
        #if __PYX_LIMITED_VERSION_HEX >= 0x030B0000
        minor_version = 11;
        #else
        if (!(version_info = PySys_GetObject("version_info"))) goto end;
        if (!(py_minor_version = PySequence_GetItem(version_info, 1))) goto end;
        minor_version = PyLong_AsLong(py_minor_version);
        Py_DECREF(py_minor_version);
        if (minor_version == -1 && PyErr_Occurred()) goto end;
        #endif
        if (!(types_module = PyImport_ImportModule("types"))) goto end;
        if (!(code_type = PyObject_GetAttrString(types_module, "CodeType"))) goto end;
        if (minor_version <= 7) {
            (void)p;
            result = PyObject_CallFunction(code_type, "iiiiiOOOOOOiOO", a, k, l, s, f, code,
                          c, n, v, fn, name, fline, lnos, fv, cell);
        } else if (minor_version <= 10) {
            result = PyObject_CallFunction(code_type, "iiiiiiOOOOOOiOO", a,p, k, l, s, f, code,
                          c, n, v, fn, name, fline, lnos, fv, cell);
        } else {
            if (!(exception_table = PyBytes_FromStringAndSize(NULL, 0))) goto end;
            result = PyObject_CallFunction(code_type, "iiiiiiOOOOOOOiOO", a,p, k, l, s, f, code,
                          c, n, v, fn, name, name, fline, lnos, exception_table, fv, cell);
        }
    end:
        Py_XDECREF(code_type);
        Py_XDECREF(exception_table);
        Py_XDECREF(types_module);
        if (type) {
            PyErr_Restore(type, value, traceback);
        }
        return result;
    }
    #ifndef CO_OPTIMIZED
    #define CO_OPTIMIZED 0x0001
    #endif
    #ifndef CO_NEWLOCALS
    #define CO_NEWLOCALS 0x0002
    #endif
    #ifndef CO_VARARGS
    #define CO_VARARGS 0x0004
    #endif
    #ifndef CO_VARKEYWORDS
    #define CO_VARKEYWORDS 0x0008
    #endif
    #ifndef CO_ASYNC_GENERATOR
    #define CO_ASYNC_GENERATOR 0x0200
    #endif
    #ifndef CO_GENERATOR
    #define CO_GENERATOR 0x0020
    #endif
    #ifndef CO_COROUTINE
    #define CO_COROUTINE 0x0080
    #endif
#elif PY_VERSION_HEX >= 0x030B0000
  static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int p, int k, int l, int s, int f,
                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
                                                    PyObject *fv, PyObject *cell, PyObject* fn,
                                                    PyObject *name, int fline, PyObject *lnos) {
    PyCodeObject *result;
    PyObject *empty_bytes = PyBytes_FromStringAndSize("", 0);
    if (!empty_bytes) return NULL;
    result =
      #if PY_VERSION_HEX >= 0x030C0000
        PyUnstable_Code_NewWithPosOnlyArgs
      #else
        PyCode_NewWithPosOnlyArgs
      #endif
        (a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, name, fline, lnos, empty_bytes);
    Py_DECREF(empty_bytes);
    return result;
  }
#elif PY_VERSION_HEX >= 0x030800B2 && !CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_NewWithPosOnlyArgs(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#else
  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
          PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
#endif
#endif
#if PY_VERSION_HEX >= 0x030900A4 || defined(Py_IS_TYPE)
  #define __Pyx_IS_TYPE(ob, type) Py_IS_TYPE(ob, type)
#else
  #define __Pyx_IS_TYPE(ob, type) (((const PyObject*)ob)->ob_type == (type))
#endif
#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_Is)
  #define __Pyx_Py_Is(x, y)  Py_Is(x, y)
#else
  #define __Pyx_Py_Is(x, y) ((x) == (y))
#endif
#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsNone)
  #define __Pyx_Py_IsNone(ob) Py_IsNone(ob)
#else
  #define __Pyx_Py_IsNone(ob) __Pyx_Py_Is((ob), Py_None)
#endif
#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsTrue)
  #define __Pyx_Py_IsTrue(ob) Py_IsTrue(ob)
#else
  #define __Pyx_Py_IsTrue(ob) __Pyx_Py_Is((ob), Py_True)
#endif
#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsFalse)
  #define __Pyx_Py_IsFalse(ob) Py_IsFalse(ob)
#else
  #define __Pyx_Py_IsFalse(ob) __Pyx_Py_Is((ob), Py_False)
#endif
#define __Pyx_NoneAsNull(obj)  (__Pyx_Py_IsNone(obj) ? NULL : (obj))
#if PY_VERSION_HEX >= 0x030900F0 && !CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyObject_GC_IsFinalized(o) PyObject_GC_IsFinalized(o)
#else
  #define __Pyx_PyObject_GC_IsFinalized(o) _PyGC_FINALIZED(o)
#endif
#ifndef CO_COROUTINE
  #define CO_COROUTINE 0x80
#endif
#ifndef CO_ASYNC_GENERATOR
  #define CO_ASYNC_GENERATOR 0x200
#endif
#ifndef Py_TPFLAGS_CHECKTYPES
  #define Py_TPFLAGS_CHECKTYPES 0
#endif
#ifndef Py_TPFLAGS_HAVE_INDEX
  #define Py_TPFLAGS_HAVE_INDEX 0
#endif
#ifndef Py_TPFLAGS_HAVE_NEWBUFFER
  #define Py_TPFLAGS_HAVE_NEWBUFFER 0
#endif
#ifndef Py_TPFLAGS_HAVE_FINALIZE
  #define Py_TPFLAGS_HAVE_FINALIZE 0
#endif
#ifndef Py_TPFLAGS_SEQUENCE
  #define Py_TPFLAGS_SEQUENCE 0
#endif
#ifndef Py_TPFLAGS_MAPPING
  #define Py_TPFLAGS_MAPPING 0
#endif
#ifndef METH_STACKLESS
  #define METH_STACKLESS 0
#endif
#if PY_VERSION_HEX <= 0x030700A3 || !defined(METH_FASTCALL)
  #ifndef METH_FASTCALL
     #define METH_FASTCALL 0x80
  #endif
  typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
  typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                          Py_ssize_t nargs, PyObject *kwnames);
#else
  #if PY_VERSION_HEX >= 0x030d00A4
  #  define __Pyx_PyCFunctionFast PyCFunctionFast
  #  define __Pyx_PyCFunctionFastWithKeywords PyCFunctionFastWithKeywords
  #else
  #  define __Pyx_PyCFunctionFast _PyCFunctionFast
  #  define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
  #endif
#endif
#if CYTHON_METH_FASTCALL
  #define __Pyx_METH_FASTCALL METH_FASTCALL
  #define __Pyx_PyCFunction_FastCall __Pyx_PyCFunctionFast
  #define __Pyx_PyCFunction_FastCallWithKeywords __Pyx_PyCFunctionFastWithKeywords
#else
  #define __Pyx_METH_FASTCALL METH_VARARGS
  #define __Pyx_PyCFunction_FastCall PyCFunction
  #define __Pyx_PyCFunction_FastCallWithKeywords PyCFunctionWithKeywords
#endif
#if CYTHON_VECTORCALL
  #define __pyx_vectorcallfunc vectorcallfunc
  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  PY_VECTORCALL_ARGUMENTS_OFFSET
  #define __Pyx_PyVectorcall_NARGS(n)  PyVectorcall_NARGS((size_t)(n))
#elif CYTHON_BACKPORT_VECTORCALL
  typedef PyObject *(*__pyx_vectorcallfunc)(PyObject *callable, PyObject *const *args,
                                            size_t nargsf, PyObject *kwnames);
  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  ((size_t)1 << (8 * sizeof(size_t) - 1))
  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(((size_t)(n)) & ~__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET))
#else
  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  0
  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(n))
#endif
#if PY_MAJOR_VERSION >= 0x030900B1
#define __Pyx_PyCFunction_CheckExact(func)  PyCFunction_CheckExact(func)
#else
#define __Pyx_PyCFunction_CheckExact(func)  PyCFunction_Check(func)
#endif
#define __Pyx_CyOrPyCFunction_Check(func)  PyCFunction_Check(func)
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_CyOrPyCFunction_GET_FUNCTION(func)  (((PyCFunctionObject*)(func))->m_ml->ml_meth)
#elif !CYTHON_COMPILING_IN_LIMITED_API
#define __Pyx_CyOrPyCFunction_GET_FUNCTION(func)  PyCFunction_GET_FUNCTION(func)
#endif
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_CyOrPyCFunction_GET_FLAGS(func)  (((PyCFunctionObject*)(func))->m_ml->ml_flags)
static CYTHON_INLINE PyObject* __Pyx_CyOrPyCFunction_GET_SELF(PyObject *func) {
    return (__Pyx_CyOrPyCFunction_GET_FLAGS(func) & METH_STATIC) ? NULL : ((PyCFunctionObject*)func)->m_self;
}
#endif
static CYTHON_INLINE int __Pyx__IsSameCFunction(PyObject *func, void *cfunc) {
#if CYTHON_COMPILING_IN_LIMITED_API
    return PyCFunction_Check(func) && PyCFunction_GetFunction(func) == (PyCFunction) cfunc;
#else
    return PyCFunction_Check(func) && PyCFunction_GET_FUNCTION(func) == (PyCFunction) cfunc;
#endif
}
#define __Pyx_IsSameCFunction(func, cfunc)   __Pyx__IsSameCFunction(func, cfunc)
#if __PYX_LIMITED_VERSION_HEX < 0x030900B1
  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  ((void)m, PyType_FromSpecWithBases(s, b))
  typedef PyObject *(*__Pyx_PyCMethod)(PyObject *, PyTypeObject *, PyObject *const *, size_t, PyObject *);
#else
  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  PyType_FromModuleAndSpec(m, s, b)
  #define __Pyx_PyCMethod  PyCMethod
#endif
#ifndef METH_METHOD
  #define METH_METHOD 0x200
#endif
#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
  #define PyObject_Malloc(s)   PyMem_Malloc(s)
  #define PyObject_Free(p)     PyMem_Free(p)
  #define PyObject_Realloc(p)  PyMem_Realloc(p)
#endif
#if CYTHON_COMPILING_IN_LIMITED_API
  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)
#else
  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
#endif
#if CYTHON_COMPILING_IN_LIMITED_API
  #define __Pyx_PyThreadState_Current PyThreadState_Get()
#elif !CYTHON_FAST_THREAD_STATE
  #define __Pyx_PyThreadState_Current PyThreadState_GET()
#elif PY_VERSION_HEX >= 0x030d00A1
  #define __Pyx_PyThreadState_Current PyThreadState_GetUnchecked()
#elif PY_VERSION_HEX >= 0x03060000
  #define __Pyx_PyThreadState_Current _PyThreadState_UncheckedGet()
#elif PY_VERSION_HEX >= 0x03000000
  #define __Pyx_PyThreadState_Current PyThreadState_GET()
#else
  #define __Pyx_PyThreadState_Current _PyThreadState_Current
#endif
#if CYTHON_COMPILING_IN_LIMITED_API
static CYTHON_INLINE void *__Pyx_PyModule_GetState(PyObject *op)
{
    void *result;
    result = PyModule_GetState(op);
    if (!result)
        Py_FatalError("Couldn't find the module state");
    return result;
}
#endif
#define __Pyx_PyObject_GetSlot(obj, name, func_ctype)  __Pyx_PyType_GetSlot(Py_TYPE(obj), name, func_ctype)
#if CYTHON_COMPILING_IN_LIMITED_API
  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((func_ctype) PyType_GetSlot((type), Py_##name))
#else
  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((type)->name)
#endif
#if PY_VERSION_HEX < 0x030700A2 && !defined(PyThread_tss_create) && !defined(Py_tss_NEEDS_INIT)
#include "pythread.h"
#define Py_tss_NEEDS_INIT 0
typedef int Py_tss_t;
static CYTHON_INLINE int PyThread_tss_create(Py_tss_t *key) {
  *key = PyThread_create_key();
  return 0;
}
static CYTHON_INLINE Py_tss_t * PyThread_tss_alloc(void) {
  Py_tss_t *key = (Py_tss_t *)PyObject_Malloc(sizeof(Py_tss_t));
  *key = Py_tss_NEEDS_INIT;
  return key;
}
static CYTHON_INLINE void PyThread_tss_free(Py_tss_t *key) {
  PyObject_Free(key);
}
static CYTHON_INLINE int PyThread_tss_is_created(Py_tss_t *key) {
  return *key != Py_tss_NEEDS_INIT;
}
static CYTHON_INLINE void PyThread_tss_delete(Py_tss_t *key) {
  PyThread_delete_key(*key);
  *key = Py_tss_NEEDS_INIT;
}
static CYTHON_INLINE int PyThread_tss_set(Py_tss_t *key, void *value) {
  return PyThread_set_key_value(*key, value);
}
static CYTHON_INLINE void * PyThread_tss_get(Py_tss_t *key) {
  return PyThread_get_key_value(*key);
}
#endif
#if PY_MAJOR_VERSION < 3
    #if CYTHON_COMPILING_IN_PYPY
        #if PYPY_VERSION_NUM < 0x07030600
            #if defined(__cplusplus) && __cplusplus >= 201402L
                [[deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")]]
            #elif defined(__GNUC__) || defined(__clang__)
                __attribute__ ((__deprecated__("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")))
            #elif defined(_MSC_VER)
                __declspec(deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6"))
            #endif
            static CYTHON_INLINE int PyGILState_Check(void) {
                return 0;
            }
        #else  // PYPY_VERSION_NUM < 0x07030600
        #endif  // PYPY_VERSION_NUM < 0x07030600
    #else
        static CYTHON_INLINE int PyGILState_Check(void) {
            PyThreadState * tstate = _PyThreadState_Current;
            return tstate && (tstate == PyGILState_GetThisThreadState());
        }
    #endif
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030d0000 || defined(_PyDict_NewPresized)
#define __Pyx_PyDict_NewPresized(n)  ((n <= 8) ? PyDict_New() : _PyDict_NewPresized(n))
#else
#define __Pyx_PyDict_NewPresized(n)  PyDict_New()
#endif
#if PY_MAJOR_VERSION >= 3 || CYTHON_FUTURE_DIVISION
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
#else
  #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
  #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX > 0x030600B4 && PY_VERSION_HEX < 0x030d0000 && CYTHON_USE_UNICODE_INTERNALS
#define __Pyx_PyDict_GetItemStrWithError(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStr(PyObject *dict, PyObject *name) {
    PyObject *res = __Pyx_PyDict_GetItemStrWithError(dict, name);
    if (res == NULL) PyErr_Clear();
    return res;
}
#elif PY_MAJOR_VERSION >= 3 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07020000)
#define __Pyx_PyDict_GetItemStrWithError  PyDict_GetItemWithError
#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
#else
static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStrWithError(PyObject *dict, PyObject *name) {
#if CYTHON_COMPILING_IN_PYPY
    return PyDict_GetItem(dict, name);
#else
    PyDictEntry *ep;
    PyDictObject *mp = (PyDictObject*) dict;
    long hash = ((PyStringObject *) name)->ob_shash;
    assert(hash != -1);
    ep = (mp->ma_lookup)(mp, name, hash);
    if (ep == NULL) {
        return NULL;
    }
    return ep->me_value;
#endif
}
#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
#endif
#if CYTHON_USE_TYPE_SLOTS
  #define __Pyx_PyType_GetFlags(tp)   (((PyTypeObject *)tp)->tp_flags)
  #define __Pyx_PyType_HasFeature(type, feature)  ((__Pyx_PyType_GetFlags(type) & (feature)) != 0)
  #define __Pyx_PyObject_GetIterNextFunc(obj)  (Py_TYPE(obj)->tp_iternext)
#else
  #define __Pyx_PyType_GetFlags(tp)   (PyType_GetFlags((PyTypeObject *)tp))
  #define __Pyx_PyType_HasFeature(type, feature)  PyType_HasFeature(type, feature)
  #define __Pyx_PyObject_GetIterNextFunc(obj)  PyIter_Next
#endif
#if CYTHON_COMPILING_IN_LIMITED_API
  #define __Pyx_SetItemOnTypeDict(tp, k, v) PyObject_GenericSetAttr((PyObject*)tp, k, v)
#else
  #define __Pyx_SetItemOnTypeDict(tp, k, v) PyDict_SetItem(tp->tp_dict, k, v)
#endif
#if CYTHON_USE_TYPE_SPECS && PY_VERSION_HEX >= 0x03080000
#define __Pyx_PyHeapTypeObject_GC_Del(obj)  {\
    PyTypeObject *type = Py_TYPE((PyObject*)obj);\
    assert(__Pyx_PyType_HasFeature(type, Py_TPFLAGS_HEAPTYPE));\
    PyObject_GC_Del(obj);\
    Py_DECREF(type);\
}
#else
#define __Pyx_PyHeapTypeObject_GC_Del(obj)  PyObject_GC_Del(obj)
#endif
#if CYTHON_COMPILING_IN_LIMITED_API
  #define CYTHON_PEP393_ENABLED 1
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GetLength(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_ReadChar(u, i)
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((void)u, 1114111U)
  #define __Pyx_PyUnicode_KIND(u)         ((void)u, (0))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)u)
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)k, PyUnicode_ReadChar((PyObject*)(d), i))
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GetLength(u))
#elif PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
  #define CYTHON_PEP393_ENABLED 1
  #if PY_VERSION_HEX >= 0x030C0000
    #define __Pyx_PyUnicode_READY(op)       (0)
  #else
    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
                                                0 : _PyUnicode_Ready((PyObject *)(op)))
  #endif
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
  #define __Pyx_PyUnicode_KIND(u)         ((int)PyUnicode_KIND(u))
  #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
  #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, (Py_UCS4) ch)
  #if PY_VERSION_HEX >= 0x030C0000
    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
  #else
    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
    #else
    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
    #endif
  #endif
#else
  #define CYTHON_PEP393_ENABLED 0
  #define PyUnicode_1BYTE_KIND  1
  #define PyUnicode_2BYTE_KIND  2
  #define PyUnicode_4BYTE_KIND  4
  #define __Pyx_PyUnicode_READY(op)       (0)
  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
  #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535U : 1114111U)
  #define __Pyx_PyUnicode_KIND(u)         ((int)sizeof(Py_UNICODE))
  #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = (Py_UNICODE) ch)
  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
#endif
#if CYTHON_COMPILING_IN_PYPY
  #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
#else
  #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
  #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
      PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
#endif
#if CYTHON_COMPILING_IN_PYPY
  #if !defined(PyUnicode_DecodeUnicodeEscape)
    #define PyUnicode_DecodeUnicodeEscape(s, size, errors)  PyUnicode_Decode(s, size, "unicode_escape", errors)
  #endif
  #if !defined(PyUnicode_Contains) || (PY_MAJOR_VERSION == 2 && PYPY_VERSION_NUM < 0x07030500)
    #undef PyUnicode_Contains
    #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
  #endif
  #if !defined(PyByteArray_Check)
    #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
  #endif
  #if !defined(PyObject_Format)
    #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
  #endif
#endif
#define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None || (PyString_Check(b) && !PyString_CheckExact(b)))) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
#define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None || (PyUnicode_Check(b) && !PyUnicode_CheckExact(b)))) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
#else
  #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
#endif
#if PY_MAJOR_VERSION < 3 && !defined(PyObject_ASCII)
  #define PyObject_ASCII(o)            PyObject_Repr(o)
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBaseString_Type            PyUnicode_Type
  #define PyStringObject               PyUnicodeObject
  #define PyString_Type                PyUnicode_Type
  #define PyString_Check               PyUnicode_Check
  #define PyString_CheckExact          PyUnicode_CheckExact
#ifndef PyObject_Unicode
  #define PyObject_Unicode             PyObject_Str
#endif
#endif
#if PY_MAJOR_VERSION >= 3
  #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
  #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
#else
  #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
  #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
#endif
#if CYTHON_COMPILING_IN_CPYTHON
  #define __Pyx_PySequence_ListKeepNew(obj)\
    (likely(PyList_CheckExact(obj) && Py_REFCNT(obj) == 1) ? __Pyx_NewRef(obj) : PySequence_List(obj))
#else
  #define __Pyx_PySequence_ListKeepNew(obj)  PySequence_List(obj)
#endif
#ifndef PySet_CheckExact
  #define PySet_CheckExact(obj)        __Pyx_IS_TYPE(obj, &PySet_Type)
#endif
#if PY_VERSION_HEX >= 0x030900A4
  #define __Pyx_SET_REFCNT(obj, refcnt) Py_SET_REFCNT(obj, refcnt)
  #define __Pyx_SET_SIZE(obj, size) Py_SET_SIZE(obj, size)
#else
  #define __Pyx_SET_REFCNT(obj, refcnt) Py_REFCNT(obj) = (refcnt)
  #define __Pyx_SET_SIZE(obj, size) Py_SIZE(obj) = (size)
#endif
#if CYTHON_ASSUME_SAFE_MACROS
  #define __Pyx_PySequence_ITEM(o, i) PySequence_ITEM(o, i)
  #define __Pyx_PySequence_SIZE(seq)  Py_SIZE(seq)
  #define __Pyx_PyTuple_SET_ITEM(o, i, v) (PyTuple_SET_ITEM(o, i, v), (0))
  #define __Pyx_PyList_SET_ITEM(o, i, v) (PyList_SET_ITEM(o, i, v), (0))
  #define __Pyx_PyTuple_GET_SIZE(o) PyTuple_GET_SIZE(o)
  #define __Pyx_PyList_GET_SIZE(o) PyList_GET_SIZE(o)
  #define __Pyx_PySet_GET_SIZE(o) PySet_GET_SIZE(o)
  #define __Pyx_PyBytes_GET_SIZE(o) PyBytes_GET_SIZE(o)
  #define __Pyx_PyByteArray_GET_SIZE(o) PyByteArray_GET_SIZE(o)
#else
  #define __Pyx_PySequence_ITEM(o, i) PySequence_GetItem(o, i)
  #define __Pyx_PySequence_SIZE(seq)  PySequence_Size(seq)
  #define __Pyx_PyTuple_SET_ITEM(o, i, v) PyTuple_SetItem(o, i, v)
  #define __Pyx_PyList_SET_ITEM(o, i, v) PyList_SetItem(o, i, v)
  #define __Pyx_PyTuple_GET_SIZE(o) PyTuple_Size(o)
  #define __Pyx_PyList_GET_SIZE(o) PyList_Size(o)
  #define __Pyx_PySet_GET_SIZE(o) PySet_Size(o)
  #define __Pyx_PyBytes_GET_SIZE(o) PyBytes_Size(o)
  #define __Pyx_PyByteArray_GET_SIZE(o) PyByteArray_Size(o)
#endif
#if __PYX_LIMITED_VERSION_HEX >= 0x030d00A1
  #define __Pyx_PyImport_AddModuleRef(name) PyImport_AddModuleRef(name)
#else
  static CYTHON_INLINE PyObject *__Pyx_PyImport_AddModuleRef(const char *name) {
      PyObject *module = PyImport_AddModule(name);
      Py_XINCREF(module);
      return module;
  }
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyIntObject                  PyLongObject
  #define PyInt_Type                   PyLong_Type
  #define PyInt_Check(op)              PyLong_Check(op)
  #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
  #define __Pyx_Py3Int_Check(op)       PyLong_Check(op)
  #define __Pyx_Py3Int_CheckExact(op)  PyLong_CheckExact(op)
  #define PyInt_FromString             PyLong_FromString
  #define PyInt_FromUnicode            PyLong_FromUnicode
  #define PyInt_FromLong               PyLong_FromLong
  #define PyInt_FromSize_t             PyLong_FromSize_t
  #define PyInt_FromSsize_t            PyLong_FromSsize_t
  #define PyInt_AsLong                 PyLong_AsLong
  #define PyInt_AS_LONG                PyLong_AS_LONG
  #define PyInt_AsSsize_t              PyLong_AsSsize_t
  #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
  #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
  #define PyNumber_Int                 PyNumber_Long
#else
  #define __Pyx_Py3Int_Check(op)       (PyLong_Check(op) || PyInt_Check(op))
  #define __Pyx_Py3Int_CheckExact(op)  (PyLong_CheckExact(op) || PyInt_CheckExact(op))
#endif
#if PY_MAJOR_VERSION >= 3
  #define PyBoolObject                 PyLongObject
#endif
#if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
  #ifndef PyUnicode_InternFromString
    #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
  #endif
#endif
#if PY_VERSION_HEX < 0x030200A4
  typedef long Py_hash_t;
  #define __Pyx_PyInt_FromHash_t PyInt_FromLong
  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
#else
  #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
#endif
#if CYTHON_USE_ASYNC_SLOTS
  #if PY_VERSION_HEX >= 0x030500B1
    #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
    #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
  #else
    #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
  #endif
#else
  #define __Pyx_PyType_AsAsync(obj) NULL
#endif
#ifndef __Pyx_PyAsyncMethodsStruct
    typedef struct {
        unaryfunc am_await;
        unaryfunc am_aiter;
        unaryfunc am_anext;
    } __Pyx_PyAsyncMethodsStruct;
#endif

#if defined(_WIN32) || defined(WIN32) || defined(MS_WINDOWS)
  #if !defined(_USE_MATH_DEFINES)
    #define _USE_MATH_DEFINES
  #endif
#endif
#include <math.h>
#ifdef NAN
#define __PYX_NAN() ((float) NAN)
#else
static CYTHON_INLINE float __PYX_NAN() {
  float value;
  memset(&value, 0xFF, sizeof(value));
  return value;
}
#endif
#if defined(__CYGWIN__) && defined(_LDBL_EQ_DBL)
#define __Pyx_truncl trunc
#else
#define __Pyx_truncl truncl
#endif

#define __PYX_MARK_ERR_POS(f_index, lineno) \
    { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__;  (void)__pyx_clineno; }
#define __PYX_ERR(f_index, lineno, Ln_error) \
    { __PYX_MARK_ERR_POS(f_index, lineno) goto Ln_error; }

#ifdef CYTHON_EXTERN_C
    #undef __PYX_EXTERN_C
    #define __PYX_EXTERN_C CYTHON_EXTERN_C
#elif defined(__PYX_EXTERN_C)
    #ifdef _MSC_VER
    #pragma message ("Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.")
    #else
    #warning Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.
    #endif
#else
  #ifdef __cplusplus
    #define __PYX_EXTERN_C extern "C"
  #else
    #define __PYX_EXTERN_C extern
  #endif
#endif

#define __PYX_HAVE__gofast__tools__mathex
#define __PYX_HAVE_API__gofast__tools__mathex
/* Early includes */
#ifdef _OPENMP
#include <omp.h>
#endif /* _OPENMP */

#if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
#define CYTHON_WITHOUT_ASSERTIONS
#endif

typedef struct {PyObject **p; const char *s; const Py_ssize_t n; const char* encoding;
                const char is_unicode; const char is_str; const char intern; } __Pyx_StringTabEntry;

#define __PYX_DEFAULT_STRING_ENCODING_IS_ASCII 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_UTF8 0
#define __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT (PY_MAJOR_VERSION >= 3 && __PYX_DEFAULT_STRING_ENCODING_IS_UTF8)
#define __PYX_DEFAULT_STRING_ENCODING ""
#define __Pyx_PyObject_FromString __Pyx_PyBytes_FromString
#define __Pyx_PyObject_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#define __Pyx_uchar_cast(c) ((unsigned char)c)
#define __Pyx_long_cast(x) ((long)x)
#define __Pyx_fits_Py_ssize_t(v, type, is_signed)  (\
    (sizeof(type) < sizeof(Py_ssize_t))  ||\
    (sizeof(type) > sizeof(Py_ssize_t) &&\
          likely(v < (type)PY_SSIZE_T_MAX ||\
                 v == (type)PY_SSIZE_T_MAX)  &&\
          (!is_signed || likely(v > (type)PY_SSIZE_T_MIN ||\
                                v == (type)PY_SSIZE_T_MIN)))  ||\
    (sizeof(type) == sizeof(Py_ssize_t) &&\
          (is_signed || likely(v < (type)PY_SSIZE_T_MAX ||\
                               v == (type)PY_SSIZE_T_MAX)))  )
static CYTHON_INLINE int __Pyx_is_valid_index(Py_ssize_t i, Py_ssize_t limit) {
    return (size_t) i < (size_t) limit;
}
#if defined (__cplusplus) && __cplusplus >= 201103L
    #include <cstdlib>
    #define __Pyx_sst_abs(value) std::abs(value)
#elif SIZEOF_INT >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) abs(value)
#elif SIZEOF_LONG >= SIZEOF_SIZE_T
    #define __Pyx_sst_abs(value) labs(value)
#elif defined (_MSC_VER)
    #define __Pyx_sst_abs(value) ((Py_ssize_t)_abs64(value))
#elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
    #define __Pyx_sst_abs(value) llabs(value)
#elif defined (__GNUC__)
    #define __Pyx_sst_abs(value) __builtin_llabs(value)
#else
    #define __Pyx_sst_abs(value) ((value<0) ? -value : value)
#endif
static CYTHON_INLINE Py_ssize_t __Pyx_ssize_strlen(const char *s);
static CYTHON_INLINE const char* __Pyx_PyObject_AsString(PyObject*);
static CYTHON_INLINE const char* __Pyx_PyObject_AsStringAndSize(PyObject*, Py_ssize_t* length);
static CYTHON_INLINE PyObject* __Pyx_PyByteArray_FromString(const char*);
#define __Pyx_PyByteArray_FromStringAndSize(s, l) PyByteArray_FromStringAndSize((const char*)s, l)
#define __Pyx_PyBytes_FromString        PyBytes_FromString
#define __Pyx_PyBytes_FromStringAndSize PyBytes_FromStringAndSize
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char*);
#if PY_MAJOR_VERSION < 3
    #define __Pyx_PyStr_FromString        __Pyx_PyBytes_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyBytes_FromStringAndSize
#else
    #define __Pyx_PyStr_FromString        __Pyx_PyUnicode_FromString
    #define __Pyx_PyStr_FromStringAndSize __Pyx_PyUnicode_FromStringAndSize
#endif
#define __Pyx_PyBytes_AsWritableString(s)     ((char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsWritableSString(s)    ((signed char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsWritableUString(s)    ((unsigned char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsString(s)     ((const char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsSString(s)    ((const signed char*) PyBytes_AS_STRING(s))
#define __Pyx_PyBytes_AsUString(s)    ((const unsigned char*) PyBytes_AS_STRING(s))
#define __Pyx_PyObject_AsWritableString(s)    ((char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
#define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
#define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
#define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
#define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
#define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
#define __Pyx_PyUnicode_FromOrdinal(o)       PyUnicode_FromOrdinal((int)o)
#define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
#define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
#define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
#define __Pyx_PySequence_Tuple(obj)\
    (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
#if CYTHON_ASSUME_SAFE_MACROS
#define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
#else
#define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
#endif
#define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
#if PY_MAJOR_VERSION >= 3
#define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
#else
#define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
#endif
#if CYTHON_USE_PYLONG_INTERNALS
  #if PY_VERSION_HEX >= 0x030C00A7
  #ifndef _PyLong_SIGN_MASK
    #define _PyLong_SIGN_MASK 3
  #endif
  #ifndef _PyLong_NON_SIZE_BITS
    #define _PyLong_NON_SIZE_BITS 3
  #endif
  #define __Pyx_PyLong_Sign(x)  (((PyLongObject*)x)->long_value.lv_tag & _PyLong_SIGN_MASK)
  #define __Pyx_PyLong_IsNeg(x)  ((__Pyx_PyLong_Sign(x) & 2) != 0)
  #define __Pyx_PyLong_IsNonNeg(x)  (!__Pyx_PyLong_IsNeg(x))
  #define __Pyx_PyLong_IsZero(x)  (__Pyx_PyLong_Sign(x) & 1)
  #define __Pyx_PyLong_IsPos(x)  (__Pyx_PyLong_Sign(x) == 0)
  #define __Pyx_PyLong_CompactValueUnsigned(x)  (__Pyx_PyLong_Digits(x)[0])
  #define __Pyx_PyLong_DigitCount(x)  ((Py_ssize_t) (((PyLongObject*)x)->long_value.lv_tag >> _PyLong_NON_SIZE_BITS))
  #define __Pyx_PyLong_SignedDigitCount(x)\
        ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * __Pyx_PyLong_DigitCount(x))
  #if defined(PyUnstable_Long_IsCompact) && defined(PyUnstable_Long_CompactValue)
    #define __Pyx_PyLong_IsCompact(x)     PyUnstable_Long_IsCompact((PyLongObject*) x)
    #define __Pyx_PyLong_CompactValue(x)  PyUnstable_Long_CompactValue((PyLongObject*) x)
  #else
    #define __Pyx_PyLong_IsCompact(x)     (((PyLongObject*)x)->long_value.lv_tag < (2 << _PyLong_NON_SIZE_BITS))
    #define __Pyx_PyLong_CompactValue(x)  ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * (Py_ssize_t) __Pyx_PyLong_Digits(x)[0])
  #endif
  typedef Py_ssize_t  __Pyx_compact_pylong;
  typedef size_t  __Pyx_compact_upylong;
  #else
  #define __Pyx_PyLong_IsNeg(x)  (Py_SIZE(x) < 0)
  #define __Pyx_PyLong_IsNonNeg(x)  (Py_SIZE(x) >= 0)
  #define __Pyx_PyLong_IsZero(x)  (Py_SIZE(x) == 0)
  #define __Pyx_PyLong_IsPos(x)  (Py_SIZE(x) > 0)
  #define __Pyx_PyLong_CompactValueUnsigned(x)  ((Py_SIZE(x) == 0) ? 0 : __Pyx_PyLong_Digits(x)[0])
  #define __Pyx_PyLong_DigitCount(x)  __Pyx_sst_abs(Py_SIZE(x))
  #define __Pyx_PyLong_SignedDigitCount(x)  Py_SIZE(x)
  #define __Pyx_PyLong_IsCompact(x)  (Py_SIZE(x) == 0 || Py_SIZE(x) == 1 || Py_SIZE(x) == -1)
  #define __Pyx_PyLong_CompactValue(x)\
        ((Py_SIZE(x) == 0) ? (sdigit) 0 : ((Py_SIZE(x) < 0) ? -(sdigit)__Pyx_PyLong_Digits(x)[0] : (sdigit)__Pyx_PyLong_Digits(x)[0]))
  typedef sdigit  __Pyx_compact_pylong;
  typedef digit  __Pyx_compact_upylong;
  #endif
  #if PY_VERSION_HEX >= 0x030C00A5
  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->long_value.ob_digit)
  #else
  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->ob_digit)
  #endif
#endif
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
#include <string.h>
static int __Pyx_sys_getdefaultencoding_not_ascii;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    PyObject* ascii_chars_u = NULL;
    PyObject* ascii_chars_b = NULL;
    const char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    if (strcmp(default_encoding_c, "ascii") == 0) {
        __Pyx_sys_getdefaultencoding_not_ascii = 0;
    } else {
        char ascii_chars[128];
        int c;
        for (c = 0; c < 128; c++) {
            ascii_chars[c] = (char) c;
        }
        __Pyx_sys_getdefaultencoding_not_ascii = 1;
        ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
        if (!ascii_chars_u) goto bad;
        ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
        if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
            PyErr_Format(
                PyExc_ValueError,
                "This module compiled with c_string_encoding=ascii, but default encoding '%.200s' is not a superset of ascii.",
                default_encoding_c);
            goto bad;
        }
        Py_DECREF(ascii_chars_u);
        Py_DECREF(ascii_chars_b);
    }
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    Py_XDECREF(ascii_chars_u);
    Py_XDECREF(ascii_chars_b);
    return -1;
}
#endif
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT && PY_MAJOR_VERSION >= 3
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_DecodeUTF8(c_str, size, NULL)
#else
#define __Pyx_PyUnicode_FromStringAndSize(c_str, size) PyUnicode_Decode(c_str, size, __PYX_DEFAULT_STRING_ENCODING, NULL)
#if __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
#include <string.h>
static char* __PYX_DEFAULT_STRING_ENCODING;
static int __Pyx_init_sys_getdefaultencoding_params(void) {
    PyObject* sys;
    PyObject* default_encoding = NULL;
    char* default_encoding_c;
    sys = PyImport_ImportModule("sys");
    if (!sys) goto bad;
    default_encoding = PyObject_CallMethod(sys, (char*) (const char*) "getdefaultencoding", NULL);
    Py_DECREF(sys);
    if (!default_encoding) goto bad;
    default_encoding_c = PyBytes_AsString(default_encoding);
    if (!default_encoding_c) goto bad;
    __PYX_DEFAULT_STRING_ENCODING = (char*) malloc(strlen(default_encoding_c) + 1);
    if (!__PYX_DEFAULT_STRING_ENCODING) goto bad;
    strcpy(__PYX_DEFAULT_STRING_ENCODING, default_encoding_c);
    Py_DECREF(default_encoding);
    return 0;
bad:
    Py_XDECREF(default_encoding);
    return -1;
}
#endif
#endif


/* Test for GCC > 2.95 */
#if defined(__GNUC__)     && (__GNUC__ > 2 || (__GNUC__ == 2 && (__GNUC_MINOR__ > 95)))
  #define likely(x)   __builtin_expect(!!(x), 1)
  #define unlikely(x) __builtin_expect(!!(x), 0)
#else /* !__GNUC__ or GCC < 2.95 */
  #define likely(x)   (x)
  #define unlikely(x) (x)
#endif /* __GNUC__ */
static CYTHON_INLINE void __Pyx_pretend_to_initialize(void* ptr) { (void)ptr; }

#if !CYTHON_USE_MODULE_STATE
static PyObject *__pyx_m = NULL;
#endif
static int __pyx_lineno;
static int __pyx_clineno = 0;
static const char * __pyx_cfilenm = __FILE__;
static const char *__pyx_filename;

/* #### Code section: filename_table ### */

static const char *__pyx_f[] = {
  "gofast/tools/mathex.pyx",
};
/* #### Code section: utility_code_proto_before_types ### */
/* NoFastGil.proto */
#define __Pyx_PyGILState_Ensure PyGILState_Ensure
#define __Pyx_PyGILState_Release PyGILState_Release
#define __Pyx_FastGIL_Remember()
#define __Pyx_FastGIL_Forget()
#define __Pyx_FastGilFuncInit()

/* ForceInitThreads.proto */
#ifndef __PYX_FORCE_INIT_THREADS
  #define __PYX_FORCE_INIT_THREADS 0
#endif

/* #### Code section: numeric_typedefs ### */
/* #### Code section: complex_type_declarations ### */
/* #### Code section: type_declarations ### */

/*--- Type declarations ---*/
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr;
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth;
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model;
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter;
struct __pyx_defaults;
typedef struct __pyx_defaults __pyx_defaults;
struct __pyx_defaults1;
typedef struct __pyx_defaults1 __pyx_defaults1;
struct __pyx_defaults2;
typedef struct __pyx_defaults2 __pyx_defaults2;
struct __pyx_defaults3;
typedef struct __pyx_defaults3 __pyx_defaults3;
struct __pyx_defaults {
  PyObject *__pyx_arg_zero_division;
};
struct __pyx_defaults1 {
  PyObject *__pyx_arg_window_size;
};
struct __pyx_defaults2 {
  PyObject *__pyx_arg_default;
};
struct __pyx_defaults3 {
  PyObject *__pyx_arg_n_epochs;
  PyObject *__pyx_arg_degree;
};

/* "gofast/tools/mathex.pyx":1962
 *             raise ValueError(
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):             # <<<<<<<<<<<<<<
 *             raise ValueError("data_range must contain numeric values.")
 *         data_min, data_max = data_range
 */
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr {
  PyObject_HEAD
  PyObject *__pyx_genexpr_arg_0;
  PyObject *__pyx_v_v;
};


/* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth {
  PyObject_HEAD
  PyObject *__pyx_v_xlon;
  PyObject *__pyx_v_ylat;
};


/* "gofast/tools/mathex.pyx":4907
 *     return _F,W, cost_history
 * 
 * def _kind_of_model(degree, x, y) :             # <<<<<<<<<<<<<<
 *     """
 *     An isolated part of gradient descent computing.
 */
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model {
  PyObject_HEAD
  PyObject *__pyx_v_w;
};


/* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */
struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter {
  PyObject_HEAD
  double __pyx_v_beta;
};

/* #### Code section: utility_code_proto ### */

/* --- Runtime support code (head) --- */
/* Refnanny.proto */
#ifndef CYTHON_REFNANNY
  #define CYTHON_REFNANNY 0
#endif
#if CYTHON_REFNANNY
  typedef struct {
    void (*INCREF)(void*, PyObject*, Py_ssize_t);
    void (*DECREF)(void*, PyObject*, Py_ssize_t);
    void (*GOTREF)(void*, PyObject*, Py_ssize_t);
    void (*GIVEREF)(void*, PyObject*, Py_ssize_t);
    void* (*SetupContext)(const char*, Py_ssize_t, const char*);
    void (*FinishContext)(void**);
  } __Pyx_RefNannyAPIStruct;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
  static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
  #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
#ifdef WITH_THREAD
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          if (acquire_gil) {\
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
              PyGILState_Release(__pyx_gilstate_save);\
          } else {\
              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
          }
  #define __Pyx_RefNannyFinishContextNogil() {\
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
              __Pyx_RefNannyFinishContext();\
              PyGILState_Release(__pyx_gilstate_save);\
          }
#else
  #define __Pyx_RefNannySetupContext(name, acquire_gil)\
          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__))
  #define __Pyx_RefNannyFinishContextNogil() __Pyx_RefNannyFinishContext()
#endif
  #define __Pyx_RefNannyFinishContextNogil() {\
              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
              __Pyx_RefNannyFinishContext();\
              PyGILState_Release(__pyx_gilstate_save);\
          }
  #define __Pyx_RefNannyFinishContext()\
          __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
  #define __Pyx_XINCREF(r)  do { if((r) == NULL); else {__Pyx_INCREF(r); }} while(0)
  #define __Pyx_XDECREF(r)  do { if((r) == NULL); else {__Pyx_DECREF(r); }} while(0)
  #define __Pyx_XGOTREF(r)  do { if((r) == NULL); else {__Pyx_GOTREF(r); }} while(0)
  #define __Pyx_XGIVEREF(r) do { if((r) == NULL); else {__Pyx_GIVEREF(r);}} while(0)
#else
  #define __Pyx_RefNannyDeclarations
  #define __Pyx_RefNannySetupContext(name, acquire_gil)
  #define __Pyx_RefNannyFinishContextNogil()
  #define __Pyx_RefNannyFinishContext()
  #define __Pyx_INCREF(r) Py_INCREF(r)
  #define __Pyx_DECREF(r) Py_DECREF(r)
  #define __Pyx_GOTREF(r)
  #define __Pyx_GIVEREF(r)
  #define __Pyx_XINCREF(r) Py_XINCREF(r)
  #define __Pyx_XDECREF(r) Py_XDECREF(r)
  #define __Pyx_XGOTREF(r)
  #define __Pyx_XGIVEREF(r)
#endif
#define __Pyx_Py_XDECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; Py_XDECREF(tmp);\
    } while (0)
#define __Pyx_XDECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_XDECREF(tmp);\
    } while (0)
#define __Pyx_DECREF_SET(r, v) do {\
        PyObject *tmp = (PyObject *) r;\
        r = v; __Pyx_DECREF(tmp);\
    } while (0)
#define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
#define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)

/* PyErrExceptionMatches.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
#else
#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
#endif

/* PyThreadStateGet.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
#define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
#if PY_VERSION_HEX >= 0x030C00A6
#define __Pyx_PyErr_Occurred()  (__pyx_tstate->current_exception != NULL)
#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->current_exception ? (PyObject*) Py_TYPE(__pyx_tstate->current_exception) : (PyObject*) NULL)
#else
#define __Pyx_PyErr_Occurred()  (__pyx_tstate->curexc_type != NULL)
#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->curexc_type)
#endif
#else
#define __Pyx_PyThreadState_declare
#define __Pyx_PyThreadState_assign
#define __Pyx_PyErr_Occurred()  (PyErr_Occurred() != NULL)
#define __Pyx_PyErr_CurrentExceptionType()  PyErr_Occurred()
#endif

/* PyErrFetchRestore.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
#define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A6
#define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
#else
#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
#endif
#else
#define __Pyx_PyErr_Clear() PyErr_Clear()
#define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
#define __Pyx_ErrRestoreWithState(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
#define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
#define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
#endif

/* PyObjectGetAttrStr.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
#endif

/* PyObjectGetAttrStrNoError.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);

/* GetBuiltinName.proto */
static PyObject *__Pyx_GetBuiltinName(PyObject *name);

/* TupleAndListFromArray.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
#endif

/* IncludeStringH.proto */
#include <string.h>

/* BytesEquals.proto */
static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);

/* UnicodeEquals.proto */
static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);

/* fastcall.proto */
#if CYTHON_AVOID_BORROWED_REFS
    #define __Pyx_Arg_VARARGS(args, i) PySequence_GetItem(args, i)
#elif CYTHON_ASSUME_SAFE_MACROS
    #define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)
#else
    #define __Pyx_Arg_VARARGS(args, i) PyTuple_GetItem(args, i)
#endif
#if CYTHON_AVOID_BORROWED_REFS
    #define __Pyx_Arg_NewRef_VARARGS(arg) __Pyx_NewRef(arg)
    #define __Pyx_Arg_XDECREF_VARARGS(arg) Py_XDECREF(arg)
#else
    #define __Pyx_Arg_NewRef_VARARGS(arg) arg
    #define __Pyx_Arg_XDECREF_VARARGS(arg)
#endif
#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)
#define __Pyx_KwValues_VARARGS(args, nargs) NULL
#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStrWithError(kw, s)
#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)
#if CYTHON_METH_FASTCALL
    #define __Pyx_Arg_FASTCALL(args, i) args[i]
    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)
    #define __Pyx_KwValues_FASTCALL(args, nargs) ((args) + (nargs))
    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030d0000
    CYTHON_UNUSED static PyObject *__Pyx_KwargsAsDict_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues);
  #else
    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)
  #endif
    #define __Pyx_Arg_NewRef_FASTCALL(arg) arg  /* no-op, __Pyx_Arg_FASTCALL is direct and this needs
                                                   to have the same reference counting */
    #define __Pyx_Arg_XDECREF_FASTCALL(arg)
#else
    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS
    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS
    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS
    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS
    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS
    #define __Pyx_Arg_NewRef_FASTCALL(arg) __Pyx_Arg_NewRef_VARARGS(arg)
    #define __Pyx_Arg_XDECREF_FASTCALL(arg) __Pyx_Arg_XDECREF_VARARGS(arg)
#endif
#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
#else
#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
#endif

/* RaiseArgTupleInvalid.proto */
static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);

/* RaiseDoubleKeywords.proto */
static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);

/* ParseKeywords.proto */
static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
    PyObject **argnames[],
    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
    const char* function_name);

/* ArgTypeTest.proto */
#define __Pyx_ArgTypeTest(obj, type, none_allowed, name, exact)\
    ((likely(__Pyx_IS_TYPE(obj, type) | (none_allowed && (obj == Py_None)))) ? 1 :\
        __Pyx__ArgTypeTest(obj, type, name, exact))
static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact);

/* Profile.proto */
#ifndef CYTHON_PROFILE
#if CYTHON_COMPILING_IN_LIMITED_API || CYTHON_COMPILING_IN_PYPY
  #define CYTHON_PROFILE 0
#else
  #define CYTHON_PROFILE 1
#endif
#endif
#ifndef CYTHON_TRACE_NOGIL
  #define CYTHON_TRACE_NOGIL 0
#else
  #if CYTHON_TRACE_NOGIL && !defined(CYTHON_TRACE)
    #define CYTHON_TRACE 1
  #endif
#endif
#ifndef CYTHON_TRACE
  #define CYTHON_TRACE 0
#endif
#if CYTHON_TRACE
  #undef CYTHON_PROFILE_REUSE_FRAME
#endif
#ifndef CYTHON_PROFILE_REUSE_FRAME
  #define CYTHON_PROFILE_REUSE_FRAME 0
#endif
#if CYTHON_PROFILE || CYTHON_TRACE
  #include "compile.h"
  #include "frameobject.h"
  #include "traceback.h"
#if PY_VERSION_HEX >= 0x030b00a6
  #ifndef Py_BUILD_CORE
    #define Py_BUILD_CORE 1
  #endif
  #include "internal/pycore_frame.h"
#endif
  #if CYTHON_PROFILE_REUSE_FRAME
    #define CYTHON_FRAME_MODIFIER static
    #define CYTHON_FRAME_DEL(frame)
  #else
    #define CYTHON_FRAME_MODIFIER
    #define CYTHON_FRAME_DEL(frame) Py_CLEAR(frame)
  #endif
  #define __Pyx_TraceDeclarations\
      static PyCodeObject *__pyx_frame_code = NULL;\
      CYTHON_FRAME_MODIFIER PyFrameObject *__pyx_frame = NULL;\
      int __Pyx_use_tracing = 0;
  #define __Pyx_TraceFrameInit(codeobj)\
      if (codeobj) __pyx_frame_code = (PyCodeObject*) codeobj;
#if PY_VERSION_HEX >= 0x030b00a2
  #if PY_VERSION_HEX >= 0x030C00b1
  #define __Pyx_IsTracing(tstate, check_tracing, check_funcs)\
     ((!(check_tracing) || !(tstate)->tracing) &&\
         (!(check_funcs) || (tstate)->c_profilefunc || (CYTHON_TRACE && (tstate)->c_tracefunc)))
  #else
  #define __Pyx_IsTracing(tstate, check_tracing, check_funcs)\
     (unlikely((tstate)->cframe->use_tracing) &&\
         (!(check_tracing) || !(tstate)->tracing) &&\
         (!(check_funcs) || (tstate)->c_profilefunc || (CYTHON_TRACE && (tstate)->c_tracefunc)))
  #endif
  #define __Pyx_EnterTracing(tstate)  PyThreadState_EnterTracing(tstate)
  #define __Pyx_LeaveTracing(tstate)  PyThreadState_LeaveTracing(tstate)
#elif PY_VERSION_HEX >= 0x030a00b1
  #define __Pyx_IsTracing(tstate, check_tracing, check_funcs)\
     (unlikely((tstate)->cframe->use_tracing) &&\
         (!(check_tracing) || !(tstate)->tracing) &&\
         (!(check_funcs) || (tstate)->c_profilefunc || (CYTHON_TRACE && (tstate)->c_tracefunc)))
  #define __Pyx_EnterTracing(tstate)\
      do { tstate->tracing++; tstate->cframe->use_tracing = 0; } while (0)
  #define __Pyx_LeaveTracing(tstate)\
      do {\
          tstate->tracing--;\
          tstate->cframe->use_tracing = ((CYTHON_TRACE && tstate->c_tracefunc != NULL)\
                                 || tstate->c_profilefunc != NULL);\
      } while (0)
#else
  #define __Pyx_IsTracing(tstate, check_tracing, check_funcs)\
     (unlikely((tstate)->use_tracing) &&\
         (!(check_tracing) || !(tstate)->tracing) &&\
         (!(check_funcs) || (tstate)->c_profilefunc || (CYTHON_TRACE && (tstate)->c_tracefunc)))
  #define __Pyx_EnterTracing(tstate)\
      do { tstate->tracing++; tstate->use_tracing = 0; } while (0)
  #define __Pyx_LeaveTracing(tstate)\
      do {\
          tstate->tracing--;\
          tstate->use_tracing = ((CYTHON_TRACE && tstate->c_tracefunc != NULL)\
                                         || tstate->c_profilefunc != NULL);\
      } while (0)
#endif
  #ifdef WITH_THREAD
  #define __Pyx_TraceCall(funcname, srcfile, firstlineno, nogil, goto_error)\
  if (nogil) {\
      if (CYTHON_TRACE_NOGIL) {\
          PyThreadState *tstate;\
          PyGILState_STATE state = PyGILState_Ensure();\
          tstate = __Pyx_PyThreadState_Current;\
          if (__Pyx_IsTracing(tstate, 1, 1)) {\
              __Pyx_use_tracing = __Pyx_TraceSetupAndCall(&__pyx_frame_code, &__pyx_frame, tstate, funcname, srcfile, firstlineno);\
          }\
          PyGILState_Release(state);\
          if (unlikely(__Pyx_use_tracing < 0)) goto_error;\
      }\
  } else {\
      PyThreadState* tstate = PyThreadState_GET();\
      if (__Pyx_IsTracing(tstate, 1, 1)) {\
          __Pyx_use_tracing = __Pyx_TraceSetupAndCall(&__pyx_frame_code, &__pyx_frame, tstate, funcname, srcfile, firstlineno);\
          if (unlikely(__Pyx_use_tracing < 0)) goto_error;\
      }\
  }
  #else
  #define __Pyx_TraceCall(funcname, srcfile, firstlineno, nogil, goto_error)\
  {   PyThreadState* tstate = PyThreadState_GET();\
      if (__Pyx_IsTracing(tstate, 1, 1)) {\
          __Pyx_use_tracing = __Pyx_TraceSetupAndCall(&__pyx_frame_code, &__pyx_frame, tstate, funcname, srcfile, firstlineno);\
          if (unlikely(__Pyx_use_tracing < 0)) goto_error;\
      }\
  }
  #endif
  #define __Pyx_TraceException()\
  if (likely(!__Pyx_use_tracing)); else {\
      PyThreadState* tstate = __Pyx_PyThreadState_Current;\
      if (__Pyx_IsTracing(tstate, 0, 1)) {\
          __Pyx_EnterTracing(tstate);\
          PyObject *exc_info = __Pyx_GetExceptionTuple(tstate);\
          if (exc_info) {\
              if (CYTHON_TRACE && tstate->c_tracefunc)\
                  tstate->c_tracefunc(\
                      tstate->c_traceobj, __pyx_frame, PyTrace_EXCEPTION, exc_info);\
              tstate->c_profilefunc(\
                  tstate->c_profileobj, __pyx_frame, PyTrace_EXCEPTION, exc_info);\
              Py_DECREF(exc_info);\
          }\
          __Pyx_LeaveTracing(tstate);\
      }\
  }
  static void __Pyx_call_return_trace_func(PyThreadState *tstate, PyFrameObject *frame, PyObject *result) {
      PyObject *type, *value, *traceback;
      __Pyx_ErrFetchInState(tstate, &type, &value, &traceback);
      __Pyx_EnterTracing(tstate);
      if (CYTHON_TRACE && tstate->c_tracefunc)
          tstate->c_tracefunc(tstate->c_traceobj, frame, PyTrace_RETURN, result);
      if (tstate->c_profilefunc)
          tstate->c_profilefunc(tstate->c_profileobj, frame, PyTrace_RETURN, result);
      CYTHON_FRAME_DEL(frame);
      __Pyx_LeaveTracing(tstate);
      __Pyx_ErrRestoreInState(tstate, type, value, traceback);
  }
  #ifdef WITH_THREAD
  #define __Pyx_TraceReturn(result, nogil)\
  if (likely(!__Pyx_use_tracing)); else {\
      if (nogil) {\
          if (CYTHON_TRACE_NOGIL) {\
              PyThreadState *tstate;\
              PyGILState_STATE state = PyGILState_Ensure();\
              tstate = __Pyx_PyThreadState_Current;\
              if (__Pyx_IsTracing(tstate, 0, 0)) {\
                  __Pyx_call_return_trace_func(tstate, __pyx_frame, (PyObject*)result);\
              }\
              PyGILState_Release(state);\
          }\
      } else {\
          PyThreadState* tstate = __Pyx_PyThreadState_Current;\
          if (__Pyx_IsTracing(tstate, 0, 0)) {\
              __Pyx_call_return_trace_func(tstate, __pyx_frame, (PyObject*)result);\
          }\
      }\
  }
  #else
  #define __Pyx_TraceReturn(result, nogil)\
  if (likely(!__Pyx_use_tracing)); else {\
      PyThreadState* tstate = __Pyx_PyThreadState_Current;\
      if (__Pyx_IsTracing(tstate, 0, 0)) {\
          __Pyx_call_return_trace_func(tstate, __pyx_frame, (PyObject*)result);\
      }\
  }
  #endif
  static PyCodeObject *__Pyx_createFrameCodeObject(const char *funcname, const char *srcfile, int firstlineno);
  static int __Pyx_TraceSetupAndCall(PyCodeObject** code, PyFrameObject** frame, PyThreadState* tstate, const char *funcname, const char *srcfile, int firstlineno);
#else
  #define __Pyx_TraceDeclarations
  #define __Pyx_TraceFrameInit(codeobj)
  #define __Pyx_TraceCall(funcname, srcfile, firstlineno, nogil, goto_error)   if ((1)); else goto_error;
  #define __Pyx_TraceException()
  #define __Pyx_TraceReturn(result, nogil)
#endif
#if CYTHON_TRACE
  static int __Pyx_call_line_trace_func(PyThreadState *tstate, PyFrameObject *frame, int lineno) {
      int ret;
      PyObject *type, *value, *traceback;
      __Pyx_ErrFetchInState(tstate, &type, &value, &traceback);
      __Pyx_PyFrame_SetLineNumber(frame, lineno);
      __Pyx_EnterTracing(tstate);
      ret = tstate->c_tracefunc(tstate->c_traceobj, frame, PyTrace_LINE, NULL);
      __Pyx_LeaveTracing(tstate);
      if (likely(!ret)) {
          __Pyx_ErrRestoreInState(tstate, type, value, traceback);
      } else {
          Py_XDECREF(type);
          Py_XDECREF(value);
          Py_XDECREF(traceback);
      }
      return ret;
  }
  #ifdef WITH_THREAD
  #define __Pyx_TraceLine(lineno, nogil, goto_error)\
  if (likely(!__Pyx_use_tracing)); else {\
      if (nogil) {\
          if (CYTHON_TRACE_NOGIL) {\
              int ret = 0;\
              PyThreadState *tstate;\
              PyGILState_STATE state = __Pyx_PyGILState_Ensure();\
              tstate = __Pyx_PyThreadState_Current;\
              if (__Pyx_IsTracing(tstate, 0, 0) && tstate->c_tracefunc && __pyx_frame->f_trace) {\
                  ret = __Pyx_call_line_trace_func(tstate, __pyx_frame, lineno);\
              }\
              __Pyx_PyGILState_Release(state);\
              if (unlikely(ret)) goto_error;\
          }\
      } else {\
          PyThreadState* tstate = __Pyx_PyThreadState_Current;\
          if (__Pyx_IsTracing(tstate, 0, 0) && tstate->c_tracefunc && __pyx_frame->f_trace) {\
              int ret = __Pyx_call_line_trace_func(tstate, __pyx_frame, lineno);\
              if (unlikely(ret)) goto_error;\
          }\
      }\
  }
  #else
  #define __Pyx_TraceLine(lineno, nogil, goto_error)\
  if (likely(!__Pyx_use_tracing)); else {\
      PyThreadState* tstate = __Pyx_PyThreadState_Current;\
      if (__Pyx_IsTracing(tstate, 0, 0) && tstate->c_tracefunc && __pyx_frame->f_trace) {\
          int ret = __Pyx_call_line_trace_func(tstate, __pyx_frame, lineno);\
          if (unlikely(ret)) goto_error;\
      }\
  }
  #endif
#else
  #define __Pyx_TraceLine(lineno, nogil, goto_error)   if ((1)); else goto_error;
#endif

/* PyDictVersioning.proto */
#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
    (version_var) = __PYX_GET_DICT_VERSION(dict);\
    (cache_var) = (value);
#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
    static PY_UINT64_T __pyx_dict_version = 0;\
    static PyObject *__pyx_dict_cached_value = NULL;\
    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
        (VAR) = __pyx_dict_cached_value;\
    } else {\
        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
    }\
}
static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
#else
#define __PYX_GET_DICT_VERSION(dict)  (0)
#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
#endif

/* GetModuleGlobalName.proto */
#if CYTHON_USE_DICT_VERSIONS
#define __Pyx_GetModuleGlobalName(var, name)  do {\
    static PY_UINT64_T __pyx_dict_version = 0;\
    static PyObject *__pyx_dict_cached_value = NULL;\
    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
} while(0)
#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
    PY_UINT64_T __pyx_dict_version;\
    PyObject *__pyx_dict_cached_value;\
    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
} while(0)
static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
#else
#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
#endif

/* PyFunctionFastCall.proto */
#if CYTHON_FAST_PYCALL
#if !CYTHON_VECTORCALL
#define __Pyx_PyFunction_FastCall(func, args, nargs)\
    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
#endif
#define __Pyx_BUILD_ASSERT_EXPR(cond)\
    (sizeof(char [1 - 2*!(cond)]) - 1)
#ifndef Py_MEMBER_SIZE
#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
#endif
#if !CYTHON_VECTORCALL
#if PY_VERSION_HEX >= 0x03080000
  #include "frameobject.h"
#if PY_VERSION_HEX >= 0x030b00a6 && !CYTHON_COMPILING_IN_LIMITED_API
  #ifndef Py_BUILD_CORE
    #define Py_BUILD_CORE 1
  #endif
  #include "internal/pycore_frame.h"
#endif
  #define __Pxy_PyFrame_Initialize_Offsets()
  #define __Pyx_PyFrame_GetLocalsplus(frame)  ((frame)->f_localsplus)
#else
  static size_t __pyx_pyframe_localsplus_offset = 0;
  #include "frameobject.h"
  #define __Pxy_PyFrame_Initialize_Offsets()\
    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
  #define __Pyx_PyFrame_GetLocalsplus(frame)\
    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
#endif
#endif
#endif

/* PyObjectCall.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
#else
#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
#endif

/* PyObjectCallMethO.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
#endif

/* PyObjectFastCall.proto */
#define __Pyx_PyObject_FastCall(func, args, nargs)  __Pyx_PyObject_FastCallDict(func, args, (size_t)(nargs), NULL)
static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs);

/* PyObjectFormatAndDecref.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatSimpleAndDecref(PyObject* s, PyObject* f);
static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatAndDecref(PyObject* s, PyObject* f);

/* PyObjectCallOneArg.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);

/* RaiseException.proto */
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);

/* PySequenceContains.proto */
static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
    int result = PySequence_Contains(seq, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* PyObjectFormatSimple.proto */
#if CYTHON_COMPILING_IN_PYPY
    #define __Pyx_PyObject_FormatSimple(s, f) (\
        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
        PyObject_Format(s, f))
#elif PY_MAJOR_VERSION < 3
    #define __Pyx_PyObject_FormatSimple(s, f) (\
        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
        PyObject_Format(s, f))
#elif CYTHON_USE_TYPE_SLOTS
    #define __Pyx_PyObject_FormatSimple(s, f) (\
        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_repr(s) :\
        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_repr(s) :\
        PyObject_Format(s, f))
#else
    #define __Pyx_PyObject_FormatSimple(s, f) (\
        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
        PyObject_Format(s, f))
#endif

/* JoinPyUnicode.proto */
static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                      Py_UCS4 max_char);

/* GetItemInt.proto */
#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              int wraparound, int boundscheck);
static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                     int is_list, int wraparound, int boundscheck);

/* ObjectGetItem.proto */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject *key);
#else
#define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
#endif

/* GetAttr.proto */
static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *, PyObject *);

/* HasAttr.proto */
#if __PYX_LIMITED_VERSION_HEX >= 0x030d00A1
#define __Pyx_HasAttr(o, n)  PyObject_HasAttrWithError(o, n)
#else
static CYTHON_INLINE int __Pyx_HasAttr(PyObject *, PyObject *);
#endif

/* PyIntCompare.proto */
static CYTHON_INLINE int __Pyx_PyInt_BoolEqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);

/* ListCompAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_ListComp_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len)) {
        Py_INCREF(x);
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030d0000
        L->ob_item[len] = x;
        #else
        PyList_SET_ITEM(list, len, x);
        #endif
        __Pyx_SET_SIZE(list, len + 1);
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_ListComp_Append(L,x) PyList_Append(L,x)
#endif

/* PyDictContains.proto */
static CYTHON_INLINE int __Pyx_PyDict_ContainsTF(PyObject* item, PyObject* dict, int eq) {
    int result = PyDict_Contains(dict, item);
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* DictGetItem.proto */
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key);
#define __Pyx_PyObject_Dict_GetItem(obj, name)\
    (likely(PyDict_CheckExact(obj)) ?\
     __Pyx_PyDict_GetItem(obj, name) : PyObject_GetItem(obj, name))
#else
#define __Pyx_PyDict_GetItem(d, key) PyObject_GetItem(d, key)
#define __Pyx_PyObject_Dict_GetItem(obj, name)  PyObject_GetItem(obj, name)
#endif

/* RaiseTooManyValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);

/* RaiseNeedMoreValuesToUnpack.proto */
static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);

/* IterFinish.proto */
static CYTHON_INLINE int __Pyx_IterFinish(void);

/* UnpackItemEndCheck.proto */
static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);

/* RaiseUnexpectedTypeError.proto */
static int __Pyx_RaiseUnexpectedTypeError(const char *expected, PyObject *obj);

/* RaiseUnboundLocalError.proto */
static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_TrueDivideObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_TrueDivideObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceTrueDivide(op1, op2) : PyNumber_TrueDivide(op1, op2))
#endif

/* ListAppend.proto */
#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
    PyListObject* L = (PyListObject*) list;
    Py_ssize_t len = Py_SIZE(list);
    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
        Py_INCREF(x);
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030d0000
        L->ob_item[len] = x;
        #else
        PyList_SET_ITEM(list, len, x);
        #endif
        __Pyx_SET_SIZE(list, len + 1);
        return 0;
    }
    return PyList_Append(list, x);
}
#else
#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
#endif

/* SliceObject.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
        int has_cstart, int has_cstop, int wraparound);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_AddObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceAdd(op1, op2) : PyNumber_Add(op1, op2))
#endif

/* pybytes_as_double.proto */
static double __Pyx_SlowPyString_AsDouble(PyObject *obj);
static double __Pyx__PyBytes_AsDouble(PyObject *obj, const char* start, Py_ssize_t length);
static CYTHON_INLINE double __Pyx_PyBytes_AsDouble(PyObject *obj) {
    char* as_c_string;
    Py_ssize_t size;
#if CYTHON_ASSUME_SAFE_MACROS
    as_c_string = PyBytes_AS_STRING(obj);
    size = PyBytes_GET_SIZE(obj);
#else
    if (PyBytes_AsStringAndSize(obj, &as_c_string, &size) < 0) {
        return (double)-1;
    }
#endif
    return __Pyx__PyBytes_AsDouble(obj, as_c_string, size);
}
static CYTHON_INLINE double __Pyx_PyByteArray_AsDouble(PyObject *obj) {
    char* as_c_string;
    Py_ssize_t size;
#if CYTHON_ASSUME_SAFE_MACROS
    as_c_string = PyByteArray_AS_STRING(obj);
    size = PyByteArray_GET_SIZE(obj);
#else
    as_c_string = PyByteArray_AsString(obj);
    if (as_c_string == NULL) {
        return (double)-1;
    }
    size = PyByteArray_Size(obj);
#endif
    return __Pyx__PyBytes_AsDouble(obj, as_c_string, size);
}

/* pyunicode_as_double.proto */
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY && CYTHON_ASSUME_SAFE_MACROS
static const char* __Pyx__PyUnicode_AsDouble_Copy(const void* data, const int kind, char* buffer, Py_ssize_t start, Py_ssize_t end) {
    int last_was_punctuation;
    Py_ssize_t i;
    last_was_punctuation = 1;
    for (i=start; i <= end; i++) {
        Py_UCS4 chr = PyUnicode_READ(kind, data, i);
        int is_punctuation = (chr == '_') | (chr == '.');
        *buffer = (char)chr;
        buffer += (chr != '_');
        if (unlikely(chr > 127)) goto parse_failure;
        if (unlikely(last_was_punctuation & is_punctuation)) goto parse_failure;
        last_was_punctuation = is_punctuation;
    }
    if (unlikely(last_was_punctuation)) goto parse_failure;
    *buffer = '\0';
    return buffer;
parse_failure:
    return NULL;
}
static double __Pyx__PyUnicode_AsDouble_inf_nan(const void* data, int kind, Py_ssize_t start, Py_ssize_t length) {
    int matches = 1;
    Py_UCS4 chr;
    Py_UCS4 sign = PyUnicode_READ(kind, data, start);
    int is_signed = (sign == '-') | (sign == '+');
    start += is_signed;
    length -= is_signed;
    switch (PyUnicode_READ(kind, data, start)) {
        #ifdef Py_NAN
        case 'n':
        case 'N':
            if (unlikely(length != 3)) goto parse_failure;
            chr = PyUnicode_READ(kind, data, start+1);
            matches &= (chr == 'a') | (chr == 'A');
            chr = PyUnicode_READ(kind, data, start+2);
            matches &= (chr == 'n') | (chr == 'N');
            if (unlikely(!matches)) goto parse_failure;
            return (sign == '-') ? -Py_NAN : Py_NAN;
        #endif
        case 'i':
        case 'I':
            if (unlikely(length < 3)) goto parse_failure;
            chr = PyUnicode_READ(kind, data, start+1);
            matches &= (chr == 'n') | (chr == 'N');
            chr = PyUnicode_READ(kind, data, start+2);
            matches &= (chr == 'f') | (chr == 'F');
            if (likely(length == 3 && matches))
                return (sign == '-') ? -Py_HUGE_VAL : Py_HUGE_VAL;
            if (unlikely(length != 8)) goto parse_failure;
            chr = PyUnicode_READ(kind, data, start+3);
            matches &= (chr == 'i') | (chr == 'I');
            chr = PyUnicode_READ(kind, data, start+4);
            matches &= (chr == 'n') | (chr == 'N');
            chr = PyUnicode_READ(kind, data, start+5);
            matches &= (chr == 'i') | (chr == 'I');
            chr = PyUnicode_READ(kind, data, start+6);
            matches &= (chr == 't') | (chr == 'T');
            chr = PyUnicode_READ(kind, data, start+7);
            matches &= (chr == 'y') | (chr == 'Y');
            if (unlikely(!matches)) goto parse_failure;
            return (sign == '-') ? -Py_HUGE_VAL : Py_HUGE_VAL;
        case '.': case '0': case '1': case '2': case '3': case '4': case '5': case '6': case '7': case '8': case '9':
            break;
        default:
            goto parse_failure;
    }
    return 0.0;
parse_failure:
    return -1.0;
}
static double __Pyx_PyUnicode_AsDouble_WithSpaces(PyObject *obj) {
    double value;
    const char *last;
    char *end;
    Py_ssize_t start, length = PyUnicode_GET_LENGTH(obj);
    const int kind = PyUnicode_KIND(obj);
    const void* data = PyUnicode_DATA(obj);
    start = 0;
    while (Py_UNICODE_ISSPACE(PyUnicode_READ(kind, data, start)))
        start++;
    while (start < length - 1 && Py_UNICODE_ISSPACE(PyUnicode_READ(kind, data, length - 1)))
        length--;
    length -= start;
    if (unlikely(length <= 0)) goto fallback;
    value = __Pyx__PyUnicode_AsDouble_inf_nan(data, kind, start, length);
    if (unlikely(value == -1.0)) goto fallback;
    if (value != 0.0) return value;
    if (length < 40) {
        char number[40];
        last = __Pyx__PyUnicode_AsDouble_Copy(data, kind, number, start, start + length);
        if (unlikely(!last)) goto fallback;
        value = PyOS_string_to_double(number, &end, NULL);
    } else {
        char *number = (char*) PyMem_Malloc((length + 1) * sizeof(char));
        if (unlikely(!number)) goto fallback;
        last = __Pyx__PyUnicode_AsDouble_Copy(data, kind, number, start, start + length);
        if (unlikely(!last)) {
            PyMem_Free(number);
            goto fallback;
        }
        value = PyOS_string_to_double(number, &end, NULL);
        PyMem_Free(number);
    }
    if (likely(end == last) || (value == (double)-1 && PyErr_Occurred())) {
        return value;
    }
fallback:
    return __Pyx_SlowPyString_AsDouble(obj);
}
#endif
static CYTHON_INLINE double __Pyx_PyUnicode_AsDouble(PyObject *obj) {
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY && CYTHON_ASSUME_SAFE_MACROS
    if (unlikely(__Pyx_PyUnicode_READY(obj) == -1))
        return (double)-1;
    if (likely(PyUnicode_IS_ASCII(obj))) {
        const char *s;
        Py_ssize_t length;
        s = PyUnicode_AsUTF8AndSize(obj, &length);
        return __Pyx__PyBytes_AsDouble(obj, s, length);
    }
    return __Pyx_PyUnicode_AsDouble_WithSpaces(obj);
#else
    return __Pyx_SlowPyString_AsDouble(obj);
#endif
}

/* PyIntCompare.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_SubtractCObj(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceSubtract(op1, op2) : PyNumber_Subtract(op1, op2))
#endif

/* SetItemInt.proto */
#define __Pyx_SetItemInt(o, i, v, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
    __Pyx_SetItemInt_Fast(o, (Py_ssize_t)i, v, is_list, wraparound, boundscheck) :\
    (is_list ? (PyErr_SetString(PyExc_IndexError, "list assignment index out of range"), -1) :\
               __Pyx_SetItemInt_Generic(o, to_py_func(i), v)))
static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v);
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v,
                                               int is_list, int wraparound, int boundscheck);

/* PyObjectCallNoArg.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);

/* PyObjectGetMethod.proto */
static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);

/* PyObjectCallMethod0.proto */
static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);

/* RaiseNoneIterError.proto */
static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);

/* UnpackTupleError.proto */
static void __Pyx_UnpackTupleError(PyObject *, Py_ssize_t index);

/* UnpackTuple2.proto */
#define __Pyx_unpack_tuple2(tuple, value1, value2, is_tuple, has_known_size, decref_tuple)\
    (likely(is_tuple || PyTuple_Check(tuple)) ?\
        (likely(has_known_size || PyTuple_GET_SIZE(tuple) == 2) ?\
            __Pyx_unpack_tuple2_exact(tuple, value1, value2, decref_tuple) :\
            (__Pyx_UnpackTupleError(tuple, 2), -1)) :\
        __Pyx_unpack_tuple2_generic(tuple, value1, value2, has_known_size, decref_tuple))
static CYTHON_INLINE int __Pyx_unpack_tuple2_exact(
    PyObject* tuple, PyObject** value1, PyObject** value2, int decref_tuple);
static int __Pyx_unpack_tuple2_generic(
    PyObject* tuple, PyObject** value1, PyObject** value2, int has_known_size, int decref_tuple);

/* dict_iter.proto */
static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* dict, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_is_dict);
static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* dict_or_iter, Py_ssize_t orig_length, Py_ssize_t* ppos,
                                              PyObject** pkey, PyObject** pvalue, PyObject** pitem, int is_dict);

/* IncludeStructmemberH.proto */
#include <structmember.h>

/* FixUpExtensionType.proto */
#if CYTHON_USE_TYPE_SPECS
static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type);
#endif

/* FetchSharedCythonModule.proto */
static PyObject *__Pyx_FetchSharedCythonABIModule(void);

/* FetchCommonType.proto */
#if !CYTHON_USE_TYPE_SPECS
static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
#else
static PyTypeObject* __Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases);
#endif

/* PyMethodNew.proto */
#if CYTHON_COMPILING_IN_LIMITED_API
static PyObject *__Pyx_PyMethod_New(PyObject *func, PyObject *self, PyObject *typ) {
    PyObject *typesModule=NULL, *methodType=NULL, *result=NULL;
    CYTHON_UNUSED_VAR(typ);
    if (!self)
        return __Pyx_NewRef(func);
    typesModule = PyImport_ImportModule("types");
    if (!typesModule) return NULL;
    methodType = PyObject_GetAttrString(typesModule, "MethodType");
    Py_DECREF(typesModule);
    if (!methodType) return NULL;
    result = PyObject_CallFunctionObjArgs(methodType, func, self, NULL);
    Py_DECREF(methodType);
    return result;
}
#elif PY_MAJOR_VERSION >= 3
static PyObject *__Pyx_PyMethod_New(PyObject *func, PyObject *self, PyObject *typ) {
    CYTHON_UNUSED_VAR(typ);
    if (!self)
        return __Pyx_NewRef(func);
    return PyMethod_New(func, self);
}
#else
    #define __Pyx_PyMethod_New PyMethod_New
#endif

/* PyVectorcallFastCallDict.proto */
#if CYTHON_METH_FASTCALL
static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw);
#endif

/* CythonFunctionShared.proto */
#define __Pyx_CyFunction_USED
#define __Pyx_CYFUNCTION_STATICMETHOD  0x01
#define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
#define __Pyx_CYFUNCTION_CCLASS        0x04
#define __Pyx_CYFUNCTION_COROUTINE     0x08
#define __Pyx_CyFunction_GetClosure(f)\
    (((__pyx_CyFunctionObject *) (f))->func_closure)
#if PY_VERSION_HEX < 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
  #define __Pyx_CyFunction_GetClassObj(f)\
      (((__pyx_CyFunctionObject *) (f))->func_classobj)
#else
  #define __Pyx_CyFunction_GetClassObj(f)\
      ((PyObject*) ((PyCMethodObject *) (f))->mm_class)
#endif
#define __Pyx_CyFunction_SetClassObj(f, classobj)\
    __Pyx__CyFunction_SetClassObj((__pyx_CyFunctionObject *) (f), (classobj))
#define __Pyx_CyFunction_Defaults(type, f)\
    ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
#define __Pyx_CyFunction_SetDefaultsGetter(f, g)\
    ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
typedef struct {
#if CYTHON_COMPILING_IN_LIMITED_API
    PyObject_HEAD
    PyObject *func;
#elif PY_VERSION_HEX < 0x030900B1
    PyCFunctionObject func;
#else
    PyCMethodObject func;
#endif
#if CYTHON_BACKPORT_VECTORCALL
    __pyx_vectorcallfunc func_vectorcall;
#endif
#if PY_VERSION_HEX < 0x030500A0 || CYTHON_COMPILING_IN_LIMITED_API
    PyObject *func_weakreflist;
#endif
    PyObject *func_dict;
    PyObject *func_name;
    PyObject *func_qualname;
    PyObject *func_doc;
    PyObject *func_globals;
    PyObject *func_code;
    PyObject *func_closure;
#if PY_VERSION_HEX < 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
    PyObject *func_classobj;
#endif
    void *defaults;
    int defaults_pyobjects;
    size_t defaults_size;
    int flags;
    PyObject *defaults_tuple;
    PyObject *defaults_kwdict;
    PyObject *(*defaults_getter)(PyObject *);
    PyObject *func_annotations;
    PyObject *func_is_coroutine;
} __pyx_CyFunctionObject;
#undef __Pyx_CyOrPyCFunction_Check
#define __Pyx_CyFunction_Check(obj)  __Pyx_TypeCheck(obj, __pyx_CyFunctionType)
#define __Pyx_CyOrPyCFunction_Check(obj)  __Pyx_TypeCheck2(obj, __pyx_CyFunctionType, &PyCFunction_Type)
#define __Pyx_CyFunction_CheckExact(obj)  __Pyx_IS_TYPE(obj, __pyx_CyFunctionType)
static CYTHON_INLINE int __Pyx__IsSameCyOrCFunction(PyObject *func, void *cfunc);
#undef __Pyx_IsSameCFunction
#define __Pyx_IsSameCFunction(func, cfunc)   __Pyx__IsSameCyOrCFunction(func, cfunc)
static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject* op, PyMethodDef *ml,
                                      int flags, PyObject* qualname,
                                      PyObject *closure,
                                      PyObject *module, PyObject *globals,
                                      PyObject* code);
static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj);
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
                                                         size_t size,
                                                         int pyobjects);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
                                                            PyObject *tuple);
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
                                                             PyObject *dict);
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
                                                              PyObject *dict);
static int __pyx_CyFunction_init(PyObject *module);
#if CYTHON_METH_FASTCALL
static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
#if CYTHON_BACKPORT_VECTORCALL
#define __Pyx_CyFunction_func_vectorcall(f) (((__pyx_CyFunctionObject*)f)->func_vectorcall)
#else
#define __Pyx_CyFunction_func_vectorcall(f) (((PyCFunctionObject*)f)->vectorcall)
#endif
#endif

/* CythonFunction.proto */
static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml,
                                      int flags, PyObject* qualname,
                                      PyObject *closure,
                                      PyObject *module, PyObject *globals,
                                      PyObject* code);

/* Import.proto */
static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);

/* ImportFrom.proto */
static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name);

/* ListExtend.proto */
static CYTHON_INLINE int __Pyx_PyList_Extend(PyObject* L, PyObject* v) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030d0000
    PyObject* none = _PyList_Extend((PyListObject*)L, v);
    if (unlikely(!none))
        return -1;
    Py_DECREF(none);
    return 0;
#else
    return PyList_SetSlice(L, PY_SSIZE_T_MAX, PY_SSIZE_T_MAX, v);
#endif
}

/* PyObject_Str.proto */
#define __Pyx_PyObject_Str(obj)\
    (likely(PyString_CheckExact(obj)) ? __Pyx_NewRef(obj) : PyObject_Str(obj))

/* GetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
#endif

/* pep479.proto */
static void __Pyx_Generator_Replace_StopIteration(int in_async_gen);

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_FloorDivideObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_FloorDivideObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceFloorDivide(op1, op2) : PyNumber_FloorDivide(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_MultiplyCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_MultiplyCObj(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceMultiply(op1, op2) : PyNumber_Multiply(op1, op2))
#endif

/* pynumber_float.proto */
static CYTHON_INLINE PyObject* __Pyx__PyNumber_Float(PyObject* obj);
#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : __Pyx__PyNumber_Float(x))

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_SubtractObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceSubtract(op1, op2) : PyNumber_Subtract(op1, op2))
#endif

/* pyfrozenset_new.proto */
static CYTHON_INLINE PyObject* __Pyx_PyFrozenSet_New(PyObject* it);

/* PySetContains.proto */
static CYTHON_INLINE int __Pyx_PySet_ContainsTF(PyObject* key, PyObject* set, int eq);

/* PyIntCompare.proto */
static CYTHON_INLINE int __Pyx_PyInt_BoolNeObjC(PyObject *op1, PyObject *op2, long intval, long inplace);

/* UnicodeConcatInPlace.proto */
# if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
    #if CYTHON_REFNANNY
        #define __Pyx_PyUnicode_ConcatInPlace(left, right) __Pyx_PyUnicode_ConcatInPlaceImpl(&left, right, __pyx_refnanny)
    #else
        #define __Pyx_PyUnicode_ConcatInPlace(left, right) __Pyx_PyUnicode_ConcatInPlaceImpl(&left, right)
    #endif
    static CYTHON_INLINE PyObject *__Pyx_PyUnicode_ConcatInPlaceImpl(PyObject **p_left, PyObject *right
        #if CYTHON_REFNANNY
        , void* __pyx_refnanny
        #endif
    );
#else
#define __Pyx_PyUnicode_ConcatInPlace __Pyx_PyUnicode_Concat
#endif
#define __Pyx_PyUnicode_ConcatInPlaceSafe(left, right) ((unlikely((left) == Py_None) || unlikely((right) == Py_None)) ?\
    PyNumber_InPlaceAdd(left, right) : __Pyx_PyUnicode_ConcatInPlace(left, right))

/* GetTopmostException.proto */
#if CYTHON_USE_EXC_INFO_STACK && CYTHON_FAST_THREAD_STATE
static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
#endif

/* SaveResetException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
#else
#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
#endif

/* GCCDiagnostics.proto */
#if !defined(__INTEL_COMPILER) && defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
#define __Pyx_HAS_GCC_DIAGNOSTIC
#endif

/* BuildPyUnicode.proto */
static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
                                                int prepend_sign, char padding_char);

/* CIntToPyUnicode.proto */
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_Py_ssize_t(Py_ssize_t value, Py_ssize_t width, char padding_char, char format_char);

/* RaiseClosureNameError.proto */
static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);

/* PyObjectLookupSpecial.proto */
#if CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
#define __Pyx_PyObject_LookupSpecialNoError(obj, attr_name)  __Pyx__PyObject_LookupSpecial(obj, attr_name, 0)
#define __Pyx_PyObject_LookupSpecial(obj, attr_name)  __Pyx__PyObject_LookupSpecial(obj, attr_name, 1)
static CYTHON_INLINE PyObject* __Pyx__PyObject_LookupSpecial(PyObject* obj, PyObject* attr_name, int with_error);
#else
#define __Pyx_PyObject_LookupSpecialNoError(o,n) __Pyx_PyObject_GetAttrStrNoError(o,n)
#define __Pyx_PyObject_LookupSpecial(o,n) __Pyx_PyObject_GetAttrStr(o,n)
#endif

/* pyobject_as_double.proto */
static double __Pyx__PyObject_AsDouble(PyObject* obj);
#if CYTHON_COMPILING_IN_PYPY
#define __Pyx_PyObject_AsDouble(obj)\
(likely(PyFloat_CheckExact(obj)) ? PyFloat_AS_DOUBLE(obj) :\
 likely(PyInt_CheckExact(obj)) ?\
 PyFloat_AsDouble(obj) : __Pyx__PyObject_AsDouble(obj))
#else
#define __Pyx_PyObject_AsDouble(obj)\
((likely(PyFloat_CheckExact(obj))) ?  PyFloat_AS_DOUBLE(obj) :\
 likely(PyLong_CheckExact(obj)) ?\
 PyLong_AsDouble(obj) : __Pyx__PyObject_AsDouble(obj))
#endif

/* UnpackUnboundCMethod.proto */
typedef struct {
    PyObject *type;
    PyObject **method_name;
    PyCFunction func;
    PyObject *method;
    int flag;
} __Pyx_CachedCFunction;

/* CallUnboundCMethod1.proto */
static PyObject* __Pyx__CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg);
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg);
#else
#define __Pyx_CallUnboundCMethod1(cfunc, self, arg)  __Pyx__CallUnboundCMethod1(cfunc, self, arg)
#endif

/* PyFloatBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyFloat_TrueDivideCObj(PyObject *op1, PyObject *op2, double floatval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyFloat_TrueDivideCObj(op1, op2, floatval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceTrueDivide(op1, op2) : PyNumber_TrueDivide(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_RemainderObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_RemainderObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceRemainder(op1, op2) : PyNumber_Remainder(op1, op2))
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_MultiplyObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_MultiplyObjC(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceMultiply(op1, op2) : PyNumber_Multiply(op1, op2))
#endif

/* SliceTupleAndList.proto */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyList_GetSlice(PyObject* src, Py_ssize_t start, Py_ssize_t stop);
static CYTHON_INLINE PyObject* __Pyx_PyTuple_GetSlice(PyObject* src, Py_ssize_t start, Py_ssize_t stop);
#else
#define __Pyx_PyList_GetSlice(seq, start, stop)   PySequence_GetSlice(seq, start, stop)
#define __Pyx_PyTuple_GetSlice(seq, start, stop)  PySequence_GetSlice(seq, start, stop)
#endif

/* MergeKeywords.proto */
static int __Pyx_MergeKeywords(PyObject *kwdict, PyObject *source_mapping);

/* PyUnicode_Unicode.proto */
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_Unicode(PyObject *obj);

/* CallUnboundCMethod0.proto */
static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self);
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_CallUnboundCMethod0(cfunc, self)\
    (likely((cfunc)->func) ?\
        (likely((cfunc)->flag == METH_NOARGS) ?  (*((cfunc)->func))(self, NULL) :\
         (PY_VERSION_HEX >= 0x030600B1 && likely((cfunc)->flag == METH_FASTCALL) ?\
            (PY_VERSION_HEX >= 0x030700A0 ?\
                (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0) :\
                (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0, NULL)) :\
          (PY_VERSION_HEX >= 0x030700A0 && (cfunc)->flag == (METH_FASTCALL | METH_KEYWORDS) ?\
            (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0, NULL) :\
            (likely((cfunc)->flag == (METH_VARARGS | METH_KEYWORDS)) ?  ((*(PyCFunctionWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, __pyx_empty_tuple, NULL)) :\
               ((cfunc)->flag == METH_VARARGS ?  (*((cfunc)->func))(self, __pyx_empty_tuple) :\
               __Pyx__CallUnboundCMethod0(cfunc, self)))))) :\
        __Pyx__CallUnboundCMethod0(cfunc, self))
#else
#define __Pyx_CallUnboundCMethod0(cfunc, self)  __Pyx__CallUnboundCMethod0(cfunc, self)
#endif

/* py_abs.proto */
#if CYTHON_USE_PYLONG_INTERNALS
static PyObject *__Pyx_PyLong_AbsNeg(PyObject *num);
#define __Pyx_PyNumber_Absolute(x)\
    ((likely(PyLong_CheckExact(x))) ?\
         (likely(__Pyx_PyLong_IsNonNeg(x)) ? (Py_INCREF(x), (x)) : __Pyx_PyLong_AbsNeg(x)) :\
         PyNumber_Absolute(x))
#else
#define __Pyx_PyNumber_Absolute(x)  PyNumber_Absolute(x)
#endif

/* PyIntBinop.proto */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
#else
#define __Pyx_PyInt_AddCObj(op1, op2, intval, inplace, zerodivision_check)\
    (inplace ? PyNumber_InPlaceAdd(op1, op2) : PyNumber_Add(op1, op2))
#endif

/* ValidateBasesTuple.proto */
#if CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_LIMITED_API || CYTHON_USE_TYPE_SPECS
static int __Pyx_validate_bases_tuple(const char *type_name, Py_ssize_t dictoffset, PyObject *bases);
#endif

/* PyType_Ready.proto */
CYTHON_UNUSED static int __Pyx_PyType_Ready(PyTypeObject *t);

/* PyObject_GenericGetAttrNoDict.proto */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name);
#else
#define __Pyx_PyObject_GenericGetAttrNoDict PyObject_GenericGetAttr
#endif

/* ImportDottedModule.proto */
static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple);
#if PY_MAJOR_VERSION >= 3
static PyObject *__Pyx_ImportDottedModule_WalkParts(PyObject *module, PyObject *name, PyObject *parts_tuple);
#endif

/* PatchModuleWithCoroutine.proto */
static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code);

/* PatchInspect.proto */
static PyObject* __Pyx_patch_inspect(PyObject* module);

/* CLineInTraceback.proto */
#ifdef CYTHON_CLINE_IN_TRACEBACK
#define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
#else
static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
#endif

/* CodeObjectCache.proto */
#if !CYTHON_COMPILING_IN_LIMITED_API
typedef struct {
    PyCodeObject* code_object;
    int code_line;
} __Pyx_CodeObjectCacheEntry;
struct __Pyx_CodeObjectCache {
    int count;
    int max_count;
    __Pyx_CodeObjectCacheEntry* entries;
};
static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
static PyCodeObject *__pyx_find_code_object(int code_line);
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
#endif

/* AddTraceback.proto */
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename);

/* CIntToPy.proto */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);

/* FormatTypeName.proto */
#if CYTHON_COMPILING_IN_LIMITED_API
typedef PyObject *__Pyx_TypeName;
#define __Pyx_FMT_TYPENAME "%U"
static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
#define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
#else
typedef const char *__Pyx_TypeName;
#define __Pyx_FMT_TYPENAME "%.200s"
#define __Pyx_PyType_GetName(tp) ((tp)->tp_name)
#define __Pyx_DECREF_TypeName(obj)
#endif

/* CIntFromPy.proto */
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);

/* CIntFromPy.proto */
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);

/* FastTypeChecks.proto */
#if CYTHON_COMPILING_IN_CPYTHON
#define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
#define __Pyx_TypeCheck2(obj, type1, type2) __Pyx_IsAnySubtype2(Py_TYPE(obj), (PyTypeObject *)type1, (PyTypeObject *)type2)
static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b);
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
#else
#define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
#define __Pyx_TypeCheck2(obj, type1, type2) (PyObject_TypeCheck(obj, (PyTypeObject *)type1) || PyObject_TypeCheck(obj, (PyTypeObject *)type2))
#define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
#define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
#endif
#define __Pyx_PyErr_ExceptionMatches2(err1, err2)  __Pyx_PyErr_GivenExceptionMatches2(__Pyx_PyErr_CurrentExceptionType(), err1, err2)
#define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)

/* SwapException.proto */
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
#else
static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
#endif

/* PyObjectCall2Args.proto */
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);

/* PyObjectCallMethod1.proto */
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);

/* CoroutineBase.proto */
struct __pyx_CoroutineObject;
typedef PyObject *(*__pyx_coroutine_body_t)(struct __pyx_CoroutineObject *, PyThreadState *, PyObject *);
#if CYTHON_USE_EXC_INFO_STACK
#define __Pyx_ExcInfoStruct  _PyErr_StackItem
#else
typedef struct {
    PyObject *exc_type;
    PyObject *exc_value;
    PyObject *exc_traceback;
} __Pyx_ExcInfoStruct;
#endif
typedef struct __pyx_CoroutineObject {
    PyObject_HEAD
    __pyx_coroutine_body_t body;
    PyObject *closure;
    __Pyx_ExcInfoStruct gi_exc_state;
    PyObject *gi_weakreflist;
    PyObject *classobj;
    PyObject *yieldfrom;
    PyObject *gi_name;
    PyObject *gi_qualname;
    PyObject *gi_modulename;
    PyObject *gi_code;
    PyObject *gi_frame;
    int resume_label;
    char is_running;
} __pyx_CoroutineObject;
static __pyx_CoroutineObject *__Pyx__Coroutine_New(
    PyTypeObject *type, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
    PyObject *name, PyObject *qualname, PyObject *module_name);
static __pyx_CoroutineObject *__Pyx__Coroutine_NewInit(
            __pyx_CoroutineObject *gen, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
            PyObject *name, PyObject *qualname, PyObject *module_name);
static CYTHON_INLINE void __Pyx_Coroutine_ExceptionClear(__Pyx_ExcInfoStruct *self);
static int __Pyx_Coroutine_clear(PyObject *self);
static PyObject *__Pyx_Coroutine_Send(PyObject *self, PyObject *value);
static PyObject *__Pyx_Coroutine_Close(PyObject *self);
static PyObject *__Pyx_Coroutine_Throw(PyObject *gen, PyObject *args);
#if CYTHON_USE_EXC_INFO_STACK
#define __Pyx_Coroutine_SwapException(self)
#define __Pyx_Coroutine_ResetAndClearException(self)  __Pyx_Coroutine_ExceptionClear(&(self)->gi_exc_state)
#else
#define __Pyx_Coroutine_SwapException(self) {\
    __Pyx_ExceptionSwap(&(self)->gi_exc_state.exc_type, &(self)->gi_exc_state.exc_value, &(self)->gi_exc_state.exc_traceback);\
    __Pyx_Coroutine_ResetFrameBackpointer(&(self)->gi_exc_state);\
    }
#define __Pyx_Coroutine_ResetAndClearException(self) {\
    __Pyx_ExceptionReset((self)->gi_exc_state.exc_type, (self)->gi_exc_state.exc_value, (self)->gi_exc_state.exc_traceback);\
    (self)->gi_exc_state.exc_type = (self)->gi_exc_state.exc_value = (self)->gi_exc_state.exc_traceback = NULL;\
    }
#endif
#if CYTHON_FAST_THREAD_STATE
#define __Pyx_PyGen_FetchStopIterationValue(pvalue)\
    __Pyx_PyGen__FetchStopIterationValue(__pyx_tstate, pvalue)
#else
#define __Pyx_PyGen_FetchStopIterationValue(pvalue)\
    __Pyx_PyGen__FetchStopIterationValue(__Pyx_PyThreadState_Current, pvalue)
#endif
static int __Pyx_PyGen__FetchStopIterationValue(PyThreadState *tstate, PyObject **pvalue);
static CYTHON_INLINE void __Pyx_Coroutine_ResetFrameBackpointer(__Pyx_ExcInfoStruct *exc_state);

/* PatchGeneratorABC.proto */
static int __Pyx_patch_abc(void);

/* Generator.proto */
#define __Pyx_Generator_USED
#define __Pyx_Generator_CheckExact(obj) __Pyx_IS_TYPE(obj, __pyx_GeneratorType)
#define __Pyx_Generator_New(body, code, closure, name, qualname, module_name)\
    __Pyx__Coroutine_New(__pyx_GeneratorType, body, code, closure, name, qualname, module_name)
static PyObject *__Pyx_Generator_Next(PyObject *self);
static int __pyx_Generator_init(PyObject *module);

/* CheckBinaryVersion.proto */
static unsigned long __Pyx_get_runtime_version(void);
static int __Pyx_check_binary_version(unsigned long ct_version, unsigned long rt_version, int allow_newer);

/* InitStrings.proto */
static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);

/* #### Code section: module_declarations ### */

/* Module declarations from "gofast.tools.mathex" */
/* #### Code section: typeinfo ### */
/* #### Code section: before_global_var ### */
#define __Pyx_MODULE_NAME "gofast.tools.mathex"
extern int __pyx_module_is_main_gofast__tools__mathex;
int __pyx_module_is_main_gofast__tools__mathex = 0;

/* Implementation of "gofast.tools.mathex" */
/* #### Code section: global_var ### */
static PyObject *__pyx_builtin_TypeError;
static PyObject *__pyx_builtin_ValueError;
static PyObject *__pyx_builtin_range;
static PyObject *__pyx_builtin_enumerate;
static PyObject *__pyx_builtin_map;
static PyObject *__pyx_builtin_zip;
static PyObject *__pyx_builtin_max;
static PyObject *__pyx_builtin_print;
static PyObject *__pyx_builtin_RuntimeWarning;
/* #### Code section: string_decls ### */
static const char __pyx_k_A[] = "A";
static const char __pyx_k_F[] = "_F";
static const char __pyx_k_N[] = "N";
static const char __pyx_k_S[] = "S";
static const char __pyx_k_T[] = "_T";
static const char __pyx_k_W[] = "W";
static const char __pyx_k_X[] = "X";
static const char __pyx_k_Z[] = "Z";
static const char __pyx_k_a[] = "a";
static const char __pyx_k_b[] = "b";
static const char __pyx_k_c[] = "c";
static const char __pyx_k_d[] = "d";
static const char __pyx_k_i[] = "i";
static const char __pyx_k_j[] = "j";
static const char __pyx_k_k[] = "k";
static const char __pyx_k_m[] = "m";
static const char __pyx_k_n[] = "n";
static const char __pyx_k_o[] = "o";
static const char __pyx_k_p[] = "p";
static const char __pyx_k_r[] = "r-";
static const char __pyx_k_s[] = "s";
static const char __pyx_k_v[] = "v";
static const char __pyx_k_w[] = "w";
static const char __pyx_k_x[] = "x";
static const char __pyx_k_y[] = "y";
static const char __pyx_k_z[] = "z";
static const char __pyx_k_FN[] = "FN";
static const char __pyx_k_FP[] = "FP";
static const char __pyx_k_ID[] = "ID_";
static const char __pyx_k_SP[] = "_SP";
static const char __pyx_k_TN[] = "TN";
static const char __pyx_k_TP[] = "TP";
static const char __pyx_k_Un[] = "Un";
static const char __pyx_k__2[] = "'";
static const char __pyx_k_ar[] = "ar";
static const char __pyx_k_ax[] = "ax";
static const char __pyx_k_ck[] = "ck";
static const char __pyx_k_cm[] = "cm";
static const char __pyx_k_df[] = "df";
static const char __pyx_k_dl[] = "dl";
static const char __pyx_k_dp[] = "dp";
static const char __pyx_k_dx[] = "dx";
static const char __pyx_k_dy[] = "dy";
static const char __pyx_k_gc[] = "gc";
static const char __pyx_k_ii[] = "ii";
static const char __pyx_k_iv[] = "iv";
static const char __pyx_k_km[] = "km";
static const char __pyx_k_le[] = "le";
static const char __pyx_k_ll[] = "ll";
static const char __pyx_k_lr[] = "lr";
static const char __pyx_k_np[] = "np";
static const char __pyx_k_ob[] = "ob-";
static const char __pyx_k_ok[] = "ok-";
static const char __pyx_k_or[] = "or";
static const char __pyx_k_pd[] = "pd";
static const char __pyx_k_pi[] = "pi";
static const char __pyx_k_pk[] = "pk";
static const char __pyx_k_rr[] = "rr";
static const char __pyx_k_se[] = "se";
static const char __pyx_k_ta[] = "ta";
static const char __pyx_k_wf[] = "wf";
static const char __pyx_k_xs[] = "xs";
static const char __pyx_k_xx[] = "xx";
static const char __pyx_k_ya[] = "ya";
static const char __pyx_k_ys[] = "ys";
static const char __pyx_k_yt[] = "yt";
static const char __pyx_k_yy[] = "yy";
static const char __pyx_k_49R[] = "49R";
static const char __pyx_k_F_m[] = "F_m";
static const char __pyx_k__31[] = " ";
static const char __pyx_k__39[] = ".";
static const char __pyx_k__65[] = "";
static const char __pyx_k__70[] = "*";
static const char __pyx_k__88[] = "-";
static const char __pyx_k_abs[] = "abs";
static const char __pyx_k_all[] = "all";
static const char __pyx_k_ama[] = "ama";
static const char __pyx_k_any[] = "any";
static const char __pyx_k_arr[] = "arr";
static const char __pyx_k_b_2[] = "b-";
static const char __pyx_k_cls[] = "cls";
static const char __pyx_k_cma[] = "cma";
static const char __pyx_k_col[] = "col";
static const char __pyx_k_cos[] = "cos";
static const char __pyx_k_cov[] = "cov";
static const char __pyx_k_deg[] = "deg";
static const char __pyx_k_doc[] = "__doc__";
static const char __pyx_k_dot[] = "dot";
static const char __pyx_k_ema[] = "ema";
static const char __pyx_k_end[] = "end";
static const char __pyx_k_err[] = "err";
static const char __pyx_k_exp[] = "exp";
static const char __pyx_k_fig[] = "fig";
static const char __pyx_k_fit[] = "fit";
static const char __pyx_k_fpr[] = "fpr";
static const char __pyx_k_get[] = "get";
static const char __pyx_k_idx[] = "idx";
static const char __pyx_k_inf[] = "inf";
static const char __pyx_k_int[] = "int";
static const char __pyx_k_inv[] = "inv";
static const char __pyx_k_iqr[] = "iqr";
static const char __pyx_k_key[] = "key";
static const char __pyx_k_kws[] = "kws";
static const char __pyx_k_log[] = "log";
static const char __pyx_k_map[] = "map";
static const char __pyx_k_max[] = "max";
static const char __pyx_k_min[] = "min";
static const char __pyx_k_msg[] = "msg";
static const char __pyx_k_mu0[] = "mu0";
static const char __pyx_k_nan[] = "nan";
static const char __pyx_k_ovo[] = "ovo";
static const char __pyx_k_ovr[] = "ovr";
static const char __pyx_k_plt[] = "plt";
static const char __pyx_k_pos[] = "pos";
static const char __pyx_k_rem[] = "rem";
static const char __pyx_k_rho[] = "rho";
static const char __pyx_k_rng[] = "rng";
static const char __pyx_k_row[] = "row";
static const char __pyx_k_shp[] = "shp";
static const char __pyx_k_sin[] = "sin";
static const char __pyx_k_sma[] = "sma";
static const char __pyx_k_std[] = "std";
static const char __pyx_k_str[] = "str";
static const char __pyx_k_sum[] = "sum";
static const char __pyx_k_tol[] = "tol";
static const char __pyx_k_tpr[] = "tpr";
static const char __pyx_k_use[] = "use";
static const char __pyx_k_utm[] = "utm";
static const char __pyx_k_var[] = "var";
static const char __pyx_k_wma[] = "wma";
static const char __pyx_k_zip[] = "zip";
static const char __pyx_k_C_FN[] = "C_FN";
static const char __pyx_k_C_FP[] = "C_FP";
static const char __pyx_k_Dict[] = "Dict";
static const char __pyx_k_List[] = "List";
static const char __pyx_k_None[] = "None";
static const char __pyx_k__107[] = ". ";
static const char __pyx_k__177[] = "_";
static const char __pyx_k__240[] = "?";
static const char __pyx_k_args[] = "args";
static const char __pyx_k_auto[] = "auto";
static const char __pyx_k_axis[] = "axis";
static const char __pyx_k_azim[] = "azim";
static const char __pyx_k_base[] = "base";
static const char __pyx_k_beta[] = "beta";
static const char __pyx_k_bias[] = "bias";
static const char __pyx_k_bins[] = "bins";
static const char __pyx_k_bool[] = "bool";
static const char __pyx_k_call[] = "__call__";
static const char __pyx_k_ceil[] = "ceil";
static const char __pyx_k_cls1[] = "cls1";
static const char __pyx_k_cls2[] = "cls2";
static const char __pyx_k_coef[] = "coef";
static const char __pyx_k_conv[] = "conv";
static const char __pyx_k_copy[] = "copy";
static const char __pyx_k_corr[] = "corr";
static const char __pyx_k_cval[] = "cval";
static const char __pyx_k_data[] = "data";
static const char __pyx_k_ddof[] = "ddof";
static const char __pyx_k_deep[] = "deep";
static const char __pyx_k_diag[] = "diag";
static const char __pyx_k_diff[] = "diff";
static const char __pyx_k_drop[] = "drop";
static const char __pyx_k_exit[] = "__exit__";
static const char __pyx_k_find[] = "find";
static const char __pyx_k_func[] = "func";
static const char __pyx_k_iloc[] = "iloc";
static const char __pyx_k_isin[] = "isin";
static const char __pyx_k_ix_c[] = "ix_c";
static const char __pyx_k_kind[] = "kind";
static const char __pyx_k_lat1[] = "lat1";
static const char __pyx_k_lat2[] = "lat2";
static const char __pyx_k_less[] = "less";
static const char __pyx_k_log2[] = "log2";
static const char __pyx_k_lon1[] = "lon1";
static const char __pyx_k_lon2[] = "lon2";
static const char __pyx_k_main[] = "__main__";
static const char __pyx_k_mean[] = "mean";
static const char __pyx_k_mode[] = "mode";
static const char __pyx_k_name[] = "__name__";
static const char __pyx_k_ndim[] = "ndim";
static const char __pyx_k_none[] = "none";
static const char __pyx_k_norm[] = "norm";
static const char __pyx_k_ok_2[] = "ok";
static const char __pyx_k_omit[] = "omit";
static const char __pyx_k_ones[] = "ones";
static const char __pyx_k_or_2[] = "or:";
static const char __pyx_k_pair[] = "pair";
static const char __pyx_k_pcov[] = "pcov";
static const char __pyx_k_plot[] = "plot";
static const char __pyx_k_poly[] = "poly";
static const char __pyx_k_popt[] = "popt";
static const char __pyx_k_rate[] = "rate_";
static const char __pyx_k_same[] = "same";
static const char __pyx_k_seen[] = "seen";
static const char __pyx_k_send[] = "send";
static const char __pyx_k_show[] = "show";
static const char __pyx_k_site[] = "site";
static const char __pyx_k_size[] = "size";
static const char __pyx_k_soft[] = "soft";
static const char __pyx_k_spec[] = "__spec__";
static const char __pyx_k_sqrt[] = "sqrt";
static const char __pyx_k_step[] = "step";
static const char __pyx_k_stop[] = "stop";
static const char __pyx_k_test[] = "__test__";
static const char __pyx_k_unit[] = "unit";
static const char __pyx_k_view[] = "view";
static const char __pyx_k_warn[] = "warn";
static const char __pyx_k_wrap[] = "wrap";
static const char __pyx_k_xlon[] = "xlon";
static const char __pyx_k_ylat[] = "ylat";
static const char __pyx_k_ymxs[] = "ymxs";
static const char __pyx_k_Array[] = "Array";
static const char __pyx_k_Count[] = "Count";
static const char __pyx_k_Tuple[] = "Tuple";
static const char __pyx_k_Union[] = "Union";
static const char __pyx_k_X_max[] = "X_max";
static const char __pyx_k_X_min[] = "X_min";
static const char __pyx_k_X_std[] = "X_std";
static const char __pyx_k_Xdata[] = "Xdata";
static const char __pyx_k_all_2[] = "__all__";
static const char __pyx_k_alpha[] = "alpha";
static const char __pyx_k_array[] = "__array__";
static const char __pyx_k_close[] = "close";
static const char __pyx_k_costs[] = "costs";
static const char __pyx_k_count[] = "count";
static const char __pyx_k_delta[] = "delta";
static const char __pyx_k_dense[] = "dense";
static const char __pyx_k_deriv[] = "deriv";
static const char __pyx_k_dtype[] = "dtype";
static const char __pyx_k_empty[] = "empty";
static const char __pyx_k_enter[] = "__enter__";
static const char __pyx_k_error[] = "error";
static const char __pyx_k_float[] = "float";
static const char __pyx_k_from0[] = "from0";
static const char __pyx_k_group[] = "group";
static const char __pyx_k_index[] = "index";
static const char __pyx_k_int32[] = "int32";
static const char __pyx_k_isdeg[] = "isdeg";
static const char __pyx_k_isnan[] = "isnan";
static const char __pyx_k_items[] = "items";
static const char __pyx_k_label[] = "label";
static const char __pyx_k_log10[] = "log10";
static const char __pyx_k_lower[] = "lower";
static const char __pyx_k_lstsq[] = "lstsq";
static const char __pyx_k_macro[] = "macro";
static const char __pyx_k_micro[] = "micro";
static const char __pyx_k_noise[] = "noise";
static const char __pyx_k_numpy[] = "numpy";
static const char __pyx_k_order[] = "order";
static const char __pyx_k_pdist[] = "pdist";
static const char __pyx_k_power[] = "power";
static const char __pyx_k_print[] = "print";
static const char __pyx_k_raise[] = "raise";
static const char __pyx_k_randn[] = "randn";
static const char __pyx_k_range[] = "range";
static const char __pyx_k_ranks[] = "ranks";
static const char __pyx_k_ravel[] = "ravel";
static const char __pyx_k_scipy[] = "scipy";
static const char __pyx_k_score[] = "score";
static const char __pyx_k_shape[] = "shape";
static const char __pyx_k_shift[] = "shift";
static const char __pyx_k_start[] = "start";
static const char __pyx_k_state[] = "state";
static const char __pyx_k_stats[] = "stats";
static const char __pyx_k_strip[] = "strip";
static const char __pyx_k_stump[] = "stump";
static const char __pyx_k_throw[] = "throw";
static const char __pyx_k_title[] = "title";
static const char __pyx_k_total[] = "total";
static const char __pyx_k_value[] = "value";
static const char __pyx_k_where[] = "where";
static const char __pyx_k_xdata[] = "xdata";
static const char __pyx_k_y_bin[] = "y_bin";
static const char __pyx_k_y_max[] = "y_max";
static const char __pyx_k_y_min[] = "y_min";
static const char __pyx_k_y_std[] = "y_std";
static const char __pyx_k_ydata[] = "ydata";
static const char __pyx_k_yield[] = "yield_";
static const char __pyx_k_zeros[] = "zeros";
static const char __pyx_k_0A4CEE[] = "#0A4CEE";
static const char __pyx_k_Expect[] = "'. Expect ";
static const char __pyx_k_KeyBox[] = "KeyBox";
static const char __pyx_k_Series[] = "Series";
static const char __pyx_k_Step_m[] = "Step (m)";
static const char __pyx_k_X_mean[] = "X_mean";
static const char __pyx_k_X_norm[] = "X_norm";
static const char __pyx_k_action[] = "action";
static const char __pyx_k_actual[] = "actual";
static const char __pyx_k_amount[] = "amount";
static const char __pyx_k_append[] = "append";
static const char __pyx_k_arange[] = "arange";
static const char __pyx_k_arctan[] = "arctan";
static const char __pyx_k_argmax[] = "argmax";
static const char __pyx_k_argmin[] = "argmin";
static const char __pyx_k_around[] = "around";
static const char __pyx_k_assign[] = "assign";
static const char __pyx_k_astype[] = "astype";
static const char __pyx_k_binary[] = "binary";
static const char __pyx_k_bounds[] = "bounds";
static const char __pyx_k_buffer[] = "buffer";
static const char __pyx_k_change[] = "change";
static const char __pyx_k_coeffs[] = "coeffs";
static const char __pyx_k_column[] = "column";
static const char __pyx_k_concat[] = "concat";
static const char __pyx_k_counts[] = "counts";
static const char __pyx_k_cumsum[] = "cumsum";
static const char __pyx_k_data_2[] = "data_";
static const char __pyx_k_degree[] = "degree";
static const char __pyx_k_delete[] = "delete";
static const char __pyx_k_depvar[] = "depvar";
static const char __pyx_k_design[] = "design";
static const char __pyx_k_dipole[] = "dipole";
static const char __pyx_k_effort[] = "effort";
static const char __pyx_k_enable[] = "enable";
static const char __pyx_k_format[] = "format";
static const char __pyx_k_hstack[] = "hstack";
static const char __pyx_k_ignore[] = "ignore";
static const char __pyx_k_import[] = "__import__";
static const char __pyx_k_in_bin[] = "in_bin";
static const char __pyx_k_interp[] = "interp";
static const char __pyx_k_is_utm[] = "is_utm";
static const char __pyx_k_isnull[] = "isnull";
static const char __pyx_k_isreal[] = "isreal";
static const char __pyx_k_labels[] = "labels";
static const char __pyx_k_legend[] = "legend";
static const char __pyx_k_linalg[] = "linalg";
static const char __pyx_k_linear[] = "linear";
static const char __pyx_k_logger[] = "_logger";
static const char __pyx_k_logify[] = "logify";
static const char __pyx_k_marker[] = "marker";
static const char __pyx_k_max_lr[] = "max_lr";
static const char __pyx_k_method[] = "method";
static const char __pyx_k_metric[] = "metric";
static const char __pyx_k_mirror[] = "mirror";
static const char __pyx_k_name_2[] = "name";
static const char __pyx_k_nansum[] = "nansum";
static const char __pyx_k_number[] = "number";
static const char __pyx_k_pandas[] = "pandas";
static const char __pyx_k_parent[] = "parent";
static const char __pyx_k_pyplot[] = "pyplot";
static const char __pyx_k_raises[] = "raises";
static const char __pyx_k_random[] = "random";
static const char __pyx_k_reject[] = "reject";
static const char __pyx_k_result[] = "result";
static const char __pyx_k_return[] = "return";
static const char __pyx_k_robust[] = "robust";
static const char __pyx_k_scaled[] = "scaled";
static const char __pyx_k_scores[] = "scores";
static const char __pyx_k_simple[] = "simple";
static const char __pyx_k_sorter[] = "sorter";
static const char __pyx_k_source[] = "source";
static const char __pyx_k_strict[] = "strict";
static const char __pyx_k_subset[] = "subset";
static const char __pyx_k_target[] = "target";
static const char __pyx_k_to_deg[] = "to_deg";
static const char __pyx_k_tolist[] = "tolist";
static const char __pyx_k_unique[] = "unique";
static const char __pyx_k_values[] = "values";
static const char __pyx_k_vstack[] = "vstack";
static const char __pyx_k_weight[] = "weight";
static const char __pyx_k_x_edge[] = "x_edge";
static const char __pyx_k_xlabel[] = "xlabel";
static const char __pyx_k_y_edge[] = "y_edge";
static const char __pyx_k_y_mean[] = "y_mean";
static const char __pyx_k_y_norm[] = "y_norm";
static const char __pyx_k_y_pred[] = "y_pred";
static const char __pyx_k_y_true[] = "y_true";
static const char __pyx_k_ylabel[] = "ylabel";
static const char __pyx_k_NDArray[] = "NDArray";
static const char __pyx_k_Station[] = "Station ";
static const char __pyx_k_api_box[] = "api.box";
static const char __pyx_k_arctan2[] = "arctan2";
static const char __pyx_k_argsort[] = "argsort";
static const char __pyx_k_array_2[] = "array";
static const char __pyx_k_asarray[] = "asarray";
static const char __pyx_k_average[] = "average";
static const char __pyx_k_binning[] = "binning";
static const char __pyx_k_c_order[] = "c_order";
static const char __pyx_k_check_y[] = "check_y";
static const char __pyx_k_classes[] = "classes";
static const char __pyx_k_columns[] = "columns";
static const char __pyx_k_condens[] = "condens";
static const char __pyx_k_default[] = "default";
static const char __pyx_k_deg2rad[] = "deg2rad";
static const char __pyx_k_df_full[] = "df_full";
static const char __pyx_k_df_only[] = "df_only";
static const char __pyx_k_disable[] = "disable";
static const char __pyx_k_easting[] = "easting";
static const char __pyx_k_epsilon[] = "epsilon";
static const char __pyx_k_err_msg[] = "err_msg";
static const char __pyx_k_figsize[] = "figsize";
static const char __pyx_k_float32[] = "float32";
static const char __pyx_k_float64[] = "float64";
static const char __pyx_k_genexpr[] = "genexpr";
static const char __pyx_k_groupby[] = "groupby";
static const char __pyx_k_halflen[] = "halflen";
static const char __pyx_k_inspect[] = "inspect";
static const char __pyx_k_isdigit[] = "isdigit";
static const char __pyx_k_kendall[] = "kendall";
static const char __pyx_k_label_i[] = "label_i";
static const char __pyx_k_label_j[] = "label_j";
static const char __pyx_k_label_y[] = "label_y";
static const char __pyx_k_latlon1[] = "latlon1";
static const char __pyx_k_latlon2[] = "latlon2";
static const char __pyx_k_le_pred[] = "le_pred";
static const char __pyx_k_le_true[] = "le_true";
static const char __pyx_k_linfunc[] = "linfunc";
static const char __pyx_k_linkage[] = "linkage";
static const char __pyx_k_maximum[] = "maximum";
static const char __pyx_k_minimum[] = "minimum";
static const char __pyx_k_nan_sum[] = "nan_sum";
static const char __pyx_k_ndarray[] = "ndarray";
static const char __pyx_k_nearest[] = "nearest";
static const char __pyx_k_newaxis[] = "newaxis";
static const char __pyx_k_nonzero[] = "nonzero";
static const char __pyx_k_objname[] = "objname";
static const char __pyx_k_ordinal[] = "ordinal";
static const char __pyx_k_p_value[] = "p_value";
static const char __pyx_k_pearson[] = "pearson";
static const char __pyx_k_polyder[] = "_polyder";
static const char __pyx_k_polyfit[] = "polyfit";
static const char __pyx_k_polyval[] = "polyval";
static const char __pyx_k_predict[] = "predict";
static const char __pyx_k_rad2deg[] = "rad2deg";
static const char __pyx_k_replace[] = "replace";
static const char __pyx_k_reshape[] = "reshape";
static const char __pyx_k_results[] = "results";
static const char __pyx_k_reverse[] = "reverse";
static const char __pyx_k_s_index[] = "s_index";
static const char __pyx_k_shifted[] = "shifted";
static const char __pyx_k_sources[] = "sources";
static const char __pyx_k_spstats[] = "spstats";
static const char __pyx_k_squeeze[] = "squeeze";
static const char __pyx_k_sturges[] = "sturges";
static const char __pyx_k_support[] = "support";
static const char __pyx_k_swapped[] = "swapped";
static const char __pyx_k_targets[] = "targets";
static const char __pyx_k_trailer[] = "trailer";
static const char __pyx_k_weights[] = "weights";
static const char __pyx_k_xx_edge[] = "xx_edge";
static const char __pyx_k_List_str[] = "List[str]";
static const char __pyx_k_Location[] = "Location";
static const char __pyx_k_Optional[] = "Optional";
static const char __pyx_k_P_values[] = "P-values";
static const char __pyx_k_X_scaled[] = "X_scaled";
static const char __pyx_k_argwhere[] = "argwhere";
static const char __pyx_k_as_frame[] = "as_frame";
static const char __pyx_k_aweights[] = "aweights";
static const char __pyx_k_bin_true[] = "bin_true";
static const char __pyx_k_category[] = "category";
static const char __pyx_k_complete[] = "complete";
static const char __pyx_k_condense[] = "condense";
static const char __pyx_k_constant[] = "constant";
static const char __pyx_k_contains[] = "contains";
static const char __pyx_k_convolve[] = "convolve";
static const char __pyx_k_corrcoef[] = "corrcoef";
static const char __pyx_k_data_max[] = "data_max";
static const char __pyx_k_data_min[] = "data_min";
static const char __pyx_k_deepcopy[] = "deepcopy";
static const char __pyx_k_defaults[] = "defaults";
static const char __pyx_k_df_level[] = "df_level";
static const char __pyx_k_digitize[] = "digitize";
static const char __pyx_k_distance[] = "distance";
static const char __pyx_k_errstate[] = "errstate";
static const char __pyx_k_fit_edge[] = "_fit_edge";
static const char __pyx_k_is_frame[] = "is_frame";
static const char __pyx_k_islatlon[] = "islatlon";
static const char __pyx_k_isscalar[] = "isscalar";
static const char __pyx_k_iterrows[] = "iterrows";
static const char __pyx_k_keepdims[] = "keepdims";
static const char __pyx_k_linspace[] = "linspace";
static const char __pyx_k_make_mxs[] = "make_mxs";
static const char __pyx_k_min_cost[] = "min_cost";
static const char __pyx_k_msg_meth[] = "msg_meth";
static const char __pyx_k_n_epochs[] = "n_epochs";
static const char __pyx_k_negative[] = "negative";
static const char __pyx_k_northing[] = "northing";
static const char __pyx_k_p_values[] = "p_values";
static const char __pyx_k_pearsonr[] = "pearsonr";
static const char __pyx_k_positive[] = "positive";
static const char __pyx_k_prev_val[] = "prev_val";
static const char __pyx_k_profile1[] = "profile1";
static const char __pyx_k_profile2[] = "profile2";
static const char __pyx_k_rankdata[] = "rankdata";
static const char __pyx_k_residual[] = "residual";
static const char __pyx_k_row_dist[] = "row_dist";
static const char __pyx_k_spearman[] = "spearman";
static const char __pyx_k_star_mxs[] = "star_mxs";
static const char __pyx_k_std_pred[] = "std_pred";
static const char __pyx_k_std_true[] = "std_true";
static const char __pyx_k_strategy[] = "strategy";
static const char __pyx_k_subplots[] = "subplots";
static const char __pyx_k_subtract[] = "subtract";
static const char __pyx_k_swapaxes[] = "swapaxes";
static const char __pyx_k_to_array[] = "to_array";
static const char __pyx_k_to_frame[] = "to_frame";
static const char __pyx_k_to_log10[] = "to_log10";
static const char __pyx_k_total_FN[] = "total_FN";
static const char __pyx_k_total_FP[] = "total_FP";
static const char __pyx_k_total_TN[] = "total_TN";
static const char __pyx_k_total_TP[] = "total_TP";
static const char __pyx_k_utm_zone[] = "utm_zone";
static const char __pyx_k_var_pred[] = "var_pred";
static const char __pyx_k_var_true[] = "var_true";
static const char __pyx_k_warnings[] = "warnings";
static const char __pyx_k_weighted[] = "weighted";
static const char __pyx_k_y_scaled[] = "y_scaled";
static const char __pyx_k_y_scores[] = "y_scores";
static const char __pyx_k_ArrayLike[] = "ArrayLike";
static const char __pyx_k_DataFrame[] = "DataFrame";
static const char __pyx_k_SiteError[] = "SiteError";
static const char __pyx_k_TypeError[] = "TypeError";
static const char __pyx_k_ama_value[] = "ama_value";
static const char __pyx_k_api_types[] = "api.types";
static const char __pyx_k_auc_score[] = "auc_score";
static const char __pyx_k_bin_edges[] = "bin_edges";
static const char __pyx_k_bin_index[] = "bin_index";
static const char __pyx_k_bin_width[] = "bin_width";
static const char __pyx_k_c_order_2[] = "c_order ";
static const char __pyx_k_c_order_3[] = "`c_order`'";
static const char __pyx_k_cluster_d[] = "cluster %d";
static const char __pyx_k_consensus[] = "consensus";
static const char __pyx_k_converter[] = "converter";
static const char __pyx_k_coreutils[] = "coreutils";
static const char __pyx_k_corr_func[] = "corr_func";
static const char __pyx_k_curve_fit[] = "curve_fit";
static const char __pyx_k_digitized[] = "digitized";
static const char __pyx_k_ensure_2d[] = "ensure_2d";
static const char __pyx_k_enumerate[] = "enumerate";
static const char __pyx_k_err_lower[] = "err_lower";
static const char __pyx_k_err_upper[] = "err_upper";
static const char __pyx_k_error_msg[] = "error_msg";
static const char __pyx_k_estimator[] = "estimator";
static const char __pyx_k_euclidean[] = "euclidean";
static const char __pyx_k_gofastlog[] = "_gofastlog";
static const char __pyx_k_hierarchy[] = "hierarchy";
static const char __pyx_k_is_gotten[] = " is gotten.";
static const char __pyx_k_is_latlon[] = "is_latlon";
static const char __pyx_k_isenabled[] = "isenabled";
static const char __pyx_k_itertools[] = "itertools";
static const char __pyx_k_max_depth[] = "max_depth";
static const char __pyx_k_normalize[] = "normalize";
static const char __pyx_k_ones_like[] = "ones_like";
static const char __pyx_k_polyorder[] = "polyorder";
static const char __pyx_k_pos_label[] = "pos_label";
static const char __pyx_k_positions[] = " positions";
static const char __pyx_k_predicted[] = "predicted";
static const char __pyx_k_propagate[] = "propagate";
static const char __pyx_k_rank_data[] = "rank_data";
static const char __pyx_k_residuals[] = "residuals";
static const char __pyx_k_roc_curve[] = "roc_curve";
static const char __pyx_k_spearmanr[] = "spearmanr";
static const char __pyx_k_task_type[] = "task_type";
static const char __pyx_k_threshold[] = "threshold";
static const char __pyx_k_to_utm_in[] = "to_utm_in";
static const char __pyx_k_tolerance[] = "tolerance";
static const char __pyx_k_transform[] = "transform";
static const char __pyx_k_validator[] = "validator";
static const char __pyx_k_value_col[] = "value_col";
static const char __pyx_k_vectorize[] = "vectorize";
static const char __pyx_k_y_numeric[] = "y_numeric";
static const char __pyx_k_ydata_new[] = "ydata_new";
static const char __pyx_k_ValueError[] = "ValueError";
static const char __pyx_k_arraytools[] = "_arraytools";
static const char __pyx_k_axis_slice[] = "axis_slice";
static const char __pyx_k_bins_array[] = "bins_array";
static const char __pyx_k_continuous[] = "continuous";
static const char __pyx_k_convolve1d[] = "convolve1d";
static const char __pyx_k_cumulative[] = "cumulative";
static const char __pyx_k_data_range[] = "data_range";
static const char __pyx_k_decorators[] = "decorators";
static const char __pyx_k_dense_rank[] = "dense_rank";
static const char __pyx_k_empty_like[] = "empty_like";
static const char __pyx_k_estimators[] = "estimators";
static const char __pyx_k_exceptions[] = "exceptions";
static const char __pyx_k_in_percent[] = "in_percent";
static const char __pyx_k_input_name[] = "input_name";
static const char __pyx_k_instead_of[] = " instead of ";
static const char __pyx_k_isfunction[] = "isfunction";
static const char __pyx_k_issubdtype[] = "issubdtype";
static const char __pyx_k_kendalltau[] = "kendalltau";
static const char __pyx_k_linregress[] = "linregress";
static const char __pyx_k_matplotlib[] = "matplotlib";
static const char __pyx_k_model_pred[] = "model_pred";
static const char __pyx_k_model_true[] = "model_true";
static const char __pyx_k_multiclass[] = "multiclass";
static const char __pyx_k_nan_policy[] = "nan_policy";
static const char __pyx_k_param_name[] = "param_name";
static const char __pyx_k_percentile[] = "percentile";
static const char __pyx_k_projection[] = "projection";
static const char __pyx_k_raise_warn[] = "raise_warn";
static const char __pyx_k_ranks_pred[] = "ranks_pred";
static const char __pyx_k_ranks_true[] = "ranks_true";
static const char __pyx_k_raw_values[] = "raw_values";
static const char __pyx_k_regression[] = "regression";
static const char __pyx_k_return_qco[] = "return_qco";
static const char __pyx_k_sens_array[] = "sens_array";
static const char __pyx_k_set_xlabel[] = "set_xlabel";
static const char __pyx_k_set_ylabel[] = "set_ylabel";
static const char __pyx_k_similarity[] = "similarity";
static const char __pyx_k_source_col[] = "source_col";
static const char __pyx_k_spec_array[] = "spec_array";
static const char __pyx_k_squareform[] = "squareform";
static const char __pyx_k_target_col[] = "target_col";
static const char __pyx_k_thresholds[] = "thresholds";
static const char __pyx_k_tie_method[] = "tie_method";
static const char __pyx_k_total_cost[] = "total_cost";
static const char __pyx_k_valid_mask[] = "valid_mask";
static const char __pyx_k_zeros_like[] = "zeros_like";
static const char __pyx_k_Optional__F[] = "Optional[_F]";
static const char __pyx_k_add_results[] = "add_results";
static const char __pyx_k_api_summary[] = "api.summary";
static const char __pyx_k_bins_method[] = "bins_method";
static const char __pyx_k_concat_axis[] = "concat_axis";
static const char __pyx_k_concatenate[] = "concatenate";
static const char __pyx_k_cum_weights[] = "cum_weights";
static const char __pyx_k_expect_name[] = "expect_name";
static const char __pyx_k_exponential[] = "exponential";
static const char __pyx_k_extrapolate[] = "extrapolate";
static const char __pyx_k_get_azimuth[] = "get_azimuth";
static const char __pyx_k_get_bearing[] = "get_bearing";
static const char __pyx_k_gofastlog_2[] = "gofastlog";
static const char __pyx_k_include_nan[] = "include_nan";
static const char __pyx_k_interp_stop[] = "interp_stop";
static const char __pyx_k_is_iterable[] = "is_iterable";
static const char __pyx_k_multioutput[] = "multioutput";
static const char __pyx_k_optimal_idx[] = "optimal_idx";
static const char __pyx_k_passthrough[] = "passthrough";
static const char __pyx_k_poly_coeffs[] = "poly_coeffs";
static const char __pyx_k_raw_azimuth[] = "raw azimuth";
static const char __pyx_k_refglossary[] = "refglossary";
static const char __pyx_k_reset_index[] = "reset_index";
static const char __pyx_k_return_data[] = "return_data";
static const char __pyx_k_return_ymxs[] = "return_ymxs";
static const char __pyx_k_row_label_1[] = "row label 1";
static const char __pyx_k_row_lable_2[] = "row lable 2";
static const char __pyx_k_scipy_stats[] = "scipy.stats";
static const char __pyx_k_sensitivity[] = "sensitivity";
static const char __pyx_k_sorted_data[] = "sorted_data";
static const char __pyx_k_specificity[] = "specificity";
static const char __pyx_k_target_strs[] = "target_strs";
static const char __pyx_k_window_size[] = "window_size";
static const char __pyx_k_window_stop[] = "window_stop";
static const char __pyx_k_y_pred_pair[] = "y_pred_pair";
static const char __pyx_k_y_true_pair[] = "y_true_pair";
static const char __pyx_k_Got_x_ndim_d[] = ". Got {x.ndim}d.";
static const char __pyx_k_LabelEncoder[] = "LabelEncoder";
static const char __pyx_k_Optional_str[] = "Optional[str]";
static const char __pyx_k_X_normalized[] = "X_normalized";
static const char __pyx_k_assert_ratio[] = "assert_ratio";
static const char __pyx_k_assert_xy_in[] = "assert_xy_in";
static const char __pyx_k_base_epsilon[] = "base_epsilon";
static const char __pyx_k_combinations[] = "combinations";
static const char __pyx_k_control_vars[] = "control_vars";
static const char __pyx_k_corr_methods[] = "corr_methods";
static const char __pyx_k_cost_history[] = "cost_history";
static const char __pyx_k_custom_logic[] = "custom logic";
static const char __pyx_k_find_closest[] = "find_closest";
static const char __pyx_k_get_distance[] = "get_distance";
static const char __pyx_k_ignore_index[] = "ignore_index";
static const char __pyx_k_init_weights[] = "init_weights";
static const char __pyx_k_initializing[] = "_initializing";
static const char __pyx_k_interp_start[] = "interp_start";
static const char __pyx_k_is_coroutine[] = "_is_coroutine";
static const char __pyx_k_match_method[] = "match_method";
static const char __pyx_k_multi_output[] = "multi_output";
static const char __pyx_k_n_estimators[] = "n_estimators";
static const char __pyx_k_not_found_in[] = " not found in ";
static const char __pyx_k_numeric_cols[] = "numeric_cols";
static const char __pyx_k_optimal_bins[] = "optimal_bins";
static const char __pyx_k_pair_indices[] = "pair_indices";
static const char __pyx_k_profile_line[] = "profile_line";
static const char __pyx_k_return_array[] = "return_array";
static const char __pyx_k_row_clusters[] = "row_clusters";
static const char __pyx_k_scale_factor[] = "scale_factor";
static const char __pyx_k_scipy_linalg[] = "scipy.linalg";
static const char __pyx_k_scipy_signal[] = "scipy.signal";
static const char __pyx_k_similarities[] = "similarities";
static const char __pyx_k_simplefilter[] = "simplefilter";
static const char __pyx_k_smart_format[] = "smart_format";
static const char __pyx_k_to_latlon_in[] = "to_latlon_in";
static const char __pyx_k_total_weight[] = "total_weight";
static const char __pyx_k_value_column[] = "value_column";
static const char __pyx_k_window_start[] = "window_start";
static const char __pyx_k_y_normalized[] = "y_normalized";
static const char __pyx_k_Non_numerical[] = "Non-numerical ";
static const char __pyx_k_ResultSummary[] = "ResultSummary";
static const char __pyx_k_Union_str_int[] = "Union[str, int]";
static const char __pyx_k_adjusted_pred[] = "adjusted_pred";
static const char __pyx_k_api_docstring[] = "api.docstring";
static const char __pyx_k_argrelextrema[] = "argrelextrema";
static const char __pyx_k_binary_y_pred[] = "binary_y_pred";
static const char __pyx_k_binary_y_true[] = "binary_y_true";
static const char __pyx_k_check_epsilon[] = "check_epsilon";
static const char __pyx_k_class_getitem[] = "__class_getitem__";
static const char __pyx_k_column2ignore[] = "column2ignore";
static const char __pyx_k_exclude_value[] = "exclude_value";
static const char __pyx_k_extra_azimuth[] = "extra-azimuth";
static const char __pyx_k_fit_transform[] = "fit_transform";
static const char __pyx_k_include_label[] = "include_label";
static const char __pyx_k_kind_of_model[] = "_kind_of_model";
static const char __pyx_k_learning_rate[] = "learning_rate";
static const char __pyx_k_manage_colors[] = "_manage_colors";
static const char __pyx_k_minmax_scaler[] = "minmax_scaler";
static const char __pyx_k_predict_proba[] = "predict_proba";
static const char __pyx_k_profile_angle[] = "profile_angle";
static const char __pyx_k_relevant_mask[] = "relevant_mask";
static const char __pyx_k_return_counts[] = "return_counts";
static const char __pyx_k_roc_auc_score[] = "roc_auc_score";
static const char __pyx_k_sample_weight[] = "sample_weight";
static const char __pyx_k_savgol_coeffs[] = "savgol_coeffs";
static const char __pyx_k_savgol_filter[] = "savgol_filter";
static const char __pyx_k_scalePosition[] = "scalePosition";
static const char __pyx_k_scipy_ndimage[] = "scipy.ndimage";
static const char __pyx_k_select_dtypes[] = "select_dtypes";
static const char __pyx_k_sensitivities[] = "sensitivities";
static const char __pyx_k_spearman_corr[] = "spearman_corr";
static const char __pyx_k_specificities[] = "specificities";
static const char __pyx_k_step_function[] = "step_function";
static const char __pyx_k_sunburst_data[] = "sunburst_data";
static const char __pyx_k_unique_labels[] = "unique_labels";
static const char __pyx_k_valid_methods[] = "valid_methods";
static const char __pyx_k_weight_factor[] = "weight_factor";
static const char __pyx_k_weighted_rank[] = "weighted_rank";
static const char __pyx_k_window_length[] = "window_length";
static const char __pyx_k_y_pred_binary[] = "y_pred_binary";
static const char __pyx_k_y_true_binary[] = "y_true_binary";
static const char __pyx_k_youdens_index[] = "youdens_index";
static const char __pyx_k_zero_division[] = "zero_division";
static const char __pyx_k_Invalid_method[] = "Invalid method '";
static const char __pyx_k_RuntimeWarning[] = "RuntimeWarning";
static const char __pyx_k_Unknown_method[] = "Unknown method ";
static const char __pyx_k_adjusted_preds[] = "adjusted_preds";
static const char __pyx_k_bal_acc_scores[] = "bal_acc_scores";
static const char __pyx_k_best_threshold[] = "best_threshold";
static const char __pyx_k_catch_warnings[] = "catch_warnings";
static const char __pyx_k_compute_errors[] = "compute_errors";
static const char __pyx_k_ellipsis2false[] = "ellipsis2false";
static const char __pyx_k_exclude_string[] = "exclude_string";
static const char __pyx_k_filterwarnings[] = "filterwarnings";
static const char __pyx_k_involved_pairs[] = "involved_pairs";
static const char __pyx_k_label_binarize[] = "label_binarize";
static const char __pyx_k_label_to_index[] = "label_to_index";
static const char __pyx_k_linkage_matrix[] = "linkage_matrix";
static const char __pyx_k_mean_rank_pred[] = "mean_rank_pred";
static const char __pyx_k_mean_rank_true[] = "mean_rank_true";
static const char __pyx_k_moving_average[] = "moving_average";
static const char __pyx_k_optimal_youden[] = "optimal_youden";
static const char __pyx_k_percent_events[] = "percent_events";
static const char __pyx_k_positive_preds[] = "positive_preds";
static const char __pyx_k_residuals_pred[] = "residuals_pred";
static const char __pyx_k_residuals_true[] = "residuals_true";
static const char __pyx_k_scipy_optimize[] = "scipy.optimize";
static const char __pyx_k_sorted_indices[] = "sorted_indices";
static const char __pyx_k_true_negatives[] = "true_negatives";
static const char __pyx_k_true_positives[] = "true_positives";
static const char __pyx_k_type_of_target[] = "type_of_target";
static const char __pyx_k_valid_policies[] = "valid_policies";
static const char __pyx_k_y_pred_indices[] = "y_pred_indices";
static const char __pyx_k_y_true_encoded[] = "y_true_encoded";
static const char __pyx_k_y_true_indices[] = "y_true_indices";
static const char __pyx_k_yt_transformed[] = "yt_transformed";
static const char __pyx_k_Tuple_int_float[] = "Tuple[int, float]";
static const char __pyx_k_Union_int_float[] = "Union[int, float]";
static const char __pyx_k_adjusted_y_pred[] = "adjusted_y_pred";
static const char __pyx_k_adjusted_y_true[] = "adjusted_y_true";
static const char __pyx_k_apply_log_scale[] = "apply_log_scale";
static const char __pyx_k_are_not_allowed[] = " are not allowed.";
static const char __pyx_k_avg_sensitivity[] = "avg_sensitivity";
static const char __pyx_k_avg_specificity[] = "avg_specificity";
static const char __pyx_k_cumulative_data[] = "cumulative_data";
static const char __pyx_k_drop_duplicates[] = "drop_duplicates";
static const char __pyx_k_false_negatives[] = "false_negatives";
static const char __pyx_k_false_positives[] = "false_positives";
static const char __pyx_k_float_factorial[] = "float_factorial";
static const char __pyx_k_include_metrics[] = "include_metrics";
static const char __pyx_k_is_arraylike_1d[] = "_is_arraylike_1d";
static const char __pyx_k_is_binary_class[] = "is_binary_class";
static const char __pyx_k_prob_true_class[] = "prob_true_class";
static const char __pyx_k_raise_exception[] = "raise_exception";
static const char __pyx_k_scale_positions[] = "scale_positions";
static const char __pyx_k_sklearn_metrics[] = "sklearn.metrics";
static const char __pyx_k_specific_y_pred[] = "specific_y_pred";
static const char __pyx_k_specific_y_true[] = "specific_y_true";
static const char __pyx_k_standard_scaler[] = "standard_scaler";
static const char __pyx_k_step_regression[] = "step_regression";
static const char __pyx_k_uniform_average[] = "uniform_average";
static const char __pyx_k_use_lower_bound[] = "use lower bound";
static const char __pyx_k_validate_scores[] = "validate_scores";
static const char __pyx_k_LinearRegression[] = "LinearRegression";
static const char __pyx_k_Position_array_p[] = "Position array 'p'";
static const char __pyx_k_assert_all_types[] = "_assert_all_types";
static const char __pyx_k_bin_contribution[] = "bin_contribution";
static const char __pyx_k_compute_p_values[] = "compute_p_values";
static const char __pyx_k_confusion_matrix[] = "confusion_matrix";
static const char __pyx_k_cubic_regression[] = "cubic_regression";
static const char __pyx_k_gradient_descent[] = "gradient_descent";
static const char __pyx_k_is_numeric_dtype[] = "_is_numeric_dtype";
static const char __pyx_k_label_importance[] = "label_importance";
static const char __pyx_k_label_yt_trailer[] = "label_yt_trailer";
static const char __pyx_k_normalize_string[] = "normalize_string";
static const char __pyx_k_optimal_ordering[] = "optimal_ordering";
static const char __pyx_k_pop_cat_features[] = "pop_cat_features";
static const char __pyx_k_predicted_labels[] = "predicted_labels";
static const char __pyx_k_quality_control2[] = "quality_control2";
static const char __pyx_k_return_mean_dist[] = "return_mean_dist";
static const char __pyx_k_scipy__lib__util[] = "scipy._lib._util";
static const char __pyx_k_use_average_dist[] = "use_average_dist";
static const char __pyx_k_validate_name_in[] = "_validate_name_in";
static const char __pyx_k_y_true_binarized[] = "y_true_binarized";
static const char __pyx_k_A_singleton_array[] = "A singleton array ";
static const char __pyx_k_List_Dict_str_str[] = "List[Dict[str, str]]";
static const char __pyx_k_Optional_List_str[] = "Optional[List[str]]";
static const char __pyx_k_Tuple_float_float[] = "Tuple[float, float]";
static const char __pyx_k_compute_spearmanr[] = "_compute_spearmanr";
static const char __pyx_k_determine_epsilon[] = "determine_epsilon";
static const char __pyx_k_drop_intermediate[] = "drop_intermediate";
static const char __pyx_k_ensure_y_is_valid[] = "_ensure_y_is_valid";
static const char __pyx_k_fit_a_5_3f_b_5_3f[] = "fit: a=%5.3f, b=%5.3f";
static const char __pyx_k_fit_edges_polyfit[] = "_fit_edges_polyfit";
static const char __pyx_k_freedman_diaconis[] = "freedman_diaconis";
static const char __pyx_k_get_gofast_logger[] = "get_gofast_logger";
static const char __pyx_k_get_profile_angle[] = "get_profile_angle";
static const char __pyx_k_inverse_transform[] = "inverse_transform";
static const char __pyx_k_linear_regression[] = "linear_regression";
static const char __pyx_k_matplotlib_pyplot[] = "matplotlib.pyplot";
static const char __pyx_k_micro_sensitivity[] = "micro_sensitivity";
static const char __pyx_k_micro_specificity[] = "micro_specificity";
static const char __pyx_k_min_non_zero_pred[] = "min_non_zero_pred";
static const char __pyx_k_optimal_threshold[] = "optimal_threshold";
static const char __pyx_k_return_confidence[] = "return_confidence";
static const char __pyx_k_to_numeric_dtypes[] = "to_numeric_dtypes";
static const char __pyx_k_Array_dimension_is[] = "Array dimension is ";
static const char __pyx_k_Expected_float_not[] = "Expected float not ";
static const char __pyx_k_Invalid_nan_policy[] = "Invalid nan_policy: ";
static const char __pyx_k_LogisticRegression[] = "LogisticRegression";
static const char __pyx_k_Optional_ArrayLike[] = "Optional[ArrayLike]";
static const char __pyx_k_Union_int_str_list[] = "Union[int, str, list]";
static const char __pyx_k_accept_multioutput[] = "accept_multioutput";
static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
static const char __pyx_k_count_local_minima[] = "count_local_minima";
static const char __pyx_k_cumulative_average[] = "cumulative average";
static const char __pyx_k_filtering_1d_array[] = "_filtering_1d_array";
static const char __pyx_k_get_station_number[] = "get_station_number";
static const char __pyx_k_local_minima_count[] = "local_minima_count";
static const char __pyx_k_make_mxs_line_2514[] = "make_mxs (line 2514)";
static const char __pyx_k_pairwise_distances[] = "pairwise_distances";
static const char __pyx_k_percent_events_bin[] = "percent_events_bin";
static const char __pyx_k_percent_non_events[] = "percent_non_events";
static const char __pyx_k_return_target_only[] = "return_target_only";
static const char __pyx_k_window_size_factor[] = "window_size_factor";
static const char __pyx_k_AppendDocReferences[] = "AppendDocReferences";
static const char __pyx_k_Union_str_ArrayLike[] = "Union[str, ArrayLike]";
static const char __pyx_k_Use_base_or_binning[] = "'. Use 'base' or 'binning'.";
static const char __pyx_k_calculate_binary_iv[] = "calculate_binary_iv";
static const char __pyx_k_calculate_residuals[] = "calculate_residuals";
static const char __pyx_k_ensure_non_negative[] = "ensure_non_negative";
static const char __pyx_k_find_close_position[] = "find_close_position";
static const char __pyx_k_gofast_tools_mathex[] = "gofast.tools.mathex";
static const char __pyx_k_histogram_bin_edges[] = "histogram_bin_edges";
static const char __pyx_k_normalize_line_2997[] = "normalize (line 2997)";
static const char __pyx_k_optimized_spearmanr[] = "optimized_spearmanr";
static const char __pyx_k_parameter_validator[] = "parameter_validator";
static const char __pyx_k_rank_data_line_1263[] = "rank_data (line 1263)";
static const char __pyx_k_assert_x_y_positions[] = "_assert_x_y_positions";
static const char __pyx_k_compute_effort_yield[] = "compute_effort_yield";
static const char __pyx_k_infer_sankey_columns[] = "infer_sankey_columns";
static const char __pyx_k_local_minima_indices[] = "local_minima_indices";
static const char __pyx_k_no_of_items_in_clust[] = "no. of items in clust.";
static const char __pyx_k_quadratic_regression[] = "quadratic_regression";
static const char __pyx_k_return_weighted_rank[] = "return_weighted_rank";
static const char __pyx_k_sklearn_linear_model[] = "sklearn.linear_model";
static const char __pyx_k_torres_verdin_filter[] = "torres_verdin_filter";
static const char __pyx_k_validate_multioutput[] = "validate_multioutput";
static const char __pyx_k_Degree_is_integer_Got[] = "Degree is integer. Got ";
static const char __pyx_k_Tuple_float_ArrayLike[] = "Tuple[float, ArrayLike]";
static const char __pyx_k_Use_the_index_instead[] = " Use the index instead.";
static const char __pyx_k_balanced_accuracy_ovo[] = "_balanced_accuracy_ovo";
static const char __pyx_k_balanced_accuracy_ovr[] = "_balanced_accuracy_ovr";
static const char __pyx_k_calculate_adjusted_lr[] = "calculate_adjusted_lr";
static const char __pyx_k_compute_ovo_sens_spec[] = "_compute_ovo_sens_spec";
static const char __pyx_k_compute_sunburst_data[] = "compute_sunburst_data";
static const char __pyx_k_compute_youdens_index[] = "compute_youdens_index";
static const char __pyx_k_convert_distance_to_m[] = "convert_distance_to_m";
static const char __pyx_k_get_azimuth_line_3229[] = "get_azimuth (line 3229)";
static const char __pyx_k_get_bearing_line_4703[] = "get_bearing (line 4703)";
static const char __pyx_k_simple_moving_average[] = "simple moving average";
static const char __pyx_k_sinusoidal_regression[] = "sinusoidal_regression";
static const char __pyx_k_sklearn_preprocessing[] = "sklearn.preprocessing";
static const char __pyx_k_validate_length_range[] = "validate_length_range";
static const char __pyx_k_DecisionStumpRegressor[] = "DecisionStumpRegressor";
static const char __pyx_k_Optional_Union_int_str[] = "Optional[Union[int, str]]";
static const char __pyx_k_Union_ArrayLike_Series[] = "Union[ArrayLike, Series]";
static const char __pyx_k_calculate_optimal_bins[] = "calculate_optimal_bins";
static const char __pyx_k_concat_array_from_list[] = "concat_array_from_list";
static const char __pyx_k_exponential_regression[] = "exponential_regression";
static const char __pyx_k_find_closest_line_4771[] = "find_closest (line 4771)";
static const char __pyx_k_get_distance_line_4518[] = "get_distance (line 4518)";
static const char __pyx_k_logarithmic_regression[] = "logarithmic_regression";
static const char __pyx_k_percent_non_events_bin[] = "percent_non_events_bin";
static const char __pyx_k_scipy_spatial_distance[] = "scipy.spatial.distance";
static const char __pyx_k_significance_threshold[] = "significance_threshold";
static const char __pyx_k_weighted_spearman_corr[] = "_weighted_spearman_corr";
static const char __pyx_k_weighted_spearman_rank[] = "weighted_spearman_rank";
static const char __pyx_k_Optional_Union_str_list[] = "Optional[Union[str, list]]";
static const char __pyx_k_Use_column_name_instead[] = "'. Use column name instead.";
static const char __pyx_k_adaptive_moving_average[] = "adaptive_moving_average";
static const char __pyx_k_adjust_for_control_vars[] = "adjust_for_control_vars";
static const char __pyx_k_calculate_multiclass_lr[] = "calculate_multiclass_lr";
static const char __pyx_k_check_consistent_length[] = "check_consistent_length";
static const char __pyx_k_detect_station_position[] = "detect_station_position";
static const char __pyx_k_gofast_tools_mathex_pyx[] = "gofast/tools/mathex.pyx";
static const char __pyx_k_minmax_scaler_line_2947[] = "minmax_scaler (line 2947)";
static const char __pyx_k_savgol_coeffs_line_3949[] = "savgol_coeffs (line 3949)";
static const char __pyx_k_savgol_filter_line_4159[] = "savgol_filter (line 4159)";
static const char __pyx_k_scalePosition_line_3596[] = "scalePosition (line 3596)";
static const char __pyx_k_scipy_cluster_hierarchy[] = "scipy.cluster.hierarchy";
static const char __pyx_k_use_must_be_conv_or_dot[] = "`use` must be 'conv' or 'dot'";
static const char __pyx_k_validate_sample_weights[] = "validate_sample_weights";
static const char __pyx_k_weighted_moving_average[] = "weighted moving average";
static const char __pyx_k_calculate_histogram_bins[] = "calculate_histogram_bins";
static const char __pyx_k_compute_balance_accuracy[] = "compute_balance_accuracy";
static const char __pyx_k_compute_errors_line_4287[] = "compute_errors (line 4287)";
static const char __pyx_k_compute_p_values_line_97[] = "compute_p_values (line 97)";
static const char __pyx_k_moving_average_line_3046[] = "moving_average (line 3046)";
static const char __pyx_k_sklearn_utils_multiclass[] = "sklearn.utils.multiclass";
static const char __pyx_k_Input_values_contain_NaNs[] = "Input values contain NaNs.";
static const char __pyx_k_get_azimuth_locals_lambda[] = "get_azimuth.<locals>.<lambda>";
static const char __pyx_k_scale_positions_line_4567[] = "scale_positions (line 4567)";
static const char __pyx_k_standard_scaler_line_2896[] = "standard_scaler (line 2896)";
static const char __pyx_k_window_length_must_be_odd[] = "window_length must be odd.";
static const char __pyx_k_Tuple_ArrayLike_np_ndarray[] = "Tuple[ArrayLike, np.ndarray]";
static const char __pyx_k_data_should_be_a_frame_not[] = "'data' should be a frame, not ";
static const char __pyx_k_exponential_moving_average[] = "exponential moving average";
static const char __pyx_k_gradient_descent_line_4820[] = "gradient_descent (line 4820)";
static const char __pyx_k_label_importance_line_2612[] = "label_importance (line 2612)";
static const char __pyx_k_quality_control2_line_4409[] = "quality_control2 (line 4409)";
static const char __pyx_k_validate_multiclass_target[] = "validate_multiclass_target";
static const char __pyx_k_calculate_multiclass_avg_lr[] = "calculate_multiclass_avg_lr";
static const char __pyx_k_gradient_boosting_regressor[] = "gradient_boosting_regressor";
static const char __pyx_k_scalePosition_locals_lambda[] = "scalePosition.<locals>.<lambda>";
static const char __pyx_k_NoneType_can_not_be_computed[] = "NoneType can not be computed !";
static const char __pyx_k_check_classification_targets[] = "check_classification_targets";
static const char __pyx_k_compute_cost_based_threshold[] = "compute_cost_based_threshold";
static const char __pyx_k_count_local_minima_line_3171[] = "count_local_minima (line 3171)";
static const char __pyx_k_scalePosition_locals_linfunc[] = "scalePosition.<locals>.linfunc";
static const char __pyx_k_calculate_binary_iv_line_1993[] = "calculate_binary_iv (line 1993)";
static const char __pyx_k_calculate_residuals_line_2195[] = "calculate_residuals (line 2195)";
static const char __pyx_k_optimized_spearmanr_line_1351[] = "optimized_spearmanr (line 1351)";
static const char __pyx_k_step_regression_locals_lambda[] = "step_regression.<locals>.<lambda>";
static const char __pyx_k_Adjusts_y_true_and_y_pred_in_a[] = "\n    Adjusts `y_true` and `y_pred` in a classification task by stratifying the\n    data based on control variables. It optionally applies logistic regression\n    within each stratum  for adjustment, aiming to refine predictions based \n    on the influence of control variables.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True class labels. Must be a 1D array of classification targets.\n    y_pred : array-like\n        Predicted class labels, corresponding to `y_true`. Must be of the \n        same shape as `y_true`.\n    control_vars : pandas.DataFrame\n        DataFrame containing one or more columns that represent control \n        variables. These variables are used to stratify the data before \n        applying any adjustment logic.\n\n    Returns\n    -------\n    adjusted_y_true : numpy.ndarray\n        Adjusted array of true class labels, same as input `y_true` \n        (adjustment process does not alter true labels).\n    adjusted_y_pred : numpy.ndarray\n        Adjusted array of predicted class labels after considering the \n        stratification by control variables.\n\n    Notes\n    -----\n    This function aims to account for potential confounders or additional\n    information represented by control variables.\n    Logistic regression is utilized within each stratum defined by unique \n    combinations of control variables to adjust predictions.\n    The essence is to mitigate the influence of control variables on the \n    prediction outcomes, thereby potentially enhancing the prediction accuracy\n    or fairness across different groups.\n\n    The adjustment is particularly useful in scenarios where control variables\n    significantly influence the target variable, and their effects need to be\n    isolated from the primary predictive modeling process.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import adjust_for_control_vars_classification\n    >>> y_true = [0, 1, 0, 1]\n    >>> y_pred = [0, 0, 1, 1]""\n    >>> control_vars = pd.DataFrame({'age': [25, 30, 35, 40], 'gender': [0, 1, 0, 1]})\n    >>> adjusted_y_true, adjusted_y_pred = adjust_for_control_vars_classification(\n    ... y_true, y_pred, control_vars)\n    >>> print(adjusted_y_pred)\n    [0 0 1 1]\n\n    The function does not modify `y_true` but adjusts `y_pred` based on \n    logistic regression adjustments within each stratum defined by \n    `control_vars`.\n\n    See Also\n    --------\n    sklearn.metrics.classification_report : Compute precision, recall,\n        F-measure and support for each class.\n    sklearn.preprocessing.LabelEncoder : \n        Encode target labels with value between 0 and n_classes-1.\n    sklearn.linear_model.LogisticRegression : \n        Logistic Regression (aka logit, MaxEnt) classifier.\n\n    References\n    ----------\n    .. [2] J. D. Hunter. \"Matplotlib: A 2D graphics environment\", \n           Computing in Science & Engineering, vol. 9, no. 3, pp. 90-95, 2007.\n    .. [1] F. Pedregosa et al., \"Scikit-learn: Machine Learning in Python\",\n           Journal of Machine Learning Research, vol. 12, pp. 2825-2830, 2011.\n    ";
static const char __pyx_k_Assigns_ranks_to_data_handling[] = "\n    Assigns ranks to data, handling ties according to the specified method.\n    This function supports several strategies for tie-breaking, making it\n    versatile for ranking tasks in statistical analyses and machine learning.\n\n    Parameters\n    ----------\n    data : array-like\n        The input data to rank. This can be any sequence that can be converted\n        to a numpy array.\n    method : {'average', 'min', 'max', 'dense', 'ordinal'}, optional\n        The method used to assign ranks to tied elements. The options are:\n        - 'average': Assign the average of the ranks to the tied elements.\n        - 'min': Assign the minimum of the ranks to the tied elements.\n        - 'max': Assign the maximum of the ranks to the tied elements.\n        - 'dense': Like 'min', but the next rank is always one greater than\n          the previous rank (i.e., no gaps in rank values).\n        - 'ordinal': Assign a unique rank to each element, with ties broken\n          by their order in the data.\n\n    Returns\n    -------\n    ranks : ndarray\n        The ranks of the input data.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import rank_data\n    >>> data = [40, 20, 30, 20]\n    >>> rank_data(data, method='average')\n    array([4. , 1.5, 3. , 1.5])\n\n    >>> rank_data(data, method='min')\n    array([4, 1, 3, 1])\n\n    Notes\n    -----\n    The ranking methods provided offer flexibility for different ranking\n    scenarios. 'average', 'min', and 'max' are particularly useful in\n    statistical contexts where ties need to be accounted for explicitly,\n    while 'dense' and 'ordinal' provide strategies for more ordinal or\n    categorical data ranking tasks.\n\n    References\n    ----------\n    - Freund, J.E., & Wilson, W.J. (1993). Statistical Methods, 2nd ed.\n    - Gibbons, J.D., & Chakraborti, S. (2011). Nonparametric Statistical Inference.\n    \n    See Also\n    --------\n    scipy.stats.rankdata : Rank the data in an array.\n    num""py.argsort : Returns the indices that would sort an array.\n    ";
static const char __pyx_k_Calculate_the_likelihood_ratio[] = "\n    Calculate the likelihood ratio with modifications to avoid extremely high \n    values, particularly when specificity is close to 1.\n\n    Parameters\n    ----------\n    sensitivity : float or numpy.ndarray\n        The probability of correctly identifying a true positive, expressed as a \n        scalar for single measurement or an array for multiple measurements. Each\n        value represents the sensitivity for a given test or condition.\n    \n    specificity : float or numpy.ndarray\n        The probability of correctly identifying a true negative, similarly\n        expressed as either a scalar for a single measurement or an array for\n        multiple measurements. Each value corresponds to the specificity of \n        a test or condition and must match the dimensions of `sensitivity` if\n        provided as an array.\n\n    consensus : str, optional\n        Specifies the type of likelihood ratio to compute:\n        - 'positive': Computes the positive likelihood ratio (LR+), which\n          is sensitivity divided by (1 - specificity). This ratio indicates\n          how much the odds of the disease increase when a test is positive.\n        - 'negative': Computes the negative likelihood ratio (LR-), which\n          is (1 - sensitivity) divided by specificity. This ratio indicates\n          how much the odds of the disease decrease when a test is negative.\n          Default is 'positive'.\n    \n    max_lr : float, optional\n        The maximum allowed value for the likelihood ratio to prevent\n        extreme values that could be misleading or difficult to interpret.\n        Default is 100, which means likelihood ratios are capped at this value \n        to avoid disproportionately high results that could result from very\n        small denominators.\n\n    buffer : float, optional\n        A small value added to the denominator in the likelihood ratio\n        calculation to prevent division by near-zero, which can lead to\n        extremely ""high values. This buffer ensures stability in the calculations\n        by avoiding infinite or very large ratios. Default is 1e-2.\n\n    Returns\n    -------\n    float or numpy.ndarray\n        The adjusted likelihood ratio, either as a single value or an array of\n        values, depending on the input format. Each ratio is capped at `max_lr`\n        and adjusted for low denominators using `buffer`.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_adjusted_lr\n    >>> calculate_adjusted_lr(0.95, 0.89)\n    8.636363636363637\n\n    >>> calculate_adjusted_lr(np.array([0.95, 0.80]), np.array([0.89, 0.90]), \n                              consensus='negative', max_lr=10)\n    array([1.04545455, 2.        ])\n  \n    >>> calculate_adjusted_lr(0.99, 0.999, consensus='positive')\n    99.0\n    >>> calculate_adjusted_lr(0.80, 0.95, consensus='negative', max_lr=100,\n    ... buffer=0.005)\n    0.21052631578947364\n\n    Notes\n    -----\n    The likelihood ratio (LR) is calculated based on the specified `consensus`:\n    \n    For a 'positive' likelihood ratio:\n        \n    .. math::\n        LR_+ = \\frac{\\text{sensitivity}}{\\max(1 - \\text{specificity}, \n        \\text{buffer})}\n\n    For a 'negative' likelihood ratio:\n        \n    .. math::\n        LR_- = \\frac{1 - \\text{sensitivity}}{\\max(\\text{specificity}, \n        \\text{buffer})}\n\n    This approach helps to manage situations where specificity is very close to 1,\n    which would normally result in a very high LR due to a small denominator.\n    The `max_lr` parameter caps the LR to a maximum value, preventing extremely\n    high ratios that might be misleading or difficult to interpret in practical\n    scenarios.\n    ";
static const char __pyx_k_Calculates_histogram_bin_edges[] = "\n    Calculates histogram bin edges from data with optional normalization.\n\n    Parameters\n    ----------\n    data : array_like\n        The input data to calculate histogram bins for.\n    bins : int, sequence of scalars, or str, optional\n        The criteria to bin the data. If an integer, it defines the number \n        of equal-width bins in the given range. If a sequence, it defines the \n        bin edges directly. If a string, it defines the method used to calculate \n        the optimal bin width, as defined by numpy.histogram_bin_edges().\n    range : (float, float), optional\n        The lower and upper range of the bins. If not provided, range is \n        simply (data.min(), data.max()).\n        Values outside the range are ignored.\n    normalize : bool, default False\n        If True, scales the data to range [0, 1] before calculating bins.\n\n    Returns\n    -------\n    bin_edges : ndarray\n        The computed or specified bin edges.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_histogram_bins\n    >>> data = np.random.randn(1000)\n    >>> bins = calculate_histogram_bins(data, bins=30)\n    >>> print(bins)\n\n    Notes\n    -----\n    This function is particularly useful in data preprocessing for histogram plotting.\n    Normalization before binning can be useful when dealing with data with outliers\n    or very skewed distributions.\n    ";
static const char __pyx_k_Calculates_the_adaptive_moving[] = "\n    Calculates the adaptive moving average of a given data array from \n    Torres and Verdin algorithm [1]_. \n    \n    Parameters \n    -----------\n    arr: Arraylike 1d \n      List or array-like of data points.  If two-dimensional array \n      is passed, `axis` must be specified to apply the filter onto. \n       \n    weight_factor: float, default=.1\n      Base smoothing factor for window size which gets adjusted by a factor \n      dependent on the rate of change in the data. \n        \n    beta: float, default =1. \n       Scaling factor to adjust `weight_factor` during high volatility. \n       It controls how much the `weight_factor` is adjusted during \n       periods of high volatility.\n       \n    logify: bool, default=False, \n      By default , Torres uses exponential moving average. So if the \n      values can be logarithmized to ensure the weight be ranged between \n      0 and 1. This is important when data are resistivity or phase. \n      \n    axis: int, default=0 \n      Axis along which to apply the AMA filter.\n    Return \n    -------\n    ama: Adaptive moving average\n    \n    References \n    ------------\n    .. [1] Torres-Verdin and Bostick, 1992,  Principles of spatial surface \n        electric field filtering in magnetotellurics: electromagnetic array profiling\n        (EMAP), Geophysics, v57, p603-622.https://doi.org/10.1190/1.2400625\n\n    Example\n    --------\n    >>> import matplotlib.pyplot as plt \n    >>> from gofast.tools.mathex  import torres_verdin_filter \n    >>> data = np.random.randn(100)  \n    >>> ama = torres_verdin_filter(data)\n    >>> plt.plot (range (len(data)), data, 'k', range(len(data)), ama, '-or')\n    >>> # apply on two dimensional array \n    >>> data2d = np.random.randn(7, 10) \n    >>> ama2d = torres_verdin_filter ( data2d, axis =0)\n    >>> fig, ax  = plt.subplots (nrows = 1, ncols = 2 , sharey= True,\n                             figsize = (7,7) )\n    >>> ax[0].imshow(data2d , label ='Raw ""data', cmap = 'binary' )\n    >>> ax[1].imshow (ama2d,  label = 'AMA data', cmap ='binary' )\n    >>> ax[0].set_title ('Raw data') \n    >>> ax[1].set_title ('AMA data') \n    >>> plt.legend\n    >>> plt.show () \n    \n    ";
static const char __pyx_k_Compute_the_importance_of_each[] = "\n    Compute the importance of each label in a target array.\n\n    This function calculates the frequency of each unique label \n    in the target array `y`. Importance is defined as the proportion of \n    occurrences of each label in the array.\n\n    Parameters\n    ----------\n    y : array-like\n        The target array containing labels.\n    include_nan : bool, optional\n        If True, includes NaN values in the calculation, otherwise \n        excludes them (default is False).\n\n    Returns\n    -------\n    dict\n        A dictionary with labels as keys and their corresponding \n        importance as values.\n\n    Notes\n    -----\n    The mathematical formulation for the importance of a label `l` is given by:\n\n    .. math::\n\n        I(l) = \\frac{\\text{{count of }} l \\text{{ in }} y}{\\text{{total number of elements in }} y}\n\n    Examples\n    --------\n    >>> y = np.array([1, 2, 2, 3, 3, 3, np.nan])\n    >>> label_importance(y)\n    {1.0: 0.16666666666666666, 2.0: 0.3333333333333333, 3.0: 0.5}\n\n    >>> label_importance(y, include_nan=True)\n    {1.0: 0.14285714285714285, 2.0: 0.2857142857142857, 3.0: 0.42857142857142855,\n     nan: 0.14285714285714285}\n    ";
static const char __pyx_k_Compute_the_similarity_between[] = "\n    Compute the similarity between labels in arrays true y and predicted yt. \n    \n    Function transform yt based on these similarities, and create a new \n    array `ymxs` by filling NaN values in y with corresponding labels from \n    transformed yt. Handles NaN values in `yt` based on the `mode` and\n    `include_nan` parameters. See more in [1]_\n\n    Parameters\n    ----------\n    y : array-like\n        The target array containing valid labels and potentially NaN values.\n    yt : array-like\n        The array containing predicted labels from KMeans.\n    threshold : float, optional\n        The threshold for considering a label in `y` as similar to a label \n        in `yt` (default is 0.5).\n    star_mxs : bool, optional\n        If True, appends `trailer` to labels in `yt` when similarity is found \n        (default is True).\n    return_ymx : bool, optional\n        If True, returns the mixed array `ymx`; otherwise, returns a \n        dictionary of label similarities (default is False).\n    mode : str, optional\n        \"strict\" or \"soft\" handling of NaN values in `yt` (default is \"strict\").\n    include_nan : bool, optional\n        If True and `mode` is \"soft\", includes NaN values in `yt` during \n        similarity computation (default is False).\n    trailer : str, optional\n        The string to append to labels in `yt` when `star_mxs` is True\n        (default is \"*\").\n\n    Returns\n    -------\n    array or dict\n        Mixed array `ymx` if `return_ymx` is True; otherwise, a \n        dictionary representing similarities of labels in `y` and `yt`.\n\n    Raises\n    ------\n    ValueError\n        If `yt` contains NaN values in \"strict\" mode or if `trailer` \n        is a number.\n        \n    References\n    -----------\n    [1] Kouadio, K.L, Liu R., Liu J., A mixture Learning Strategy for predicting \n        permeability coefficient K (2024). Computers and Geosciences, doi:XXXXX \n\n    Examples\n    --------\n    >>> y ="" np.array([1, 2, np.nan, 4])\n    >>> yt = np.array([1, 2, 3, 4])\n    >>> make_mxs(y, yt, threshold=0.5, star_mxs=True, return_ymx=True, trailer=\"#\")\n    array([1, 2, '3#', '44#'])\n\n    >>> make_mxs(y, yt, threshold=1.5, star_mxs=False, return_ymx=False, mode=\"soft\")\n    {1: True, 2: True, np.nan: False, 4: True}\n    ";
static const char __pyx_k_Compute_threshold_using_a_cost[] = "\n    Compute threshold using a cost-based approach.\n\n    This method computes the total cost for each potential threshold and \n    selects the one that minimizes this cost.\n    \n    Parameters:\n    -----------\n    y_true : array-like of shape (n_samples,)\n        True binary labels.\n    y_scores : array-like of shape (n_samples,)\n        Target scores, can either be probability estimates of the positive class,\n        confidence values, or non-thresholded measure of decisions (as returned\n        by decision_function on some classifiers).\n    costs : tuple (C_FP, C_FN)\n        Costs associated with false positives (C_FP) and false negatives (C_FN).\n    sample_weight : array-like of shape (n_samples,), optional (default=None)\n        Sample weights.\n\n    Returns\n    --------\n    optimal_threshold : float\n        The threshold that minimizes the total cost.\n    total_cost : float\n        The total cost at the optimal threshold.\n\n    Examples\n    ---------\n    >>> from gofast.tools.mathex import compute_cost_based_threshold\n    >>> y_true = [0, 1, 1, 0, 1]\n    >>> y_scores = [0.1, 0.8, 0.3, 0.6, 0.9]\n    >>> costs = (1, 2)  # Cost of FP = 1, Cost of FN = 2\n    >>> optimal_threshold, total_cost = compute_cost_based_threshold(y_true, y_scores, costs)\n    >>> print(\"Optimal Threshold:\", optimal_threshold)\n    Optimal Threshold: 0.8\n    >>> print(\"Total Cost:\", total_cost)\n    Total Cost: 4.0\n    ";
static const char __pyx_k_Infers_source_target_and_value[] = "\n    Infers source, target, and value columns for a Sankey diagram \n    from a DataFrame.\n\n    Parameters\n    ----------\n    data : pd.DataFrame\n        The DataFrame from which to infer the source, target, and value columns.\n\n    Returns\n    -------\n    Tuple[List[str], List[str], List[int]]\n        Three lists containing the names of the source nodes, target nodes,\n        and the values of the flows between them, respectively.\n\n    Raises\n    ------\n    ValueError\n        If the DataFrame does not contain at least two columns for source and target,\n        and an additional column for value.\n\n    Examples\n    --------\n    >>> import pandas as pd\n    >>> from gofast.tools.mathex import infer_sankey_columns\n    >>> df = pd.DataFrame({\n    ...     'from': ['A', 'A', 'B', 'B'],\n    ...     'to': ['X', 'Y', 'X', 'Y'],\n    ...     'amount': [10, 20, 30, 40]\n    ... })\n    >>> sources, targets, values = infer_sankey_columns(df)\n    >>> print(sources, targets, values)\n    ['A', 'A', 'B', 'B'] ['X', 'Y', 'X', 'Y'] [10, 20, 30, 40]\n    ";
static const char __pyx_k_Scales_each_feature_to_a_given[] = "\n    Scales each feature to a given range, typically [0, 1].\n\n    MinMax scaling is often used when the algorithm requires a bounded interval. \n    It's particularly useful in neural networks and image processing where values \n    need to be normalized.\n\n    Applications\n    ------------\n    - Data normalization for neural networks.\n    - Preprocessing data in computer vision tasks.\n    - Scaling features for optimization problems.\n    \n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,), optional\n        The output values. If provided, it will be scaled as well.\n\n    Returns\n    -------\n    X_scaled : ndarray\n        Scaled version of X.\n    y_scaled : ndarray, optional\n        Scaled version of y, if y is provided.\n\n    Formula\n    -------\n    The MinMax Scaler performs the following operation for each feature:\n        z = \014rac{x - \\min(x)}{\\max(x) - \\min(x)}\n\n    Examples\n    --------\n    >>> X = np.array([[1, 2], [3, 4], [5, 6]])\n    >>> X_scaled = minmax_scaler(X)\n    ";
static const char __pyx_k_Union_ArrayLike_List_ArrayLike[] = "Union[ArrayLike, List[ArrayLike]]";
static const char __pyx_k_calculate_adjusted_lr_line_809[] = "calculate_adjusted_lr (line 809)";
static const char __pyx_k_compute_effort_yield_line_2440[] = "compute_effort_yield (line 2440)";
static const char __pyx_k_compute_youdens_index_line_466[] = "compute_youdens_index (line 466)";
static const char __pyx_k_infer_sankey_columns_line_2272[] = "infer_sankey_columns (line 2272)";
static const char __pyx_k_not_found_in_DataFrame_columns[] = "' not found in DataFrame columns.";
static const char __pyx_k_should_be_less_than_the_number[] = "' should be less than the number of given columns '";
static const char __pyx_k_torres_verdin_filter_line_4997[] = "torres_verdin_filter (line 4997)";
static const char __pyx_k_A_moving_average_is_used_with_t[] = " A moving average is  used with time series data to smooth out\n    short-term fluctuations and highlight longer-term trends or cycles.\n    \n    Funtion analyzes data points by creating a series of averages of different\n    subsets of the full data set. \n    \n    Parameters \n    ----------\n    y : array_like, shape (N,)\n        the values of the time history of the signal.\n        \n    window_size : int\n        the length of the window. Must be greater than 1 and preferably\n        an odd integer number.Default is ``3``\n        \n    method: str \n        variant of moving-average. Can be ``sma``, ``cma``, ``wma`` and ``ema`` \n        for simple, cummulative, weight and exponential moving average. Default \n        is ``sma``. \n        \n    mode: str\n        returns the convolution at each point of overlap, with an output shape\n        of (N+M-1,). At the end-points of the convolution, the signals do not \n        overlap completely, and boundary effects may be seen. Can be ``full``,\n        ``same`` and ``valid``. See :doc:`~np.convole` for more details. Default \n        is ``same``. \n        \n    alpha: float, \n        smoothing factor. Only uses in exponential moving-average. Default is \n        ``.5``.\n    \n    Returns \n    --------\n    ya: array like, shape (N,) \n        Averaged time history of the signal\n    \n    Notes \n    -------\n    The first element of the moving average is obtained by taking the average \n    of the initial fixed subset of the number series. Then the subset is\n    modified by \"shifting forward\"; that is, excluding the first number of the\n    series and including the next value in the subset.\n    \n    Examples\n    --------- \n    >>> import numpy as np ; import matplotlib.pyplot as plt \n    >>> from gofast.tools.tools   import moving_average \n    >>> data = np.random.randn (37) \n    >>> # add gaussion noise to the data \n    >>> data = 2 * np.sin( data)  + np.random.normal (0, 1 , len(data))\n   "" >>> window = 5  # fixed size to 5 \n    >>> sma = moving_average(data, window) \n    >>> cma = moving_average(data, window, method ='cma' )\n    >>> wma = moving_average(data, window, method ='wma' )\n    >>> ema = moving_average(data, window, method ='ema' , alpha =0.6)\n    >>> x = np.arange(len(data))\n    >>> plt.plot (x, data, 'o', x, sma , 'ok--', x, cma, 'g-.', x, wma, 'b:')\n    >>> plt.legend (['data', 'sma', 'cma', 'wma'])\n    \n    References \n    ----------\n    .. * [1] https://en.wikipedia.org/wiki/Moving_average\n    .. * [2] https://www.sciencedirect.com/topics/engineering/hanning-window\n    .. * [3] https://stackoverflow.com/questions/12816011/weighted-moving-average-with-numpy-convolve\n    \n    ";
static const char __pyx_k_Adaptative_moving_average_as_sm[] = " Adaptative moving average as  smoothing technique. \n \n    Parameters \n    -----------\n    data: Arraylike \n       Noise data for smoothing \n       \n    window_size_factor: float, default=0.1 \n      Parameter to control the adaptiveness of the moving average.\n       \n    Return \n    --------\n    result: Arraylike \n       Smoothed data \n    \n    Example \n    ---------\n    >>> import matplotlib.pyplot as plt\n    >>> from gofast.tools.mathex  import adaptive_moving_average \n    >>> # Sample magnetotelluric data (replace this with your own data)\n    >>> # Example data: a sine wave with noise\n    >>> time = np.linspace(0, 10, 1000)  # Replace with your actual time values\n    >>> mt_data = np.sin(2 * np.pi * 1 * time) + 0.2 * np.random.randn(1000)  # Example data\n    >>> # Function to calculate the adaptive moving average\n    >>> # Define the window size factor (adjust as needed)\n    >>> window_size_factor = 0.1  # Adjust this value based on your data characteristics\n    >>> # Apply adaptive moving average to the magnetotelluric data\n    >>> smoothed_data = adaptive_moving_average(mt_data, window_size_factor)\n    >>> # Plot the original and smoothed data\n    >>> plt.figure(figsize=(10, 6))\n    >>> plt.plot(time, mt_data, 'b-', label='Original Data')\n    >>> plt.plot(time, smoothed_data, 'r-', label='Smoothed Data (AMA)')\n    >>> plt.xlabel('Time')\n    >>> plt.ylabel('Amplitude')\n    >>> plt.title('Adaptive Moving Average (AMA) Smoothing')\n    >>> plt.legend()\n    >>> plt.grid(True)\n    >>> plt.show()\n    ";
static const char __pyx_k_Adjust_y_true_and_y_pred_for_re[] = "\n    Adjust y_true and y_pred for regression tasks by accounting for the influence\n    of specified control variables through residualization.\n\n    This approach fits a linear model to predict y_true and y_pred solely based on\n    control variables, and then computes the residuals. These residuals represent\n    the portion of y_true and y_pred that cannot be explained by the control\n    variables, effectively isolating the effect of the predictors of interest.\n\n    Parameters\n    ----------\n    y_true : array-like of shape (n_samples,)\n        True target values for regression.\n    y_pred : array-like of shape (n_samples,)\n        Predicted target values for regression.\n    control_vars : array-like or list of array-likes\n        Control variables to adjust for. Can be a single array or a list of arrays.\n\n    Returns\n    -------\n    adjusted_y_true : ndarray of shape (n_samples,)\n        Adjusted true target values, with the influence of control variables removed.\n    adjusted_y_pred : ndarray of shape (n_samples,)\n        Adjusted predicted target values, with the influence of control variables removed.\n\n    Raises\n    ------\n    ValueError\n        If y_true or y_pred are not 1-dimensional arrays.\n\n    Notes\n    -----\n    This function uses LinearRegression from sklearn.linear_model to fit models\n    predicting y_true and y_pred from the control variables. The residuals from\n    these models (the differences between the observed and predicted values) are\n    the adjusted targets.\n\n    The mathematical concept behind this adjustment is as follows:\n    \n    .. math::\n        \text{adjusted\\_y} = y - \\hat{y}_{\text{control}}\n        \n    where :math:`\\hat{y}_{\text{control}}` is the prediction from a linear model\n    trained only on the control variables.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import adjust_for_control_vars_regression\n    >>> y_true = np.array([3, 5, 7, 9])\n    >>> y_pred = np.ar""ray([4, 6, 8, 10])\n    >>> control_vars = np.array([1, 2, 3, 4])\n    >>> adjusted_y_true, adjusted_y_pred = adjust_for_control_vars_regression(\n    ... y_true, y_pred, control_vars)\n    >>> print(adjusted_y_true)\n    >>> print(adjusted_y_pred)\n\n    References\n    ----------\n    .. [1] Freedman, D. A. (2009). Statistical Models: Theory and Practice. \n          Cambridge University Press.\n    \n    See Also\n    --------\n    sklearn.linear_model.LinearRegression\n    ";
static const char __pyx_k_Adjusts_y_true_and_y_pred_for_e[] = "\n    Adjusts y_true and y_pred for either regression or classification tasks by \n    removing the influence of control variables. \n    \n    The function serves as a wrapper that decides the adjustment strategy \n    based on the type of task (regression or classification) inferred from y_true.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True target values. The nature of these values (continuous for regression or \n        categorical for classification) determines the adjustment strategy.\n    y_pred : array-like\n        Predicted target values. Must have the same shape as `y_true`.\n    control_vars : array-like or list of array-likes, optional\n        Control variables to adjust for. Can be a single array or a list of arrays. \n        If None, no adjustment is performed.\n\n    Returns\n    -------\n    adjusted_y_true : ndarray\n        Adjusted true target values, with the influence of control variables \n        removed.\n    adjusted_y_pred : ndarray\n        Adjusted predicted target values, with the influence of control \n        variables removed.\n\n    Notes\n    -----\n    The function dynamically determines whether the targets suggest a \n    regression or classification task and applies the appropriate adjustment\n    method. For regression, the adjustment involves residualizing the targets \n    against the control variables. \n    For classification, the approach might involve stratification or other \n    methods to control for the variables' influence.\n\n    In practice, this adjustment is crucial when control variables might \n    confound or otherwise influence the relationship between the predictors \n    and the target variable, potentially biasing the correlation measure.\n\n    Examples\n    --------\n    >>> y_true = np.array([1, 2, 3, 4])\n    >>> y_pred = np.array([1.1, 1.9, 3.2, 3.8])\n    >>> control_vars = np.array([1, 1, 2, 2])\n    >>> adjusted_y_true, adjusted_y_pred = adjust_for_control_vars(\n    ..."" y_true, y_pred, control_vars)\n    # Adjusted values depend on the specific implementation for regression\n    or classification.\n\n    See Also\n    --------\n    adjust_for_control_vars_regression : \n        Function to adjust targets in a regression task.\n    adjust_for_control_vars_classification : \n        Function to adjust targets in a classification task.\n\n    References\n    ----------\n    .. [1] K. Pearson, \"On the theory of contingency and its relation to \n           association and normal correlation,\" Drapers' Company Research \n           Memoirs (Biometric Series I), London, 1904.\n    .. [2] D. C. Montgomery, E. A. Peck, and G. G. Vining, \"Introduction to\n           Linear Regression Analysis,\" 5th ed., Wiley, 2012.\n    ";
static const char __pyx_k_Apply_a_Savitzky_Golay_filter_t[] = " Apply a Savitzky-Golay filter to an array.\n\n    This is a 1-D filter. If `x`  has dimension greater than 1, `axis`\n    determines the axis along which the filter is applied.\n\n    Parameters\n    ----------\n    x : array_like\n        The data to be filtered. If `x` is not a single or double precision\n        floating point array, it will be converted to type ``numpy.float64``\n        before filtering.\n    window_length : int\n        The length of the filter window (i.e., the number of coefficients).\n        `window_length` must be a positive odd integer. If `mode` is 'interp',\n        `window_length` must be less than or equal to the size of `x`.\n    polyorder : int\n        The order of the polynomial used to fit the samples.\n        `polyorder` must be less than `window_length`.\n    deriv : int, optional\n        The order of the derivative to compute. This must be a\n        nonnegative integer. The default is 0, which means to filter\n        the data without differentiating.\n    delta : float, optional\n        The spacing of the samples to which the filter will be applied.\n        This is only used if deriv > 0. Default is 1.0.\n    axis : int, optional\n        The axis of the array `x` along which the filter is to be applied.\n        Default is -1.\n    mode : str, optional\n        Must be 'mirror', 'constant', 'nearest', 'wrap' or 'interp'. This\n        determines the type of extension to use for the padded signal to\n        which the filter is applied.  When `mode` is 'constant', the padding\n        value is given by `cval`.  See the Notes for more details on 'mirror',\n        'constant', 'wrap', and 'nearest'.\n        When the 'interp' mode is selected (the default), no extension\n        is used.  Instead, a degree `polyorder` polynomial is fit to the\n        last `window_length` values of the edges, and this polynomial is\n        used to evaluate the last `window_length // 2` output values.\n    cval : scalar, optional\n      ""  Value to fill past the edges of the input if `mode` is 'constant'.\n        Default is 0.0.\n\n    Returns\n    -------\n    y : ndarray, same shape as `x`\n        The filtered data.\n\n    See Also\n    --------\n    savgol_coeffs\n\n    Notes\n    -----\n    Details on the `mode` options:\n\n        'mirror':\n            Repeats the values at the edges in reverse order. The value\n            closest to the edge is not included.\n        'nearest':\n            The extension contains the nearest input value.\n        'constant':\n            The extension contains the value given by the `cval` argument.\n        'wrap':\n            The extension contains the values from the other end of the array.\n\n    For example, if the input is [1, 2, 3, 4, 5, 6, 7, 8], and\n    `window_length` is 7, the following shows the extended data for\n    the various `mode` options (assuming `cval` is 0)::\n\n        mode       |   Ext   |         Input          |   Ext\n        -----------+---------+------------------------+---------\n        'mirror'   | 4  3  2 | 1  2  3  4  5  6  7  8 | 7  6  5\n        'nearest'  | 1  1  1 | 1  2  3  4  5  6  7  8 | 8  8  8\n        'constant' | 0  0  0 | 1  2  3  4  5  6  7  8 | 0  0  0\n        'wrap'     | 6  7  8 | 1  2  3  4  5  6  7  8 | 1  2  3\n\n    .. versionadded:: 0.14.0\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex  import savgol_filter\n    >>> np.set_printoptions(precision=2)  # For compact display.\n    >>> x = np.array([2, 2, 5, 2, 1, 0, 1, 4, 9])\n\n    Filter with a window length of 5 and a degree 2 polynomial.  Use\n    the defaults for all other parameters.\n\n    >>> savgol_filter(x, 5, 2)\n    array([1.66, 3.17, 3.54, 2.86, 0.66, 0.17, 1.  , 4.  , 9.  ])\n\n    Note that the last five values in x are samples of a parabola, so\n    when mode='interp' (the default) is used with polyorder=2, the last\n    three values are unchanged. Compare that to, for example,\n    `mode='nearest'`:\n\n    >>> savgol_f""ilter(x, 5, 2, mode='nearest')\n    array([1.74, 3.03, 3.54, 2.86, 0.66, 0.17, 1.  , 4.6 , 7.97])\n\n    ";
static const char __pyx_k_Axis_must_be_specified_Otherwis[] = ". Axis must be specified. Otherwise axis=0 is used .";
static const char __pyx_k_Bins_must_be_auto_or_a_positive[] = "Bins must be 'auto' or a positive integer.";
static const char __pyx_k_Calculate_sensitivity_and_speci[] = "\n    Calculate sensitivity and specificity for binary classification results,\n    optionally using sample weights to adjust the importance of each sample.\n\n    Parameters\n    ----------\n    y_true : array-like\n        Binary ground truth labels (1 for positive class, 0 for negative class).\n    y_pred : array-like\n        Binary predicted labels (1 for positive class, 0 for negative class).\n    sample_weight : array-like, optional\n        Weights applied to each sample when calculating sensitivity and specificity.\n        If None, all samples are assumed to have equal weight. Sample weights are\n        typically used in datasets where some samples are more important than\n        others or in the presence of class imbalance.\n    epsilon : float, optional\n        Small value added to denominators to avoid division by zero. \n        Default is 1e-10.\n\n    Returns\n    -------\n    tuple\n        A tuple containing the sensitivity and specificity values.\n\n    Notes\n    -----\n    Sensitivity and specificity are calculated using the following formulas:\n    \n    .. math::\n        \text{sensitivity} = \014rac{\\sum (w_i \\cdot [y_{true}^i = 1 \\cap y_{pred}^i = 1])}\n        {\\sum (w_i \\cdot [y_{true}^i = 1]) + \\epsilon}\n\n    .. math::\n        \text{specificity} = \014rac{\\sum (w_i \\cdot [y_{true}^i = 0 \\cap y_{pred}^i = 0])}\n        {\\sum (w_i \\cdot [y_{true}^i = 0]) + \\epsilon}\n\n    Where \\( w_i \\) are the sample weights. If `sample_weight` is None,\n    all weights are considered equal to 1.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_binary_metrics\n    >>> y_true = [1, 0, 1, 1, 0, 1, 0, 0]\n    >>> y_pred = [1, 0, 0, 1, 0, 1, 1, 0]\n    >>> sensitivity, specificity = calculate_binary_metrics(y_true, y_pred)\n    >>> print(f\"Sensitivity: {sensitivity:.2f}, Specificity: {specificity:.2f}\")\n    Sensitivity: 0.75, Specificity: 0.75\n\n    >>> weights = [1, 1, 2, 2, 1, 2, 1, 1]\n    >>> sensit""ivity, specificity = calculate_binary_metrics(y_true, y_pred, sample_weight=weights)\n    >>> print(f\"Sensitivity: {sensitivity:.2f}, Specificity: {specificity:.2f}\")\n    Sensitivity: 0.80, Specificity: 0.83\n    ";
static const char __pyx_k_Calculate_the_Information_Value[] = "\n    Calculate the Information Value (IV) for binary classification problems\n    using a base or binning approach. This function provides flexibility in\n    IV calculation by allowing for simple percentage-based calculations or\n    detailed binning techniques to understand the predictive power across\n    the distribution of predicted probabilities.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True binary labels.\n    y_pred : array-like\n        Predicted probabilities for the positive class.\n    epsilon : float or 'auto', optional\n        A small epsilon value added to probabilities to prevent division\n        by zero in logarithmic calculations. If 'auto', dynamically determines\n        an appropriate epsilon based on `y_pred`. Default is 1e-15.\n    method : str, optional\n        The method for calculating IV. Options are 'base' for a direct approach\n        using the overall percentage of events, and 'binning' for a detailed\n        analysis using bins of predicted probabilities. Default is 'base'.\n    bins : int or 'auto', optional\n        The number of bins to use for the 'binning' method. If 'auto', the\n        optimal number of bins is calculated based on `bins_method`.\n        Default is 'auto'.\n    bins_method : str, optional\n        Method to use for calculating the optimal number of bins when\n        `bins` is 'auto'. Options include 'freedman_diaconis', 'sturges', \n        and 'sqrt'. Default is 'freedman_diaconis'.\n    data_range : tuple, optional\n        A tuple specifying the range of the data as (min, max) for bin\n        calculation. If None, the range is derived from `y_pred`. Default is None.\n\n    Returns\n    -------\n    float\n        The calculated Information Value (IV).\n\n    Raises\n    ------\n    ValueError\n        If an invalid method is specified.\n\n    Examples\n    --------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import calculate_binary_iv\n    >>> y_true = np.""array([0, 1, 0, 1, 1])\n    >>> y_pred = np.array([0.1, 0.8, 0.2, 0.7, 0.9])\n    >>> print(calculate_binary_iv(y_true, y_pred, method='base'))\n    1.6094379124341003\n\n    >>> print(calculate_binary_iv(y_true, y_pred, method='binning', bins=3,\n    ...                           bins_method='sturges'))\n    0.6931471805599453\n\n    Notes\n    -----\n    The Information Value (IV) quantifies the predictive power of a feature or\n    model in binary classification, illustrating its ability to distinguish\n    between classes.\n\n    - The 'base' method calculates IV using the overall percentage of events\n      and non-events:\n\n      .. math::\n        IV = \\sum ((\\% \text{{ of non-events}} - \\% \text{{ of events}}) \times\n        \\ln\\left(\014rac{\\% \text{{ of non-events}} + \\epsilon}\n        {\\% \text{{ of events}} + \\epsilon}\right))\n\n    - The 'binning' method divides `y_pred` into bins and calculates IV for\n      each bin, summing up the contributions from all bins.\n\n    References\n    ----------\n    - Freedman, D. and Diaconis, P. (1981). \"On the histogram as a density estimator:\n      L2 theory.\" Zeitschrift f\303\274r Wahrscheinlichkeitstheorie und verwandte Gebiete.\n    - Sturges, H. A. (1926). \"The choice of a class interval.\" Journal of the American\n      Statistical Association.\n      \n    ";
static const char __pyx_k_Calculate_the_average_likelihoo[] = "\n    Calculate the average likelihood ratio for multiclass classification \n    based on the average sensitivity and specificity across all classes or \n    class pairs.\n\n    This function supports one-versus-rest (OvR) and one-versus-one (OvO) \n    strategies for multiclass data and computes the likelihood ratio either \n    positively or negatively based on the specified consensus.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True class labels as integers.\n    y_pred : array-like\n        Predicted class labels as integers.\n    strategy : str, optional\n        Specifies the computation strategy: 'ovr' for one-versus-rest or 'ovo' \n        for one-versus-one.\n    consensus : str, optional\n        'positive' for positive likelihood ratio or 'negative' for negative \n        likelihood ratio.\n    sample_weight : array-like, optional\n        Weights applied to classes in averaging sensitivity and specificity. \n        If None, equal weighting is assumed.\n    epsilon : float, optional\n        A small value to prevent division by zero in calculations. \n        Default is 1e-10.\n\n    Returns\n    -------\n    float\n        The computed average likelihood ratio.\n    float\n        The average sensitivity computed across classes or class pairs.\n    float\n        The average specificity computed across classes or class pairs.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_multiclass_avg_lr\n    >>> y_true = [0, 1, 2, 2, 1, 0]\n    >>> y_pred = [0, 2, 1, 2, 1, 0]\n    >>> lr, avg_sens, avg_spec = calculate_multiclass_avg_lr(\n    ...    y_true, y_pred, strategy='ovr', consensus='positive')\n    >>> print(f\"Likelihood Ratio: {lr:.2f}, \n    ...          Average Sensitivity: {avg_sens:.2f},\n    ...          Average Specificity: {avg_spec:.2f}\")\n    ";
static const char __pyx_k_Calculate_the_bearing_between_t[] = "\n    Calculate the bearing between two points. \n     \n    A bearing can be defined as  a direction of one point relative \n    to another point, usually given as an angle measured clockwise \n    from north.\n    The formula of the bearing :math:`\010eta` between two points 1(lat1 , lon1)\n    and 2(lat2, lon2) is expressed as below: \n        \n    .. math:: \n        \010eta = atan2(sin(y_2-y_1)*cos(x_2), cos(x_1)*sin(x_2) \342\200\223                       sin(x_1)*cos(x_2)*cos(y_2-y_1))\n     \n    where: \n       \n       - :math:`x_1`(lat1): the latitude of the first coordinate\n       - :math:`y_1`(lon1): the longitude of the first coordinate\n       - :math:`x_2`(lat2) : the latitude of the second coordinate\n       - :math:`y_2`(lon2): the longitude of the second coordinate\n    \n    Parameters \n    ----------- \n    latlon: Tuple ( latitude, longitude) \n       A latitude and longitude coordinates of the first point in degree. \n    latlon2: Tuple ( latitude, longitude) \n       A latitude and longitude of coordinates of the second point in degree.  \n       \n    to_deg: bool, default=True \n       Convert the bearing from radians to degree. \n      \n    Returns \n    ---------\n    b: Value of bearing in degree ( default). \n    \n    See More \n    ----------\n    See more details by clicking in the link below: \n        https://mapscaping.com/how-to-calculate-bearing-between-two-coordinates/\n        \n    Examples \n    ---------\n    >>> from gofast.tools import get_bearing \n    >>> latlon1 = (28.41196763902007, 109.3328724432221) # (lat, lon) point 1\n    >>> latlon2= (28.38756530909265, 109.36931920880758) # (lat, lon) point 2\n    >>> get_bearing (latlon1, latlon2 )\n    127.26739270447973 # in degree \n    ";
static const char __pyx_k_Calculate_the_multiclass_likeli[] = "\n    Calculate the multiclass likelihood ratio for classification using either \n    one-versus-rest (OvR) or one-versus-one (OvO) strategies. Optionally applies \n    logarithmic scaling to the likelihood ratios and can return sensitivity and \n    specificity values.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True class labels as integers.\n    y_pred : array-like\n        Predicted class labels as integers.\n    consensus : str, optional\n        Specifies the type of likelihood ratio to compute: 'positive' \n        (default) or 'negative'.\n    strategy : str, optional\n        Specifies the computation strategy: 'ovr' (one-versus-rest, default) \n        or 'ovo' (one-versus-one).\n    epsilon : float, optional\n        A small value to prevent division by zero in calculations. \n        Default is 1e-10. \n    multi_output : str, optional\n        If 'uniform_average', returns the average of the computed likelihood \n        ratios. If 'raw_values', returns the likelihood ratios for each class \n        comparison.\n    apply_log_scale : bool, optional\n        If True, applies the natural logarithm to the likelihood ratios, \n        returning the log-likelihood ratios.\n    include_metrics : bool, optional\n        If True, returns a tuple containing the likelihood ratios and arrays \n        of sensitivities and specificities.\n\n    Returns\n    -------\n    float or tuple\n        Depending on 'multi_output' and 'include_metrics', returns either the \n        average likelihood ratio, an array of likelihood ratios, or a tuple \n        containing the likelihood ratios and metrics arrays.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_multiclass_lr\n    >>> y_true = [0, 1, 2, 2, 1, 0]\n    >>> y_pred = [0, 2, 1, 2, 1, 0]\n    >>> calculate_multiclass_lr(y_true, y_pred, consensus='positive', strategy='ovr')\n    1.6765\n    \n    >>> from gofast.tools.mathex import calculate_multiclass_lr\n    >>>"" y_true = [0, 1, 2, 2, 1, 0]\n    >>> y_pred = [0, 2, 1, 2, 1, 0]\n    >>> calculate_multiclass_lr(y_true, y_pred, consensus='positive', strategy='ovr')\n    1.6765\n    \n    >>> calculate_multiclass_lr(y_true, y_pred, consensus='negative', strategy='ovo')\n    0.9890\n    \n    Notes\n    -----\n    The likelihood ratio (LR) for a given class or class pair is calculated as:\n    \n    .. math::\n        LR_+ = \\frac{\\text{sensitivity}}{1 - \\text{specificity}}\n    \n    or\n    \n    .. math::\n        LR_- = \\frac{1 - \\text{sensitivity}}{\\text{specificity}}\n    \n    If `apply_log_scale` is True, the log-likelihood ratio (LLR) is computed, \n    which transforms the LR using the natural logarithm:\n    \n    .. math::\n        LLR = \\log(LR)\n    \n    This transformation helps manage extreme values and improves the interpretability\n    of the results, especially when dealing with very high or very low likelihood ratios.\n    ";
static const char __pyx_k_Calculate_the_optimal_number_of[] = "\n    Calculate the optimal number of bins for histogramming a given set of \n    predictions, utilizing various heuristics. This function supports the \n    Freedman-Diaconis rule, Sturges' formula, and the Square-root choice, \n    allowing users to select the most appropriate method based on their data \n    distribution and size.\n\n    Parameters\n    ----------\n    y_pred : array-like\n        Predicted probabilities for the positive class. This array should be \n        one-dimensional.\n    method : str, optional\n        The binning method to use. Options include:\n        - 'freedman_diaconis': Uses the Freedman-Diaconis rule, which is \n          particularly useful for data with skewed distributions.\n          .. math:: \text{bin width} = 2 \\cdot \014rac{IQR}{\\sqrt[3]{n}}\n        - 'sturges': Uses Sturges' formula, ideal for normal distributions \n          but may be suboptimal for large datasets or non-normal distributions.\n          .. math:: \text{bins} = \\lceil \\log_2(n) + 1 \rceil\n        - 'sqrt': Employs the Square-root choice, a simple rule that works well \n          for small datasets.\n          .. math:: \text{bins} = \\lceil \\sqrt{n} \rceil\n        Default is 'freedman_diaconis'.\n    data_range : tuple, optional\n        A tuple specifying the range of the data as (min, max). If None, the \n        minimum and maximum values in `y_pred` are used. Default is None.\n\n    Returns\n    -------\n    int\n        The calculated optimal number of bins.\n\n    Raises\n    ------\n    ValueError\n        If an invalid `method` is specified.\n\n    Examples\n    --------\n    Calculate the optimal number of bins for a dataset of random predictions \n    using different methods:\n    \n    >>> from gofast.tools.mathex import calculate_optimal_bins\n    >>> y_pred = np.random.rand(100)\n    >>> print(calculate_optimal_bins(y_pred, method='freedman_diaconis'))\n    9\n    >>> print(calculate_optimal_bins(y_pred, method='sturges'))\n    7""\n    >>> print(calculate_optimal_bins(y_pred, method='sqrt'))\n    10\n\n    References\n    ----------\n    - Freedman, D. and Diaconis, P. (1981). On the histogram as a density estimator:\n      L2 theory. Zeitschrift f\303\274r Wahrscheinlichkeitstheorie und verwandte Gebiete, \n      57(4), 453-476.\n    - Sturges, H. A. (1926). The choice of a class interval. Journal of the American \n      Statistical Association, 21(153), 65-66.\n    ";
static const char __pyx_k_Calculate_the_residuals_for_reg[] = "\n    Calculate the residuals for regression, binary, or multiclass \n    classification tasks.\n\n    Parameters\n    ----------\n    actual : np.ndarray\n        The actual observed values or class labels.\n    predicted : Union[np.ndarray, List[np.ndarray]]\n        The predicted values for regression or class labels for classification.\n        Can be a list of predicted probabilities for each class from predict_proba.\n    task_type : str, default='regression'\n        The type of task: 'regression', 'binary', or 'multiclass'.\n    predict_proba : np.ndarray, optional\n        Predicted probabilities for each class from predict_proba \n        (for classification tasks).\n\n    Returns\n    -------\n    residuals : np.ndarray\n        The residuals of the model.\n\n    Example\n    -------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import calculate_residuals\n    >>> # For regression\n    >>> actual = np.array([3, -0.5, 2, 7])\n    >>> predicted = np.array([2.5, 0.0, 2, 8])\n    >>> residuals = calculate_residuals(actual, predicted, task_type='regression')\n    >>> print(residuals)\n\n    >>> # For binary classification\n    >>> actual = np.array([0, 1, 0, 1])\n    >>> predicted = np.array([0, 1, 0, 1])  # predicted class labels\n    >>> residuals = calculate_residuals(actual, predicted, task_type='binary')\n    >>> print(residuals)\n\n    >>> # For multiclass classification with predict_proba\n    >>> actual = np.array([0, 1, 2, 1])\n    >>> predict_proba = np.array([[0.7, 0.2, 0.1], [0.1, 0.7, 0.2], \n                                  [0.2, 0.2, 0.6], [0.1, 0.8, 0.1]])\n    >>> residuals = calculate_residuals(actual, None, task_type='multiclass',\n                                        predict_proba=predict_proba)\n    >>> print(residuals)\n    ";
static const char __pyx_k_Check_the_quality_control_in_th[] = "\n    Check the quality control in the collection of Z or EDI objects. \n    \n    Analyse the data in the EDI collection and return the quality control value.\n    It indicates how percentage are the data to be representative.\n   \n    Parameters \n    ----------\n    \n    ar: Arraylike of (m_samples, n_features)\n       Arraylike  two dimensional data.\n        \n    tol: float, default=.5 \n        the tolerance parameter. The value indicates the rate from which the \n        data can be consider as meaningful. Preferably it should be less than\n        1 and greater than 0.  Default is ``.5`` means 50 %. Analysis becomes \n        soft with higher `tol` values and severe otherwise. \n        \n    return_data: bool, default= False, \n        returns the valid data from up to ``1-tol%`` goodness. \n        \n    return qco: bool, default=False, \n       retuns quality control object that wraps all usefull informations after \n       control. The following attributes can be fetched as: \n           \n       - rate_: the rate of the quality of the data  \n       - component_: The selected component where data is selected for analysis \n         By default used either ``xy`` or ``yx``. \n       - mode_: The :term:`EM` mode. Either the ['TE'|'TM'] modes \n       - freqs_: The valid frequency in the data selected according to the \n         `tol` parameters. Note that if ``interpolate_freq`` is ``True``, it \n         is used instead. \n       - invalid_freqs_: Useless frequency dropped in the data during control \n       - data_: Valid tensor data either in TE or TM mode. \n       \n    Returns \n    -------\n    Tuple (float  )  or (float, array-like, shape (N, )) or QCo\n        - return the quality control value and interpolated frequency if  \n         `return_freq`  is set to ``True`` otherwise return the\n         only the quality control ratio.\n        - return the the quality control object. \n        \n    Examples \n    -----------\n    >>> import gofast"" as gf \n    >>> data = gf.fetch_data ('huayuan', samples =20, return_data =True ,\n                              key='raw')\n    >>> r,= gf.qc (data)\n    r\n    Out[61]: 0.75\n    >>> r, = gf.qc (data, tol=.2 )\n    0.75\n    >>> r, = gf.qc (data, tol=.1 )\n    \n    ";
static const char __pyx_k_Compute_Errors_Standard_Deviati[] = " Compute Errors ( Standard Deviation ) and standard errors. \n    \n    Standard error and standard deviation are both measures of variability:\n    - The standard deviation describes variability within a single sample. Its\n      formula is given as: \n          \n      .. math:: \n          \n          SD = \\sqrt{ \\sum |x -\\mu|^2}{N}\n          \n      where :math:`\\sum` means the \"sum of\", :math:`x` is the value in the data \n      set,:math:`\\mu` is the mean of the data set and :math:`N` is the number \n      of the data points in the population. :math:`SD` is the quantity \n      expressing by how much the members of a group differ from the mean \n      value for the group.\n      \n    - The standard error estimates the variability across multiple \n      samples of a population. Different formulas are used depending on \n      whether the population standard deviation is known.\n      \n      - when the population standard deviation is known: \n      \n        .. math:: \n          \n            SE = \014rac{SD}{\\sqrt{N}} \n            \n      - When the population parameter is unknwon \n      \n        .. math:: \n            \n            SE = \014rac{s}{\\sqrt{N}} \n            \n       where :math:`SE` is the standard error, : math:`s` is the sample\n       standard deviation. When the population standard is knwon the \n       :math:`SE` is more accurate. \n    \n    Note that the :math:`SD` is  a descriptive statistic that can be \n    calculated from sample data. In contrast, the standard error is an \n    inferential statistic that can only be estimated \n    (unless the real population parameter is known). \n    \n    Parameters\n    ----------\n    arr : array_like , 1D or 2D \n      Array for computing the standard deviation \n      \n    error: str, default='std'\n      Name of error to compute. By default compute the standard deviation. \n      Can also compute the the standard error estimation if the  argument \n      is passed to ``ste``"". \n    return_confidence: bool, default=False, \n      If ``True``, returns the confidence interval with 95% of sample means \n      \n    Returns \n    --------\n    err: arraylike 1D or 2D \n       Error array. \n       \n    Examples\n    ---------\n    >>> from gofast.tools.mathex  import compute_errors\n    >>> from gofast.datasets import make_mining_ops \n    >>> mdata = make_mining_ops ( samples =20, as_frame=True, noises=\"20%\", return_X_y=False)\n    >>> compute_errors (mdata)\n    Easting_m                    301.216454\n    Northing_m                   301.284073\n    Depth_m                      145.343063\n    OreConcentration_Percent       5.908375\n    DrillDiameter_mm              50.019249\n    BlastHoleDepth_m               3.568771\n    ExplosiveAmount_kg           142.908481\n    EquipmentAge_years             4.537603\n    DailyProduction_tonnes      2464.819019\n    dtype: float64\n    >>> compute_errors ( mdata, return_confidence= True)\n    (Easting_m                   -100.015509\n     Northing_m                  -181.088446\n     Depth_m                      -67.948155\n     OreConcentration_Percent      -3.316211\n     DrillDiameter_mm              25.820805\n     BlastHoleDepth_m               1.733541\n     ExplosiveAmount_kg             3.505198\n     EquipmentAge_years            -1.581202\n     DailyProduction_tonnes      1058.839261\n     dtype: float64,\n     Easting_m                    1080.752992\n     Northing_m                    999.945119\n     Depth_m                       501.796651\n     OreConcentration_Percent       19.844618\n     DrillDiameter_mm              221.896260\n     BlastHoleDepth_m               15.723123\n     ExplosiveAmount_kg            563.706443\n     EquipmentAge_years             16.206202\n     DailyProduction_tonnes      10720.929814\n     dtype: float64)\n    ";
static const char __pyx_k_Compute_Spearman_s_rank_correla[] = "\n    Compute Spearman's rank correlation coefficient with support for \n    sample weights, custom tie handling, and NaN policies. This function \n    extends the standard Spearman's rank correlation to offer more \n    flexibility and utility in statistical and machine learning applications.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True values for calculating the correlation. Must be 1D.\n    y_pred : array-like\n        Predicted values, corresponding to y_true.\n    sample_weight : array-like, optional\n        Weights for each pair of values. Default is None, which gives\n        equal weight to all values.\n    tie_method : {'average', 'min', 'max', 'dense', 'ordinal'}, optional\n        Method to handle ranking ties. Default is 'average'.\n    nan_policy : {'propagate', 'raise', 'omit'}, optional\n        Defines how to handle when input contains NaN. 'propagate' returns NaN,\n        'raise' throws an error, 'omit' ignores pairs with NaN.\n    control_vars : array-like, optional\n        Control variables for partial correlation. Default is None.\n    multioutput : {'raw_values', 'uniform_average'}, optional\n        Strategy for aggregating errors across multiple output dimensions:\n        - 'raw_values' : Returns an array of RMSLE values for each output.\n        - 'uniform_average' : Averages errors across all outputs.\n    Returns\n    -------\n    float\n        Spearman's rank correlation coefficient.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import optimized_spearmanr\n    >>> y_true = [1, 2, 3, 4, 5]\n    >>> y_pred = [5, 6, 7, 8, 7]\n    >>> optimized_spearmanr(y_true, y_pred)\n    0.8208\n\n    Notes\n    -----\n    Spearman's rank correlation assesses monotonic relationships by using the \n    ranked values for each variable. It is a non-parametric measure of \n    statistical dependence between two variables [1]_.\n\n    .. math::\n        \\rho = 1 - \\frac{6 \\sum d_i^2}{n(n^2 - 1)}\n\n    where"" \\(d_i\\) is the difference between the two ranks of each observation, \n    and \\(n\\) is the number of observations [2]_.\n\n    This extended implementation allows for weighted correlation calculation, \n    handling of NaN values according to a specified policy, and consideration \n    of control variables for partial correlation analysis.\n\n    References\n    ----------\n    .. [1] Spearman, C. (1904). \"The proof and measurement of association \n           between two things\".\n    .. [2] Myer, K., & Waller, N. (2009). Applied Spearman's rank correlation. \n           Statistics in Medicine.\n\n    See Also\n    --------\n    scipy.stats.spearmanr : Spearman correlation calculation in SciPy.\n    ";
static const char __pyx_k_Compute_Youden_s_Index_and_opti[] = "\n    Compute Youden's Index and optimal threshold.\n\n    Youden's Index is a single statistic that captures the performance of a\n    binary classification test. \n    It's defined as the maximum vertical distance between the ROC curve and \n    the diagonal line.\n    Mathematically, it is calculated as:\n    \n    .. math::\n        J = \text{True Positive Rate} - \text{False Positive Rate}\n\n    Parameters:\n    -----------\n    y_true : array-like of shape (n_samples,)\n        True binary labels.\n    y_scores : array-like of shape (n_samples,)\n        Target scores, can either be probability estimates of the positive class,\n        confidence values, or non-thresholded measure of decisions (as returned\n        by decision_function on some classifiers).\n    sample_weight : array-like of shape (n_samples,), optional (default=None)\n        Sample weights.\n    pos_label : int or str, optional (default=None)\n        The label of the positive class.\n    drop_intermediate : bool, optional (default=True)\n        Whether to drop some suboptimal thresholds that do not appear\n        on a ROC curve with vertical drops.\n\n    Returns:\n    --------\n    optimal_threshold : float\n        The optimal threshold that maximizes Youden's Index.\n    optimal_youden : float\n        The value of Youden's Index at the optimal threshold.\n    \n    Examples:\n    ---------\n    >>> from gofast.tools.mathex import compute_youdens_index\n    >>> y_true = [0, 1, 1, 0, 1]\n    >>> y_scores = [0.1, 0.8, 0.3, 0.6, 0.9]\n    >>> optimal_threshold, optimal_youden = compute_youdens_index(y_true, y_scores)\n    >>> print(\"Optimal Threshold:\", optimal_threshold)\n    Optimal Threshold: 0.8\n    >>> print(\"Youden's Index:\", optimal_youden)\n    Youden's Index: 0.6\n    \n    ";
static const char __pyx_k_Compute_azimuth_from_coordinate[] = "Compute azimuth from coordinate locations ( latitude,  longitude). \n    \n    If `easting` and `northing` are given rather than `longitude` and  \n    `latitude`, the projection should explicitely set to ``UTM`` to perform \n    the ideal conversion. However if mode is set to `soft` (default), the type\n    of projection is automatically detected . Note that when UTM coordinates \n    are provided, `xlon` and `ylat` fit ``easting`` and ``northing`` \n    respectively.\n    \n    Parameters\n    -----------\n    xlon, ylat : Arraylike 1d or str, str \n       ArrayLike of easting/longitude and arraylike of nothing/latitude. They \n       should be one dimensional. In principle if data is supplied, they must \n       be series.  If `xlon` and `ylat` are given as string values, the \n       `data` must be supplied. xlon and ylat names must be included in the  \n       dataframe otherwise an error raises. \n       \n    data: pd.DataFrame, \n       Data containing x and y names. Need to be supplied when x and y \n       are given as string names. \n       \n    utm_zone: Optional, string\n       zone number and 'S' or 'N' e.g. '55S'. Default to the centre point\n       of coordinates points in the survey area. It should be a string (##N or ##S)\n       in the form of number and North or South hemisphere, 10S or 03N\n       \n    projection: str, ['utm'|'ll'] \n       The coordinate system in which the data points for the profile is collected. \n       when `mode='soft'`,  the auto-detection will be triggered and find the \n       suitable coordinate system. However, it is recommended to explicitly \n       provide projection when data is in UTM coordinates. \n       Note that if `x` and `y` are composed of value greater than 180 degrees \n       for longitude and 90 degrees for latitude, and method is still in \n       the ``soft` mode, it should be considered as  longitude-latitude ``UTM``\n       coordinates system. \n       \n    isdeg: bool, default=True \n      By ""default xlon and xlat are in degree coordinates. If both arguments \n      are given in radians, set to ``False`` instead. \n      \n    mode: str , ['soft'|'strict']\n      ``strict`` mode does not convert any coordinates system to other at least\n      it is explicitly set to `projection` whereas the `soft` does.\n      \n    extrapolate: bool, default=False \n      In principle, the azimuth is compute between two points. Thus, the number\n      of values computed for :math:`N` stations should  be  :math:`N-1`. To fit\n      values to match the number of size of the array, `extrapolate` should be \n      ``True``. In that case, the first station holds a <<fake>> azimuth as \n      the closer value computed from interpolation of all azimuths. \n      \n    view: bool, default=False, \n       Quick view of the azimuth. It is usefull especially when \n       extrapolate is set to ``True``. \n       \n    Return \n    --------\n    azim: ArrayLike \n       Azimuth computed from locations. \n       \n    Examples \n    ----------\n    >>> import gofast as gf \n    >>> from gofast.tools.mathex  import get_azimuth \n    >>> # generate a data from ERP \n    >>> data = gf.make_erp (n_stations =7 ).frame \n    >>> get_azimuth ( data.longitude, data.latitude)\n    array([54.575, 54.575, 54.575, 54.575, 54.575, 54.575])\n    >>> get_azimuth ( data.longitude, data.latitude, view =True, extrapolate=True)\n    array([54.57500007, 54.575     , 54.575     , 54.575     , 54.575     ,\n           54.575     , 54.575     ])\n    \n    ";
static const char __pyx_k_Compute_distance_between_points[] = "\n    Compute distance between points.\n    \n    Parameters\n    ------------\n    x, y: ArrayLike 1d, \n       One dimensional arrays. `x` can be consider as the abscissa of the  \n       landmark and `y` as ordinates array. \n       \n    return_mean_dist: bool, default =False, \n       Returns the average value of the distance between different points. \n       \n    is_latlon: bool, default=False, \n        Convert `x` and `y` latitude  and longitude coordinates values \n        into UTM before computing the distance. `x`, `y` should be considered \n        as ``easting`` and ``northing`` respectively. \n        \n    kws: dict, \n       Keyword arguments passed to :meth:`gofast.site.Location.to_utm_in`\n       \n    Returns \n    ---------\n    d: Arraylike of shape (N-1) \n      Is the distance between points. \n      \n    Examples \n    --------- \n    >>> import numpy as np \n    >>> from gofast.tools.mathex  import get_distance \n    >>> x = np.random.rand (7) *10 \n    >>> y = np.abs ( np.random.randn (7) * 12 ) \n    >>> get_distance (x, y) \n    array([ 8.7665511 , 12.47545656,  8.53730212, 13.54998351, 14.0419387 ,\n           20.12086781])\n    >>> get_distance (x, y, return_mean_dist= True) \n    12.91534996818084\n    ";
static const char __pyx_k_Compute_effort_and_yield_values[] = "\n    Compute effort and yield values from importance data for use in \n    ABC analysis or similar plots.\n\n    This function takes an array of importance measures (e.g., weights, scores) \n    and computes the cumulative effort and corresponding yield. \n    The effort is the cumulative percentage of items when sorted by importance,\n    and the yield is the cumulative sum of importance\n    measures, also as a percentage of the total sum.\n\n    Parameters\n    ----------\n    d : np.ndarray\n        1D array of importance measures for each item or feature.\n    reverse : bool, optional\n        If True (default), sort the data in descending order \n        (highest importance first).\n        If False, sort in ascending order (lowest importance first).\n    \n    Returns\n    -------\n    effort : np.ndarray\n        The cumulative percentage of items considered, sorted by importance.\n    yield_ : np.ndarray\n        The cumulative sum of importance measures, normalized to the total \n        sum to represent the yield as a proportion of the total importance.\n\n    Example\n    -------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import compute_effort_yield\n    >>> importances = np.array([0.1, 0.4, 0.3, 0.2])\n    >>> effort, yield_ = compute_effort_yield(importances)\n    >>> print(effort)\n    >>> print(yield_)\n    \n    This would output:\n    >>> effort\n    [0.25 0.5  0.75 1.  ]\n    >>> yield_\n    [0.4  0.7  0.9  1.  ]\n\n    Note that the effort is simply the proportion of total items, \n    and the yield is the\n    cumulative proportion of the sum of importances.\n    ";
static const char __pyx_k_Compute_p_values_for_the_correl[] = "\n    Compute p-values for the correlation between each independent variable\n    and a dependent variable.\n\n    Parameters\n    ----------\n    data : pandas DataFrame\n        The DataFrame containing the dataset.\n    depvar : str or pandas Series\n        The name of the dependent variable as a string or a pandas Series.\n    method : {'pearson', 'spearman', 'kendall'}, optional\n        The correlation method to use. Default is 'pearson'.\n    significance_threshold : float, optional\n        The significance threshold for p-values. Default is 0.05.\n    ignore : str or list, optional\n        Columns to ignore during computation.\n\n    Returns\n    -------\n    p_values : :class:`gofast.api.summary.ResultSummary` object \n        A dictionary containing independent variables as keys and their \n        corresponding p-values.\n\n    Raises\n    ------\n    ValueError\n        If depvar is not found in DataFrame columns or if an invalid \n        correlation method is specified.\n\n    Notes\n    -----\n    - If depvar is a string, it checks whether it exists in the DataFrame's \n      columns. If it doesn't exist, it raises a ValueError.\n    - The function computes p-values for the specified correlation method \n      between each independent variable\n      and the dependent variable. It excludes the depvar column from the \n      computation if it's in the DataFrame.\n\n    Examples\n    --------\n    >>> import pandas as pd\n    >>> import numpy as np\n    >>> from gofast.tools.mathex import compute_p_values\n    >>> np.random.seed(0)\n    >>> data = pd.DataFrame({\n    ...     'x1': np.random.randn(100),\n    ...     'x2': np.random.randn(100),\n    ...     'y': np.random.randn(100)\n    ... })\n    >>> p_values = compute_p_values(data, 'y', method='pearson') \n    >>> print(p_values ) \n    P-values(\n      {\n\n           x1 : None\n           x2 : None\n\n      }\n    )\n\n    [ 2 entries ]\n    >>> p_values = compute_p_values(data, 'y', method='pea""rson',\n    ...                             significance_threshold=None)\n    >>> p_values\n    Out[76]: <P-values with 2 entries. Use print() to see detailed contents.>\n\n    >>> print(p_values)\n    P-values(\n      {\n\n           x1 : 0.4516405974318084\n           x2 : 0.5797578201347333\n\n      }\n    )\n\n    [ 2 entries ]\n    ";
static const char __pyx_k_Compute_sensitivity_and_specifi[] = "\n    Compute sensitivity and specificity for each pair of classes \n    (One-vs-One strategy).\n    Optionally returns sensitivity and specificity as arrays, averaging results \n    over all relevant pairs for each class.\n\n    Parameters:\n    y_true : array-like\n        Ground truth binary labels.\n    y_pred : array-like\n        Predicted binary labels.\n    labels : array-like\n        Array of unique class labels.\n    return_array : bool, default True\n        If True, returns sensitivity and specificity as numpy arrays averaged \n        over all pairs involving each class. If False, returns dictionaries\n        with pairs as keys.\n\n    Returns:\n    --------\n    tuple of (numpy.ndarray, numpy.ndarray) or (dict, dict)\n        Sensitivity and specificity either as arrays or dictionaries depending \n        on `return_array`.\n    Examples \n    ---------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import _compute_ovo_sens_spec\n    >>> labels = np.array([0, 1, 2])\n    >>> y_true = np.array([0, 1, 1, 2, 2, 0, 1, 2, 0])\n    >>> y_pred = np.array([0, 1, 2, 2, 0, 0, 1, 0, 2])\n    >>> sensitivity, specificity = _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True)\n    >>> print(\"Sensitivity:\", sensitivity)\n    >>> print(\"Specificity:\", specificity)\n    Sensitivity: [0.66666667 0.66666667 0.66666667]\n    Specificity: [0.66666667 1.         0.66666667]\n    ";
static const char __pyx_k_Compute_the_balanced_accuracy_f[] = "\n    Compute the balanced accuracy for binary or multiclass classification \n    problems, determining the appropriate calculation method based on the \n    label type and specified strategy.\n\n    Parameters\n    ----------\n    y_true : array-like of shape (n_samples,)\n        True labels for the classification task.\n    y_pred : array-like of shape (n_samples,)\n        Predicted labels from the classifier.\n    epsilon : float, default=1e-15\n        A small constant added to the denominator in calculations to prevent\n        division by zero.\n    zero_division : int, default=0\n        The value to return when a zero division occurs during calculation, \n        typically encountered when a class is missing in the predictions.\n    strategy : {'ovr', 'ovo'}, default='ovr'\n        Strategy for handling multiclass classification:\n        - 'ovr': One-vs-Rest, calculates balanced accuracy for each class\n          against all others.\n        - 'ovo': One-vs-One, calculates balanced accuracy for each pair \n          of classes.\n    normalize : bool, default=False\n        If True, normalizes the confusion matrix before calculating the \n        balanced accuracy.\n    sample_weight : array-like of shape (n_samples,), optional\n        Weights for each sample. If provided, the calculation will take \n        these into account.\n\n    Returns\n    -------\n    float or np.ndarray\n        The balanced accuracy score. Returns a single float for binary \n        classification or an array of scores for multiclass classification, \n        depending on the strategy.\n\n    Notes\n    -----\n    Balanced accuracy is particularly useful for evaluating classifiers \n    on imbalanced datasets. It calculates the average of recall obtained on \n    each class, effectively handling classes without bias.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import compute_balance_accuracy\n    >>> y_true = [0, 1, 1, 0, 1]\n    >>> y_pred = [0, 1, 0, 0, 1]""\n    >>> compute_balance_accuracy(y_true, y_pred)\n    0.833333333333333\n\n    For multiclass using One-vs-Rest strategy:\n    >>> y_true = [0, 1, 2, 0, 1]\n    >>> y_pred = [0, 2, 1, 0, 1]\n    >>> compute_balance_accuracy(y_true, y_pred, strategy='ovr')\n    array([1.        , 0.58333333, 0.375     ])\n\n    For multiclass using One-vs-One strategy:\n    >>> compute_balance_accuracy(y_true, y_pred, strategy='ovo')\n    array([1.        , 0.16666667, 0.16666667])\n    ";
static const char __pyx_k_Computes_the_data_structure_req[] = "\n    Computes the data structure required for generating a sunburst chart from\n    a DataFrame.\n    \n    The function allows for automatic inference of hierarchy and values if \n    not explicitly provided. This is useful for visualizing hierarchical \n    datasets where the relationship between parent and child categories is \n    important.\n\n    The sunburst chart provides insights into the proportion of categories at \n    multiple levels of the hierarchy through their area size. It is especially \n    useful in identifying patterns and contributions of various parts to the \n    whole in a dataset.\n\n    Parameters\n    ----------\n    df : pd.DataFrame\n        The DataFrame containing the hierarchical data. It should have columns \n        representing levels of the hierarchy and optionally a column for values.\n    hierarchy : Optional[List[str]], optional\n        The list of columns that represent the hierarchy levels, ordered from \n        top to bottom. If not provided, the function assumes all columns except\n        the last one are part of the hierarchy.\n    value_column : Optional[str], optional\n        The name of the column that contains the values for each leaf node in \n        the sunburst chart. If not provided, the function will count the \n        occurrences of the lowest hierarchy level and use this count as the \n        value for each leaf node.\n\n    Returns\n    -------\n    List[Dict[str, str]]\n        A list of dictionaries where each dictionary represents a node in the\n        sunburst chart with 'name', 'value', and 'parent' keys.\n\n    Examples\n    --------\n    >>> df = pd.DataFrame({\n    ...     'Category': ['A', 'A', 'B', 'B'],\n    ...     'Subcategory': ['A1', 'A2', 'B1', 'B2']\n    ... })\n    >>> data = compute_sunburst_data(df)\n    >>> print(data)\n    [\n        {'name': 'A', 'value': 2, 'parent': ''},\n        {'name': 'B', 'value': 2, 'parent': ''},\n        {'name': 'A1', 'value': 1, 'parent': 'A'},\n   ""     {'name': 'A2', 'value': 1, 'parent': 'A'},\n        {'name': 'B1', 'value': 1, 'parent': 'B'},\n        {'name': 'B2', 'value': 1, 'parent': 'B'}\n    ]\n    ";
static const char __pyx_k_Correct_data_location_or_positi[] = " Correct data location or position and return new corrected location \n    \n    Parameters \n    ----------\n    ydata: array_like, series or dataframe\n        The dependent data, a length M array - nominally ``f(xdata, ...)``.\n        \n    xdata: array_like or object\n        The independent variable where the data is measured. Should usually \n        be an M-length sequence or an (k,M)-shaped array for functions with\n        k predictors, but can actually be any object. If ``None``, `xdata` is \n        generated by default using the length of the given `ydata`.\n        \n    func: callable \n        The model function, ``f(x, ...)``. It must take the independent variable \n        as the first argument and the parameters to fit as separate remaining\n        arguments. The default `func` is ``linear`` function i.e  for ``f(x)= ax +b``. \n        where `a` is slope and `b` is the intercept value. Setting your own \n        function for better fitting is recommended. \n        \n    c_order: int or str\n        The index or the column name if ``ydata`` is given as a dataframe to \n        select the right column for scaling.\n    show: bool \n        Quick visualization of data distribution. \n\n    kws: dict \n        Additional keyword argument from  `scipy.optimize_curvefit` parameters. \n        Refer to `scipy.optimize.curve_fit`_.  \n        \n    Returns \n    --------\n    - ydata - array -like - Data scaled \n    - popt - array-like Optimal values for the parameters so that the sum of \n        the squared residuals of ``f(xdata, *popt) - ydata`` is minimized.\n    - pcov - array like The estimated covariance of popt. The diagonals provide\n        the variance of the parameter estimate. To compute one standard deviation \n        errors on the parameters use ``perr = np.sqrt(np.diag(pcov))``. How the\n        sigma parameter affects the estimated covariance depends on absolute_sigma \n        argument, as described above. If the Jacobian matrix at ""the solution\n        doesn\342\200\231t have a full rank, then \342\200\230lm\342\200\231 method returns a matrix filled with\n        np.inf, on the other hand 'trf' and 'dogbox' methods use Moore-Penrose\n        pseudoinverse to compute the covariance matrix.\n        \n    Examples\n    --------\n    >>> from gofast.tools import erpSelector, scalePosition \n    >>> df = erpSelector('data/erp/l10_gbalo.xlsx') \n    >>> df.columns \n    ... Index(['station', 'resistivity', 'longitude', 'latitude', 'easting',\n           'northing'],\n          dtype='object')\n    >>> # correcting northing coordinates from easting data \n    >>> northing_corrected, popt, pcov = scalePosition(ydata =df.northing , \n                                               xdata = df.easting, show=True)\n    >>> len(df.northing.values) , len(northing_corrected)\n    ... (20, 20)\n    >>> popt  # by default popt =(slope:a ,intercept: b)\n    ...  array([1.01151734e+00, 2.93731377e+05])\n    >>> # corrected easting coordinates using the default x.\n    >>> easting_corrected, *_= scalePosition(ydata =df.easting , show=True)\n    >>> df.easting.values \n    ... array([790284, 790281, 790277, 790270, 790265, 790260, 790254, 790248,\n    ...       790243, 790237, 790231, 790224, 790218, 790211, 790206, 790200,\n    ...       790194, 790187, 790181, 790175], dtype=int64)\n    >>> easting_corrected\n    ... array([790288.18571705, 790282.30300999, 790276.42030293, 790270.53759587,\n    ...       790264.6548888 , 790258.77218174, 790252.88947468, 790247.00676762,\n    ...       790241.12406056, 790235.2413535 , 790229.35864644, 790223.47593938,\n    ...       790217.59323232, 790211.71052526, 790205.8278182 , 790199.94511114,\n    ...       790194.06240407, 790188.17969701, 790182.29698995, 790176.41428289])\n    \n    ";
static const char __pyx_k_Correct_the_position_coordinate[] = "\n    Correct the position coordinates. \n     \n    By default, it consider `x` and `y` as easting/latitude and \n    northing/longitude coordinates respectively. It latitude and longitude \n    are given, specify the parameter `is_latlon` to ``True``. \n    \n    Parameters\n    ----------\n    x, y: ArrayLike 1d, \n       One dimensional arrays. `x` can be consider as the abscissa of the  \n       landmark and `y` as ordinates array. \n       \n    is_latlon: bool, default=False, \n       Convert `x` and `y` latitude  and longitude coordinates values \n       into UTM before computing the distance. `x`, `y` should be considered \n       as ``easting`` and ``northing`` respectively. \n           \n    step: float, Optional \n       The positions separation. If not given, the average distance between \n       all positions should be used instead. \n    use_average_dist: bool, default=False, \n       Use the distance computed between positions for the correction. \n    utm_zone: str,  Optional (##N or ##S)\n       UTM zone in the form of number and North or South hemisphere. For\n       instance '10S' or '03N'. Note that if `x` and `y` are UTM coordinates,\n       the `utm_zone` must be provide to accurately correct the positions, \n       otherwise the default value ``49R`` should be used which may lead to \n       less accuracy. \n       \n    shift: bool, default=True,\n       Shift the coordinates from the units of `step`. This is the default \n       behavor. If ``False``, the positions are just scaled. \n    \n    view: bool, default=True \n       Visualize the scaled positions \n       \n    kws: dict, \n       Keyword arguments passed to :func:`~.get_distance` \n    Returns \n    --------\n    xx, yy: Arraylike 1d, \n       The arrays of position correction from `x` and `y` using the \n       bearing. \n       \n    See Also \n    ---------\n    gofast.tools.mathex .get_bearing: \n        Compute the  direction of one point relative to another point. \n     "" \n    Examples\n    ---------\n    >>> from gofast.tools.mathex  import scale_positions \n    >>> east = [336698.731, 336714.574, 336730.305] \n    >>> north = [3143970.128, 3143957.934, 3143945.76]\n    >>> east_c , north_c= scale_positions (east, north, step =20, view =True  ) \n    >>> east_c , north_c\n    (array([336686.69198337, 336702.53498337, 336718.26598337]),\n     array([3143986.09866306, 3143973.90466306, 3143961.73066306]))\n    ";
static const char __pyx_k_Count_the_number_of_local_minim[] = "\n    Count the number of local minima in a 1D array.\n    \n    Parameters\n    ----------\n    arr : array_like\n        Input array.\n    method : {'base', 'robust'}, optional\n        Method to use for finding local minima. \n        'base' uses a simple comparison, while 'robust' \n        uses scipy's argrelextrema function. Default is 'robust'.\n    order : int, optional\n        How many points on each side to use for the comparison \n        to consider a point as a local minimum (only used with \n        'robust' method). Default is 1.\n    \n    Returns\n    -------\n    int\n        Number of local minima in the array.\n    \n    Examples\n    --------\n    >>> from gofast.tools.mathex import count_local_minima\n    >>> arr = [1, 3, 2, 4, 1, 0, 2, 1]\n    >>> count_local_minima(arr, method='base')\n    2\n    >>> count_local_minima(arr, method='robust')\n    3\n    \n    Notes\n    -----\n    - The 'base' method compares each element with its immediate \n      neighbors, which might be less accurate for noisy data.\n    - The 'robust' method uses scipy's argrelextrema function, which \n      allows for more flexible and accurate detection of local minima \n      by considering a specified number of neighboring points.\n    ";
static const char __pyx_k_Detect_station_position_and_ret[] = " Detect station position and return the index in positions\n    \n    :param s: str, int - Station location  in the position array. It should \n        be the positionning of the drilling location. If the value given\n        is type string. It should be match the exact position to \n        locate the drilling. Otherwise, if the value given is in float or \n        integer type, it should be match the index of the position array. \n         \n    :param p: Array-like - Should be the  conductive zone as array of \n        station location values. \n            \n    :returns: \n        - `s_index`- the position index location in the conductive zone.  \n        - `s`- the station position in distance. \n        \n    :Example: \n        \n        >>> import numpy as np \n        >>> from gofast.tools.mathex  import detect_station_position \n        >>> pos = np.arange(0 , 50 , 10 )\n        >>> detect_station_position (s ='S30', p = pos)\n        ... (3, 30.0)\n        >>> detect_station_position (s ='40', p = pos)\n        ... (4, 40.0)\n        >>> detect_station_position (s =2, p = pos)\n        ... (2, 20)\n        >>> detect_station_position (s ='sta200', p = pos)\n        ... WATexError_station: Station sta200             is out of the range; max position = 40\n    ";
static const char __pyx_k_Epsilon_must_be_a_numeric_value[] = "Epsilon must be a numeric value or 'auto'.";
static const char __pyx_k_Expect_squareform_condense_or_d[] = ". Expect 'squareform', 'condense' or 'design'.";
static const char __pyx_k_Gradient_descent_algorithm_to_f[] = " Gradient descent algorithm to  fit the best model parameter.\n    \n    Model can be changed to polynomial if degree is greater than 1. \n    \n    Parameters \n    -----------\n    z: arraylike, \n       vertical nodes containing the values of depth V\n    s: Arraylike, \n       vertical vector containin the resistivity values \n    alpha: float,\n       step descent parameter or learning rate. *Default* is ``0.01`\n    n_epochs: int, \n       number of iterations. *Default* is ``100``. Can be changed to other values\n    kind: str, {\"linear\", \"poly\"}, default= 'linear'\n      Type of model to fit. Linear model is selected as the default. \n    degree: int, default=1 \n       As the linear model is selected as the default since the degree is set \n       to ``1``\n    Returns \n    ---------\n    - `_F`: New model values with the best `W` parameters found.\n    - `W`: vector containing the parameters fits \n    - `cost_history`: Containing the error at each Itiretaions. \n        \n    Examples \n    -----------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex  import gradient_descent\n    >>> z= np.array([0, 6, 13, 20, 29 ,39, 49, 59, 69, 89, 109, 129, \n                     149, 179])\n    >>> res= np.array( [1.59268,1.59268,2.64917,3.30592,3.76168,\n                        4.09031,4.33606, 4.53951,4.71819,4.90838,\n          5.01096,5.0536,5.0655,5.06767])\n    >>> fz, weights, cost_history = gradient_descent(\n        z=z, s=res,n_epochs=10,alpha=1e-8,degree=2)\n    >>> import matplotlib.pyplot as plt \n    >>> plt.scatter (z, res)\n    >>> plt.plot(z, fz)\n    ";
static const char __pyx_k_If_mode_is_interp_window_length[] = "If mode is 'interp', window_length must be less than or equal to the size of x.";
static const char __pyx_k_Implement_a_simple_version_of_G[] = "\n    Implement a simple version of Gradient Boosting Regressor.\n\n    Gradient Boosting builds an additive model in a forward stage-wise fashion. \n    At each stage, regression trees are fit on the negative gradient of the loss function.\n\n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,)\n        The target values (real numbers).\n    n_estimators : int, default=100\n        The number of boosting stages to be run.\n    learning_rate : float, default=0.1\n        Learning rate shrinks the contribution of each tree by `learning_rate`.\n    max_depth : int, default=1\n        The maximum depth of the individual regression estimators.\n\n    Returns\n    -------\n    y_pred : ndarray of shape (n_samples,)\n        The predicted values.\n\n    Mathematical Formula\n    --------------------\n    Given a differentiable loss function L(y, F(x)), the general idea is \n    to iteratively construct additive models as follows:\n    \n    .. math:: \n        F_{m}(x) = F_{m-1}(x) + \\gamma_{m} h_{m}(x)\n\n    where F_{m} is the model at iteration m, \\gamma_{m} is the step size,\n    and h_{m} is the weak learner.\n\n    Notes\n    -----\n    Gradient Boosting is widely used in machine learning for regression and \n    classification problems. It's effective in scenarios where data is not \n    linearly separable.\n\n    References\n    ----------\n    - J. H. Friedman, \"Greedy Function Approximation: A Gradient Boosting Machine,\" 1999.\n    - T. Hastie, R. Tibshirani, and J. Friedman, \"The Elements of Statistical Learning,\" Springer, 2009.\n\n    Examples\n    --------\n    >>> from sklearn.datasets import make_regression\n    >>> X, y = make_regression(n_samples=100, n_features=1, noise=10)\n    >>> y_pred = gradient_boosting_regressor(X, y, n_estimators=100,\n                                             learning_rate=0.1)\n    >>> print(y_pred[:5])\n    ";
static const char __pyx_k_Invalid_method_specified_Choose[] = "Invalid method specified. Choose among 'freedman_diaconis', 'sturges', 'sqrt'.";
static const char __pyx_k_Need_to_import_scipy_stats_as_a[] = "Need to import scipy.stats as a single module. Sometimes import scipy differently  with stats may not work. Use either `import scipy.stats` rather than `import scipy as sp`";
static const char __pyx_k_Profile_angle_is_0_2f_degrees_E[] = "+++ -> Profile angle is {0:+.2f} degrees E of N";
static const char __pyx_k_Scales_features_to_have_zero_me[] = "\n    Scales features to have zero mean and unit variance.\n\n    Standard scaling is vital in many machine learning algorithms that are \n    sensitive to the scale of input features. It's commonly used in algorithms\n    like Support Vector Machines and k-Nearest Neighbors.\n\n    Applications\n    ------------\n    - Data preprocessing for machine learning models.\n    - Feature normalization in image processing.\n    - Standardizing variables in statistical analysis.\n    \n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,), optional\n        The output values. If provided, it will be scaled as well.\n\n    Returns\n    -------\n    X_scaled : ndarray\n        Scaled version of X.\n    y_scaled : ndarray, optional\n        Scaled version of y, if y is provided.\n\n    Formula\n    -------\n    For each feature, the Standard Scaler performs the following operation:\n        z = \014rac{x - \\mu}{\\sigma}\n    where \\mu is the mean and \\sigma is the standard deviation of the feature.\n\n    Examples\n    --------\n    >>> X = np.array([[1, 2], [3, 4], [5, 6]])\n    >>> X_scaled = standard_scaler(X)\n    ";
static const char __pyx_k_Scales_individual_samples_to_ha[] = "\n    Scales individual samples to have unit norm.\n\n    Normalization is critical for distance-based algorithms like k-Nearest \n    Neighbors and clustering algorithms. It ensures that each feature \n    contributes proportionately to the final distance.\n\n    Applications\n    ------------\n    - Preprocessing for clustering algorithms.\n    - Normalizing data in natural language processing.\n    - Feature scaling in bioinformatics.\n    \n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,), optional\n        The output values. If provided, it will be normalized as well.\n\n    Returns\n    -------\n    X_normalized : ndarray\n        Normalized version of X.\n    y_normalized : ndarray, optional\n        Normalized version of y, if y is provided.\n\n    Formula\n    -------\n    The Normalize method scales each sample as follows:\n        z = \014rac{x}{||x||}\n    where ||x|| is the Euclidean norm (L2 norm) of the sample.\n\n    Examples\n    --------\n    >>> X = np.array([[1, 2], [3, 4], [5, 6]])\n    >>> X_normalized = normalize(X)\n    ";
static const char __pyx_k_Union_np_ndarray_List_ArrayLike[] = "Union[np.ndarray, List[ArrayLike]]";
static const char __pyx_k_Utilities_to_process_and_comput[] = "\nUtilities to process and compute parameters. Module for Algebra calculus.\n";
static const char __pyx_k_Value_is_resetting_to_minimum_e[] = ". Value is resetting to minimum equal 2.";
static const char __pyx_k_alpha_should_be_less_than_1_and[] = "alpha should be less than 1. and greater than 0. ";
static const char __pyx_k_compute_balanced_accuracy_binar[] = "_compute_balanced_accuracy_binary";
static const char __pyx_k_compute_ovo_sens_spec_line_1140[] = "_compute_ovo_sens_spec (line 1140)";
static const char __pyx_k_compute_sensitivity_specificity[] = "_compute_sensitivity_specificity";
static const char __pyx_k_compute_spearmanr_locals__weigh[] = "_compute_spearmanr.<locals>._weighted_spearman_corr";
static const char __pyx_k_compute_sunburst_data_line_2348[] = "compute_sunburst_data (line 2348)";
static const char __pyx_k_data_range_must_contain_numeric[] = "data_range must contain numeric values.";
static const char __pyx_k_func_argument_is_a_callable_not[] = "`func` argument is a callable not ";
static const char __pyx_k_is_not_admitted_Expect_at_least[] = " is not admitted. Expect at least two points A(x1, y1) and B(x2, y2)";
static const char __pyx_k_is_out_of_the_range_max_positio[] = " is out of the range; max position = ";
static const char __pyx_k_kind_of_model_locals_init_weigh[] = "_kind_of_model.<locals>.init_weights";
static const char __pyx_k_x_and_y_arrays_must_have_the_sa[] = " `x` and `y` arrays must have the same length.'{len(xdata)}' and '{len(ydata)}' are given.";
static const char __pyx_k_Azimuth_computation_expects_at_l[] = "Azimuth computation expects at least two points. Got 1";
static const char __pyx_k_Compute_the_coefficients_for_a_1[] = "Compute the coefficients for a 1-D Savitzky-Golay FIR filter.\n\n    Parameters\n    ----------\n    window_length : int\n        The length of the filter window (i.e., the number of coefficients).\n        `window_length` must be an odd positive integer.\n    polyorder : int\n        The order of the polynomial used to fit the samples.\n        `polyorder` must be less than `window_length`.\n    deriv : int, optional\n        The order of the derivative to compute. This must be a\n        nonnegative integer. The default is 0, which means to filter\n        the data without differentiating.\n    delta : float, optional\n        The spacing of the samples to which the filter will be applied.\n        This is only used if deriv > 0.\n    pos : int or None, optional\n        If pos is not None, it specifies evaluation position within the\n        window. The default is the middle of the window.\n    use : str, optional\n        Either 'conv' or 'dot'. This argument chooses the order of the\n        coefficients. The default is 'conv', which means that the\n        coefficients are ordered to be used in a convolution. With\n        use='dot', the order is reversed, so the filter is applied by\n        dotting the coefficients with the data set.\n\n    Returns\n    -------\n    coeffs : 1-D ndarray\n        The filter coefficients.\n\n    References\n    ----------\n    A. Savitzky, M. J. E. Golay, Smoothing and Differentiation of Data by\n    Simplified Least Squares Procedures. Analytical Chemistry, 1964, 36 (8),\n    pp 1627-1639.\n\n    See Also\n    --------\n    savgol_filter\n\n    Examples\n    --------\n    >>> from gofast.exmath.signal import savgol_coeffs\n    >>> savgol_coeffs(5, 2)\n    array([-0.08571429,  0.34285714,  0.48571429,  0.34285714, -0.08571429])\n    >>> savgol_coeffs(5, 2, deriv=1)\n    array([ 2.00000000e-01,  1.00000000e-01,  2.07548111e-16, -1.00000000e-01,\n           -2.00000000e-01])\n\n    Note that use='dot' simply reverses the coeffic""ients.\n\n    >>> savgol_coeffs(5, 2, pos=3)\n    array([ 0.25714286,  0.37142857,  0.34285714,  0.17142857, -0.14285714])\n    >>> savgol_coeffs(5, 2, pos=3, use='dot')\n    array([-0.14285714,  0.17142857,  0.34285714,  0.37142857,  0.25714286])\n\n    `x` contains data from the parabola x = t**2, sampled at\n    t = -1, 0, 1, 2, 3.  `c` holds the coefficients that will compute the\n    derivative at the last position.  When dotted with `x` the result should\n    be 6.\n\n    >>> x = np.array([1, 0, 1, 4, 9])\n    >>> c = savgol_coeffs(5, 2, pos=4, deriv=1, use='dot')\n    >>> c.dot(x)\n    6.0\n    ";
static const char __pyx_k_Consensus_must_be_either_positiv[] = "Consensus must be either 'positive' or 'negative'";
static const char __pyx_k_Could_not_convert_input_argument[] = "Could not convert input argument to float!";
static const char __pyx_k_DataFrame_does_not_contain_any_n[] = "DataFrame does not contain any numeric columns for values";
static const char __pyx_k_DataFrame_must_have_at_least_thr[] = "DataFrame must have at least three columns: source, target, and value";
static const char __pyx_k_Dataframe_is_given_The_c_order_a[] = "Dataframe is given. The `c_order` argument should be defined for column selection. Use column name instead";
static const char __pyx_k_Dependent_variable_depvar_should[] = "Dependent variable 'depvar' should be Series or one-dimensional array, not a two-dimensional.";
static const char __pyx_k_Either_predicted_class_labels_or[] = "Either predicted class labels or predict_proba must be provided for classification tasks.";
static const char __pyx_k_Epsilon_value_auto_is_acceptable[] = "Epsilon value 'auto' is acceptable or should be a numeric value.";
static const char __pyx_k_Expect_one_dimensional_array_for[] = "Expect one-dimensional array for ";
static const char __pyx_k_Get_the_closest_value_in_array_f[] = "Get the closest value in array  from given values.\n    \n    Parameters \n    -----------\n    arr : Arraylike  \n       Array to find the values \n       \n    values: float, arraylike \n    \n    Returns\n    --------\n    closest values in float or array containing in the given array.\n    \n    Examples\n    -----------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex  import find_closest\n    >>> find_closest (  [ 2 , 3, 4, 5] , ( 2.6 , 5.6 )  )\n    array([3., 5.])\n    >>> find_closest (  np.array ([[2 , 3], [ 4, 5]]), ( 2.6 , 5.6 ) )\n    array([3., 5.])\n    array([3., 5.])\n    ";
static const char __pyx_k_Input_data_must_be_a_numpy_array[] = "Input data must be a numpy array of numerical type.";
static const char __pyx_k_Input_data_must_be_a_one_dimensi[] = "Input data must be a one-dimensional numpy array.";
static const char __pyx_k_Invalid_correlation_method_Suppo[] = "Invalid correlation method. Supported methods: 'pearson', 'spearman', 'kendall'.";
static const char __pyx_k_Location_index_must_be_less_than[] = "Location index must be less than the number of stations = ";
static const char __pyx_k_Number_of_columns_must_fit_the_s[] = "Number of columns must fit the shape of X. got ";
static const char __pyx_k_Numeric_array_is_expected_for_op[] = "Numeric array is expected for operations.";
static const char __pyx_k_Optional_Union_ArrayLike_List_Ar[] = "Optional[Union[ArrayLike, List[ArrayLike]]]";
static const char __pyx_k_P_value_calculations_expect_nume[] = "P-value calculations expect numeric data, but the DataFrame contains no numeric data.";
static const char __pyx_k_Polynomial_function_expects_degr[] = "Polynomial function expects degree greater than 1. Got ";
static const char __pyx_k_Predicted_values_must_be_provide[] = "Predicted values must be provided for regression tasks.";
static const char __pyx_k_Source_and_Target_columns_must_n[] = "Source and Target columns must not contain null values";
static const char __pyx_k_Step_is_not_given_Average_distan[] = "Step is not given. Average distance between points should be used instead.";
static const char __pyx_k_The_bins_parameter_is_set_to_aut[] = "The 'bins' parameter is set to 'auto', but no 'bins_method' has been specified. Defaulting to the 'freedman_diaconis' method for determining the optimal number of bins.";
static const char __pyx_k_The_first_column_of_the_data_sho[] = "The first column of the data should be considered as the `y` target.";
static const char __pyx_k_The_length_of_predict_proba_does[] = "The length of predict_proba does not match the number of actual values.";
static const char __pyx_k_The_task_type_must_be_regression[] = "The task_type must be 'regression', 'binary', or 'multiclass'.";
static const char __pyx_k_Tuple_List_str_List_str_List_int[] = "Tuple[List[str], List[str], List[int]]";
static const char __pyx_k_Unable_to_detect_the_station_pos[] = "Unable to detect the station position ";
static const char __pyx_k_Union_ArrayLike__SP_Series_DataF[] = "Union[ArrayLike, _SP, Series, DataFrame]";
static const char __pyx_k_Value_column_must_not_contain_nu[] = "Value column must not contain null values";
static const char __pyx_k_Variant_average_methods_only_inc[] = "Variant average methods only includes  ";
static const char __pyx_k_Wrong_coordinates_values_Need_tw[] = "Wrong coordinates values. Need two coordinates (latitude and longitude) of points 1 and 2.";
static const char __pyx_k_Youden_s_index_calculation_requi[] = "Youden's index calculation requires binary classlabels. Provided labels are not binary.";
static const char __pyx_k_adaptive_moving_average_line_494[] = "adaptive_moving_average (line 4947)";
static const char __pyx_k_adjust_for_control_vars_classifi[] = "adjust_for_control_vars_classification";
static const char __pyx_k_adjust_for_control_vars_line_150[] = "adjust_for_control_vars (line 1505)";
static const char __pyx_k_adjust_for_control_vars_regressi[] = "adjust_for_control_vars_regression";
static const char __pyx_k_calculate_histogram_bins_line_12[] = "calculate_histogram_bins (line 1217)";
static const char __pyx_k_calculate_multiclass_avg_lr_line[] = "calculate_multiclass_avg_lr (line 547)";
static const char __pyx_k_calculate_multiclass_lr_line_662[] = "calculate_multiclass_lr (line 662)";
static const char __pyx_k_calculate_optimal_bins_line_1895[] = "calculate_optimal_bins (line 1895)";
static const char __pyx_k_calculate_optimal_bins_locals_ge[] = "calculate_optimal_bins.<locals>.genexpr";
static const char __pyx_k_compute_balance_accuracy_line_24[] = "compute_balance_accuracy (line 242)";
static const char __pyx_k_compute_cost_based_threshold_lin[] = "compute_cost_based_threshold (line 388)";
static const char __pyx_k_could_not_convert_string_to_floa[] = "could not convert string to float: ";
static const char __pyx_k_data_range_must_be_a_tuple_of_tw[] = "data_range must be a tuple of two numeric values (min, max).";
static const char __pyx_k_detect_station_position_line_374[] = "detect_station_position (line 3746)";
static const char __pyx_k_gradient_boosting_regressor_line[] = "gradient_boosting_regressor (line 5101)";
static const char __pyx_k_mode_must_be_mirror_constant_nea[] = "mode must be 'mirror', 'constant', 'nearest' 'wrap' or 'interp'.";
static const char __pyx_k_polyorder_must_be_less_than_wind[] = "polyorder must be less than window_length.";
static const char __pyx_k_pos_must_be_nonnegative_and_less[] = "pos must be nonnegative and less than window_length.";
static const char __pyx_k_torres_verdin_filter_locals__fil[] = "torres_verdin_filter.<locals>._filtering_1d_array";
static const char __pyx_k_trailer_must_be_a_non_numeric_st[] = "trailer must be a non-numeric string.";
static const char __pyx_k_utm_zone_cannot_be_None_when_pro[] = "utm_zone cannot be None when projection is UTM.";
static const char __pyx_k_weighted_spearman_rank_line_1795[] = "weighted_spearman_rank (line 1795)";
static const char __pyx_k_weighted_spearman_rank_locals_we[] = "weighted_spearman_rank.<locals>.weighted_rank";
static const char __pyx_k_window_size_has_to_be_of_type_in[] = "window_size has to be of type int";
static const char __pyx_k_window_size_is_too_large_for_ave[] = "window_size is too large for averaging. Window must be greater than 0 and less than ";
static const char __pyx_k_window_size_size_must_be_a_posit[] = "window_size size must be a positive odd number";
static const char __pyx_k_x_y_are_not_in_longitude_latitud[] = "x, y are not in longitude/latitude format  while 'utm_zone' is not supplied. Correction should be less accurate. Provide the UTM zone to improve the accuracy.";
static const char __pyx_k_xlon_and_ylat_arguments_are_grea[] = "xlon and ylat arguments are greater than 180 degrees. we assume the coordinates are UTM. Set explicitly projection to ``UTM`` to avoid this warning.";
static const char __pyx_k_y_true_and_y_pred_must_contain_n[] = "y_true and y_pred must contain non-negative values.";
static const char __pyx_k_y_true_and_y_pred_should_be_1_di[] = "y_true and y_pred should be 1-dimensional arrays for regression tasks.";
static const char __pyx_k_yt_should_not_contain_NaN_values[] = "yt should not contain NaN values in 'strict' mode.";
static const char __pyx_k_Calculate_sensitivity_and_speci_2[] = "\n    Calculate sensitivity and specificity for binary or multiclass classification\n    results, with support for different strategies and averaging methods. \n\n    Parameters\n    ----------\n    y_true : array-like of shape (n_samples,)\n        True class labels. Each element in this array should be an integer\n        representing the actual class of the corresponding sample.\n    y_pred : array-like of shape (n_samples,)\n        Predicted class labels. Each element should correspond to the predicted\n        class label for the sample.\n    sample_weight : array-like of shape (n_samples,), optional\n        Weights applied to each sample when calculating metrics. If not provided,\n        all samples are assumed to have equal weight. Useful in cases of class\n        imbalance or when some samples are more critical than others.\n    strategy : {'ovr', 'ovo'}, default 'ovr'\n        The strategy to calculate metrics:\n        - 'ovr' (One-vs-Rest): Metrics are calculated by treating each class as\n          the positive class against all other classes combined.\n        - 'ovo' (One-vs-One): Metrics are calculated for each pair of classes.\n          This can be more computationally intensive.\n    average : {'macro', 'micro', 'weighted'}, default 'macro'\n        Specifies the method to average sensitivity and specificity:\n        - 'macro': Calculate metrics for each label, and find their unweighted mean.\n        - 'micro': Calculate metrics globally across all classes.\n        - 'weighted': Calculate metrics for each label, and find their average,\n          weighted by the number of true instances for each label.\n    epsilon : float or \"auto\", optional\n        A small constant added to the denominator to prevent division by zero. If\n        'auto', the machine epsilon for float64 is used. Defaults to \"auto\".\n\n    Returns\n    -------\n    tuple\n        A tuple containing the averaged or non-averaged sensitivity and specificity.\n\n    Example""s\n    --------\n    >>> from gofast.tools.mathex import compute_sensitivity_specificity\n    >>> y_true = [0, 1, 1, 0]\n    >>> y_pred = [0, 1, 0, 1]\n    >>> compute_sensitivity_specificity(y_true, y_pred)\n    (0.5, 0.5)\n\n    Notes\n    -----\n    Sensitivity (also known as recall or true positive rate) and specificity\n    (true negative rate) are calculated from the confusion matrix as:\n\n    .. math::\n        \text{sensitivity} = \014rac{TP}{TP + FN}\n\n    .. math::\n        \text{specificity} = \014rac{TN}{TN + FP}\n\n    Here, TP, TN, FN, and FP denote the counts of true positives, true negatives,\n    false negatives, and false positives, respectively.\n\n    - Micro averaging will sum the counts of true positives, false negatives, and\n      false positives across all classes and then compute the metrics.\n    - Macro averaging will compute the metrics independently for each class but\n      then take the unweighted mean. This does not take label imbalance into\n      account.\n    - Weighted averaging will compute the metrics for each class, and find their\n      average weighted by the number of true instances for each label, which\n      helps in addressing label imbalance.\n\n    The choice of averaging method depends on the balance of classes and the\n    importance of each class in the dataset.\n    ";
static const char __pyx_k_Compute_Spearman_s_rank_correla_2[] = "\n    Compute Spearman's rank correlation coefficient with sample weights,\n    offering an extension to the standard Spearman's correlation by incorporating\n    sample weights into the rank calculation. This method is particularly useful\n    for datasets where some observations are more important than others.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True target values.\n    y_pred : array-like\n        Predicted target values. Both `y_true` and `y_pred` must have the same length.\n    sample_weight : array-like\n        Weights for each sample, indicating the importance of each observation\n        in `y_true` and `y_pred`. Must be the same length as `y_true` and `y_pred`.\n    return_weighted_rank : bool, optional\n        If True, returns the weighted ranks of `y_true` and `y_pred` instead of\n        Spearman's rho. Default is False.\n    epsilon : float, optional\n        A small value added to the denominator to avoid division by zero in the\n        computation of Spearman's rho. Default is 1e-10.\n\n    Returns\n    -------\n    float or tuple of ndarray\n        If `return_weighted_rank` is False (default), returns Spearman's rho,\n        considering sample weights. If `return_weighted_rank` is True, returns\n        a tuple containing the weighted ranks of `y_true` and `y_pred`.\n\n    Notes\n    -----\n    The weighted Spearman's rank correlation coefficient is computed as:\n\n    .. math::\n        \\rho = 1 - \\frac{6 \\sum d_i^2 w_i}{\\sum w_i(n^3 - n)}\n\n    where :math:`d_i` is the difference between the weighted ranks of each observation,\n    :math:`w_i` is the weight of each observation, and :math:`n` is the number of observations.\n\n    This function calculates weighted ranks based on the sample weights, adjusting\n    the influence of each data point in the final correlation measure. It is useful\n    in scenarios where certain observations are deemed more critical than others.\n\n    Examples\n    --------\n    >"">> from gofast.tools.mathex import weighted_spearman_corr\n    >>> y_true = [1, 2, 3, 4, 5]\n    >>> y_pred = [5, 6, 7, 8, 7]\n    >>> sample_weight = [1, 1, 1, 1, 2]\n    >>> weighted_spearman_corr(y_true, y_pred, sample_weight)\n    0.8208\n\n    References\n    ----------\n    .. [1] Myatt, G.J. (2007). Making Sense of Data, A Practical Guide to \n           Exploratory Data Analysis and Data Mining. John Wiley & Sons.\n\n    See Also\n    --------\n    scipy.stats.spearmanr : Spearman rank-order correlation coefficient.\n    numpy.cov : Covariance matrix.\n    numpy.var : Variance.\n\n    ";
static const char __pyx_k_compute_sensitivity_specificity_2[] = "compute_sensitivity_specificity";
static const char __pyx_k_compute_sensitivity_specificity_3[] = "_compute_sensitivity_specificity (line 920)";
static const char __pyx_k_compute_sensitivity_specificity_4[] = "compute_sensitivity_specificity (line 1001)";
static const char __pyx_k_adjust_for_control_vars_classifi_2[] = "adjust_for_control_vars_classification (line 1683)";
static const char __pyx_k_adjust_for_control_vars_regressi_2[] = "adjust_for_control_vars_regression (line 1587)";
/* #### Code section: decls ### */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_compute_p_values(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_depvar, PyObject *__pyx_v_method, double __pyx_v_significance_threshold, PyObject *__pyx_v_ignore); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_134__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_2compute_balance_accuracy(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, double __pyx_v_epsilon, PyObject *__pyx_v_zero_division, PyObject *__pyx_v_strategy, PyObject *__pyx_v_normalize, PyObject *__pyx_v_sample_weight); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_4_compute_balanced_accuracy_binary(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_zero_division, PyObject *__pyx_v_normalize, PyObject *__pyx_v_sample_weight); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_6_balanced_accuracy_ovr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_labels, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_zero_division, PyObject *__pyx_v_normalize, PyObject *__pyx_v_sample_weight); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_8_balanced_accuracy_ovo(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, CYTHON_UNUSED PyObject *__pyx_v_y_pred, PyObject *__pyx_v_labels, PyObject *__pyx_v_sample_weight); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_10compute_cost_based_threshold(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_scores, PyObject *__pyx_v_costs, PyObject *__pyx_v_sample_weight); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_12compute_youdens_index(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_scores, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_pos_label, PyObject *__pyx_v_drop_intermediate); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_14calculate_multiclass_avg_lr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_strategy, PyObject *__pyx_v_consensus, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_multi_output, PyObject *__pyx_v_epsilon); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_16calculate_multiclass_lr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_consensus, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_strategy, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_multi_output, PyObject *__pyx_v_apply_log_scale, PyObject *__pyx_v_include_metrics); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_18calculate_adjusted_lr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_sensitivity, PyObject *__pyx_v_specificity, PyObject *__pyx_v_consensus, PyObject *__pyx_v_max_lr, PyObject *__pyx_v_buffer); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_20_compute_sensitivity_specificity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_epsilon); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_22compute_sensitivity_specificity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_strategy, PyObject *__pyx_v_average, PyObject *__pyx_v_epsilon); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_24_compute_ovo_sens_spec(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_labels, PyObject *__pyx_v_return_array); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_26calculate_histogram_bins(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_bins, PyObject *__pyx_v_range, PyObject *__pyx_v_normalize); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_28rank_data(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_method); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_30optimized_spearmanr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_tie_method, PyObject *__pyx_v_nan_policy, PyObject *__pyx_v_control_vars, PyObject *__pyx_v_multioutput); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_18_compute_spearmanr__weighted_spearman_corr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ranks_true, PyObject *__pyx_v_ranks_pred, PyObject *__pyx_v_weights); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_32_compute_spearmanr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_tie_method, PyObject *__pyx_v_nan_policy, PyObject *__pyx_v_control_vars); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_34adjust_for_control_vars(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_control_vars); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_36adjust_for_control_vars_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_control_vars); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_38adjust_for_control_vars_classification(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_control_vars); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_22weighted_spearman_rank_weighted_rank(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_weights); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_40weighted_spearman_rank(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_return_weighted_rank, PyObject *__pyx_v_epsilon); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_22calculate_optimal_bins_genexpr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_genexpr_arg_0); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_42calculate_optimal_bins(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_method, PyObject *__pyx_v_data_range); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_44calculate_binary_iv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_method, PyObject *__pyx_v_bins, PyObject *__pyx_v_bins_method, PyObject *__pyx_v_data_range); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_46determine_epsilon(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_base_epsilon, PyObject *__pyx_v_scale_factor); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_48calculate_residuals(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_actual, PyObject *__pyx_v_predicted, PyObject *__pyx_v_task_type, PyObject *__pyx_v_predict_proba); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_50infer_sankey_columns(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_52compute_sunburst_data(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_hierarchy, PyObject *__pyx_v_value_column); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_54compute_effort_yield(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_d, PyObject *__pyx_v_reverse); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_56make_mxs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y, PyObject *__pyx_v_yt, PyObject *__pyx_v_threshold, PyObject *__pyx_v_star_mxs, PyObject *__pyx_v_return_ymxs, PyObject *__pyx_v_mode, PyObject *__pyx_v_include_nan, PyObject *__pyx_v_trailer); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_58label_importance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y, PyObject *__pyx_v_include_nan); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_60linear_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_62quadratic_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_64cubic_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_66exponential_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_68logarithmic_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_70sinusoidal_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_lambda_funcdef_lambda1(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_72step_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_74standard_scaler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_76minmax_scaler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_78normalize(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_136__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_80moving_average(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y, PyObject *__pyx_v_window_size, PyObject *__pyx_v_method, PyObject *__pyx_v_mode, PyObject *__pyx_v_alpha); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_82count_local_minima(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, PyObject *__pyx_v_method, PyObject *__pyx_v_order); /* proto */
static PyObject *__pyx_lambda_funcdef_lambda2(PyObject *__pyx_self, PyObject *__pyx_v_ii); /* proto */
static PyObject *__pyx_lambda_funcdef_lambda3(PyObject *__pyx_self, PyObject *__pyx_v_ii); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_84get_azimuth(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_xlon, PyObject *__pyx_v_ylat, PyObject *__pyx_v_data, PyObject *__pyx_v_utm_zone, PyObject *__pyx_v_projection, PyObject *__pyx_v_isdeg, PyObject *__pyx_v_mode, PyObject *__pyx_v_extrapolate, PyObject *__pyx_v_view); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_86linkage_matrix(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_df, PyObject *__pyx_v_columns, PyObject *__pyx_v_kind, PyObject *__pyx_v_metric, PyObject *__pyx_v_method, PyObject *__pyx_v_as_frame, PyObject *__pyx_v_optimal_ordering); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_13scalePosition_linfunc(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_a, PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_lambda_funcdef_lambda4(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x); /* proto */
static PyObject *__pyx_lambda_funcdef_lambda5(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_88scalePosition(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ydata, PyObject *__pyx_v_xdata, PyObject *__pyx_v_func, PyObject *__pyx_v_c_order, PyObject *__pyx_v_show, PyObject *__pyx_v_kws); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_90detect_station_position(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s, PyObject *__pyx_v_p); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_138__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_92_manage_colors(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_c, PyObject *__pyx_v_default); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_94convert_distance_to_m(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_value, double __pyx_v_converter, PyObject *__pyx_v_unit); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_96get_station_number(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_dipole, double __pyx_v_distance, PyObject *__pyx_v_from0, PyObject *__pyx_v_kws); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_98get_profile_angle(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_easting, PyObject *__pyx_v_northing, PyObject *__pyx_v_msg); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_100savgol_coeffs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_window_length, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_pos, PyObject *__pyx_v_use); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_102_polyder(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_p, PyObject *__pyx_v_m); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_104_fit_edge(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_window_start, PyObject *__pyx_v_window_stop, PyObject *__pyx_v_interp_start, PyObject *__pyx_v_interp_stop, PyObject *__pyx_v_axis, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_106_fit_edges_polyfit(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_window_length, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_axis, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_108savgol_filter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_window_length, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_axis, PyObject *__pyx_v_mode, PyObject *__pyx_v_cval); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_110compute_errors(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, PyObject *__pyx_v_error, PyObject *__pyx_v_axis, PyObject *__pyx_v_return_confidence); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_112quality_control2(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ar, double __pyx_v_tol, PyObject *__pyx_v_return_data, CYTHON_UNUSED PyObject *__pyx_v_to_log10, PyObject *__pyx_v_return_qco); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_114get_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y, PyObject *__pyx_v_return_mean_dist, PyObject *__pyx_v_is_latlon, PyObject *__pyx_v_kws); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_116scale_positions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y, PyObject *__pyx_v_is_latlon, PyObject *__pyx_v_step, PyObject *__pyx_v_use_average_dist, PyObject *__pyx_v_utm_zone, PyObject *__pyx_v_shift, PyObject *__pyx_v_view, PyObject *__pyx_v_kws); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_118_assert_x_y_positions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y, PyObject *__pyx_v_islatlon, CYTHON_UNUSED PyObject *__pyx_v_is_utm, PyObject *__pyx_v_kws); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_120get_bearing(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_latlon1, PyObject *__pyx_v_latlon2, PyObject *__pyx_v_to_deg); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_122find_closest(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, PyObject *__pyx_v_values); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_140__defaults__(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_124gradient_descent(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_z, PyObject *__pyx_v_s, double __pyx_v_alpha, PyObject *__pyx_v_n_epochs, PyObject *__pyx_v_kind, PyObject *__pyx_v_degree, PyObject *__pyx_v_raise_warn); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_14_kind_of_model_init_weights(PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_126_kind_of_model(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_degree, PyObject *__pyx_v_x, PyObject *__pyx_v_y); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_128adaptive_moving_average(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_window_size_factor); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_20torres_verdin_filter__filtering_1d_array(PyObject *__pyx_self, PyObject *__pyx_v_ar, PyObject *__pyx_v_wf, CYTHON_UNUSED PyObject *__pyx_v_b); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_130torres_verdin_filter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, double __pyx_v_weight_factor, double __pyx_v_beta, PyObject *__pyx_v_logify, PyObject *__pyx_v_axis); /* proto */
static PyObject *__pyx_pf_6gofast_5tools_6mathex_132gradient_boosting_regressor(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y, PyObject *__pyx_v_n_estimators, PyObject *__pyx_v_learning_rate, CYTHON_UNUSED PyObject *__pyx_v_max_depth); /* proto */
static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct__genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
static __Pyx_CachedCFunction __pyx_umethod_PyFloat_Type_astype = {0, 0, 0, 0, 0};
static __Pyx_CachedCFunction __pyx_umethod_PyUnicode_Type_lower = {0, 0, 0, 0, 0};
static __Pyx_CachedCFunction __pyx_umethod_PyUnicode_Type_title = {0, 0, 0, 0, 0};
/* #### Code section: late_includes ### */
/* #### Code section: module_state ### */
typedef struct {
  PyObject *__pyx_d;
  PyObject *__pyx_b;
  PyObject *__pyx_cython_runtime;
  PyObject *__pyx_empty_tuple;
  PyObject *__pyx_empty_bytes;
  PyObject *__pyx_empty_unicode;
  #ifdef __Pyx_CyFunction_USED
  PyTypeObject *__pyx_CyFunctionType;
  #endif
  #ifdef __Pyx_FusedFunction_USED
  PyTypeObject *__pyx_FusedFunctionType;
  #endif
  #ifdef __Pyx_Generator_USED
  PyTypeObject *__pyx_GeneratorType;
  #endif
  #ifdef __Pyx_IterableCoroutine_USED
  PyTypeObject *__pyx_IterableCoroutineType;
  #endif
  #ifdef __Pyx_Coroutine_USED
  PyTypeObject *__pyx_CoroutineAwaitType;
  #endif
  #ifdef __Pyx_Coroutine_USED
  PyTypeObject *__pyx_CoroutineType;
  #endif
  #if CYTHON_USE_MODULE_STATE
  PyObject *__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr;
  PyObject *__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth;
  PyObject *__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model;
  PyObject *__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter;
  #endif
  PyTypeObject *__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr;
  PyTypeObject *__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth;
  PyTypeObject *__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model;
  PyTypeObject *__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter;
  PyObject *__pyx_kp_u_0A4CEE;
  PyObject *__pyx_kp_u_49R;
  PyObject *__pyx_n_s_A;
  PyObject *__pyx_kp_u_A_moving_average_is_used_with_t;
  PyObject *__pyx_kp_u_A_singleton_array;
  PyObject *__pyx_kp_u_Adaptative_moving_average_as_sm;
  PyObject *__pyx_kp_u_Adjust_y_true_and_y_pred_for_re;
  PyObject *__pyx_kp_u_Adjusts_y_true_and_y_pred_for_e;
  PyObject *__pyx_kp_u_Adjusts_y_true_and_y_pred_in_a;
  PyObject *__pyx_n_s_AppendDocReferences;
  PyObject *__pyx_kp_u_Apply_a_Savitzky_Golay_filter_t;
  PyObject *__pyx_n_u_Array;
  PyObject *__pyx_n_s_ArrayLike;
  PyObject *__pyx_kp_u_Array_dimension_is;
  PyObject *__pyx_kp_u_Assigns_ranks_to_data_handling;
  PyObject *__pyx_kp_u_Axis_must_be_specified_Otherwis;
  PyObject *__pyx_kp_u_Azimuth_computation_expects_at_l;
  PyObject *__pyx_kp_u_Bins_must_be_auto_or_a_positive;
  PyObject *__pyx_n_s_C_FN;
  PyObject *__pyx_n_s_C_FP;
  PyObject *__pyx_kp_u_Calculate_sensitivity_and_speci;
  PyObject *__pyx_kp_u_Calculate_sensitivity_and_speci_2;
  PyObject *__pyx_kp_u_Calculate_the_Information_Value;
  PyObject *__pyx_kp_u_Calculate_the_average_likelihoo;
  PyObject *__pyx_kp_u_Calculate_the_bearing_between_t;
  PyObject *__pyx_kp_u_Calculate_the_likelihood_ratio;
  PyObject *__pyx_kp_u_Calculate_the_multiclass_likeli;
  PyObject *__pyx_kp_u_Calculate_the_optimal_number_of;
  PyObject *__pyx_kp_u_Calculate_the_residuals_for_reg;
  PyObject *__pyx_kp_u_Calculates_histogram_bin_edges;
  PyObject *__pyx_kp_u_Calculates_the_adaptive_moving;
  PyObject *__pyx_kp_u_Check_the_quality_control_in_th;
  PyObject *__pyx_kp_u_Compute_Errors_Standard_Deviati;
  PyObject *__pyx_kp_u_Compute_Spearman_s_rank_correla;
  PyObject *__pyx_kp_u_Compute_Spearman_s_rank_correla_2;
  PyObject *__pyx_kp_u_Compute_Youden_s_Index_and_opti;
  PyObject *__pyx_kp_u_Compute_azimuth_from_coordinate;
  PyObject *__pyx_kp_u_Compute_distance_between_points;
  PyObject *__pyx_kp_u_Compute_effort_and_yield_values;
  PyObject *__pyx_kp_u_Compute_p_values_for_the_correl;
  PyObject *__pyx_kp_u_Compute_sensitivity_and_specifi;
  PyObject *__pyx_kp_u_Compute_the_balanced_accuracy_f;
  PyObject *__pyx_kp_u_Compute_the_coefficients_for_a_1;
  PyObject *__pyx_kp_u_Compute_the_importance_of_each;
  PyObject *__pyx_kp_u_Compute_the_similarity_between;
  PyObject *__pyx_kp_u_Compute_threshold_using_a_cost;
  PyObject *__pyx_kp_u_Computes_the_data_structure_req;
  PyObject *__pyx_kp_u_Consensus_must_be_either_positiv;
  PyObject *__pyx_kp_u_Correct_data_location_or_positi;
  PyObject *__pyx_kp_u_Correct_the_position_coordinate;
  PyObject *__pyx_kp_u_Could_not_convert_input_argument;
  PyObject *__pyx_n_s_Count;
  PyObject *__pyx_n_u_Count;
  PyObject *__pyx_kp_u_Count_the_number_of_local_minim;
  PyObject *__pyx_n_s_DataFrame;
  PyObject *__pyx_kp_u_DataFrame_does_not_contain_any_n;
  PyObject *__pyx_kp_u_DataFrame_must_have_at_least_thr;
  PyObject *__pyx_kp_u_Dataframe_is_given_The_c_order_a;
  PyObject *__pyx_n_s_DecisionStumpRegressor;
  PyObject *__pyx_kp_u_Degree_is_integer_Got;
  PyObject *__pyx_kp_u_Dependent_variable_depvar_should;
  PyObject *__pyx_kp_u_Detect_station_position_and_ret;
  PyObject *__pyx_n_s_Dict;
  PyObject *__pyx_kp_u_Either_predicted_class_labels_or;
  PyObject *__pyx_kp_u_Epsilon_must_be_a_numeric_value;
  PyObject *__pyx_kp_u_Epsilon_value_auto_is_acceptable;
  PyObject *__pyx_kp_u_Expect;
  PyObject *__pyx_kp_u_Expect_one_dimensional_array_for;
  PyObject *__pyx_kp_u_Expect_squareform_condense_or_d;
  PyObject *__pyx_kp_u_Expected_float_not;
  PyObject *__pyx_n_s_F;
  PyObject *__pyx_n_s_FN;
  PyObject *__pyx_n_s_FP;
  PyObject *__pyx_n_s_F_m;
  PyObject *__pyx_kp_u_Get_the_closest_value_in_array_f;
  PyObject *__pyx_kp_u_Got_x_ndim_d;
  PyObject *__pyx_kp_u_Gradient_descent_algorithm_to_f;
  PyObject *__pyx_n_u_ID;
  PyObject *__pyx_kp_u_If_mode_is_interp_window_length;
  PyObject *__pyx_kp_u_Implement_a_simple_version_of_G;
  PyObject *__pyx_kp_u_Infers_source_target_and_value;
  PyObject *__pyx_kp_u_Input_data_must_be_a_numpy_array;
  PyObject *__pyx_kp_u_Input_data_must_be_a_one_dimensi;
  PyObject *__pyx_kp_u_Input_values_contain_NaNs;
  PyObject *__pyx_kp_u_Invalid_correlation_method_Suppo;
  PyObject *__pyx_kp_u_Invalid_method;
  PyObject *__pyx_kp_u_Invalid_method_specified_Choose;
  PyObject *__pyx_kp_u_Invalid_nan_policy;
  PyObject *__pyx_n_s_KeyBox;
  PyObject *__pyx_n_s_LabelEncoder;
  PyObject *__pyx_n_s_LinearRegression;
  PyObject *__pyx_n_s_List;
  PyObject *__pyx_kp_s_List_Dict_str_str;
  PyObject *__pyx_kp_s_List_str;
  PyObject *__pyx_n_s_Location;
  PyObject *__pyx_kp_u_Location_index_must_be_less_than;
  PyObject *__pyx_n_s_LogisticRegression;
  PyObject *__pyx_n_s_N;
  PyObject *__pyx_n_s_NDArray;
  PyObject *__pyx_kp_u_Need_to_import_scipy_stats_as_a;
  PyObject *__pyx_kp_u_Non_numerical;
  PyObject *__pyx_kp_u_None;
  PyObject *__pyx_kp_u_NoneType_can_not_be_computed;
  PyObject *__pyx_kp_u_Number_of_columns_must_fit_the_s;
  PyObject *__pyx_kp_u_Numeric_array_is_expected_for_op;
  PyObject *__pyx_n_s_Optional;
  PyObject *__pyx_kp_s_Optional_ArrayLike;
  PyObject *__pyx_kp_s_Optional_List_str;
  PyObject *__pyx_kp_s_Optional_Union_ArrayLike_List_Ar;
  PyObject *__pyx_kp_s_Optional_Union_int_str;
  PyObject *__pyx_kp_s_Optional_Union_str_list;
  PyObject *__pyx_kp_s_Optional__F;
  PyObject *__pyx_kp_s_Optional_str;
  PyObject *__pyx_kp_u_P_value_calculations_expect_nume;
  PyObject *__pyx_kp_u_P_values;
  PyObject *__pyx_kp_u_Polynomial_function_expects_degr;
  PyObject *__pyx_kp_u_Position_array_p;
  PyObject *__pyx_kp_u_Predicted_values_must_be_provide;
  PyObject *__pyx_kp_u_Profile_angle_is_0_2f_degrees_E;
  PyObject *__pyx_n_s_ResultSummary;
  PyObject *__pyx_n_s_RuntimeWarning;
  PyObject *__pyx_n_s_S;
  PyObject *__pyx_n_s_SP;
  PyObject *__pyx_kp_u_Scales_each_feature_to_a_given;
  PyObject *__pyx_kp_u_Scales_features_to_have_zero_me;
  PyObject *__pyx_kp_u_Scales_individual_samples_to_ha;
  PyObject *__pyx_n_s_Series;
  PyObject *__pyx_n_s_SiteError;
  PyObject *__pyx_kp_u_Source_and_Target_columns_must_n;
  PyObject *__pyx_kp_u_Station;
  PyObject *__pyx_kp_u_Step_is_not_given_Average_distan;
  PyObject *__pyx_kp_u_Step_m;
  PyObject *__pyx_n_s_T;
  PyObject *__pyx_n_s_TN;
  PyObject *__pyx_n_s_TP;
  PyObject *__pyx_kp_u_The_bins_parameter_is_set_to_aut;
  PyObject *__pyx_kp_u_The_first_column_of_the_data_sho;
  PyObject *__pyx_kp_u_The_length_of_predict_proba_does;
  PyObject *__pyx_kp_u_The_task_type_must_be_regression;
  PyObject *__pyx_n_s_Tuple;
  PyObject *__pyx_kp_s_Tuple_ArrayLike_np_ndarray;
  PyObject *__pyx_kp_s_Tuple_List_str_List_str_List_int;
  PyObject *__pyx_kp_s_Tuple_float_ArrayLike;
  PyObject *__pyx_kp_s_Tuple_float_float;
  PyObject *__pyx_kp_s_Tuple_int_float;
  PyObject *__pyx_n_s_TypeError;
  PyObject *__pyx_n_u_Un;
  PyObject *__pyx_kp_u_Unable_to_detect_the_station_pos;
  PyObject *__pyx_n_s_Union;
  PyObject *__pyx_kp_s_Union_ArrayLike_List_ArrayLike;
  PyObject *__pyx_kp_s_Union_ArrayLike_Series;
  PyObject *__pyx_kp_s_Union_ArrayLike__SP_Series_DataF;
  PyObject *__pyx_kp_s_Union_int_float;
  PyObject *__pyx_kp_s_Union_int_str_list;
  PyObject *__pyx_kp_s_Union_np_ndarray_List_ArrayLike;
  PyObject *__pyx_kp_s_Union_str_ArrayLike;
  PyObject *__pyx_kp_s_Union_str_int;
  PyObject *__pyx_kp_u_Unknown_method;
  PyObject *__pyx_kp_u_Use_base_or_binning;
  PyObject *__pyx_kp_u_Use_column_name_instead;
  PyObject *__pyx_kp_u_Use_the_index_instead;
  PyObject *__pyx_n_s_ValueError;
  PyObject *__pyx_kp_u_Value_column_must_not_contain_nu;
  PyObject *__pyx_kp_u_Value_is_resetting_to_minimum_e;
  PyObject *__pyx_kp_u_Variant_average_methods_only_inc;
  PyObject *__pyx_n_s_W;
  PyObject *__pyx_kp_u_Wrong_coordinates_values_Need_tw;
  PyObject *__pyx_n_s_X;
  PyObject *__pyx_n_s_X_max;
  PyObject *__pyx_n_s_X_mean;
  PyObject *__pyx_n_s_X_min;
  PyObject *__pyx_n_s_X_norm;
  PyObject *__pyx_n_s_X_normalized;
  PyObject *__pyx_n_s_X_scaled;
  PyObject *__pyx_n_s_X_std;
  PyObject *__pyx_n_u_Xdata;
  PyObject *__pyx_kp_u_Youden_s_index_calculation_requi;
  PyObject *__pyx_n_s_Z;
  PyObject *__pyx_kp_u__107;
  PyObject *__pyx_n_s__177;
  PyObject *__pyx_kp_u__2;
  PyObject *__pyx_n_s__240;
  PyObject *__pyx_kp_u__31;
  PyObject *__pyx_kp_u__39;
  PyObject *__pyx_kp_u__65;
  PyObject *__pyx_n_s__70;
  PyObject *__pyx_kp_u__70;
  PyObject *__pyx_kp_u__88;
  PyObject *__pyx_n_s_a;
  PyObject *__pyx_n_s_abs;
  PyObject *__pyx_n_s_accept_multioutput;
  PyObject *__pyx_n_s_action;
  PyObject *__pyx_n_s_actual;
  PyObject *__pyx_n_s_adaptive_moving_average;
  PyObject *__pyx_n_u_adaptive_moving_average;
  PyObject *__pyx_kp_u_adaptive_moving_average_line_494;
  PyObject *__pyx_n_s_add_results;
  PyObject *__pyx_n_s_adjust_for_control_vars;
  PyObject *__pyx_n_u_adjust_for_control_vars;
  PyObject *__pyx_n_s_adjust_for_control_vars_classifi;
  PyObject *__pyx_kp_u_adjust_for_control_vars_classifi_2;
  PyObject *__pyx_kp_u_adjust_for_control_vars_line_150;
  PyObject *__pyx_n_s_adjust_for_control_vars_regressi;
  PyObject *__pyx_kp_u_adjust_for_control_vars_regressi_2;
  PyObject *__pyx_n_s_adjusted_pred;
  PyObject *__pyx_n_s_adjusted_preds;
  PyObject *__pyx_n_s_adjusted_y_pred;
  PyObject *__pyx_n_s_adjusted_y_true;
  PyObject *__pyx_n_s_all;
  PyObject *__pyx_n_s_all_2;
  PyObject *__pyx_n_s_alpha;
  PyObject *__pyx_kp_u_alpha_should_be_less_than_1_and;
  PyObject *__pyx_n_s_ama;
  PyObject *__pyx_n_s_ama_value;
  PyObject *__pyx_n_u_amount;
  PyObject *__pyx_n_s_any;
  PyObject *__pyx_n_s_api_box;
  PyObject *__pyx_n_s_api_docstring;
  PyObject *__pyx_n_s_api_summary;
  PyObject *__pyx_n_s_api_types;
  PyObject *__pyx_n_s_append;
  PyObject *__pyx_n_s_apply_log_scale;
  PyObject *__pyx_n_s_ar;
  PyObject *__pyx_n_s_arange;
  PyObject *__pyx_n_s_arctan;
  PyObject *__pyx_n_s_arctan2;
  PyObject *__pyx_kp_u_are_not_allowed;
  PyObject *__pyx_n_s_argmax;
  PyObject *__pyx_n_s_argmin;
  PyObject *__pyx_n_s_argrelextrema;
  PyObject *__pyx_n_s_args;
  PyObject *__pyx_n_s_argsort;
  PyObject *__pyx_n_s_argwhere;
  PyObject *__pyx_n_s_around;
  PyObject *__pyx_n_s_arr;
  PyObject *__pyx_n_u_array;
  PyObject *__pyx_n_s_array_2;
  PyObject *__pyx_n_u_array_2;
  PyObject *__pyx_n_s_arraytools;
  PyObject *__pyx_n_s_as_frame;
  PyObject *__pyx_n_s_asarray;
  PyObject *__pyx_n_s_assert_all_types;
  PyObject *__pyx_n_s_assert_ratio;
  PyObject *__pyx_n_s_assert_x_y_positions;
  PyObject *__pyx_n_s_assert_xy_in;
  PyObject *__pyx_n_s_assign;
  PyObject *__pyx_n_s_astype;
  PyObject *__pyx_n_s_asyncio_coroutines;
  PyObject *__pyx_n_s_auc_score;
  PyObject *__pyx_n_u_auto;
  PyObject *__pyx_n_s_average;
  PyObject *__pyx_n_u_average;
  PyObject *__pyx_n_s_avg_sensitivity;
  PyObject *__pyx_n_s_avg_specificity;
  PyObject *__pyx_n_s_aweights;
  PyObject *__pyx_n_s_ax;
  PyObject *__pyx_n_s_axis;
  PyObject *__pyx_n_s_axis_slice;
  PyObject *__pyx_n_s_azim;
  PyObject *__pyx_n_s_b;
  PyObject *__pyx_kp_u_b_2;
  PyObject *__pyx_n_s_bal_acc_scores;
  PyObject *__pyx_n_s_balanced_accuracy_ovo;
  PyObject *__pyx_n_s_balanced_accuracy_ovr;
  PyObject *__pyx_n_u_base;
  PyObject *__pyx_n_s_base_epsilon;
  PyObject *__pyx_n_s_best_threshold;
  PyObject *__pyx_n_s_beta;
  PyObject *__pyx_n_s_bias;
  PyObject *__pyx_n_s_bin_contribution;
  PyObject *__pyx_n_s_bin_edges;
  PyObject *__pyx_n_s_bin_index;
  PyObject *__pyx_n_s_bin_true;
  PyObject *__pyx_n_s_bin_width;
  PyObject *__pyx_n_u_binary;
  PyObject *__pyx_n_s_binary_y_pred;
  PyObject *__pyx_n_s_binary_y_true;
  PyObject *__pyx_n_u_binning;
  PyObject *__pyx_n_s_bins;
  PyObject *__pyx_n_s_bins_array;
  PyObject *__pyx_n_s_bins_method;
  PyObject *__pyx_n_s_bool;
  PyObject *__pyx_n_s_bounds;
  PyObject *__pyx_n_s_buffer;
  PyObject *__pyx_n_s_c;
  PyObject *__pyx_n_s_c_order;
  PyObject *__pyx_kp_u_c_order_2;
  PyObject *__pyx_kp_u_c_order_3;
  PyObject *__pyx_n_s_calculate_adjusted_lr;
  PyObject *__pyx_n_u_calculate_adjusted_lr;
  PyObject *__pyx_kp_u_calculate_adjusted_lr_line_809;
  PyObject *__pyx_n_s_calculate_binary_iv;
  PyObject *__pyx_n_u_calculate_binary_iv;
  PyObject *__pyx_kp_u_calculate_binary_iv_line_1993;
  PyObject *__pyx_n_s_calculate_histogram_bins;
  PyObject *__pyx_kp_u_calculate_histogram_bins_line_12;
  PyObject *__pyx_n_s_calculate_multiclass_avg_lr;
  PyObject *__pyx_kp_u_calculate_multiclass_avg_lr_line;
  PyObject *__pyx_n_s_calculate_multiclass_lr;
  PyObject *__pyx_kp_u_calculate_multiclass_lr_line_662;
  PyObject *__pyx_n_s_calculate_optimal_bins;
  PyObject *__pyx_n_u_calculate_optimal_bins;
  PyObject *__pyx_kp_u_calculate_optimal_bins_line_1895;
  PyObject *__pyx_n_s_calculate_optimal_bins_locals_ge;
  PyObject *__pyx_n_s_calculate_residuals;
  PyObject *__pyx_n_u_calculate_residuals;
  PyObject *__pyx_kp_u_calculate_residuals_line_2195;
  PyObject *__pyx_n_u_call;
  PyObject *__pyx_n_s_catch_warnings;
  PyObject *__pyx_n_s_category;
  PyObject *__pyx_n_s_ceil;
  PyObject *__pyx_n_s_change;
  PyObject *__pyx_n_s_check_classification_targets;
  PyObject *__pyx_n_s_check_consistent_length;
  PyObject *__pyx_n_s_check_epsilon;
  PyObject *__pyx_n_s_check_y;
  PyObject *__pyx_n_s_ck;
  PyObject *__pyx_n_s_class_getitem;
  PyObject *__pyx_n_s_classes;
  PyObject *__pyx_n_s_cline_in_traceback;
  PyObject *__pyx_n_s_close;
  PyObject *__pyx_n_s_cls;
  PyObject *__pyx_n_s_cls1;
  PyObject *__pyx_n_s_cls2;
  PyObject *__pyx_kp_u_cluster_d;
  PyObject *__pyx_n_s_cm;
  PyObject *__pyx_n_u_cma;
  PyObject *__pyx_n_s_coef;
  PyObject *__pyx_n_s_coeffs;
  PyObject *__pyx_n_s_col;
  PyObject *__pyx_n_s_column;
  PyObject *__pyx_n_s_column2ignore;
  PyObject *__pyx_n_s_columns;
  PyObject *__pyx_n_u_columns;
  PyObject *__pyx_n_s_combinations;
  PyObject *__pyx_n_u_complete;
  PyObject *__pyx_n_s_compute_balance_accuracy;
  PyObject *__pyx_n_u_compute_balance_accuracy;
  PyObject *__pyx_kp_u_compute_balance_accuracy_line_24;
  PyObject *__pyx_n_s_compute_balanced_accuracy_binar;
  PyObject *__pyx_n_s_compute_cost_based_threshold;
  PyObject *__pyx_n_u_compute_cost_based_threshold;
  PyObject *__pyx_kp_u_compute_cost_based_threshold_lin;
  PyObject *__pyx_n_s_compute_effort_yield;
  PyObject *__pyx_n_u_compute_effort_yield;
  PyObject *__pyx_kp_u_compute_effort_yield_line_2440;
  PyObject *__pyx_n_s_compute_errors;
  PyObject *__pyx_n_u_compute_errors;
  PyObject *__pyx_kp_u_compute_errors_line_4287;
  PyObject *__pyx_n_s_compute_ovo_sens_spec;
  PyObject *__pyx_kp_u_compute_ovo_sens_spec_line_1140;
  PyObject *__pyx_n_s_compute_p_values;
  PyObject *__pyx_n_u_compute_p_values;
  PyObject *__pyx_kp_u_compute_p_values_line_97;
  PyObject *__pyx_n_s_compute_sensitivity_specificity;
  PyObject *__pyx_n_s_compute_sensitivity_specificity_2;
  PyObject *__pyx_n_u_compute_sensitivity_specificity_2;
  PyObject *__pyx_kp_u_compute_sensitivity_specificity_3;
  PyObject *__pyx_kp_u_compute_sensitivity_specificity_4;
  PyObject *__pyx_n_s_compute_spearmanr;
  PyObject *__pyx_n_s_compute_spearmanr_locals__weigh;
  PyObject *__pyx_n_s_compute_sunburst_data;
  PyObject *__pyx_n_u_compute_sunburst_data;
  PyObject *__pyx_kp_u_compute_sunburst_data_line_2348;
  PyObject *__pyx_n_s_compute_youdens_index;
  PyObject *__pyx_n_u_compute_youdens_index;
  PyObject *__pyx_kp_u_compute_youdens_index_line_466;
  PyObject *__pyx_n_s_concat;
  PyObject *__pyx_n_s_concat_array_from_list;
  PyObject *__pyx_n_s_concat_axis;
  PyObject *__pyx_n_s_concatenate;
  PyObject *__pyx_n_u_condens;
  PyObject *__pyx_n_u_condense;
  PyObject *__pyx_n_s_confusion_matrix;
  PyObject *__pyx_n_s_consensus;
  PyObject *__pyx_n_u_consensus;
  PyObject *__pyx_n_u_constant;
  PyObject *__pyx_n_u_contains;
  PyObject *__pyx_n_u_continuous;
  PyObject *__pyx_n_s_control_vars;
  PyObject *__pyx_n_u_conv;
  PyObject *__pyx_n_s_convert_distance_to_m;
  PyObject *__pyx_n_s_converter;
  PyObject *__pyx_n_s_convolve;
  PyObject *__pyx_n_s_convolve1d;
  PyObject *__pyx_n_s_copy;
  PyObject *__pyx_n_s_coreutils;
  PyObject *__pyx_n_s_corr;
  PyObject *__pyx_n_s_corr_func;
  PyObject *__pyx_n_s_corr_methods;
  PyObject *__pyx_n_s_corrcoef;
  PyObject *__pyx_n_s_cos;
  PyObject *__pyx_n_s_cost_history;
  PyObject *__pyx_n_s_costs;
  PyObject *__pyx_n_u_costs;
  PyObject *__pyx_kp_u_could_not_convert_string_to_floa;
  PyObject *__pyx_n_s_count;
  PyObject *__pyx_n_u_count;
  PyObject *__pyx_n_s_count_local_minima;
  PyObject *__pyx_kp_u_count_local_minima_line_3171;
  PyObject *__pyx_n_s_counts;
  PyObject *__pyx_n_s_cov;
  PyObject *__pyx_n_s_cubic_regression;
  PyObject *__pyx_n_u_cubic_regression;
  PyObject *__pyx_n_s_cum_weights;
  PyObject *__pyx_n_s_cumsum;
  PyObject *__pyx_n_u_cumulative;
  PyObject *__pyx_kp_u_cumulative_average;
  PyObject *__pyx_n_s_cumulative_data;
  PyObject *__pyx_n_s_curve_fit;
  PyObject *__pyx_kp_u_custom_logic;
  PyObject *__pyx_n_s_cval;
  PyObject *__pyx_n_s_d;
  PyObject *__pyx_n_s_data;
  PyObject *__pyx_n_u_data;
  PyObject *__pyx_n_s_data_2;
  PyObject *__pyx_n_s_data_max;
  PyObject *__pyx_n_s_data_min;
  PyObject *__pyx_n_s_data_range;
  PyObject *__pyx_kp_u_data_range_must_be_a_tuple_of_tw;
  PyObject *__pyx_kp_u_data_range_must_contain_numeric;
  PyObject *__pyx_kp_u_data_should_be_a_frame_not;
  PyObject *__pyx_n_s_ddof;
  PyObject *__pyx_n_s_decorators;
  PyObject *__pyx_n_s_deep;
  PyObject *__pyx_n_s_deepcopy;
  PyObject *__pyx_n_s_default;
  PyObject *__pyx_n_s_defaults;
  PyObject *__pyx_n_s_deg;
  PyObject *__pyx_n_s_deg2rad;
  PyObject *__pyx_n_s_degree;
  PyObject *__pyx_n_s_delete;
  PyObject *__pyx_n_s_delta;
  PyObject *__pyx_n_u_dense;
  PyObject *__pyx_n_s_dense_rank;
  PyObject *__pyx_n_s_depvar;
  PyObject *__pyx_n_u_depvar;
  PyObject *__pyx_n_s_deriv;
  PyObject *__pyx_n_u_design;
  PyObject *__pyx_n_s_detect_station_position;
  PyObject *__pyx_kp_u_detect_station_position_line_374;
  PyObject *__pyx_n_s_determine_epsilon;
  PyObject *__pyx_n_s_df;
  PyObject *__pyx_n_s_df_full;
  PyObject *__pyx_n_s_df_level;
  PyObject *__pyx_n_s_df_only;
  PyObject *__pyx_n_s_diag;
  PyObject *__pyx_n_s_diff;
  PyObject *__pyx_n_s_digitize;
  PyObject *__pyx_n_s_digitized;
  PyObject *__pyx_n_s_dipole;
  PyObject *__pyx_kp_u_disable;
  PyObject *__pyx_n_s_distance;
  PyObject *__pyx_n_u_distance;
  PyObject *__pyx_n_s_dl;
  PyObject *__pyx_n_s_doc;
  PyObject *__pyx_n_s_dot;
  PyObject *__pyx_n_u_dot;
  PyObject *__pyx_n_s_dp;
  PyObject *__pyx_n_s_drop;
  PyObject *__pyx_n_s_drop_duplicates;
  PyObject *__pyx_n_s_drop_intermediate;
  PyObject *__pyx_n_s_dtype;
  PyObject *__pyx_n_s_dx;
  PyObject *__pyx_n_s_dy;
  PyObject *__pyx_n_s_easting;
  PyObject *__pyx_n_s_effort;
  PyObject *__pyx_n_s_ellipsis2false;
  PyObject *__pyx_n_u_ema;
  PyObject *__pyx_n_s_empty;
  PyObject *__pyx_n_s_empty_like;
  PyObject *__pyx_kp_u_enable;
  PyObject *__pyx_n_s_end;
  PyObject *__pyx_n_s_ensure_2d;
  PyObject *__pyx_n_s_ensure_non_negative;
  PyObject *__pyx_n_s_ensure_y_is_valid;
  PyObject *__pyx_n_s_enter;
  PyObject *__pyx_n_s_enumerate;
  PyObject *__pyx_n_s_epsilon;
  PyObject *__pyx_n_s_err;
  PyObject *__pyx_n_s_err_lower;
  PyObject *__pyx_n_s_err_msg;
  PyObject *__pyx_n_s_err_upper;
  PyObject *__pyx_n_s_error;
  PyObject *__pyx_n_u_error;
  PyObject *__pyx_n_s_error_msg;
  PyObject *__pyx_n_s_errstate;
  PyObject *__pyx_n_s_estimator;
  PyObject *__pyx_n_s_estimators;
  PyObject *__pyx_n_u_euclidean;
  PyObject *__pyx_n_s_exceptions;
  PyObject *__pyx_n_s_exclude_string;
  PyObject *__pyx_n_s_exclude_value;
  PyObject *__pyx_n_s_exit;
  PyObject *__pyx_n_s_exp;
  PyObject *__pyx_n_s_expect_name;
  PyObject *__pyx_n_u_exponential;
  PyObject *__pyx_kp_u_exponential_moving_average;
  PyObject *__pyx_n_s_exponential_regression;
  PyObject *__pyx_n_u_exponential_regression;
  PyObject *__pyx_kp_u_extra_azimuth;
  PyObject *__pyx_n_s_extrapolate;
  PyObject *__pyx_n_s_false_negatives;
  PyObject *__pyx_n_s_false_positives;
  PyObject *__pyx_n_s_fig;
  PyObject *__pyx_n_s_figsize;
  PyObject *__pyx_n_s_filtering_1d_array;
  PyObject *__pyx_n_s_filterwarnings;
  PyObject *__pyx_n_s_find;
  PyObject *__pyx_n_s_find_close_position;
  PyObject *__pyx_n_s_find_closest;
  PyObject *__pyx_kp_u_find_closest_line_4771;
  PyObject *__pyx_n_s_fit;
  PyObject *__pyx_kp_u_fit_a_5_3f_b_5_3f;
  PyObject *__pyx_n_s_fit_edge;
  PyObject *__pyx_n_s_fit_edges_polyfit;
  PyObject *__pyx_n_s_fit_transform;
  PyObject *__pyx_n_s_float;
  PyObject *__pyx_n_u_float;
  PyObject *__pyx_n_s_float32;
  PyObject *__pyx_n_s_float64;
  PyObject *__pyx_n_s_float_factorial;
  PyObject *__pyx_n_s_format;
  PyObject *__pyx_n_s_fpr;
  PyObject *__pyx_n_u_freedman_diaconis;
  PyObject *__pyx_n_s_from0;
  PyObject *__pyx_n_s_func;
  PyObject *__pyx_kp_u_func_argument_is_a_callable_not;
  PyObject *__pyx_kp_u_gc;
  PyObject *__pyx_n_s_genexpr;
  PyObject *__pyx_n_s_get;
  PyObject *__pyx_n_s_get_azimuth;
  PyObject *__pyx_kp_u_get_azimuth_line_3229;
  PyObject *__pyx_n_s_get_azimuth_locals_lambda;
  PyObject *__pyx_n_s_get_bearing;
  PyObject *__pyx_n_u_get_bearing;
  PyObject *__pyx_kp_u_get_bearing_line_4703;
  PyObject *__pyx_n_s_get_distance;
  PyObject *__pyx_n_u_get_distance;
  PyObject *__pyx_kp_u_get_distance_line_4518;
  PyObject *__pyx_n_s_get_gofast_logger;
  PyObject *__pyx_n_s_get_profile_angle;
  PyObject *__pyx_n_s_get_station_number;
  PyObject *__pyx_n_s_gofast_tools_mathex;
  PyObject *__pyx_kp_s_gofast_tools_mathex_pyx;
  PyObject *__pyx_n_s_gofastlog;
  PyObject *__pyx_n_s_gofastlog_2;
  PyObject *__pyx_n_s_gradient_boosting_regressor;
  PyObject *__pyx_kp_u_gradient_boosting_regressor_line;
  PyObject *__pyx_n_s_gradient_descent;
  PyObject *__pyx_kp_u_gradient_descent_line_4820;
  PyObject *__pyx_n_s_group;
  PyObject *__pyx_n_s_groupby;
  PyObject *__pyx_n_s_halflen;
  PyObject *__pyx_n_s_hierarchy;
  PyObject *__pyx_n_s_histogram_bin_edges;
  PyObject *__pyx_n_s_hstack;
  PyObject *__pyx_n_s_i;
  PyObject *__pyx_n_s_idx;
  PyObject *__pyx_n_s_ignore;
  PyObject *__pyx_n_u_ignore;
  PyObject *__pyx_n_s_ignore_index;
  PyObject *__pyx_n_s_ii;
  PyObject *__pyx_n_s_iloc;
  PyObject *__pyx_n_s_import;
  PyObject *__pyx_n_s_in_bin;
  PyObject *__pyx_n_s_in_percent;
  PyObject *__pyx_n_s_include_label;
  PyObject *__pyx_n_s_include_metrics;
  PyObject *__pyx_n_s_include_nan;
  PyObject *__pyx_n_s_index;
  PyObject *__pyx_n_u_inf;
  PyObject *__pyx_n_s_infer_sankey_columns;
  PyObject *__pyx_n_u_infer_sankey_columns;
  PyObject *__pyx_kp_u_infer_sankey_columns_line_2272;
  PyObject *__pyx_n_s_init_weights;
  PyObject *__pyx_n_s_initializing;
  PyObject *__pyx_n_s_input_name;
  PyObject *__pyx_n_s_inspect;
  PyObject *__pyx_kp_u_instead_of;
  PyObject *__pyx_n_s_int;
  PyObject *__pyx_n_s_int32;
  PyObject *__pyx_n_u_interp;
  PyObject *__pyx_n_s_interp_start;
  PyObject *__pyx_n_s_interp_stop;
  PyObject *__pyx_n_s_inv;
  PyObject *__pyx_n_s_inverse_transform;
  PyObject *__pyx_n_s_involved_pairs;
  PyObject *__pyx_n_s_iqr;
  PyObject *__pyx_n_s_is_arraylike_1d;
  PyObject *__pyx_n_s_is_binary_class;
  PyObject *__pyx_n_s_is_coroutine;
  PyObject *__pyx_n_s_is_frame;
  PyObject *__pyx_kp_u_is_gotten;
  PyObject *__pyx_n_s_is_iterable;
  PyObject *__pyx_n_s_is_latlon;
  PyObject *__pyx_kp_u_is_not_admitted_Expect_at_least;
  PyObject *__pyx_n_s_is_numeric_dtype;
  PyObject *__pyx_kp_u_is_out_of_the_range_max_positio;
  PyObject *__pyx_n_s_is_utm;
  PyObject *__pyx_n_s_isdeg;
  PyObject *__pyx_n_s_isdigit;
  PyObject *__pyx_kp_u_isenabled;
  PyObject *__pyx_n_s_isfunction;
  PyObject *__pyx_n_s_isin;
  PyObject *__pyx_n_s_islatlon;
  PyObject *__pyx_n_s_isnan;
  PyObject *__pyx_n_s_isnull;
  PyObject *__pyx_n_s_isreal;
  PyObject *__pyx_n_s_isscalar;
  PyObject *__pyx_n_s_issubdtype;
  PyObject *__pyx_n_s_items;
  PyObject *__pyx_n_s_iterrows;
  PyObject *__pyx_n_s_itertools;
  PyObject *__pyx_n_s_iv;
  PyObject *__pyx_n_s_ix_c;
  PyObject *__pyx_n_s_j;
  PyObject *__pyx_n_s_k;
  PyObject *__pyx_n_s_keepdims;
  PyObject *__pyx_n_u_kendall;
  PyObject *__pyx_n_s_kendalltau;
  PyObject *__pyx_n_s_key;
  PyObject *__pyx_n_s_kind;
  PyObject *__pyx_n_s_kind_of_model;
  PyObject *__pyx_n_s_kind_of_model_locals_init_weigh;
  PyObject *__pyx_n_u_km;
  PyObject *__pyx_n_s_kws;
  PyObject *__pyx_n_s_label;
  PyObject *__pyx_n_s_label_binarize;
  PyObject *__pyx_n_s_label_i;
  PyObject *__pyx_n_s_label_importance;
  PyObject *__pyx_n_u_label_importance;
  PyObject *__pyx_kp_u_label_importance_line_2612;
  PyObject *__pyx_n_s_label_j;
  PyObject *__pyx_n_s_label_to_index;
  PyObject *__pyx_n_s_label_y;
  PyObject *__pyx_n_s_label_yt_trailer;
  PyObject *__pyx_n_s_labels;
  PyObject *__pyx_n_s_lat1;
  PyObject *__pyx_n_s_lat2;
  PyObject *__pyx_n_s_latlon1;
  PyObject *__pyx_n_s_latlon2;
  PyObject *__pyx_n_s_le;
  PyObject *__pyx_n_s_le_pred;
  PyObject *__pyx_n_s_le_true;
  PyObject *__pyx_n_s_learning_rate;
  PyObject *__pyx_n_s_legend;
  PyObject *__pyx_n_s_less;
  PyObject *__pyx_n_s_linalg;
  PyObject *__pyx_n_u_linear;
  PyObject *__pyx_n_s_linear_regression;
  PyObject *__pyx_n_u_linear_regression;
  PyObject *__pyx_n_s_linfunc;
  PyObject *__pyx_n_s_linkage;
  PyObject *__pyx_n_s_linkage_matrix;
  PyObject *__pyx_n_u_linkage_matrix;
  PyObject *__pyx_n_s_linregress;
  PyObject *__pyx_n_s_linspace;
  PyObject *__pyx_n_u_ll;
  PyObject *__pyx_n_s_local_minima_count;
  PyObject *__pyx_n_s_local_minima_indices;
  PyObject *__pyx_n_s_log;
  PyObject *__pyx_n_s_log10;
  PyObject *__pyx_n_s_log2;
  PyObject *__pyx_n_s_logarithmic_regression;
  PyObject *__pyx_n_u_logarithmic_regression;
  PyObject *__pyx_n_s_logger;
  PyObject *__pyx_n_s_logify;
  PyObject *__pyx_n_s_lon1;
  PyObject *__pyx_n_s_lon2;
  PyObject *__pyx_n_s_lower;
  PyObject *__pyx_n_s_lr;
  PyObject *__pyx_n_s_lstsq;
  PyObject *__pyx_n_s_m;
  PyObject *__pyx_n_u_m;
  PyObject *__pyx_n_u_macro;
  PyObject *__pyx_n_s_main;
  PyObject *__pyx_n_s_make_mxs;
  PyObject *__pyx_n_u_make_mxs;
  PyObject *__pyx_kp_u_make_mxs_line_2514;
  PyObject *__pyx_n_s_manage_colors;
  PyObject *__pyx_n_s_map;
  PyObject *__pyx_n_s_marker;
  PyObject *__pyx_n_s_match_method;
  PyObject *__pyx_n_s_matplotlib;
  PyObject *__pyx_n_s_matplotlib_pyplot;
  PyObject *__pyx_n_s_max;
  PyObject *__pyx_n_u_max;
  PyObject *__pyx_n_s_max_depth;
  PyObject *__pyx_n_s_max_lr;
  PyObject *__pyx_n_s_maximum;
  PyObject *__pyx_n_s_mean;
  PyObject *__pyx_n_s_mean_rank_pred;
  PyObject *__pyx_n_s_mean_rank_true;
  PyObject *__pyx_n_s_method;
  PyObject *__pyx_n_u_method;
  PyObject *__pyx_n_s_metric;
  PyObject *__pyx_n_u_micro;
  PyObject *__pyx_n_s_micro_sensitivity;
  PyObject *__pyx_n_s_micro_specificity;
  PyObject *__pyx_n_s_min;
  PyObject *__pyx_n_u_min;
  PyObject *__pyx_n_s_min_cost;
  PyObject *__pyx_n_s_min_non_zero_pred;
  PyObject *__pyx_n_s_minimum;
  PyObject *__pyx_n_s_minmax_scaler;
  PyObject *__pyx_n_u_minmax_scaler;
  PyObject *__pyx_kp_u_minmax_scaler_line_2947;
  PyObject *__pyx_n_u_mirror;
  PyObject *__pyx_n_s_mode;
  PyObject *__pyx_kp_u_mode_must_be_mirror_constant_nea;
  PyObject *__pyx_n_s_model_pred;
  PyObject *__pyx_n_s_model_true;
  PyObject *__pyx_n_s_moving_average;
  PyObject *__pyx_kp_u_moving_average_line_3046;
  PyObject *__pyx_n_s_msg;
  PyObject *__pyx_n_s_msg_meth;
  PyObject *__pyx_n_s_mu0;
  PyObject *__pyx_n_s_multi_output;
  PyObject *__pyx_n_u_multiclass;
  PyObject *__pyx_n_s_multioutput;
  PyObject *__pyx_n_s_n;
  PyObject *__pyx_n_s_n_epochs;
  PyObject *__pyx_n_s_n_estimators;
  PyObject *__pyx_n_s_name;
  PyObject *__pyx_n_s_name_2;
  PyObject *__pyx_n_u_name_2;
  PyObject *__pyx_n_s_nan;
  PyObject *__pyx_n_s_nan_policy;
  PyObject *__pyx_n_s_nan_sum;
  PyObject *__pyx_n_s_nansum;
  PyObject *__pyx_n_s_ndarray;
  PyObject *__pyx_n_s_ndim;
  PyObject *__pyx_n_u_nearest;
  PyObject *__pyx_n_u_negative;
  PyObject *__pyx_n_s_newaxis;
  PyObject *__pyx_kp_u_no_of_items_in_clust;
  PyObject *__pyx_n_s_noise;
  PyObject *__pyx_n_u_none;
  PyObject *__pyx_n_s_nonzero;
  PyObject *__pyx_n_s_norm;
  PyObject *__pyx_n_s_normalize;
  PyObject *__pyx_n_u_normalize;
  PyObject *__pyx_kp_u_normalize_line_2997;
  PyObject *__pyx_n_s_normalize_string;
  PyObject *__pyx_n_s_northing;
  PyObject *__pyx_kp_u_not_found_in;
  PyObject *__pyx_kp_u_not_found_in_DataFrame_columns;
  PyObject *__pyx_n_s_np;
  PyObject *__pyx_n_s_number;
  PyObject *__pyx_n_s_numeric_cols;
  PyObject *__pyx_n_s_numpy;
  PyObject *__pyx_n_u_o;
  PyObject *__pyx_kp_u_ob;
  PyObject *__pyx_n_s_objname;
  PyObject *__pyx_kp_u_ok;
  PyObject *__pyx_n_u_ok_2;
  PyObject *__pyx_n_u_omit;
  PyObject *__pyx_n_s_ones;
  PyObject *__pyx_n_s_ones_like;
  PyObject *__pyx_n_s_optimal_bins;
  PyObject *__pyx_n_s_optimal_idx;
  PyObject *__pyx_n_s_optimal_ordering;
  PyObject *__pyx_n_s_optimal_threshold;
  PyObject *__pyx_n_s_optimal_youden;
  PyObject *__pyx_n_s_optimized_spearmanr;
  PyObject *__pyx_n_u_optimized_spearmanr;
  PyObject *__pyx_kp_u_optimized_spearmanr_line_1351;
  PyObject *__pyx_n_u_or;
  PyObject *__pyx_kp_u_or_2;
  PyObject *__pyx_n_s_order;
  PyObject *__pyx_n_u_ordinal;
  PyObject *__pyx_n_u_ovo;
  PyObject *__pyx_n_u_ovr;
  PyObject *__pyx_n_s_p;
  PyObject *__pyx_n_s_p_value;
  PyObject *__pyx_n_s_p_values;
  PyObject *__pyx_n_s_pair;
  PyObject *__pyx_n_s_pair_indices;
  PyObject *__pyx_n_s_pairwise_distances;
  PyObject *__pyx_n_s_pandas;
  PyObject *__pyx_n_s_param_name;
  PyObject *__pyx_n_s_parameter_validator;
  PyObject *__pyx_n_u_parent;
  PyObject *__pyx_n_u_passthrough;
  PyObject *__pyx_n_s_pcov;
  PyObject *__pyx_n_s_pd;
  PyObject *__pyx_n_s_pdist;
  PyObject *__pyx_n_u_pearson;
  PyObject *__pyx_n_s_pearsonr;
  PyObject *__pyx_n_s_percent_events;
  PyObject *__pyx_n_s_percent_events_bin;
  PyObject *__pyx_n_s_percent_non_events;
  PyObject *__pyx_n_s_percent_non_events_bin;
  PyObject *__pyx_n_s_percentile;
  PyObject *__pyx_n_s_pi;
  PyObject *__pyx_n_u_pk;
  PyObject *__pyx_n_s_plot;
  PyObject *__pyx_n_s_plt;
  PyObject *__pyx_n_u_poly;
  PyObject *__pyx_n_s_poly_coeffs;
  PyObject *__pyx_n_s_polyder;
  PyObject *__pyx_n_s_polyfit;
  PyObject *__pyx_n_s_polyorder;
  PyObject *__pyx_kp_u_polyorder_must_be_less_than_wind;
  PyObject *__pyx_n_s_polyval;
  PyObject *__pyx_n_s_pop_cat_features;
  PyObject *__pyx_n_s_popt;
  PyObject *__pyx_n_s_pos;
  PyObject *__pyx_n_s_pos_label;
  PyObject *__pyx_kp_u_pos_must_be_nonnegative_and_less;
  PyObject *__pyx_kp_u_positions;
  PyObject *__pyx_n_u_positive;
  PyObject *__pyx_n_s_positive_preds;
  PyObject *__pyx_n_s_power;
  PyObject *__pyx_n_s_predict;
  PyObject *__pyx_n_s_predict_proba;
  PyObject *__pyx_n_s_predicted;
  PyObject *__pyx_n_s_predicted_labels;
  PyObject *__pyx_n_s_prev_val;
  PyObject *__pyx_n_s_print;
  PyObject *__pyx_n_s_prob_true_class;
  PyObject *__pyx_n_s_profile1;
  PyObject *__pyx_n_s_profile2;
  PyObject *__pyx_n_s_profile_angle;
  PyObject *__pyx_n_s_profile_line;
  PyObject *__pyx_n_s_projection;
  PyObject *__pyx_n_u_propagate;
  PyObject *__pyx_n_s_pyplot;
  PyObject *__pyx_n_s_quadratic_regression;
  PyObject *__pyx_n_u_quadratic_regression;
  PyObject *__pyx_n_s_quality_control2;
  PyObject *__pyx_kp_u_quality_control2_line_4409;
  PyObject *__pyx_kp_u_r;
  PyObject *__pyx_n_s_rad2deg;
  PyObject *__pyx_n_u_raise;
  PyObject *__pyx_n_s_raise_exception;
  PyObject *__pyx_n_s_raise_warn;
  PyObject *__pyx_n_u_raises;
  PyObject *__pyx_n_s_randn;
  PyObject *__pyx_n_s_random;
  PyObject *__pyx_n_s_range;
  PyObject *__pyx_n_s_rank_data;
  PyObject *__pyx_n_u_rank_data;
  PyObject *__pyx_kp_u_rank_data_line_1263;
  PyObject *__pyx_n_s_rankdata;
  PyObject *__pyx_n_s_ranks;
  PyObject *__pyx_n_s_ranks_pred;
  PyObject *__pyx_n_s_ranks_true;
  PyObject *__pyx_n_s_rate;
  PyObject *__pyx_n_s_ravel;
  PyObject *__pyx_kp_u_raw_azimuth;
  PyObject *__pyx_n_u_raw_values;
  PyObject *__pyx_n_s_refglossary;
  PyObject *__pyx_n_u_regression;
  PyObject *__pyx_n_u_reject;
  PyObject *__pyx_n_s_relevant_mask;
  PyObject *__pyx_n_s_rem;
  PyObject *__pyx_n_s_replace;
  PyObject *__pyx_n_s_reset_index;
  PyObject *__pyx_n_s_reshape;
  PyObject *__pyx_n_s_residual;
  PyObject *__pyx_n_s_residuals;
  PyObject *__pyx_n_s_residuals_pred;
  PyObject *__pyx_n_s_residuals_true;
  PyObject *__pyx_n_s_result;
  PyObject *__pyx_n_s_results;
  PyObject *__pyx_n_s_return;
  PyObject *__pyx_n_s_return_array;
  PyObject *__pyx_n_s_return_confidence;
  PyObject *__pyx_n_s_return_counts;
  PyObject *__pyx_n_s_return_data;
  PyObject *__pyx_n_s_return_mean_dist;
  PyObject *__pyx_n_s_return_qco;
  PyObject *__pyx_n_s_return_target_only;
  PyObject *__pyx_n_s_return_weighted_rank;
  PyObject *__pyx_n_s_return_ymxs;
  PyObject *__pyx_n_s_reverse;
  PyObject *__pyx_n_s_rho;
  PyObject *__pyx_n_s_rng;
  PyObject *__pyx_n_u_robust;
  PyObject *__pyx_n_s_roc_auc_score;
  PyObject *__pyx_n_s_roc_curve;
  PyObject *__pyx_n_s_row;
  PyObject *__pyx_n_s_row_clusters;
  PyObject *__pyx_n_s_row_dist;
  PyObject *__pyx_kp_u_row_label_1;
  PyObject *__pyx_kp_u_row_lable_2;
  PyObject *__pyx_n_s_rr;
  PyObject *__pyx_n_s_s;
  PyObject *__pyx_n_u_s;
  PyObject *__pyx_n_s_s_index;
  PyObject *__pyx_n_u_same;
  PyObject *__pyx_n_s_sample_weight;
  PyObject *__pyx_n_s_savgol_coeffs;
  PyObject *__pyx_kp_u_savgol_coeffs_line_3949;
  PyObject *__pyx_n_s_savgol_filter;
  PyObject *__pyx_n_u_savgol_filter;
  PyObject *__pyx_kp_u_savgol_filter_line_4159;
  PyObject *__pyx_n_s_scalePosition;
  PyObject *__pyx_kp_u_scalePosition_line_3596;
  PyObject *__pyx_n_s_scalePosition_locals_lambda;
  PyObject *__pyx_n_s_scalePosition_locals_linfunc;
  PyObject *__pyx_n_s_scale_factor;
  PyObject *__pyx_n_s_scale_positions;
  PyObject *__pyx_kp_u_scale_positions_line_4567;
  PyObject *__pyx_n_u_scaled;
  PyObject *__pyx_n_s_scipy;
  PyObject *__pyx_n_s_scipy__lib__util;
  PyObject *__pyx_n_s_scipy_cluster_hierarchy;
  PyObject *__pyx_n_s_scipy_linalg;
  PyObject *__pyx_n_s_scipy_ndimage;
  PyObject *__pyx_n_s_scipy_optimize;
  PyObject *__pyx_n_s_scipy_signal;
  PyObject *__pyx_n_s_scipy_spatial_distance;
  PyObject *__pyx_n_s_scipy_stats;
  PyObject *__pyx_n_s_score;
  PyObject *__pyx_n_s_scores;
  PyObject *__pyx_n_u_se;
  PyObject *__pyx_n_s_seen;
  PyObject *__pyx_n_s_select_dtypes;
  PyObject *__pyx_n_s_send;
  PyObject *__pyx_n_s_sens_array;
  PyObject *__pyx_n_s_sensitivities;
  PyObject *__pyx_n_s_sensitivity;
  PyObject *__pyx_n_s_set_xlabel;
  PyObject *__pyx_n_s_set_ylabel;
  PyObject *__pyx_n_s_shape;
  PyObject *__pyx_n_s_shift;
  PyObject *__pyx_n_u_shifted;
  PyObject *__pyx_kp_u_should_be_less_than_the_number;
  PyObject *__pyx_n_s_show;
  PyObject *__pyx_n_s_shp;
  PyObject *__pyx_n_s_significance_threshold;
  PyObject *__pyx_n_s_similarities;
  PyObject *__pyx_n_s_similarity;
  PyObject *__pyx_n_u_simple;
  PyObject *__pyx_kp_u_simple_moving_average;
  PyObject *__pyx_n_s_simplefilter;
  PyObject *__pyx_n_s_sin;
  PyObject *__pyx_n_s_sinusoidal_regression;
  PyObject *__pyx_n_u_sinusoidal_regression;
  PyObject *__pyx_n_s_site;
  PyObject *__pyx_n_s_size;
  PyObject *__pyx_n_s_sklearn_linear_model;
  PyObject *__pyx_n_s_sklearn_metrics;
  PyObject *__pyx_n_s_sklearn_preprocessing;
  PyObject *__pyx_n_s_sklearn_utils_multiclass;
  PyObject *__pyx_n_u_sma;
  PyObject *__pyx_n_s_smart_format;
  PyObject *__pyx_n_u_soft;
  PyObject *__pyx_n_s_sorted_data;
  PyObject *__pyx_n_s_sorted_indices;
  PyObject *__pyx_n_s_sorter;
  PyObject *__pyx_n_u_source;
  PyObject *__pyx_n_s_source_col;
  PyObject *__pyx_n_s_sources;
  PyObject *__pyx_n_u_spearman;
  PyObject *__pyx_n_s_spearman_corr;
  PyObject *__pyx_n_s_spearmanr;
  PyObject *__pyx_n_s_spec;
  PyObject *__pyx_n_s_spec_array;
  PyObject *__pyx_n_s_specific_y_pred;
  PyObject *__pyx_n_s_specific_y_true;
  PyObject *__pyx_n_s_specificities;
  PyObject *__pyx_n_s_specificity;
  PyObject *__pyx_n_s_spstats;
  PyObject *__pyx_n_s_sqrt;
  PyObject *__pyx_n_u_sqrt;
  PyObject *__pyx_n_s_squareform;
  PyObject *__pyx_n_u_squareform;
  PyObject *__pyx_n_s_squeeze;
  PyObject *__pyx_n_s_standard_scaler;
  PyObject *__pyx_n_u_standard_scaler;
  PyObject *__pyx_kp_u_standard_scaler_line_2896;
  PyObject *__pyx_n_s_star_mxs;
  PyObject *__pyx_n_s_start;
  PyObject *__pyx_n_s_state;
  PyObject *__pyx_n_s_stats;
  PyObject *__pyx_n_s_std;
  PyObject *__pyx_n_u_std;
  PyObject *__pyx_n_s_std_pred;
  PyObject *__pyx_n_s_std_true;
  PyObject *__pyx_n_s_step;
  PyObject *__pyx_n_s_step_function;
  PyObject *__pyx_n_s_step_regression;
  PyObject *__pyx_n_u_step_regression;
  PyObject *__pyx_n_s_step_regression_locals_lambda;
  PyObject *__pyx_n_s_stop;
  PyObject *__pyx_n_s_str;
  PyObject *__pyx_n_s_strategy;
  PyObject *__pyx_n_u_strategy;
  PyObject *__pyx_n_u_strict;
  PyObject *__pyx_n_s_strip;
  PyObject *__pyx_n_s_stump;
  PyObject *__pyx_n_u_sturges;
  PyObject *__pyx_n_s_subplots;
  PyObject *__pyx_n_s_subset;
  PyObject *__pyx_n_s_subtract;
  PyObject *__pyx_n_s_sum;
  PyObject *__pyx_n_s_sunburst_data;
  PyObject *__pyx_n_s_support;
  PyObject *__pyx_n_s_swapaxes;
  PyObject *__pyx_n_s_swapped;
  PyObject *__pyx_n_u_ta;
  PyObject *__pyx_n_u_target;
  PyObject *__pyx_n_s_target_col;
  PyObject *__pyx_n_s_target_strs;
  PyObject *__pyx_n_s_targets;
  PyObject *__pyx_n_s_task_type;
  PyObject *__pyx_n_s_test;
  PyObject *__pyx_n_s_threshold;
  PyObject *__pyx_n_s_thresholds;
  PyObject *__pyx_n_s_throw;
  PyObject *__pyx_n_s_tie_method;
  PyObject *__pyx_n_s_title;
  PyObject *__pyx_n_s_to_array;
  PyObject *__pyx_n_s_to_deg;
  PyObject *__pyx_n_s_to_frame;
  PyObject *__pyx_n_s_to_latlon_in;
  PyObject *__pyx_n_s_to_log10;
  PyObject *__pyx_n_s_to_numeric_dtypes;
  PyObject *__pyx_n_s_to_utm_in;
  PyObject *__pyx_n_s_tol;
  PyObject *__pyx_n_u_tolerance;
  PyObject *__pyx_n_s_tolist;
  PyObject *__pyx_n_s_torres_verdin_filter;
  PyObject *__pyx_kp_u_torres_verdin_filter_line_4997;
  PyObject *__pyx_n_s_torres_verdin_filter_locals__fil;
  PyObject *__pyx_n_s_total;
  PyObject *__pyx_n_s_total_FN;
  PyObject *__pyx_n_s_total_FP;
  PyObject *__pyx_n_s_total_TN;
  PyObject *__pyx_n_s_total_TP;
  PyObject *__pyx_n_s_total_cost;
  PyObject *__pyx_n_s_total_weight;
  PyObject *__pyx_n_s_tpr;
  PyObject *__pyx_n_s_trailer;
  PyObject *__pyx_kp_u_trailer_must_be_a_non_numeric_st;
  PyObject *__pyx_n_s_transform;
  PyObject *__pyx_n_s_true_negatives;
  PyObject *__pyx_n_s_true_positives;
  PyObject *__pyx_n_s_type_of_target;
  PyObject *__pyx_n_u_uniform_average;
  PyObject *__pyx_n_s_unique;
  PyObject *__pyx_n_s_unique_labels;
  PyObject *__pyx_n_s_unit;
  PyObject *__pyx_n_s_use;
  PyObject *__pyx_n_s_use_average_dist;
  PyObject *__pyx_kp_u_use_lower_bound;
  PyObject *__pyx_kp_u_use_must_be_conv_or_dot;
  PyObject *__pyx_n_u_utm;
  PyObject *__pyx_n_s_utm_zone;
  PyObject *__pyx_kp_u_utm_zone_cannot_be_None_when_pro;
  PyObject *__pyx_n_s_v;
  PyObject *__pyx_n_s_valid_mask;
  PyObject *__pyx_n_s_valid_methods;
  PyObject *__pyx_n_s_valid_policies;
  PyObject *__pyx_n_s_validate_length_range;
  PyObject *__pyx_n_s_validate_multiclass_target;
  PyObject *__pyx_n_s_validate_multioutput;
  PyObject *__pyx_n_s_validate_name_in;
  PyObject *__pyx_n_s_validate_sample_weights;
  PyObject *__pyx_n_s_validate_scores;
  PyObject *__pyx_n_s_validator;
  PyObject *__pyx_n_s_value;
  PyObject *__pyx_n_u_value;
  PyObject *__pyx_n_s_value_col;
  PyObject *__pyx_n_s_value_column;
  PyObject *__pyx_n_s_values;
  PyObject *__pyx_n_u_values;
  PyObject *__pyx_n_s_var;
  PyObject *__pyx_n_s_var_pred;
  PyObject *__pyx_n_s_var_true;
  PyObject *__pyx_n_s_vectorize;
  PyObject *__pyx_n_s_view;
  PyObject *__pyx_n_s_vstack;
  PyObject *__pyx_n_s_w;
  PyObject *__pyx_n_s_warn;
  PyObject *__pyx_n_s_warnings;
  PyObject *__pyx_n_u_weight;
  PyObject *__pyx_n_s_weight_factor;
  PyObject *__pyx_n_u_weighted;
  PyObject *__pyx_kp_u_weighted_moving_average;
  PyObject *__pyx_n_s_weighted_rank;
  PyObject *__pyx_n_s_weighted_spearman_corr;
  PyObject *__pyx_n_s_weighted_spearman_rank;
  PyObject *__pyx_n_u_weighted_spearman_rank;
  PyObject *__pyx_kp_u_weighted_spearman_rank_line_1795;
  PyObject *__pyx_n_s_weighted_spearman_rank_locals_we;
  PyObject *__pyx_n_s_weights;
  PyObject *__pyx_n_s_wf;
  PyObject *__pyx_n_s_where;
  PyObject *__pyx_n_s_window_length;
  PyObject *__pyx_kp_u_window_length_must_be_odd;
  PyObject *__pyx_n_s_window_size;
  PyObject *__pyx_n_s_window_size_factor;
  PyObject *__pyx_kp_u_window_size_has_to_be_of_type_in;
  PyObject *__pyx_kp_u_window_size_is_too_large_for_ave;
  PyObject *__pyx_kp_u_window_size_size_must_be_a_posit;
  PyObject *__pyx_n_s_window_start;
  PyObject *__pyx_n_s_window_stop;
  PyObject *__pyx_n_u_wma;
  PyObject *__pyx_n_u_wrap;
  PyObject *__pyx_n_s_x;
  PyObject *__pyx_n_u_x;
  PyObject *__pyx_kp_u_x_and_y_arrays_must_have_the_sa;
  PyObject *__pyx_n_s_x_edge;
  PyObject *__pyx_kp_u_x_y_are_not_in_longitude_latitud;
  PyObject *__pyx_n_s_xdata;
  PyObject *__pyx_n_s_xlabel;
  PyObject *__pyx_n_s_xlon;
  PyObject *__pyx_kp_u_xlon_and_ylat_arguments_are_grea;
  PyObject *__pyx_n_s_xs;
  PyObject *__pyx_n_s_xx;
  PyObject *__pyx_n_s_xx_edge;
  PyObject *__pyx_n_s_y;
  PyObject *__pyx_n_u_y;
  PyObject *__pyx_n_s_y_bin;
  PyObject *__pyx_n_s_y_edge;
  PyObject *__pyx_n_s_y_max;
  PyObject *__pyx_n_s_y_mean;
  PyObject *__pyx_n_s_y_min;
  PyObject *__pyx_n_s_y_norm;
  PyObject *__pyx_n_s_y_normalized;
  PyObject *__pyx_n_s_y_numeric;
  PyObject *__pyx_n_s_y_pred;
  PyObject *__pyx_n_u_y_pred;
  PyObject *__pyx_n_s_y_pred_binary;
  PyObject *__pyx_n_s_y_pred_indices;
  PyObject *__pyx_n_s_y_pred_pair;
  PyObject *__pyx_n_s_y_scaled;
  PyObject *__pyx_n_s_y_scores;
  PyObject *__pyx_n_s_y_std;
  PyObject *__pyx_n_s_y_true;
  PyObject *__pyx_n_u_y_true;
  PyObject *__pyx_kp_u_y_true_and_y_pred_must_contain_n;
  PyObject *__pyx_kp_u_y_true_and_y_pred_should_be_1_di;
  PyObject *__pyx_n_s_y_true_binarized;
  PyObject *__pyx_n_s_y_true_binary;
  PyObject *__pyx_n_s_y_true_encoded;
  PyObject *__pyx_n_s_y_true_indices;
  PyObject *__pyx_n_s_y_true_pair;
  PyObject *__pyx_n_s_ya;
  PyObject *__pyx_n_s_ydata;
  PyObject *__pyx_n_u_ydata;
  PyObject *__pyx_n_s_ydata_new;
  PyObject *__pyx_n_s_yield;
  PyObject *__pyx_n_s_ylabel;
  PyObject *__pyx_n_s_ylat;
  PyObject *__pyx_n_s_ymxs;
  PyObject *__pyx_n_s_youdens_index;
  PyObject *__pyx_n_s_ys;
  PyObject *__pyx_n_s_yt;
  PyObject *__pyx_kp_u_yt_should_not_contain_NaN_values;
  PyObject *__pyx_n_s_yt_transformed;
  PyObject *__pyx_n_s_yy;
  PyObject *__pyx_n_s_z;
  PyObject *__pyx_n_s_zero_division;
  PyObject *__pyx_n_s_zeros;
  PyObject *__pyx_n_s_zeros_like;
  PyObject *__pyx_n_s_zip;
  PyObject *__pyx_float__5;
  PyObject *__pyx_float_0_;
  PyObject *__pyx_float_1_;
  PyObject *__pyx_float_0_0;
  PyObject *__pyx_float_0_1;
  PyObject *__pyx_float_0_5;
  PyObject *__pyx_float_1_0;
  PyObject *__pyx_float_1e1;
  PyObject *__pyx_float_90_;
  PyObject *__pyx_float_1_96;
  PyObject *__pyx_float_100_;
  PyObject *__pyx_float_180_;
  PyObject *__pyx_float_1eneg_2;
  PyObject *__pyx_float_1eneg_5;
  PyObject *__pyx_float_1eneg_7;
  PyObject *__pyx_float_1eneg_10;
  PyObject *__pyx_float_1eneg_15;
  PyObject *__pyx_int_0;
  PyObject *__pyx_int_1;
  PyObject *__pyx_int_2;
  PyObject *__pyx_int_3;
  PyObject *__pyx_int_4;
  PyObject *__pyx_int_10;
  PyObject *__pyx_int_25;
  PyObject *__pyx_int_75;
  PyObject *__pyx_int_90;
  PyObject *__pyx_int_100;
  PyObject *__pyx_int_180;
  PyObject *__pyx_int_360;
  PyObject *__pyx_int_neg_1;
  PyObject *__pyx_codeobj_;
  PyObject *__pyx_slice__9;
  PyObject *__pyx_tuple__3;
  PyObject *__pyx_tuple__4;
  PyObject *__pyx_tuple__5;
  PyObject *__pyx_tuple__7;
  PyObject *__pyx_slice__16;
  PyObject *__pyx_slice__69;
  PyObject *__pyx_tuple__10;
  PyObject *__pyx_tuple__11;
  PyObject *__pyx_tuple__12;
  PyObject *__pyx_tuple__13;
  PyObject *__pyx_tuple__19;
  PyObject *__pyx_tuple__21;
  PyObject *__pyx_tuple__24;
  PyObject *__pyx_tuple__27;
  PyObject *__pyx_tuple__34;
  PyObject *__pyx_tuple__36;
  PyObject *__pyx_tuple__40;
  PyObject *__pyx_tuple__41;
  PyObject *__pyx_tuple__44;
  PyObject *__pyx_tuple__47;
  PyObject *__pyx_tuple__48;
  PyObject *__pyx_tuple__50;
  PyObject *__pyx_tuple__51;
  PyObject *__pyx_tuple__52;
  PyObject *__pyx_tuple__55;
  PyObject *__pyx_tuple__56;
  PyObject *__pyx_tuple__57;
  PyObject *__pyx_tuple__58;
  PyObject *__pyx_tuple__60;
  PyObject *__pyx_tuple__61;
  PyObject *__pyx_tuple__62;
  PyObject *__pyx_tuple__63;
  PyObject *__pyx_tuple__67;
  PyObject *__pyx_tuple__68;
  PyObject *__pyx_tuple__72;
  PyObject *__pyx_tuple__73;
  PyObject *__pyx_tuple__86;
  PyObject *__pyx_tuple__87;
  PyObject *__pyx_tuple__89;
  PyObject *__pyx_tuple__90;
  PyObject *__pyx_tuple__92;
  PyObject *__pyx_tuple__94;
  PyObject *__pyx_tuple__95;
  PyObject *__pyx_tuple__96;
  PyObject *__pyx_tuple__99;
  PyObject *__pyx_codeobj__6;
  PyObject *__pyx_codeobj__8;
  PyObject *__pyx_slice__109;
  PyObject *__pyx_slice__116;
  PyObject *__pyx_slice__123;
  PyObject *__pyx_tuple__101;
  PyObject *__pyx_tuple__102;
  PyObject *__pyx_tuple__104;
  PyObject *__pyx_tuple__105;
  PyObject *__pyx_tuple__106;
  PyObject *__pyx_tuple__111;
  PyObject *__pyx_tuple__114;
  PyObject *__pyx_tuple__115;
  PyObject *__pyx_tuple__118;
  PyObject *__pyx_tuple__119;
  PyObject *__pyx_tuple__120;
  PyObject *__pyx_tuple__121;
  PyObject *__pyx_tuple__124;
  PyObject *__pyx_tuple__125;
  PyObject *__pyx_tuple__129;
  PyObject *__pyx_tuple__130;
  PyObject *__pyx_tuple__132;
  PyObject *__pyx_tuple__133;
  PyObject *__pyx_tuple__139;
  PyObject *__pyx_tuple__143;
  PyObject *__pyx_tuple__147;
  PyObject *__pyx_tuple__150;
  PyObject *__pyx_tuple__151;
  PyObject *__pyx_tuple__152;
  PyObject *__pyx_tuple__153;
  PyObject *__pyx_tuple__154;
  PyObject *__pyx_tuple__155;
  PyObject *__pyx_tuple__156;
  PyObject *__pyx_tuple__157;
  PyObject *__pyx_tuple__158;
  PyObject *__pyx_tuple__159;
  PyObject *__pyx_tuple__160;
  PyObject *__pyx_tuple__161;
  PyObject *__pyx_tuple__162;
  PyObject *__pyx_tuple__163;
  PyObject *__pyx_tuple__164;
  PyObject *__pyx_tuple__165;
  PyObject *__pyx_tuple__166;
  PyObject *__pyx_tuple__167;
  PyObject *__pyx_tuple__168;
  PyObject *__pyx_tuple__169;
  PyObject *__pyx_tuple__170;
  PyObject *__pyx_tuple__171;
  PyObject *__pyx_tuple__172;
  PyObject *__pyx_tuple__173;
  PyObject *__pyx_tuple__174;
  PyObject *__pyx_tuple__175;
  PyObject *__pyx_tuple__176;
  PyObject *__pyx_tuple__178;
  PyObject *__pyx_tuple__179;
  PyObject *__pyx_tuple__180;
  PyObject *__pyx_tuple__181;
  PyObject *__pyx_tuple__182;
  PyObject *__pyx_tuple__183;
  PyObject *__pyx_tuple__184;
  PyObject *__pyx_tuple__185;
  PyObject *__pyx_tuple__186;
  PyObject *__pyx_tuple__187;
  PyObject *__pyx_tuple__188;
  PyObject *__pyx_tuple__189;
  PyObject *__pyx_tuple__190;
  PyObject *__pyx_tuple__191;
  PyObject *__pyx_tuple__192;
  PyObject *__pyx_tuple__193;
  PyObject *__pyx_tuple__194;
  PyObject *__pyx_tuple__195;
  PyObject *__pyx_tuple__196;
  PyObject *__pyx_tuple__197;
  PyObject *__pyx_tuple__198;
  PyObject *__pyx_tuple__199;
  PyObject *__pyx_tuple__200;
  PyObject *__pyx_tuple__201;
  PyObject *__pyx_tuple__202;
  PyObject *__pyx_tuple__203;
  PyObject *__pyx_tuple__204;
  PyObject *__pyx_tuple__205;
  PyObject *__pyx_tuple__206;
  PyObject *__pyx_tuple__207;
  PyObject *__pyx_tuple__208;
  PyObject *__pyx_tuple__209;
  PyObject *__pyx_tuple__210;
  PyObject *__pyx_tuple__211;
  PyObject *__pyx_tuple__212;
  PyObject *__pyx_tuple__213;
  PyObject *__pyx_tuple__214;
  PyObject *__pyx_tuple__215;
  PyObject *__pyx_tuple__216;
  PyObject *__pyx_tuple__217;
  PyObject *__pyx_tuple__218;
  PyObject *__pyx_tuple__219;
  PyObject *__pyx_tuple__220;
  PyObject *__pyx_tuple__221;
  PyObject *__pyx_tuple__222;
  PyObject *__pyx_tuple__223;
  PyObject *__pyx_tuple__224;
  PyObject *__pyx_tuple__225;
  PyObject *__pyx_tuple__226;
  PyObject *__pyx_tuple__227;
  PyObject *__pyx_tuple__228;
  PyObject *__pyx_tuple__229;
  PyObject *__pyx_tuple__230;
  PyObject *__pyx_tuple__231;
  PyObject *__pyx_tuple__232;
  PyObject *__pyx_tuple__233;
  PyObject *__pyx_tuple__234;
  PyObject *__pyx_tuple__235;
  PyObject *__pyx_tuple__236;
  PyObject *__pyx_tuple__237;
  PyObject *__pyx_tuple__238;
  PyObject *__pyx_tuple__239;
  PyObject *__pyx_codeobj__14;
  PyObject *__pyx_codeobj__15;
  PyObject *__pyx_codeobj__17;
  PyObject *__pyx_codeobj__18;
  PyObject *__pyx_codeobj__20;
  PyObject *__pyx_codeobj__22;
  PyObject *__pyx_codeobj__23;
  PyObject *__pyx_codeobj__25;
  PyObject *__pyx_codeobj__26;
  PyObject *__pyx_codeobj__28;
  PyObject *__pyx_codeobj__29;
  PyObject *__pyx_codeobj__30;
  PyObject *__pyx_codeobj__32;
  PyObject *__pyx_codeobj__33;
  PyObject *__pyx_codeobj__35;
  PyObject *__pyx_codeobj__37;
  PyObject *__pyx_codeobj__38;
  PyObject *__pyx_codeobj__42;
  PyObject *__pyx_codeobj__43;
  PyObject *__pyx_codeobj__45;
  PyObject *__pyx_codeobj__46;
  PyObject *__pyx_codeobj__49;
  PyObject *__pyx_codeobj__53;
  PyObject *__pyx_codeobj__54;
  PyObject *__pyx_codeobj__59;
  PyObject *__pyx_codeobj__64;
  PyObject *__pyx_codeobj__66;
  PyObject *__pyx_codeobj__71;
  PyObject *__pyx_codeobj__74;
  PyObject *__pyx_codeobj__75;
  PyObject *__pyx_codeobj__76;
  PyObject *__pyx_codeobj__77;
  PyObject *__pyx_codeobj__78;
  PyObject *__pyx_codeobj__79;
  PyObject *__pyx_codeobj__80;
  PyObject *__pyx_codeobj__81;
  PyObject *__pyx_codeobj__82;
  PyObject *__pyx_codeobj__83;
  PyObject *__pyx_codeobj__84;
  PyObject *__pyx_codeobj__85;
  PyObject *__pyx_codeobj__91;
  PyObject *__pyx_codeobj__93;
  PyObject *__pyx_codeobj__97;
  PyObject *__pyx_codeobj__98;
  PyObject *__pyx_codeobj__100;
  PyObject *__pyx_codeobj__103;
  PyObject *__pyx_codeobj__108;
  PyObject *__pyx_codeobj__110;
  PyObject *__pyx_codeobj__112;
  PyObject *__pyx_codeobj__113;
  PyObject *__pyx_codeobj__117;
  PyObject *__pyx_codeobj__122;
  PyObject *__pyx_codeobj__126;
  PyObject *__pyx_codeobj__127;
  PyObject *__pyx_codeobj__128;
  PyObject *__pyx_codeobj__131;
  PyObject *__pyx_codeobj__134;
  PyObject *__pyx_codeobj__135;
  PyObject *__pyx_codeobj__136;
  PyObject *__pyx_codeobj__137;
  PyObject *__pyx_codeobj__138;
  PyObject *__pyx_codeobj__140;
  PyObject *__pyx_codeobj__141;
  PyObject *__pyx_codeobj__142;
  PyObject *__pyx_codeobj__144;
  PyObject *__pyx_codeobj__145;
  PyObject *__pyx_codeobj__146;
  PyObject *__pyx_codeobj__148;
  PyObject *__pyx_codeobj__149;
} __pyx_mstate;

#if CYTHON_USE_MODULE_STATE
#ifdef __cplusplus
namespace {
  extern struct PyModuleDef __pyx_moduledef;
} /* anonymous namespace */
#else
static struct PyModuleDef __pyx_moduledef;
#endif

#define __pyx_mstate(o) ((__pyx_mstate *)__Pyx_PyModule_GetState(o))

#define __pyx_mstate_global (__pyx_mstate(PyState_FindModule(&__pyx_moduledef)))

#define __pyx_m (PyState_FindModule(&__pyx_moduledef))
#else
static __pyx_mstate __pyx_mstate_global_static =
#ifdef __cplusplus
    {};
#else
    {0};
#endif
static __pyx_mstate *__pyx_mstate_global = &__pyx_mstate_global_static;
#endif
/* #### Code section: module_state_clear ### */
#if CYTHON_USE_MODULE_STATE
static int __pyx_m_clear(PyObject *m) {
  __pyx_mstate *clear_module_state = __pyx_mstate(m);
  if (!clear_module_state) return 0;
  Py_CLEAR(clear_module_state->__pyx_d);
  Py_CLEAR(clear_module_state->__pyx_b);
  Py_CLEAR(clear_module_state->__pyx_cython_runtime);
  Py_CLEAR(clear_module_state->__pyx_empty_tuple);
  Py_CLEAR(clear_module_state->__pyx_empty_bytes);
  Py_CLEAR(clear_module_state->__pyx_empty_unicode);
  #ifdef __Pyx_CyFunction_USED
  Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
  #endif
  #ifdef __Pyx_FusedFunction_USED
  Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
  #endif
  Py_CLEAR(clear_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr);
  Py_CLEAR(clear_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr);
  Py_CLEAR(clear_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth);
  Py_CLEAR(clear_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth);
  Py_CLEAR(clear_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model);
  Py_CLEAR(clear_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model);
  Py_CLEAR(clear_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter);
  Py_CLEAR(clear_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter);
  Py_CLEAR(clear_module_state->__pyx_kp_u_0A4CEE);
  Py_CLEAR(clear_module_state->__pyx_kp_u_49R);
  Py_CLEAR(clear_module_state->__pyx_n_s_A);
  Py_CLEAR(clear_module_state->__pyx_kp_u_A_moving_average_is_used_with_t);
  Py_CLEAR(clear_module_state->__pyx_kp_u_A_singleton_array);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Adaptative_moving_average_as_sm);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Adjust_y_true_and_y_pred_for_re);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Adjusts_y_true_and_y_pred_for_e);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Adjusts_y_true_and_y_pred_in_a);
  Py_CLEAR(clear_module_state->__pyx_n_s_AppendDocReferences);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Apply_a_Savitzky_Golay_filter_t);
  Py_CLEAR(clear_module_state->__pyx_n_u_Array);
  Py_CLEAR(clear_module_state->__pyx_n_s_ArrayLike);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Array_dimension_is);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Assigns_ranks_to_data_handling);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Axis_must_be_specified_Otherwis);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Azimuth_computation_expects_at_l);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Bins_must_be_auto_or_a_positive);
  Py_CLEAR(clear_module_state->__pyx_n_s_C_FN);
  Py_CLEAR(clear_module_state->__pyx_n_s_C_FP);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_sensitivity_and_speci);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_sensitivity_and_speci_2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_Information_Value);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_average_likelihoo);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_bearing_between_t);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_likelihood_ratio);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_multiclass_likeli);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_optimal_number_of);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculate_the_residuals_for_reg);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculates_histogram_bin_edges);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Calculates_the_adaptive_moving);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Check_the_quality_control_in_th);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_Errors_Standard_Deviati);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_Spearman_s_rank_correla);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_Spearman_s_rank_correla_2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_Youden_s_Index_and_opti);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_azimuth_from_coordinate);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_distance_between_points);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_effort_and_yield_values);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_p_values_for_the_correl);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_sensitivity_and_specifi);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_the_balanced_accuracy_f);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_the_coefficients_for_a_1);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_the_importance_of_each);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_the_similarity_between);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Compute_threshold_using_a_cost);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Computes_the_data_structure_req);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Consensus_must_be_either_positiv);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Correct_data_location_or_positi);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Correct_the_position_coordinate);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Could_not_convert_input_argument);
  Py_CLEAR(clear_module_state->__pyx_n_s_Count);
  Py_CLEAR(clear_module_state->__pyx_n_u_Count);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Count_the_number_of_local_minim);
  Py_CLEAR(clear_module_state->__pyx_n_s_DataFrame);
  Py_CLEAR(clear_module_state->__pyx_kp_u_DataFrame_does_not_contain_any_n);
  Py_CLEAR(clear_module_state->__pyx_kp_u_DataFrame_must_have_at_least_thr);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Dataframe_is_given_The_c_order_a);
  Py_CLEAR(clear_module_state->__pyx_n_s_DecisionStumpRegressor);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Degree_is_integer_Got);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Dependent_variable_depvar_should);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Detect_station_position_and_ret);
  Py_CLEAR(clear_module_state->__pyx_n_s_Dict);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Either_predicted_class_labels_or);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Epsilon_must_be_a_numeric_value);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Epsilon_value_auto_is_acceptable);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Expect);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Expect_one_dimensional_array_for);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Expect_squareform_condense_or_d);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Expected_float_not);
  Py_CLEAR(clear_module_state->__pyx_n_s_F);
  Py_CLEAR(clear_module_state->__pyx_n_s_FN);
  Py_CLEAR(clear_module_state->__pyx_n_s_FP);
  Py_CLEAR(clear_module_state->__pyx_n_s_F_m);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Get_the_closest_value_in_array_f);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Got_x_ndim_d);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Gradient_descent_algorithm_to_f);
  Py_CLEAR(clear_module_state->__pyx_n_u_ID);
  Py_CLEAR(clear_module_state->__pyx_kp_u_If_mode_is_interp_window_length);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Implement_a_simple_version_of_G);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Infers_source_target_and_value);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Input_data_must_be_a_numpy_array);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Input_data_must_be_a_one_dimensi);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Input_values_contain_NaNs);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Invalid_correlation_method_Suppo);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Invalid_method);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Invalid_method_specified_Choose);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Invalid_nan_policy);
  Py_CLEAR(clear_module_state->__pyx_n_s_KeyBox);
  Py_CLEAR(clear_module_state->__pyx_n_s_LabelEncoder);
  Py_CLEAR(clear_module_state->__pyx_n_s_LinearRegression);
  Py_CLEAR(clear_module_state->__pyx_n_s_List);
  Py_CLEAR(clear_module_state->__pyx_kp_s_List_Dict_str_str);
  Py_CLEAR(clear_module_state->__pyx_kp_s_List_str);
  Py_CLEAR(clear_module_state->__pyx_n_s_Location);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Location_index_must_be_less_than);
  Py_CLEAR(clear_module_state->__pyx_n_s_LogisticRegression);
  Py_CLEAR(clear_module_state->__pyx_n_s_N);
  Py_CLEAR(clear_module_state->__pyx_n_s_NDArray);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Need_to_import_scipy_stats_as_a);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Non_numerical);
  Py_CLEAR(clear_module_state->__pyx_kp_u_None);
  Py_CLEAR(clear_module_state->__pyx_kp_u_NoneType_can_not_be_computed);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Number_of_columns_must_fit_the_s);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Numeric_array_is_expected_for_op);
  Py_CLEAR(clear_module_state->__pyx_n_s_Optional);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional_ArrayLike);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional_List_str);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional_Union_ArrayLike_List_Ar);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional_Union_int_str);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional_Union_str_list);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional__F);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Optional_str);
  Py_CLEAR(clear_module_state->__pyx_kp_u_P_value_calculations_expect_nume);
  Py_CLEAR(clear_module_state->__pyx_kp_u_P_values);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Polynomial_function_expects_degr);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Position_array_p);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Predicted_values_must_be_provide);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Profile_angle_is_0_2f_degrees_E);
  Py_CLEAR(clear_module_state->__pyx_n_s_ResultSummary);
  Py_CLEAR(clear_module_state->__pyx_n_s_RuntimeWarning);
  Py_CLEAR(clear_module_state->__pyx_n_s_S);
  Py_CLEAR(clear_module_state->__pyx_n_s_SP);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Scales_each_feature_to_a_given);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Scales_features_to_have_zero_me);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Scales_individual_samples_to_ha);
  Py_CLEAR(clear_module_state->__pyx_n_s_Series);
  Py_CLEAR(clear_module_state->__pyx_n_s_SiteError);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Source_and_Target_columns_must_n);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Station);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Step_is_not_given_Average_distan);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Step_m);
  Py_CLEAR(clear_module_state->__pyx_n_s_T);
  Py_CLEAR(clear_module_state->__pyx_n_s_TN);
  Py_CLEAR(clear_module_state->__pyx_n_s_TP);
  Py_CLEAR(clear_module_state->__pyx_kp_u_The_bins_parameter_is_set_to_aut);
  Py_CLEAR(clear_module_state->__pyx_kp_u_The_first_column_of_the_data_sho);
  Py_CLEAR(clear_module_state->__pyx_kp_u_The_length_of_predict_proba_does);
  Py_CLEAR(clear_module_state->__pyx_kp_u_The_task_type_must_be_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_Tuple);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Tuple_ArrayLike_np_ndarray);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Tuple_List_str_List_str_List_int);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Tuple_float_ArrayLike);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Tuple_float_float);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Tuple_int_float);
  Py_CLEAR(clear_module_state->__pyx_n_s_TypeError);
  Py_CLEAR(clear_module_state->__pyx_n_u_Un);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Unable_to_detect_the_station_pos);
  Py_CLEAR(clear_module_state->__pyx_n_s_Union);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_ArrayLike_List_ArrayLike);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_ArrayLike_Series);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_ArrayLike__SP_Series_DataF);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_int_float);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_int_str_list);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_np_ndarray_List_ArrayLike);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_str_ArrayLike);
  Py_CLEAR(clear_module_state->__pyx_kp_s_Union_str_int);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Unknown_method);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Use_base_or_binning);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Use_column_name_instead);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Use_the_index_instead);
  Py_CLEAR(clear_module_state->__pyx_n_s_ValueError);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Value_column_must_not_contain_nu);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Value_is_resetting_to_minimum_e);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Variant_average_methods_only_inc);
  Py_CLEAR(clear_module_state->__pyx_n_s_W);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Wrong_coordinates_values_Need_tw);
  Py_CLEAR(clear_module_state->__pyx_n_s_X);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_max);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_mean);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_min);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_norm);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_normalized);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_scaled);
  Py_CLEAR(clear_module_state->__pyx_n_s_X_std);
  Py_CLEAR(clear_module_state->__pyx_n_u_Xdata);
  Py_CLEAR(clear_module_state->__pyx_kp_u_Youden_s_index_calculation_requi);
  Py_CLEAR(clear_module_state->__pyx_n_s_Z);
  Py_CLEAR(clear_module_state->__pyx_kp_u__107);
  Py_CLEAR(clear_module_state->__pyx_n_s__177);
  Py_CLEAR(clear_module_state->__pyx_kp_u__2);
  Py_CLEAR(clear_module_state->__pyx_n_s__240);
  Py_CLEAR(clear_module_state->__pyx_kp_u__31);
  Py_CLEAR(clear_module_state->__pyx_kp_u__39);
  Py_CLEAR(clear_module_state->__pyx_kp_u__65);
  Py_CLEAR(clear_module_state->__pyx_n_s__70);
  Py_CLEAR(clear_module_state->__pyx_kp_u__70);
  Py_CLEAR(clear_module_state->__pyx_kp_u__88);
  Py_CLEAR(clear_module_state->__pyx_n_s_a);
  Py_CLEAR(clear_module_state->__pyx_n_s_abs);
  Py_CLEAR(clear_module_state->__pyx_n_s_accept_multioutput);
  Py_CLEAR(clear_module_state->__pyx_n_s_action);
  Py_CLEAR(clear_module_state->__pyx_n_s_actual);
  Py_CLEAR(clear_module_state->__pyx_n_s_adaptive_moving_average);
  Py_CLEAR(clear_module_state->__pyx_n_u_adaptive_moving_average);
  Py_CLEAR(clear_module_state->__pyx_kp_u_adaptive_moving_average_line_494);
  Py_CLEAR(clear_module_state->__pyx_n_s_add_results);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjust_for_control_vars);
  Py_CLEAR(clear_module_state->__pyx_n_u_adjust_for_control_vars);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjust_for_control_vars_classifi);
  Py_CLEAR(clear_module_state->__pyx_kp_u_adjust_for_control_vars_classifi_2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_adjust_for_control_vars_line_150);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjust_for_control_vars_regressi);
  Py_CLEAR(clear_module_state->__pyx_kp_u_adjust_for_control_vars_regressi_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjusted_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjusted_preds);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjusted_y_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_adjusted_y_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_all);
  Py_CLEAR(clear_module_state->__pyx_n_s_all_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_alpha);
  Py_CLEAR(clear_module_state->__pyx_kp_u_alpha_should_be_less_than_1_and);
  Py_CLEAR(clear_module_state->__pyx_n_s_ama);
  Py_CLEAR(clear_module_state->__pyx_n_s_ama_value);
  Py_CLEAR(clear_module_state->__pyx_n_u_amount);
  Py_CLEAR(clear_module_state->__pyx_n_s_any);
  Py_CLEAR(clear_module_state->__pyx_n_s_api_box);
  Py_CLEAR(clear_module_state->__pyx_n_s_api_docstring);
  Py_CLEAR(clear_module_state->__pyx_n_s_api_summary);
  Py_CLEAR(clear_module_state->__pyx_n_s_api_types);
  Py_CLEAR(clear_module_state->__pyx_n_s_append);
  Py_CLEAR(clear_module_state->__pyx_n_s_apply_log_scale);
  Py_CLEAR(clear_module_state->__pyx_n_s_ar);
  Py_CLEAR(clear_module_state->__pyx_n_s_arange);
  Py_CLEAR(clear_module_state->__pyx_n_s_arctan);
  Py_CLEAR(clear_module_state->__pyx_n_s_arctan2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_are_not_allowed);
  Py_CLEAR(clear_module_state->__pyx_n_s_argmax);
  Py_CLEAR(clear_module_state->__pyx_n_s_argmin);
  Py_CLEAR(clear_module_state->__pyx_n_s_argrelextrema);
  Py_CLEAR(clear_module_state->__pyx_n_s_args);
  Py_CLEAR(clear_module_state->__pyx_n_s_argsort);
  Py_CLEAR(clear_module_state->__pyx_n_s_argwhere);
  Py_CLEAR(clear_module_state->__pyx_n_s_around);
  Py_CLEAR(clear_module_state->__pyx_n_s_arr);
  Py_CLEAR(clear_module_state->__pyx_n_u_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_array_2);
  Py_CLEAR(clear_module_state->__pyx_n_u_array_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_arraytools);
  Py_CLEAR(clear_module_state->__pyx_n_s_as_frame);
  Py_CLEAR(clear_module_state->__pyx_n_s_asarray);
  Py_CLEAR(clear_module_state->__pyx_n_s_assert_all_types);
  Py_CLEAR(clear_module_state->__pyx_n_s_assert_ratio);
  Py_CLEAR(clear_module_state->__pyx_n_s_assert_x_y_positions);
  Py_CLEAR(clear_module_state->__pyx_n_s_assert_xy_in);
  Py_CLEAR(clear_module_state->__pyx_n_s_assign);
  Py_CLEAR(clear_module_state->__pyx_n_s_astype);
  Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
  Py_CLEAR(clear_module_state->__pyx_n_s_auc_score);
  Py_CLEAR(clear_module_state->__pyx_n_u_auto);
  Py_CLEAR(clear_module_state->__pyx_n_s_average);
  Py_CLEAR(clear_module_state->__pyx_n_u_average);
  Py_CLEAR(clear_module_state->__pyx_n_s_avg_sensitivity);
  Py_CLEAR(clear_module_state->__pyx_n_s_avg_specificity);
  Py_CLEAR(clear_module_state->__pyx_n_s_aweights);
  Py_CLEAR(clear_module_state->__pyx_n_s_ax);
  Py_CLEAR(clear_module_state->__pyx_n_s_axis);
  Py_CLEAR(clear_module_state->__pyx_n_s_axis_slice);
  Py_CLEAR(clear_module_state->__pyx_n_s_azim);
  Py_CLEAR(clear_module_state->__pyx_n_s_b);
  Py_CLEAR(clear_module_state->__pyx_kp_u_b_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_bal_acc_scores);
  Py_CLEAR(clear_module_state->__pyx_n_s_balanced_accuracy_ovo);
  Py_CLEAR(clear_module_state->__pyx_n_s_balanced_accuracy_ovr);
  Py_CLEAR(clear_module_state->__pyx_n_u_base);
  Py_CLEAR(clear_module_state->__pyx_n_s_base_epsilon);
  Py_CLEAR(clear_module_state->__pyx_n_s_best_threshold);
  Py_CLEAR(clear_module_state->__pyx_n_s_beta);
  Py_CLEAR(clear_module_state->__pyx_n_s_bias);
  Py_CLEAR(clear_module_state->__pyx_n_s_bin_contribution);
  Py_CLEAR(clear_module_state->__pyx_n_s_bin_edges);
  Py_CLEAR(clear_module_state->__pyx_n_s_bin_index);
  Py_CLEAR(clear_module_state->__pyx_n_s_bin_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_bin_width);
  Py_CLEAR(clear_module_state->__pyx_n_u_binary);
  Py_CLEAR(clear_module_state->__pyx_n_s_binary_y_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_binary_y_true);
  Py_CLEAR(clear_module_state->__pyx_n_u_binning);
  Py_CLEAR(clear_module_state->__pyx_n_s_bins);
  Py_CLEAR(clear_module_state->__pyx_n_s_bins_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_bins_method);
  Py_CLEAR(clear_module_state->__pyx_n_s_bool);
  Py_CLEAR(clear_module_state->__pyx_n_s_bounds);
  Py_CLEAR(clear_module_state->__pyx_n_s_buffer);
  Py_CLEAR(clear_module_state->__pyx_n_s_c);
  Py_CLEAR(clear_module_state->__pyx_n_s_c_order);
  Py_CLEAR(clear_module_state->__pyx_kp_u_c_order_2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_c_order_3);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_adjusted_lr);
  Py_CLEAR(clear_module_state->__pyx_n_u_calculate_adjusted_lr);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_adjusted_lr_line_809);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_binary_iv);
  Py_CLEAR(clear_module_state->__pyx_n_u_calculate_binary_iv);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_binary_iv_line_1993);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_histogram_bins);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_histogram_bins_line_12);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_multiclass_avg_lr);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_multiclass_avg_lr_line);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_multiclass_lr);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_multiclass_lr_line_662);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_optimal_bins);
  Py_CLEAR(clear_module_state->__pyx_n_u_calculate_optimal_bins);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_optimal_bins_line_1895);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_optimal_bins_locals_ge);
  Py_CLEAR(clear_module_state->__pyx_n_s_calculate_residuals);
  Py_CLEAR(clear_module_state->__pyx_n_u_calculate_residuals);
  Py_CLEAR(clear_module_state->__pyx_kp_u_calculate_residuals_line_2195);
  Py_CLEAR(clear_module_state->__pyx_n_u_call);
  Py_CLEAR(clear_module_state->__pyx_n_s_catch_warnings);
  Py_CLEAR(clear_module_state->__pyx_n_s_category);
  Py_CLEAR(clear_module_state->__pyx_n_s_ceil);
  Py_CLEAR(clear_module_state->__pyx_n_s_change);
  Py_CLEAR(clear_module_state->__pyx_n_s_check_classification_targets);
  Py_CLEAR(clear_module_state->__pyx_n_s_check_consistent_length);
  Py_CLEAR(clear_module_state->__pyx_n_s_check_epsilon);
  Py_CLEAR(clear_module_state->__pyx_n_s_check_y);
  Py_CLEAR(clear_module_state->__pyx_n_s_ck);
  Py_CLEAR(clear_module_state->__pyx_n_s_class_getitem);
  Py_CLEAR(clear_module_state->__pyx_n_s_classes);
  Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
  Py_CLEAR(clear_module_state->__pyx_n_s_close);
  Py_CLEAR(clear_module_state->__pyx_n_s_cls);
  Py_CLEAR(clear_module_state->__pyx_n_s_cls1);
  Py_CLEAR(clear_module_state->__pyx_n_s_cls2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_cluster_d);
  Py_CLEAR(clear_module_state->__pyx_n_s_cm);
  Py_CLEAR(clear_module_state->__pyx_n_u_cma);
  Py_CLEAR(clear_module_state->__pyx_n_s_coef);
  Py_CLEAR(clear_module_state->__pyx_n_s_coeffs);
  Py_CLEAR(clear_module_state->__pyx_n_s_col);
  Py_CLEAR(clear_module_state->__pyx_n_s_column);
  Py_CLEAR(clear_module_state->__pyx_n_s_column2ignore);
  Py_CLEAR(clear_module_state->__pyx_n_s_columns);
  Py_CLEAR(clear_module_state->__pyx_n_u_columns);
  Py_CLEAR(clear_module_state->__pyx_n_s_combinations);
  Py_CLEAR(clear_module_state->__pyx_n_u_complete);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_balance_accuracy);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_balance_accuracy);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_balance_accuracy_line_24);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_balanced_accuracy_binar);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_cost_based_threshold);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_cost_based_threshold);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_cost_based_threshold_lin);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_effort_yield);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_effort_yield);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_effort_yield_line_2440);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_errors);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_errors);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_errors_line_4287);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_ovo_sens_spec);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_ovo_sens_spec_line_1140);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_p_values);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_p_values);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_p_values_line_97);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_sensitivity_specificity);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_sensitivity_specificity_2);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_sensitivity_specificity_2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_sensitivity_specificity_3);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_sensitivity_specificity_4);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_spearmanr);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_spearmanr_locals__weigh);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_sunburst_data);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_sunburst_data);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_sunburst_data_line_2348);
  Py_CLEAR(clear_module_state->__pyx_n_s_compute_youdens_index);
  Py_CLEAR(clear_module_state->__pyx_n_u_compute_youdens_index);
  Py_CLEAR(clear_module_state->__pyx_kp_u_compute_youdens_index_line_466);
  Py_CLEAR(clear_module_state->__pyx_n_s_concat);
  Py_CLEAR(clear_module_state->__pyx_n_s_concat_array_from_list);
  Py_CLEAR(clear_module_state->__pyx_n_s_concat_axis);
  Py_CLEAR(clear_module_state->__pyx_n_s_concatenate);
  Py_CLEAR(clear_module_state->__pyx_n_u_condens);
  Py_CLEAR(clear_module_state->__pyx_n_u_condense);
  Py_CLEAR(clear_module_state->__pyx_n_s_confusion_matrix);
  Py_CLEAR(clear_module_state->__pyx_n_s_consensus);
  Py_CLEAR(clear_module_state->__pyx_n_u_consensus);
  Py_CLEAR(clear_module_state->__pyx_n_u_constant);
  Py_CLEAR(clear_module_state->__pyx_n_u_contains);
  Py_CLEAR(clear_module_state->__pyx_n_u_continuous);
  Py_CLEAR(clear_module_state->__pyx_n_s_control_vars);
  Py_CLEAR(clear_module_state->__pyx_n_u_conv);
  Py_CLEAR(clear_module_state->__pyx_n_s_convert_distance_to_m);
  Py_CLEAR(clear_module_state->__pyx_n_s_converter);
  Py_CLEAR(clear_module_state->__pyx_n_s_convolve);
  Py_CLEAR(clear_module_state->__pyx_n_s_convolve1d);
  Py_CLEAR(clear_module_state->__pyx_n_s_copy);
  Py_CLEAR(clear_module_state->__pyx_n_s_coreutils);
  Py_CLEAR(clear_module_state->__pyx_n_s_corr);
  Py_CLEAR(clear_module_state->__pyx_n_s_corr_func);
  Py_CLEAR(clear_module_state->__pyx_n_s_corr_methods);
  Py_CLEAR(clear_module_state->__pyx_n_s_corrcoef);
  Py_CLEAR(clear_module_state->__pyx_n_s_cos);
  Py_CLEAR(clear_module_state->__pyx_n_s_cost_history);
  Py_CLEAR(clear_module_state->__pyx_n_s_costs);
  Py_CLEAR(clear_module_state->__pyx_n_u_costs);
  Py_CLEAR(clear_module_state->__pyx_kp_u_could_not_convert_string_to_floa);
  Py_CLEAR(clear_module_state->__pyx_n_s_count);
  Py_CLEAR(clear_module_state->__pyx_n_u_count);
  Py_CLEAR(clear_module_state->__pyx_n_s_count_local_minima);
  Py_CLEAR(clear_module_state->__pyx_kp_u_count_local_minima_line_3171);
  Py_CLEAR(clear_module_state->__pyx_n_s_counts);
  Py_CLEAR(clear_module_state->__pyx_n_s_cov);
  Py_CLEAR(clear_module_state->__pyx_n_s_cubic_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_cubic_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_cum_weights);
  Py_CLEAR(clear_module_state->__pyx_n_s_cumsum);
  Py_CLEAR(clear_module_state->__pyx_n_u_cumulative);
  Py_CLEAR(clear_module_state->__pyx_kp_u_cumulative_average);
  Py_CLEAR(clear_module_state->__pyx_n_s_cumulative_data);
  Py_CLEAR(clear_module_state->__pyx_n_s_curve_fit);
  Py_CLEAR(clear_module_state->__pyx_kp_u_custom_logic);
  Py_CLEAR(clear_module_state->__pyx_n_s_cval);
  Py_CLEAR(clear_module_state->__pyx_n_s_d);
  Py_CLEAR(clear_module_state->__pyx_n_s_data);
  Py_CLEAR(clear_module_state->__pyx_n_u_data);
  Py_CLEAR(clear_module_state->__pyx_n_s_data_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_data_max);
  Py_CLEAR(clear_module_state->__pyx_n_s_data_min);
  Py_CLEAR(clear_module_state->__pyx_n_s_data_range);
  Py_CLEAR(clear_module_state->__pyx_kp_u_data_range_must_be_a_tuple_of_tw);
  Py_CLEAR(clear_module_state->__pyx_kp_u_data_range_must_contain_numeric);
  Py_CLEAR(clear_module_state->__pyx_kp_u_data_should_be_a_frame_not);
  Py_CLEAR(clear_module_state->__pyx_n_s_ddof);
  Py_CLEAR(clear_module_state->__pyx_n_s_decorators);
  Py_CLEAR(clear_module_state->__pyx_n_s_deep);
  Py_CLEAR(clear_module_state->__pyx_n_s_deepcopy);
  Py_CLEAR(clear_module_state->__pyx_n_s_default);
  Py_CLEAR(clear_module_state->__pyx_n_s_defaults);
  Py_CLEAR(clear_module_state->__pyx_n_s_deg);
  Py_CLEAR(clear_module_state->__pyx_n_s_deg2rad);
  Py_CLEAR(clear_module_state->__pyx_n_s_degree);
  Py_CLEAR(clear_module_state->__pyx_n_s_delete);
  Py_CLEAR(clear_module_state->__pyx_n_s_delta);
  Py_CLEAR(clear_module_state->__pyx_n_u_dense);
  Py_CLEAR(clear_module_state->__pyx_n_s_dense_rank);
  Py_CLEAR(clear_module_state->__pyx_n_s_depvar);
  Py_CLEAR(clear_module_state->__pyx_n_u_depvar);
  Py_CLEAR(clear_module_state->__pyx_n_s_deriv);
  Py_CLEAR(clear_module_state->__pyx_n_u_design);
  Py_CLEAR(clear_module_state->__pyx_n_s_detect_station_position);
  Py_CLEAR(clear_module_state->__pyx_kp_u_detect_station_position_line_374);
  Py_CLEAR(clear_module_state->__pyx_n_s_determine_epsilon);
  Py_CLEAR(clear_module_state->__pyx_n_s_df);
  Py_CLEAR(clear_module_state->__pyx_n_s_df_full);
  Py_CLEAR(clear_module_state->__pyx_n_s_df_level);
  Py_CLEAR(clear_module_state->__pyx_n_s_df_only);
  Py_CLEAR(clear_module_state->__pyx_n_s_diag);
  Py_CLEAR(clear_module_state->__pyx_n_s_diff);
  Py_CLEAR(clear_module_state->__pyx_n_s_digitize);
  Py_CLEAR(clear_module_state->__pyx_n_s_digitized);
  Py_CLEAR(clear_module_state->__pyx_n_s_dipole);
  Py_CLEAR(clear_module_state->__pyx_kp_u_disable);
  Py_CLEAR(clear_module_state->__pyx_n_s_distance);
  Py_CLEAR(clear_module_state->__pyx_n_u_distance);
  Py_CLEAR(clear_module_state->__pyx_n_s_dl);
  Py_CLEAR(clear_module_state->__pyx_n_s_doc);
  Py_CLEAR(clear_module_state->__pyx_n_s_dot);
  Py_CLEAR(clear_module_state->__pyx_n_u_dot);
  Py_CLEAR(clear_module_state->__pyx_n_s_dp);
  Py_CLEAR(clear_module_state->__pyx_n_s_drop);
  Py_CLEAR(clear_module_state->__pyx_n_s_drop_duplicates);
  Py_CLEAR(clear_module_state->__pyx_n_s_drop_intermediate);
  Py_CLEAR(clear_module_state->__pyx_n_s_dtype);
  Py_CLEAR(clear_module_state->__pyx_n_s_dx);
  Py_CLEAR(clear_module_state->__pyx_n_s_dy);
  Py_CLEAR(clear_module_state->__pyx_n_s_easting);
  Py_CLEAR(clear_module_state->__pyx_n_s_effort);
  Py_CLEAR(clear_module_state->__pyx_n_s_ellipsis2false);
  Py_CLEAR(clear_module_state->__pyx_n_u_ema);
  Py_CLEAR(clear_module_state->__pyx_n_s_empty);
  Py_CLEAR(clear_module_state->__pyx_n_s_empty_like);
  Py_CLEAR(clear_module_state->__pyx_kp_u_enable);
  Py_CLEAR(clear_module_state->__pyx_n_s_end);
  Py_CLEAR(clear_module_state->__pyx_n_s_ensure_2d);
  Py_CLEAR(clear_module_state->__pyx_n_s_ensure_non_negative);
  Py_CLEAR(clear_module_state->__pyx_n_s_ensure_y_is_valid);
  Py_CLEAR(clear_module_state->__pyx_n_s_enter);
  Py_CLEAR(clear_module_state->__pyx_n_s_enumerate);
  Py_CLEAR(clear_module_state->__pyx_n_s_epsilon);
  Py_CLEAR(clear_module_state->__pyx_n_s_err);
  Py_CLEAR(clear_module_state->__pyx_n_s_err_lower);
  Py_CLEAR(clear_module_state->__pyx_n_s_err_msg);
  Py_CLEAR(clear_module_state->__pyx_n_s_err_upper);
  Py_CLEAR(clear_module_state->__pyx_n_s_error);
  Py_CLEAR(clear_module_state->__pyx_n_u_error);
  Py_CLEAR(clear_module_state->__pyx_n_s_error_msg);
  Py_CLEAR(clear_module_state->__pyx_n_s_errstate);
  Py_CLEAR(clear_module_state->__pyx_n_s_estimator);
  Py_CLEAR(clear_module_state->__pyx_n_s_estimators);
  Py_CLEAR(clear_module_state->__pyx_n_u_euclidean);
  Py_CLEAR(clear_module_state->__pyx_n_s_exceptions);
  Py_CLEAR(clear_module_state->__pyx_n_s_exclude_string);
  Py_CLEAR(clear_module_state->__pyx_n_s_exclude_value);
  Py_CLEAR(clear_module_state->__pyx_n_s_exit);
  Py_CLEAR(clear_module_state->__pyx_n_s_exp);
  Py_CLEAR(clear_module_state->__pyx_n_s_expect_name);
  Py_CLEAR(clear_module_state->__pyx_n_u_exponential);
  Py_CLEAR(clear_module_state->__pyx_kp_u_exponential_moving_average);
  Py_CLEAR(clear_module_state->__pyx_n_s_exponential_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_exponential_regression);
  Py_CLEAR(clear_module_state->__pyx_kp_u_extra_azimuth);
  Py_CLEAR(clear_module_state->__pyx_n_s_extrapolate);
  Py_CLEAR(clear_module_state->__pyx_n_s_false_negatives);
  Py_CLEAR(clear_module_state->__pyx_n_s_false_positives);
  Py_CLEAR(clear_module_state->__pyx_n_s_fig);
  Py_CLEAR(clear_module_state->__pyx_n_s_figsize);
  Py_CLEAR(clear_module_state->__pyx_n_s_filtering_1d_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_filterwarnings);
  Py_CLEAR(clear_module_state->__pyx_n_s_find);
  Py_CLEAR(clear_module_state->__pyx_n_s_find_close_position);
  Py_CLEAR(clear_module_state->__pyx_n_s_find_closest);
  Py_CLEAR(clear_module_state->__pyx_kp_u_find_closest_line_4771);
  Py_CLEAR(clear_module_state->__pyx_n_s_fit);
  Py_CLEAR(clear_module_state->__pyx_kp_u_fit_a_5_3f_b_5_3f);
  Py_CLEAR(clear_module_state->__pyx_n_s_fit_edge);
  Py_CLEAR(clear_module_state->__pyx_n_s_fit_edges_polyfit);
  Py_CLEAR(clear_module_state->__pyx_n_s_fit_transform);
  Py_CLEAR(clear_module_state->__pyx_n_s_float);
  Py_CLEAR(clear_module_state->__pyx_n_u_float);
  Py_CLEAR(clear_module_state->__pyx_n_s_float32);
  Py_CLEAR(clear_module_state->__pyx_n_s_float64);
  Py_CLEAR(clear_module_state->__pyx_n_s_float_factorial);
  Py_CLEAR(clear_module_state->__pyx_n_s_format);
  Py_CLEAR(clear_module_state->__pyx_n_s_fpr);
  Py_CLEAR(clear_module_state->__pyx_n_u_freedman_diaconis);
  Py_CLEAR(clear_module_state->__pyx_n_s_from0);
  Py_CLEAR(clear_module_state->__pyx_n_s_func);
  Py_CLEAR(clear_module_state->__pyx_kp_u_func_argument_is_a_callable_not);
  Py_CLEAR(clear_module_state->__pyx_kp_u_gc);
  Py_CLEAR(clear_module_state->__pyx_n_s_genexpr);
  Py_CLEAR(clear_module_state->__pyx_n_s_get);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_azimuth);
  Py_CLEAR(clear_module_state->__pyx_kp_u_get_azimuth_line_3229);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_azimuth_locals_lambda);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_bearing);
  Py_CLEAR(clear_module_state->__pyx_n_u_get_bearing);
  Py_CLEAR(clear_module_state->__pyx_kp_u_get_bearing_line_4703);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_distance);
  Py_CLEAR(clear_module_state->__pyx_n_u_get_distance);
  Py_CLEAR(clear_module_state->__pyx_kp_u_get_distance_line_4518);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_gofast_logger);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_profile_angle);
  Py_CLEAR(clear_module_state->__pyx_n_s_get_station_number);
  Py_CLEAR(clear_module_state->__pyx_n_s_gofast_tools_mathex);
  Py_CLEAR(clear_module_state->__pyx_kp_s_gofast_tools_mathex_pyx);
  Py_CLEAR(clear_module_state->__pyx_n_s_gofastlog);
  Py_CLEAR(clear_module_state->__pyx_n_s_gofastlog_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_gradient_boosting_regressor);
  Py_CLEAR(clear_module_state->__pyx_kp_u_gradient_boosting_regressor_line);
  Py_CLEAR(clear_module_state->__pyx_n_s_gradient_descent);
  Py_CLEAR(clear_module_state->__pyx_kp_u_gradient_descent_line_4820);
  Py_CLEAR(clear_module_state->__pyx_n_s_group);
  Py_CLEAR(clear_module_state->__pyx_n_s_groupby);
  Py_CLEAR(clear_module_state->__pyx_n_s_halflen);
  Py_CLEAR(clear_module_state->__pyx_n_s_hierarchy);
  Py_CLEAR(clear_module_state->__pyx_n_s_histogram_bin_edges);
  Py_CLEAR(clear_module_state->__pyx_n_s_hstack);
  Py_CLEAR(clear_module_state->__pyx_n_s_i);
  Py_CLEAR(clear_module_state->__pyx_n_s_idx);
  Py_CLEAR(clear_module_state->__pyx_n_s_ignore);
  Py_CLEAR(clear_module_state->__pyx_n_u_ignore);
  Py_CLEAR(clear_module_state->__pyx_n_s_ignore_index);
  Py_CLEAR(clear_module_state->__pyx_n_s_ii);
  Py_CLEAR(clear_module_state->__pyx_n_s_iloc);
  Py_CLEAR(clear_module_state->__pyx_n_s_import);
  Py_CLEAR(clear_module_state->__pyx_n_s_in_bin);
  Py_CLEAR(clear_module_state->__pyx_n_s_in_percent);
  Py_CLEAR(clear_module_state->__pyx_n_s_include_label);
  Py_CLEAR(clear_module_state->__pyx_n_s_include_metrics);
  Py_CLEAR(clear_module_state->__pyx_n_s_include_nan);
  Py_CLEAR(clear_module_state->__pyx_n_s_index);
  Py_CLEAR(clear_module_state->__pyx_n_u_inf);
  Py_CLEAR(clear_module_state->__pyx_n_s_infer_sankey_columns);
  Py_CLEAR(clear_module_state->__pyx_n_u_infer_sankey_columns);
  Py_CLEAR(clear_module_state->__pyx_kp_u_infer_sankey_columns_line_2272);
  Py_CLEAR(clear_module_state->__pyx_n_s_init_weights);
  Py_CLEAR(clear_module_state->__pyx_n_s_initializing);
  Py_CLEAR(clear_module_state->__pyx_n_s_input_name);
  Py_CLEAR(clear_module_state->__pyx_n_s_inspect);
  Py_CLEAR(clear_module_state->__pyx_kp_u_instead_of);
  Py_CLEAR(clear_module_state->__pyx_n_s_int);
  Py_CLEAR(clear_module_state->__pyx_n_s_int32);
  Py_CLEAR(clear_module_state->__pyx_n_u_interp);
  Py_CLEAR(clear_module_state->__pyx_n_s_interp_start);
  Py_CLEAR(clear_module_state->__pyx_n_s_interp_stop);
  Py_CLEAR(clear_module_state->__pyx_n_s_inv);
  Py_CLEAR(clear_module_state->__pyx_n_s_inverse_transform);
  Py_CLEAR(clear_module_state->__pyx_n_s_involved_pairs);
  Py_CLEAR(clear_module_state->__pyx_n_s_iqr);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_arraylike_1d);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_binary_class);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_frame);
  Py_CLEAR(clear_module_state->__pyx_kp_u_is_gotten);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_iterable);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_latlon);
  Py_CLEAR(clear_module_state->__pyx_kp_u_is_not_admitted_Expect_at_least);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_numeric_dtype);
  Py_CLEAR(clear_module_state->__pyx_kp_u_is_out_of_the_range_max_positio);
  Py_CLEAR(clear_module_state->__pyx_n_s_is_utm);
  Py_CLEAR(clear_module_state->__pyx_n_s_isdeg);
  Py_CLEAR(clear_module_state->__pyx_n_s_isdigit);
  Py_CLEAR(clear_module_state->__pyx_kp_u_isenabled);
  Py_CLEAR(clear_module_state->__pyx_n_s_isfunction);
  Py_CLEAR(clear_module_state->__pyx_n_s_isin);
  Py_CLEAR(clear_module_state->__pyx_n_s_islatlon);
  Py_CLEAR(clear_module_state->__pyx_n_s_isnan);
  Py_CLEAR(clear_module_state->__pyx_n_s_isnull);
  Py_CLEAR(clear_module_state->__pyx_n_s_isreal);
  Py_CLEAR(clear_module_state->__pyx_n_s_isscalar);
  Py_CLEAR(clear_module_state->__pyx_n_s_issubdtype);
  Py_CLEAR(clear_module_state->__pyx_n_s_items);
  Py_CLEAR(clear_module_state->__pyx_n_s_iterrows);
  Py_CLEAR(clear_module_state->__pyx_n_s_itertools);
  Py_CLEAR(clear_module_state->__pyx_n_s_iv);
  Py_CLEAR(clear_module_state->__pyx_n_s_ix_c);
  Py_CLEAR(clear_module_state->__pyx_n_s_j);
  Py_CLEAR(clear_module_state->__pyx_n_s_k);
  Py_CLEAR(clear_module_state->__pyx_n_s_keepdims);
  Py_CLEAR(clear_module_state->__pyx_n_u_kendall);
  Py_CLEAR(clear_module_state->__pyx_n_s_kendalltau);
  Py_CLEAR(clear_module_state->__pyx_n_s_key);
  Py_CLEAR(clear_module_state->__pyx_n_s_kind);
  Py_CLEAR(clear_module_state->__pyx_n_s_kind_of_model);
  Py_CLEAR(clear_module_state->__pyx_n_s_kind_of_model_locals_init_weigh);
  Py_CLEAR(clear_module_state->__pyx_n_u_km);
  Py_CLEAR(clear_module_state->__pyx_n_s_kws);
  Py_CLEAR(clear_module_state->__pyx_n_s_label);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_binarize);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_i);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_importance);
  Py_CLEAR(clear_module_state->__pyx_n_u_label_importance);
  Py_CLEAR(clear_module_state->__pyx_kp_u_label_importance_line_2612);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_j);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_to_index);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_y);
  Py_CLEAR(clear_module_state->__pyx_n_s_label_yt_trailer);
  Py_CLEAR(clear_module_state->__pyx_n_s_labels);
  Py_CLEAR(clear_module_state->__pyx_n_s_lat1);
  Py_CLEAR(clear_module_state->__pyx_n_s_lat2);
  Py_CLEAR(clear_module_state->__pyx_n_s_latlon1);
  Py_CLEAR(clear_module_state->__pyx_n_s_latlon2);
  Py_CLEAR(clear_module_state->__pyx_n_s_le);
  Py_CLEAR(clear_module_state->__pyx_n_s_le_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_le_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_learning_rate);
  Py_CLEAR(clear_module_state->__pyx_n_s_legend);
  Py_CLEAR(clear_module_state->__pyx_n_s_less);
  Py_CLEAR(clear_module_state->__pyx_n_s_linalg);
  Py_CLEAR(clear_module_state->__pyx_n_u_linear);
  Py_CLEAR(clear_module_state->__pyx_n_s_linear_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_linear_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_linfunc);
  Py_CLEAR(clear_module_state->__pyx_n_s_linkage);
  Py_CLEAR(clear_module_state->__pyx_n_s_linkage_matrix);
  Py_CLEAR(clear_module_state->__pyx_n_u_linkage_matrix);
  Py_CLEAR(clear_module_state->__pyx_n_s_linregress);
  Py_CLEAR(clear_module_state->__pyx_n_s_linspace);
  Py_CLEAR(clear_module_state->__pyx_n_u_ll);
  Py_CLEAR(clear_module_state->__pyx_n_s_local_minima_count);
  Py_CLEAR(clear_module_state->__pyx_n_s_local_minima_indices);
  Py_CLEAR(clear_module_state->__pyx_n_s_log);
  Py_CLEAR(clear_module_state->__pyx_n_s_log10);
  Py_CLEAR(clear_module_state->__pyx_n_s_log2);
  Py_CLEAR(clear_module_state->__pyx_n_s_logarithmic_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_logarithmic_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_logger);
  Py_CLEAR(clear_module_state->__pyx_n_s_logify);
  Py_CLEAR(clear_module_state->__pyx_n_s_lon1);
  Py_CLEAR(clear_module_state->__pyx_n_s_lon2);
  Py_CLEAR(clear_module_state->__pyx_n_s_lower);
  Py_CLEAR(clear_module_state->__pyx_n_s_lr);
  Py_CLEAR(clear_module_state->__pyx_n_s_lstsq);
  Py_CLEAR(clear_module_state->__pyx_n_s_m);
  Py_CLEAR(clear_module_state->__pyx_n_u_m);
  Py_CLEAR(clear_module_state->__pyx_n_u_macro);
  Py_CLEAR(clear_module_state->__pyx_n_s_main);
  Py_CLEAR(clear_module_state->__pyx_n_s_make_mxs);
  Py_CLEAR(clear_module_state->__pyx_n_u_make_mxs);
  Py_CLEAR(clear_module_state->__pyx_kp_u_make_mxs_line_2514);
  Py_CLEAR(clear_module_state->__pyx_n_s_manage_colors);
  Py_CLEAR(clear_module_state->__pyx_n_s_map);
  Py_CLEAR(clear_module_state->__pyx_n_s_marker);
  Py_CLEAR(clear_module_state->__pyx_n_s_match_method);
  Py_CLEAR(clear_module_state->__pyx_n_s_matplotlib);
  Py_CLEAR(clear_module_state->__pyx_n_s_matplotlib_pyplot);
  Py_CLEAR(clear_module_state->__pyx_n_s_max);
  Py_CLEAR(clear_module_state->__pyx_n_u_max);
  Py_CLEAR(clear_module_state->__pyx_n_s_max_depth);
  Py_CLEAR(clear_module_state->__pyx_n_s_max_lr);
  Py_CLEAR(clear_module_state->__pyx_n_s_maximum);
  Py_CLEAR(clear_module_state->__pyx_n_s_mean);
  Py_CLEAR(clear_module_state->__pyx_n_s_mean_rank_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_mean_rank_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_method);
  Py_CLEAR(clear_module_state->__pyx_n_u_method);
  Py_CLEAR(clear_module_state->__pyx_n_s_metric);
  Py_CLEAR(clear_module_state->__pyx_n_u_micro);
  Py_CLEAR(clear_module_state->__pyx_n_s_micro_sensitivity);
  Py_CLEAR(clear_module_state->__pyx_n_s_micro_specificity);
  Py_CLEAR(clear_module_state->__pyx_n_s_min);
  Py_CLEAR(clear_module_state->__pyx_n_u_min);
  Py_CLEAR(clear_module_state->__pyx_n_s_min_cost);
  Py_CLEAR(clear_module_state->__pyx_n_s_min_non_zero_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_minimum);
  Py_CLEAR(clear_module_state->__pyx_n_s_minmax_scaler);
  Py_CLEAR(clear_module_state->__pyx_n_u_minmax_scaler);
  Py_CLEAR(clear_module_state->__pyx_kp_u_minmax_scaler_line_2947);
  Py_CLEAR(clear_module_state->__pyx_n_u_mirror);
  Py_CLEAR(clear_module_state->__pyx_n_s_mode);
  Py_CLEAR(clear_module_state->__pyx_kp_u_mode_must_be_mirror_constant_nea);
  Py_CLEAR(clear_module_state->__pyx_n_s_model_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_model_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_moving_average);
  Py_CLEAR(clear_module_state->__pyx_kp_u_moving_average_line_3046);
  Py_CLEAR(clear_module_state->__pyx_n_s_msg);
  Py_CLEAR(clear_module_state->__pyx_n_s_msg_meth);
  Py_CLEAR(clear_module_state->__pyx_n_s_mu0);
  Py_CLEAR(clear_module_state->__pyx_n_s_multi_output);
  Py_CLEAR(clear_module_state->__pyx_n_u_multiclass);
  Py_CLEAR(clear_module_state->__pyx_n_s_multioutput);
  Py_CLEAR(clear_module_state->__pyx_n_s_n);
  Py_CLEAR(clear_module_state->__pyx_n_s_n_epochs);
  Py_CLEAR(clear_module_state->__pyx_n_s_n_estimators);
  Py_CLEAR(clear_module_state->__pyx_n_s_name);
  Py_CLEAR(clear_module_state->__pyx_n_s_name_2);
  Py_CLEAR(clear_module_state->__pyx_n_u_name_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_nan);
  Py_CLEAR(clear_module_state->__pyx_n_s_nan_policy);
  Py_CLEAR(clear_module_state->__pyx_n_s_nan_sum);
  Py_CLEAR(clear_module_state->__pyx_n_s_nansum);
  Py_CLEAR(clear_module_state->__pyx_n_s_ndarray);
  Py_CLEAR(clear_module_state->__pyx_n_s_ndim);
  Py_CLEAR(clear_module_state->__pyx_n_u_nearest);
  Py_CLEAR(clear_module_state->__pyx_n_u_negative);
  Py_CLEAR(clear_module_state->__pyx_n_s_newaxis);
  Py_CLEAR(clear_module_state->__pyx_kp_u_no_of_items_in_clust);
  Py_CLEAR(clear_module_state->__pyx_n_s_noise);
  Py_CLEAR(clear_module_state->__pyx_n_u_none);
  Py_CLEAR(clear_module_state->__pyx_n_s_nonzero);
  Py_CLEAR(clear_module_state->__pyx_n_s_norm);
  Py_CLEAR(clear_module_state->__pyx_n_s_normalize);
  Py_CLEAR(clear_module_state->__pyx_n_u_normalize);
  Py_CLEAR(clear_module_state->__pyx_kp_u_normalize_line_2997);
  Py_CLEAR(clear_module_state->__pyx_n_s_normalize_string);
  Py_CLEAR(clear_module_state->__pyx_n_s_northing);
  Py_CLEAR(clear_module_state->__pyx_kp_u_not_found_in);
  Py_CLEAR(clear_module_state->__pyx_kp_u_not_found_in_DataFrame_columns);
  Py_CLEAR(clear_module_state->__pyx_n_s_np);
  Py_CLEAR(clear_module_state->__pyx_n_s_number);
  Py_CLEAR(clear_module_state->__pyx_n_s_numeric_cols);
  Py_CLEAR(clear_module_state->__pyx_n_s_numpy);
  Py_CLEAR(clear_module_state->__pyx_n_u_o);
  Py_CLEAR(clear_module_state->__pyx_kp_u_ob);
  Py_CLEAR(clear_module_state->__pyx_n_s_objname);
  Py_CLEAR(clear_module_state->__pyx_kp_u_ok);
  Py_CLEAR(clear_module_state->__pyx_n_u_ok_2);
  Py_CLEAR(clear_module_state->__pyx_n_u_omit);
  Py_CLEAR(clear_module_state->__pyx_n_s_ones);
  Py_CLEAR(clear_module_state->__pyx_n_s_ones_like);
  Py_CLEAR(clear_module_state->__pyx_n_s_optimal_bins);
  Py_CLEAR(clear_module_state->__pyx_n_s_optimal_idx);
  Py_CLEAR(clear_module_state->__pyx_n_s_optimal_ordering);
  Py_CLEAR(clear_module_state->__pyx_n_s_optimal_threshold);
  Py_CLEAR(clear_module_state->__pyx_n_s_optimal_youden);
  Py_CLEAR(clear_module_state->__pyx_n_s_optimized_spearmanr);
  Py_CLEAR(clear_module_state->__pyx_n_u_optimized_spearmanr);
  Py_CLEAR(clear_module_state->__pyx_kp_u_optimized_spearmanr_line_1351);
  Py_CLEAR(clear_module_state->__pyx_n_u_or);
  Py_CLEAR(clear_module_state->__pyx_kp_u_or_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_order);
  Py_CLEAR(clear_module_state->__pyx_n_u_ordinal);
  Py_CLEAR(clear_module_state->__pyx_n_u_ovo);
  Py_CLEAR(clear_module_state->__pyx_n_u_ovr);
  Py_CLEAR(clear_module_state->__pyx_n_s_p);
  Py_CLEAR(clear_module_state->__pyx_n_s_p_value);
  Py_CLEAR(clear_module_state->__pyx_n_s_p_values);
  Py_CLEAR(clear_module_state->__pyx_n_s_pair);
  Py_CLEAR(clear_module_state->__pyx_n_s_pair_indices);
  Py_CLEAR(clear_module_state->__pyx_n_s_pairwise_distances);
  Py_CLEAR(clear_module_state->__pyx_n_s_pandas);
  Py_CLEAR(clear_module_state->__pyx_n_s_param_name);
  Py_CLEAR(clear_module_state->__pyx_n_s_parameter_validator);
  Py_CLEAR(clear_module_state->__pyx_n_u_parent);
  Py_CLEAR(clear_module_state->__pyx_n_u_passthrough);
  Py_CLEAR(clear_module_state->__pyx_n_s_pcov);
  Py_CLEAR(clear_module_state->__pyx_n_s_pd);
  Py_CLEAR(clear_module_state->__pyx_n_s_pdist);
  Py_CLEAR(clear_module_state->__pyx_n_u_pearson);
  Py_CLEAR(clear_module_state->__pyx_n_s_pearsonr);
  Py_CLEAR(clear_module_state->__pyx_n_s_percent_events);
  Py_CLEAR(clear_module_state->__pyx_n_s_percent_events_bin);
  Py_CLEAR(clear_module_state->__pyx_n_s_percent_non_events);
  Py_CLEAR(clear_module_state->__pyx_n_s_percent_non_events_bin);
  Py_CLEAR(clear_module_state->__pyx_n_s_percentile);
  Py_CLEAR(clear_module_state->__pyx_n_s_pi);
  Py_CLEAR(clear_module_state->__pyx_n_u_pk);
  Py_CLEAR(clear_module_state->__pyx_n_s_plot);
  Py_CLEAR(clear_module_state->__pyx_n_s_plt);
  Py_CLEAR(clear_module_state->__pyx_n_u_poly);
  Py_CLEAR(clear_module_state->__pyx_n_s_poly_coeffs);
  Py_CLEAR(clear_module_state->__pyx_n_s_polyder);
  Py_CLEAR(clear_module_state->__pyx_n_s_polyfit);
  Py_CLEAR(clear_module_state->__pyx_n_s_polyorder);
  Py_CLEAR(clear_module_state->__pyx_kp_u_polyorder_must_be_less_than_wind);
  Py_CLEAR(clear_module_state->__pyx_n_s_polyval);
  Py_CLEAR(clear_module_state->__pyx_n_s_pop_cat_features);
  Py_CLEAR(clear_module_state->__pyx_n_s_popt);
  Py_CLEAR(clear_module_state->__pyx_n_s_pos);
  Py_CLEAR(clear_module_state->__pyx_n_s_pos_label);
  Py_CLEAR(clear_module_state->__pyx_kp_u_pos_must_be_nonnegative_and_less);
  Py_CLEAR(clear_module_state->__pyx_kp_u_positions);
  Py_CLEAR(clear_module_state->__pyx_n_u_positive);
  Py_CLEAR(clear_module_state->__pyx_n_s_positive_preds);
  Py_CLEAR(clear_module_state->__pyx_n_s_power);
  Py_CLEAR(clear_module_state->__pyx_n_s_predict);
  Py_CLEAR(clear_module_state->__pyx_n_s_predict_proba);
  Py_CLEAR(clear_module_state->__pyx_n_s_predicted);
  Py_CLEAR(clear_module_state->__pyx_n_s_predicted_labels);
  Py_CLEAR(clear_module_state->__pyx_n_s_prev_val);
  Py_CLEAR(clear_module_state->__pyx_n_s_print);
  Py_CLEAR(clear_module_state->__pyx_n_s_prob_true_class);
  Py_CLEAR(clear_module_state->__pyx_n_s_profile1);
  Py_CLEAR(clear_module_state->__pyx_n_s_profile2);
  Py_CLEAR(clear_module_state->__pyx_n_s_profile_angle);
  Py_CLEAR(clear_module_state->__pyx_n_s_profile_line);
  Py_CLEAR(clear_module_state->__pyx_n_s_projection);
  Py_CLEAR(clear_module_state->__pyx_n_u_propagate);
  Py_CLEAR(clear_module_state->__pyx_n_s_pyplot);
  Py_CLEAR(clear_module_state->__pyx_n_s_quadratic_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_quadratic_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_quality_control2);
  Py_CLEAR(clear_module_state->__pyx_kp_u_quality_control2_line_4409);
  Py_CLEAR(clear_module_state->__pyx_kp_u_r);
  Py_CLEAR(clear_module_state->__pyx_n_s_rad2deg);
  Py_CLEAR(clear_module_state->__pyx_n_u_raise);
  Py_CLEAR(clear_module_state->__pyx_n_s_raise_exception);
  Py_CLEAR(clear_module_state->__pyx_n_s_raise_warn);
  Py_CLEAR(clear_module_state->__pyx_n_u_raises);
  Py_CLEAR(clear_module_state->__pyx_n_s_randn);
  Py_CLEAR(clear_module_state->__pyx_n_s_random);
  Py_CLEAR(clear_module_state->__pyx_n_s_range);
  Py_CLEAR(clear_module_state->__pyx_n_s_rank_data);
  Py_CLEAR(clear_module_state->__pyx_n_u_rank_data);
  Py_CLEAR(clear_module_state->__pyx_kp_u_rank_data_line_1263);
  Py_CLEAR(clear_module_state->__pyx_n_s_rankdata);
  Py_CLEAR(clear_module_state->__pyx_n_s_ranks);
  Py_CLEAR(clear_module_state->__pyx_n_s_ranks_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_ranks_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_rate);
  Py_CLEAR(clear_module_state->__pyx_n_s_ravel);
  Py_CLEAR(clear_module_state->__pyx_kp_u_raw_azimuth);
  Py_CLEAR(clear_module_state->__pyx_n_u_raw_values);
  Py_CLEAR(clear_module_state->__pyx_n_s_refglossary);
  Py_CLEAR(clear_module_state->__pyx_n_u_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_reject);
  Py_CLEAR(clear_module_state->__pyx_n_s_relevant_mask);
  Py_CLEAR(clear_module_state->__pyx_n_s_rem);
  Py_CLEAR(clear_module_state->__pyx_n_s_replace);
  Py_CLEAR(clear_module_state->__pyx_n_s_reset_index);
  Py_CLEAR(clear_module_state->__pyx_n_s_reshape);
  Py_CLEAR(clear_module_state->__pyx_n_s_residual);
  Py_CLEAR(clear_module_state->__pyx_n_s_residuals);
  Py_CLEAR(clear_module_state->__pyx_n_s_residuals_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_residuals_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_result);
  Py_CLEAR(clear_module_state->__pyx_n_s_results);
  Py_CLEAR(clear_module_state->__pyx_n_s_return);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_confidence);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_counts);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_data);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_mean_dist);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_qco);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_target_only);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_weighted_rank);
  Py_CLEAR(clear_module_state->__pyx_n_s_return_ymxs);
  Py_CLEAR(clear_module_state->__pyx_n_s_reverse);
  Py_CLEAR(clear_module_state->__pyx_n_s_rho);
  Py_CLEAR(clear_module_state->__pyx_n_s_rng);
  Py_CLEAR(clear_module_state->__pyx_n_u_robust);
  Py_CLEAR(clear_module_state->__pyx_n_s_roc_auc_score);
  Py_CLEAR(clear_module_state->__pyx_n_s_roc_curve);
  Py_CLEAR(clear_module_state->__pyx_n_s_row);
  Py_CLEAR(clear_module_state->__pyx_n_s_row_clusters);
  Py_CLEAR(clear_module_state->__pyx_n_s_row_dist);
  Py_CLEAR(clear_module_state->__pyx_kp_u_row_label_1);
  Py_CLEAR(clear_module_state->__pyx_kp_u_row_lable_2);
  Py_CLEAR(clear_module_state->__pyx_n_s_rr);
  Py_CLEAR(clear_module_state->__pyx_n_s_s);
  Py_CLEAR(clear_module_state->__pyx_n_u_s);
  Py_CLEAR(clear_module_state->__pyx_n_s_s_index);
  Py_CLEAR(clear_module_state->__pyx_n_u_same);
  Py_CLEAR(clear_module_state->__pyx_n_s_sample_weight);
  Py_CLEAR(clear_module_state->__pyx_n_s_savgol_coeffs);
  Py_CLEAR(clear_module_state->__pyx_kp_u_savgol_coeffs_line_3949);
  Py_CLEAR(clear_module_state->__pyx_n_s_savgol_filter);
  Py_CLEAR(clear_module_state->__pyx_n_u_savgol_filter);
  Py_CLEAR(clear_module_state->__pyx_kp_u_savgol_filter_line_4159);
  Py_CLEAR(clear_module_state->__pyx_n_s_scalePosition);
  Py_CLEAR(clear_module_state->__pyx_kp_u_scalePosition_line_3596);
  Py_CLEAR(clear_module_state->__pyx_n_s_scalePosition_locals_lambda);
  Py_CLEAR(clear_module_state->__pyx_n_s_scalePosition_locals_linfunc);
  Py_CLEAR(clear_module_state->__pyx_n_s_scale_factor);
  Py_CLEAR(clear_module_state->__pyx_n_s_scale_positions);
  Py_CLEAR(clear_module_state->__pyx_kp_u_scale_positions_line_4567);
  Py_CLEAR(clear_module_state->__pyx_n_u_scaled);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy__lib__util);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_cluster_hierarchy);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_linalg);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_ndimage);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_optimize);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_signal);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_spatial_distance);
  Py_CLEAR(clear_module_state->__pyx_n_s_scipy_stats);
  Py_CLEAR(clear_module_state->__pyx_n_s_score);
  Py_CLEAR(clear_module_state->__pyx_n_s_scores);
  Py_CLEAR(clear_module_state->__pyx_n_u_se);
  Py_CLEAR(clear_module_state->__pyx_n_s_seen);
  Py_CLEAR(clear_module_state->__pyx_n_s_select_dtypes);
  Py_CLEAR(clear_module_state->__pyx_n_s_send);
  Py_CLEAR(clear_module_state->__pyx_n_s_sens_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_sensitivities);
  Py_CLEAR(clear_module_state->__pyx_n_s_sensitivity);
  Py_CLEAR(clear_module_state->__pyx_n_s_set_xlabel);
  Py_CLEAR(clear_module_state->__pyx_n_s_set_ylabel);
  Py_CLEAR(clear_module_state->__pyx_n_s_shape);
  Py_CLEAR(clear_module_state->__pyx_n_s_shift);
  Py_CLEAR(clear_module_state->__pyx_n_u_shifted);
  Py_CLEAR(clear_module_state->__pyx_kp_u_should_be_less_than_the_number);
  Py_CLEAR(clear_module_state->__pyx_n_s_show);
  Py_CLEAR(clear_module_state->__pyx_n_s_shp);
  Py_CLEAR(clear_module_state->__pyx_n_s_significance_threshold);
  Py_CLEAR(clear_module_state->__pyx_n_s_similarities);
  Py_CLEAR(clear_module_state->__pyx_n_s_similarity);
  Py_CLEAR(clear_module_state->__pyx_n_u_simple);
  Py_CLEAR(clear_module_state->__pyx_kp_u_simple_moving_average);
  Py_CLEAR(clear_module_state->__pyx_n_s_simplefilter);
  Py_CLEAR(clear_module_state->__pyx_n_s_sin);
  Py_CLEAR(clear_module_state->__pyx_n_s_sinusoidal_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_sinusoidal_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_site);
  Py_CLEAR(clear_module_state->__pyx_n_s_size);
  Py_CLEAR(clear_module_state->__pyx_n_s_sklearn_linear_model);
  Py_CLEAR(clear_module_state->__pyx_n_s_sklearn_metrics);
  Py_CLEAR(clear_module_state->__pyx_n_s_sklearn_preprocessing);
  Py_CLEAR(clear_module_state->__pyx_n_s_sklearn_utils_multiclass);
  Py_CLEAR(clear_module_state->__pyx_n_u_sma);
  Py_CLEAR(clear_module_state->__pyx_n_s_smart_format);
  Py_CLEAR(clear_module_state->__pyx_n_u_soft);
  Py_CLEAR(clear_module_state->__pyx_n_s_sorted_data);
  Py_CLEAR(clear_module_state->__pyx_n_s_sorted_indices);
  Py_CLEAR(clear_module_state->__pyx_n_s_sorter);
  Py_CLEAR(clear_module_state->__pyx_n_u_source);
  Py_CLEAR(clear_module_state->__pyx_n_s_source_col);
  Py_CLEAR(clear_module_state->__pyx_n_s_sources);
  Py_CLEAR(clear_module_state->__pyx_n_u_spearman);
  Py_CLEAR(clear_module_state->__pyx_n_s_spearman_corr);
  Py_CLEAR(clear_module_state->__pyx_n_s_spearmanr);
  Py_CLEAR(clear_module_state->__pyx_n_s_spec);
  Py_CLEAR(clear_module_state->__pyx_n_s_spec_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_specific_y_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_specific_y_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_specificities);
  Py_CLEAR(clear_module_state->__pyx_n_s_specificity);
  Py_CLEAR(clear_module_state->__pyx_n_s_spstats);
  Py_CLEAR(clear_module_state->__pyx_n_s_sqrt);
  Py_CLEAR(clear_module_state->__pyx_n_u_sqrt);
  Py_CLEAR(clear_module_state->__pyx_n_s_squareform);
  Py_CLEAR(clear_module_state->__pyx_n_u_squareform);
  Py_CLEAR(clear_module_state->__pyx_n_s_squeeze);
  Py_CLEAR(clear_module_state->__pyx_n_s_standard_scaler);
  Py_CLEAR(clear_module_state->__pyx_n_u_standard_scaler);
  Py_CLEAR(clear_module_state->__pyx_kp_u_standard_scaler_line_2896);
  Py_CLEAR(clear_module_state->__pyx_n_s_star_mxs);
  Py_CLEAR(clear_module_state->__pyx_n_s_start);
  Py_CLEAR(clear_module_state->__pyx_n_s_state);
  Py_CLEAR(clear_module_state->__pyx_n_s_stats);
  Py_CLEAR(clear_module_state->__pyx_n_s_std);
  Py_CLEAR(clear_module_state->__pyx_n_u_std);
  Py_CLEAR(clear_module_state->__pyx_n_s_std_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_std_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_step);
  Py_CLEAR(clear_module_state->__pyx_n_s_step_function);
  Py_CLEAR(clear_module_state->__pyx_n_s_step_regression);
  Py_CLEAR(clear_module_state->__pyx_n_u_step_regression);
  Py_CLEAR(clear_module_state->__pyx_n_s_step_regression_locals_lambda);
  Py_CLEAR(clear_module_state->__pyx_n_s_stop);
  Py_CLEAR(clear_module_state->__pyx_n_s_str);
  Py_CLEAR(clear_module_state->__pyx_n_s_strategy);
  Py_CLEAR(clear_module_state->__pyx_n_u_strategy);
  Py_CLEAR(clear_module_state->__pyx_n_u_strict);
  Py_CLEAR(clear_module_state->__pyx_n_s_strip);
  Py_CLEAR(clear_module_state->__pyx_n_s_stump);
  Py_CLEAR(clear_module_state->__pyx_n_u_sturges);
  Py_CLEAR(clear_module_state->__pyx_n_s_subplots);
  Py_CLEAR(clear_module_state->__pyx_n_s_subset);
  Py_CLEAR(clear_module_state->__pyx_n_s_subtract);
  Py_CLEAR(clear_module_state->__pyx_n_s_sum);
  Py_CLEAR(clear_module_state->__pyx_n_s_sunburst_data);
  Py_CLEAR(clear_module_state->__pyx_n_s_support);
  Py_CLEAR(clear_module_state->__pyx_n_s_swapaxes);
  Py_CLEAR(clear_module_state->__pyx_n_s_swapped);
  Py_CLEAR(clear_module_state->__pyx_n_u_ta);
  Py_CLEAR(clear_module_state->__pyx_n_u_target);
  Py_CLEAR(clear_module_state->__pyx_n_s_target_col);
  Py_CLEAR(clear_module_state->__pyx_n_s_target_strs);
  Py_CLEAR(clear_module_state->__pyx_n_s_targets);
  Py_CLEAR(clear_module_state->__pyx_n_s_task_type);
  Py_CLEAR(clear_module_state->__pyx_n_s_test);
  Py_CLEAR(clear_module_state->__pyx_n_s_threshold);
  Py_CLEAR(clear_module_state->__pyx_n_s_thresholds);
  Py_CLEAR(clear_module_state->__pyx_n_s_throw);
  Py_CLEAR(clear_module_state->__pyx_n_s_tie_method);
  Py_CLEAR(clear_module_state->__pyx_n_s_title);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_array);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_deg);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_frame);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_latlon_in);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_log10);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_numeric_dtypes);
  Py_CLEAR(clear_module_state->__pyx_n_s_to_utm_in);
  Py_CLEAR(clear_module_state->__pyx_n_s_tol);
  Py_CLEAR(clear_module_state->__pyx_n_u_tolerance);
  Py_CLEAR(clear_module_state->__pyx_n_s_tolist);
  Py_CLEAR(clear_module_state->__pyx_n_s_torres_verdin_filter);
  Py_CLEAR(clear_module_state->__pyx_kp_u_torres_verdin_filter_line_4997);
  Py_CLEAR(clear_module_state->__pyx_n_s_torres_verdin_filter_locals__fil);
  Py_CLEAR(clear_module_state->__pyx_n_s_total);
  Py_CLEAR(clear_module_state->__pyx_n_s_total_FN);
  Py_CLEAR(clear_module_state->__pyx_n_s_total_FP);
  Py_CLEAR(clear_module_state->__pyx_n_s_total_TN);
  Py_CLEAR(clear_module_state->__pyx_n_s_total_TP);
  Py_CLEAR(clear_module_state->__pyx_n_s_total_cost);
  Py_CLEAR(clear_module_state->__pyx_n_s_total_weight);
  Py_CLEAR(clear_module_state->__pyx_n_s_tpr);
  Py_CLEAR(clear_module_state->__pyx_n_s_trailer);
  Py_CLEAR(clear_module_state->__pyx_kp_u_trailer_must_be_a_non_numeric_st);
  Py_CLEAR(clear_module_state->__pyx_n_s_transform);
  Py_CLEAR(clear_module_state->__pyx_n_s_true_negatives);
  Py_CLEAR(clear_module_state->__pyx_n_s_true_positives);
  Py_CLEAR(clear_module_state->__pyx_n_s_type_of_target);
  Py_CLEAR(clear_module_state->__pyx_n_u_uniform_average);
  Py_CLEAR(clear_module_state->__pyx_n_s_unique);
  Py_CLEAR(clear_module_state->__pyx_n_s_unique_labels);
  Py_CLEAR(clear_module_state->__pyx_n_s_unit);
  Py_CLEAR(clear_module_state->__pyx_n_s_use);
  Py_CLEAR(clear_module_state->__pyx_n_s_use_average_dist);
  Py_CLEAR(clear_module_state->__pyx_kp_u_use_lower_bound);
  Py_CLEAR(clear_module_state->__pyx_kp_u_use_must_be_conv_or_dot);
  Py_CLEAR(clear_module_state->__pyx_n_u_utm);
  Py_CLEAR(clear_module_state->__pyx_n_s_utm_zone);
  Py_CLEAR(clear_module_state->__pyx_kp_u_utm_zone_cannot_be_None_when_pro);
  Py_CLEAR(clear_module_state->__pyx_n_s_v);
  Py_CLEAR(clear_module_state->__pyx_n_s_valid_mask);
  Py_CLEAR(clear_module_state->__pyx_n_s_valid_methods);
  Py_CLEAR(clear_module_state->__pyx_n_s_valid_policies);
  Py_CLEAR(clear_module_state->__pyx_n_s_validate_length_range);
  Py_CLEAR(clear_module_state->__pyx_n_s_validate_multiclass_target);
  Py_CLEAR(clear_module_state->__pyx_n_s_validate_multioutput);
  Py_CLEAR(clear_module_state->__pyx_n_s_validate_name_in);
  Py_CLEAR(clear_module_state->__pyx_n_s_validate_sample_weights);
  Py_CLEAR(clear_module_state->__pyx_n_s_validate_scores);
  Py_CLEAR(clear_module_state->__pyx_n_s_validator);
  Py_CLEAR(clear_module_state->__pyx_n_s_value);
  Py_CLEAR(clear_module_state->__pyx_n_u_value);
  Py_CLEAR(clear_module_state->__pyx_n_s_value_col);
  Py_CLEAR(clear_module_state->__pyx_n_s_value_column);
  Py_CLEAR(clear_module_state->__pyx_n_s_values);
  Py_CLEAR(clear_module_state->__pyx_n_u_values);
  Py_CLEAR(clear_module_state->__pyx_n_s_var);
  Py_CLEAR(clear_module_state->__pyx_n_s_var_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_var_true);
  Py_CLEAR(clear_module_state->__pyx_n_s_vectorize);
  Py_CLEAR(clear_module_state->__pyx_n_s_view);
  Py_CLEAR(clear_module_state->__pyx_n_s_vstack);
  Py_CLEAR(clear_module_state->__pyx_n_s_w);
  Py_CLEAR(clear_module_state->__pyx_n_s_warn);
  Py_CLEAR(clear_module_state->__pyx_n_s_warnings);
  Py_CLEAR(clear_module_state->__pyx_n_u_weight);
  Py_CLEAR(clear_module_state->__pyx_n_s_weight_factor);
  Py_CLEAR(clear_module_state->__pyx_n_u_weighted);
  Py_CLEAR(clear_module_state->__pyx_kp_u_weighted_moving_average);
  Py_CLEAR(clear_module_state->__pyx_n_s_weighted_rank);
  Py_CLEAR(clear_module_state->__pyx_n_s_weighted_spearman_corr);
  Py_CLEAR(clear_module_state->__pyx_n_s_weighted_spearman_rank);
  Py_CLEAR(clear_module_state->__pyx_n_u_weighted_spearman_rank);
  Py_CLEAR(clear_module_state->__pyx_kp_u_weighted_spearman_rank_line_1795);
  Py_CLEAR(clear_module_state->__pyx_n_s_weighted_spearman_rank_locals_we);
  Py_CLEAR(clear_module_state->__pyx_n_s_weights);
  Py_CLEAR(clear_module_state->__pyx_n_s_wf);
  Py_CLEAR(clear_module_state->__pyx_n_s_where);
  Py_CLEAR(clear_module_state->__pyx_n_s_window_length);
  Py_CLEAR(clear_module_state->__pyx_kp_u_window_length_must_be_odd);
  Py_CLEAR(clear_module_state->__pyx_n_s_window_size);
  Py_CLEAR(clear_module_state->__pyx_n_s_window_size_factor);
  Py_CLEAR(clear_module_state->__pyx_kp_u_window_size_has_to_be_of_type_in);
  Py_CLEAR(clear_module_state->__pyx_kp_u_window_size_is_too_large_for_ave);
  Py_CLEAR(clear_module_state->__pyx_kp_u_window_size_size_must_be_a_posit);
  Py_CLEAR(clear_module_state->__pyx_n_s_window_start);
  Py_CLEAR(clear_module_state->__pyx_n_s_window_stop);
  Py_CLEAR(clear_module_state->__pyx_n_u_wma);
  Py_CLEAR(clear_module_state->__pyx_n_u_wrap);
  Py_CLEAR(clear_module_state->__pyx_n_s_x);
  Py_CLEAR(clear_module_state->__pyx_n_u_x);
  Py_CLEAR(clear_module_state->__pyx_kp_u_x_and_y_arrays_must_have_the_sa);
  Py_CLEAR(clear_module_state->__pyx_n_s_x_edge);
  Py_CLEAR(clear_module_state->__pyx_kp_u_x_y_are_not_in_longitude_latitud);
  Py_CLEAR(clear_module_state->__pyx_n_s_xdata);
  Py_CLEAR(clear_module_state->__pyx_n_s_xlabel);
  Py_CLEAR(clear_module_state->__pyx_n_s_xlon);
  Py_CLEAR(clear_module_state->__pyx_kp_u_xlon_and_ylat_arguments_are_grea);
  Py_CLEAR(clear_module_state->__pyx_n_s_xs);
  Py_CLEAR(clear_module_state->__pyx_n_s_xx);
  Py_CLEAR(clear_module_state->__pyx_n_s_xx_edge);
  Py_CLEAR(clear_module_state->__pyx_n_s_y);
  Py_CLEAR(clear_module_state->__pyx_n_u_y);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_bin);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_edge);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_max);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_mean);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_min);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_norm);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_normalized);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_numeric);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_pred);
  Py_CLEAR(clear_module_state->__pyx_n_u_y_pred);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_pred_binary);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_pred_indices);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_pred_pair);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_scaled);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_scores);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_std);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_true);
  Py_CLEAR(clear_module_state->__pyx_n_u_y_true);
  Py_CLEAR(clear_module_state->__pyx_kp_u_y_true_and_y_pred_must_contain_n);
  Py_CLEAR(clear_module_state->__pyx_kp_u_y_true_and_y_pred_should_be_1_di);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_true_binarized);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_true_binary);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_true_encoded);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_true_indices);
  Py_CLEAR(clear_module_state->__pyx_n_s_y_true_pair);
  Py_CLEAR(clear_module_state->__pyx_n_s_ya);
  Py_CLEAR(clear_module_state->__pyx_n_s_ydata);
  Py_CLEAR(clear_module_state->__pyx_n_u_ydata);
  Py_CLEAR(clear_module_state->__pyx_n_s_ydata_new);
  Py_CLEAR(clear_module_state->__pyx_n_s_yield);
  Py_CLEAR(clear_module_state->__pyx_n_s_ylabel);
  Py_CLEAR(clear_module_state->__pyx_n_s_ylat);
  Py_CLEAR(clear_module_state->__pyx_n_s_ymxs);
  Py_CLEAR(clear_module_state->__pyx_n_s_youdens_index);
  Py_CLEAR(clear_module_state->__pyx_n_s_ys);
  Py_CLEAR(clear_module_state->__pyx_n_s_yt);
  Py_CLEAR(clear_module_state->__pyx_kp_u_yt_should_not_contain_NaN_values);
  Py_CLEAR(clear_module_state->__pyx_n_s_yt_transformed);
  Py_CLEAR(clear_module_state->__pyx_n_s_yy);
  Py_CLEAR(clear_module_state->__pyx_n_s_z);
  Py_CLEAR(clear_module_state->__pyx_n_s_zero_division);
  Py_CLEAR(clear_module_state->__pyx_n_s_zeros);
  Py_CLEAR(clear_module_state->__pyx_n_s_zeros_like);
  Py_CLEAR(clear_module_state->__pyx_n_s_zip);
  Py_CLEAR(clear_module_state->__pyx_float__5);
  Py_CLEAR(clear_module_state->__pyx_float_0_);
  Py_CLEAR(clear_module_state->__pyx_float_1_);
  Py_CLEAR(clear_module_state->__pyx_float_0_0);
  Py_CLEAR(clear_module_state->__pyx_float_0_1);
  Py_CLEAR(clear_module_state->__pyx_float_0_5);
  Py_CLEAR(clear_module_state->__pyx_float_1_0);
  Py_CLEAR(clear_module_state->__pyx_float_1e1);
  Py_CLEAR(clear_module_state->__pyx_float_90_);
  Py_CLEAR(clear_module_state->__pyx_float_1_96);
  Py_CLEAR(clear_module_state->__pyx_float_100_);
  Py_CLEAR(clear_module_state->__pyx_float_180_);
  Py_CLEAR(clear_module_state->__pyx_float_1eneg_2);
  Py_CLEAR(clear_module_state->__pyx_float_1eneg_5);
  Py_CLEAR(clear_module_state->__pyx_float_1eneg_7);
  Py_CLEAR(clear_module_state->__pyx_float_1eneg_10);
  Py_CLEAR(clear_module_state->__pyx_float_1eneg_15);
  Py_CLEAR(clear_module_state->__pyx_int_0);
  Py_CLEAR(clear_module_state->__pyx_int_1);
  Py_CLEAR(clear_module_state->__pyx_int_2);
  Py_CLEAR(clear_module_state->__pyx_int_3);
  Py_CLEAR(clear_module_state->__pyx_int_4);
  Py_CLEAR(clear_module_state->__pyx_int_10);
  Py_CLEAR(clear_module_state->__pyx_int_25);
  Py_CLEAR(clear_module_state->__pyx_int_75);
  Py_CLEAR(clear_module_state->__pyx_int_90);
  Py_CLEAR(clear_module_state->__pyx_int_100);
  Py_CLEAR(clear_module_state->__pyx_int_180);
  Py_CLEAR(clear_module_state->__pyx_int_360);
  Py_CLEAR(clear_module_state->__pyx_int_neg_1);
  Py_CLEAR(clear_module_state->__pyx_codeobj_);
  Py_CLEAR(clear_module_state->__pyx_slice__9);
  Py_CLEAR(clear_module_state->__pyx_tuple__3);
  Py_CLEAR(clear_module_state->__pyx_tuple__4);
  Py_CLEAR(clear_module_state->__pyx_tuple__5);
  Py_CLEAR(clear_module_state->__pyx_tuple__7);
  Py_CLEAR(clear_module_state->__pyx_slice__16);
  Py_CLEAR(clear_module_state->__pyx_slice__69);
  Py_CLEAR(clear_module_state->__pyx_tuple__10);
  Py_CLEAR(clear_module_state->__pyx_tuple__11);
  Py_CLEAR(clear_module_state->__pyx_tuple__12);
  Py_CLEAR(clear_module_state->__pyx_tuple__13);
  Py_CLEAR(clear_module_state->__pyx_tuple__19);
  Py_CLEAR(clear_module_state->__pyx_tuple__21);
  Py_CLEAR(clear_module_state->__pyx_tuple__24);
  Py_CLEAR(clear_module_state->__pyx_tuple__27);
  Py_CLEAR(clear_module_state->__pyx_tuple__34);
  Py_CLEAR(clear_module_state->__pyx_tuple__36);
  Py_CLEAR(clear_module_state->__pyx_tuple__40);
  Py_CLEAR(clear_module_state->__pyx_tuple__41);
  Py_CLEAR(clear_module_state->__pyx_tuple__44);
  Py_CLEAR(clear_module_state->__pyx_tuple__47);
  Py_CLEAR(clear_module_state->__pyx_tuple__48);
  Py_CLEAR(clear_module_state->__pyx_tuple__50);
  Py_CLEAR(clear_module_state->__pyx_tuple__51);
  Py_CLEAR(clear_module_state->__pyx_tuple__52);
  Py_CLEAR(clear_module_state->__pyx_tuple__55);
  Py_CLEAR(clear_module_state->__pyx_tuple__56);
  Py_CLEAR(clear_module_state->__pyx_tuple__57);
  Py_CLEAR(clear_module_state->__pyx_tuple__58);
  Py_CLEAR(clear_module_state->__pyx_tuple__60);
  Py_CLEAR(clear_module_state->__pyx_tuple__61);
  Py_CLEAR(clear_module_state->__pyx_tuple__62);
  Py_CLEAR(clear_module_state->__pyx_tuple__63);
  Py_CLEAR(clear_module_state->__pyx_tuple__67);
  Py_CLEAR(clear_module_state->__pyx_tuple__68);
  Py_CLEAR(clear_module_state->__pyx_tuple__72);
  Py_CLEAR(clear_module_state->__pyx_tuple__73);
  Py_CLEAR(clear_module_state->__pyx_tuple__86);
  Py_CLEAR(clear_module_state->__pyx_tuple__87);
  Py_CLEAR(clear_module_state->__pyx_tuple__89);
  Py_CLEAR(clear_module_state->__pyx_tuple__90);
  Py_CLEAR(clear_module_state->__pyx_tuple__92);
  Py_CLEAR(clear_module_state->__pyx_tuple__94);
  Py_CLEAR(clear_module_state->__pyx_tuple__95);
  Py_CLEAR(clear_module_state->__pyx_tuple__96);
  Py_CLEAR(clear_module_state->__pyx_tuple__99);
  Py_CLEAR(clear_module_state->__pyx_codeobj__6);
  Py_CLEAR(clear_module_state->__pyx_codeobj__8);
  Py_CLEAR(clear_module_state->__pyx_slice__109);
  Py_CLEAR(clear_module_state->__pyx_slice__116);
  Py_CLEAR(clear_module_state->__pyx_slice__123);
  Py_CLEAR(clear_module_state->__pyx_tuple__101);
  Py_CLEAR(clear_module_state->__pyx_tuple__102);
  Py_CLEAR(clear_module_state->__pyx_tuple__104);
  Py_CLEAR(clear_module_state->__pyx_tuple__105);
  Py_CLEAR(clear_module_state->__pyx_tuple__106);
  Py_CLEAR(clear_module_state->__pyx_tuple__111);
  Py_CLEAR(clear_module_state->__pyx_tuple__114);
  Py_CLEAR(clear_module_state->__pyx_tuple__115);
  Py_CLEAR(clear_module_state->__pyx_tuple__118);
  Py_CLEAR(clear_module_state->__pyx_tuple__119);
  Py_CLEAR(clear_module_state->__pyx_tuple__120);
  Py_CLEAR(clear_module_state->__pyx_tuple__121);
  Py_CLEAR(clear_module_state->__pyx_tuple__124);
  Py_CLEAR(clear_module_state->__pyx_tuple__125);
  Py_CLEAR(clear_module_state->__pyx_tuple__129);
  Py_CLEAR(clear_module_state->__pyx_tuple__130);
  Py_CLEAR(clear_module_state->__pyx_tuple__132);
  Py_CLEAR(clear_module_state->__pyx_tuple__133);
  Py_CLEAR(clear_module_state->__pyx_tuple__139);
  Py_CLEAR(clear_module_state->__pyx_tuple__143);
  Py_CLEAR(clear_module_state->__pyx_tuple__147);
  Py_CLEAR(clear_module_state->__pyx_tuple__150);
  Py_CLEAR(clear_module_state->__pyx_tuple__151);
  Py_CLEAR(clear_module_state->__pyx_tuple__152);
  Py_CLEAR(clear_module_state->__pyx_tuple__153);
  Py_CLEAR(clear_module_state->__pyx_tuple__154);
  Py_CLEAR(clear_module_state->__pyx_tuple__155);
  Py_CLEAR(clear_module_state->__pyx_tuple__156);
  Py_CLEAR(clear_module_state->__pyx_tuple__157);
  Py_CLEAR(clear_module_state->__pyx_tuple__158);
  Py_CLEAR(clear_module_state->__pyx_tuple__159);
  Py_CLEAR(clear_module_state->__pyx_tuple__160);
  Py_CLEAR(clear_module_state->__pyx_tuple__161);
  Py_CLEAR(clear_module_state->__pyx_tuple__162);
  Py_CLEAR(clear_module_state->__pyx_tuple__163);
  Py_CLEAR(clear_module_state->__pyx_tuple__164);
  Py_CLEAR(clear_module_state->__pyx_tuple__165);
  Py_CLEAR(clear_module_state->__pyx_tuple__166);
  Py_CLEAR(clear_module_state->__pyx_tuple__167);
  Py_CLEAR(clear_module_state->__pyx_tuple__168);
  Py_CLEAR(clear_module_state->__pyx_tuple__169);
  Py_CLEAR(clear_module_state->__pyx_tuple__170);
  Py_CLEAR(clear_module_state->__pyx_tuple__171);
  Py_CLEAR(clear_module_state->__pyx_tuple__172);
  Py_CLEAR(clear_module_state->__pyx_tuple__173);
  Py_CLEAR(clear_module_state->__pyx_tuple__174);
  Py_CLEAR(clear_module_state->__pyx_tuple__175);
  Py_CLEAR(clear_module_state->__pyx_tuple__176);
  Py_CLEAR(clear_module_state->__pyx_tuple__178);
  Py_CLEAR(clear_module_state->__pyx_tuple__179);
  Py_CLEAR(clear_module_state->__pyx_tuple__180);
  Py_CLEAR(clear_module_state->__pyx_tuple__181);
  Py_CLEAR(clear_module_state->__pyx_tuple__182);
  Py_CLEAR(clear_module_state->__pyx_tuple__183);
  Py_CLEAR(clear_module_state->__pyx_tuple__184);
  Py_CLEAR(clear_module_state->__pyx_tuple__185);
  Py_CLEAR(clear_module_state->__pyx_tuple__186);
  Py_CLEAR(clear_module_state->__pyx_tuple__187);
  Py_CLEAR(clear_module_state->__pyx_tuple__188);
  Py_CLEAR(clear_module_state->__pyx_tuple__189);
  Py_CLEAR(clear_module_state->__pyx_tuple__190);
  Py_CLEAR(clear_module_state->__pyx_tuple__191);
  Py_CLEAR(clear_module_state->__pyx_tuple__192);
  Py_CLEAR(clear_module_state->__pyx_tuple__193);
  Py_CLEAR(clear_module_state->__pyx_tuple__194);
  Py_CLEAR(clear_module_state->__pyx_tuple__195);
  Py_CLEAR(clear_module_state->__pyx_tuple__196);
  Py_CLEAR(clear_module_state->__pyx_tuple__197);
  Py_CLEAR(clear_module_state->__pyx_tuple__198);
  Py_CLEAR(clear_module_state->__pyx_tuple__199);
  Py_CLEAR(clear_module_state->__pyx_tuple__200);
  Py_CLEAR(clear_module_state->__pyx_tuple__201);
  Py_CLEAR(clear_module_state->__pyx_tuple__202);
  Py_CLEAR(clear_module_state->__pyx_tuple__203);
  Py_CLEAR(clear_module_state->__pyx_tuple__204);
  Py_CLEAR(clear_module_state->__pyx_tuple__205);
  Py_CLEAR(clear_module_state->__pyx_tuple__206);
  Py_CLEAR(clear_module_state->__pyx_tuple__207);
  Py_CLEAR(clear_module_state->__pyx_tuple__208);
  Py_CLEAR(clear_module_state->__pyx_tuple__209);
  Py_CLEAR(clear_module_state->__pyx_tuple__210);
  Py_CLEAR(clear_module_state->__pyx_tuple__211);
  Py_CLEAR(clear_module_state->__pyx_tuple__212);
  Py_CLEAR(clear_module_state->__pyx_tuple__213);
  Py_CLEAR(clear_module_state->__pyx_tuple__214);
  Py_CLEAR(clear_module_state->__pyx_tuple__215);
  Py_CLEAR(clear_module_state->__pyx_tuple__216);
  Py_CLEAR(clear_module_state->__pyx_tuple__217);
  Py_CLEAR(clear_module_state->__pyx_tuple__218);
  Py_CLEAR(clear_module_state->__pyx_tuple__219);
  Py_CLEAR(clear_module_state->__pyx_tuple__220);
  Py_CLEAR(clear_module_state->__pyx_tuple__221);
  Py_CLEAR(clear_module_state->__pyx_tuple__222);
  Py_CLEAR(clear_module_state->__pyx_tuple__223);
  Py_CLEAR(clear_module_state->__pyx_tuple__224);
  Py_CLEAR(clear_module_state->__pyx_tuple__225);
  Py_CLEAR(clear_module_state->__pyx_tuple__226);
  Py_CLEAR(clear_module_state->__pyx_tuple__227);
  Py_CLEAR(clear_module_state->__pyx_tuple__228);
  Py_CLEAR(clear_module_state->__pyx_tuple__229);
  Py_CLEAR(clear_module_state->__pyx_tuple__230);
  Py_CLEAR(clear_module_state->__pyx_tuple__231);
  Py_CLEAR(clear_module_state->__pyx_tuple__232);
  Py_CLEAR(clear_module_state->__pyx_tuple__233);
  Py_CLEAR(clear_module_state->__pyx_tuple__234);
  Py_CLEAR(clear_module_state->__pyx_tuple__235);
  Py_CLEAR(clear_module_state->__pyx_tuple__236);
  Py_CLEAR(clear_module_state->__pyx_tuple__237);
  Py_CLEAR(clear_module_state->__pyx_tuple__238);
  Py_CLEAR(clear_module_state->__pyx_tuple__239);
  Py_CLEAR(clear_module_state->__pyx_codeobj__14);
  Py_CLEAR(clear_module_state->__pyx_codeobj__15);
  Py_CLEAR(clear_module_state->__pyx_codeobj__17);
  Py_CLEAR(clear_module_state->__pyx_codeobj__18);
  Py_CLEAR(clear_module_state->__pyx_codeobj__20);
  Py_CLEAR(clear_module_state->__pyx_codeobj__22);
  Py_CLEAR(clear_module_state->__pyx_codeobj__23);
  Py_CLEAR(clear_module_state->__pyx_codeobj__25);
  Py_CLEAR(clear_module_state->__pyx_codeobj__26);
  Py_CLEAR(clear_module_state->__pyx_codeobj__28);
  Py_CLEAR(clear_module_state->__pyx_codeobj__29);
  Py_CLEAR(clear_module_state->__pyx_codeobj__30);
  Py_CLEAR(clear_module_state->__pyx_codeobj__32);
  Py_CLEAR(clear_module_state->__pyx_codeobj__33);
  Py_CLEAR(clear_module_state->__pyx_codeobj__35);
  Py_CLEAR(clear_module_state->__pyx_codeobj__37);
  Py_CLEAR(clear_module_state->__pyx_codeobj__38);
  Py_CLEAR(clear_module_state->__pyx_codeobj__42);
  Py_CLEAR(clear_module_state->__pyx_codeobj__43);
  Py_CLEAR(clear_module_state->__pyx_codeobj__45);
  Py_CLEAR(clear_module_state->__pyx_codeobj__46);
  Py_CLEAR(clear_module_state->__pyx_codeobj__49);
  Py_CLEAR(clear_module_state->__pyx_codeobj__53);
  Py_CLEAR(clear_module_state->__pyx_codeobj__54);
  Py_CLEAR(clear_module_state->__pyx_codeobj__59);
  Py_CLEAR(clear_module_state->__pyx_codeobj__64);
  Py_CLEAR(clear_module_state->__pyx_codeobj__66);
  Py_CLEAR(clear_module_state->__pyx_codeobj__71);
  Py_CLEAR(clear_module_state->__pyx_codeobj__74);
  Py_CLEAR(clear_module_state->__pyx_codeobj__75);
  Py_CLEAR(clear_module_state->__pyx_codeobj__76);
  Py_CLEAR(clear_module_state->__pyx_codeobj__77);
  Py_CLEAR(clear_module_state->__pyx_codeobj__78);
  Py_CLEAR(clear_module_state->__pyx_codeobj__79);
  Py_CLEAR(clear_module_state->__pyx_codeobj__80);
  Py_CLEAR(clear_module_state->__pyx_codeobj__81);
  Py_CLEAR(clear_module_state->__pyx_codeobj__82);
  Py_CLEAR(clear_module_state->__pyx_codeobj__83);
  Py_CLEAR(clear_module_state->__pyx_codeobj__84);
  Py_CLEAR(clear_module_state->__pyx_codeobj__85);
  Py_CLEAR(clear_module_state->__pyx_codeobj__91);
  Py_CLEAR(clear_module_state->__pyx_codeobj__93);
  Py_CLEAR(clear_module_state->__pyx_codeobj__97);
  Py_CLEAR(clear_module_state->__pyx_codeobj__98);
  Py_CLEAR(clear_module_state->__pyx_codeobj__100);
  Py_CLEAR(clear_module_state->__pyx_codeobj__103);
  Py_CLEAR(clear_module_state->__pyx_codeobj__108);
  Py_CLEAR(clear_module_state->__pyx_codeobj__110);
  Py_CLEAR(clear_module_state->__pyx_codeobj__112);
  Py_CLEAR(clear_module_state->__pyx_codeobj__113);
  Py_CLEAR(clear_module_state->__pyx_codeobj__117);
  Py_CLEAR(clear_module_state->__pyx_codeobj__122);
  Py_CLEAR(clear_module_state->__pyx_codeobj__126);
  Py_CLEAR(clear_module_state->__pyx_codeobj__127);
  Py_CLEAR(clear_module_state->__pyx_codeobj__128);
  Py_CLEAR(clear_module_state->__pyx_codeobj__131);
  Py_CLEAR(clear_module_state->__pyx_codeobj__134);
  Py_CLEAR(clear_module_state->__pyx_codeobj__135);
  Py_CLEAR(clear_module_state->__pyx_codeobj__136);
  Py_CLEAR(clear_module_state->__pyx_codeobj__137);
  Py_CLEAR(clear_module_state->__pyx_codeobj__138);
  Py_CLEAR(clear_module_state->__pyx_codeobj__140);
  Py_CLEAR(clear_module_state->__pyx_codeobj__141);
  Py_CLEAR(clear_module_state->__pyx_codeobj__142);
  Py_CLEAR(clear_module_state->__pyx_codeobj__144);
  Py_CLEAR(clear_module_state->__pyx_codeobj__145);
  Py_CLEAR(clear_module_state->__pyx_codeobj__146);
  Py_CLEAR(clear_module_state->__pyx_codeobj__148);
  Py_CLEAR(clear_module_state->__pyx_codeobj__149);
  return 0;
}
#endif
/* #### Code section: module_state_traverse ### */
#if CYTHON_USE_MODULE_STATE
static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
  __pyx_mstate *traverse_module_state = __pyx_mstate(m);
  if (!traverse_module_state) return 0;
  Py_VISIT(traverse_module_state->__pyx_d);
  Py_VISIT(traverse_module_state->__pyx_b);
  Py_VISIT(traverse_module_state->__pyx_cython_runtime);
  Py_VISIT(traverse_module_state->__pyx_empty_tuple);
  Py_VISIT(traverse_module_state->__pyx_empty_bytes);
  Py_VISIT(traverse_module_state->__pyx_empty_unicode);
  #ifdef __Pyx_CyFunction_USED
  Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
  #endif
  #ifdef __Pyx_FusedFunction_USED
  Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
  #endif
  Py_VISIT(traverse_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr);
  Py_VISIT(traverse_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr);
  Py_VISIT(traverse_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth);
  Py_VISIT(traverse_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth);
  Py_VISIT(traverse_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model);
  Py_VISIT(traverse_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model);
  Py_VISIT(traverse_module_state->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter);
  Py_VISIT(traverse_module_state->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter);
  Py_VISIT(traverse_module_state->__pyx_kp_u_0A4CEE);
  Py_VISIT(traverse_module_state->__pyx_kp_u_49R);
  Py_VISIT(traverse_module_state->__pyx_n_s_A);
  Py_VISIT(traverse_module_state->__pyx_kp_u_A_moving_average_is_used_with_t);
  Py_VISIT(traverse_module_state->__pyx_kp_u_A_singleton_array);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Adaptative_moving_average_as_sm);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Adjust_y_true_and_y_pred_for_re);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Adjusts_y_true_and_y_pred_for_e);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Adjusts_y_true_and_y_pred_in_a);
  Py_VISIT(traverse_module_state->__pyx_n_s_AppendDocReferences);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Apply_a_Savitzky_Golay_filter_t);
  Py_VISIT(traverse_module_state->__pyx_n_u_Array);
  Py_VISIT(traverse_module_state->__pyx_n_s_ArrayLike);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Array_dimension_is);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Assigns_ranks_to_data_handling);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Axis_must_be_specified_Otherwis);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Azimuth_computation_expects_at_l);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Bins_must_be_auto_or_a_positive);
  Py_VISIT(traverse_module_state->__pyx_n_s_C_FN);
  Py_VISIT(traverse_module_state->__pyx_n_s_C_FP);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_sensitivity_and_speci);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_sensitivity_and_speci_2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_Information_Value);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_average_likelihoo);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_bearing_between_t);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_likelihood_ratio);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_multiclass_likeli);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_optimal_number_of);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculate_the_residuals_for_reg);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculates_histogram_bin_edges);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Calculates_the_adaptive_moving);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Check_the_quality_control_in_th);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_Errors_Standard_Deviati);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_Spearman_s_rank_correla);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_Spearman_s_rank_correla_2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_Youden_s_Index_and_opti);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_azimuth_from_coordinate);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_distance_between_points);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_effort_and_yield_values);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_p_values_for_the_correl);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_sensitivity_and_specifi);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_the_balanced_accuracy_f);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_the_coefficients_for_a_1);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_the_importance_of_each);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_the_similarity_between);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Compute_threshold_using_a_cost);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Computes_the_data_structure_req);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Consensus_must_be_either_positiv);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Correct_data_location_or_positi);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Correct_the_position_coordinate);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Could_not_convert_input_argument);
  Py_VISIT(traverse_module_state->__pyx_n_s_Count);
  Py_VISIT(traverse_module_state->__pyx_n_u_Count);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Count_the_number_of_local_minim);
  Py_VISIT(traverse_module_state->__pyx_n_s_DataFrame);
  Py_VISIT(traverse_module_state->__pyx_kp_u_DataFrame_does_not_contain_any_n);
  Py_VISIT(traverse_module_state->__pyx_kp_u_DataFrame_must_have_at_least_thr);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Dataframe_is_given_The_c_order_a);
  Py_VISIT(traverse_module_state->__pyx_n_s_DecisionStumpRegressor);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Degree_is_integer_Got);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Dependent_variable_depvar_should);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Detect_station_position_and_ret);
  Py_VISIT(traverse_module_state->__pyx_n_s_Dict);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Either_predicted_class_labels_or);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Epsilon_must_be_a_numeric_value);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Epsilon_value_auto_is_acceptable);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Expect);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Expect_one_dimensional_array_for);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Expect_squareform_condense_or_d);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Expected_float_not);
  Py_VISIT(traverse_module_state->__pyx_n_s_F);
  Py_VISIT(traverse_module_state->__pyx_n_s_FN);
  Py_VISIT(traverse_module_state->__pyx_n_s_FP);
  Py_VISIT(traverse_module_state->__pyx_n_s_F_m);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Get_the_closest_value_in_array_f);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Got_x_ndim_d);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Gradient_descent_algorithm_to_f);
  Py_VISIT(traverse_module_state->__pyx_n_u_ID);
  Py_VISIT(traverse_module_state->__pyx_kp_u_If_mode_is_interp_window_length);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Implement_a_simple_version_of_G);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Infers_source_target_and_value);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Input_data_must_be_a_numpy_array);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Input_data_must_be_a_one_dimensi);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Input_values_contain_NaNs);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Invalid_correlation_method_Suppo);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Invalid_method);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Invalid_method_specified_Choose);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Invalid_nan_policy);
  Py_VISIT(traverse_module_state->__pyx_n_s_KeyBox);
  Py_VISIT(traverse_module_state->__pyx_n_s_LabelEncoder);
  Py_VISIT(traverse_module_state->__pyx_n_s_LinearRegression);
  Py_VISIT(traverse_module_state->__pyx_n_s_List);
  Py_VISIT(traverse_module_state->__pyx_kp_s_List_Dict_str_str);
  Py_VISIT(traverse_module_state->__pyx_kp_s_List_str);
  Py_VISIT(traverse_module_state->__pyx_n_s_Location);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Location_index_must_be_less_than);
  Py_VISIT(traverse_module_state->__pyx_n_s_LogisticRegression);
  Py_VISIT(traverse_module_state->__pyx_n_s_N);
  Py_VISIT(traverse_module_state->__pyx_n_s_NDArray);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Need_to_import_scipy_stats_as_a);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Non_numerical);
  Py_VISIT(traverse_module_state->__pyx_kp_u_None);
  Py_VISIT(traverse_module_state->__pyx_kp_u_NoneType_can_not_be_computed);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Number_of_columns_must_fit_the_s);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Numeric_array_is_expected_for_op);
  Py_VISIT(traverse_module_state->__pyx_n_s_Optional);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional_ArrayLike);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional_List_str);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional_Union_ArrayLike_List_Ar);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional_Union_int_str);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional_Union_str_list);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional__F);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Optional_str);
  Py_VISIT(traverse_module_state->__pyx_kp_u_P_value_calculations_expect_nume);
  Py_VISIT(traverse_module_state->__pyx_kp_u_P_values);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Polynomial_function_expects_degr);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Position_array_p);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Predicted_values_must_be_provide);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Profile_angle_is_0_2f_degrees_E);
  Py_VISIT(traverse_module_state->__pyx_n_s_ResultSummary);
  Py_VISIT(traverse_module_state->__pyx_n_s_RuntimeWarning);
  Py_VISIT(traverse_module_state->__pyx_n_s_S);
  Py_VISIT(traverse_module_state->__pyx_n_s_SP);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Scales_each_feature_to_a_given);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Scales_features_to_have_zero_me);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Scales_individual_samples_to_ha);
  Py_VISIT(traverse_module_state->__pyx_n_s_Series);
  Py_VISIT(traverse_module_state->__pyx_n_s_SiteError);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Source_and_Target_columns_must_n);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Station);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Step_is_not_given_Average_distan);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Step_m);
  Py_VISIT(traverse_module_state->__pyx_n_s_T);
  Py_VISIT(traverse_module_state->__pyx_n_s_TN);
  Py_VISIT(traverse_module_state->__pyx_n_s_TP);
  Py_VISIT(traverse_module_state->__pyx_kp_u_The_bins_parameter_is_set_to_aut);
  Py_VISIT(traverse_module_state->__pyx_kp_u_The_first_column_of_the_data_sho);
  Py_VISIT(traverse_module_state->__pyx_kp_u_The_length_of_predict_proba_does);
  Py_VISIT(traverse_module_state->__pyx_kp_u_The_task_type_must_be_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_Tuple);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Tuple_ArrayLike_np_ndarray);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Tuple_List_str_List_str_List_int);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Tuple_float_ArrayLike);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Tuple_float_float);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Tuple_int_float);
  Py_VISIT(traverse_module_state->__pyx_n_s_TypeError);
  Py_VISIT(traverse_module_state->__pyx_n_u_Un);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Unable_to_detect_the_station_pos);
  Py_VISIT(traverse_module_state->__pyx_n_s_Union);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_ArrayLike_List_ArrayLike);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_ArrayLike_Series);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_ArrayLike__SP_Series_DataF);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_int_float);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_int_str_list);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_np_ndarray_List_ArrayLike);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_str_ArrayLike);
  Py_VISIT(traverse_module_state->__pyx_kp_s_Union_str_int);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Unknown_method);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Use_base_or_binning);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Use_column_name_instead);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Use_the_index_instead);
  Py_VISIT(traverse_module_state->__pyx_n_s_ValueError);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Value_column_must_not_contain_nu);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Value_is_resetting_to_minimum_e);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Variant_average_methods_only_inc);
  Py_VISIT(traverse_module_state->__pyx_n_s_W);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Wrong_coordinates_values_Need_tw);
  Py_VISIT(traverse_module_state->__pyx_n_s_X);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_max);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_mean);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_min);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_norm);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_normalized);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_scaled);
  Py_VISIT(traverse_module_state->__pyx_n_s_X_std);
  Py_VISIT(traverse_module_state->__pyx_n_u_Xdata);
  Py_VISIT(traverse_module_state->__pyx_kp_u_Youden_s_index_calculation_requi);
  Py_VISIT(traverse_module_state->__pyx_n_s_Z);
  Py_VISIT(traverse_module_state->__pyx_kp_u__107);
  Py_VISIT(traverse_module_state->__pyx_n_s__177);
  Py_VISIT(traverse_module_state->__pyx_kp_u__2);
  Py_VISIT(traverse_module_state->__pyx_n_s__240);
  Py_VISIT(traverse_module_state->__pyx_kp_u__31);
  Py_VISIT(traverse_module_state->__pyx_kp_u__39);
  Py_VISIT(traverse_module_state->__pyx_kp_u__65);
  Py_VISIT(traverse_module_state->__pyx_n_s__70);
  Py_VISIT(traverse_module_state->__pyx_kp_u__70);
  Py_VISIT(traverse_module_state->__pyx_kp_u__88);
  Py_VISIT(traverse_module_state->__pyx_n_s_a);
  Py_VISIT(traverse_module_state->__pyx_n_s_abs);
  Py_VISIT(traverse_module_state->__pyx_n_s_accept_multioutput);
  Py_VISIT(traverse_module_state->__pyx_n_s_action);
  Py_VISIT(traverse_module_state->__pyx_n_s_actual);
  Py_VISIT(traverse_module_state->__pyx_n_s_adaptive_moving_average);
  Py_VISIT(traverse_module_state->__pyx_n_u_adaptive_moving_average);
  Py_VISIT(traverse_module_state->__pyx_kp_u_adaptive_moving_average_line_494);
  Py_VISIT(traverse_module_state->__pyx_n_s_add_results);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjust_for_control_vars);
  Py_VISIT(traverse_module_state->__pyx_n_u_adjust_for_control_vars);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjust_for_control_vars_classifi);
  Py_VISIT(traverse_module_state->__pyx_kp_u_adjust_for_control_vars_classifi_2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_adjust_for_control_vars_line_150);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjust_for_control_vars_regressi);
  Py_VISIT(traverse_module_state->__pyx_kp_u_adjust_for_control_vars_regressi_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjusted_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjusted_preds);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjusted_y_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_adjusted_y_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_all);
  Py_VISIT(traverse_module_state->__pyx_n_s_all_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_alpha);
  Py_VISIT(traverse_module_state->__pyx_kp_u_alpha_should_be_less_than_1_and);
  Py_VISIT(traverse_module_state->__pyx_n_s_ama);
  Py_VISIT(traverse_module_state->__pyx_n_s_ama_value);
  Py_VISIT(traverse_module_state->__pyx_n_u_amount);
  Py_VISIT(traverse_module_state->__pyx_n_s_any);
  Py_VISIT(traverse_module_state->__pyx_n_s_api_box);
  Py_VISIT(traverse_module_state->__pyx_n_s_api_docstring);
  Py_VISIT(traverse_module_state->__pyx_n_s_api_summary);
  Py_VISIT(traverse_module_state->__pyx_n_s_api_types);
  Py_VISIT(traverse_module_state->__pyx_n_s_append);
  Py_VISIT(traverse_module_state->__pyx_n_s_apply_log_scale);
  Py_VISIT(traverse_module_state->__pyx_n_s_ar);
  Py_VISIT(traverse_module_state->__pyx_n_s_arange);
  Py_VISIT(traverse_module_state->__pyx_n_s_arctan);
  Py_VISIT(traverse_module_state->__pyx_n_s_arctan2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_are_not_allowed);
  Py_VISIT(traverse_module_state->__pyx_n_s_argmax);
  Py_VISIT(traverse_module_state->__pyx_n_s_argmin);
  Py_VISIT(traverse_module_state->__pyx_n_s_argrelextrema);
  Py_VISIT(traverse_module_state->__pyx_n_s_args);
  Py_VISIT(traverse_module_state->__pyx_n_s_argsort);
  Py_VISIT(traverse_module_state->__pyx_n_s_argwhere);
  Py_VISIT(traverse_module_state->__pyx_n_s_around);
  Py_VISIT(traverse_module_state->__pyx_n_s_arr);
  Py_VISIT(traverse_module_state->__pyx_n_u_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_array_2);
  Py_VISIT(traverse_module_state->__pyx_n_u_array_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_arraytools);
  Py_VISIT(traverse_module_state->__pyx_n_s_as_frame);
  Py_VISIT(traverse_module_state->__pyx_n_s_asarray);
  Py_VISIT(traverse_module_state->__pyx_n_s_assert_all_types);
  Py_VISIT(traverse_module_state->__pyx_n_s_assert_ratio);
  Py_VISIT(traverse_module_state->__pyx_n_s_assert_x_y_positions);
  Py_VISIT(traverse_module_state->__pyx_n_s_assert_xy_in);
  Py_VISIT(traverse_module_state->__pyx_n_s_assign);
  Py_VISIT(traverse_module_state->__pyx_n_s_astype);
  Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
  Py_VISIT(traverse_module_state->__pyx_n_s_auc_score);
  Py_VISIT(traverse_module_state->__pyx_n_u_auto);
  Py_VISIT(traverse_module_state->__pyx_n_s_average);
  Py_VISIT(traverse_module_state->__pyx_n_u_average);
  Py_VISIT(traverse_module_state->__pyx_n_s_avg_sensitivity);
  Py_VISIT(traverse_module_state->__pyx_n_s_avg_specificity);
  Py_VISIT(traverse_module_state->__pyx_n_s_aweights);
  Py_VISIT(traverse_module_state->__pyx_n_s_ax);
  Py_VISIT(traverse_module_state->__pyx_n_s_axis);
  Py_VISIT(traverse_module_state->__pyx_n_s_axis_slice);
  Py_VISIT(traverse_module_state->__pyx_n_s_azim);
  Py_VISIT(traverse_module_state->__pyx_n_s_b);
  Py_VISIT(traverse_module_state->__pyx_kp_u_b_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_bal_acc_scores);
  Py_VISIT(traverse_module_state->__pyx_n_s_balanced_accuracy_ovo);
  Py_VISIT(traverse_module_state->__pyx_n_s_balanced_accuracy_ovr);
  Py_VISIT(traverse_module_state->__pyx_n_u_base);
  Py_VISIT(traverse_module_state->__pyx_n_s_base_epsilon);
  Py_VISIT(traverse_module_state->__pyx_n_s_best_threshold);
  Py_VISIT(traverse_module_state->__pyx_n_s_beta);
  Py_VISIT(traverse_module_state->__pyx_n_s_bias);
  Py_VISIT(traverse_module_state->__pyx_n_s_bin_contribution);
  Py_VISIT(traverse_module_state->__pyx_n_s_bin_edges);
  Py_VISIT(traverse_module_state->__pyx_n_s_bin_index);
  Py_VISIT(traverse_module_state->__pyx_n_s_bin_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_bin_width);
  Py_VISIT(traverse_module_state->__pyx_n_u_binary);
  Py_VISIT(traverse_module_state->__pyx_n_s_binary_y_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_binary_y_true);
  Py_VISIT(traverse_module_state->__pyx_n_u_binning);
  Py_VISIT(traverse_module_state->__pyx_n_s_bins);
  Py_VISIT(traverse_module_state->__pyx_n_s_bins_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_bins_method);
  Py_VISIT(traverse_module_state->__pyx_n_s_bool);
  Py_VISIT(traverse_module_state->__pyx_n_s_bounds);
  Py_VISIT(traverse_module_state->__pyx_n_s_buffer);
  Py_VISIT(traverse_module_state->__pyx_n_s_c);
  Py_VISIT(traverse_module_state->__pyx_n_s_c_order);
  Py_VISIT(traverse_module_state->__pyx_kp_u_c_order_2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_c_order_3);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_adjusted_lr);
  Py_VISIT(traverse_module_state->__pyx_n_u_calculate_adjusted_lr);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_adjusted_lr_line_809);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_binary_iv);
  Py_VISIT(traverse_module_state->__pyx_n_u_calculate_binary_iv);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_binary_iv_line_1993);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_histogram_bins);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_histogram_bins_line_12);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_multiclass_avg_lr);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_multiclass_avg_lr_line);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_multiclass_lr);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_multiclass_lr_line_662);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_optimal_bins);
  Py_VISIT(traverse_module_state->__pyx_n_u_calculate_optimal_bins);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_optimal_bins_line_1895);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_optimal_bins_locals_ge);
  Py_VISIT(traverse_module_state->__pyx_n_s_calculate_residuals);
  Py_VISIT(traverse_module_state->__pyx_n_u_calculate_residuals);
  Py_VISIT(traverse_module_state->__pyx_kp_u_calculate_residuals_line_2195);
  Py_VISIT(traverse_module_state->__pyx_n_u_call);
  Py_VISIT(traverse_module_state->__pyx_n_s_catch_warnings);
  Py_VISIT(traverse_module_state->__pyx_n_s_category);
  Py_VISIT(traverse_module_state->__pyx_n_s_ceil);
  Py_VISIT(traverse_module_state->__pyx_n_s_change);
  Py_VISIT(traverse_module_state->__pyx_n_s_check_classification_targets);
  Py_VISIT(traverse_module_state->__pyx_n_s_check_consistent_length);
  Py_VISIT(traverse_module_state->__pyx_n_s_check_epsilon);
  Py_VISIT(traverse_module_state->__pyx_n_s_check_y);
  Py_VISIT(traverse_module_state->__pyx_n_s_ck);
  Py_VISIT(traverse_module_state->__pyx_n_s_class_getitem);
  Py_VISIT(traverse_module_state->__pyx_n_s_classes);
  Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
  Py_VISIT(traverse_module_state->__pyx_n_s_close);
  Py_VISIT(traverse_module_state->__pyx_n_s_cls);
  Py_VISIT(traverse_module_state->__pyx_n_s_cls1);
  Py_VISIT(traverse_module_state->__pyx_n_s_cls2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_cluster_d);
  Py_VISIT(traverse_module_state->__pyx_n_s_cm);
  Py_VISIT(traverse_module_state->__pyx_n_u_cma);
  Py_VISIT(traverse_module_state->__pyx_n_s_coef);
  Py_VISIT(traverse_module_state->__pyx_n_s_coeffs);
  Py_VISIT(traverse_module_state->__pyx_n_s_col);
  Py_VISIT(traverse_module_state->__pyx_n_s_column);
  Py_VISIT(traverse_module_state->__pyx_n_s_column2ignore);
  Py_VISIT(traverse_module_state->__pyx_n_s_columns);
  Py_VISIT(traverse_module_state->__pyx_n_u_columns);
  Py_VISIT(traverse_module_state->__pyx_n_s_combinations);
  Py_VISIT(traverse_module_state->__pyx_n_u_complete);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_balance_accuracy);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_balance_accuracy);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_balance_accuracy_line_24);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_balanced_accuracy_binar);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_cost_based_threshold);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_cost_based_threshold);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_cost_based_threshold_lin);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_effort_yield);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_effort_yield);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_effort_yield_line_2440);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_errors);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_errors);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_errors_line_4287);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_ovo_sens_spec);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_ovo_sens_spec_line_1140);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_p_values);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_p_values);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_p_values_line_97);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_sensitivity_specificity);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_sensitivity_specificity_2);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_sensitivity_specificity_2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_sensitivity_specificity_3);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_sensitivity_specificity_4);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_spearmanr);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_spearmanr_locals__weigh);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_sunburst_data);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_sunburst_data);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_sunburst_data_line_2348);
  Py_VISIT(traverse_module_state->__pyx_n_s_compute_youdens_index);
  Py_VISIT(traverse_module_state->__pyx_n_u_compute_youdens_index);
  Py_VISIT(traverse_module_state->__pyx_kp_u_compute_youdens_index_line_466);
  Py_VISIT(traverse_module_state->__pyx_n_s_concat);
  Py_VISIT(traverse_module_state->__pyx_n_s_concat_array_from_list);
  Py_VISIT(traverse_module_state->__pyx_n_s_concat_axis);
  Py_VISIT(traverse_module_state->__pyx_n_s_concatenate);
  Py_VISIT(traverse_module_state->__pyx_n_u_condens);
  Py_VISIT(traverse_module_state->__pyx_n_u_condense);
  Py_VISIT(traverse_module_state->__pyx_n_s_confusion_matrix);
  Py_VISIT(traverse_module_state->__pyx_n_s_consensus);
  Py_VISIT(traverse_module_state->__pyx_n_u_consensus);
  Py_VISIT(traverse_module_state->__pyx_n_u_constant);
  Py_VISIT(traverse_module_state->__pyx_n_u_contains);
  Py_VISIT(traverse_module_state->__pyx_n_u_continuous);
  Py_VISIT(traverse_module_state->__pyx_n_s_control_vars);
  Py_VISIT(traverse_module_state->__pyx_n_u_conv);
  Py_VISIT(traverse_module_state->__pyx_n_s_convert_distance_to_m);
  Py_VISIT(traverse_module_state->__pyx_n_s_converter);
  Py_VISIT(traverse_module_state->__pyx_n_s_convolve);
  Py_VISIT(traverse_module_state->__pyx_n_s_convolve1d);
  Py_VISIT(traverse_module_state->__pyx_n_s_copy);
  Py_VISIT(traverse_module_state->__pyx_n_s_coreutils);
  Py_VISIT(traverse_module_state->__pyx_n_s_corr);
  Py_VISIT(traverse_module_state->__pyx_n_s_corr_func);
  Py_VISIT(traverse_module_state->__pyx_n_s_corr_methods);
  Py_VISIT(traverse_module_state->__pyx_n_s_corrcoef);
  Py_VISIT(traverse_module_state->__pyx_n_s_cos);
  Py_VISIT(traverse_module_state->__pyx_n_s_cost_history);
  Py_VISIT(traverse_module_state->__pyx_n_s_costs);
  Py_VISIT(traverse_module_state->__pyx_n_u_costs);
  Py_VISIT(traverse_module_state->__pyx_kp_u_could_not_convert_string_to_floa);
  Py_VISIT(traverse_module_state->__pyx_n_s_count);
  Py_VISIT(traverse_module_state->__pyx_n_u_count);
  Py_VISIT(traverse_module_state->__pyx_n_s_count_local_minima);
  Py_VISIT(traverse_module_state->__pyx_kp_u_count_local_minima_line_3171);
  Py_VISIT(traverse_module_state->__pyx_n_s_counts);
  Py_VISIT(traverse_module_state->__pyx_n_s_cov);
  Py_VISIT(traverse_module_state->__pyx_n_s_cubic_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_cubic_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_cum_weights);
  Py_VISIT(traverse_module_state->__pyx_n_s_cumsum);
  Py_VISIT(traverse_module_state->__pyx_n_u_cumulative);
  Py_VISIT(traverse_module_state->__pyx_kp_u_cumulative_average);
  Py_VISIT(traverse_module_state->__pyx_n_s_cumulative_data);
  Py_VISIT(traverse_module_state->__pyx_n_s_curve_fit);
  Py_VISIT(traverse_module_state->__pyx_kp_u_custom_logic);
  Py_VISIT(traverse_module_state->__pyx_n_s_cval);
  Py_VISIT(traverse_module_state->__pyx_n_s_d);
  Py_VISIT(traverse_module_state->__pyx_n_s_data);
  Py_VISIT(traverse_module_state->__pyx_n_u_data);
  Py_VISIT(traverse_module_state->__pyx_n_s_data_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_data_max);
  Py_VISIT(traverse_module_state->__pyx_n_s_data_min);
  Py_VISIT(traverse_module_state->__pyx_n_s_data_range);
  Py_VISIT(traverse_module_state->__pyx_kp_u_data_range_must_be_a_tuple_of_tw);
  Py_VISIT(traverse_module_state->__pyx_kp_u_data_range_must_contain_numeric);
  Py_VISIT(traverse_module_state->__pyx_kp_u_data_should_be_a_frame_not);
  Py_VISIT(traverse_module_state->__pyx_n_s_ddof);
  Py_VISIT(traverse_module_state->__pyx_n_s_decorators);
  Py_VISIT(traverse_module_state->__pyx_n_s_deep);
  Py_VISIT(traverse_module_state->__pyx_n_s_deepcopy);
  Py_VISIT(traverse_module_state->__pyx_n_s_default);
  Py_VISIT(traverse_module_state->__pyx_n_s_defaults);
  Py_VISIT(traverse_module_state->__pyx_n_s_deg);
  Py_VISIT(traverse_module_state->__pyx_n_s_deg2rad);
  Py_VISIT(traverse_module_state->__pyx_n_s_degree);
  Py_VISIT(traverse_module_state->__pyx_n_s_delete);
  Py_VISIT(traverse_module_state->__pyx_n_s_delta);
  Py_VISIT(traverse_module_state->__pyx_n_u_dense);
  Py_VISIT(traverse_module_state->__pyx_n_s_dense_rank);
  Py_VISIT(traverse_module_state->__pyx_n_s_depvar);
  Py_VISIT(traverse_module_state->__pyx_n_u_depvar);
  Py_VISIT(traverse_module_state->__pyx_n_s_deriv);
  Py_VISIT(traverse_module_state->__pyx_n_u_design);
  Py_VISIT(traverse_module_state->__pyx_n_s_detect_station_position);
  Py_VISIT(traverse_module_state->__pyx_kp_u_detect_station_position_line_374);
  Py_VISIT(traverse_module_state->__pyx_n_s_determine_epsilon);
  Py_VISIT(traverse_module_state->__pyx_n_s_df);
  Py_VISIT(traverse_module_state->__pyx_n_s_df_full);
  Py_VISIT(traverse_module_state->__pyx_n_s_df_level);
  Py_VISIT(traverse_module_state->__pyx_n_s_df_only);
  Py_VISIT(traverse_module_state->__pyx_n_s_diag);
  Py_VISIT(traverse_module_state->__pyx_n_s_diff);
  Py_VISIT(traverse_module_state->__pyx_n_s_digitize);
  Py_VISIT(traverse_module_state->__pyx_n_s_digitized);
  Py_VISIT(traverse_module_state->__pyx_n_s_dipole);
  Py_VISIT(traverse_module_state->__pyx_kp_u_disable);
  Py_VISIT(traverse_module_state->__pyx_n_s_distance);
  Py_VISIT(traverse_module_state->__pyx_n_u_distance);
  Py_VISIT(traverse_module_state->__pyx_n_s_dl);
  Py_VISIT(traverse_module_state->__pyx_n_s_doc);
  Py_VISIT(traverse_module_state->__pyx_n_s_dot);
  Py_VISIT(traverse_module_state->__pyx_n_u_dot);
  Py_VISIT(traverse_module_state->__pyx_n_s_dp);
  Py_VISIT(traverse_module_state->__pyx_n_s_drop);
  Py_VISIT(traverse_module_state->__pyx_n_s_drop_duplicates);
  Py_VISIT(traverse_module_state->__pyx_n_s_drop_intermediate);
  Py_VISIT(traverse_module_state->__pyx_n_s_dtype);
  Py_VISIT(traverse_module_state->__pyx_n_s_dx);
  Py_VISIT(traverse_module_state->__pyx_n_s_dy);
  Py_VISIT(traverse_module_state->__pyx_n_s_easting);
  Py_VISIT(traverse_module_state->__pyx_n_s_effort);
  Py_VISIT(traverse_module_state->__pyx_n_s_ellipsis2false);
  Py_VISIT(traverse_module_state->__pyx_n_u_ema);
  Py_VISIT(traverse_module_state->__pyx_n_s_empty);
  Py_VISIT(traverse_module_state->__pyx_n_s_empty_like);
  Py_VISIT(traverse_module_state->__pyx_kp_u_enable);
  Py_VISIT(traverse_module_state->__pyx_n_s_end);
  Py_VISIT(traverse_module_state->__pyx_n_s_ensure_2d);
  Py_VISIT(traverse_module_state->__pyx_n_s_ensure_non_negative);
  Py_VISIT(traverse_module_state->__pyx_n_s_ensure_y_is_valid);
  Py_VISIT(traverse_module_state->__pyx_n_s_enter);
  Py_VISIT(traverse_module_state->__pyx_n_s_enumerate);
  Py_VISIT(traverse_module_state->__pyx_n_s_epsilon);
  Py_VISIT(traverse_module_state->__pyx_n_s_err);
  Py_VISIT(traverse_module_state->__pyx_n_s_err_lower);
  Py_VISIT(traverse_module_state->__pyx_n_s_err_msg);
  Py_VISIT(traverse_module_state->__pyx_n_s_err_upper);
  Py_VISIT(traverse_module_state->__pyx_n_s_error);
  Py_VISIT(traverse_module_state->__pyx_n_u_error);
  Py_VISIT(traverse_module_state->__pyx_n_s_error_msg);
  Py_VISIT(traverse_module_state->__pyx_n_s_errstate);
  Py_VISIT(traverse_module_state->__pyx_n_s_estimator);
  Py_VISIT(traverse_module_state->__pyx_n_s_estimators);
  Py_VISIT(traverse_module_state->__pyx_n_u_euclidean);
  Py_VISIT(traverse_module_state->__pyx_n_s_exceptions);
  Py_VISIT(traverse_module_state->__pyx_n_s_exclude_string);
  Py_VISIT(traverse_module_state->__pyx_n_s_exclude_value);
  Py_VISIT(traverse_module_state->__pyx_n_s_exit);
  Py_VISIT(traverse_module_state->__pyx_n_s_exp);
  Py_VISIT(traverse_module_state->__pyx_n_s_expect_name);
  Py_VISIT(traverse_module_state->__pyx_n_u_exponential);
  Py_VISIT(traverse_module_state->__pyx_kp_u_exponential_moving_average);
  Py_VISIT(traverse_module_state->__pyx_n_s_exponential_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_exponential_regression);
  Py_VISIT(traverse_module_state->__pyx_kp_u_extra_azimuth);
  Py_VISIT(traverse_module_state->__pyx_n_s_extrapolate);
  Py_VISIT(traverse_module_state->__pyx_n_s_false_negatives);
  Py_VISIT(traverse_module_state->__pyx_n_s_false_positives);
  Py_VISIT(traverse_module_state->__pyx_n_s_fig);
  Py_VISIT(traverse_module_state->__pyx_n_s_figsize);
  Py_VISIT(traverse_module_state->__pyx_n_s_filtering_1d_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_filterwarnings);
  Py_VISIT(traverse_module_state->__pyx_n_s_find);
  Py_VISIT(traverse_module_state->__pyx_n_s_find_close_position);
  Py_VISIT(traverse_module_state->__pyx_n_s_find_closest);
  Py_VISIT(traverse_module_state->__pyx_kp_u_find_closest_line_4771);
  Py_VISIT(traverse_module_state->__pyx_n_s_fit);
  Py_VISIT(traverse_module_state->__pyx_kp_u_fit_a_5_3f_b_5_3f);
  Py_VISIT(traverse_module_state->__pyx_n_s_fit_edge);
  Py_VISIT(traverse_module_state->__pyx_n_s_fit_edges_polyfit);
  Py_VISIT(traverse_module_state->__pyx_n_s_fit_transform);
  Py_VISIT(traverse_module_state->__pyx_n_s_float);
  Py_VISIT(traverse_module_state->__pyx_n_u_float);
  Py_VISIT(traverse_module_state->__pyx_n_s_float32);
  Py_VISIT(traverse_module_state->__pyx_n_s_float64);
  Py_VISIT(traverse_module_state->__pyx_n_s_float_factorial);
  Py_VISIT(traverse_module_state->__pyx_n_s_format);
  Py_VISIT(traverse_module_state->__pyx_n_s_fpr);
  Py_VISIT(traverse_module_state->__pyx_n_u_freedman_diaconis);
  Py_VISIT(traverse_module_state->__pyx_n_s_from0);
  Py_VISIT(traverse_module_state->__pyx_n_s_func);
  Py_VISIT(traverse_module_state->__pyx_kp_u_func_argument_is_a_callable_not);
  Py_VISIT(traverse_module_state->__pyx_kp_u_gc);
  Py_VISIT(traverse_module_state->__pyx_n_s_genexpr);
  Py_VISIT(traverse_module_state->__pyx_n_s_get);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_azimuth);
  Py_VISIT(traverse_module_state->__pyx_kp_u_get_azimuth_line_3229);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_azimuth_locals_lambda);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_bearing);
  Py_VISIT(traverse_module_state->__pyx_n_u_get_bearing);
  Py_VISIT(traverse_module_state->__pyx_kp_u_get_bearing_line_4703);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_distance);
  Py_VISIT(traverse_module_state->__pyx_n_u_get_distance);
  Py_VISIT(traverse_module_state->__pyx_kp_u_get_distance_line_4518);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_gofast_logger);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_profile_angle);
  Py_VISIT(traverse_module_state->__pyx_n_s_get_station_number);
  Py_VISIT(traverse_module_state->__pyx_n_s_gofast_tools_mathex);
  Py_VISIT(traverse_module_state->__pyx_kp_s_gofast_tools_mathex_pyx);
  Py_VISIT(traverse_module_state->__pyx_n_s_gofastlog);
  Py_VISIT(traverse_module_state->__pyx_n_s_gofastlog_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_gradient_boosting_regressor);
  Py_VISIT(traverse_module_state->__pyx_kp_u_gradient_boosting_regressor_line);
  Py_VISIT(traverse_module_state->__pyx_n_s_gradient_descent);
  Py_VISIT(traverse_module_state->__pyx_kp_u_gradient_descent_line_4820);
  Py_VISIT(traverse_module_state->__pyx_n_s_group);
  Py_VISIT(traverse_module_state->__pyx_n_s_groupby);
  Py_VISIT(traverse_module_state->__pyx_n_s_halflen);
  Py_VISIT(traverse_module_state->__pyx_n_s_hierarchy);
  Py_VISIT(traverse_module_state->__pyx_n_s_histogram_bin_edges);
  Py_VISIT(traverse_module_state->__pyx_n_s_hstack);
  Py_VISIT(traverse_module_state->__pyx_n_s_i);
  Py_VISIT(traverse_module_state->__pyx_n_s_idx);
  Py_VISIT(traverse_module_state->__pyx_n_s_ignore);
  Py_VISIT(traverse_module_state->__pyx_n_u_ignore);
  Py_VISIT(traverse_module_state->__pyx_n_s_ignore_index);
  Py_VISIT(traverse_module_state->__pyx_n_s_ii);
  Py_VISIT(traverse_module_state->__pyx_n_s_iloc);
  Py_VISIT(traverse_module_state->__pyx_n_s_import);
  Py_VISIT(traverse_module_state->__pyx_n_s_in_bin);
  Py_VISIT(traverse_module_state->__pyx_n_s_in_percent);
  Py_VISIT(traverse_module_state->__pyx_n_s_include_label);
  Py_VISIT(traverse_module_state->__pyx_n_s_include_metrics);
  Py_VISIT(traverse_module_state->__pyx_n_s_include_nan);
  Py_VISIT(traverse_module_state->__pyx_n_s_index);
  Py_VISIT(traverse_module_state->__pyx_n_u_inf);
  Py_VISIT(traverse_module_state->__pyx_n_s_infer_sankey_columns);
  Py_VISIT(traverse_module_state->__pyx_n_u_infer_sankey_columns);
  Py_VISIT(traverse_module_state->__pyx_kp_u_infer_sankey_columns_line_2272);
  Py_VISIT(traverse_module_state->__pyx_n_s_init_weights);
  Py_VISIT(traverse_module_state->__pyx_n_s_initializing);
  Py_VISIT(traverse_module_state->__pyx_n_s_input_name);
  Py_VISIT(traverse_module_state->__pyx_n_s_inspect);
  Py_VISIT(traverse_module_state->__pyx_kp_u_instead_of);
  Py_VISIT(traverse_module_state->__pyx_n_s_int);
  Py_VISIT(traverse_module_state->__pyx_n_s_int32);
  Py_VISIT(traverse_module_state->__pyx_n_u_interp);
  Py_VISIT(traverse_module_state->__pyx_n_s_interp_start);
  Py_VISIT(traverse_module_state->__pyx_n_s_interp_stop);
  Py_VISIT(traverse_module_state->__pyx_n_s_inv);
  Py_VISIT(traverse_module_state->__pyx_n_s_inverse_transform);
  Py_VISIT(traverse_module_state->__pyx_n_s_involved_pairs);
  Py_VISIT(traverse_module_state->__pyx_n_s_iqr);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_arraylike_1d);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_binary_class);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_frame);
  Py_VISIT(traverse_module_state->__pyx_kp_u_is_gotten);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_iterable);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_latlon);
  Py_VISIT(traverse_module_state->__pyx_kp_u_is_not_admitted_Expect_at_least);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_numeric_dtype);
  Py_VISIT(traverse_module_state->__pyx_kp_u_is_out_of_the_range_max_positio);
  Py_VISIT(traverse_module_state->__pyx_n_s_is_utm);
  Py_VISIT(traverse_module_state->__pyx_n_s_isdeg);
  Py_VISIT(traverse_module_state->__pyx_n_s_isdigit);
  Py_VISIT(traverse_module_state->__pyx_kp_u_isenabled);
  Py_VISIT(traverse_module_state->__pyx_n_s_isfunction);
  Py_VISIT(traverse_module_state->__pyx_n_s_isin);
  Py_VISIT(traverse_module_state->__pyx_n_s_islatlon);
  Py_VISIT(traverse_module_state->__pyx_n_s_isnan);
  Py_VISIT(traverse_module_state->__pyx_n_s_isnull);
  Py_VISIT(traverse_module_state->__pyx_n_s_isreal);
  Py_VISIT(traverse_module_state->__pyx_n_s_isscalar);
  Py_VISIT(traverse_module_state->__pyx_n_s_issubdtype);
  Py_VISIT(traverse_module_state->__pyx_n_s_items);
  Py_VISIT(traverse_module_state->__pyx_n_s_iterrows);
  Py_VISIT(traverse_module_state->__pyx_n_s_itertools);
  Py_VISIT(traverse_module_state->__pyx_n_s_iv);
  Py_VISIT(traverse_module_state->__pyx_n_s_ix_c);
  Py_VISIT(traverse_module_state->__pyx_n_s_j);
  Py_VISIT(traverse_module_state->__pyx_n_s_k);
  Py_VISIT(traverse_module_state->__pyx_n_s_keepdims);
  Py_VISIT(traverse_module_state->__pyx_n_u_kendall);
  Py_VISIT(traverse_module_state->__pyx_n_s_kendalltau);
  Py_VISIT(traverse_module_state->__pyx_n_s_key);
  Py_VISIT(traverse_module_state->__pyx_n_s_kind);
  Py_VISIT(traverse_module_state->__pyx_n_s_kind_of_model);
  Py_VISIT(traverse_module_state->__pyx_n_s_kind_of_model_locals_init_weigh);
  Py_VISIT(traverse_module_state->__pyx_n_u_km);
  Py_VISIT(traverse_module_state->__pyx_n_s_kws);
  Py_VISIT(traverse_module_state->__pyx_n_s_label);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_binarize);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_i);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_importance);
  Py_VISIT(traverse_module_state->__pyx_n_u_label_importance);
  Py_VISIT(traverse_module_state->__pyx_kp_u_label_importance_line_2612);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_j);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_to_index);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_y);
  Py_VISIT(traverse_module_state->__pyx_n_s_label_yt_trailer);
  Py_VISIT(traverse_module_state->__pyx_n_s_labels);
  Py_VISIT(traverse_module_state->__pyx_n_s_lat1);
  Py_VISIT(traverse_module_state->__pyx_n_s_lat2);
  Py_VISIT(traverse_module_state->__pyx_n_s_latlon1);
  Py_VISIT(traverse_module_state->__pyx_n_s_latlon2);
  Py_VISIT(traverse_module_state->__pyx_n_s_le);
  Py_VISIT(traverse_module_state->__pyx_n_s_le_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_le_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_learning_rate);
  Py_VISIT(traverse_module_state->__pyx_n_s_legend);
  Py_VISIT(traverse_module_state->__pyx_n_s_less);
  Py_VISIT(traverse_module_state->__pyx_n_s_linalg);
  Py_VISIT(traverse_module_state->__pyx_n_u_linear);
  Py_VISIT(traverse_module_state->__pyx_n_s_linear_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_linear_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_linfunc);
  Py_VISIT(traverse_module_state->__pyx_n_s_linkage);
  Py_VISIT(traverse_module_state->__pyx_n_s_linkage_matrix);
  Py_VISIT(traverse_module_state->__pyx_n_u_linkage_matrix);
  Py_VISIT(traverse_module_state->__pyx_n_s_linregress);
  Py_VISIT(traverse_module_state->__pyx_n_s_linspace);
  Py_VISIT(traverse_module_state->__pyx_n_u_ll);
  Py_VISIT(traverse_module_state->__pyx_n_s_local_minima_count);
  Py_VISIT(traverse_module_state->__pyx_n_s_local_minima_indices);
  Py_VISIT(traverse_module_state->__pyx_n_s_log);
  Py_VISIT(traverse_module_state->__pyx_n_s_log10);
  Py_VISIT(traverse_module_state->__pyx_n_s_log2);
  Py_VISIT(traverse_module_state->__pyx_n_s_logarithmic_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_logarithmic_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_logger);
  Py_VISIT(traverse_module_state->__pyx_n_s_logify);
  Py_VISIT(traverse_module_state->__pyx_n_s_lon1);
  Py_VISIT(traverse_module_state->__pyx_n_s_lon2);
  Py_VISIT(traverse_module_state->__pyx_n_s_lower);
  Py_VISIT(traverse_module_state->__pyx_n_s_lr);
  Py_VISIT(traverse_module_state->__pyx_n_s_lstsq);
  Py_VISIT(traverse_module_state->__pyx_n_s_m);
  Py_VISIT(traverse_module_state->__pyx_n_u_m);
  Py_VISIT(traverse_module_state->__pyx_n_u_macro);
  Py_VISIT(traverse_module_state->__pyx_n_s_main);
  Py_VISIT(traverse_module_state->__pyx_n_s_make_mxs);
  Py_VISIT(traverse_module_state->__pyx_n_u_make_mxs);
  Py_VISIT(traverse_module_state->__pyx_kp_u_make_mxs_line_2514);
  Py_VISIT(traverse_module_state->__pyx_n_s_manage_colors);
  Py_VISIT(traverse_module_state->__pyx_n_s_map);
  Py_VISIT(traverse_module_state->__pyx_n_s_marker);
  Py_VISIT(traverse_module_state->__pyx_n_s_match_method);
  Py_VISIT(traverse_module_state->__pyx_n_s_matplotlib);
  Py_VISIT(traverse_module_state->__pyx_n_s_matplotlib_pyplot);
  Py_VISIT(traverse_module_state->__pyx_n_s_max);
  Py_VISIT(traverse_module_state->__pyx_n_u_max);
  Py_VISIT(traverse_module_state->__pyx_n_s_max_depth);
  Py_VISIT(traverse_module_state->__pyx_n_s_max_lr);
  Py_VISIT(traverse_module_state->__pyx_n_s_maximum);
  Py_VISIT(traverse_module_state->__pyx_n_s_mean);
  Py_VISIT(traverse_module_state->__pyx_n_s_mean_rank_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_mean_rank_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_method);
  Py_VISIT(traverse_module_state->__pyx_n_u_method);
  Py_VISIT(traverse_module_state->__pyx_n_s_metric);
  Py_VISIT(traverse_module_state->__pyx_n_u_micro);
  Py_VISIT(traverse_module_state->__pyx_n_s_micro_sensitivity);
  Py_VISIT(traverse_module_state->__pyx_n_s_micro_specificity);
  Py_VISIT(traverse_module_state->__pyx_n_s_min);
  Py_VISIT(traverse_module_state->__pyx_n_u_min);
  Py_VISIT(traverse_module_state->__pyx_n_s_min_cost);
  Py_VISIT(traverse_module_state->__pyx_n_s_min_non_zero_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_minimum);
  Py_VISIT(traverse_module_state->__pyx_n_s_minmax_scaler);
  Py_VISIT(traverse_module_state->__pyx_n_u_minmax_scaler);
  Py_VISIT(traverse_module_state->__pyx_kp_u_minmax_scaler_line_2947);
  Py_VISIT(traverse_module_state->__pyx_n_u_mirror);
  Py_VISIT(traverse_module_state->__pyx_n_s_mode);
  Py_VISIT(traverse_module_state->__pyx_kp_u_mode_must_be_mirror_constant_nea);
  Py_VISIT(traverse_module_state->__pyx_n_s_model_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_model_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_moving_average);
  Py_VISIT(traverse_module_state->__pyx_kp_u_moving_average_line_3046);
  Py_VISIT(traverse_module_state->__pyx_n_s_msg);
  Py_VISIT(traverse_module_state->__pyx_n_s_msg_meth);
  Py_VISIT(traverse_module_state->__pyx_n_s_mu0);
  Py_VISIT(traverse_module_state->__pyx_n_s_multi_output);
  Py_VISIT(traverse_module_state->__pyx_n_u_multiclass);
  Py_VISIT(traverse_module_state->__pyx_n_s_multioutput);
  Py_VISIT(traverse_module_state->__pyx_n_s_n);
  Py_VISIT(traverse_module_state->__pyx_n_s_n_epochs);
  Py_VISIT(traverse_module_state->__pyx_n_s_n_estimators);
  Py_VISIT(traverse_module_state->__pyx_n_s_name);
  Py_VISIT(traverse_module_state->__pyx_n_s_name_2);
  Py_VISIT(traverse_module_state->__pyx_n_u_name_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_nan);
  Py_VISIT(traverse_module_state->__pyx_n_s_nan_policy);
  Py_VISIT(traverse_module_state->__pyx_n_s_nan_sum);
  Py_VISIT(traverse_module_state->__pyx_n_s_nansum);
  Py_VISIT(traverse_module_state->__pyx_n_s_ndarray);
  Py_VISIT(traverse_module_state->__pyx_n_s_ndim);
  Py_VISIT(traverse_module_state->__pyx_n_u_nearest);
  Py_VISIT(traverse_module_state->__pyx_n_u_negative);
  Py_VISIT(traverse_module_state->__pyx_n_s_newaxis);
  Py_VISIT(traverse_module_state->__pyx_kp_u_no_of_items_in_clust);
  Py_VISIT(traverse_module_state->__pyx_n_s_noise);
  Py_VISIT(traverse_module_state->__pyx_n_u_none);
  Py_VISIT(traverse_module_state->__pyx_n_s_nonzero);
  Py_VISIT(traverse_module_state->__pyx_n_s_norm);
  Py_VISIT(traverse_module_state->__pyx_n_s_normalize);
  Py_VISIT(traverse_module_state->__pyx_n_u_normalize);
  Py_VISIT(traverse_module_state->__pyx_kp_u_normalize_line_2997);
  Py_VISIT(traverse_module_state->__pyx_n_s_normalize_string);
  Py_VISIT(traverse_module_state->__pyx_n_s_northing);
  Py_VISIT(traverse_module_state->__pyx_kp_u_not_found_in);
  Py_VISIT(traverse_module_state->__pyx_kp_u_not_found_in_DataFrame_columns);
  Py_VISIT(traverse_module_state->__pyx_n_s_np);
  Py_VISIT(traverse_module_state->__pyx_n_s_number);
  Py_VISIT(traverse_module_state->__pyx_n_s_numeric_cols);
  Py_VISIT(traverse_module_state->__pyx_n_s_numpy);
  Py_VISIT(traverse_module_state->__pyx_n_u_o);
  Py_VISIT(traverse_module_state->__pyx_kp_u_ob);
  Py_VISIT(traverse_module_state->__pyx_n_s_objname);
  Py_VISIT(traverse_module_state->__pyx_kp_u_ok);
  Py_VISIT(traverse_module_state->__pyx_n_u_ok_2);
  Py_VISIT(traverse_module_state->__pyx_n_u_omit);
  Py_VISIT(traverse_module_state->__pyx_n_s_ones);
  Py_VISIT(traverse_module_state->__pyx_n_s_ones_like);
  Py_VISIT(traverse_module_state->__pyx_n_s_optimal_bins);
  Py_VISIT(traverse_module_state->__pyx_n_s_optimal_idx);
  Py_VISIT(traverse_module_state->__pyx_n_s_optimal_ordering);
  Py_VISIT(traverse_module_state->__pyx_n_s_optimal_threshold);
  Py_VISIT(traverse_module_state->__pyx_n_s_optimal_youden);
  Py_VISIT(traverse_module_state->__pyx_n_s_optimized_spearmanr);
  Py_VISIT(traverse_module_state->__pyx_n_u_optimized_spearmanr);
  Py_VISIT(traverse_module_state->__pyx_kp_u_optimized_spearmanr_line_1351);
  Py_VISIT(traverse_module_state->__pyx_n_u_or);
  Py_VISIT(traverse_module_state->__pyx_kp_u_or_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_order);
  Py_VISIT(traverse_module_state->__pyx_n_u_ordinal);
  Py_VISIT(traverse_module_state->__pyx_n_u_ovo);
  Py_VISIT(traverse_module_state->__pyx_n_u_ovr);
  Py_VISIT(traverse_module_state->__pyx_n_s_p);
  Py_VISIT(traverse_module_state->__pyx_n_s_p_value);
  Py_VISIT(traverse_module_state->__pyx_n_s_p_values);
  Py_VISIT(traverse_module_state->__pyx_n_s_pair);
  Py_VISIT(traverse_module_state->__pyx_n_s_pair_indices);
  Py_VISIT(traverse_module_state->__pyx_n_s_pairwise_distances);
  Py_VISIT(traverse_module_state->__pyx_n_s_pandas);
  Py_VISIT(traverse_module_state->__pyx_n_s_param_name);
  Py_VISIT(traverse_module_state->__pyx_n_s_parameter_validator);
  Py_VISIT(traverse_module_state->__pyx_n_u_parent);
  Py_VISIT(traverse_module_state->__pyx_n_u_passthrough);
  Py_VISIT(traverse_module_state->__pyx_n_s_pcov);
  Py_VISIT(traverse_module_state->__pyx_n_s_pd);
  Py_VISIT(traverse_module_state->__pyx_n_s_pdist);
  Py_VISIT(traverse_module_state->__pyx_n_u_pearson);
  Py_VISIT(traverse_module_state->__pyx_n_s_pearsonr);
  Py_VISIT(traverse_module_state->__pyx_n_s_percent_events);
  Py_VISIT(traverse_module_state->__pyx_n_s_percent_events_bin);
  Py_VISIT(traverse_module_state->__pyx_n_s_percent_non_events);
  Py_VISIT(traverse_module_state->__pyx_n_s_percent_non_events_bin);
  Py_VISIT(traverse_module_state->__pyx_n_s_percentile);
  Py_VISIT(traverse_module_state->__pyx_n_s_pi);
  Py_VISIT(traverse_module_state->__pyx_n_u_pk);
  Py_VISIT(traverse_module_state->__pyx_n_s_plot);
  Py_VISIT(traverse_module_state->__pyx_n_s_plt);
  Py_VISIT(traverse_module_state->__pyx_n_u_poly);
  Py_VISIT(traverse_module_state->__pyx_n_s_poly_coeffs);
  Py_VISIT(traverse_module_state->__pyx_n_s_polyder);
  Py_VISIT(traverse_module_state->__pyx_n_s_polyfit);
  Py_VISIT(traverse_module_state->__pyx_n_s_polyorder);
  Py_VISIT(traverse_module_state->__pyx_kp_u_polyorder_must_be_less_than_wind);
  Py_VISIT(traverse_module_state->__pyx_n_s_polyval);
  Py_VISIT(traverse_module_state->__pyx_n_s_pop_cat_features);
  Py_VISIT(traverse_module_state->__pyx_n_s_popt);
  Py_VISIT(traverse_module_state->__pyx_n_s_pos);
  Py_VISIT(traverse_module_state->__pyx_n_s_pos_label);
  Py_VISIT(traverse_module_state->__pyx_kp_u_pos_must_be_nonnegative_and_less);
  Py_VISIT(traverse_module_state->__pyx_kp_u_positions);
  Py_VISIT(traverse_module_state->__pyx_n_u_positive);
  Py_VISIT(traverse_module_state->__pyx_n_s_positive_preds);
  Py_VISIT(traverse_module_state->__pyx_n_s_power);
  Py_VISIT(traverse_module_state->__pyx_n_s_predict);
  Py_VISIT(traverse_module_state->__pyx_n_s_predict_proba);
  Py_VISIT(traverse_module_state->__pyx_n_s_predicted);
  Py_VISIT(traverse_module_state->__pyx_n_s_predicted_labels);
  Py_VISIT(traverse_module_state->__pyx_n_s_prev_val);
  Py_VISIT(traverse_module_state->__pyx_n_s_print);
  Py_VISIT(traverse_module_state->__pyx_n_s_prob_true_class);
  Py_VISIT(traverse_module_state->__pyx_n_s_profile1);
  Py_VISIT(traverse_module_state->__pyx_n_s_profile2);
  Py_VISIT(traverse_module_state->__pyx_n_s_profile_angle);
  Py_VISIT(traverse_module_state->__pyx_n_s_profile_line);
  Py_VISIT(traverse_module_state->__pyx_n_s_projection);
  Py_VISIT(traverse_module_state->__pyx_n_u_propagate);
  Py_VISIT(traverse_module_state->__pyx_n_s_pyplot);
  Py_VISIT(traverse_module_state->__pyx_n_s_quadratic_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_quadratic_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_quality_control2);
  Py_VISIT(traverse_module_state->__pyx_kp_u_quality_control2_line_4409);
  Py_VISIT(traverse_module_state->__pyx_kp_u_r);
  Py_VISIT(traverse_module_state->__pyx_n_s_rad2deg);
  Py_VISIT(traverse_module_state->__pyx_n_u_raise);
  Py_VISIT(traverse_module_state->__pyx_n_s_raise_exception);
  Py_VISIT(traverse_module_state->__pyx_n_s_raise_warn);
  Py_VISIT(traverse_module_state->__pyx_n_u_raises);
  Py_VISIT(traverse_module_state->__pyx_n_s_randn);
  Py_VISIT(traverse_module_state->__pyx_n_s_random);
  Py_VISIT(traverse_module_state->__pyx_n_s_range);
  Py_VISIT(traverse_module_state->__pyx_n_s_rank_data);
  Py_VISIT(traverse_module_state->__pyx_n_u_rank_data);
  Py_VISIT(traverse_module_state->__pyx_kp_u_rank_data_line_1263);
  Py_VISIT(traverse_module_state->__pyx_n_s_rankdata);
  Py_VISIT(traverse_module_state->__pyx_n_s_ranks);
  Py_VISIT(traverse_module_state->__pyx_n_s_ranks_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_ranks_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_rate);
  Py_VISIT(traverse_module_state->__pyx_n_s_ravel);
  Py_VISIT(traverse_module_state->__pyx_kp_u_raw_azimuth);
  Py_VISIT(traverse_module_state->__pyx_n_u_raw_values);
  Py_VISIT(traverse_module_state->__pyx_n_s_refglossary);
  Py_VISIT(traverse_module_state->__pyx_n_u_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_reject);
  Py_VISIT(traverse_module_state->__pyx_n_s_relevant_mask);
  Py_VISIT(traverse_module_state->__pyx_n_s_rem);
  Py_VISIT(traverse_module_state->__pyx_n_s_replace);
  Py_VISIT(traverse_module_state->__pyx_n_s_reset_index);
  Py_VISIT(traverse_module_state->__pyx_n_s_reshape);
  Py_VISIT(traverse_module_state->__pyx_n_s_residual);
  Py_VISIT(traverse_module_state->__pyx_n_s_residuals);
  Py_VISIT(traverse_module_state->__pyx_n_s_residuals_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_residuals_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_result);
  Py_VISIT(traverse_module_state->__pyx_n_s_results);
  Py_VISIT(traverse_module_state->__pyx_n_s_return);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_confidence);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_counts);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_data);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_mean_dist);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_qco);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_target_only);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_weighted_rank);
  Py_VISIT(traverse_module_state->__pyx_n_s_return_ymxs);
  Py_VISIT(traverse_module_state->__pyx_n_s_reverse);
  Py_VISIT(traverse_module_state->__pyx_n_s_rho);
  Py_VISIT(traverse_module_state->__pyx_n_s_rng);
  Py_VISIT(traverse_module_state->__pyx_n_u_robust);
  Py_VISIT(traverse_module_state->__pyx_n_s_roc_auc_score);
  Py_VISIT(traverse_module_state->__pyx_n_s_roc_curve);
  Py_VISIT(traverse_module_state->__pyx_n_s_row);
  Py_VISIT(traverse_module_state->__pyx_n_s_row_clusters);
  Py_VISIT(traverse_module_state->__pyx_n_s_row_dist);
  Py_VISIT(traverse_module_state->__pyx_kp_u_row_label_1);
  Py_VISIT(traverse_module_state->__pyx_kp_u_row_lable_2);
  Py_VISIT(traverse_module_state->__pyx_n_s_rr);
  Py_VISIT(traverse_module_state->__pyx_n_s_s);
  Py_VISIT(traverse_module_state->__pyx_n_u_s);
  Py_VISIT(traverse_module_state->__pyx_n_s_s_index);
  Py_VISIT(traverse_module_state->__pyx_n_u_same);
  Py_VISIT(traverse_module_state->__pyx_n_s_sample_weight);
  Py_VISIT(traverse_module_state->__pyx_n_s_savgol_coeffs);
  Py_VISIT(traverse_module_state->__pyx_kp_u_savgol_coeffs_line_3949);
  Py_VISIT(traverse_module_state->__pyx_n_s_savgol_filter);
  Py_VISIT(traverse_module_state->__pyx_n_u_savgol_filter);
  Py_VISIT(traverse_module_state->__pyx_kp_u_savgol_filter_line_4159);
  Py_VISIT(traverse_module_state->__pyx_n_s_scalePosition);
  Py_VISIT(traverse_module_state->__pyx_kp_u_scalePosition_line_3596);
  Py_VISIT(traverse_module_state->__pyx_n_s_scalePosition_locals_lambda);
  Py_VISIT(traverse_module_state->__pyx_n_s_scalePosition_locals_linfunc);
  Py_VISIT(traverse_module_state->__pyx_n_s_scale_factor);
  Py_VISIT(traverse_module_state->__pyx_n_s_scale_positions);
  Py_VISIT(traverse_module_state->__pyx_kp_u_scale_positions_line_4567);
  Py_VISIT(traverse_module_state->__pyx_n_u_scaled);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy__lib__util);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_cluster_hierarchy);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_linalg);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_ndimage);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_optimize);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_signal);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_spatial_distance);
  Py_VISIT(traverse_module_state->__pyx_n_s_scipy_stats);
  Py_VISIT(traverse_module_state->__pyx_n_s_score);
  Py_VISIT(traverse_module_state->__pyx_n_s_scores);
  Py_VISIT(traverse_module_state->__pyx_n_u_se);
  Py_VISIT(traverse_module_state->__pyx_n_s_seen);
  Py_VISIT(traverse_module_state->__pyx_n_s_select_dtypes);
  Py_VISIT(traverse_module_state->__pyx_n_s_send);
  Py_VISIT(traverse_module_state->__pyx_n_s_sens_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_sensitivities);
  Py_VISIT(traverse_module_state->__pyx_n_s_sensitivity);
  Py_VISIT(traverse_module_state->__pyx_n_s_set_xlabel);
  Py_VISIT(traverse_module_state->__pyx_n_s_set_ylabel);
  Py_VISIT(traverse_module_state->__pyx_n_s_shape);
  Py_VISIT(traverse_module_state->__pyx_n_s_shift);
  Py_VISIT(traverse_module_state->__pyx_n_u_shifted);
  Py_VISIT(traverse_module_state->__pyx_kp_u_should_be_less_than_the_number);
  Py_VISIT(traverse_module_state->__pyx_n_s_show);
  Py_VISIT(traverse_module_state->__pyx_n_s_shp);
  Py_VISIT(traverse_module_state->__pyx_n_s_significance_threshold);
  Py_VISIT(traverse_module_state->__pyx_n_s_similarities);
  Py_VISIT(traverse_module_state->__pyx_n_s_similarity);
  Py_VISIT(traverse_module_state->__pyx_n_u_simple);
  Py_VISIT(traverse_module_state->__pyx_kp_u_simple_moving_average);
  Py_VISIT(traverse_module_state->__pyx_n_s_simplefilter);
  Py_VISIT(traverse_module_state->__pyx_n_s_sin);
  Py_VISIT(traverse_module_state->__pyx_n_s_sinusoidal_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_sinusoidal_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_site);
  Py_VISIT(traverse_module_state->__pyx_n_s_size);
  Py_VISIT(traverse_module_state->__pyx_n_s_sklearn_linear_model);
  Py_VISIT(traverse_module_state->__pyx_n_s_sklearn_metrics);
  Py_VISIT(traverse_module_state->__pyx_n_s_sklearn_preprocessing);
  Py_VISIT(traverse_module_state->__pyx_n_s_sklearn_utils_multiclass);
  Py_VISIT(traverse_module_state->__pyx_n_u_sma);
  Py_VISIT(traverse_module_state->__pyx_n_s_smart_format);
  Py_VISIT(traverse_module_state->__pyx_n_u_soft);
  Py_VISIT(traverse_module_state->__pyx_n_s_sorted_data);
  Py_VISIT(traverse_module_state->__pyx_n_s_sorted_indices);
  Py_VISIT(traverse_module_state->__pyx_n_s_sorter);
  Py_VISIT(traverse_module_state->__pyx_n_u_source);
  Py_VISIT(traverse_module_state->__pyx_n_s_source_col);
  Py_VISIT(traverse_module_state->__pyx_n_s_sources);
  Py_VISIT(traverse_module_state->__pyx_n_u_spearman);
  Py_VISIT(traverse_module_state->__pyx_n_s_spearman_corr);
  Py_VISIT(traverse_module_state->__pyx_n_s_spearmanr);
  Py_VISIT(traverse_module_state->__pyx_n_s_spec);
  Py_VISIT(traverse_module_state->__pyx_n_s_spec_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_specific_y_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_specific_y_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_specificities);
  Py_VISIT(traverse_module_state->__pyx_n_s_specificity);
  Py_VISIT(traverse_module_state->__pyx_n_s_spstats);
  Py_VISIT(traverse_module_state->__pyx_n_s_sqrt);
  Py_VISIT(traverse_module_state->__pyx_n_u_sqrt);
  Py_VISIT(traverse_module_state->__pyx_n_s_squareform);
  Py_VISIT(traverse_module_state->__pyx_n_u_squareform);
  Py_VISIT(traverse_module_state->__pyx_n_s_squeeze);
  Py_VISIT(traverse_module_state->__pyx_n_s_standard_scaler);
  Py_VISIT(traverse_module_state->__pyx_n_u_standard_scaler);
  Py_VISIT(traverse_module_state->__pyx_kp_u_standard_scaler_line_2896);
  Py_VISIT(traverse_module_state->__pyx_n_s_star_mxs);
  Py_VISIT(traverse_module_state->__pyx_n_s_start);
  Py_VISIT(traverse_module_state->__pyx_n_s_state);
  Py_VISIT(traverse_module_state->__pyx_n_s_stats);
  Py_VISIT(traverse_module_state->__pyx_n_s_std);
  Py_VISIT(traverse_module_state->__pyx_n_u_std);
  Py_VISIT(traverse_module_state->__pyx_n_s_std_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_std_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_step);
  Py_VISIT(traverse_module_state->__pyx_n_s_step_function);
  Py_VISIT(traverse_module_state->__pyx_n_s_step_regression);
  Py_VISIT(traverse_module_state->__pyx_n_u_step_regression);
  Py_VISIT(traverse_module_state->__pyx_n_s_step_regression_locals_lambda);
  Py_VISIT(traverse_module_state->__pyx_n_s_stop);
  Py_VISIT(traverse_module_state->__pyx_n_s_str);
  Py_VISIT(traverse_module_state->__pyx_n_s_strategy);
  Py_VISIT(traverse_module_state->__pyx_n_u_strategy);
  Py_VISIT(traverse_module_state->__pyx_n_u_strict);
  Py_VISIT(traverse_module_state->__pyx_n_s_strip);
  Py_VISIT(traverse_module_state->__pyx_n_s_stump);
  Py_VISIT(traverse_module_state->__pyx_n_u_sturges);
  Py_VISIT(traverse_module_state->__pyx_n_s_subplots);
  Py_VISIT(traverse_module_state->__pyx_n_s_subset);
  Py_VISIT(traverse_module_state->__pyx_n_s_subtract);
  Py_VISIT(traverse_module_state->__pyx_n_s_sum);
  Py_VISIT(traverse_module_state->__pyx_n_s_sunburst_data);
  Py_VISIT(traverse_module_state->__pyx_n_s_support);
  Py_VISIT(traverse_module_state->__pyx_n_s_swapaxes);
  Py_VISIT(traverse_module_state->__pyx_n_s_swapped);
  Py_VISIT(traverse_module_state->__pyx_n_u_ta);
  Py_VISIT(traverse_module_state->__pyx_n_u_target);
  Py_VISIT(traverse_module_state->__pyx_n_s_target_col);
  Py_VISIT(traverse_module_state->__pyx_n_s_target_strs);
  Py_VISIT(traverse_module_state->__pyx_n_s_targets);
  Py_VISIT(traverse_module_state->__pyx_n_s_task_type);
  Py_VISIT(traverse_module_state->__pyx_n_s_test);
  Py_VISIT(traverse_module_state->__pyx_n_s_threshold);
  Py_VISIT(traverse_module_state->__pyx_n_s_thresholds);
  Py_VISIT(traverse_module_state->__pyx_n_s_throw);
  Py_VISIT(traverse_module_state->__pyx_n_s_tie_method);
  Py_VISIT(traverse_module_state->__pyx_n_s_title);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_array);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_deg);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_frame);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_latlon_in);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_log10);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_numeric_dtypes);
  Py_VISIT(traverse_module_state->__pyx_n_s_to_utm_in);
  Py_VISIT(traverse_module_state->__pyx_n_s_tol);
  Py_VISIT(traverse_module_state->__pyx_n_u_tolerance);
  Py_VISIT(traverse_module_state->__pyx_n_s_tolist);
  Py_VISIT(traverse_module_state->__pyx_n_s_torres_verdin_filter);
  Py_VISIT(traverse_module_state->__pyx_kp_u_torres_verdin_filter_line_4997);
  Py_VISIT(traverse_module_state->__pyx_n_s_torres_verdin_filter_locals__fil);
  Py_VISIT(traverse_module_state->__pyx_n_s_total);
  Py_VISIT(traverse_module_state->__pyx_n_s_total_FN);
  Py_VISIT(traverse_module_state->__pyx_n_s_total_FP);
  Py_VISIT(traverse_module_state->__pyx_n_s_total_TN);
  Py_VISIT(traverse_module_state->__pyx_n_s_total_TP);
  Py_VISIT(traverse_module_state->__pyx_n_s_total_cost);
  Py_VISIT(traverse_module_state->__pyx_n_s_total_weight);
  Py_VISIT(traverse_module_state->__pyx_n_s_tpr);
  Py_VISIT(traverse_module_state->__pyx_n_s_trailer);
  Py_VISIT(traverse_module_state->__pyx_kp_u_trailer_must_be_a_non_numeric_st);
  Py_VISIT(traverse_module_state->__pyx_n_s_transform);
  Py_VISIT(traverse_module_state->__pyx_n_s_true_negatives);
  Py_VISIT(traverse_module_state->__pyx_n_s_true_positives);
  Py_VISIT(traverse_module_state->__pyx_n_s_type_of_target);
  Py_VISIT(traverse_module_state->__pyx_n_u_uniform_average);
  Py_VISIT(traverse_module_state->__pyx_n_s_unique);
  Py_VISIT(traverse_module_state->__pyx_n_s_unique_labels);
  Py_VISIT(traverse_module_state->__pyx_n_s_unit);
  Py_VISIT(traverse_module_state->__pyx_n_s_use);
  Py_VISIT(traverse_module_state->__pyx_n_s_use_average_dist);
  Py_VISIT(traverse_module_state->__pyx_kp_u_use_lower_bound);
  Py_VISIT(traverse_module_state->__pyx_kp_u_use_must_be_conv_or_dot);
  Py_VISIT(traverse_module_state->__pyx_n_u_utm);
  Py_VISIT(traverse_module_state->__pyx_n_s_utm_zone);
  Py_VISIT(traverse_module_state->__pyx_kp_u_utm_zone_cannot_be_None_when_pro);
  Py_VISIT(traverse_module_state->__pyx_n_s_v);
  Py_VISIT(traverse_module_state->__pyx_n_s_valid_mask);
  Py_VISIT(traverse_module_state->__pyx_n_s_valid_methods);
  Py_VISIT(traverse_module_state->__pyx_n_s_valid_policies);
  Py_VISIT(traverse_module_state->__pyx_n_s_validate_length_range);
  Py_VISIT(traverse_module_state->__pyx_n_s_validate_multiclass_target);
  Py_VISIT(traverse_module_state->__pyx_n_s_validate_multioutput);
  Py_VISIT(traverse_module_state->__pyx_n_s_validate_name_in);
  Py_VISIT(traverse_module_state->__pyx_n_s_validate_sample_weights);
  Py_VISIT(traverse_module_state->__pyx_n_s_validate_scores);
  Py_VISIT(traverse_module_state->__pyx_n_s_validator);
  Py_VISIT(traverse_module_state->__pyx_n_s_value);
  Py_VISIT(traverse_module_state->__pyx_n_u_value);
  Py_VISIT(traverse_module_state->__pyx_n_s_value_col);
  Py_VISIT(traverse_module_state->__pyx_n_s_value_column);
  Py_VISIT(traverse_module_state->__pyx_n_s_values);
  Py_VISIT(traverse_module_state->__pyx_n_u_values);
  Py_VISIT(traverse_module_state->__pyx_n_s_var);
  Py_VISIT(traverse_module_state->__pyx_n_s_var_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_var_true);
  Py_VISIT(traverse_module_state->__pyx_n_s_vectorize);
  Py_VISIT(traverse_module_state->__pyx_n_s_view);
  Py_VISIT(traverse_module_state->__pyx_n_s_vstack);
  Py_VISIT(traverse_module_state->__pyx_n_s_w);
  Py_VISIT(traverse_module_state->__pyx_n_s_warn);
  Py_VISIT(traverse_module_state->__pyx_n_s_warnings);
  Py_VISIT(traverse_module_state->__pyx_n_u_weight);
  Py_VISIT(traverse_module_state->__pyx_n_s_weight_factor);
  Py_VISIT(traverse_module_state->__pyx_n_u_weighted);
  Py_VISIT(traverse_module_state->__pyx_kp_u_weighted_moving_average);
  Py_VISIT(traverse_module_state->__pyx_n_s_weighted_rank);
  Py_VISIT(traverse_module_state->__pyx_n_s_weighted_spearman_corr);
  Py_VISIT(traverse_module_state->__pyx_n_s_weighted_spearman_rank);
  Py_VISIT(traverse_module_state->__pyx_n_u_weighted_spearman_rank);
  Py_VISIT(traverse_module_state->__pyx_kp_u_weighted_spearman_rank_line_1795);
  Py_VISIT(traverse_module_state->__pyx_n_s_weighted_spearman_rank_locals_we);
  Py_VISIT(traverse_module_state->__pyx_n_s_weights);
  Py_VISIT(traverse_module_state->__pyx_n_s_wf);
  Py_VISIT(traverse_module_state->__pyx_n_s_where);
  Py_VISIT(traverse_module_state->__pyx_n_s_window_length);
  Py_VISIT(traverse_module_state->__pyx_kp_u_window_length_must_be_odd);
  Py_VISIT(traverse_module_state->__pyx_n_s_window_size);
  Py_VISIT(traverse_module_state->__pyx_n_s_window_size_factor);
  Py_VISIT(traverse_module_state->__pyx_kp_u_window_size_has_to_be_of_type_in);
  Py_VISIT(traverse_module_state->__pyx_kp_u_window_size_is_too_large_for_ave);
  Py_VISIT(traverse_module_state->__pyx_kp_u_window_size_size_must_be_a_posit);
  Py_VISIT(traverse_module_state->__pyx_n_s_window_start);
  Py_VISIT(traverse_module_state->__pyx_n_s_window_stop);
  Py_VISIT(traverse_module_state->__pyx_n_u_wma);
  Py_VISIT(traverse_module_state->__pyx_n_u_wrap);
  Py_VISIT(traverse_module_state->__pyx_n_s_x);
  Py_VISIT(traverse_module_state->__pyx_n_u_x);
  Py_VISIT(traverse_module_state->__pyx_kp_u_x_and_y_arrays_must_have_the_sa);
  Py_VISIT(traverse_module_state->__pyx_n_s_x_edge);
  Py_VISIT(traverse_module_state->__pyx_kp_u_x_y_are_not_in_longitude_latitud);
  Py_VISIT(traverse_module_state->__pyx_n_s_xdata);
  Py_VISIT(traverse_module_state->__pyx_n_s_xlabel);
  Py_VISIT(traverse_module_state->__pyx_n_s_xlon);
  Py_VISIT(traverse_module_state->__pyx_kp_u_xlon_and_ylat_arguments_are_grea);
  Py_VISIT(traverse_module_state->__pyx_n_s_xs);
  Py_VISIT(traverse_module_state->__pyx_n_s_xx);
  Py_VISIT(traverse_module_state->__pyx_n_s_xx_edge);
  Py_VISIT(traverse_module_state->__pyx_n_s_y);
  Py_VISIT(traverse_module_state->__pyx_n_u_y);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_bin);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_edge);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_max);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_mean);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_min);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_norm);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_normalized);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_numeric);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_pred);
  Py_VISIT(traverse_module_state->__pyx_n_u_y_pred);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_pred_binary);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_pred_indices);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_pred_pair);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_scaled);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_scores);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_std);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_true);
  Py_VISIT(traverse_module_state->__pyx_n_u_y_true);
  Py_VISIT(traverse_module_state->__pyx_kp_u_y_true_and_y_pred_must_contain_n);
  Py_VISIT(traverse_module_state->__pyx_kp_u_y_true_and_y_pred_should_be_1_di);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_true_binarized);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_true_binary);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_true_encoded);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_true_indices);
  Py_VISIT(traverse_module_state->__pyx_n_s_y_true_pair);
  Py_VISIT(traverse_module_state->__pyx_n_s_ya);
  Py_VISIT(traverse_module_state->__pyx_n_s_ydata);
  Py_VISIT(traverse_module_state->__pyx_n_u_ydata);
  Py_VISIT(traverse_module_state->__pyx_n_s_ydata_new);
  Py_VISIT(traverse_module_state->__pyx_n_s_yield);
  Py_VISIT(traverse_module_state->__pyx_n_s_ylabel);
  Py_VISIT(traverse_module_state->__pyx_n_s_ylat);
  Py_VISIT(traverse_module_state->__pyx_n_s_ymxs);
  Py_VISIT(traverse_module_state->__pyx_n_s_youdens_index);
  Py_VISIT(traverse_module_state->__pyx_n_s_ys);
  Py_VISIT(traverse_module_state->__pyx_n_s_yt);
  Py_VISIT(traverse_module_state->__pyx_kp_u_yt_should_not_contain_NaN_values);
  Py_VISIT(traverse_module_state->__pyx_n_s_yt_transformed);
  Py_VISIT(traverse_module_state->__pyx_n_s_yy);
  Py_VISIT(traverse_module_state->__pyx_n_s_z);
  Py_VISIT(traverse_module_state->__pyx_n_s_zero_division);
  Py_VISIT(traverse_module_state->__pyx_n_s_zeros);
  Py_VISIT(traverse_module_state->__pyx_n_s_zeros_like);
  Py_VISIT(traverse_module_state->__pyx_n_s_zip);
  Py_VISIT(traverse_module_state->__pyx_float__5);
  Py_VISIT(traverse_module_state->__pyx_float_0_);
  Py_VISIT(traverse_module_state->__pyx_float_1_);
  Py_VISIT(traverse_module_state->__pyx_float_0_0);
  Py_VISIT(traverse_module_state->__pyx_float_0_1);
  Py_VISIT(traverse_module_state->__pyx_float_0_5);
  Py_VISIT(traverse_module_state->__pyx_float_1_0);
  Py_VISIT(traverse_module_state->__pyx_float_1e1);
  Py_VISIT(traverse_module_state->__pyx_float_90_);
  Py_VISIT(traverse_module_state->__pyx_float_1_96);
  Py_VISIT(traverse_module_state->__pyx_float_100_);
  Py_VISIT(traverse_module_state->__pyx_float_180_);
  Py_VISIT(traverse_module_state->__pyx_float_1eneg_2);
  Py_VISIT(traverse_module_state->__pyx_float_1eneg_5);
  Py_VISIT(traverse_module_state->__pyx_float_1eneg_7);
  Py_VISIT(traverse_module_state->__pyx_float_1eneg_10);
  Py_VISIT(traverse_module_state->__pyx_float_1eneg_15);
  Py_VISIT(traverse_module_state->__pyx_int_0);
  Py_VISIT(traverse_module_state->__pyx_int_1);
  Py_VISIT(traverse_module_state->__pyx_int_2);
  Py_VISIT(traverse_module_state->__pyx_int_3);
  Py_VISIT(traverse_module_state->__pyx_int_4);
  Py_VISIT(traverse_module_state->__pyx_int_10);
  Py_VISIT(traverse_module_state->__pyx_int_25);
  Py_VISIT(traverse_module_state->__pyx_int_75);
  Py_VISIT(traverse_module_state->__pyx_int_90);
  Py_VISIT(traverse_module_state->__pyx_int_100);
  Py_VISIT(traverse_module_state->__pyx_int_180);
  Py_VISIT(traverse_module_state->__pyx_int_360);
  Py_VISIT(traverse_module_state->__pyx_int_neg_1);
  Py_VISIT(traverse_module_state->__pyx_codeobj_);
  Py_VISIT(traverse_module_state->__pyx_slice__9);
  Py_VISIT(traverse_module_state->__pyx_tuple__3);
  Py_VISIT(traverse_module_state->__pyx_tuple__4);
  Py_VISIT(traverse_module_state->__pyx_tuple__5);
  Py_VISIT(traverse_module_state->__pyx_tuple__7);
  Py_VISIT(traverse_module_state->__pyx_slice__16);
  Py_VISIT(traverse_module_state->__pyx_slice__69);
  Py_VISIT(traverse_module_state->__pyx_tuple__10);
  Py_VISIT(traverse_module_state->__pyx_tuple__11);
  Py_VISIT(traverse_module_state->__pyx_tuple__12);
  Py_VISIT(traverse_module_state->__pyx_tuple__13);
  Py_VISIT(traverse_module_state->__pyx_tuple__19);
  Py_VISIT(traverse_module_state->__pyx_tuple__21);
  Py_VISIT(traverse_module_state->__pyx_tuple__24);
  Py_VISIT(traverse_module_state->__pyx_tuple__27);
  Py_VISIT(traverse_module_state->__pyx_tuple__34);
  Py_VISIT(traverse_module_state->__pyx_tuple__36);
  Py_VISIT(traverse_module_state->__pyx_tuple__40);
  Py_VISIT(traverse_module_state->__pyx_tuple__41);
  Py_VISIT(traverse_module_state->__pyx_tuple__44);
  Py_VISIT(traverse_module_state->__pyx_tuple__47);
  Py_VISIT(traverse_module_state->__pyx_tuple__48);
  Py_VISIT(traverse_module_state->__pyx_tuple__50);
  Py_VISIT(traverse_module_state->__pyx_tuple__51);
  Py_VISIT(traverse_module_state->__pyx_tuple__52);
  Py_VISIT(traverse_module_state->__pyx_tuple__55);
  Py_VISIT(traverse_module_state->__pyx_tuple__56);
  Py_VISIT(traverse_module_state->__pyx_tuple__57);
  Py_VISIT(traverse_module_state->__pyx_tuple__58);
  Py_VISIT(traverse_module_state->__pyx_tuple__60);
  Py_VISIT(traverse_module_state->__pyx_tuple__61);
  Py_VISIT(traverse_module_state->__pyx_tuple__62);
  Py_VISIT(traverse_module_state->__pyx_tuple__63);
  Py_VISIT(traverse_module_state->__pyx_tuple__67);
  Py_VISIT(traverse_module_state->__pyx_tuple__68);
  Py_VISIT(traverse_module_state->__pyx_tuple__72);
  Py_VISIT(traverse_module_state->__pyx_tuple__73);
  Py_VISIT(traverse_module_state->__pyx_tuple__86);
  Py_VISIT(traverse_module_state->__pyx_tuple__87);
  Py_VISIT(traverse_module_state->__pyx_tuple__89);
  Py_VISIT(traverse_module_state->__pyx_tuple__90);
  Py_VISIT(traverse_module_state->__pyx_tuple__92);
  Py_VISIT(traverse_module_state->__pyx_tuple__94);
  Py_VISIT(traverse_module_state->__pyx_tuple__95);
  Py_VISIT(traverse_module_state->__pyx_tuple__96);
  Py_VISIT(traverse_module_state->__pyx_tuple__99);
  Py_VISIT(traverse_module_state->__pyx_codeobj__6);
  Py_VISIT(traverse_module_state->__pyx_codeobj__8);
  Py_VISIT(traverse_module_state->__pyx_slice__109);
  Py_VISIT(traverse_module_state->__pyx_slice__116);
  Py_VISIT(traverse_module_state->__pyx_slice__123);
  Py_VISIT(traverse_module_state->__pyx_tuple__101);
  Py_VISIT(traverse_module_state->__pyx_tuple__102);
  Py_VISIT(traverse_module_state->__pyx_tuple__104);
  Py_VISIT(traverse_module_state->__pyx_tuple__105);
  Py_VISIT(traverse_module_state->__pyx_tuple__106);
  Py_VISIT(traverse_module_state->__pyx_tuple__111);
  Py_VISIT(traverse_module_state->__pyx_tuple__114);
  Py_VISIT(traverse_module_state->__pyx_tuple__115);
  Py_VISIT(traverse_module_state->__pyx_tuple__118);
  Py_VISIT(traverse_module_state->__pyx_tuple__119);
  Py_VISIT(traverse_module_state->__pyx_tuple__120);
  Py_VISIT(traverse_module_state->__pyx_tuple__121);
  Py_VISIT(traverse_module_state->__pyx_tuple__124);
  Py_VISIT(traverse_module_state->__pyx_tuple__125);
  Py_VISIT(traverse_module_state->__pyx_tuple__129);
  Py_VISIT(traverse_module_state->__pyx_tuple__130);
  Py_VISIT(traverse_module_state->__pyx_tuple__132);
  Py_VISIT(traverse_module_state->__pyx_tuple__133);
  Py_VISIT(traverse_module_state->__pyx_tuple__139);
  Py_VISIT(traverse_module_state->__pyx_tuple__143);
  Py_VISIT(traverse_module_state->__pyx_tuple__147);
  Py_VISIT(traverse_module_state->__pyx_tuple__150);
  Py_VISIT(traverse_module_state->__pyx_tuple__151);
  Py_VISIT(traverse_module_state->__pyx_tuple__152);
  Py_VISIT(traverse_module_state->__pyx_tuple__153);
  Py_VISIT(traverse_module_state->__pyx_tuple__154);
  Py_VISIT(traverse_module_state->__pyx_tuple__155);
  Py_VISIT(traverse_module_state->__pyx_tuple__156);
  Py_VISIT(traverse_module_state->__pyx_tuple__157);
  Py_VISIT(traverse_module_state->__pyx_tuple__158);
  Py_VISIT(traverse_module_state->__pyx_tuple__159);
  Py_VISIT(traverse_module_state->__pyx_tuple__160);
  Py_VISIT(traverse_module_state->__pyx_tuple__161);
  Py_VISIT(traverse_module_state->__pyx_tuple__162);
  Py_VISIT(traverse_module_state->__pyx_tuple__163);
  Py_VISIT(traverse_module_state->__pyx_tuple__164);
  Py_VISIT(traverse_module_state->__pyx_tuple__165);
  Py_VISIT(traverse_module_state->__pyx_tuple__166);
  Py_VISIT(traverse_module_state->__pyx_tuple__167);
  Py_VISIT(traverse_module_state->__pyx_tuple__168);
  Py_VISIT(traverse_module_state->__pyx_tuple__169);
  Py_VISIT(traverse_module_state->__pyx_tuple__170);
  Py_VISIT(traverse_module_state->__pyx_tuple__171);
  Py_VISIT(traverse_module_state->__pyx_tuple__172);
  Py_VISIT(traverse_module_state->__pyx_tuple__173);
  Py_VISIT(traverse_module_state->__pyx_tuple__174);
  Py_VISIT(traverse_module_state->__pyx_tuple__175);
  Py_VISIT(traverse_module_state->__pyx_tuple__176);
  Py_VISIT(traverse_module_state->__pyx_tuple__178);
  Py_VISIT(traverse_module_state->__pyx_tuple__179);
  Py_VISIT(traverse_module_state->__pyx_tuple__180);
  Py_VISIT(traverse_module_state->__pyx_tuple__181);
  Py_VISIT(traverse_module_state->__pyx_tuple__182);
  Py_VISIT(traverse_module_state->__pyx_tuple__183);
  Py_VISIT(traverse_module_state->__pyx_tuple__184);
  Py_VISIT(traverse_module_state->__pyx_tuple__185);
  Py_VISIT(traverse_module_state->__pyx_tuple__186);
  Py_VISIT(traverse_module_state->__pyx_tuple__187);
  Py_VISIT(traverse_module_state->__pyx_tuple__188);
  Py_VISIT(traverse_module_state->__pyx_tuple__189);
  Py_VISIT(traverse_module_state->__pyx_tuple__190);
  Py_VISIT(traverse_module_state->__pyx_tuple__191);
  Py_VISIT(traverse_module_state->__pyx_tuple__192);
  Py_VISIT(traverse_module_state->__pyx_tuple__193);
  Py_VISIT(traverse_module_state->__pyx_tuple__194);
  Py_VISIT(traverse_module_state->__pyx_tuple__195);
  Py_VISIT(traverse_module_state->__pyx_tuple__196);
  Py_VISIT(traverse_module_state->__pyx_tuple__197);
  Py_VISIT(traverse_module_state->__pyx_tuple__198);
  Py_VISIT(traverse_module_state->__pyx_tuple__199);
  Py_VISIT(traverse_module_state->__pyx_tuple__200);
  Py_VISIT(traverse_module_state->__pyx_tuple__201);
  Py_VISIT(traverse_module_state->__pyx_tuple__202);
  Py_VISIT(traverse_module_state->__pyx_tuple__203);
  Py_VISIT(traverse_module_state->__pyx_tuple__204);
  Py_VISIT(traverse_module_state->__pyx_tuple__205);
  Py_VISIT(traverse_module_state->__pyx_tuple__206);
  Py_VISIT(traverse_module_state->__pyx_tuple__207);
  Py_VISIT(traverse_module_state->__pyx_tuple__208);
  Py_VISIT(traverse_module_state->__pyx_tuple__209);
  Py_VISIT(traverse_module_state->__pyx_tuple__210);
  Py_VISIT(traverse_module_state->__pyx_tuple__211);
  Py_VISIT(traverse_module_state->__pyx_tuple__212);
  Py_VISIT(traverse_module_state->__pyx_tuple__213);
  Py_VISIT(traverse_module_state->__pyx_tuple__214);
  Py_VISIT(traverse_module_state->__pyx_tuple__215);
  Py_VISIT(traverse_module_state->__pyx_tuple__216);
  Py_VISIT(traverse_module_state->__pyx_tuple__217);
  Py_VISIT(traverse_module_state->__pyx_tuple__218);
  Py_VISIT(traverse_module_state->__pyx_tuple__219);
  Py_VISIT(traverse_module_state->__pyx_tuple__220);
  Py_VISIT(traverse_module_state->__pyx_tuple__221);
  Py_VISIT(traverse_module_state->__pyx_tuple__222);
  Py_VISIT(traverse_module_state->__pyx_tuple__223);
  Py_VISIT(traverse_module_state->__pyx_tuple__224);
  Py_VISIT(traverse_module_state->__pyx_tuple__225);
  Py_VISIT(traverse_module_state->__pyx_tuple__226);
  Py_VISIT(traverse_module_state->__pyx_tuple__227);
  Py_VISIT(traverse_module_state->__pyx_tuple__228);
  Py_VISIT(traverse_module_state->__pyx_tuple__229);
  Py_VISIT(traverse_module_state->__pyx_tuple__230);
  Py_VISIT(traverse_module_state->__pyx_tuple__231);
  Py_VISIT(traverse_module_state->__pyx_tuple__232);
  Py_VISIT(traverse_module_state->__pyx_tuple__233);
  Py_VISIT(traverse_module_state->__pyx_tuple__234);
  Py_VISIT(traverse_module_state->__pyx_tuple__235);
  Py_VISIT(traverse_module_state->__pyx_tuple__236);
  Py_VISIT(traverse_module_state->__pyx_tuple__237);
  Py_VISIT(traverse_module_state->__pyx_tuple__238);
  Py_VISIT(traverse_module_state->__pyx_tuple__239);
  Py_VISIT(traverse_module_state->__pyx_codeobj__14);
  Py_VISIT(traverse_module_state->__pyx_codeobj__15);
  Py_VISIT(traverse_module_state->__pyx_codeobj__17);
  Py_VISIT(traverse_module_state->__pyx_codeobj__18);
  Py_VISIT(traverse_module_state->__pyx_codeobj__20);
  Py_VISIT(traverse_module_state->__pyx_codeobj__22);
  Py_VISIT(traverse_module_state->__pyx_codeobj__23);
  Py_VISIT(traverse_module_state->__pyx_codeobj__25);
  Py_VISIT(traverse_module_state->__pyx_codeobj__26);
  Py_VISIT(traverse_module_state->__pyx_codeobj__28);
  Py_VISIT(traverse_module_state->__pyx_codeobj__29);
  Py_VISIT(traverse_module_state->__pyx_codeobj__30);
  Py_VISIT(traverse_module_state->__pyx_codeobj__32);
  Py_VISIT(traverse_module_state->__pyx_codeobj__33);
  Py_VISIT(traverse_module_state->__pyx_codeobj__35);
  Py_VISIT(traverse_module_state->__pyx_codeobj__37);
  Py_VISIT(traverse_module_state->__pyx_codeobj__38);
  Py_VISIT(traverse_module_state->__pyx_codeobj__42);
  Py_VISIT(traverse_module_state->__pyx_codeobj__43);
  Py_VISIT(traverse_module_state->__pyx_codeobj__45);
  Py_VISIT(traverse_module_state->__pyx_codeobj__46);
  Py_VISIT(traverse_module_state->__pyx_codeobj__49);
  Py_VISIT(traverse_module_state->__pyx_codeobj__53);
  Py_VISIT(traverse_module_state->__pyx_codeobj__54);
  Py_VISIT(traverse_module_state->__pyx_codeobj__59);
  Py_VISIT(traverse_module_state->__pyx_codeobj__64);
  Py_VISIT(traverse_module_state->__pyx_codeobj__66);
  Py_VISIT(traverse_module_state->__pyx_codeobj__71);
  Py_VISIT(traverse_module_state->__pyx_codeobj__74);
  Py_VISIT(traverse_module_state->__pyx_codeobj__75);
  Py_VISIT(traverse_module_state->__pyx_codeobj__76);
  Py_VISIT(traverse_module_state->__pyx_codeobj__77);
  Py_VISIT(traverse_module_state->__pyx_codeobj__78);
  Py_VISIT(traverse_module_state->__pyx_codeobj__79);
  Py_VISIT(traverse_module_state->__pyx_codeobj__80);
  Py_VISIT(traverse_module_state->__pyx_codeobj__81);
  Py_VISIT(traverse_module_state->__pyx_codeobj__82);
  Py_VISIT(traverse_module_state->__pyx_codeobj__83);
  Py_VISIT(traverse_module_state->__pyx_codeobj__84);
  Py_VISIT(traverse_module_state->__pyx_codeobj__85);
  Py_VISIT(traverse_module_state->__pyx_codeobj__91);
  Py_VISIT(traverse_module_state->__pyx_codeobj__93);
  Py_VISIT(traverse_module_state->__pyx_codeobj__97);
  Py_VISIT(traverse_module_state->__pyx_codeobj__98);
  Py_VISIT(traverse_module_state->__pyx_codeobj__100);
  Py_VISIT(traverse_module_state->__pyx_codeobj__103);
  Py_VISIT(traverse_module_state->__pyx_codeobj__108);
  Py_VISIT(traverse_module_state->__pyx_codeobj__110);
  Py_VISIT(traverse_module_state->__pyx_codeobj__112);
  Py_VISIT(traverse_module_state->__pyx_codeobj__113);
  Py_VISIT(traverse_module_state->__pyx_codeobj__117);
  Py_VISIT(traverse_module_state->__pyx_codeobj__122);
  Py_VISIT(traverse_module_state->__pyx_codeobj__126);
  Py_VISIT(traverse_module_state->__pyx_codeobj__127);
  Py_VISIT(traverse_module_state->__pyx_codeobj__128);
  Py_VISIT(traverse_module_state->__pyx_codeobj__131);
  Py_VISIT(traverse_module_state->__pyx_codeobj__134);
  Py_VISIT(traverse_module_state->__pyx_codeobj__135);
  Py_VISIT(traverse_module_state->__pyx_codeobj__136);
  Py_VISIT(traverse_module_state->__pyx_codeobj__137);
  Py_VISIT(traverse_module_state->__pyx_codeobj__138);
  Py_VISIT(traverse_module_state->__pyx_codeobj__140);
  Py_VISIT(traverse_module_state->__pyx_codeobj__141);
  Py_VISIT(traverse_module_state->__pyx_codeobj__142);
  Py_VISIT(traverse_module_state->__pyx_codeobj__144);
  Py_VISIT(traverse_module_state->__pyx_codeobj__145);
  Py_VISIT(traverse_module_state->__pyx_codeobj__146);
  Py_VISIT(traverse_module_state->__pyx_codeobj__148);
  Py_VISIT(traverse_module_state->__pyx_codeobj__149);
  return 0;
}
#endif
/* #### Code section: module_state_defines ### */
#define __pyx_d __pyx_mstate_global->__pyx_d
#define __pyx_b __pyx_mstate_global->__pyx_b
#define __pyx_cython_runtime __pyx_mstate_global->__pyx_cython_runtime
#define __pyx_empty_tuple __pyx_mstate_global->__pyx_empty_tuple
#define __pyx_empty_bytes __pyx_mstate_global->__pyx_empty_bytes
#define __pyx_empty_unicode __pyx_mstate_global->__pyx_empty_unicode
#ifdef __Pyx_CyFunction_USED
#define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
#endif
#ifdef __Pyx_FusedFunction_USED
#define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
#endif
#ifdef __Pyx_Generator_USED
#define __pyx_GeneratorType __pyx_mstate_global->__pyx_GeneratorType
#endif
#ifdef __Pyx_IterableCoroutine_USED
#define __pyx_IterableCoroutineType __pyx_mstate_global->__pyx_IterableCoroutineType
#endif
#ifdef __Pyx_Coroutine_USED
#define __pyx_CoroutineAwaitType __pyx_mstate_global->__pyx_CoroutineAwaitType
#endif
#ifdef __Pyx_Coroutine_USED
#define __pyx_CoroutineType __pyx_mstate_global->__pyx_CoroutineType
#endif
#if CYTHON_USE_MODULE_STATE
#define __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr __pyx_mstate_global->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr
#define __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth __pyx_mstate_global->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth
#define __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model __pyx_mstate_global->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model
#define __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter __pyx_mstate_global->__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter
#endif
#define __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr __pyx_mstate_global->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr
#define __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth __pyx_mstate_global->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth
#define __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model __pyx_mstate_global->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model
#define __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter __pyx_mstate_global->__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter
#define __pyx_kp_u_0A4CEE __pyx_mstate_global->__pyx_kp_u_0A4CEE
#define __pyx_kp_u_49R __pyx_mstate_global->__pyx_kp_u_49R
#define __pyx_n_s_A __pyx_mstate_global->__pyx_n_s_A
#define __pyx_kp_u_A_moving_average_is_used_with_t __pyx_mstate_global->__pyx_kp_u_A_moving_average_is_used_with_t
#define __pyx_kp_u_A_singleton_array __pyx_mstate_global->__pyx_kp_u_A_singleton_array
#define __pyx_kp_u_Adaptative_moving_average_as_sm __pyx_mstate_global->__pyx_kp_u_Adaptative_moving_average_as_sm
#define __pyx_kp_u_Adjust_y_true_and_y_pred_for_re __pyx_mstate_global->__pyx_kp_u_Adjust_y_true_and_y_pred_for_re
#define __pyx_kp_u_Adjusts_y_true_and_y_pred_for_e __pyx_mstate_global->__pyx_kp_u_Adjusts_y_true_and_y_pred_for_e
#define __pyx_kp_u_Adjusts_y_true_and_y_pred_in_a __pyx_mstate_global->__pyx_kp_u_Adjusts_y_true_and_y_pred_in_a
#define __pyx_n_s_AppendDocReferences __pyx_mstate_global->__pyx_n_s_AppendDocReferences
#define __pyx_kp_u_Apply_a_Savitzky_Golay_filter_t __pyx_mstate_global->__pyx_kp_u_Apply_a_Savitzky_Golay_filter_t
#define __pyx_n_u_Array __pyx_mstate_global->__pyx_n_u_Array
#define __pyx_n_s_ArrayLike __pyx_mstate_global->__pyx_n_s_ArrayLike
#define __pyx_kp_u_Array_dimension_is __pyx_mstate_global->__pyx_kp_u_Array_dimension_is
#define __pyx_kp_u_Assigns_ranks_to_data_handling __pyx_mstate_global->__pyx_kp_u_Assigns_ranks_to_data_handling
#define __pyx_kp_u_Axis_must_be_specified_Otherwis __pyx_mstate_global->__pyx_kp_u_Axis_must_be_specified_Otherwis
#define __pyx_kp_u_Azimuth_computation_expects_at_l __pyx_mstate_global->__pyx_kp_u_Azimuth_computation_expects_at_l
#define __pyx_kp_u_Bins_must_be_auto_or_a_positive __pyx_mstate_global->__pyx_kp_u_Bins_must_be_auto_or_a_positive
#define __pyx_n_s_C_FN __pyx_mstate_global->__pyx_n_s_C_FN
#define __pyx_n_s_C_FP __pyx_mstate_global->__pyx_n_s_C_FP
#define __pyx_kp_u_Calculate_sensitivity_and_speci __pyx_mstate_global->__pyx_kp_u_Calculate_sensitivity_and_speci
#define __pyx_kp_u_Calculate_sensitivity_and_speci_2 __pyx_mstate_global->__pyx_kp_u_Calculate_sensitivity_and_speci_2
#define __pyx_kp_u_Calculate_the_Information_Value __pyx_mstate_global->__pyx_kp_u_Calculate_the_Information_Value
#define __pyx_kp_u_Calculate_the_average_likelihoo __pyx_mstate_global->__pyx_kp_u_Calculate_the_average_likelihoo
#define __pyx_kp_u_Calculate_the_bearing_between_t __pyx_mstate_global->__pyx_kp_u_Calculate_the_bearing_between_t
#define __pyx_kp_u_Calculate_the_likelihood_ratio __pyx_mstate_global->__pyx_kp_u_Calculate_the_likelihood_ratio
#define __pyx_kp_u_Calculate_the_multiclass_likeli __pyx_mstate_global->__pyx_kp_u_Calculate_the_multiclass_likeli
#define __pyx_kp_u_Calculate_the_optimal_number_of __pyx_mstate_global->__pyx_kp_u_Calculate_the_optimal_number_of
#define __pyx_kp_u_Calculate_the_residuals_for_reg __pyx_mstate_global->__pyx_kp_u_Calculate_the_residuals_for_reg
#define __pyx_kp_u_Calculates_histogram_bin_edges __pyx_mstate_global->__pyx_kp_u_Calculates_histogram_bin_edges
#define __pyx_kp_u_Calculates_the_adaptive_moving __pyx_mstate_global->__pyx_kp_u_Calculates_the_adaptive_moving
#define __pyx_kp_u_Check_the_quality_control_in_th __pyx_mstate_global->__pyx_kp_u_Check_the_quality_control_in_th
#define __pyx_kp_u_Compute_Errors_Standard_Deviati __pyx_mstate_global->__pyx_kp_u_Compute_Errors_Standard_Deviati
#define __pyx_kp_u_Compute_Spearman_s_rank_correla __pyx_mstate_global->__pyx_kp_u_Compute_Spearman_s_rank_correla
#define __pyx_kp_u_Compute_Spearman_s_rank_correla_2 __pyx_mstate_global->__pyx_kp_u_Compute_Spearman_s_rank_correla_2
#define __pyx_kp_u_Compute_Youden_s_Index_and_opti __pyx_mstate_global->__pyx_kp_u_Compute_Youden_s_Index_and_opti
#define __pyx_kp_u_Compute_azimuth_from_coordinate __pyx_mstate_global->__pyx_kp_u_Compute_azimuth_from_coordinate
#define __pyx_kp_u_Compute_distance_between_points __pyx_mstate_global->__pyx_kp_u_Compute_distance_between_points
#define __pyx_kp_u_Compute_effort_and_yield_values __pyx_mstate_global->__pyx_kp_u_Compute_effort_and_yield_values
#define __pyx_kp_u_Compute_p_values_for_the_correl __pyx_mstate_global->__pyx_kp_u_Compute_p_values_for_the_correl
#define __pyx_kp_u_Compute_sensitivity_and_specifi __pyx_mstate_global->__pyx_kp_u_Compute_sensitivity_and_specifi
#define __pyx_kp_u_Compute_the_balanced_accuracy_f __pyx_mstate_global->__pyx_kp_u_Compute_the_balanced_accuracy_f
#define __pyx_kp_u_Compute_the_coefficients_for_a_1 __pyx_mstate_global->__pyx_kp_u_Compute_the_coefficients_for_a_1
#define __pyx_kp_u_Compute_the_importance_of_each __pyx_mstate_global->__pyx_kp_u_Compute_the_importance_of_each
#define __pyx_kp_u_Compute_the_similarity_between __pyx_mstate_global->__pyx_kp_u_Compute_the_similarity_between
#define __pyx_kp_u_Compute_threshold_using_a_cost __pyx_mstate_global->__pyx_kp_u_Compute_threshold_using_a_cost
#define __pyx_kp_u_Computes_the_data_structure_req __pyx_mstate_global->__pyx_kp_u_Computes_the_data_structure_req
#define __pyx_kp_u_Consensus_must_be_either_positiv __pyx_mstate_global->__pyx_kp_u_Consensus_must_be_either_positiv
#define __pyx_kp_u_Correct_data_location_or_positi __pyx_mstate_global->__pyx_kp_u_Correct_data_location_or_positi
#define __pyx_kp_u_Correct_the_position_coordinate __pyx_mstate_global->__pyx_kp_u_Correct_the_position_coordinate
#define __pyx_kp_u_Could_not_convert_input_argument __pyx_mstate_global->__pyx_kp_u_Could_not_convert_input_argument
#define __pyx_n_s_Count __pyx_mstate_global->__pyx_n_s_Count
#define __pyx_n_u_Count __pyx_mstate_global->__pyx_n_u_Count
#define __pyx_kp_u_Count_the_number_of_local_minim __pyx_mstate_global->__pyx_kp_u_Count_the_number_of_local_minim
#define __pyx_n_s_DataFrame __pyx_mstate_global->__pyx_n_s_DataFrame
#define __pyx_kp_u_DataFrame_does_not_contain_any_n __pyx_mstate_global->__pyx_kp_u_DataFrame_does_not_contain_any_n
#define __pyx_kp_u_DataFrame_must_have_at_least_thr __pyx_mstate_global->__pyx_kp_u_DataFrame_must_have_at_least_thr
#define __pyx_kp_u_Dataframe_is_given_The_c_order_a __pyx_mstate_global->__pyx_kp_u_Dataframe_is_given_The_c_order_a
#define __pyx_n_s_DecisionStumpRegressor __pyx_mstate_global->__pyx_n_s_DecisionStumpRegressor
#define __pyx_kp_u_Degree_is_integer_Got __pyx_mstate_global->__pyx_kp_u_Degree_is_integer_Got
#define __pyx_kp_u_Dependent_variable_depvar_should __pyx_mstate_global->__pyx_kp_u_Dependent_variable_depvar_should
#define __pyx_kp_u_Detect_station_position_and_ret __pyx_mstate_global->__pyx_kp_u_Detect_station_position_and_ret
#define __pyx_n_s_Dict __pyx_mstate_global->__pyx_n_s_Dict
#define __pyx_kp_u_Either_predicted_class_labels_or __pyx_mstate_global->__pyx_kp_u_Either_predicted_class_labels_or
#define __pyx_kp_u_Epsilon_must_be_a_numeric_value __pyx_mstate_global->__pyx_kp_u_Epsilon_must_be_a_numeric_value
#define __pyx_kp_u_Epsilon_value_auto_is_acceptable __pyx_mstate_global->__pyx_kp_u_Epsilon_value_auto_is_acceptable
#define __pyx_kp_u_Expect __pyx_mstate_global->__pyx_kp_u_Expect
#define __pyx_kp_u_Expect_one_dimensional_array_for __pyx_mstate_global->__pyx_kp_u_Expect_one_dimensional_array_for
#define __pyx_kp_u_Expect_squareform_condense_or_d __pyx_mstate_global->__pyx_kp_u_Expect_squareform_condense_or_d
#define __pyx_kp_u_Expected_float_not __pyx_mstate_global->__pyx_kp_u_Expected_float_not
#define __pyx_n_s_F __pyx_mstate_global->__pyx_n_s_F
#define __pyx_n_s_FN __pyx_mstate_global->__pyx_n_s_FN
#define __pyx_n_s_FP __pyx_mstate_global->__pyx_n_s_FP
#define __pyx_n_s_F_m __pyx_mstate_global->__pyx_n_s_F_m
#define __pyx_kp_u_Get_the_closest_value_in_array_f __pyx_mstate_global->__pyx_kp_u_Get_the_closest_value_in_array_f
#define __pyx_kp_u_Got_x_ndim_d __pyx_mstate_global->__pyx_kp_u_Got_x_ndim_d
#define __pyx_kp_u_Gradient_descent_algorithm_to_f __pyx_mstate_global->__pyx_kp_u_Gradient_descent_algorithm_to_f
#define __pyx_n_u_ID __pyx_mstate_global->__pyx_n_u_ID
#define __pyx_kp_u_If_mode_is_interp_window_length __pyx_mstate_global->__pyx_kp_u_If_mode_is_interp_window_length
#define __pyx_kp_u_Implement_a_simple_version_of_G __pyx_mstate_global->__pyx_kp_u_Implement_a_simple_version_of_G
#define __pyx_kp_u_Infers_source_target_and_value __pyx_mstate_global->__pyx_kp_u_Infers_source_target_and_value
#define __pyx_kp_u_Input_data_must_be_a_numpy_array __pyx_mstate_global->__pyx_kp_u_Input_data_must_be_a_numpy_array
#define __pyx_kp_u_Input_data_must_be_a_one_dimensi __pyx_mstate_global->__pyx_kp_u_Input_data_must_be_a_one_dimensi
#define __pyx_kp_u_Input_values_contain_NaNs __pyx_mstate_global->__pyx_kp_u_Input_values_contain_NaNs
#define __pyx_kp_u_Invalid_correlation_method_Suppo __pyx_mstate_global->__pyx_kp_u_Invalid_correlation_method_Suppo
#define __pyx_kp_u_Invalid_method __pyx_mstate_global->__pyx_kp_u_Invalid_method
#define __pyx_kp_u_Invalid_method_specified_Choose __pyx_mstate_global->__pyx_kp_u_Invalid_method_specified_Choose
#define __pyx_kp_u_Invalid_nan_policy __pyx_mstate_global->__pyx_kp_u_Invalid_nan_policy
#define __pyx_n_s_KeyBox __pyx_mstate_global->__pyx_n_s_KeyBox
#define __pyx_n_s_LabelEncoder __pyx_mstate_global->__pyx_n_s_LabelEncoder
#define __pyx_n_s_LinearRegression __pyx_mstate_global->__pyx_n_s_LinearRegression
#define __pyx_n_s_List __pyx_mstate_global->__pyx_n_s_List
#define __pyx_kp_s_List_Dict_str_str __pyx_mstate_global->__pyx_kp_s_List_Dict_str_str
#define __pyx_kp_s_List_str __pyx_mstate_global->__pyx_kp_s_List_str
#define __pyx_n_s_Location __pyx_mstate_global->__pyx_n_s_Location
#define __pyx_kp_u_Location_index_must_be_less_than __pyx_mstate_global->__pyx_kp_u_Location_index_must_be_less_than
#define __pyx_n_s_LogisticRegression __pyx_mstate_global->__pyx_n_s_LogisticRegression
#define __pyx_n_s_N __pyx_mstate_global->__pyx_n_s_N
#define __pyx_n_s_NDArray __pyx_mstate_global->__pyx_n_s_NDArray
#define __pyx_kp_u_Need_to_import_scipy_stats_as_a __pyx_mstate_global->__pyx_kp_u_Need_to_import_scipy_stats_as_a
#define __pyx_kp_u_Non_numerical __pyx_mstate_global->__pyx_kp_u_Non_numerical
#define __pyx_kp_u_None __pyx_mstate_global->__pyx_kp_u_None
#define __pyx_kp_u_NoneType_can_not_be_computed __pyx_mstate_global->__pyx_kp_u_NoneType_can_not_be_computed
#define __pyx_kp_u_Number_of_columns_must_fit_the_s __pyx_mstate_global->__pyx_kp_u_Number_of_columns_must_fit_the_s
#define __pyx_kp_u_Numeric_array_is_expected_for_op __pyx_mstate_global->__pyx_kp_u_Numeric_array_is_expected_for_op
#define __pyx_n_s_Optional __pyx_mstate_global->__pyx_n_s_Optional
#define __pyx_kp_s_Optional_ArrayLike __pyx_mstate_global->__pyx_kp_s_Optional_ArrayLike
#define __pyx_kp_s_Optional_List_str __pyx_mstate_global->__pyx_kp_s_Optional_List_str
#define __pyx_kp_s_Optional_Union_ArrayLike_List_Ar __pyx_mstate_global->__pyx_kp_s_Optional_Union_ArrayLike_List_Ar
#define __pyx_kp_s_Optional_Union_int_str __pyx_mstate_global->__pyx_kp_s_Optional_Union_int_str
#define __pyx_kp_s_Optional_Union_str_list __pyx_mstate_global->__pyx_kp_s_Optional_Union_str_list
#define __pyx_kp_s_Optional__F __pyx_mstate_global->__pyx_kp_s_Optional__F
#define __pyx_kp_s_Optional_str __pyx_mstate_global->__pyx_kp_s_Optional_str
#define __pyx_kp_u_P_value_calculations_expect_nume __pyx_mstate_global->__pyx_kp_u_P_value_calculations_expect_nume
#define __pyx_kp_u_P_values __pyx_mstate_global->__pyx_kp_u_P_values
#define __pyx_kp_u_Polynomial_function_expects_degr __pyx_mstate_global->__pyx_kp_u_Polynomial_function_expects_degr
#define __pyx_kp_u_Position_array_p __pyx_mstate_global->__pyx_kp_u_Position_array_p
#define __pyx_kp_u_Predicted_values_must_be_provide __pyx_mstate_global->__pyx_kp_u_Predicted_values_must_be_provide
#define __pyx_kp_u_Profile_angle_is_0_2f_degrees_E __pyx_mstate_global->__pyx_kp_u_Profile_angle_is_0_2f_degrees_E
#define __pyx_n_s_ResultSummary __pyx_mstate_global->__pyx_n_s_ResultSummary
#define __pyx_n_s_RuntimeWarning __pyx_mstate_global->__pyx_n_s_RuntimeWarning
#define __pyx_n_s_S __pyx_mstate_global->__pyx_n_s_S
#define __pyx_n_s_SP __pyx_mstate_global->__pyx_n_s_SP
#define __pyx_kp_u_Scales_each_feature_to_a_given __pyx_mstate_global->__pyx_kp_u_Scales_each_feature_to_a_given
#define __pyx_kp_u_Scales_features_to_have_zero_me __pyx_mstate_global->__pyx_kp_u_Scales_features_to_have_zero_me
#define __pyx_kp_u_Scales_individual_samples_to_ha __pyx_mstate_global->__pyx_kp_u_Scales_individual_samples_to_ha
#define __pyx_n_s_Series __pyx_mstate_global->__pyx_n_s_Series
#define __pyx_n_s_SiteError __pyx_mstate_global->__pyx_n_s_SiteError
#define __pyx_kp_u_Source_and_Target_columns_must_n __pyx_mstate_global->__pyx_kp_u_Source_and_Target_columns_must_n
#define __pyx_kp_u_Station __pyx_mstate_global->__pyx_kp_u_Station
#define __pyx_kp_u_Step_is_not_given_Average_distan __pyx_mstate_global->__pyx_kp_u_Step_is_not_given_Average_distan
#define __pyx_kp_u_Step_m __pyx_mstate_global->__pyx_kp_u_Step_m
#define __pyx_n_s_T __pyx_mstate_global->__pyx_n_s_T
#define __pyx_n_s_TN __pyx_mstate_global->__pyx_n_s_TN
#define __pyx_n_s_TP __pyx_mstate_global->__pyx_n_s_TP
#define __pyx_kp_u_The_bins_parameter_is_set_to_aut __pyx_mstate_global->__pyx_kp_u_The_bins_parameter_is_set_to_aut
#define __pyx_kp_u_The_first_column_of_the_data_sho __pyx_mstate_global->__pyx_kp_u_The_first_column_of_the_data_sho
#define __pyx_kp_u_The_length_of_predict_proba_does __pyx_mstate_global->__pyx_kp_u_The_length_of_predict_proba_does
#define __pyx_kp_u_The_task_type_must_be_regression __pyx_mstate_global->__pyx_kp_u_The_task_type_must_be_regression
#define __pyx_n_s_Tuple __pyx_mstate_global->__pyx_n_s_Tuple
#define __pyx_kp_s_Tuple_ArrayLike_np_ndarray __pyx_mstate_global->__pyx_kp_s_Tuple_ArrayLike_np_ndarray
#define __pyx_kp_s_Tuple_List_str_List_str_List_int __pyx_mstate_global->__pyx_kp_s_Tuple_List_str_List_str_List_int
#define __pyx_kp_s_Tuple_float_ArrayLike __pyx_mstate_global->__pyx_kp_s_Tuple_float_ArrayLike
#define __pyx_kp_s_Tuple_float_float __pyx_mstate_global->__pyx_kp_s_Tuple_float_float
#define __pyx_kp_s_Tuple_int_float __pyx_mstate_global->__pyx_kp_s_Tuple_int_float
#define __pyx_n_s_TypeError __pyx_mstate_global->__pyx_n_s_TypeError
#define __pyx_n_u_Un __pyx_mstate_global->__pyx_n_u_Un
#define __pyx_kp_u_Unable_to_detect_the_station_pos __pyx_mstate_global->__pyx_kp_u_Unable_to_detect_the_station_pos
#define __pyx_n_s_Union __pyx_mstate_global->__pyx_n_s_Union
#define __pyx_kp_s_Union_ArrayLike_List_ArrayLike __pyx_mstate_global->__pyx_kp_s_Union_ArrayLike_List_ArrayLike
#define __pyx_kp_s_Union_ArrayLike_Series __pyx_mstate_global->__pyx_kp_s_Union_ArrayLike_Series
#define __pyx_kp_s_Union_ArrayLike__SP_Series_DataF __pyx_mstate_global->__pyx_kp_s_Union_ArrayLike__SP_Series_DataF
#define __pyx_kp_s_Union_int_float __pyx_mstate_global->__pyx_kp_s_Union_int_float
#define __pyx_kp_s_Union_int_str_list __pyx_mstate_global->__pyx_kp_s_Union_int_str_list
#define __pyx_kp_s_Union_np_ndarray_List_ArrayLike __pyx_mstate_global->__pyx_kp_s_Union_np_ndarray_List_ArrayLike
#define __pyx_kp_s_Union_str_ArrayLike __pyx_mstate_global->__pyx_kp_s_Union_str_ArrayLike
#define __pyx_kp_s_Union_str_int __pyx_mstate_global->__pyx_kp_s_Union_str_int
#define __pyx_kp_u_Unknown_method __pyx_mstate_global->__pyx_kp_u_Unknown_method
#define __pyx_kp_u_Use_base_or_binning __pyx_mstate_global->__pyx_kp_u_Use_base_or_binning
#define __pyx_kp_u_Use_column_name_instead __pyx_mstate_global->__pyx_kp_u_Use_column_name_instead
#define __pyx_kp_u_Use_the_index_instead __pyx_mstate_global->__pyx_kp_u_Use_the_index_instead
#define __pyx_n_s_ValueError __pyx_mstate_global->__pyx_n_s_ValueError
#define __pyx_kp_u_Value_column_must_not_contain_nu __pyx_mstate_global->__pyx_kp_u_Value_column_must_not_contain_nu
#define __pyx_kp_u_Value_is_resetting_to_minimum_e __pyx_mstate_global->__pyx_kp_u_Value_is_resetting_to_minimum_e
#define __pyx_kp_u_Variant_average_methods_only_inc __pyx_mstate_global->__pyx_kp_u_Variant_average_methods_only_inc
#define __pyx_n_s_W __pyx_mstate_global->__pyx_n_s_W
#define __pyx_kp_u_Wrong_coordinates_values_Need_tw __pyx_mstate_global->__pyx_kp_u_Wrong_coordinates_values_Need_tw
#define __pyx_n_s_X __pyx_mstate_global->__pyx_n_s_X
#define __pyx_n_s_X_max __pyx_mstate_global->__pyx_n_s_X_max
#define __pyx_n_s_X_mean __pyx_mstate_global->__pyx_n_s_X_mean
#define __pyx_n_s_X_min __pyx_mstate_global->__pyx_n_s_X_min
#define __pyx_n_s_X_norm __pyx_mstate_global->__pyx_n_s_X_norm
#define __pyx_n_s_X_normalized __pyx_mstate_global->__pyx_n_s_X_normalized
#define __pyx_n_s_X_scaled __pyx_mstate_global->__pyx_n_s_X_scaled
#define __pyx_n_s_X_std __pyx_mstate_global->__pyx_n_s_X_std
#define __pyx_n_u_Xdata __pyx_mstate_global->__pyx_n_u_Xdata
#define __pyx_kp_u_Youden_s_index_calculation_requi __pyx_mstate_global->__pyx_kp_u_Youden_s_index_calculation_requi
#define __pyx_n_s_Z __pyx_mstate_global->__pyx_n_s_Z
#define __pyx_kp_u__107 __pyx_mstate_global->__pyx_kp_u__107
#define __pyx_n_s__177 __pyx_mstate_global->__pyx_n_s__177
#define __pyx_kp_u__2 __pyx_mstate_global->__pyx_kp_u__2
#define __pyx_n_s__240 __pyx_mstate_global->__pyx_n_s__240
#define __pyx_kp_u__31 __pyx_mstate_global->__pyx_kp_u__31
#define __pyx_kp_u__39 __pyx_mstate_global->__pyx_kp_u__39
#define __pyx_kp_u__65 __pyx_mstate_global->__pyx_kp_u__65
#define __pyx_n_s__70 __pyx_mstate_global->__pyx_n_s__70
#define __pyx_kp_u__70 __pyx_mstate_global->__pyx_kp_u__70
#define __pyx_kp_u__88 __pyx_mstate_global->__pyx_kp_u__88
#define __pyx_n_s_a __pyx_mstate_global->__pyx_n_s_a
#define __pyx_n_s_abs __pyx_mstate_global->__pyx_n_s_abs
#define __pyx_n_s_accept_multioutput __pyx_mstate_global->__pyx_n_s_accept_multioutput
#define __pyx_n_s_action __pyx_mstate_global->__pyx_n_s_action
#define __pyx_n_s_actual __pyx_mstate_global->__pyx_n_s_actual
#define __pyx_n_s_adaptive_moving_average __pyx_mstate_global->__pyx_n_s_adaptive_moving_average
#define __pyx_n_u_adaptive_moving_average __pyx_mstate_global->__pyx_n_u_adaptive_moving_average
#define __pyx_kp_u_adaptive_moving_average_line_494 __pyx_mstate_global->__pyx_kp_u_adaptive_moving_average_line_494
#define __pyx_n_s_add_results __pyx_mstate_global->__pyx_n_s_add_results
#define __pyx_n_s_adjust_for_control_vars __pyx_mstate_global->__pyx_n_s_adjust_for_control_vars
#define __pyx_n_u_adjust_for_control_vars __pyx_mstate_global->__pyx_n_u_adjust_for_control_vars
#define __pyx_n_s_adjust_for_control_vars_classifi __pyx_mstate_global->__pyx_n_s_adjust_for_control_vars_classifi
#define __pyx_kp_u_adjust_for_control_vars_classifi_2 __pyx_mstate_global->__pyx_kp_u_adjust_for_control_vars_classifi_2
#define __pyx_kp_u_adjust_for_control_vars_line_150 __pyx_mstate_global->__pyx_kp_u_adjust_for_control_vars_line_150
#define __pyx_n_s_adjust_for_control_vars_regressi __pyx_mstate_global->__pyx_n_s_adjust_for_control_vars_regressi
#define __pyx_kp_u_adjust_for_control_vars_regressi_2 __pyx_mstate_global->__pyx_kp_u_adjust_for_control_vars_regressi_2
#define __pyx_n_s_adjusted_pred __pyx_mstate_global->__pyx_n_s_adjusted_pred
#define __pyx_n_s_adjusted_preds __pyx_mstate_global->__pyx_n_s_adjusted_preds
#define __pyx_n_s_adjusted_y_pred __pyx_mstate_global->__pyx_n_s_adjusted_y_pred
#define __pyx_n_s_adjusted_y_true __pyx_mstate_global->__pyx_n_s_adjusted_y_true
#define __pyx_n_s_all __pyx_mstate_global->__pyx_n_s_all
#define __pyx_n_s_all_2 __pyx_mstate_global->__pyx_n_s_all_2
#define __pyx_n_s_alpha __pyx_mstate_global->__pyx_n_s_alpha
#define __pyx_kp_u_alpha_should_be_less_than_1_and __pyx_mstate_global->__pyx_kp_u_alpha_should_be_less_than_1_and
#define __pyx_n_s_ama __pyx_mstate_global->__pyx_n_s_ama
#define __pyx_n_s_ama_value __pyx_mstate_global->__pyx_n_s_ama_value
#define __pyx_n_u_amount __pyx_mstate_global->__pyx_n_u_amount
#define __pyx_n_s_any __pyx_mstate_global->__pyx_n_s_any
#define __pyx_n_s_api_box __pyx_mstate_global->__pyx_n_s_api_box
#define __pyx_n_s_api_docstring __pyx_mstate_global->__pyx_n_s_api_docstring
#define __pyx_n_s_api_summary __pyx_mstate_global->__pyx_n_s_api_summary
#define __pyx_n_s_api_types __pyx_mstate_global->__pyx_n_s_api_types
#define __pyx_n_s_append __pyx_mstate_global->__pyx_n_s_append
#define __pyx_n_s_apply_log_scale __pyx_mstate_global->__pyx_n_s_apply_log_scale
#define __pyx_n_s_ar __pyx_mstate_global->__pyx_n_s_ar
#define __pyx_n_s_arange __pyx_mstate_global->__pyx_n_s_arange
#define __pyx_n_s_arctan __pyx_mstate_global->__pyx_n_s_arctan
#define __pyx_n_s_arctan2 __pyx_mstate_global->__pyx_n_s_arctan2
#define __pyx_kp_u_are_not_allowed __pyx_mstate_global->__pyx_kp_u_are_not_allowed
#define __pyx_n_s_argmax __pyx_mstate_global->__pyx_n_s_argmax
#define __pyx_n_s_argmin __pyx_mstate_global->__pyx_n_s_argmin
#define __pyx_n_s_argrelextrema __pyx_mstate_global->__pyx_n_s_argrelextrema
#define __pyx_n_s_args __pyx_mstate_global->__pyx_n_s_args
#define __pyx_n_s_argsort __pyx_mstate_global->__pyx_n_s_argsort
#define __pyx_n_s_argwhere __pyx_mstate_global->__pyx_n_s_argwhere
#define __pyx_n_s_around __pyx_mstate_global->__pyx_n_s_around
#define __pyx_n_s_arr __pyx_mstate_global->__pyx_n_s_arr
#define __pyx_n_u_array __pyx_mstate_global->__pyx_n_u_array
#define __pyx_n_s_array_2 __pyx_mstate_global->__pyx_n_s_array_2
#define __pyx_n_u_array_2 __pyx_mstate_global->__pyx_n_u_array_2
#define __pyx_n_s_arraytools __pyx_mstate_global->__pyx_n_s_arraytools
#define __pyx_n_s_as_frame __pyx_mstate_global->__pyx_n_s_as_frame
#define __pyx_n_s_asarray __pyx_mstate_global->__pyx_n_s_asarray
#define __pyx_n_s_assert_all_types __pyx_mstate_global->__pyx_n_s_assert_all_types
#define __pyx_n_s_assert_ratio __pyx_mstate_global->__pyx_n_s_assert_ratio
#define __pyx_n_s_assert_x_y_positions __pyx_mstate_global->__pyx_n_s_assert_x_y_positions
#define __pyx_n_s_assert_xy_in __pyx_mstate_global->__pyx_n_s_assert_xy_in
#define __pyx_n_s_assign __pyx_mstate_global->__pyx_n_s_assign
#define __pyx_n_s_astype __pyx_mstate_global->__pyx_n_s_astype
#define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
#define __pyx_n_s_auc_score __pyx_mstate_global->__pyx_n_s_auc_score
#define __pyx_n_u_auto __pyx_mstate_global->__pyx_n_u_auto
#define __pyx_n_s_average __pyx_mstate_global->__pyx_n_s_average
#define __pyx_n_u_average __pyx_mstate_global->__pyx_n_u_average
#define __pyx_n_s_avg_sensitivity __pyx_mstate_global->__pyx_n_s_avg_sensitivity
#define __pyx_n_s_avg_specificity __pyx_mstate_global->__pyx_n_s_avg_specificity
#define __pyx_n_s_aweights __pyx_mstate_global->__pyx_n_s_aweights
#define __pyx_n_s_ax __pyx_mstate_global->__pyx_n_s_ax
#define __pyx_n_s_axis __pyx_mstate_global->__pyx_n_s_axis
#define __pyx_n_s_axis_slice __pyx_mstate_global->__pyx_n_s_axis_slice
#define __pyx_n_s_azim __pyx_mstate_global->__pyx_n_s_azim
#define __pyx_n_s_b __pyx_mstate_global->__pyx_n_s_b
#define __pyx_kp_u_b_2 __pyx_mstate_global->__pyx_kp_u_b_2
#define __pyx_n_s_bal_acc_scores __pyx_mstate_global->__pyx_n_s_bal_acc_scores
#define __pyx_n_s_balanced_accuracy_ovo __pyx_mstate_global->__pyx_n_s_balanced_accuracy_ovo
#define __pyx_n_s_balanced_accuracy_ovr __pyx_mstate_global->__pyx_n_s_balanced_accuracy_ovr
#define __pyx_n_u_base __pyx_mstate_global->__pyx_n_u_base
#define __pyx_n_s_base_epsilon __pyx_mstate_global->__pyx_n_s_base_epsilon
#define __pyx_n_s_best_threshold __pyx_mstate_global->__pyx_n_s_best_threshold
#define __pyx_n_s_beta __pyx_mstate_global->__pyx_n_s_beta
#define __pyx_n_s_bias __pyx_mstate_global->__pyx_n_s_bias
#define __pyx_n_s_bin_contribution __pyx_mstate_global->__pyx_n_s_bin_contribution
#define __pyx_n_s_bin_edges __pyx_mstate_global->__pyx_n_s_bin_edges
#define __pyx_n_s_bin_index __pyx_mstate_global->__pyx_n_s_bin_index
#define __pyx_n_s_bin_true __pyx_mstate_global->__pyx_n_s_bin_true
#define __pyx_n_s_bin_width __pyx_mstate_global->__pyx_n_s_bin_width
#define __pyx_n_u_binary __pyx_mstate_global->__pyx_n_u_binary
#define __pyx_n_s_binary_y_pred __pyx_mstate_global->__pyx_n_s_binary_y_pred
#define __pyx_n_s_binary_y_true __pyx_mstate_global->__pyx_n_s_binary_y_true
#define __pyx_n_u_binning __pyx_mstate_global->__pyx_n_u_binning
#define __pyx_n_s_bins __pyx_mstate_global->__pyx_n_s_bins
#define __pyx_n_s_bins_array __pyx_mstate_global->__pyx_n_s_bins_array
#define __pyx_n_s_bins_method __pyx_mstate_global->__pyx_n_s_bins_method
#define __pyx_n_s_bool __pyx_mstate_global->__pyx_n_s_bool
#define __pyx_n_s_bounds __pyx_mstate_global->__pyx_n_s_bounds
#define __pyx_n_s_buffer __pyx_mstate_global->__pyx_n_s_buffer
#define __pyx_n_s_c __pyx_mstate_global->__pyx_n_s_c
#define __pyx_n_s_c_order __pyx_mstate_global->__pyx_n_s_c_order
#define __pyx_kp_u_c_order_2 __pyx_mstate_global->__pyx_kp_u_c_order_2
#define __pyx_kp_u_c_order_3 __pyx_mstate_global->__pyx_kp_u_c_order_3
#define __pyx_n_s_calculate_adjusted_lr __pyx_mstate_global->__pyx_n_s_calculate_adjusted_lr
#define __pyx_n_u_calculate_adjusted_lr __pyx_mstate_global->__pyx_n_u_calculate_adjusted_lr
#define __pyx_kp_u_calculate_adjusted_lr_line_809 __pyx_mstate_global->__pyx_kp_u_calculate_adjusted_lr_line_809
#define __pyx_n_s_calculate_binary_iv __pyx_mstate_global->__pyx_n_s_calculate_binary_iv
#define __pyx_n_u_calculate_binary_iv __pyx_mstate_global->__pyx_n_u_calculate_binary_iv
#define __pyx_kp_u_calculate_binary_iv_line_1993 __pyx_mstate_global->__pyx_kp_u_calculate_binary_iv_line_1993
#define __pyx_n_s_calculate_histogram_bins __pyx_mstate_global->__pyx_n_s_calculate_histogram_bins
#define __pyx_kp_u_calculate_histogram_bins_line_12 __pyx_mstate_global->__pyx_kp_u_calculate_histogram_bins_line_12
#define __pyx_n_s_calculate_multiclass_avg_lr __pyx_mstate_global->__pyx_n_s_calculate_multiclass_avg_lr
#define __pyx_kp_u_calculate_multiclass_avg_lr_line __pyx_mstate_global->__pyx_kp_u_calculate_multiclass_avg_lr_line
#define __pyx_n_s_calculate_multiclass_lr __pyx_mstate_global->__pyx_n_s_calculate_multiclass_lr
#define __pyx_kp_u_calculate_multiclass_lr_line_662 __pyx_mstate_global->__pyx_kp_u_calculate_multiclass_lr_line_662
#define __pyx_n_s_calculate_optimal_bins __pyx_mstate_global->__pyx_n_s_calculate_optimal_bins
#define __pyx_n_u_calculate_optimal_bins __pyx_mstate_global->__pyx_n_u_calculate_optimal_bins
#define __pyx_kp_u_calculate_optimal_bins_line_1895 __pyx_mstate_global->__pyx_kp_u_calculate_optimal_bins_line_1895
#define __pyx_n_s_calculate_optimal_bins_locals_ge __pyx_mstate_global->__pyx_n_s_calculate_optimal_bins_locals_ge
#define __pyx_n_s_calculate_residuals __pyx_mstate_global->__pyx_n_s_calculate_residuals
#define __pyx_n_u_calculate_residuals __pyx_mstate_global->__pyx_n_u_calculate_residuals
#define __pyx_kp_u_calculate_residuals_line_2195 __pyx_mstate_global->__pyx_kp_u_calculate_residuals_line_2195
#define __pyx_n_u_call __pyx_mstate_global->__pyx_n_u_call
#define __pyx_n_s_catch_warnings __pyx_mstate_global->__pyx_n_s_catch_warnings
#define __pyx_n_s_category __pyx_mstate_global->__pyx_n_s_category
#define __pyx_n_s_ceil __pyx_mstate_global->__pyx_n_s_ceil
#define __pyx_n_s_change __pyx_mstate_global->__pyx_n_s_change
#define __pyx_n_s_check_classification_targets __pyx_mstate_global->__pyx_n_s_check_classification_targets
#define __pyx_n_s_check_consistent_length __pyx_mstate_global->__pyx_n_s_check_consistent_length
#define __pyx_n_s_check_epsilon __pyx_mstate_global->__pyx_n_s_check_epsilon
#define __pyx_n_s_check_y __pyx_mstate_global->__pyx_n_s_check_y
#define __pyx_n_s_ck __pyx_mstate_global->__pyx_n_s_ck
#define __pyx_n_s_class_getitem __pyx_mstate_global->__pyx_n_s_class_getitem
#define __pyx_n_s_classes __pyx_mstate_global->__pyx_n_s_classes
#define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
#define __pyx_n_s_close __pyx_mstate_global->__pyx_n_s_close
#define __pyx_n_s_cls __pyx_mstate_global->__pyx_n_s_cls
#define __pyx_n_s_cls1 __pyx_mstate_global->__pyx_n_s_cls1
#define __pyx_n_s_cls2 __pyx_mstate_global->__pyx_n_s_cls2
#define __pyx_kp_u_cluster_d __pyx_mstate_global->__pyx_kp_u_cluster_d
#define __pyx_n_s_cm __pyx_mstate_global->__pyx_n_s_cm
#define __pyx_n_u_cma __pyx_mstate_global->__pyx_n_u_cma
#define __pyx_n_s_coef __pyx_mstate_global->__pyx_n_s_coef
#define __pyx_n_s_coeffs __pyx_mstate_global->__pyx_n_s_coeffs
#define __pyx_n_s_col __pyx_mstate_global->__pyx_n_s_col
#define __pyx_n_s_column __pyx_mstate_global->__pyx_n_s_column
#define __pyx_n_s_column2ignore __pyx_mstate_global->__pyx_n_s_column2ignore
#define __pyx_n_s_columns __pyx_mstate_global->__pyx_n_s_columns
#define __pyx_n_u_columns __pyx_mstate_global->__pyx_n_u_columns
#define __pyx_n_s_combinations __pyx_mstate_global->__pyx_n_s_combinations
#define __pyx_n_u_complete __pyx_mstate_global->__pyx_n_u_complete
#define __pyx_n_s_compute_balance_accuracy __pyx_mstate_global->__pyx_n_s_compute_balance_accuracy
#define __pyx_n_u_compute_balance_accuracy __pyx_mstate_global->__pyx_n_u_compute_balance_accuracy
#define __pyx_kp_u_compute_balance_accuracy_line_24 __pyx_mstate_global->__pyx_kp_u_compute_balance_accuracy_line_24
#define __pyx_n_s_compute_balanced_accuracy_binar __pyx_mstate_global->__pyx_n_s_compute_balanced_accuracy_binar
#define __pyx_n_s_compute_cost_based_threshold __pyx_mstate_global->__pyx_n_s_compute_cost_based_threshold
#define __pyx_n_u_compute_cost_based_threshold __pyx_mstate_global->__pyx_n_u_compute_cost_based_threshold
#define __pyx_kp_u_compute_cost_based_threshold_lin __pyx_mstate_global->__pyx_kp_u_compute_cost_based_threshold_lin
#define __pyx_n_s_compute_effort_yield __pyx_mstate_global->__pyx_n_s_compute_effort_yield
#define __pyx_n_u_compute_effort_yield __pyx_mstate_global->__pyx_n_u_compute_effort_yield
#define __pyx_kp_u_compute_effort_yield_line_2440 __pyx_mstate_global->__pyx_kp_u_compute_effort_yield_line_2440
#define __pyx_n_s_compute_errors __pyx_mstate_global->__pyx_n_s_compute_errors
#define __pyx_n_u_compute_errors __pyx_mstate_global->__pyx_n_u_compute_errors
#define __pyx_kp_u_compute_errors_line_4287 __pyx_mstate_global->__pyx_kp_u_compute_errors_line_4287
#define __pyx_n_s_compute_ovo_sens_spec __pyx_mstate_global->__pyx_n_s_compute_ovo_sens_spec
#define __pyx_kp_u_compute_ovo_sens_spec_line_1140 __pyx_mstate_global->__pyx_kp_u_compute_ovo_sens_spec_line_1140
#define __pyx_n_s_compute_p_values __pyx_mstate_global->__pyx_n_s_compute_p_values
#define __pyx_n_u_compute_p_values __pyx_mstate_global->__pyx_n_u_compute_p_values
#define __pyx_kp_u_compute_p_values_line_97 __pyx_mstate_global->__pyx_kp_u_compute_p_values_line_97
#define __pyx_n_s_compute_sensitivity_specificity __pyx_mstate_global->__pyx_n_s_compute_sensitivity_specificity
#define __pyx_n_s_compute_sensitivity_specificity_2 __pyx_mstate_global->__pyx_n_s_compute_sensitivity_specificity_2
#define __pyx_n_u_compute_sensitivity_specificity_2 __pyx_mstate_global->__pyx_n_u_compute_sensitivity_specificity_2
#define __pyx_kp_u_compute_sensitivity_specificity_3 __pyx_mstate_global->__pyx_kp_u_compute_sensitivity_specificity_3
#define __pyx_kp_u_compute_sensitivity_specificity_4 __pyx_mstate_global->__pyx_kp_u_compute_sensitivity_specificity_4
#define __pyx_n_s_compute_spearmanr __pyx_mstate_global->__pyx_n_s_compute_spearmanr
#define __pyx_n_s_compute_spearmanr_locals__weigh __pyx_mstate_global->__pyx_n_s_compute_spearmanr_locals__weigh
#define __pyx_n_s_compute_sunburst_data __pyx_mstate_global->__pyx_n_s_compute_sunburst_data
#define __pyx_n_u_compute_sunburst_data __pyx_mstate_global->__pyx_n_u_compute_sunburst_data
#define __pyx_kp_u_compute_sunburst_data_line_2348 __pyx_mstate_global->__pyx_kp_u_compute_sunburst_data_line_2348
#define __pyx_n_s_compute_youdens_index __pyx_mstate_global->__pyx_n_s_compute_youdens_index
#define __pyx_n_u_compute_youdens_index __pyx_mstate_global->__pyx_n_u_compute_youdens_index
#define __pyx_kp_u_compute_youdens_index_line_466 __pyx_mstate_global->__pyx_kp_u_compute_youdens_index_line_466
#define __pyx_n_s_concat __pyx_mstate_global->__pyx_n_s_concat
#define __pyx_n_s_concat_array_from_list __pyx_mstate_global->__pyx_n_s_concat_array_from_list
#define __pyx_n_s_concat_axis __pyx_mstate_global->__pyx_n_s_concat_axis
#define __pyx_n_s_concatenate __pyx_mstate_global->__pyx_n_s_concatenate
#define __pyx_n_u_condens __pyx_mstate_global->__pyx_n_u_condens
#define __pyx_n_u_condense __pyx_mstate_global->__pyx_n_u_condense
#define __pyx_n_s_confusion_matrix __pyx_mstate_global->__pyx_n_s_confusion_matrix
#define __pyx_n_s_consensus __pyx_mstate_global->__pyx_n_s_consensus
#define __pyx_n_u_consensus __pyx_mstate_global->__pyx_n_u_consensus
#define __pyx_n_u_constant __pyx_mstate_global->__pyx_n_u_constant
#define __pyx_n_u_contains __pyx_mstate_global->__pyx_n_u_contains
#define __pyx_n_u_continuous __pyx_mstate_global->__pyx_n_u_continuous
#define __pyx_n_s_control_vars __pyx_mstate_global->__pyx_n_s_control_vars
#define __pyx_n_u_conv __pyx_mstate_global->__pyx_n_u_conv
#define __pyx_n_s_convert_distance_to_m __pyx_mstate_global->__pyx_n_s_convert_distance_to_m
#define __pyx_n_s_converter __pyx_mstate_global->__pyx_n_s_converter
#define __pyx_n_s_convolve __pyx_mstate_global->__pyx_n_s_convolve
#define __pyx_n_s_convolve1d __pyx_mstate_global->__pyx_n_s_convolve1d
#define __pyx_n_s_copy __pyx_mstate_global->__pyx_n_s_copy
#define __pyx_n_s_coreutils __pyx_mstate_global->__pyx_n_s_coreutils
#define __pyx_n_s_corr __pyx_mstate_global->__pyx_n_s_corr
#define __pyx_n_s_corr_func __pyx_mstate_global->__pyx_n_s_corr_func
#define __pyx_n_s_corr_methods __pyx_mstate_global->__pyx_n_s_corr_methods
#define __pyx_n_s_corrcoef __pyx_mstate_global->__pyx_n_s_corrcoef
#define __pyx_n_s_cos __pyx_mstate_global->__pyx_n_s_cos
#define __pyx_n_s_cost_history __pyx_mstate_global->__pyx_n_s_cost_history
#define __pyx_n_s_costs __pyx_mstate_global->__pyx_n_s_costs
#define __pyx_n_u_costs __pyx_mstate_global->__pyx_n_u_costs
#define __pyx_kp_u_could_not_convert_string_to_floa __pyx_mstate_global->__pyx_kp_u_could_not_convert_string_to_floa
#define __pyx_n_s_count __pyx_mstate_global->__pyx_n_s_count
#define __pyx_n_u_count __pyx_mstate_global->__pyx_n_u_count
#define __pyx_n_s_count_local_minima __pyx_mstate_global->__pyx_n_s_count_local_minima
#define __pyx_kp_u_count_local_minima_line_3171 __pyx_mstate_global->__pyx_kp_u_count_local_minima_line_3171
#define __pyx_n_s_counts __pyx_mstate_global->__pyx_n_s_counts
#define __pyx_n_s_cov __pyx_mstate_global->__pyx_n_s_cov
#define __pyx_n_s_cubic_regression __pyx_mstate_global->__pyx_n_s_cubic_regression
#define __pyx_n_u_cubic_regression __pyx_mstate_global->__pyx_n_u_cubic_regression
#define __pyx_n_s_cum_weights __pyx_mstate_global->__pyx_n_s_cum_weights
#define __pyx_n_s_cumsum __pyx_mstate_global->__pyx_n_s_cumsum
#define __pyx_n_u_cumulative __pyx_mstate_global->__pyx_n_u_cumulative
#define __pyx_kp_u_cumulative_average __pyx_mstate_global->__pyx_kp_u_cumulative_average
#define __pyx_n_s_cumulative_data __pyx_mstate_global->__pyx_n_s_cumulative_data
#define __pyx_n_s_curve_fit __pyx_mstate_global->__pyx_n_s_curve_fit
#define __pyx_kp_u_custom_logic __pyx_mstate_global->__pyx_kp_u_custom_logic
#define __pyx_n_s_cval __pyx_mstate_global->__pyx_n_s_cval
#define __pyx_n_s_d __pyx_mstate_global->__pyx_n_s_d
#define __pyx_n_s_data __pyx_mstate_global->__pyx_n_s_data
#define __pyx_n_u_data __pyx_mstate_global->__pyx_n_u_data
#define __pyx_n_s_data_2 __pyx_mstate_global->__pyx_n_s_data_2
#define __pyx_n_s_data_max __pyx_mstate_global->__pyx_n_s_data_max
#define __pyx_n_s_data_min __pyx_mstate_global->__pyx_n_s_data_min
#define __pyx_n_s_data_range __pyx_mstate_global->__pyx_n_s_data_range
#define __pyx_kp_u_data_range_must_be_a_tuple_of_tw __pyx_mstate_global->__pyx_kp_u_data_range_must_be_a_tuple_of_tw
#define __pyx_kp_u_data_range_must_contain_numeric __pyx_mstate_global->__pyx_kp_u_data_range_must_contain_numeric
#define __pyx_kp_u_data_should_be_a_frame_not __pyx_mstate_global->__pyx_kp_u_data_should_be_a_frame_not
#define __pyx_n_s_ddof __pyx_mstate_global->__pyx_n_s_ddof
#define __pyx_n_s_decorators __pyx_mstate_global->__pyx_n_s_decorators
#define __pyx_n_s_deep __pyx_mstate_global->__pyx_n_s_deep
#define __pyx_n_s_deepcopy __pyx_mstate_global->__pyx_n_s_deepcopy
#define __pyx_n_s_default __pyx_mstate_global->__pyx_n_s_default
#define __pyx_n_s_defaults __pyx_mstate_global->__pyx_n_s_defaults
#define __pyx_n_s_deg __pyx_mstate_global->__pyx_n_s_deg
#define __pyx_n_s_deg2rad __pyx_mstate_global->__pyx_n_s_deg2rad
#define __pyx_n_s_degree __pyx_mstate_global->__pyx_n_s_degree
#define __pyx_n_s_delete __pyx_mstate_global->__pyx_n_s_delete
#define __pyx_n_s_delta __pyx_mstate_global->__pyx_n_s_delta
#define __pyx_n_u_dense __pyx_mstate_global->__pyx_n_u_dense
#define __pyx_n_s_dense_rank __pyx_mstate_global->__pyx_n_s_dense_rank
#define __pyx_n_s_depvar __pyx_mstate_global->__pyx_n_s_depvar
#define __pyx_n_u_depvar __pyx_mstate_global->__pyx_n_u_depvar
#define __pyx_n_s_deriv __pyx_mstate_global->__pyx_n_s_deriv
#define __pyx_n_u_design __pyx_mstate_global->__pyx_n_u_design
#define __pyx_n_s_detect_station_position __pyx_mstate_global->__pyx_n_s_detect_station_position
#define __pyx_kp_u_detect_station_position_line_374 __pyx_mstate_global->__pyx_kp_u_detect_station_position_line_374
#define __pyx_n_s_determine_epsilon __pyx_mstate_global->__pyx_n_s_determine_epsilon
#define __pyx_n_s_df __pyx_mstate_global->__pyx_n_s_df
#define __pyx_n_s_df_full __pyx_mstate_global->__pyx_n_s_df_full
#define __pyx_n_s_df_level __pyx_mstate_global->__pyx_n_s_df_level
#define __pyx_n_s_df_only __pyx_mstate_global->__pyx_n_s_df_only
#define __pyx_n_s_diag __pyx_mstate_global->__pyx_n_s_diag
#define __pyx_n_s_diff __pyx_mstate_global->__pyx_n_s_diff
#define __pyx_n_s_digitize __pyx_mstate_global->__pyx_n_s_digitize
#define __pyx_n_s_digitized __pyx_mstate_global->__pyx_n_s_digitized
#define __pyx_n_s_dipole __pyx_mstate_global->__pyx_n_s_dipole
#define __pyx_kp_u_disable __pyx_mstate_global->__pyx_kp_u_disable
#define __pyx_n_s_distance __pyx_mstate_global->__pyx_n_s_distance
#define __pyx_n_u_distance __pyx_mstate_global->__pyx_n_u_distance
#define __pyx_n_s_dl __pyx_mstate_global->__pyx_n_s_dl
#define __pyx_n_s_doc __pyx_mstate_global->__pyx_n_s_doc
#define __pyx_n_s_dot __pyx_mstate_global->__pyx_n_s_dot
#define __pyx_n_u_dot __pyx_mstate_global->__pyx_n_u_dot
#define __pyx_n_s_dp __pyx_mstate_global->__pyx_n_s_dp
#define __pyx_n_s_drop __pyx_mstate_global->__pyx_n_s_drop
#define __pyx_n_s_drop_duplicates __pyx_mstate_global->__pyx_n_s_drop_duplicates
#define __pyx_n_s_drop_intermediate __pyx_mstate_global->__pyx_n_s_drop_intermediate
#define __pyx_n_s_dtype __pyx_mstate_global->__pyx_n_s_dtype
#define __pyx_n_s_dx __pyx_mstate_global->__pyx_n_s_dx
#define __pyx_n_s_dy __pyx_mstate_global->__pyx_n_s_dy
#define __pyx_n_s_easting __pyx_mstate_global->__pyx_n_s_easting
#define __pyx_n_s_effort __pyx_mstate_global->__pyx_n_s_effort
#define __pyx_n_s_ellipsis2false __pyx_mstate_global->__pyx_n_s_ellipsis2false
#define __pyx_n_u_ema __pyx_mstate_global->__pyx_n_u_ema
#define __pyx_n_s_empty __pyx_mstate_global->__pyx_n_s_empty
#define __pyx_n_s_empty_like __pyx_mstate_global->__pyx_n_s_empty_like
#define __pyx_kp_u_enable __pyx_mstate_global->__pyx_kp_u_enable
#define __pyx_n_s_end __pyx_mstate_global->__pyx_n_s_end
#define __pyx_n_s_ensure_2d __pyx_mstate_global->__pyx_n_s_ensure_2d
#define __pyx_n_s_ensure_non_negative __pyx_mstate_global->__pyx_n_s_ensure_non_negative
#define __pyx_n_s_ensure_y_is_valid __pyx_mstate_global->__pyx_n_s_ensure_y_is_valid
#define __pyx_n_s_enter __pyx_mstate_global->__pyx_n_s_enter
#define __pyx_n_s_enumerate __pyx_mstate_global->__pyx_n_s_enumerate
#define __pyx_n_s_epsilon __pyx_mstate_global->__pyx_n_s_epsilon
#define __pyx_n_s_err __pyx_mstate_global->__pyx_n_s_err
#define __pyx_n_s_err_lower __pyx_mstate_global->__pyx_n_s_err_lower
#define __pyx_n_s_err_msg __pyx_mstate_global->__pyx_n_s_err_msg
#define __pyx_n_s_err_upper __pyx_mstate_global->__pyx_n_s_err_upper
#define __pyx_n_s_error __pyx_mstate_global->__pyx_n_s_error
#define __pyx_n_u_error __pyx_mstate_global->__pyx_n_u_error
#define __pyx_n_s_error_msg __pyx_mstate_global->__pyx_n_s_error_msg
#define __pyx_n_s_errstate __pyx_mstate_global->__pyx_n_s_errstate
#define __pyx_n_s_estimator __pyx_mstate_global->__pyx_n_s_estimator
#define __pyx_n_s_estimators __pyx_mstate_global->__pyx_n_s_estimators
#define __pyx_n_u_euclidean __pyx_mstate_global->__pyx_n_u_euclidean
#define __pyx_n_s_exceptions __pyx_mstate_global->__pyx_n_s_exceptions
#define __pyx_n_s_exclude_string __pyx_mstate_global->__pyx_n_s_exclude_string
#define __pyx_n_s_exclude_value __pyx_mstate_global->__pyx_n_s_exclude_value
#define __pyx_n_s_exit __pyx_mstate_global->__pyx_n_s_exit
#define __pyx_n_s_exp __pyx_mstate_global->__pyx_n_s_exp
#define __pyx_n_s_expect_name __pyx_mstate_global->__pyx_n_s_expect_name
#define __pyx_n_u_exponential __pyx_mstate_global->__pyx_n_u_exponential
#define __pyx_kp_u_exponential_moving_average __pyx_mstate_global->__pyx_kp_u_exponential_moving_average
#define __pyx_n_s_exponential_regression __pyx_mstate_global->__pyx_n_s_exponential_regression
#define __pyx_n_u_exponential_regression __pyx_mstate_global->__pyx_n_u_exponential_regression
#define __pyx_kp_u_extra_azimuth __pyx_mstate_global->__pyx_kp_u_extra_azimuth
#define __pyx_n_s_extrapolate __pyx_mstate_global->__pyx_n_s_extrapolate
#define __pyx_n_s_false_negatives __pyx_mstate_global->__pyx_n_s_false_negatives
#define __pyx_n_s_false_positives __pyx_mstate_global->__pyx_n_s_false_positives
#define __pyx_n_s_fig __pyx_mstate_global->__pyx_n_s_fig
#define __pyx_n_s_figsize __pyx_mstate_global->__pyx_n_s_figsize
#define __pyx_n_s_filtering_1d_array __pyx_mstate_global->__pyx_n_s_filtering_1d_array
#define __pyx_n_s_filterwarnings __pyx_mstate_global->__pyx_n_s_filterwarnings
#define __pyx_n_s_find __pyx_mstate_global->__pyx_n_s_find
#define __pyx_n_s_find_close_position __pyx_mstate_global->__pyx_n_s_find_close_position
#define __pyx_n_s_find_closest __pyx_mstate_global->__pyx_n_s_find_closest
#define __pyx_kp_u_find_closest_line_4771 __pyx_mstate_global->__pyx_kp_u_find_closest_line_4771
#define __pyx_n_s_fit __pyx_mstate_global->__pyx_n_s_fit
#define __pyx_kp_u_fit_a_5_3f_b_5_3f __pyx_mstate_global->__pyx_kp_u_fit_a_5_3f_b_5_3f
#define __pyx_n_s_fit_edge __pyx_mstate_global->__pyx_n_s_fit_edge
#define __pyx_n_s_fit_edges_polyfit __pyx_mstate_global->__pyx_n_s_fit_edges_polyfit
#define __pyx_n_s_fit_transform __pyx_mstate_global->__pyx_n_s_fit_transform
#define __pyx_n_s_float __pyx_mstate_global->__pyx_n_s_float
#define __pyx_n_u_float __pyx_mstate_global->__pyx_n_u_float
#define __pyx_n_s_float32 __pyx_mstate_global->__pyx_n_s_float32
#define __pyx_n_s_float64 __pyx_mstate_global->__pyx_n_s_float64
#define __pyx_n_s_float_factorial __pyx_mstate_global->__pyx_n_s_float_factorial
#define __pyx_n_s_format __pyx_mstate_global->__pyx_n_s_format
#define __pyx_n_s_fpr __pyx_mstate_global->__pyx_n_s_fpr
#define __pyx_n_u_freedman_diaconis __pyx_mstate_global->__pyx_n_u_freedman_diaconis
#define __pyx_n_s_from0 __pyx_mstate_global->__pyx_n_s_from0
#define __pyx_n_s_func __pyx_mstate_global->__pyx_n_s_func
#define __pyx_kp_u_func_argument_is_a_callable_not __pyx_mstate_global->__pyx_kp_u_func_argument_is_a_callable_not
#define __pyx_kp_u_gc __pyx_mstate_global->__pyx_kp_u_gc
#define __pyx_n_s_genexpr __pyx_mstate_global->__pyx_n_s_genexpr
#define __pyx_n_s_get __pyx_mstate_global->__pyx_n_s_get
#define __pyx_n_s_get_azimuth __pyx_mstate_global->__pyx_n_s_get_azimuth
#define __pyx_kp_u_get_azimuth_line_3229 __pyx_mstate_global->__pyx_kp_u_get_azimuth_line_3229
#define __pyx_n_s_get_azimuth_locals_lambda __pyx_mstate_global->__pyx_n_s_get_azimuth_locals_lambda
#define __pyx_n_s_get_bearing __pyx_mstate_global->__pyx_n_s_get_bearing
#define __pyx_n_u_get_bearing __pyx_mstate_global->__pyx_n_u_get_bearing
#define __pyx_kp_u_get_bearing_line_4703 __pyx_mstate_global->__pyx_kp_u_get_bearing_line_4703
#define __pyx_n_s_get_distance __pyx_mstate_global->__pyx_n_s_get_distance
#define __pyx_n_u_get_distance __pyx_mstate_global->__pyx_n_u_get_distance
#define __pyx_kp_u_get_distance_line_4518 __pyx_mstate_global->__pyx_kp_u_get_distance_line_4518
#define __pyx_n_s_get_gofast_logger __pyx_mstate_global->__pyx_n_s_get_gofast_logger
#define __pyx_n_s_get_profile_angle __pyx_mstate_global->__pyx_n_s_get_profile_angle
#define __pyx_n_s_get_station_number __pyx_mstate_global->__pyx_n_s_get_station_number
#define __pyx_n_s_gofast_tools_mathex __pyx_mstate_global->__pyx_n_s_gofast_tools_mathex
#define __pyx_kp_s_gofast_tools_mathex_pyx __pyx_mstate_global->__pyx_kp_s_gofast_tools_mathex_pyx
#define __pyx_n_s_gofastlog __pyx_mstate_global->__pyx_n_s_gofastlog
#define __pyx_n_s_gofastlog_2 __pyx_mstate_global->__pyx_n_s_gofastlog_2
#define __pyx_n_s_gradient_boosting_regressor __pyx_mstate_global->__pyx_n_s_gradient_boosting_regressor
#define __pyx_kp_u_gradient_boosting_regressor_line __pyx_mstate_global->__pyx_kp_u_gradient_boosting_regressor_line
#define __pyx_n_s_gradient_descent __pyx_mstate_global->__pyx_n_s_gradient_descent
#define __pyx_kp_u_gradient_descent_line_4820 __pyx_mstate_global->__pyx_kp_u_gradient_descent_line_4820
#define __pyx_n_s_group __pyx_mstate_global->__pyx_n_s_group
#define __pyx_n_s_groupby __pyx_mstate_global->__pyx_n_s_groupby
#define __pyx_n_s_halflen __pyx_mstate_global->__pyx_n_s_halflen
#define __pyx_n_s_hierarchy __pyx_mstate_global->__pyx_n_s_hierarchy
#define __pyx_n_s_histogram_bin_edges __pyx_mstate_global->__pyx_n_s_histogram_bin_edges
#define __pyx_n_s_hstack __pyx_mstate_global->__pyx_n_s_hstack
#define __pyx_n_s_i __pyx_mstate_global->__pyx_n_s_i
#define __pyx_n_s_idx __pyx_mstate_global->__pyx_n_s_idx
#define __pyx_n_s_ignore __pyx_mstate_global->__pyx_n_s_ignore
#define __pyx_n_u_ignore __pyx_mstate_global->__pyx_n_u_ignore
#define __pyx_n_s_ignore_index __pyx_mstate_global->__pyx_n_s_ignore_index
#define __pyx_n_s_ii __pyx_mstate_global->__pyx_n_s_ii
#define __pyx_n_s_iloc __pyx_mstate_global->__pyx_n_s_iloc
#define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
#define __pyx_n_s_in_bin __pyx_mstate_global->__pyx_n_s_in_bin
#define __pyx_n_s_in_percent __pyx_mstate_global->__pyx_n_s_in_percent
#define __pyx_n_s_include_label __pyx_mstate_global->__pyx_n_s_include_label
#define __pyx_n_s_include_metrics __pyx_mstate_global->__pyx_n_s_include_metrics
#define __pyx_n_s_include_nan __pyx_mstate_global->__pyx_n_s_include_nan
#define __pyx_n_s_index __pyx_mstate_global->__pyx_n_s_index
#define __pyx_n_u_inf __pyx_mstate_global->__pyx_n_u_inf
#define __pyx_n_s_infer_sankey_columns __pyx_mstate_global->__pyx_n_s_infer_sankey_columns
#define __pyx_n_u_infer_sankey_columns __pyx_mstate_global->__pyx_n_u_infer_sankey_columns
#define __pyx_kp_u_infer_sankey_columns_line_2272 __pyx_mstate_global->__pyx_kp_u_infer_sankey_columns_line_2272
#define __pyx_n_s_init_weights __pyx_mstate_global->__pyx_n_s_init_weights
#define __pyx_n_s_initializing __pyx_mstate_global->__pyx_n_s_initializing
#define __pyx_n_s_input_name __pyx_mstate_global->__pyx_n_s_input_name
#define __pyx_n_s_inspect __pyx_mstate_global->__pyx_n_s_inspect
#define __pyx_kp_u_instead_of __pyx_mstate_global->__pyx_kp_u_instead_of
#define __pyx_n_s_int __pyx_mstate_global->__pyx_n_s_int
#define __pyx_n_s_int32 __pyx_mstate_global->__pyx_n_s_int32
#define __pyx_n_u_interp __pyx_mstate_global->__pyx_n_u_interp
#define __pyx_n_s_interp_start __pyx_mstate_global->__pyx_n_s_interp_start
#define __pyx_n_s_interp_stop __pyx_mstate_global->__pyx_n_s_interp_stop
#define __pyx_n_s_inv __pyx_mstate_global->__pyx_n_s_inv
#define __pyx_n_s_inverse_transform __pyx_mstate_global->__pyx_n_s_inverse_transform
#define __pyx_n_s_involved_pairs __pyx_mstate_global->__pyx_n_s_involved_pairs
#define __pyx_n_s_iqr __pyx_mstate_global->__pyx_n_s_iqr
#define __pyx_n_s_is_arraylike_1d __pyx_mstate_global->__pyx_n_s_is_arraylike_1d
#define __pyx_n_s_is_binary_class __pyx_mstate_global->__pyx_n_s_is_binary_class
#define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
#define __pyx_n_s_is_frame __pyx_mstate_global->__pyx_n_s_is_frame
#define __pyx_kp_u_is_gotten __pyx_mstate_global->__pyx_kp_u_is_gotten
#define __pyx_n_s_is_iterable __pyx_mstate_global->__pyx_n_s_is_iterable
#define __pyx_n_s_is_latlon __pyx_mstate_global->__pyx_n_s_is_latlon
#define __pyx_kp_u_is_not_admitted_Expect_at_least __pyx_mstate_global->__pyx_kp_u_is_not_admitted_Expect_at_least
#define __pyx_n_s_is_numeric_dtype __pyx_mstate_global->__pyx_n_s_is_numeric_dtype
#define __pyx_kp_u_is_out_of_the_range_max_positio __pyx_mstate_global->__pyx_kp_u_is_out_of_the_range_max_positio
#define __pyx_n_s_is_utm __pyx_mstate_global->__pyx_n_s_is_utm
#define __pyx_n_s_isdeg __pyx_mstate_global->__pyx_n_s_isdeg
#define __pyx_n_s_isdigit __pyx_mstate_global->__pyx_n_s_isdigit
#define __pyx_kp_u_isenabled __pyx_mstate_global->__pyx_kp_u_isenabled
#define __pyx_n_s_isfunction __pyx_mstate_global->__pyx_n_s_isfunction
#define __pyx_n_s_isin __pyx_mstate_global->__pyx_n_s_isin
#define __pyx_n_s_islatlon __pyx_mstate_global->__pyx_n_s_islatlon
#define __pyx_n_s_isnan __pyx_mstate_global->__pyx_n_s_isnan
#define __pyx_n_s_isnull __pyx_mstate_global->__pyx_n_s_isnull
#define __pyx_n_s_isreal __pyx_mstate_global->__pyx_n_s_isreal
#define __pyx_n_s_isscalar __pyx_mstate_global->__pyx_n_s_isscalar
#define __pyx_n_s_issubdtype __pyx_mstate_global->__pyx_n_s_issubdtype
#define __pyx_n_s_items __pyx_mstate_global->__pyx_n_s_items
#define __pyx_n_s_iterrows __pyx_mstate_global->__pyx_n_s_iterrows
#define __pyx_n_s_itertools __pyx_mstate_global->__pyx_n_s_itertools
#define __pyx_n_s_iv __pyx_mstate_global->__pyx_n_s_iv
#define __pyx_n_s_ix_c __pyx_mstate_global->__pyx_n_s_ix_c
#define __pyx_n_s_j __pyx_mstate_global->__pyx_n_s_j
#define __pyx_n_s_k __pyx_mstate_global->__pyx_n_s_k
#define __pyx_n_s_keepdims __pyx_mstate_global->__pyx_n_s_keepdims
#define __pyx_n_u_kendall __pyx_mstate_global->__pyx_n_u_kendall
#define __pyx_n_s_kendalltau __pyx_mstate_global->__pyx_n_s_kendalltau
#define __pyx_n_s_key __pyx_mstate_global->__pyx_n_s_key
#define __pyx_n_s_kind __pyx_mstate_global->__pyx_n_s_kind
#define __pyx_n_s_kind_of_model __pyx_mstate_global->__pyx_n_s_kind_of_model
#define __pyx_n_s_kind_of_model_locals_init_weigh __pyx_mstate_global->__pyx_n_s_kind_of_model_locals_init_weigh
#define __pyx_n_u_km __pyx_mstate_global->__pyx_n_u_km
#define __pyx_n_s_kws __pyx_mstate_global->__pyx_n_s_kws
#define __pyx_n_s_label __pyx_mstate_global->__pyx_n_s_label
#define __pyx_n_s_label_binarize __pyx_mstate_global->__pyx_n_s_label_binarize
#define __pyx_n_s_label_i __pyx_mstate_global->__pyx_n_s_label_i
#define __pyx_n_s_label_importance __pyx_mstate_global->__pyx_n_s_label_importance
#define __pyx_n_u_label_importance __pyx_mstate_global->__pyx_n_u_label_importance
#define __pyx_kp_u_label_importance_line_2612 __pyx_mstate_global->__pyx_kp_u_label_importance_line_2612
#define __pyx_n_s_label_j __pyx_mstate_global->__pyx_n_s_label_j
#define __pyx_n_s_label_to_index __pyx_mstate_global->__pyx_n_s_label_to_index
#define __pyx_n_s_label_y __pyx_mstate_global->__pyx_n_s_label_y
#define __pyx_n_s_label_yt_trailer __pyx_mstate_global->__pyx_n_s_label_yt_trailer
#define __pyx_n_s_labels __pyx_mstate_global->__pyx_n_s_labels
#define __pyx_n_s_lat1 __pyx_mstate_global->__pyx_n_s_lat1
#define __pyx_n_s_lat2 __pyx_mstate_global->__pyx_n_s_lat2
#define __pyx_n_s_latlon1 __pyx_mstate_global->__pyx_n_s_latlon1
#define __pyx_n_s_latlon2 __pyx_mstate_global->__pyx_n_s_latlon2
#define __pyx_n_s_le __pyx_mstate_global->__pyx_n_s_le
#define __pyx_n_s_le_pred __pyx_mstate_global->__pyx_n_s_le_pred
#define __pyx_n_s_le_true __pyx_mstate_global->__pyx_n_s_le_true
#define __pyx_n_s_learning_rate __pyx_mstate_global->__pyx_n_s_learning_rate
#define __pyx_n_s_legend __pyx_mstate_global->__pyx_n_s_legend
#define __pyx_n_s_less __pyx_mstate_global->__pyx_n_s_less
#define __pyx_n_s_linalg __pyx_mstate_global->__pyx_n_s_linalg
#define __pyx_n_u_linear __pyx_mstate_global->__pyx_n_u_linear
#define __pyx_n_s_linear_regression __pyx_mstate_global->__pyx_n_s_linear_regression
#define __pyx_n_u_linear_regression __pyx_mstate_global->__pyx_n_u_linear_regression
#define __pyx_n_s_linfunc __pyx_mstate_global->__pyx_n_s_linfunc
#define __pyx_n_s_linkage __pyx_mstate_global->__pyx_n_s_linkage
#define __pyx_n_s_linkage_matrix __pyx_mstate_global->__pyx_n_s_linkage_matrix
#define __pyx_n_u_linkage_matrix __pyx_mstate_global->__pyx_n_u_linkage_matrix
#define __pyx_n_s_linregress __pyx_mstate_global->__pyx_n_s_linregress
#define __pyx_n_s_linspace __pyx_mstate_global->__pyx_n_s_linspace
#define __pyx_n_u_ll __pyx_mstate_global->__pyx_n_u_ll
#define __pyx_n_s_local_minima_count __pyx_mstate_global->__pyx_n_s_local_minima_count
#define __pyx_n_s_local_minima_indices __pyx_mstate_global->__pyx_n_s_local_minima_indices
#define __pyx_n_s_log __pyx_mstate_global->__pyx_n_s_log
#define __pyx_n_s_log10 __pyx_mstate_global->__pyx_n_s_log10
#define __pyx_n_s_log2 __pyx_mstate_global->__pyx_n_s_log2
#define __pyx_n_s_logarithmic_regression __pyx_mstate_global->__pyx_n_s_logarithmic_regression
#define __pyx_n_u_logarithmic_regression __pyx_mstate_global->__pyx_n_u_logarithmic_regression
#define __pyx_n_s_logger __pyx_mstate_global->__pyx_n_s_logger
#define __pyx_n_s_logify __pyx_mstate_global->__pyx_n_s_logify
#define __pyx_n_s_lon1 __pyx_mstate_global->__pyx_n_s_lon1
#define __pyx_n_s_lon2 __pyx_mstate_global->__pyx_n_s_lon2
#define __pyx_n_s_lower __pyx_mstate_global->__pyx_n_s_lower
#define __pyx_n_s_lr __pyx_mstate_global->__pyx_n_s_lr
#define __pyx_n_s_lstsq __pyx_mstate_global->__pyx_n_s_lstsq
#define __pyx_n_s_m __pyx_mstate_global->__pyx_n_s_m
#define __pyx_n_u_m __pyx_mstate_global->__pyx_n_u_m
#define __pyx_n_u_macro __pyx_mstate_global->__pyx_n_u_macro
#define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
#define __pyx_n_s_make_mxs __pyx_mstate_global->__pyx_n_s_make_mxs
#define __pyx_n_u_make_mxs __pyx_mstate_global->__pyx_n_u_make_mxs
#define __pyx_kp_u_make_mxs_line_2514 __pyx_mstate_global->__pyx_kp_u_make_mxs_line_2514
#define __pyx_n_s_manage_colors __pyx_mstate_global->__pyx_n_s_manage_colors
#define __pyx_n_s_map __pyx_mstate_global->__pyx_n_s_map
#define __pyx_n_s_marker __pyx_mstate_global->__pyx_n_s_marker
#define __pyx_n_s_match_method __pyx_mstate_global->__pyx_n_s_match_method
#define __pyx_n_s_matplotlib __pyx_mstate_global->__pyx_n_s_matplotlib
#define __pyx_n_s_matplotlib_pyplot __pyx_mstate_global->__pyx_n_s_matplotlib_pyplot
#define __pyx_n_s_max __pyx_mstate_global->__pyx_n_s_max
#define __pyx_n_u_max __pyx_mstate_global->__pyx_n_u_max
#define __pyx_n_s_max_depth __pyx_mstate_global->__pyx_n_s_max_depth
#define __pyx_n_s_max_lr __pyx_mstate_global->__pyx_n_s_max_lr
#define __pyx_n_s_maximum __pyx_mstate_global->__pyx_n_s_maximum
#define __pyx_n_s_mean __pyx_mstate_global->__pyx_n_s_mean
#define __pyx_n_s_mean_rank_pred __pyx_mstate_global->__pyx_n_s_mean_rank_pred
#define __pyx_n_s_mean_rank_true __pyx_mstate_global->__pyx_n_s_mean_rank_true
#define __pyx_n_s_method __pyx_mstate_global->__pyx_n_s_method
#define __pyx_n_u_method __pyx_mstate_global->__pyx_n_u_method
#define __pyx_n_s_metric __pyx_mstate_global->__pyx_n_s_metric
#define __pyx_n_u_micro __pyx_mstate_global->__pyx_n_u_micro
#define __pyx_n_s_micro_sensitivity __pyx_mstate_global->__pyx_n_s_micro_sensitivity
#define __pyx_n_s_micro_specificity __pyx_mstate_global->__pyx_n_s_micro_specificity
#define __pyx_n_s_min __pyx_mstate_global->__pyx_n_s_min
#define __pyx_n_u_min __pyx_mstate_global->__pyx_n_u_min
#define __pyx_n_s_min_cost __pyx_mstate_global->__pyx_n_s_min_cost
#define __pyx_n_s_min_non_zero_pred __pyx_mstate_global->__pyx_n_s_min_non_zero_pred
#define __pyx_n_s_minimum __pyx_mstate_global->__pyx_n_s_minimum
#define __pyx_n_s_minmax_scaler __pyx_mstate_global->__pyx_n_s_minmax_scaler
#define __pyx_n_u_minmax_scaler __pyx_mstate_global->__pyx_n_u_minmax_scaler
#define __pyx_kp_u_minmax_scaler_line_2947 __pyx_mstate_global->__pyx_kp_u_minmax_scaler_line_2947
#define __pyx_n_u_mirror __pyx_mstate_global->__pyx_n_u_mirror
#define __pyx_n_s_mode __pyx_mstate_global->__pyx_n_s_mode
#define __pyx_kp_u_mode_must_be_mirror_constant_nea __pyx_mstate_global->__pyx_kp_u_mode_must_be_mirror_constant_nea
#define __pyx_n_s_model_pred __pyx_mstate_global->__pyx_n_s_model_pred
#define __pyx_n_s_model_true __pyx_mstate_global->__pyx_n_s_model_true
#define __pyx_n_s_moving_average __pyx_mstate_global->__pyx_n_s_moving_average
#define __pyx_kp_u_moving_average_line_3046 __pyx_mstate_global->__pyx_kp_u_moving_average_line_3046
#define __pyx_n_s_msg __pyx_mstate_global->__pyx_n_s_msg
#define __pyx_n_s_msg_meth __pyx_mstate_global->__pyx_n_s_msg_meth
#define __pyx_n_s_mu0 __pyx_mstate_global->__pyx_n_s_mu0
#define __pyx_n_s_multi_output __pyx_mstate_global->__pyx_n_s_multi_output
#define __pyx_n_u_multiclass __pyx_mstate_global->__pyx_n_u_multiclass
#define __pyx_n_s_multioutput __pyx_mstate_global->__pyx_n_s_multioutput
#define __pyx_n_s_n __pyx_mstate_global->__pyx_n_s_n
#define __pyx_n_s_n_epochs __pyx_mstate_global->__pyx_n_s_n_epochs
#define __pyx_n_s_n_estimators __pyx_mstate_global->__pyx_n_s_n_estimators
#define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
#define __pyx_n_s_name_2 __pyx_mstate_global->__pyx_n_s_name_2
#define __pyx_n_u_name_2 __pyx_mstate_global->__pyx_n_u_name_2
#define __pyx_n_s_nan __pyx_mstate_global->__pyx_n_s_nan
#define __pyx_n_s_nan_policy __pyx_mstate_global->__pyx_n_s_nan_policy
#define __pyx_n_s_nan_sum __pyx_mstate_global->__pyx_n_s_nan_sum
#define __pyx_n_s_nansum __pyx_mstate_global->__pyx_n_s_nansum
#define __pyx_n_s_ndarray __pyx_mstate_global->__pyx_n_s_ndarray
#define __pyx_n_s_ndim __pyx_mstate_global->__pyx_n_s_ndim
#define __pyx_n_u_nearest __pyx_mstate_global->__pyx_n_u_nearest
#define __pyx_n_u_negative __pyx_mstate_global->__pyx_n_u_negative
#define __pyx_n_s_newaxis __pyx_mstate_global->__pyx_n_s_newaxis
#define __pyx_kp_u_no_of_items_in_clust __pyx_mstate_global->__pyx_kp_u_no_of_items_in_clust
#define __pyx_n_s_noise __pyx_mstate_global->__pyx_n_s_noise
#define __pyx_n_u_none __pyx_mstate_global->__pyx_n_u_none
#define __pyx_n_s_nonzero __pyx_mstate_global->__pyx_n_s_nonzero
#define __pyx_n_s_norm __pyx_mstate_global->__pyx_n_s_norm
#define __pyx_n_s_normalize __pyx_mstate_global->__pyx_n_s_normalize
#define __pyx_n_u_normalize __pyx_mstate_global->__pyx_n_u_normalize
#define __pyx_kp_u_normalize_line_2997 __pyx_mstate_global->__pyx_kp_u_normalize_line_2997
#define __pyx_n_s_normalize_string __pyx_mstate_global->__pyx_n_s_normalize_string
#define __pyx_n_s_northing __pyx_mstate_global->__pyx_n_s_northing
#define __pyx_kp_u_not_found_in __pyx_mstate_global->__pyx_kp_u_not_found_in
#define __pyx_kp_u_not_found_in_DataFrame_columns __pyx_mstate_global->__pyx_kp_u_not_found_in_DataFrame_columns
#define __pyx_n_s_np __pyx_mstate_global->__pyx_n_s_np
#define __pyx_n_s_number __pyx_mstate_global->__pyx_n_s_number
#define __pyx_n_s_numeric_cols __pyx_mstate_global->__pyx_n_s_numeric_cols
#define __pyx_n_s_numpy __pyx_mstate_global->__pyx_n_s_numpy
#define __pyx_n_u_o __pyx_mstate_global->__pyx_n_u_o
#define __pyx_kp_u_ob __pyx_mstate_global->__pyx_kp_u_ob
#define __pyx_n_s_objname __pyx_mstate_global->__pyx_n_s_objname
#define __pyx_kp_u_ok __pyx_mstate_global->__pyx_kp_u_ok
#define __pyx_n_u_ok_2 __pyx_mstate_global->__pyx_n_u_ok_2
#define __pyx_n_u_omit __pyx_mstate_global->__pyx_n_u_omit
#define __pyx_n_s_ones __pyx_mstate_global->__pyx_n_s_ones
#define __pyx_n_s_ones_like __pyx_mstate_global->__pyx_n_s_ones_like
#define __pyx_n_s_optimal_bins __pyx_mstate_global->__pyx_n_s_optimal_bins
#define __pyx_n_s_optimal_idx __pyx_mstate_global->__pyx_n_s_optimal_idx
#define __pyx_n_s_optimal_ordering __pyx_mstate_global->__pyx_n_s_optimal_ordering
#define __pyx_n_s_optimal_threshold __pyx_mstate_global->__pyx_n_s_optimal_threshold
#define __pyx_n_s_optimal_youden __pyx_mstate_global->__pyx_n_s_optimal_youden
#define __pyx_n_s_optimized_spearmanr __pyx_mstate_global->__pyx_n_s_optimized_spearmanr
#define __pyx_n_u_optimized_spearmanr __pyx_mstate_global->__pyx_n_u_optimized_spearmanr
#define __pyx_kp_u_optimized_spearmanr_line_1351 __pyx_mstate_global->__pyx_kp_u_optimized_spearmanr_line_1351
#define __pyx_n_u_or __pyx_mstate_global->__pyx_n_u_or
#define __pyx_kp_u_or_2 __pyx_mstate_global->__pyx_kp_u_or_2
#define __pyx_n_s_order __pyx_mstate_global->__pyx_n_s_order
#define __pyx_n_u_ordinal __pyx_mstate_global->__pyx_n_u_ordinal
#define __pyx_n_u_ovo __pyx_mstate_global->__pyx_n_u_ovo
#define __pyx_n_u_ovr __pyx_mstate_global->__pyx_n_u_ovr
#define __pyx_n_s_p __pyx_mstate_global->__pyx_n_s_p
#define __pyx_n_s_p_value __pyx_mstate_global->__pyx_n_s_p_value
#define __pyx_n_s_p_values __pyx_mstate_global->__pyx_n_s_p_values
#define __pyx_n_s_pair __pyx_mstate_global->__pyx_n_s_pair
#define __pyx_n_s_pair_indices __pyx_mstate_global->__pyx_n_s_pair_indices
#define __pyx_n_s_pairwise_distances __pyx_mstate_global->__pyx_n_s_pairwise_distances
#define __pyx_n_s_pandas __pyx_mstate_global->__pyx_n_s_pandas
#define __pyx_n_s_param_name __pyx_mstate_global->__pyx_n_s_param_name
#define __pyx_n_s_parameter_validator __pyx_mstate_global->__pyx_n_s_parameter_validator
#define __pyx_n_u_parent __pyx_mstate_global->__pyx_n_u_parent
#define __pyx_n_u_passthrough __pyx_mstate_global->__pyx_n_u_passthrough
#define __pyx_n_s_pcov __pyx_mstate_global->__pyx_n_s_pcov
#define __pyx_n_s_pd __pyx_mstate_global->__pyx_n_s_pd
#define __pyx_n_s_pdist __pyx_mstate_global->__pyx_n_s_pdist
#define __pyx_n_u_pearson __pyx_mstate_global->__pyx_n_u_pearson
#define __pyx_n_s_pearsonr __pyx_mstate_global->__pyx_n_s_pearsonr
#define __pyx_n_s_percent_events __pyx_mstate_global->__pyx_n_s_percent_events
#define __pyx_n_s_percent_events_bin __pyx_mstate_global->__pyx_n_s_percent_events_bin
#define __pyx_n_s_percent_non_events __pyx_mstate_global->__pyx_n_s_percent_non_events
#define __pyx_n_s_percent_non_events_bin __pyx_mstate_global->__pyx_n_s_percent_non_events_bin
#define __pyx_n_s_percentile __pyx_mstate_global->__pyx_n_s_percentile
#define __pyx_n_s_pi __pyx_mstate_global->__pyx_n_s_pi
#define __pyx_n_u_pk __pyx_mstate_global->__pyx_n_u_pk
#define __pyx_n_s_plot __pyx_mstate_global->__pyx_n_s_plot
#define __pyx_n_s_plt __pyx_mstate_global->__pyx_n_s_plt
#define __pyx_n_u_poly __pyx_mstate_global->__pyx_n_u_poly
#define __pyx_n_s_poly_coeffs __pyx_mstate_global->__pyx_n_s_poly_coeffs
#define __pyx_n_s_polyder __pyx_mstate_global->__pyx_n_s_polyder
#define __pyx_n_s_polyfit __pyx_mstate_global->__pyx_n_s_polyfit
#define __pyx_n_s_polyorder __pyx_mstate_global->__pyx_n_s_polyorder
#define __pyx_kp_u_polyorder_must_be_less_than_wind __pyx_mstate_global->__pyx_kp_u_polyorder_must_be_less_than_wind
#define __pyx_n_s_polyval __pyx_mstate_global->__pyx_n_s_polyval
#define __pyx_n_s_pop_cat_features __pyx_mstate_global->__pyx_n_s_pop_cat_features
#define __pyx_n_s_popt __pyx_mstate_global->__pyx_n_s_popt
#define __pyx_n_s_pos __pyx_mstate_global->__pyx_n_s_pos
#define __pyx_n_s_pos_label __pyx_mstate_global->__pyx_n_s_pos_label
#define __pyx_kp_u_pos_must_be_nonnegative_and_less __pyx_mstate_global->__pyx_kp_u_pos_must_be_nonnegative_and_less
#define __pyx_kp_u_positions __pyx_mstate_global->__pyx_kp_u_positions
#define __pyx_n_u_positive __pyx_mstate_global->__pyx_n_u_positive
#define __pyx_n_s_positive_preds __pyx_mstate_global->__pyx_n_s_positive_preds
#define __pyx_n_s_power __pyx_mstate_global->__pyx_n_s_power
#define __pyx_n_s_predict __pyx_mstate_global->__pyx_n_s_predict
#define __pyx_n_s_predict_proba __pyx_mstate_global->__pyx_n_s_predict_proba
#define __pyx_n_s_predicted __pyx_mstate_global->__pyx_n_s_predicted
#define __pyx_n_s_predicted_labels __pyx_mstate_global->__pyx_n_s_predicted_labels
#define __pyx_n_s_prev_val __pyx_mstate_global->__pyx_n_s_prev_val
#define __pyx_n_s_print __pyx_mstate_global->__pyx_n_s_print
#define __pyx_n_s_prob_true_class __pyx_mstate_global->__pyx_n_s_prob_true_class
#define __pyx_n_s_profile1 __pyx_mstate_global->__pyx_n_s_profile1
#define __pyx_n_s_profile2 __pyx_mstate_global->__pyx_n_s_profile2
#define __pyx_n_s_profile_angle __pyx_mstate_global->__pyx_n_s_profile_angle
#define __pyx_n_s_profile_line __pyx_mstate_global->__pyx_n_s_profile_line
#define __pyx_n_s_projection __pyx_mstate_global->__pyx_n_s_projection
#define __pyx_n_u_propagate __pyx_mstate_global->__pyx_n_u_propagate
#define __pyx_n_s_pyplot __pyx_mstate_global->__pyx_n_s_pyplot
#define __pyx_n_s_quadratic_regression __pyx_mstate_global->__pyx_n_s_quadratic_regression
#define __pyx_n_u_quadratic_regression __pyx_mstate_global->__pyx_n_u_quadratic_regression
#define __pyx_n_s_quality_control2 __pyx_mstate_global->__pyx_n_s_quality_control2
#define __pyx_kp_u_quality_control2_line_4409 __pyx_mstate_global->__pyx_kp_u_quality_control2_line_4409
#define __pyx_kp_u_r __pyx_mstate_global->__pyx_kp_u_r
#define __pyx_n_s_rad2deg __pyx_mstate_global->__pyx_n_s_rad2deg
#define __pyx_n_u_raise __pyx_mstate_global->__pyx_n_u_raise
#define __pyx_n_s_raise_exception __pyx_mstate_global->__pyx_n_s_raise_exception
#define __pyx_n_s_raise_warn __pyx_mstate_global->__pyx_n_s_raise_warn
#define __pyx_n_u_raises __pyx_mstate_global->__pyx_n_u_raises
#define __pyx_n_s_randn __pyx_mstate_global->__pyx_n_s_randn
#define __pyx_n_s_random __pyx_mstate_global->__pyx_n_s_random
#define __pyx_n_s_range __pyx_mstate_global->__pyx_n_s_range
#define __pyx_n_s_rank_data __pyx_mstate_global->__pyx_n_s_rank_data
#define __pyx_n_u_rank_data __pyx_mstate_global->__pyx_n_u_rank_data
#define __pyx_kp_u_rank_data_line_1263 __pyx_mstate_global->__pyx_kp_u_rank_data_line_1263
#define __pyx_n_s_rankdata __pyx_mstate_global->__pyx_n_s_rankdata
#define __pyx_n_s_ranks __pyx_mstate_global->__pyx_n_s_ranks
#define __pyx_n_s_ranks_pred __pyx_mstate_global->__pyx_n_s_ranks_pred
#define __pyx_n_s_ranks_true __pyx_mstate_global->__pyx_n_s_ranks_true
#define __pyx_n_s_rate __pyx_mstate_global->__pyx_n_s_rate
#define __pyx_n_s_ravel __pyx_mstate_global->__pyx_n_s_ravel
#define __pyx_kp_u_raw_azimuth __pyx_mstate_global->__pyx_kp_u_raw_azimuth
#define __pyx_n_u_raw_values __pyx_mstate_global->__pyx_n_u_raw_values
#define __pyx_n_s_refglossary __pyx_mstate_global->__pyx_n_s_refglossary
#define __pyx_n_u_regression __pyx_mstate_global->__pyx_n_u_regression
#define __pyx_n_u_reject __pyx_mstate_global->__pyx_n_u_reject
#define __pyx_n_s_relevant_mask __pyx_mstate_global->__pyx_n_s_relevant_mask
#define __pyx_n_s_rem __pyx_mstate_global->__pyx_n_s_rem
#define __pyx_n_s_replace __pyx_mstate_global->__pyx_n_s_replace
#define __pyx_n_s_reset_index __pyx_mstate_global->__pyx_n_s_reset_index
#define __pyx_n_s_reshape __pyx_mstate_global->__pyx_n_s_reshape
#define __pyx_n_s_residual __pyx_mstate_global->__pyx_n_s_residual
#define __pyx_n_s_residuals __pyx_mstate_global->__pyx_n_s_residuals
#define __pyx_n_s_residuals_pred __pyx_mstate_global->__pyx_n_s_residuals_pred
#define __pyx_n_s_residuals_true __pyx_mstate_global->__pyx_n_s_residuals_true
#define __pyx_n_s_result __pyx_mstate_global->__pyx_n_s_result
#define __pyx_n_s_results __pyx_mstate_global->__pyx_n_s_results
#define __pyx_n_s_return __pyx_mstate_global->__pyx_n_s_return
#define __pyx_n_s_return_array __pyx_mstate_global->__pyx_n_s_return_array
#define __pyx_n_s_return_confidence __pyx_mstate_global->__pyx_n_s_return_confidence
#define __pyx_n_s_return_counts __pyx_mstate_global->__pyx_n_s_return_counts
#define __pyx_n_s_return_data __pyx_mstate_global->__pyx_n_s_return_data
#define __pyx_n_s_return_mean_dist __pyx_mstate_global->__pyx_n_s_return_mean_dist
#define __pyx_n_s_return_qco __pyx_mstate_global->__pyx_n_s_return_qco
#define __pyx_n_s_return_target_only __pyx_mstate_global->__pyx_n_s_return_target_only
#define __pyx_n_s_return_weighted_rank __pyx_mstate_global->__pyx_n_s_return_weighted_rank
#define __pyx_n_s_return_ymxs __pyx_mstate_global->__pyx_n_s_return_ymxs
#define __pyx_n_s_reverse __pyx_mstate_global->__pyx_n_s_reverse
#define __pyx_n_s_rho __pyx_mstate_global->__pyx_n_s_rho
#define __pyx_n_s_rng __pyx_mstate_global->__pyx_n_s_rng
#define __pyx_n_u_robust __pyx_mstate_global->__pyx_n_u_robust
#define __pyx_n_s_roc_auc_score __pyx_mstate_global->__pyx_n_s_roc_auc_score
#define __pyx_n_s_roc_curve __pyx_mstate_global->__pyx_n_s_roc_curve
#define __pyx_n_s_row __pyx_mstate_global->__pyx_n_s_row
#define __pyx_n_s_row_clusters __pyx_mstate_global->__pyx_n_s_row_clusters
#define __pyx_n_s_row_dist __pyx_mstate_global->__pyx_n_s_row_dist
#define __pyx_kp_u_row_label_1 __pyx_mstate_global->__pyx_kp_u_row_label_1
#define __pyx_kp_u_row_lable_2 __pyx_mstate_global->__pyx_kp_u_row_lable_2
#define __pyx_n_s_rr __pyx_mstate_global->__pyx_n_s_rr
#define __pyx_n_s_s __pyx_mstate_global->__pyx_n_s_s
#define __pyx_n_u_s __pyx_mstate_global->__pyx_n_u_s
#define __pyx_n_s_s_index __pyx_mstate_global->__pyx_n_s_s_index
#define __pyx_n_u_same __pyx_mstate_global->__pyx_n_u_same
#define __pyx_n_s_sample_weight __pyx_mstate_global->__pyx_n_s_sample_weight
#define __pyx_n_s_savgol_coeffs __pyx_mstate_global->__pyx_n_s_savgol_coeffs
#define __pyx_kp_u_savgol_coeffs_line_3949 __pyx_mstate_global->__pyx_kp_u_savgol_coeffs_line_3949
#define __pyx_n_s_savgol_filter __pyx_mstate_global->__pyx_n_s_savgol_filter
#define __pyx_n_u_savgol_filter __pyx_mstate_global->__pyx_n_u_savgol_filter
#define __pyx_kp_u_savgol_filter_line_4159 __pyx_mstate_global->__pyx_kp_u_savgol_filter_line_4159
#define __pyx_n_s_scalePosition __pyx_mstate_global->__pyx_n_s_scalePosition
#define __pyx_kp_u_scalePosition_line_3596 __pyx_mstate_global->__pyx_kp_u_scalePosition_line_3596
#define __pyx_n_s_scalePosition_locals_lambda __pyx_mstate_global->__pyx_n_s_scalePosition_locals_lambda
#define __pyx_n_s_scalePosition_locals_linfunc __pyx_mstate_global->__pyx_n_s_scalePosition_locals_linfunc
#define __pyx_n_s_scale_factor __pyx_mstate_global->__pyx_n_s_scale_factor
#define __pyx_n_s_scale_positions __pyx_mstate_global->__pyx_n_s_scale_positions
#define __pyx_kp_u_scale_positions_line_4567 __pyx_mstate_global->__pyx_kp_u_scale_positions_line_4567
#define __pyx_n_u_scaled __pyx_mstate_global->__pyx_n_u_scaled
#define __pyx_n_s_scipy __pyx_mstate_global->__pyx_n_s_scipy
#define __pyx_n_s_scipy__lib__util __pyx_mstate_global->__pyx_n_s_scipy__lib__util
#define __pyx_n_s_scipy_cluster_hierarchy __pyx_mstate_global->__pyx_n_s_scipy_cluster_hierarchy
#define __pyx_n_s_scipy_linalg __pyx_mstate_global->__pyx_n_s_scipy_linalg
#define __pyx_n_s_scipy_ndimage __pyx_mstate_global->__pyx_n_s_scipy_ndimage
#define __pyx_n_s_scipy_optimize __pyx_mstate_global->__pyx_n_s_scipy_optimize
#define __pyx_n_s_scipy_signal __pyx_mstate_global->__pyx_n_s_scipy_signal
#define __pyx_n_s_scipy_spatial_distance __pyx_mstate_global->__pyx_n_s_scipy_spatial_distance
#define __pyx_n_s_scipy_stats __pyx_mstate_global->__pyx_n_s_scipy_stats
#define __pyx_n_s_score __pyx_mstate_global->__pyx_n_s_score
#define __pyx_n_s_scores __pyx_mstate_global->__pyx_n_s_scores
#define __pyx_n_u_se __pyx_mstate_global->__pyx_n_u_se
#define __pyx_n_s_seen __pyx_mstate_global->__pyx_n_s_seen
#define __pyx_n_s_select_dtypes __pyx_mstate_global->__pyx_n_s_select_dtypes
#define __pyx_n_s_send __pyx_mstate_global->__pyx_n_s_send
#define __pyx_n_s_sens_array __pyx_mstate_global->__pyx_n_s_sens_array
#define __pyx_n_s_sensitivities __pyx_mstate_global->__pyx_n_s_sensitivities
#define __pyx_n_s_sensitivity __pyx_mstate_global->__pyx_n_s_sensitivity
#define __pyx_n_s_set_xlabel __pyx_mstate_global->__pyx_n_s_set_xlabel
#define __pyx_n_s_set_ylabel __pyx_mstate_global->__pyx_n_s_set_ylabel
#define __pyx_n_s_shape __pyx_mstate_global->__pyx_n_s_shape
#define __pyx_n_s_shift __pyx_mstate_global->__pyx_n_s_shift
#define __pyx_n_u_shifted __pyx_mstate_global->__pyx_n_u_shifted
#define __pyx_kp_u_should_be_less_than_the_number __pyx_mstate_global->__pyx_kp_u_should_be_less_than_the_number
#define __pyx_n_s_show __pyx_mstate_global->__pyx_n_s_show
#define __pyx_n_s_shp __pyx_mstate_global->__pyx_n_s_shp
#define __pyx_n_s_significance_threshold __pyx_mstate_global->__pyx_n_s_significance_threshold
#define __pyx_n_s_similarities __pyx_mstate_global->__pyx_n_s_similarities
#define __pyx_n_s_similarity __pyx_mstate_global->__pyx_n_s_similarity
#define __pyx_n_u_simple __pyx_mstate_global->__pyx_n_u_simple
#define __pyx_kp_u_simple_moving_average __pyx_mstate_global->__pyx_kp_u_simple_moving_average
#define __pyx_n_s_simplefilter __pyx_mstate_global->__pyx_n_s_simplefilter
#define __pyx_n_s_sin __pyx_mstate_global->__pyx_n_s_sin
#define __pyx_n_s_sinusoidal_regression __pyx_mstate_global->__pyx_n_s_sinusoidal_regression
#define __pyx_n_u_sinusoidal_regression __pyx_mstate_global->__pyx_n_u_sinusoidal_regression
#define __pyx_n_s_site __pyx_mstate_global->__pyx_n_s_site
#define __pyx_n_s_size __pyx_mstate_global->__pyx_n_s_size
#define __pyx_n_s_sklearn_linear_model __pyx_mstate_global->__pyx_n_s_sklearn_linear_model
#define __pyx_n_s_sklearn_metrics __pyx_mstate_global->__pyx_n_s_sklearn_metrics
#define __pyx_n_s_sklearn_preprocessing __pyx_mstate_global->__pyx_n_s_sklearn_preprocessing
#define __pyx_n_s_sklearn_utils_multiclass __pyx_mstate_global->__pyx_n_s_sklearn_utils_multiclass
#define __pyx_n_u_sma __pyx_mstate_global->__pyx_n_u_sma
#define __pyx_n_s_smart_format __pyx_mstate_global->__pyx_n_s_smart_format
#define __pyx_n_u_soft __pyx_mstate_global->__pyx_n_u_soft
#define __pyx_n_s_sorted_data __pyx_mstate_global->__pyx_n_s_sorted_data
#define __pyx_n_s_sorted_indices __pyx_mstate_global->__pyx_n_s_sorted_indices
#define __pyx_n_s_sorter __pyx_mstate_global->__pyx_n_s_sorter
#define __pyx_n_u_source __pyx_mstate_global->__pyx_n_u_source
#define __pyx_n_s_source_col __pyx_mstate_global->__pyx_n_s_source_col
#define __pyx_n_s_sources __pyx_mstate_global->__pyx_n_s_sources
#define __pyx_n_u_spearman __pyx_mstate_global->__pyx_n_u_spearman
#define __pyx_n_s_spearman_corr __pyx_mstate_global->__pyx_n_s_spearman_corr
#define __pyx_n_s_spearmanr __pyx_mstate_global->__pyx_n_s_spearmanr
#define __pyx_n_s_spec __pyx_mstate_global->__pyx_n_s_spec
#define __pyx_n_s_spec_array __pyx_mstate_global->__pyx_n_s_spec_array
#define __pyx_n_s_specific_y_pred __pyx_mstate_global->__pyx_n_s_specific_y_pred
#define __pyx_n_s_specific_y_true __pyx_mstate_global->__pyx_n_s_specific_y_true
#define __pyx_n_s_specificities __pyx_mstate_global->__pyx_n_s_specificities
#define __pyx_n_s_specificity __pyx_mstate_global->__pyx_n_s_specificity
#define __pyx_n_s_spstats __pyx_mstate_global->__pyx_n_s_spstats
#define __pyx_n_s_sqrt __pyx_mstate_global->__pyx_n_s_sqrt
#define __pyx_n_u_sqrt __pyx_mstate_global->__pyx_n_u_sqrt
#define __pyx_n_s_squareform __pyx_mstate_global->__pyx_n_s_squareform
#define __pyx_n_u_squareform __pyx_mstate_global->__pyx_n_u_squareform
#define __pyx_n_s_squeeze __pyx_mstate_global->__pyx_n_s_squeeze
#define __pyx_n_s_standard_scaler __pyx_mstate_global->__pyx_n_s_standard_scaler
#define __pyx_n_u_standard_scaler __pyx_mstate_global->__pyx_n_u_standard_scaler
#define __pyx_kp_u_standard_scaler_line_2896 __pyx_mstate_global->__pyx_kp_u_standard_scaler_line_2896
#define __pyx_n_s_star_mxs __pyx_mstate_global->__pyx_n_s_star_mxs
#define __pyx_n_s_start __pyx_mstate_global->__pyx_n_s_start
#define __pyx_n_s_state __pyx_mstate_global->__pyx_n_s_state
#define __pyx_n_s_stats __pyx_mstate_global->__pyx_n_s_stats
#define __pyx_n_s_std __pyx_mstate_global->__pyx_n_s_std
#define __pyx_n_u_std __pyx_mstate_global->__pyx_n_u_std
#define __pyx_n_s_std_pred __pyx_mstate_global->__pyx_n_s_std_pred
#define __pyx_n_s_std_true __pyx_mstate_global->__pyx_n_s_std_true
#define __pyx_n_s_step __pyx_mstate_global->__pyx_n_s_step
#define __pyx_n_s_step_function __pyx_mstate_global->__pyx_n_s_step_function
#define __pyx_n_s_step_regression __pyx_mstate_global->__pyx_n_s_step_regression
#define __pyx_n_u_step_regression __pyx_mstate_global->__pyx_n_u_step_regression
#define __pyx_n_s_step_regression_locals_lambda __pyx_mstate_global->__pyx_n_s_step_regression_locals_lambda
#define __pyx_n_s_stop __pyx_mstate_global->__pyx_n_s_stop
#define __pyx_n_s_str __pyx_mstate_global->__pyx_n_s_str
#define __pyx_n_s_strategy __pyx_mstate_global->__pyx_n_s_strategy
#define __pyx_n_u_strategy __pyx_mstate_global->__pyx_n_u_strategy
#define __pyx_n_u_strict __pyx_mstate_global->__pyx_n_u_strict
#define __pyx_n_s_strip __pyx_mstate_global->__pyx_n_s_strip
#define __pyx_n_s_stump __pyx_mstate_global->__pyx_n_s_stump
#define __pyx_n_u_sturges __pyx_mstate_global->__pyx_n_u_sturges
#define __pyx_n_s_subplots __pyx_mstate_global->__pyx_n_s_subplots
#define __pyx_n_s_subset __pyx_mstate_global->__pyx_n_s_subset
#define __pyx_n_s_subtract __pyx_mstate_global->__pyx_n_s_subtract
#define __pyx_n_s_sum __pyx_mstate_global->__pyx_n_s_sum
#define __pyx_n_s_sunburst_data __pyx_mstate_global->__pyx_n_s_sunburst_data
#define __pyx_n_s_support __pyx_mstate_global->__pyx_n_s_support
#define __pyx_n_s_swapaxes __pyx_mstate_global->__pyx_n_s_swapaxes
#define __pyx_n_s_swapped __pyx_mstate_global->__pyx_n_s_swapped
#define __pyx_n_u_ta __pyx_mstate_global->__pyx_n_u_ta
#define __pyx_n_u_target __pyx_mstate_global->__pyx_n_u_target
#define __pyx_n_s_target_col __pyx_mstate_global->__pyx_n_s_target_col
#define __pyx_n_s_target_strs __pyx_mstate_global->__pyx_n_s_target_strs
#define __pyx_n_s_targets __pyx_mstate_global->__pyx_n_s_targets
#define __pyx_n_s_task_type __pyx_mstate_global->__pyx_n_s_task_type
#define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
#define __pyx_n_s_threshold __pyx_mstate_global->__pyx_n_s_threshold
#define __pyx_n_s_thresholds __pyx_mstate_global->__pyx_n_s_thresholds
#define __pyx_n_s_throw __pyx_mstate_global->__pyx_n_s_throw
#define __pyx_n_s_tie_method __pyx_mstate_global->__pyx_n_s_tie_method
#define __pyx_n_s_title __pyx_mstate_global->__pyx_n_s_title
#define __pyx_n_s_to_array __pyx_mstate_global->__pyx_n_s_to_array
#define __pyx_n_s_to_deg __pyx_mstate_global->__pyx_n_s_to_deg
#define __pyx_n_s_to_frame __pyx_mstate_global->__pyx_n_s_to_frame
#define __pyx_n_s_to_latlon_in __pyx_mstate_global->__pyx_n_s_to_latlon_in
#define __pyx_n_s_to_log10 __pyx_mstate_global->__pyx_n_s_to_log10
#define __pyx_n_s_to_numeric_dtypes __pyx_mstate_global->__pyx_n_s_to_numeric_dtypes
#define __pyx_n_s_to_utm_in __pyx_mstate_global->__pyx_n_s_to_utm_in
#define __pyx_n_s_tol __pyx_mstate_global->__pyx_n_s_tol
#define __pyx_n_u_tolerance __pyx_mstate_global->__pyx_n_u_tolerance
#define __pyx_n_s_tolist __pyx_mstate_global->__pyx_n_s_tolist
#define __pyx_n_s_torres_verdin_filter __pyx_mstate_global->__pyx_n_s_torres_verdin_filter
#define __pyx_kp_u_torres_verdin_filter_line_4997 __pyx_mstate_global->__pyx_kp_u_torres_verdin_filter_line_4997
#define __pyx_n_s_torres_verdin_filter_locals__fil __pyx_mstate_global->__pyx_n_s_torres_verdin_filter_locals__fil
#define __pyx_n_s_total __pyx_mstate_global->__pyx_n_s_total
#define __pyx_n_s_total_FN __pyx_mstate_global->__pyx_n_s_total_FN
#define __pyx_n_s_total_FP __pyx_mstate_global->__pyx_n_s_total_FP
#define __pyx_n_s_total_TN __pyx_mstate_global->__pyx_n_s_total_TN
#define __pyx_n_s_total_TP __pyx_mstate_global->__pyx_n_s_total_TP
#define __pyx_n_s_total_cost __pyx_mstate_global->__pyx_n_s_total_cost
#define __pyx_n_s_total_weight __pyx_mstate_global->__pyx_n_s_total_weight
#define __pyx_n_s_tpr __pyx_mstate_global->__pyx_n_s_tpr
#define __pyx_n_s_trailer __pyx_mstate_global->__pyx_n_s_trailer
#define __pyx_kp_u_trailer_must_be_a_non_numeric_st __pyx_mstate_global->__pyx_kp_u_trailer_must_be_a_non_numeric_st
#define __pyx_n_s_transform __pyx_mstate_global->__pyx_n_s_transform
#define __pyx_n_s_true_negatives __pyx_mstate_global->__pyx_n_s_true_negatives
#define __pyx_n_s_true_positives __pyx_mstate_global->__pyx_n_s_true_positives
#define __pyx_n_s_type_of_target __pyx_mstate_global->__pyx_n_s_type_of_target
#define __pyx_n_u_uniform_average __pyx_mstate_global->__pyx_n_u_uniform_average
#define __pyx_n_s_unique __pyx_mstate_global->__pyx_n_s_unique
#define __pyx_n_s_unique_labels __pyx_mstate_global->__pyx_n_s_unique_labels
#define __pyx_n_s_unit __pyx_mstate_global->__pyx_n_s_unit
#define __pyx_n_s_use __pyx_mstate_global->__pyx_n_s_use
#define __pyx_n_s_use_average_dist __pyx_mstate_global->__pyx_n_s_use_average_dist
#define __pyx_kp_u_use_lower_bound __pyx_mstate_global->__pyx_kp_u_use_lower_bound
#define __pyx_kp_u_use_must_be_conv_or_dot __pyx_mstate_global->__pyx_kp_u_use_must_be_conv_or_dot
#define __pyx_n_u_utm __pyx_mstate_global->__pyx_n_u_utm
#define __pyx_n_s_utm_zone __pyx_mstate_global->__pyx_n_s_utm_zone
#define __pyx_kp_u_utm_zone_cannot_be_None_when_pro __pyx_mstate_global->__pyx_kp_u_utm_zone_cannot_be_None_when_pro
#define __pyx_n_s_v __pyx_mstate_global->__pyx_n_s_v
#define __pyx_n_s_valid_mask __pyx_mstate_global->__pyx_n_s_valid_mask
#define __pyx_n_s_valid_methods __pyx_mstate_global->__pyx_n_s_valid_methods
#define __pyx_n_s_valid_policies __pyx_mstate_global->__pyx_n_s_valid_policies
#define __pyx_n_s_validate_length_range __pyx_mstate_global->__pyx_n_s_validate_length_range
#define __pyx_n_s_validate_multiclass_target __pyx_mstate_global->__pyx_n_s_validate_multiclass_target
#define __pyx_n_s_validate_multioutput __pyx_mstate_global->__pyx_n_s_validate_multioutput
#define __pyx_n_s_validate_name_in __pyx_mstate_global->__pyx_n_s_validate_name_in
#define __pyx_n_s_validate_sample_weights __pyx_mstate_global->__pyx_n_s_validate_sample_weights
#define __pyx_n_s_validate_scores __pyx_mstate_global->__pyx_n_s_validate_scores
#define __pyx_n_s_validator __pyx_mstate_global->__pyx_n_s_validator
#define __pyx_n_s_value __pyx_mstate_global->__pyx_n_s_value
#define __pyx_n_u_value __pyx_mstate_global->__pyx_n_u_value
#define __pyx_n_s_value_col __pyx_mstate_global->__pyx_n_s_value_col
#define __pyx_n_s_value_column __pyx_mstate_global->__pyx_n_s_value_column
#define __pyx_n_s_values __pyx_mstate_global->__pyx_n_s_values
#define __pyx_n_u_values __pyx_mstate_global->__pyx_n_u_values
#define __pyx_n_s_var __pyx_mstate_global->__pyx_n_s_var
#define __pyx_n_s_var_pred __pyx_mstate_global->__pyx_n_s_var_pred
#define __pyx_n_s_var_true __pyx_mstate_global->__pyx_n_s_var_true
#define __pyx_n_s_vectorize __pyx_mstate_global->__pyx_n_s_vectorize
#define __pyx_n_s_view __pyx_mstate_global->__pyx_n_s_view
#define __pyx_n_s_vstack __pyx_mstate_global->__pyx_n_s_vstack
#define __pyx_n_s_w __pyx_mstate_global->__pyx_n_s_w
#define __pyx_n_s_warn __pyx_mstate_global->__pyx_n_s_warn
#define __pyx_n_s_warnings __pyx_mstate_global->__pyx_n_s_warnings
#define __pyx_n_u_weight __pyx_mstate_global->__pyx_n_u_weight
#define __pyx_n_s_weight_factor __pyx_mstate_global->__pyx_n_s_weight_factor
#define __pyx_n_u_weighted __pyx_mstate_global->__pyx_n_u_weighted
#define __pyx_kp_u_weighted_moving_average __pyx_mstate_global->__pyx_kp_u_weighted_moving_average
#define __pyx_n_s_weighted_rank __pyx_mstate_global->__pyx_n_s_weighted_rank
#define __pyx_n_s_weighted_spearman_corr __pyx_mstate_global->__pyx_n_s_weighted_spearman_corr
#define __pyx_n_s_weighted_spearman_rank __pyx_mstate_global->__pyx_n_s_weighted_spearman_rank
#define __pyx_n_u_weighted_spearman_rank __pyx_mstate_global->__pyx_n_u_weighted_spearman_rank
#define __pyx_kp_u_weighted_spearman_rank_line_1795 __pyx_mstate_global->__pyx_kp_u_weighted_spearman_rank_line_1795
#define __pyx_n_s_weighted_spearman_rank_locals_we __pyx_mstate_global->__pyx_n_s_weighted_spearman_rank_locals_we
#define __pyx_n_s_weights __pyx_mstate_global->__pyx_n_s_weights
#define __pyx_n_s_wf __pyx_mstate_global->__pyx_n_s_wf
#define __pyx_n_s_where __pyx_mstate_global->__pyx_n_s_where
#define __pyx_n_s_window_length __pyx_mstate_global->__pyx_n_s_window_length
#define __pyx_kp_u_window_length_must_be_odd __pyx_mstate_global->__pyx_kp_u_window_length_must_be_odd
#define __pyx_n_s_window_size __pyx_mstate_global->__pyx_n_s_window_size
#define __pyx_n_s_window_size_factor __pyx_mstate_global->__pyx_n_s_window_size_factor
#define __pyx_kp_u_window_size_has_to_be_of_type_in __pyx_mstate_global->__pyx_kp_u_window_size_has_to_be_of_type_in
#define __pyx_kp_u_window_size_is_too_large_for_ave __pyx_mstate_global->__pyx_kp_u_window_size_is_too_large_for_ave
#define __pyx_kp_u_window_size_size_must_be_a_posit __pyx_mstate_global->__pyx_kp_u_window_size_size_must_be_a_posit
#define __pyx_n_s_window_start __pyx_mstate_global->__pyx_n_s_window_start
#define __pyx_n_s_window_stop __pyx_mstate_global->__pyx_n_s_window_stop
#define __pyx_n_u_wma __pyx_mstate_global->__pyx_n_u_wma
#define __pyx_n_u_wrap __pyx_mstate_global->__pyx_n_u_wrap
#define __pyx_n_s_x __pyx_mstate_global->__pyx_n_s_x
#define __pyx_n_u_x __pyx_mstate_global->__pyx_n_u_x
#define __pyx_kp_u_x_and_y_arrays_must_have_the_sa __pyx_mstate_global->__pyx_kp_u_x_and_y_arrays_must_have_the_sa
#define __pyx_n_s_x_edge __pyx_mstate_global->__pyx_n_s_x_edge
#define __pyx_kp_u_x_y_are_not_in_longitude_latitud __pyx_mstate_global->__pyx_kp_u_x_y_are_not_in_longitude_latitud
#define __pyx_n_s_xdata __pyx_mstate_global->__pyx_n_s_xdata
#define __pyx_n_s_xlabel __pyx_mstate_global->__pyx_n_s_xlabel
#define __pyx_n_s_xlon __pyx_mstate_global->__pyx_n_s_xlon
#define __pyx_kp_u_xlon_and_ylat_arguments_are_grea __pyx_mstate_global->__pyx_kp_u_xlon_and_ylat_arguments_are_grea
#define __pyx_n_s_xs __pyx_mstate_global->__pyx_n_s_xs
#define __pyx_n_s_xx __pyx_mstate_global->__pyx_n_s_xx
#define __pyx_n_s_xx_edge __pyx_mstate_global->__pyx_n_s_xx_edge
#define __pyx_n_s_y __pyx_mstate_global->__pyx_n_s_y
#define __pyx_n_u_y __pyx_mstate_global->__pyx_n_u_y
#define __pyx_n_s_y_bin __pyx_mstate_global->__pyx_n_s_y_bin
#define __pyx_n_s_y_edge __pyx_mstate_global->__pyx_n_s_y_edge
#define __pyx_n_s_y_max __pyx_mstate_global->__pyx_n_s_y_max
#define __pyx_n_s_y_mean __pyx_mstate_global->__pyx_n_s_y_mean
#define __pyx_n_s_y_min __pyx_mstate_global->__pyx_n_s_y_min
#define __pyx_n_s_y_norm __pyx_mstate_global->__pyx_n_s_y_norm
#define __pyx_n_s_y_normalized __pyx_mstate_global->__pyx_n_s_y_normalized
#define __pyx_n_s_y_numeric __pyx_mstate_global->__pyx_n_s_y_numeric
#define __pyx_n_s_y_pred __pyx_mstate_global->__pyx_n_s_y_pred
#define __pyx_n_u_y_pred __pyx_mstate_global->__pyx_n_u_y_pred
#define __pyx_n_s_y_pred_binary __pyx_mstate_global->__pyx_n_s_y_pred_binary
#define __pyx_n_s_y_pred_indices __pyx_mstate_global->__pyx_n_s_y_pred_indices
#define __pyx_n_s_y_pred_pair __pyx_mstate_global->__pyx_n_s_y_pred_pair
#define __pyx_n_s_y_scaled __pyx_mstate_global->__pyx_n_s_y_scaled
#define __pyx_n_s_y_scores __pyx_mstate_global->__pyx_n_s_y_scores
#define __pyx_n_s_y_std __pyx_mstate_global->__pyx_n_s_y_std
#define __pyx_n_s_y_true __pyx_mstate_global->__pyx_n_s_y_true
#define __pyx_n_u_y_true __pyx_mstate_global->__pyx_n_u_y_true
#define __pyx_kp_u_y_true_and_y_pred_must_contain_n __pyx_mstate_global->__pyx_kp_u_y_true_and_y_pred_must_contain_n
#define __pyx_kp_u_y_true_and_y_pred_should_be_1_di __pyx_mstate_global->__pyx_kp_u_y_true_and_y_pred_should_be_1_di
#define __pyx_n_s_y_true_binarized __pyx_mstate_global->__pyx_n_s_y_true_binarized
#define __pyx_n_s_y_true_binary __pyx_mstate_global->__pyx_n_s_y_true_binary
#define __pyx_n_s_y_true_encoded __pyx_mstate_global->__pyx_n_s_y_true_encoded
#define __pyx_n_s_y_true_indices __pyx_mstate_global->__pyx_n_s_y_true_indices
#define __pyx_n_s_y_true_pair __pyx_mstate_global->__pyx_n_s_y_true_pair
#define __pyx_n_s_ya __pyx_mstate_global->__pyx_n_s_ya
#define __pyx_n_s_ydata __pyx_mstate_global->__pyx_n_s_ydata
#define __pyx_n_u_ydata __pyx_mstate_global->__pyx_n_u_ydata
#define __pyx_n_s_ydata_new __pyx_mstate_global->__pyx_n_s_ydata_new
#define __pyx_n_s_yield __pyx_mstate_global->__pyx_n_s_yield
#define __pyx_n_s_ylabel __pyx_mstate_global->__pyx_n_s_ylabel
#define __pyx_n_s_ylat __pyx_mstate_global->__pyx_n_s_ylat
#define __pyx_n_s_ymxs __pyx_mstate_global->__pyx_n_s_ymxs
#define __pyx_n_s_youdens_index __pyx_mstate_global->__pyx_n_s_youdens_index
#define __pyx_n_s_ys __pyx_mstate_global->__pyx_n_s_ys
#define __pyx_n_s_yt __pyx_mstate_global->__pyx_n_s_yt
#define __pyx_kp_u_yt_should_not_contain_NaN_values __pyx_mstate_global->__pyx_kp_u_yt_should_not_contain_NaN_values
#define __pyx_n_s_yt_transformed __pyx_mstate_global->__pyx_n_s_yt_transformed
#define __pyx_n_s_yy __pyx_mstate_global->__pyx_n_s_yy
#define __pyx_n_s_z __pyx_mstate_global->__pyx_n_s_z
#define __pyx_n_s_zero_division __pyx_mstate_global->__pyx_n_s_zero_division
#define __pyx_n_s_zeros __pyx_mstate_global->__pyx_n_s_zeros
#define __pyx_n_s_zeros_like __pyx_mstate_global->__pyx_n_s_zeros_like
#define __pyx_n_s_zip __pyx_mstate_global->__pyx_n_s_zip
#define __pyx_float__5 __pyx_mstate_global->__pyx_float__5
#define __pyx_float_0_ __pyx_mstate_global->__pyx_float_0_
#define __pyx_float_1_ __pyx_mstate_global->__pyx_float_1_
#define __pyx_float_0_0 __pyx_mstate_global->__pyx_float_0_0
#define __pyx_float_0_1 __pyx_mstate_global->__pyx_float_0_1
#define __pyx_float_0_5 __pyx_mstate_global->__pyx_float_0_5
#define __pyx_float_1_0 __pyx_mstate_global->__pyx_float_1_0
#define __pyx_float_1e1 __pyx_mstate_global->__pyx_float_1e1
#define __pyx_float_90_ __pyx_mstate_global->__pyx_float_90_
#define __pyx_float_1_96 __pyx_mstate_global->__pyx_float_1_96
#define __pyx_float_100_ __pyx_mstate_global->__pyx_float_100_
#define __pyx_float_180_ __pyx_mstate_global->__pyx_float_180_
#define __pyx_float_1eneg_2 __pyx_mstate_global->__pyx_float_1eneg_2
#define __pyx_float_1eneg_5 __pyx_mstate_global->__pyx_float_1eneg_5
#define __pyx_float_1eneg_7 __pyx_mstate_global->__pyx_float_1eneg_7
#define __pyx_float_1eneg_10 __pyx_mstate_global->__pyx_float_1eneg_10
#define __pyx_float_1eneg_15 __pyx_mstate_global->__pyx_float_1eneg_15
#define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
#define __pyx_int_1 __pyx_mstate_global->__pyx_int_1
#define __pyx_int_2 __pyx_mstate_global->__pyx_int_2
#define __pyx_int_3 __pyx_mstate_global->__pyx_int_3
#define __pyx_int_4 __pyx_mstate_global->__pyx_int_4
#define __pyx_int_10 __pyx_mstate_global->__pyx_int_10
#define __pyx_int_25 __pyx_mstate_global->__pyx_int_25
#define __pyx_int_75 __pyx_mstate_global->__pyx_int_75
#define __pyx_int_90 __pyx_mstate_global->__pyx_int_90
#define __pyx_int_100 __pyx_mstate_global->__pyx_int_100
#define __pyx_int_180 __pyx_mstate_global->__pyx_int_180
#define __pyx_int_360 __pyx_mstate_global->__pyx_int_360
#define __pyx_int_neg_1 __pyx_mstate_global->__pyx_int_neg_1
#define __pyx_codeobj_ __pyx_mstate_global->__pyx_codeobj_
#define __pyx_slice__9 __pyx_mstate_global->__pyx_slice__9
#define __pyx_tuple__3 __pyx_mstate_global->__pyx_tuple__3
#define __pyx_tuple__4 __pyx_mstate_global->__pyx_tuple__4
#define __pyx_tuple__5 __pyx_mstate_global->__pyx_tuple__5
#define __pyx_tuple__7 __pyx_mstate_global->__pyx_tuple__7
#define __pyx_slice__16 __pyx_mstate_global->__pyx_slice__16
#define __pyx_slice__69 __pyx_mstate_global->__pyx_slice__69
#define __pyx_tuple__10 __pyx_mstate_global->__pyx_tuple__10
#define __pyx_tuple__11 __pyx_mstate_global->__pyx_tuple__11
#define __pyx_tuple__12 __pyx_mstate_global->__pyx_tuple__12
#define __pyx_tuple__13 __pyx_mstate_global->__pyx_tuple__13
#define __pyx_tuple__19 __pyx_mstate_global->__pyx_tuple__19
#define __pyx_tuple__21 __pyx_mstate_global->__pyx_tuple__21
#define __pyx_tuple__24 __pyx_mstate_global->__pyx_tuple__24
#define __pyx_tuple__27 __pyx_mstate_global->__pyx_tuple__27
#define __pyx_tuple__34 __pyx_mstate_global->__pyx_tuple__34
#define __pyx_tuple__36 __pyx_mstate_global->__pyx_tuple__36
#define __pyx_tuple__40 __pyx_mstate_global->__pyx_tuple__40
#define __pyx_tuple__41 __pyx_mstate_global->__pyx_tuple__41
#define __pyx_tuple__44 __pyx_mstate_global->__pyx_tuple__44
#define __pyx_tuple__47 __pyx_mstate_global->__pyx_tuple__47
#define __pyx_tuple__48 __pyx_mstate_global->__pyx_tuple__48
#define __pyx_tuple__50 __pyx_mstate_global->__pyx_tuple__50
#define __pyx_tuple__51 __pyx_mstate_global->__pyx_tuple__51
#define __pyx_tuple__52 __pyx_mstate_global->__pyx_tuple__52
#define __pyx_tuple__55 __pyx_mstate_global->__pyx_tuple__55
#define __pyx_tuple__56 __pyx_mstate_global->__pyx_tuple__56
#define __pyx_tuple__57 __pyx_mstate_global->__pyx_tuple__57
#define __pyx_tuple__58 __pyx_mstate_global->__pyx_tuple__58
#define __pyx_tuple__60 __pyx_mstate_global->__pyx_tuple__60
#define __pyx_tuple__61 __pyx_mstate_global->__pyx_tuple__61
#define __pyx_tuple__62 __pyx_mstate_global->__pyx_tuple__62
#define __pyx_tuple__63 __pyx_mstate_global->__pyx_tuple__63
#define __pyx_tuple__67 __pyx_mstate_global->__pyx_tuple__67
#define __pyx_tuple__68 __pyx_mstate_global->__pyx_tuple__68
#define __pyx_tuple__72 __pyx_mstate_global->__pyx_tuple__72
#define __pyx_tuple__73 __pyx_mstate_global->__pyx_tuple__73
#define __pyx_tuple__86 __pyx_mstate_global->__pyx_tuple__86
#define __pyx_tuple__87 __pyx_mstate_global->__pyx_tuple__87
#define __pyx_tuple__89 __pyx_mstate_global->__pyx_tuple__89
#define __pyx_tuple__90 __pyx_mstate_global->__pyx_tuple__90
#define __pyx_tuple__92 __pyx_mstate_global->__pyx_tuple__92
#define __pyx_tuple__94 __pyx_mstate_global->__pyx_tuple__94
#define __pyx_tuple__95 __pyx_mstate_global->__pyx_tuple__95
#define __pyx_tuple__96 __pyx_mstate_global->__pyx_tuple__96
#define __pyx_tuple__99 __pyx_mstate_global->__pyx_tuple__99
#define __pyx_codeobj__6 __pyx_mstate_global->__pyx_codeobj__6
#define __pyx_codeobj__8 __pyx_mstate_global->__pyx_codeobj__8
#define __pyx_slice__109 __pyx_mstate_global->__pyx_slice__109
#define __pyx_slice__116 __pyx_mstate_global->__pyx_slice__116
#define __pyx_slice__123 __pyx_mstate_global->__pyx_slice__123
#define __pyx_tuple__101 __pyx_mstate_global->__pyx_tuple__101
#define __pyx_tuple__102 __pyx_mstate_global->__pyx_tuple__102
#define __pyx_tuple__104 __pyx_mstate_global->__pyx_tuple__104
#define __pyx_tuple__105 __pyx_mstate_global->__pyx_tuple__105
#define __pyx_tuple__106 __pyx_mstate_global->__pyx_tuple__106
#define __pyx_tuple__111 __pyx_mstate_global->__pyx_tuple__111
#define __pyx_tuple__114 __pyx_mstate_global->__pyx_tuple__114
#define __pyx_tuple__115 __pyx_mstate_global->__pyx_tuple__115
#define __pyx_tuple__118 __pyx_mstate_global->__pyx_tuple__118
#define __pyx_tuple__119 __pyx_mstate_global->__pyx_tuple__119
#define __pyx_tuple__120 __pyx_mstate_global->__pyx_tuple__120
#define __pyx_tuple__121 __pyx_mstate_global->__pyx_tuple__121
#define __pyx_tuple__124 __pyx_mstate_global->__pyx_tuple__124
#define __pyx_tuple__125 __pyx_mstate_global->__pyx_tuple__125
#define __pyx_tuple__129 __pyx_mstate_global->__pyx_tuple__129
#define __pyx_tuple__130 __pyx_mstate_global->__pyx_tuple__130
#define __pyx_tuple__132 __pyx_mstate_global->__pyx_tuple__132
#define __pyx_tuple__133 __pyx_mstate_global->__pyx_tuple__133
#define __pyx_tuple__139 __pyx_mstate_global->__pyx_tuple__139
#define __pyx_tuple__143 __pyx_mstate_global->__pyx_tuple__143
#define __pyx_tuple__147 __pyx_mstate_global->__pyx_tuple__147
#define __pyx_tuple__150 __pyx_mstate_global->__pyx_tuple__150
#define __pyx_tuple__151 __pyx_mstate_global->__pyx_tuple__151
#define __pyx_tuple__152 __pyx_mstate_global->__pyx_tuple__152
#define __pyx_tuple__153 __pyx_mstate_global->__pyx_tuple__153
#define __pyx_tuple__154 __pyx_mstate_global->__pyx_tuple__154
#define __pyx_tuple__155 __pyx_mstate_global->__pyx_tuple__155
#define __pyx_tuple__156 __pyx_mstate_global->__pyx_tuple__156
#define __pyx_tuple__157 __pyx_mstate_global->__pyx_tuple__157
#define __pyx_tuple__158 __pyx_mstate_global->__pyx_tuple__158
#define __pyx_tuple__159 __pyx_mstate_global->__pyx_tuple__159
#define __pyx_tuple__160 __pyx_mstate_global->__pyx_tuple__160
#define __pyx_tuple__161 __pyx_mstate_global->__pyx_tuple__161
#define __pyx_tuple__162 __pyx_mstate_global->__pyx_tuple__162
#define __pyx_tuple__163 __pyx_mstate_global->__pyx_tuple__163
#define __pyx_tuple__164 __pyx_mstate_global->__pyx_tuple__164
#define __pyx_tuple__165 __pyx_mstate_global->__pyx_tuple__165
#define __pyx_tuple__166 __pyx_mstate_global->__pyx_tuple__166
#define __pyx_tuple__167 __pyx_mstate_global->__pyx_tuple__167
#define __pyx_tuple__168 __pyx_mstate_global->__pyx_tuple__168
#define __pyx_tuple__169 __pyx_mstate_global->__pyx_tuple__169
#define __pyx_tuple__170 __pyx_mstate_global->__pyx_tuple__170
#define __pyx_tuple__171 __pyx_mstate_global->__pyx_tuple__171
#define __pyx_tuple__172 __pyx_mstate_global->__pyx_tuple__172
#define __pyx_tuple__173 __pyx_mstate_global->__pyx_tuple__173
#define __pyx_tuple__174 __pyx_mstate_global->__pyx_tuple__174
#define __pyx_tuple__175 __pyx_mstate_global->__pyx_tuple__175
#define __pyx_tuple__176 __pyx_mstate_global->__pyx_tuple__176
#define __pyx_tuple__178 __pyx_mstate_global->__pyx_tuple__178
#define __pyx_tuple__179 __pyx_mstate_global->__pyx_tuple__179
#define __pyx_tuple__180 __pyx_mstate_global->__pyx_tuple__180
#define __pyx_tuple__181 __pyx_mstate_global->__pyx_tuple__181
#define __pyx_tuple__182 __pyx_mstate_global->__pyx_tuple__182
#define __pyx_tuple__183 __pyx_mstate_global->__pyx_tuple__183
#define __pyx_tuple__184 __pyx_mstate_global->__pyx_tuple__184
#define __pyx_tuple__185 __pyx_mstate_global->__pyx_tuple__185
#define __pyx_tuple__186 __pyx_mstate_global->__pyx_tuple__186
#define __pyx_tuple__187 __pyx_mstate_global->__pyx_tuple__187
#define __pyx_tuple__188 __pyx_mstate_global->__pyx_tuple__188
#define __pyx_tuple__189 __pyx_mstate_global->__pyx_tuple__189
#define __pyx_tuple__190 __pyx_mstate_global->__pyx_tuple__190
#define __pyx_tuple__191 __pyx_mstate_global->__pyx_tuple__191
#define __pyx_tuple__192 __pyx_mstate_global->__pyx_tuple__192
#define __pyx_tuple__193 __pyx_mstate_global->__pyx_tuple__193
#define __pyx_tuple__194 __pyx_mstate_global->__pyx_tuple__194
#define __pyx_tuple__195 __pyx_mstate_global->__pyx_tuple__195
#define __pyx_tuple__196 __pyx_mstate_global->__pyx_tuple__196
#define __pyx_tuple__197 __pyx_mstate_global->__pyx_tuple__197
#define __pyx_tuple__198 __pyx_mstate_global->__pyx_tuple__198
#define __pyx_tuple__199 __pyx_mstate_global->__pyx_tuple__199
#define __pyx_tuple__200 __pyx_mstate_global->__pyx_tuple__200
#define __pyx_tuple__201 __pyx_mstate_global->__pyx_tuple__201
#define __pyx_tuple__202 __pyx_mstate_global->__pyx_tuple__202
#define __pyx_tuple__203 __pyx_mstate_global->__pyx_tuple__203
#define __pyx_tuple__204 __pyx_mstate_global->__pyx_tuple__204
#define __pyx_tuple__205 __pyx_mstate_global->__pyx_tuple__205
#define __pyx_tuple__206 __pyx_mstate_global->__pyx_tuple__206
#define __pyx_tuple__207 __pyx_mstate_global->__pyx_tuple__207
#define __pyx_tuple__208 __pyx_mstate_global->__pyx_tuple__208
#define __pyx_tuple__209 __pyx_mstate_global->__pyx_tuple__209
#define __pyx_tuple__210 __pyx_mstate_global->__pyx_tuple__210
#define __pyx_tuple__211 __pyx_mstate_global->__pyx_tuple__211
#define __pyx_tuple__212 __pyx_mstate_global->__pyx_tuple__212
#define __pyx_tuple__213 __pyx_mstate_global->__pyx_tuple__213
#define __pyx_tuple__214 __pyx_mstate_global->__pyx_tuple__214
#define __pyx_tuple__215 __pyx_mstate_global->__pyx_tuple__215
#define __pyx_tuple__216 __pyx_mstate_global->__pyx_tuple__216
#define __pyx_tuple__217 __pyx_mstate_global->__pyx_tuple__217
#define __pyx_tuple__218 __pyx_mstate_global->__pyx_tuple__218
#define __pyx_tuple__219 __pyx_mstate_global->__pyx_tuple__219
#define __pyx_tuple__220 __pyx_mstate_global->__pyx_tuple__220
#define __pyx_tuple__221 __pyx_mstate_global->__pyx_tuple__221
#define __pyx_tuple__222 __pyx_mstate_global->__pyx_tuple__222
#define __pyx_tuple__223 __pyx_mstate_global->__pyx_tuple__223
#define __pyx_tuple__224 __pyx_mstate_global->__pyx_tuple__224
#define __pyx_tuple__225 __pyx_mstate_global->__pyx_tuple__225
#define __pyx_tuple__226 __pyx_mstate_global->__pyx_tuple__226
#define __pyx_tuple__227 __pyx_mstate_global->__pyx_tuple__227
#define __pyx_tuple__228 __pyx_mstate_global->__pyx_tuple__228
#define __pyx_tuple__229 __pyx_mstate_global->__pyx_tuple__229
#define __pyx_tuple__230 __pyx_mstate_global->__pyx_tuple__230
#define __pyx_tuple__231 __pyx_mstate_global->__pyx_tuple__231
#define __pyx_tuple__232 __pyx_mstate_global->__pyx_tuple__232
#define __pyx_tuple__233 __pyx_mstate_global->__pyx_tuple__233
#define __pyx_tuple__234 __pyx_mstate_global->__pyx_tuple__234
#define __pyx_tuple__235 __pyx_mstate_global->__pyx_tuple__235
#define __pyx_tuple__236 __pyx_mstate_global->__pyx_tuple__236
#define __pyx_tuple__237 __pyx_mstate_global->__pyx_tuple__237
#define __pyx_tuple__238 __pyx_mstate_global->__pyx_tuple__238
#define __pyx_tuple__239 __pyx_mstate_global->__pyx_tuple__239
#define __pyx_codeobj__14 __pyx_mstate_global->__pyx_codeobj__14
#define __pyx_codeobj__15 __pyx_mstate_global->__pyx_codeobj__15
#define __pyx_codeobj__17 __pyx_mstate_global->__pyx_codeobj__17
#define __pyx_codeobj__18 __pyx_mstate_global->__pyx_codeobj__18
#define __pyx_codeobj__20 __pyx_mstate_global->__pyx_codeobj__20
#define __pyx_codeobj__22 __pyx_mstate_global->__pyx_codeobj__22
#define __pyx_codeobj__23 __pyx_mstate_global->__pyx_codeobj__23
#define __pyx_codeobj__25 __pyx_mstate_global->__pyx_codeobj__25
#define __pyx_codeobj__26 __pyx_mstate_global->__pyx_codeobj__26
#define __pyx_codeobj__28 __pyx_mstate_global->__pyx_codeobj__28
#define __pyx_codeobj__29 __pyx_mstate_global->__pyx_codeobj__29
#define __pyx_codeobj__30 __pyx_mstate_global->__pyx_codeobj__30
#define __pyx_codeobj__32 __pyx_mstate_global->__pyx_codeobj__32
#define __pyx_codeobj__33 __pyx_mstate_global->__pyx_codeobj__33
#define __pyx_codeobj__35 __pyx_mstate_global->__pyx_codeobj__35
#define __pyx_codeobj__37 __pyx_mstate_global->__pyx_codeobj__37
#define __pyx_codeobj__38 __pyx_mstate_global->__pyx_codeobj__38
#define __pyx_codeobj__42 __pyx_mstate_global->__pyx_codeobj__42
#define __pyx_codeobj__43 __pyx_mstate_global->__pyx_codeobj__43
#define __pyx_codeobj__45 __pyx_mstate_global->__pyx_codeobj__45
#define __pyx_codeobj__46 __pyx_mstate_global->__pyx_codeobj__46
#define __pyx_codeobj__49 __pyx_mstate_global->__pyx_codeobj__49
#define __pyx_codeobj__53 __pyx_mstate_global->__pyx_codeobj__53
#define __pyx_codeobj__54 __pyx_mstate_global->__pyx_codeobj__54
#define __pyx_codeobj__59 __pyx_mstate_global->__pyx_codeobj__59
#define __pyx_codeobj__64 __pyx_mstate_global->__pyx_codeobj__64
#define __pyx_codeobj__66 __pyx_mstate_global->__pyx_codeobj__66
#define __pyx_codeobj__71 __pyx_mstate_global->__pyx_codeobj__71
#define __pyx_codeobj__74 __pyx_mstate_global->__pyx_codeobj__74
#define __pyx_codeobj__75 __pyx_mstate_global->__pyx_codeobj__75
#define __pyx_codeobj__76 __pyx_mstate_global->__pyx_codeobj__76
#define __pyx_codeobj__77 __pyx_mstate_global->__pyx_codeobj__77
#define __pyx_codeobj__78 __pyx_mstate_global->__pyx_codeobj__78
#define __pyx_codeobj__79 __pyx_mstate_global->__pyx_codeobj__79
#define __pyx_codeobj__80 __pyx_mstate_global->__pyx_codeobj__80
#define __pyx_codeobj__81 __pyx_mstate_global->__pyx_codeobj__81
#define __pyx_codeobj__82 __pyx_mstate_global->__pyx_codeobj__82
#define __pyx_codeobj__83 __pyx_mstate_global->__pyx_codeobj__83
#define __pyx_codeobj__84 __pyx_mstate_global->__pyx_codeobj__84
#define __pyx_codeobj__85 __pyx_mstate_global->__pyx_codeobj__85
#define __pyx_codeobj__91 __pyx_mstate_global->__pyx_codeobj__91
#define __pyx_codeobj__93 __pyx_mstate_global->__pyx_codeobj__93
#define __pyx_codeobj__97 __pyx_mstate_global->__pyx_codeobj__97
#define __pyx_codeobj__98 __pyx_mstate_global->__pyx_codeobj__98
#define __pyx_codeobj__100 __pyx_mstate_global->__pyx_codeobj__100
#define __pyx_codeobj__103 __pyx_mstate_global->__pyx_codeobj__103
#define __pyx_codeobj__108 __pyx_mstate_global->__pyx_codeobj__108
#define __pyx_codeobj__110 __pyx_mstate_global->__pyx_codeobj__110
#define __pyx_codeobj__112 __pyx_mstate_global->__pyx_codeobj__112
#define __pyx_codeobj__113 __pyx_mstate_global->__pyx_codeobj__113
#define __pyx_codeobj__117 __pyx_mstate_global->__pyx_codeobj__117
#define __pyx_codeobj__122 __pyx_mstate_global->__pyx_codeobj__122
#define __pyx_codeobj__126 __pyx_mstate_global->__pyx_codeobj__126
#define __pyx_codeobj__127 __pyx_mstate_global->__pyx_codeobj__127
#define __pyx_codeobj__128 __pyx_mstate_global->__pyx_codeobj__128
#define __pyx_codeobj__131 __pyx_mstate_global->__pyx_codeobj__131
#define __pyx_codeobj__134 __pyx_mstate_global->__pyx_codeobj__134
#define __pyx_codeobj__135 __pyx_mstate_global->__pyx_codeobj__135
#define __pyx_codeobj__136 __pyx_mstate_global->__pyx_codeobj__136
#define __pyx_codeobj__137 __pyx_mstate_global->__pyx_codeobj__137
#define __pyx_codeobj__138 __pyx_mstate_global->__pyx_codeobj__138
#define __pyx_codeobj__140 __pyx_mstate_global->__pyx_codeobj__140
#define __pyx_codeobj__141 __pyx_mstate_global->__pyx_codeobj__141
#define __pyx_codeobj__142 __pyx_mstate_global->__pyx_codeobj__142
#define __pyx_codeobj__144 __pyx_mstate_global->__pyx_codeobj__144
#define __pyx_codeobj__145 __pyx_mstate_global->__pyx_codeobj__145
#define __pyx_codeobj__146 __pyx_mstate_global->__pyx_codeobj__146
#define __pyx_codeobj__148 __pyx_mstate_global->__pyx_codeobj__148
#define __pyx_codeobj__149 __pyx_mstate_global->__pyx_codeobj__149
/* #### Code section: module_code ### */

/* "gofast/tools/mathex.pyx":97
 *     ]
 * 
 * def compute_p_values(             # <<<<<<<<<<<<<<
 *     data, depvar,
 *     method: str='pearson',
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_1compute_p_values(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_compute_p_values, "\n    Compute p-values for the correlation between each independent variable\n    and a dependent variable.\n\n    Parameters\n    ----------\n    data : pandas DataFrame\n        The DataFrame containing the dataset.\n    depvar : str or pandas Series\n        The name of the dependent variable as a string or a pandas Series.\n    method : {'pearson', 'spearman', 'kendall'}, optional\n        The correlation method to use. Default is 'pearson'.\n    significance_threshold : float, optional\n        The significance threshold for p-values. Default is 0.05.\n    ignore : str or list, optional\n        Columns to ignore during computation.\n\n    Returns\n    -------\n    p_values : :class:`gofast.api.summary.ResultSummary` object \n        A dictionary containing independent variables as keys and their \n        corresponding p-values.\n\n    Raises\n    ------\n    ValueError\n        If depvar is not found in DataFrame columns or if an invalid \n        correlation method is specified.\n\n    Notes\n    -----\n    - If depvar is a string, it checks whether it exists in the DataFrame's \n      columns. If it doesn't exist, it raises a ValueError.\n    - The function computes p-values for the specified correlation method \n      between each independent variable\n      and the dependent variable. It excludes the depvar column from the \n      computation if it's in the DataFrame.\n\n    Examples\n    --------\n    >>> import pandas as pd\n    >>> import numpy as np\n    >>> from gofast.tools.mathex import compute_p_values\n    >>> np.random.seed(0)\n    >>> data = pd.DataFrame({\n    ...     'x1': np.random.randn(100),\n    ...     'x2': np.random.randn(100),\n    ...     'y': np.random.randn(100)\n    ... })\n    >>> p_values = compute_p_values(data, 'y', method='pearson') \n    >>> print(p_values ) \n    P-values(\n      {\n\n           x1 : None\n           x2 : None\n\n      }\n    )\n\n    [ 2 entries ]\n    >>> p_values = compute_p_values(data, 'y', method='pea""rson',\n    ...                             significance_threshold=None)\n    >>> p_values\n    Out[76]: <P-values with 2 entries. Use print() to see detailed contents.>\n\n    >>> print(p_values)\n    P-values(\n      {\n\n           x1 : 0.4516405974318084\n           x2 : 0.5797578201347333\n\n      }\n    )\n\n    [ 2 entries ]\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_1compute_p_values = {"compute_p_values", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_1compute_p_values, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_compute_p_values};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_1compute_p_values(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_depvar = 0;
  PyObject *__pyx_v_method = 0;
  double __pyx_v_significance_threshold;
  PyObject *__pyx_v_ignore = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_p_values (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,&__pyx_n_s_depvar,&__pyx_n_s_method,&__pyx_n_s_significance_threshold,&__pyx_n_s_ignore,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_pearson)));

    /* "gofast/tools/mathex.pyx":101
 *     method: str='pearson',
 *     significance_threshold: float=0.05,
 *     ignore: Optional [Union [str, list]]=None             # <<<<<<<<<<<<<<
 *     ):
 *     """
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_depvar)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("compute_p_values", 0, 2, 5, 1); __PYX_ERR(0, 97, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_significance_threshold);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ignore);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 97, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_p_values") < 0)) __PYX_ERR(0, 97, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_depvar = values[1];
    __pyx_v_method = ((PyObject*)values[2]);
    if (values[3]) {
      __pyx_v_significance_threshold = __pyx_PyFloat_AsDouble(values[3]); if (unlikely((__pyx_v_significance_threshold == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L3_error)
    } else {
      __pyx_v_significance_threshold = ((double)((double)0.05));
    }
    __pyx_v_ignore = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_p_values", 0, 2, 5, __pyx_nargs); __PYX_ERR(0, 97, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_p_values", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 0, "method", 1))) __PYX_ERR(0, 99, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_compute_p_values(__pyx_self, __pyx_v_data, __pyx_v_depvar, __pyx_v_method, __pyx_v_significance_threshold, __pyx_v_ignore);

  /* "gofast/tools/mathex.pyx":97
 *     ]
 * 
 * def compute_p_values(             # <<<<<<<<<<<<<<
 *     data, depvar,
 *     method: str='pearson',
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_compute_p_values(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_depvar, PyObject *__pyx_v_method, double __pyx_v_significance_threshold, PyObject *__pyx_v_ignore) {
  PyObject *__pyx_v_column2ignore = NULL;
  PyObject *__pyx_v_corr_methods = NULL;
  PyObject *__pyx_v_p_values = NULL;
  PyObject *__pyx_v_column = NULL;
  PyObject *__pyx_v_corr_func = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_corr = NULL;
  PyObject *__pyx_v_p_value = NULL;
  PyObject *__pyx_7genexpr__pyx_v_col = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  Py_UCS4 __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *(*__pyx_t_12)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj_)
  __Pyx_RefNannySetupContext("compute_p_values", 0);
  __Pyx_TraceCall("compute_p_values", __pyx_f[0], 97, 0, __PYX_ERR(0, 97, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_data);
  __Pyx_INCREF(__pyx_v_depvar);
  __Pyx_INCREF(__pyx_v_ignore);

  /* "gofast/tools/mathex.pyx":181
 *     [ 2 entries ]
 *     """
 *     if isinstance (data, pd.Series):             # <<<<<<<<<<<<<<
 *         data = data.to_frame()
 * 
 */
  __Pyx_TraceLine(181,0,__PYX_ERR(0, 181, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_pd); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 181, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Series); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 181, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = PyObject_IsInstance(__pyx_v_data, __pyx_t_2); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 181, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":182
 *     """
 *     if isinstance (data, pd.Series):
 *         data = data.to_frame()             # <<<<<<<<<<<<<<
 * 
 *     if not isinstance (data, pd.DataFrame):
 */
    __Pyx_TraceLine(182,0,__PYX_ERR(0, 182, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_to_frame); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 182, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 182, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":181
 *     [ 2 entries ]
 *     """
 *     if isinstance (data, pd.Series):             # <<<<<<<<<<<<<<
 *         data = data.to_frame()
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":184
 *         data = data.to_frame()
 * 
 *     if not isinstance (data, pd.DataFrame):             # <<<<<<<<<<<<<<
 *         raise TypeError(f"'data' should be a frame, not {type(data).__name__!r}")
 * 
 */
  __Pyx_TraceLine(184,0,__PYX_ERR(0, 184, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 184, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = PyObject_IsInstance(__pyx_v_data, __pyx_t_1); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 184, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = (!__pyx_t_3);
  if (unlikely(__pyx_t_6)) {

    /* "gofast/tools/mathex.pyx":185
 * 
 *     if not isinstance (data, pd.DataFrame):
 *         raise TypeError(f"'data' should be a frame, not {type(data).__name__!r}")             # <<<<<<<<<<<<<<
 * 
 *     if isinstance (depvar, str):
 */
    __Pyx_TraceLine(185,0,__PYX_ERR(0, 185, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_data)), __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 185, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_1), __pyx_empty_unicode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 185, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyUnicode_Concat(__pyx_kp_u_data_should_be_a_frame_not, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 185, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 185, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 185, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":184
 *         data = data.to_frame()
 * 
 *     if not isinstance (data, pd.DataFrame):             # <<<<<<<<<<<<<<
 *         raise TypeError(f"'data' should be a frame, not {type(data).__name__!r}")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":187
 *         raise TypeError(f"'data' should be a frame, not {type(data).__name__!r}")
 * 
 *     if isinstance (depvar, str):             # <<<<<<<<<<<<<<
 *         if depvar not in data.columns:
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")
 */
  __Pyx_TraceLine(187,0,__PYX_ERR(0, 187, __pyx_L1_error))
  __pyx_t_6 = PyUnicode_Check(__pyx_v_depvar); 
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":188
 * 
 *     if isinstance (depvar, str):
 *         if depvar not in data.columns:             # <<<<<<<<<<<<<<
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")
 *         depvar = data[depvar]
 */
    __Pyx_TraceLine(188,0,__PYX_ERR(0, 188, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_v_depvar, __pyx_t_2, Py_NE)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 188, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(__pyx_t_6)) {

      /* "gofast/tools/mathex.pyx":189
 *     if isinstance (depvar, str):
 *         if depvar not in data.columns:
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")             # <<<<<<<<<<<<<<
 *         depvar = data[depvar]
 *         data = data.drop(columns=depvar.name)
 */
      __Pyx_TraceLine(189,0,__PYX_ERR(0, 189, __pyx_L1_error))
      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 189, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = 0;
      __pyx_t_8 = 127;
      __Pyx_INCREF(__pyx_kp_u__2);
      __pyx_t_7 += 1;
      __Pyx_GIVEREF(__pyx_kp_u__2);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u__2);
      __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_v_depvar, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_8) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_8;
      __pyx_t_7 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_INCREF(__pyx_kp_u_not_found_in_DataFrame_columns);
      __pyx_t_7 += 33;
      __Pyx_GIVEREF(__pyx_kp_u_not_found_in_DataFrame_columns);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_not_found_in_DataFrame_columns);
      __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_2, 3, __pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 189, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 189, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_ERR(0, 189, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":188
 * 
 *     if isinstance (depvar, str):
 *         if depvar not in data.columns:             # <<<<<<<<<<<<<<
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")
 *         depvar = data[depvar]
 */
    }

    /* "gofast/tools/mathex.pyx":190
 *         if depvar not in data.columns:
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")
 *         depvar = data[depvar]             # <<<<<<<<<<<<<<
 *         data = data.drop(columns=depvar.name)
 * 
 */
    __Pyx_TraceLine(190,0,__PYX_ERR(0, 190, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_depvar); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 190, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_depvar, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":191
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")
 *         depvar = data[depvar]
 *         data = data.drop(columns=depvar.name)             # <<<<<<<<<<<<<<
 * 
 *     elif hasattr (depvar, '__array__'):
 */
    __Pyx_TraceLine(191,0,__PYX_ERR(0, 191, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_drop); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 191, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 191, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_depvar, __pyx_n_s_name_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 191, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_columns, __pyx_t_4) < 0) __PYX_ERR(0, 191, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 191, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":187
 *         raise TypeError(f"'data' should be a frame, not {type(data).__name__!r}")
 * 
 *     if isinstance (depvar, str):             # <<<<<<<<<<<<<<
 *         if depvar not in data.columns:
 *             raise ValueError(f"'{depvar}' not found in DataFrame columns.")
 */
    goto __pyx_L5;
  }

  /* "gofast/tools/mathex.pyx":193
 *         data = data.drop(columns=depvar.name)
 * 
 *     elif hasattr (depvar, '__array__'):             # <<<<<<<<<<<<<<
 *         depvar = depvar.squeeze ()
 *         if depvar.ndim ==2:
 */
  __Pyx_TraceLine(193,0,__PYX_ERR(0, 193, __pyx_L1_error))
  __pyx_t_6 = __Pyx_HasAttr(__pyx_v_depvar, __pyx_n_u_array); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 193, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":194
 * 
 *     elif hasattr (depvar, '__array__'):
 *         depvar = depvar.squeeze ()             # <<<<<<<<<<<<<<
 *         if depvar.ndim ==2:
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"
 */
    __Pyx_TraceLine(194,0,__PYX_ERR(0, 194, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_depvar, __pyx_n_s_squeeze); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 194, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 194, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_depvar, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":195
 *     elif hasattr (depvar, '__array__'):
 *         depvar = depvar.squeeze ()
 *         if depvar.ndim ==2:             # <<<<<<<<<<<<<<
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"
 *                              " one-dimensional array, not a two-dimensional.")
 */
    __Pyx_TraceLine(195,0,__PYX_ERR(0, 195, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_depvar, __pyx_n_s_ndim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_4, __pyx_int_2, 2, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 195, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(__pyx_t_6)) {

      /* "gofast/tools/mathex.pyx":196
 *         depvar = depvar.squeeze ()
 *         if depvar.ndim ==2:
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"             # <<<<<<<<<<<<<<
 *                              " one-dimensional array, not a two-dimensional.")
 *         if not isinstance (depvar, pd.Series):
 */
      __Pyx_TraceLine(196,0,__PYX_ERR(0, 196, __pyx_L1_error))
      __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 196, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_Raise(__pyx_t_4, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __PYX_ERR(0, 196, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":195
 *     elif hasattr (depvar, '__array__'):
 *         depvar = depvar.squeeze ()
 *         if depvar.ndim ==2:             # <<<<<<<<<<<<<<
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"
 *                              " one-dimensional array, not a two-dimensional.")
 */
    }

    /* "gofast/tools/mathex.pyx":198
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"
 *                              " one-dimensional array, not a two-dimensional.")
 *         if not isinstance (depvar, pd.Series):             # <<<<<<<<<<<<<<
 *             depvar = pd.Series ( depvar, name = 'depvar')
 * 
 */
    __Pyx_TraceLine(198,0,__PYX_ERR(0, 198, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pd); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 198, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_Series); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = PyObject_IsInstance(__pyx_v_depvar, __pyx_t_1); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 198, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_3 = (!__pyx_t_6);
    if (__pyx_t_3) {

      /* "gofast/tools/mathex.pyx":199
 *                              " one-dimensional array, not a two-dimensional.")
 *         if not isinstance (depvar, pd.Series):
 *             depvar = pd.Series ( depvar, name = 'depvar')             # <<<<<<<<<<<<<<
 * 
 *     if ignore is not None:
 */
      __Pyx_TraceLine(199,0,__PYX_ERR(0, 199, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_pd); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_Series); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_depvar);
      __Pyx_GIVEREF(__pyx_v_depvar);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_depvar)) __PYX_ERR(0, 199, __pyx_L1_error);
      __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_name_2, __pyx_n_u_depvar) < 0) __PYX_ERR(0, 199, __pyx_L1_error)
      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF_SET(__pyx_v_depvar, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":198
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"
 *                              " one-dimensional array, not a two-dimensional.")
 *         if not isinstance (depvar, pd.Series):             # <<<<<<<<<<<<<<
 *             depvar = pd.Series ( depvar, name = 'depvar')
 * 
 */
    }

    /* "gofast/tools/mathex.pyx":193
 *         data = data.drop(columns=depvar.name)
 * 
 *     elif hasattr (depvar, '__array__'):             # <<<<<<<<<<<<<<
 *         depvar = depvar.squeeze ()
 *         if depvar.ndim ==2:
 */
  }
  __pyx_L5:;

  /* "gofast/tools/mathex.pyx":201
 *             depvar = pd.Series ( depvar, name = 'depvar')
 * 
 *     if ignore is not None:             # <<<<<<<<<<<<<<
 *         if isinstance ( ignore, str):
 *             ignore =[ignore]
 */
  __Pyx_TraceLine(201,0,__PYX_ERR(0, 201, __pyx_L1_error))
  __pyx_t_3 = (__pyx_v_ignore != Py_None);
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":202
 * 
 *     if ignore is not None:
 *         if isinstance ( ignore, str):             # <<<<<<<<<<<<<<
 *             ignore =[ignore]
 *         # check whether column is in data
 */
    __Pyx_TraceLine(202,0,__PYX_ERR(0, 202, __pyx_L1_error))
    __pyx_t_3 = PyUnicode_Check(__pyx_v_ignore); 
    if (__pyx_t_3) {

      /* "gofast/tools/mathex.pyx":203
 *     if ignore is not None:
 *         if isinstance ( ignore, str):
 *             ignore =[ignore]             # <<<<<<<<<<<<<<
 *         # check whether column is in data
 *         column2ignore = [ col for col in ignore if col in data.columns]
 */
      __Pyx_TraceLine(203,0,__PYX_ERR(0, 203, __pyx_L1_error))
      __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 203, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_INCREF(__pyx_v_ignore);
      __Pyx_GIVEREF(__pyx_v_ignore);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_9, 0, __pyx_v_ignore)) __PYX_ERR(0, 203, __pyx_L1_error);
      __Pyx_DECREF_SET(__pyx_v_ignore, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":202
 * 
 *     if ignore is not None:
 *         if isinstance ( ignore, str):             # <<<<<<<<<<<<<<
 *             ignore =[ignore]
 *         # check whether column is in data
 */
    }

    /* "gofast/tools/mathex.pyx":205
 *             ignore =[ignore]
 *         # check whether column is in data
 *         column2ignore = [ col for col in ignore if col in data.columns]             # <<<<<<<<<<<<<<
 *         data = data.drop (columns= column2ignore)
 * 
 */
    __Pyx_TraceLine(205,0,__PYX_ERR(0, 205, __pyx_L1_error))
    { /* enter inner scope */
      __pyx_t_9 = PyList_New(0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 205, __pyx_L13_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (likely(PyList_CheckExact(__pyx_v_ignore)) || PyTuple_CheckExact(__pyx_v_ignore)) {
        __pyx_t_2 = __pyx_v_ignore; __Pyx_INCREF(__pyx_t_2);
        __pyx_t_7 = 0;
        __pyx_t_10 = NULL;
      } else {
        __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_ignore); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 205, __pyx_L13_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 205, __pyx_L13_error)
      }
      for (;;) {
        if (likely(!__pyx_t_10)) {
          if (likely(PyList_CheckExact(__pyx_t_2))) {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_2);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 205, __pyx_L13_error)
              #endif
              if (__pyx_t_7 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 205, __pyx_L13_error)
            #else
            __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 205, __pyx_L13_error)
            __Pyx_GOTREF(__pyx_t_1);
            #endif
          } else {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_2);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 205, __pyx_L13_error)
              #endif
              if (__pyx_t_7 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 205, __pyx_L13_error)
            #else
            __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 205, __pyx_L13_error)
            __Pyx_GOTREF(__pyx_t_1);
            #endif
          }
        } else {
          __pyx_t_1 = __pyx_t_10(__pyx_t_2);
          if (unlikely(!__pyx_t_1)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 205, __pyx_L13_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_1);
        }
        __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_col, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 205, __pyx_L13_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_7genexpr__pyx_v_col, __pyx_t_1, Py_EQ)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 205, __pyx_L13_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (__pyx_t_3) {
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_9, (PyObject*)__pyx_7genexpr__pyx_v_col))) __PYX_ERR(0, 205, __pyx_L13_error)
        }
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_7genexpr__pyx_v_col); __pyx_7genexpr__pyx_v_col = 0;
      goto __pyx_L18_exit_scope;
      __pyx_L13_error:;
      __Pyx_XDECREF(__pyx_7genexpr__pyx_v_col); __pyx_7genexpr__pyx_v_col = 0;
      goto __pyx_L1_error;
      __pyx_L18_exit_scope:;
    } /* exit inner scope */
    __pyx_v_column2ignore = ((PyObject*)__pyx_t_9);
    __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":206
 *         # check whether column is in data
 *         column2ignore = [ col for col in ignore if col in data.columns]
 *         data = data.drop (columns= column2ignore)             # <<<<<<<<<<<<<<
 * 
 *     check_consistent_length(data, depvar)
 */
    __Pyx_TraceLine(206,0,__PYX_ERR(0, 206, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_drop); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 206, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 206, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_columns, __pyx_v_column2ignore) < 0) __PYX_ERR(0, 206, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 206, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":201
 *             depvar = pd.Series ( depvar, name = 'depvar')
 * 
 *     if ignore is not None:             # <<<<<<<<<<<<<<
 *         if isinstance ( ignore, str):
 *             ignore =[ignore]
 */
  }

  /* "gofast/tools/mathex.pyx":208
 *         data = data.drop (columns= column2ignore)
 * 
 *     check_consistent_length(data, depvar)             # <<<<<<<<<<<<<<
 * 
 *     corr_methods = {
 */
  __Pyx_TraceLine(208,0,__PYX_ERR(0, 208, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_check_consistent_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 208, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_9 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_9, __pyx_v_data, __pyx_v_depvar};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 208, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":211
 * 
 *     corr_methods = {
 *         'pearson': pearsonr,             # <<<<<<<<<<<<<<
 *         'spearman': spearmanr,
 *         'kendall': kendalltau
 */
  __Pyx_TraceLine(211,0,__PYX_ERR(0, 211, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pearsonr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_pearson, __pyx_t_2) < 0) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":212
 *     corr_methods = {
 *         'pearson': pearsonr,
 *         'spearman': spearmanr,             # <<<<<<<<<<<<<<
 *         'kendall': kendalltau
 *     }
 */
  __Pyx_TraceLine(212,0,__PYX_ERR(0, 212, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_spearmanr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 212, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_spearman, __pyx_t_2) < 0) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":213
 *         'pearson': pearsonr,
 *         'spearman': spearmanr,
 *         'kendall': kendalltau             # <<<<<<<<<<<<<<
 *     }
 * 
 */
  __Pyx_TraceLine(213,0,__PYX_ERR(0, 213, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_kendalltau); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 213, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_u_kendall, __pyx_t_2) < 0) __PYX_ERR(0, 211, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_corr_methods = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":217
 * 
 *     # Select only numeric columns
 *     data = data.select_dtypes([np.number])             # <<<<<<<<<<<<<<
 *     if data.empty:
 *         raise ValueError("P-value calculations expect numeric data, but"
 */
  __Pyx_TraceLine(217,0,__PYX_ERR(0, 217, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_select_dtypes); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_number); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_4)) __PYX_ERR(0, 217, __pyx_L1_error);
  __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_9};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":218
 *     # Select only numeric columns
 *     data = data.select_dtypes([np.number])
 *     if data.empty:             # <<<<<<<<<<<<<<
 *         raise ValueError("P-value calculations expect numeric data, but"
 *                          " the DataFrame contains no numeric data.")
 */
  __Pyx_TraceLine(218,0,__PYX_ERR(0, 218, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_empty); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 218, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":219
 *     data = data.select_dtypes([np.number])
 *     if data.empty:
 *         raise ValueError("P-value calculations expect numeric data, but"             # <<<<<<<<<<<<<<
 *                          " the DataFrame contains no numeric data.")
 * 
 */
    __Pyx_TraceLine(219,0,__PYX_ERR(0, 219, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 219, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":218
 *     # Select only numeric columns
 *     data = data.select_dtypes([np.number])
 *     if data.empty:             # <<<<<<<<<<<<<<
 *         raise ValueError("P-value calculations expect numeric data, but"
 *                          " the DataFrame contains no numeric data.")
 */
  }

  /* "gofast/tools/mathex.pyx":222
 *                          " the DataFrame contains no numeric data.")
 * 
 *     if method not in corr_methods:             # <<<<<<<<<<<<<<
 *         raise ValueError("Invalid correlation method. Supported methods:"
 *                          " 'pearson', 'spearman', 'kendall'.")
 */
  __Pyx_TraceLine(222,0,__PYX_ERR(0, 222, __pyx_L1_error))
  __pyx_t_3 = (__Pyx_PyDict_ContainsTF(__pyx_v_method, __pyx_v_corr_methods, Py_NE)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 222, __pyx_L1_error)
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":223
 * 
 *     if method not in corr_methods:
 *         raise ValueError("Invalid correlation method. Supported methods:"             # <<<<<<<<<<<<<<
 *                          " 'pearson', 'spearman', 'kendall'.")
 * 
 */
    __Pyx_TraceLine(223,0,__PYX_ERR(0, 223, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 223, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":222
 *                          " the DataFrame contains no numeric data.")
 * 
 *     if method not in corr_methods:             # <<<<<<<<<<<<<<
 *         raise ValueError("Invalid correlation method. Supported methods:"
 *                          " 'pearson', 'spearman', 'kendall'.")
 */
  }

  /* "gofast/tools/mathex.pyx":226
 *                          " 'pearson', 'spearman', 'kendall'.")
 * 
 *     p_values = {}             # <<<<<<<<<<<<<<
 *     for column in data.columns:
 *         if column != depvar.name and (ignore is None or column not in ignore):
 */
  __Pyx_TraceLine(226,0,__PYX_ERR(0, 226, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 226, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_p_values = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":227
 * 
 *     p_values = {}
 *     for column in data.columns:             # <<<<<<<<<<<<<<
 *         if column != depvar.name and (ignore is None or column not in ignore):
 *             corr_func = corr_methods[method]
 */
  __Pyx_TraceLine(227,0,__PYX_ERR(0, 227, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 227, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2);
    __pyx_t_7 = 0;
    __pyx_t_10 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 227, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 227, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_10)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_2);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 227, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 227, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_2);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 227, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 227, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 227, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_10(__pyx_t_2);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 227, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_column, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":228
 *     p_values = {}
 *     for column in data.columns:
 *         if column != depvar.name and (ignore is None or column not in ignore):             # <<<<<<<<<<<<<<
 *             corr_func = corr_methods[method]
 *             corr, p_value = corr_func(data[column], depvar)
 */
    __Pyx_TraceLine(228,0,__PYX_ERR(0, 228, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_depvar, __pyx_n_s_name_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 228, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_9 = PyObject_RichCompare(__pyx_v_column, __pyx_t_1, Py_NE); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 228, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 228, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_6) {
    } else {
      __pyx_t_3 = __pyx_t_6;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_6 = (__pyx_v_ignore == Py_None);
    if (!__pyx_t_6) {
    } else {
      __pyx_t_3 = __pyx_t_6;
      goto __pyx_L24_bool_binop_done;
    }
    __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_v_column, __pyx_v_ignore, Py_NE)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 228, __pyx_L1_error)
    __pyx_t_3 = __pyx_t_6;
    __pyx_L24_bool_binop_done:;
    if (__pyx_t_3) {

      /* "gofast/tools/mathex.pyx":229
 *     for column in data.columns:
 *         if column != depvar.name and (ignore is None or column not in ignore):
 *             corr_func = corr_methods[method]             # <<<<<<<<<<<<<<
 *             corr, p_value = corr_func(data[column], depvar)
 *             if significance_threshold:
 */
      __Pyx_TraceLine(229,0,__PYX_ERR(0, 229, __pyx_L1_error))
      __pyx_t_9 = __Pyx_PyDict_GetItem(__pyx_v_corr_methods, __pyx_v_method); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 229, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_XDECREF_SET(__pyx_v_corr_func, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":230
 *         if column != depvar.name and (ignore is None or column not in ignore):
 *             corr_func = corr_methods[method]
 *             corr, p_value = corr_func(data[column], depvar)             # <<<<<<<<<<<<<<
 *             if significance_threshold:
 *                 p_values[column] = (
 */
      __Pyx_TraceLine(230,0,__PYX_ERR(0, 230, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_column); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_corr_func);
      __pyx_t_4 = __pyx_v_corr_func; __pyx_t_11 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_11, __pyx_t_1, __pyx_v_depvar};
        __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
        __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 230, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      if ((likely(PyTuple_CheckExact(__pyx_t_9))) || (PyList_CheckExact(__pyx_t_9))) {
        PyObject* sequence = __pyx_t_9;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 230, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        #else
        __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 230, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 230, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_11 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 230, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_11);
        index = 0; __pyx_t_4 = __pyx_t_12(__pyx_t_11); if (unlikely(!__pyx_t_4)) goto __pyx_L27_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_4);
        index = 1; __pyx_t_1 = __pyx_t_12(__pyx_t_11); if (unlikely(!__pyx_t_1)) goto __pyx_L27_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_1);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_11), 2) < 0) __PYX_ERR(0, 230, __pyx_L1_error)
        __pyx_t_12 = NULL;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        goto __pyx_L28_unpacking_done;
        __pyx_L27_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        __pyx_t_12 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 230, __pyx_L1_error)
        __pyx_L28_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_corr, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_p_value, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":231
 *             corr_func = corr_methods[method]
 *             corr, p_value = corr_func(data[column], depvar)
 *             if significance_threshold:             # <<<<<<<<<<<<<<
 *                 p_values[column] = (
 *                     p_value if p_value <= significance_threshold else "reject"
 */
      __Pyx_TraceLine(231,0,__PYX_ERR(0, 231, __pyx_L1_error))
      __pyx_t_3 = (__pyx_v_significance_threshold != 0);
      if (__pyx_t_3) {

        /* "gofast/tools/mathex.pyx":233
 *             if significance_threshold:
 *                 p_values[column] = (
 *                     p_value if p_value <= significance_threshold else "reject"             # <<<<<<<<<<<<<<
 *                     )
 *             else:
 */
        __Pyx_TraceLine(233,0,__PYX_ERR(0, 233, __pyx_L1_error))
        __pyx_t_1 = PyFloat_FromDouble(__pyx_v_significance_threshold); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 233, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_4 = PyObject_RichCompare(__pyx_v_p_value, __pyx_t_1, Py_LE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 233, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 233, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (__pyx_t_3) {
          __Pyx_INCREF(__pyx_v_p_value);
          __pyx_t_9 = __pyx_v_p_value;
        } else {
          __Pyx_INCREF(__pyx_n_u_reject);
          __pyx_t_9 = __pyx_n_u_reject;
        }

        /* "gofast/tools/mathex.pyx":232
 *             corr, p_value = corr_func(data[column], depvar)
 *             if significance_threshold:
 *                 p_values[column] = (             # <<<<<<<<<<<<<<
 *                     p_value if p_value <= significance_threshold else "reject"
 *                     )
 */
        __Pyx_TraceLine(232,0,__PYX_ERR(0, 232, __pyx_L1_error))
        if (unlikely((PyObject_SetItem(__pyx_v_p_values, __pyx_v_column, __pyx_t_9) < 0))) __PYX_ERR(0, 232, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "gofast/tools/mathex.pyx":231
 *             corr_func = corr_methods[method]
 *             corr, p_value = corr_func(data[column], depvar)
 *             if significance_threshold:             # <<<<<<<<<<<<<<
 *                 p_values[column] = (
 *                     p_value if p_value <= significance_threshold else "reject"
 */
        goto __pyx_L29;
      }

      /* "gofast/tools/mathex.pyx":236
 *                     )
 *             else:
 *                 p_values[column] = p_value             # <<<<<<<<<<<<<<
 * 
 *     p_values = ResultSummary("P-values").add_results(p_values)
 */
      __Pyx_TraceLine(236,0,__PYX_ERR(0, 236, __pyx_L1_error))
      /*else*/ {
        if (unlikely((PyObject_SetItem(__pyx_v_p_values, __pyx_v_column, __pyx_v_p_value) < 0))) __PYX_ERR(0, 236, __pyx_L1_error)
      }
      __pyx_L29:;

      /* "gofast/tools/mathex.pyx":228
 *     p_values = {}
 *     for column in data.columns:
 *         if column != depvar.name and (ignore is None or column not in ignore):             # <<<<<<<<<<<<<<
 *             corr_func = corr_methods[method]
 *             corr, p_value = corr_func(data[column], depvar)
 */
    }

    /* "gofast/tools/mathex.pyx":227
 * 
 *     p_values = {}
 *     for column in data.columns:             # <<<<<<<<<<<<<<
 *         if column != depvar.name and (ignore is None or column not in ignore):
 *             corr_func = corr_methods[method]
 */
    __Pyx_TraceLine(227,0,__PYX_ERR(0, 227, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":238
 *                 p_values[column] = p_value
 * 
 *     p_values = ResultSummary("P-values").add_results(p_values)             # <<<<<<<<<<<<<<
 * 
 *     return p_values
 */
  __Pyx_TraceLine(238,0,__PYX_ERR(0, 238, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_ResultSummary); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 238, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_kp_u_P_values};
    __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 238, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_add_results); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 238, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_v_p_values};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_p_values, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":240
 *     p_values = ResultSummary("P-values").add_results(p_values)
 * 
 *     return p_values             # <<<<<<<<<<<<<<
 * 
 * def compute_balance_accuracy(
 */
  __Pyx_TraceLine(240,0,__PYX_ERR(0, 240, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_p_values);
  __pyx_r = __pyx_v_p_values;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":97
 *     ]
 * 
 * def compute_p_values(             # <<<<<<<<<<<<<<
 *     data, depvar,
 *     method: str='pearson',
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_p_values", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_column2ignore);
  __Pyx_XDECREF(__pyx_v_corr_methods);
  __Pyx_XDECREF(__pyx_v_p_values);
  __Pyx_XDECREF(__pyx_v_column);
  __Pyx_XDECREF(__pyx_v_corr_func);
  __Pyx_XDECREF(__pyx_v_corr);
  __Pyx_XDECREF(__pyx_v_p_value);
  __Pyx_XDECREF(__pyx_7genexpr__pyx_v_col);
  __Pyx_XDECREF(__pyx_v_data);
  __Pyx_XDECREF(__pyx_v_depvar);
  __Pyx_XDECREF(__pyx_v_ignore);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":242
 *     return p_values
 * 
 * def compute_balance_accuracy(             # <<<<<<<<<<<<<<
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_134__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__defaults__", 1);
  __Pyx_TraceCall("__defaults__", __pyx_f[0], 242, 0, __PYX_ERR(0, 242, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);

  /* "gofast/tools/mathex.pyx":244
 * def compute_balance_accuracy(
 *     y_true, y_pred,
 *     epsilon:float=1e-15,             # <<<<<<<<<<<<<<
 *     zero_division: int=0,
 *     strategy: str="ovr",
 */
  __Pyx_TraceLine(244,0,__PYX_ERR(0, 244, __pyx_L1_error))
  __pyx_t_1 = PyFloat_FromDouble(((double)1e-15)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 244, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":242
 *     return p_values
 * 
 * def compute_balance_accuracy(             # <<<<<<<<<<<<<<
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 */
  __Pyx_TraceLine(242,0,__PYX_ERR(0, 242, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error);
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_zero_division);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_zero_division);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self)->__pyx_arg_zero_division)) __PYX_ERR(0, 242, __pyx_L1_error);
  __Pyx_INCREF(((PyObject*)__pyx_n_u_ovr));
  __Pyx_GIVEREF(((PyObject*)__pyx_n_u_ovr));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 2, ((PyObject*)__pyx_n_u_ovr))) __PYX_ERR(0, 242, __pyx_L1_error);
  __Pyx_INCREF(((PyObject *)Py_False));
  __Pyx_GIVEREF(((PyObject *)Py_False));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 3, ((PyObject *)Py_False))) __PYX_ERR(0, 242, __pyx_L1_error);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 4, Py_None)) __PYX_ERR(0, 242, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, Py_None)) __PYX_ERR(0, 242, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("gofast.tools.mathex.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_3compute_balance_accuracy(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_2compute_balance_accuracy, "\n    Compute the balanced accuracy for binary or multiclass classification \n    problems, determining the appropriate calculation method based on the \n    label type and specified strategy.\n\n    Parameters\n    ----------\n    y_true : array-like of shape (n_samples,)\n        True labels for the classification task.\n    y_pred : array-like of shape (n_samples,)\n        Predicted labels from the classifier.\n    epsilon : float, default=1e-15\n        A small constant added to the denominator in calculations to prevent\n        division by zero.\n    zero_division : int, default=0\n        The value to return when a zero division occurs during calculation, \n        typically encountered when a class is missing in the predictions.\n    strategy : {'ovr', 'ovo'}, default='ovr'\n        Strategy for handling multiclass classification:\n        - 'ovr': One-vs-Rest, calculates balanced accuracy for each class\n          against all others.\n        - 'ovo': One-vs-One, calculates balanced accuracy for each pair \n          of classes.\n    normalize : bool, default=False\n        If True, normalizes the confusion matrix before calculating the \n        balanced accuracy.\n    sample_weight : array-like of shape (n_samples,), optional\n        Weights for each sample. If provided, the calculation will take \n        these into account.\n\n    Returns\n    -------\n    float or np.ndarray\n        The balanced accuracy score. Returns a single float for binary \n        classification or an array of scores for multiclass classification, \n        depending on the strategy.\n\n    Notes\n    -----\n    Balanced accuracy is particularly useful for evaluating classifiers \n    on imbalanced datasets. It calculates the average of recall obtained on \n    each class, effectively handling classes without bias.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import compute_balance_accuracy\n    >>> y_true = [0, 1, 1, 0, 1]\n    >>> y_pred = [0, 1, 0, 0, 1]""\n    >>> compute_balance_accuracy(y_true, y_pred)\n    0.833333333333333\n\n    For multiclass using One-vs-Rest strategy:\n    >>> y_true = [0, 1, 2, 0, 1]\n    >>> y_pred = [0, 2, 1, 0, 1]\n    >>> compute_balance_accuracy(y_true, y_pred, strategy='ovr')\n    array([1.        , 0.58333333, 0.375     ])\n\n    For multiclass using One-vs-One strategy:\n    >>> compute_balance_accuracy(y_true, y_pred, strategy='ovo')\n    array([1.        , 0.16666667, 0.16666667])\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_3compute_balance_accuracy = {"compute_balance_accuracy", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_3compute_balance_accuracy, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_2compute_balance_accuracy};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_3compute_balance_accuracy(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  double __pyx_v_epsilon;
  PyObject *__pyx_v_zero_division = 0;
  PyObject *__pyx_v_strategy = 0;
  PyObject *__pyx_v_normalize = 0;
  PyObject *__pyx_v_sample_weight = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_balance_accuracy (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_epsilon,&__pyx_n_s_zero_division,&__pyx_n_s_strategy,&__pyx_n_s_normalize,&__pyx_n_s_sample_weight,0};
    __pyx_defaults *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_self);
    values[3] = __Pyx_Arg_NewRef_FASTCALL(__pyx_dynamic_args->__pyx_arg_zero_division);
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_ovr)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":248
 *     strategy: str="ovr",
 *     normalize: bool=False,
 *     sample_weight:Optional[ArrayLike]=None):             # <<<<<<<<<<<<<<
 *     """
 *     Compute the balanced accuracy for binary or multiclass classification
 */
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("compute_balance_accuracy", 0, 2, 7, 1); __PYX_ERR(0, 242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_epsilon);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_zero_division);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_strategy);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_normalize);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 242, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_balance_accuracy") < 0)) __PYX_ERR(0, 242, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    if (values[2]) {
      __pyx_v_epsilon = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_epsilon == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 244, __pyx_L3_error)
    } else {
      __pyx_v_epsilon = ((double)((double)1e-15));
    }
    __pyx_v_zero_division = ((PyObject*)values[3]);
    __pyx_v_strategy = ((PyObject*)values[4]);
    __pyx_v_normalize = values[5];
    __pyx_v_sample_weight = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_balance_accuracy", 0, 2, 7, __pyx_nargs); __PYX_ERR(0, 242, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_balance_accuracy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_zero_division), (&PyInt_Type), 0, "zero_division", 1))) __PYX_ERR(0, 245, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_strategy), (&PyUnicode_Type), 0, "strategy", 1))) __PYX_ERR(0, 246, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_2compute_balance_accuracy(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_epsilon, __pyx_v_zero_division, __pyx_v_strategy, __pyx_v_normalize, __pyx_v_sample_weight);

  /* "gofast/tools/mathex.pyx":242
 *     return p_values
 * 
 * def compute_balance_accuracy(             # <<<<<<<<<<<<<<
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_2compute_balance_accuracy(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, double __pyx_v_epsilon, PyObject *__pyx_v_zero_division, PyObject *__pyx_v_strategy, PyObject *__pyx_v_normalize, PyObject *__pyx_v_sample_weight) {
  PyObject *__pyx_v_labels = NULL;
  PyObject *__pyx_v_scores = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__6)
  __Pyx_RefNannySetupContext("compute_balance_accuracy", 0);
  __Pyx_TraceCall("compute_balance_accuracy", __pyx_f[0], 242, 0, __PYX_ERR(0, 242, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_strategy);

  /* "gofast/tools/mathex.pyx":310
 *     array([1.        , 0.16666667, 0.16666667])
 *     """
 *     y_true, y_pred = _ensure_y_is_valid(y_true, y_pred, y_numeric=True)             # <<<<<<<<<<<<<<
 * 
 *     # Check whether y_true is binary and compute balanced accuracy accordingly
 */
  __Pyx_TraceLine(310,0,__PYX_ERR(0, 310, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 310, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 310, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 310, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 310, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 310, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 310, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 310, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 310, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 310, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 310, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":313
 * 
 *     # Check whether y_true is binary and compute balanced accuracy accordingly
 *     if is_binary_class(y_true):             # <<<<<<<<<<<<<<
 *         return _compute_balanced_accuracy_binary(
 *             y_true=y_true, y_pred=y_pred,
 */
  __Pyx_TraceLine(313,0,__PYX_ERR(0, 313, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_is_binary_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 313, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 313, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 313, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":314
 *     # Check whether y_true is binary and compute balanced accuracy accordingly
 *     if is_binary_class(y_true):
 *         return _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *             y_true=y_true, y_pred=y_pred,
 *             zero_division=zero_division,
 */
    __Pyx_TraceLine(314,0,__PYX_ERR(0, 314, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_compute_balanced_accuracy_binar); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);

    /* "gofast/tools/mathex.pyx":315
 *     if is_binary_class(y_true):
 *         return _compute_balanced_accuracy_binary(
 *             y_true=y_true, y_pred=y_pred,             # <<<<<<<<<<<<<<
 *             zero_division=zero_division,
 *             normalize=normalize,
 */
    __Pyx_TraceLine(315,0,__PYX_ERR(0, 315, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 315, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_y_true, __pyx_v_y_true) < 0) __PYX_ERR(0, 315, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_y_pred, __pyx_v_y_pred) < 0) __PYX_ERR(0, 315, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":316
 *         return _compute_balanced_accuracy_binary(
 *             y_true=y_true, y_pred=y_pred,
 *             zero_division=zero_division,             # <<<<<<<<<<<<<<
 *             normalize=normalize,
 *             sample_weight=sample_weight)
 */
    __Pyx_TraceLine(316,0,__PYX_ERR(0, 316, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_zero_division, __pyx_v_zero_division) < 0) __PYX_ERR(0, 315, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":317
 *             y_true=y_true, y_pred=y_pred,
 *             zero_division=zero_division,
 *             normalize=normalize,             # <<<<<<<<<<<<<<
 *             sample_weight=sample_weight)
 * 
 */
    __Pyx_TraceLine(317,0,__PYX_ERR(0, 317, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_normalize, __pyx_v_normalize) < 0) __PYX_ERR(0, 315, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":318
 *             zero_division=zero_division,
 *             normalize=normalize,
 *             sample_weight=sample_weight)             # <<<<<<<<<<<<<<
 * 
 *     # Validate the strategy parameter
 */
    __Pyx_TraceLine(318,0,__PYX_ERR(0, 318, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 315, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":314
 *     # Check whether y_true is binary and compute balanced accuracy accordingly
 *     if is_binary_class(y_true):
 *         return _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *             y_true=y_true, y_pred=y_pred,
 *             zero_division=zero_division,
 */
    __Pyx_TraceLine(314,0,__PYX_ERR(0, 314, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":313
 * 
 *     # Check whether y_true is binary and compute balanced accuracy accordingly
 *     if is_binary_class(y_true):             # <<<<<<<<<<<<<<
 *         return _compute_balanced_accuracy_binary(
 *             y_true=y_true, y_pred=y_pred,
 */
  }

  /* "gofast/tools/mathex.pyx":321
 * 
 *     # Validate the strategy parameter
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={"ovr", "ovo"})(strategy)
 * 
 */
  __Pyx_TraceLine(321,0,__PYX_ERR(0, 321, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":322
 *     # Validate the strategy parameter
 *     strategy = parameter_validator(
 *         "strategy", target_strs={"ovr", "ovo"})(strategy)             # <<<<<<<<<<<<<<
 * 
 *     labels = unique_labels(y_true, y_pred)
 */
  __Pyx_TraceLine(322,0,__PYX_ERR(0, 322, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PySet_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PySet_Add(__pyx_t_1, __pyx_n_u_ovr) < 0) __PYX_ERR(0, 322, __pyx_L1_error)
  if (PySet_Add(__pyx_t_1, __pyx_n_u_ovo) < 0) __PYX_ERR(0, 322, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_target_strs, __pyx_t_1) < 0) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":321
 * 
 *     # Validate the strategy parameter
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={"ovr", "ovo"})(strategy)
 * 
 */
  __Pyx_TraceLine(321,0,__PYX_ERR(0, 321, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__7, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":322
 *     # Validate the strategy parameter
 *     strategy = parameter_validator(
 *         "strategy", target_strs={"ovr", "ovo"})(strategy)             # <<<<<<<<<<<<<<
 * 
 *     labels = unique_labels(y_true, y_pred)
 */
  __Pyx_TraceLine(322,0,__PYX_ERR(0, 322, __pyx_L1_error))
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_strategy};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 322, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_3))) __PYX_ERR(0, 322, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_strategy, ((PyObject*)__pyx_t_3));
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":324
 *         "strategy", target_strs={"ovr", "ovo"})(strategy)
 * 
 *     labels = unique_labels(y_true, y_pred)             # <<<<<<<<<<<<<<
 *     labels = np.unique(np.concatenate([y_true, y_pred]))
 * 
 */
  __Pyx_TraceLine(324,0,__PYX_ERR(0, 324, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_unique_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_y_true, __pyx_v_y_pred};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 324, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_labels = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":325
 * 
 *     labels = unique_labels(y_true, y_pred)
 *     labels = np.unique(np.concatenate([y_true, y_pred]))             # <<<<<<<<<<<<<<
 * 
 *     # Compute balanced accuracy based on the specified strategy
 */
  __Pyx_TraceLine(325,0,__PYX_ERR(0, 325, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_unique); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_concatenate); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 325, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 325, __pyx_L1_error);
  __pyx_t_9 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 325, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_1};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 325, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_labels, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":328
 * 
 *     # Compute balanced accuracy based on the specified strategy
 *     if strategy == 'ovr':             # <<<<<<<<<<<<<<
 *         scores = _balanced_accuracy_ovr(
 *             y_true=y_true, y_pred=y_pred,
 */
  __Pyx_TraceLine(328,0,__PYX_ERR(0, 328, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovr, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 328, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":329
 *     # Compute balanced accuracy based on the specified strategy
 *     if strategy == 'ovr':
 *         scores = _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels,
 */
    __Pyx_TraceLine(329,0,__PYX_ERR(0, 329, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_balanced_accuracy_ovr); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "gofast/tools/mathex.pyx":330
 *     if strategy == 'ovr':
 *         scores = _balanced_accuracy_ovr(
 *             y_true=y_true, y_pred=y_pred,             # <<<<<<<<<<<<<<
 *             labels=labels,
 *             epsilon=epsilon,
 */
    __Pyx_TraceLine(330,0,__PYX_ERR(0, 330, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyDict_NewPresized(7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 330, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_y_true, __pyx_v_y_true) < 0) __PYX_ERR(0, 330, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_y_pred, __pyx_v_y_pred) < 0) __PYX_ERR(0, 330, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":331
 *         scores = _balanced_accuracy_ovr(
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels,             # <<<<<<<<<<<<<<
 *             epsilon=epsilon,
 *             zero_division=zero_division,
 */
    __Pyx_TraceLine(331,0,__PYX_ERR(0, 331, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_labels, __pyx_v_labels) < 0) __PYX_ERR(0, 330, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":332
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels,
 *             epsilon=epsilon,             # <<<<<<<<<<<<<<
 *             zero_division=zero_division,
 *             normalize=normalize,
 */
    __Pyx_TraceLine(332,0,__PYX_ERR(0, 332, __pyx_L1_error))
    __pyx_t_1 = PyFloat_FromDouble(__pyx_v_epsilon); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_epsilon, __pyx_t_1) < 0) __PYX_ERR(0, 330, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":333
 *             labels=labels,
 *             epsilon=epsilon,
 *             zero_division=zero_division,             # <<<<<<<<<<<<<<
 *             normalize=normalize,
 *             sample_weight=sample_weight)
 */
    __Pyx_TraceLine(333,0,__PYX_ERR(0, 333, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_zero_division, __pyx_v_zero_division) < 0) __PYX_ERR(0, 330, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":334
 *             epsilon=epsilon,
 *             zero_division=zero_division,
 *             normalize=normalize,             # <<<<<<<<<<<<<<
 *             sample_weight=sample_weight)
 *     elif strategy == 'ovo':
 */
    __Pyx_TraceLine(334,0,__PYX_ERR(0, 334, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_normalize, __pyx_v_normalize) < 0) __PYX_ERR(0, 330, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":335
 *             zero_division=zero_division,
 *             normalize=normalize,
 *             sample_weight=sample_weight)             # <<<<<<<<<<<<<<
 *     elif strategy == 'ovo':
 *         labels = np.unique(np.concatenate([y_true, y_pred]))
 */
    __Pyx_TraceLine(335,0,__PYX_ERR(0, 335, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 330, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":329
 *     # Compute balanced accuracy based on the specified strategy
 *     if strategy == 'ovr':
 *         scores = _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels,
 */
    __Pyx_TraceLine(329,0,__PYX_ERR(0, 329, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_scores = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":328
 * 
 *     # Compute balanced accuracy based on the specified strategy
 *     if strategy == 'ovr':             # <<<<<<<<<<<<<<
 *         scores = _balanced_accuracy_ovr(
 *             y_true=y_true, y_pred=y_pred,
 */
    goto __pyx_L6;
  }

  /* "gofast/tools/mathex.pyx":336
 *             normalize=normalize,
 *             sample_weight=sample_weight)
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         labels = np.unique(np.concatenate([y_true, y_pred]))
 *         scores = _balanced_accuracy_ovo(
 */
  __Pyx_TraceLine(336,0,__PYX_ERR(0, 336, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovo, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 336, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":337
 *             sample_weight=sample_weight)
 *     elif strategy == 'ovo':
 *         labels = np.unique(np.concatenate([y_true, y_pred]))             # <<<<<<<<<<<<<<
 *         scores = _balanced_accuracy_ovo(
 *             y_true=y_true, y_pred=y_pred,
 */
    __Pyx_TraceLine(337,0,__PYX_ERR(0, 337, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_unique); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_concatenate); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyList_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_8, 0, __pyx_v_y_true)) __PYX_ERR(0, 337, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_pred);
    __Pyx_GIVEREF(__pyx_v_y_pred);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_8, 1, __pyx_v_y_pred)) __PYX_ERR(0, 337, __pyx_L1_error);
    __pyx_t_9 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_8};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 337, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_4};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 337, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_labels, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":338
 *     elif strategy == 'ovo':
 *         labels = np.unique(np.concatenate([y_true, y_pred]))
 *         scores = _balanced_accuracy_ovo(             # <<<<<<<<<<<<<<
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels, sample_weight=sample_weight)
 */
    __Pyx_TraceLine(338,0,__PYX_ERR(0, 338, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_balanced_accuracy_ovo); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);

    /* "gofast/tools/mathex.pyx":339
 *         labels = np.unique(np.concatenate([y_true, y_pred]))
 *         scores = _balanced_accuracy_ovo(
 *             y_true=y_true, y_pred=y_pred,             # <<<<<<<<<<<<<<
 *             labels=labels, sample_weight=sample_weight)
 * 
 */
    __Pyx_TraceLine(339,0,__PYX_ERR(0, 339, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 339, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_true, __pyx_v_y_true) < 0) __PYX_ERR(0, 339, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_pred, __pyx_v_y_pred) < 0) __PYX_ERR(0, 339, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":340
 *         scores = _balanced_accuracy_ovo(
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels, sample_weight=sample_weight)             # <<<<<<<<<<<<<<
 * 
 *     return scores
 */
    __Pyx_TraceLine(340,0,__PYX_ERR(0, 340, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_labels, __pyx_v_labels) < 0) __PYX_ERR(0, 339, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 339, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":338
 *     elif strategy == 'ovo':
 *         labels = np.unique(np.concatenate([y_true, y_pred]))
 *         scores = _balanced_accuracy_ovo(             # <<<<<<<<<<<<<<
 *             y_true=y_true, y_pred=y_pred,
 *             labels=labels, sample_weight=sample_weight)
 */
    __Pyx_TraceLine(338,0,__PYX_ERR(0, 338, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_scores = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":336
 *             normalize=normalize,
 *             sample_weight=sample_weight)
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         labels = np.unique(np.concatenate([y_true, y_pred]))
 *         scores = _balanced_accuracy_ovo(
 */
  }
  __pyx_L6:;

  /* "gofast/tools/mathex.pyx":342
 *             labels=labels, sample_weight=sample_weight)
 * 
 *     return scores             # <<<<<<<<<<<<<<
 * 
 * def _compute_balanced_accuracy_binary(
 */
  __Pyx_TraceLine(342,0,__PYX_ERR(0, 342, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_v_scores)) { __Pyx_RaiseUnboundLocalError("scores"); __PYX_ERR(0, 342, __pyx_L1_error) }
  __Pyx_INCREF(__pyx_v_scores);
  __pyx_r = __pyx_v_scores;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":242
 *     return p_values
 * 
 * def compute_balance_accuracy(             # <<<<<<<<<<<<<<
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_balance_accuracy", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_labels);
  __Pyx_XDECREF(__pyx_v_scores);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_strategy);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":344
 *     return scores
 * 
 * def _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_5_compute_balanced_accuracy_binary(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_5_compute_balanced_accuracy_binary = {"_compute_balanced_accuracy_binary", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_5_compute_balanced_accuracy_binary, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_5_compute_balanced_accuracy_binary(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_epsilon = 0;
  PyObject *__pyx_v_zero_division = 0;
  PyObject *__pyx_v_normalize = 0;
  PyObject *__pyx_v_sample_weight = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[6] = {0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_compute_balanced_accuracy_binary (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_epsilon,&__pyx_n_s_zero_division,&__pyx_n_s_normalize,&__pyx_n_s_sample_weight,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_15)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_0)));

    /* "gofast/tools/mathex.pyx":346
 * def _compute_balanced_accuracy_binary(
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,             # <<<<<<<<<<<<<<
 *     sample_weight=None
 *     ):
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":347
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,
 *     sample_weight=None             # <<<<<<<<<<<<<<
 *     ):
 *     cm = confusion_matrix(y_true, y_pred, sample_weight=sample_weight )
 */
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_balanced_accuracy_binary", 0, 2, 6, 1); __PYX_ERR(0, 344, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_epsilon);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_zero_division);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_normalize);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_compute_balanced_accuracy_binary") < 0)) __PYX_ERR(0, 344, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_epsilon = values[2];
    __pyx_v_zero_division = values[3];
    __pyx_v_normalize = values[4];
    __pyx_v_sample_weight = values[5];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_compute_balanced_accuracy_binary", 0, 2, 6, __pyx_nargs); __PYX_ERR(0, 344, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._compute_balanced_accuracy_binary", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_4_compute_balanced_accuracy_binary(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_epsilon, __pyx_v_zero_division, __pyx_v_normalize, __pyx_v_sample_weight);

  /* "gofast/tools/mathex.pyx":344
 *     return scores
 * 
 * def _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_4_compute_balanced_accuracy_binary(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_zero_division, PyObject *__pyx_v_normalize, PyObject *__pyx_v_sample_weight) {
  PyObject *__pyx_v_cm = NULL;
  PyObject *__pyx_v_sensitivity = NULL;
  PyObject *__pyx_v_specificity = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__8)
  __Pyx_RefNannySetupContext("_compute_balanced_accuracy_binary", 1);
  __Pyx_TraceCall("_compute_balanced_accuracy_binary", __pyx_f[0], 344, 0, __PYX_ERR(0, 344, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":349
 *     sample_weight=None
 *     ):
 *     cm = confusion_matrix(y_true, y_pred, sample_weight=sample_weight )             # <<<<<<<<<<<<<<
 *     if normalize:
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 */
  __Pyx_TraceLine(349,0,__PYX_ERR(0, 349, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_confusion_matrix); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 349, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 349, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 349, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 349, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_cm = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":350
 *     ):
 *     cm = confusion_matrix(y_true, y_pred, sample_weight=sample_weight )
 *     if normalize:             # <<<<<<<<<<<<<<
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 */
  __Pyx_TraceLine(350,0,__PYX_ERR(0, 350, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_normalize); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 350, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":351
 *     cm = confusion_matrix(y_true, y_pred, sample_weight=sample_weight )
 *     if normalize:
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]             # <<<<<<<<<<<<<<
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 */
    __Pyx_TraceLine(351,0,__PYX_ERR(0, 351, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_cm, __pyx_n_s_astype); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_n_u_float};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 351, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_cm, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_1) < 0) __PYX_ERR(0, 351, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_newaxis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_slice__9);
    __Pyx_GIVEREF(__pyx_slice__9);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_slice__9)) __PYX_ERR(0, 351, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_3);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error);
    __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_cm, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":350
 *     ):
 *     cm = confusion_matrix(y_true, y_pred, sample_weight=sample_weight )
 *     if normalize:             # <<<<<<<<<<<<<<
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 */
  }

  /* "gofast/tools/mathex.pyx":352
 *     if normalize:
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)             # <<<<<<<<<<<<<<
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 *     return (sensitivity + specificity) / 2  if not np.isnan(
 */
  __Pyx_TraceLine(352,0,__PYX_ERR(0, 352, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_sensitivity = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":353
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)             # <<<<<<<<<<<<<<
 *     return (sensitivity + specificity) / 2  if not np.isnan(
 *         sensitivity + specificity) else zero_division
 */
  __Pyx_TraceLine(353,0,__PYX_ERR(0, 353, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__12); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__13); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyNumber_Add(__pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_v_epsilon); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_specificity = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":354
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 *     return (sensitivity + specificity) / 2  if not np.isnan(             # <<<<<<<<<<<<<<
 *         sensitivity + specificity) else zero_division
 * 
 */
  __Pyx_TraceLine(354,0,__PYX_ERR(0, 354, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_isnan); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 354, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":355
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 *     return (sensitivity + specificity) / 2  if not np.isnan(
 *         sensitivity + specificity) else zero_division             # <<<<<<<<<<<<<<
 * 
 * def _balanced_accuracy_ovr(
 */
  __Pyx_TraceLine(355,0,__PYX_ERR(0, 355, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Add(__pyx_v_sensitivity, __pyx_v_specificity); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_1};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 354, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }

  /* "gofast/tools/mathex.pyx":354
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 *     return (sensitivity + specificity) / 2  if not np.isnan(             # <<<<<<<<<<<<<<
 *         sensitivity + specificity) else zero_division
 * 
 */
  __Pyx_TraceLine(354,0,__PYX_ERR(0, 354, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 354, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = (!__pyx_t_5);
  if (__pyx_t_8) {
    __pyx_t_2 = PyNumber_Add(__pyx_v_sensitivity, __pyx_v_specificity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 354, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyInt_TrueDivideObjC(__pyx_t_2, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 354, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_3 = __pyx_t_4;
    __pyx_t_4 = 0;
  } else {

    /* "gofast/tools/mathex.pyx":355
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 *     return (sensitivity + specificity) / 2  if not np.isnan(
 *         sensitivity + specificity) else zero_division             # <<<<<<<<<<<<<<
 * 
 * def _balanced_accuracy_ovr(
 */
    __Pyx_TraceLine(355,0,__PYX_ERR(0, 355, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_zero_division);
    __pyx_t_3 = __pyx_v_zero_division;
  }
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":344
 *     return scores
 * 
 * def _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("gofast.tools.mathex._compute_balanced_accuracy_binary", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_cm);
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":357
 *         sensitivity + specificity) else zero_division
 * 
 * def _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_7_balanced_accuracy_ovr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_7_balanced_accuracy_ovr = {"_balanced_accuracy_ovr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_7_balanced_accuracy_ovr, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_7_balanced_accuracy_ovr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_labels = 0;
  PyObject *__pyx_v_epsilon = 0;
  PyObject *__pyx_v_zero_division = 0;
  PyObject *__pyx_v_normalize = 0;
  PyObject *__pyx_v_sample_weight = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_balanced_accuracy_ovr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_labels,&__pyx_n_s_epsilon,&__pyx_n_s_zero_division,&__pyx_n_s_normalize,&__pyx_n_s_sample_weight,0};
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_15)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_0)));

    /* "gofast/tools/mathex.pyx":359
 * def _balanced_accuracy_ovr(
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,             # <<<<<<<<<<<<<<
 *     sample_weight =None
 *   ):
 */
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":360
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,
 *     sample_weight =None             # <<<<<<<<<<<<<<
 *   ):
 *     bal_acc_scores = []
 */
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_balanced_accuracy_ovr", 0, 3, 7, 1); __PYX_ERR(0, 357, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_balanced_accuracy_ovr", 0, 3, 7, 2); __PYX_ERR(0, 357, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_epsilon);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_zero_division);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_normalize);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_balanced_accuracy_ovr") < 0)) __PYX_ERR(0, 357, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_labels = values[2];
    __pyx_v_epsilon = values[3];
    __pyx_v_zero_division = values[4];
    __pyx_v_normalize = values[5];
    __pyx_v_sample_weight = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_balanced_accuracy_ovr", 0, 3, 7, __pyx_nargs); __PYX_ERR(0, 357, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._balanced_accuracy_ovr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_6_balanced_accuracy_ovr(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_labels, __pyx_v_epsilon, __pyx_v_zero_division, __pyx_v_normalize, __pyx_v_sample_weight);

  /* "gofast/tools/mathex.pyx":357
 *         sensitivity + specificity) else zero_division
 * 
 * def _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_6_balanced_accuracy_ovr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_labels, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_zero_division, PyObject *__pyx_v_normalize, PyObject *__pyx_v_sample_weight) {
  PyObject *__pyx_v_bal_acc_scores = NULL;
  PyObject *__pyx_v_label = NULL;
  PyObject *__pyx_v_binary_y_true = NULL;
  PyObject *__pyx_v_binary_y_pred = NULL;
  PyObject *__pyx_v_score = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__14)
  __Pyx_RefNannySetupContext("_balanced_accuracy_ovr", 1);
  __Pyx_TraceCall("_balanced_accuracy_ovr", __pyx_f[0], 357, 0, __PYX_ERR(0, 357, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":362
 *     sample_weight =None
 *   ):
 *     bal_acc_scores = []             # <<<<<<<<<<<<<<
 *     for label in labels:
 *         binary_y_true = (y_true == label).astype(int)
 */
  __Pyx_TraceLine(362,0,__PYX_ERR(0, 362, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 362, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_bal_acc_scores = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":363
 *   ):
 *     bal_acc_scores = []
 *     for label in labels:             # <<<<<<<<<<<<<<
 *         binary_y_true = (y_true == label).astype(int)
 *         binary_y_pred = (y_pred == label).astype(int)
 */
  __Pyx_TraceLine(363,0,__PYX_ERR(0, 363, __pyx_L1_error))
  if (likely(PyList_CheckExact(__pyx_v_labels)) || PyTuple_CheckExact(__pyx_v_labels)) {
    __pyx_t_1 = __pyx_v_labels; __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_labels); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 363, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 363, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 363, __pyx_L1_error)
          #endif
          if (__pyx_t_2 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 363, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 363, __pyx_L1_error)
          #endif
          if (__pyx_t_2 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 363, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 363, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_label, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":364
 *     bal_acc_scores = []
 *     for label in labels:
 *         binary_y_true = (y_true == label).astype(int)             # <<<<<<<<<<<<<<
 *         binary_y_pred = (y_pred == label).astype(int)
 *         score = _compute_balanced_accuracy_binary(
 */
    __Pyx_TraceLine(364,0,__PYX_ERR(0, 364, __pyx_L1_error))
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_label, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 364, __pyx_L1_error)
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_astype); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 364, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, ((PyObject *)(&PyInt_Type))};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 364, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_binary_y_true, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":365
 *     for label in labels:
 *         binary_y_true = (y_true == label).astype(int)
 *         binary_y_pred = (y_pred == label).astype(int)             # <<<<<<<<<<<<<<
 *         score = _compute_balanced_accuracy_binary(
 *             binary_y_true, binary_y_pred, epsilon, zero_division,
 */
    __Pyx_TraceLine(365,0,__PYX_ERR(0, 365, __pyx_L1_error))
    __pyx_t_6 = PyObject_RichCompare(__pyx_v_y_pred, __pyx_v_label, Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 365, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_astype); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 365, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, ((PyObject *)(&PyInt_Type))};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 365, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_binary_y_pred, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":366
 *         binary_y_true = (y_true == label).astype(int)
 *         binary_y_pred = (y_pred == label).astype(int)
 *         score = _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *             binary_y_true, binary_y_pred, epsilon, zero_division,
 *             normalize=normalize, sample_weight= sample_weight )
 */
    __Pyx_TraceLine(366,0,__PYX_ERR(0, 366, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_compute_balanced_accuracy_binar); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 366, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);

    /* "gofast/tools/mathex.pyx":367
 *         binary_y_pred = (y_pred == label).astype(int)
 *         score = _compute_balanced_accuracy_binary(
 *             binary_y_true, binary_y_pred, epsilon, zero_division,             # <<<<<<<<<<<<<<
 *             normalize=normalize, sample_weight= sample_weight )
 *         bal_acc_scores.append(score)
 */
    __Pyx_TraceLine(367,0,__PYX_ERR(0, 367, __pyx_L1_error))
    __pyx_t_5 = PyTuple_New(4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 366, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_v_binary_y_true);
    __Pyx_GIVEREF(__pyx_v_binary_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_binary_y_true)) __PYX_ERR(0, 366, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_binary_y_pred);
    __Pyx_GIVEREF(__pyx_v_binary_y_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_binary_y_pred)) __PYX_ERR(0, 366, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_epsilon);
    __Pyx_GIVEREF(__pyx_v_epsilon);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_v_epsilon)) __PYX_ERR(0, 366, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_zero_division);
    __Pyx_GIVEREF(__pyx_v_zero_division);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_v_zero_division)) __PYX_ERR(0, 366, __pyx_L1_error);

    /* "gofast/tools/mathex.pyx":368
 *         score = _compute_balanced_accuracy_binary(
 *             binary_y_true, binary_y_pred, epsilon, zero_division,
 *             normalize=normalize, sample_weight= sample_weight )             # <<<<<<<<<<<<<<
 *         bal_acc_scores.append(score)
 *     return np.array(bal_acc_scores)
 */
    __Pyx_TraceLine(368,0,__PYX_ERR(0, 368, __pyx_L1_error))
    __pyx_t_6 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 368, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_normalize, __pyx_v_normalize) < 0) __PYX_ERR(0, 368, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 368, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":366
 *         binary_y_true = (y_true == label).astype(int)
 *         binary_y_pred = (y_pred == label).astype(int)
 *         score = _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *             binary_y_true, binary_y_pred, epsilon, zero_division,
 *             normalize=normalize, sample_weight= sample_weight )
 */
    __Pyx_TraceLine(366,0,__PYX_ERR(0, 366, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 366, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF_SET(__pyx_v_score, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":369
 *             binary_y_true, binary_y_pred, epsilon, zero_division,
 *             normalize=normalize, sample_weight= sample_weight )
 *         bal_acc_scores.append(score)             # <<<<<<<<<<<<<<
 *     return np.array(bal_acc_scores)
 * 
 */
    __Pyx_TraceLine(369,0,__PYX_ERR(0, 369, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyList_Append(__pyx_v_bal_acc_scores, __pyx_v_score); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 369, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":363
 *   ):
 *     bal_acc_scores = []
 *     for label in labels:             # <<<<<<<<<<<<<<
 *         binary_y_true = (y_true == label).astype(int)
 *         binary_y_pred = (y_pred == label).astype(int)
 */
    __Pyx_TraceLine(363,0,__PYX_ERR(0, 363, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":370
 *             normalize=normalize, sample_weight= sample_weight )
 *         bal_acc_scores.append(score)
 *     return np.array(bal_acc_scores)             # <<<<<<<<<<<<<<
 * 
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):
 */
  __Pyx_TraceLine(370,0,__PYX_ERR(0, 370, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 370, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_array_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 370, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_bal_acc_scores};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":357
 *         sensitivity + specificity) else zero_division
 * 
 * def _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex._balanced_accuracy_ovr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_bal_acc_scores);
  __Pyx_XDECREF(__pyx_v_label);
  __Pyx_XDECREF(__pyx_v_binary_y_true);
  __Pyx_XDECREF(__pyx_v_binary_y_pred);
  __Pyx_XDECREF(__pyx_v_score);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":372
 *     return np.array(bal_acc_scores)
 * 
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):             # <<<<<<<<<<<<<<
 *     le = LabelEncoder()
 *     y_true_encoded = le.fit_transform(y_true)
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_9_balanced_accuracy_ovo(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_9_balanced_accuracy_ovo = {"_balanced_accuracy_ovo", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_9_balanced_accuracy_ovo, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_9_balanced_accuracy_ovo(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  CYTHON_UNUSED PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_labels = 0;
  PyObject *__pyx_v_sample_weight = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_balanced_accuracy_ovo (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_labels,&__pyx_n_s_sample_weight,0};
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 372, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 372, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_balanced_accuracy_ovo", 0, 3, 4, 1); __PYX_ERR(0, 372, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 372, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_balanced_accuracy_ovo", 0, 3, 4, 2); __PYX_ERR(0, 372, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 372, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_balanced_accuracy_ovo") < 0)) __PYX_ERR(0, 372, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_labels = values[2];
    __pyx_v_sample_weight = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_balanced_accuracy_ovo", 0, 3, 4, __pyx_nargs); __PYX_ERR(0, 372, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._balanced_accuracy_ovo", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_8_balanced_accuracy_ovo(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_labels, __pyx_v_sample_weight);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_8_balanced_accuracy_ovo(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, CYTHON_UNUSED PyObject *__pyx_v_y_pred, PyObject *__pyx_v_labels, PyObject *__pyx_v_sample_weight) {
  PyObject *__pyx_v_le = NULL;
  PyObject *__pyx_v_y_true_encoded = NULL;
  PyObject *__pyx_v_y_bin = NULL;
  PyObject *__pyx_v_bal_acc_scores = NULL;
  PyObject *__pyx_v_i = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_label_i = NULL;
  PyObject *__pyx_v_j = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_label_j = NULL;
  PyObject *__pyx_v_specific_y_true = NULL;
  PyObject *__pyx_v_specific_y_pred = NULL;
  PyObject *__pyx_v_auc_score = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *(*__pyx_t_8)(PyObject *);
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__15)
  __Pyx_RefNannySetupContext("_balanced_accuracy_ovo", 1);
  __Pyx_TraceCall("_balanced_accuracy_ovo", __pyx_f[0], 372, 0, __PYX_ERR(0, 372, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":373
 * 
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):
 *     le = LabelEncoder()             # <<<<<<<<<<<<<<
 *     y_true_encoded = le.fit_transform(y_true)
 *     y_bin = label_binarize(y_true_encoded, classes=range(len(labels)))
 */
  __Pyx_TraceLine(373,0,__PYX_ERR(0, 373, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_LabelEncoder); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 373, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 373, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_le = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":374
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):
 *     le = LabelEncoder()
 *     y_true_encoded = le.fit_transform(y_true)             # <<<<<<<<<<<<<<
 *     y_bin = label_binarize(y_true_encoded, classes=range(len(labels)))
 * 
 */
  __Pyx_TraceLine(374,0,__PYX_ERR(0, 374, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_le, __pyx_n_s_fit_transform); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 374, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 374, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_y_true_encoded = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":375
 *     le = LabelEncoder()
 *     y_true_encoded = le.fit_transform(y_true)
 *     y_bin = label_binarize(y_true_encoded, classes=range(len(labels)))             # <<<<<<<<<<<<<<
 * 
 *     bal_acc_scores = []
 */
  __Pyx_TraceLine(375,0,__PYX_ERR(0, 375, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_label_binarize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true_encoded);
  __Pyx_GIVEREF(__pyx_v_y_true_encoded);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true_encoded)) __PYX_ERR(0, 375, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 375, __pyx_L1_error)
  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_classes, __pyx_t_7) < 0) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 375, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_y_bin = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "gofast/tools/mathex.pyx":377
 *     y_bin = label_binarize(y_true_encoded, classes=range(len(labels)))
 * 
 *     bal_acc_scores = []             # <<<<<<<<<<<<<<
 *     for i, label_i in enumerate(labels[:-1]):
 *         for j, label_j in enumerate(labels[i+1:]):
 */
  __Pyx_TraceLine(377,0,__PYX_ERR(0, 377, __pyx_L1_error))
  __pyx_t_7 = PyList_New(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 377, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_v_bal_acc_scores = ((PyObject*)__pyx_t_7);
  __pyx_t_7 = 0;

  /* "gofast/tools/mathex.pyx":378
 * 
 *     bal_acc_scores = []
 *     for i, label_i in enumerate(labels[:-1]):             # <<<<<<<<<<<<<<
 *         for j, label_j in enumerate(labels[i+1:]):
 *             specific_y_true = y_bin[:, i]
 */
  __Pyx_TraceLine(378,0,__PYX_ERR(0, 378, __pyx_L1_error))
  __Pyx_INCREF(__pyx_int_0);
  __pyx_t_7 = __pyx_int_0;
  __pyx_t_3 = __Pyx_PyObject_GetSlice(__pyx_v_labels, 0, -1L, NULL, NULL, &__pyx_slice__16, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_2 = __pyx_t_3; __Pyx_INCREF(__pyx_t_2);
    __pyx_t_5 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 378, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 378, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_2))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_2);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 378, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 378, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 378, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_2);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 378, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 378, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 378, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_2);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 378, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_label_i, __pyx_t_3);
    __pyx_t_3 = 0;
    __Pyx_INCREF(__pyx_t_7);
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_7);
    __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_t_7, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 378, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7);
    __pyx_t_7 = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":379
 *     bal_acc_scores = []
 *     for i, label_i in enumerate(labels[:-1]):
 *         for j, label_j in enumerate(labels[i+1:]):             # <<<<<<<<<<<<<<
 *             specific_y_true = y_bin[:, i]
 *             specific_y_pred = y_bin[:, j]
 */
    __Pyx_TraceLine(379,0,__PYX_ERR(0, 379, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_3 = __pyx_int_0;
    __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __Pyx_PyObject_GetSlice(__pyx_v_labels, 0, 0, &__pyx_t_1, NULL, NULL, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 379, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (likely(PyList_CheckExact(__pyx_t_6)) || PyTuple_CheckExact(__pyx_t_6)) {
      __pyx_t_1 = __pyx_t_6; __Pyx_INCREF(__pyx_t_1);
      __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 379, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 379, __pyx_L1_error)
            #endif
            if (__pyx_t_9 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 379, __pyx_L1_error)
          #else
          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 379, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 379, __pyx_L1_error)
            #endif
            if (__pyx_t_9 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_6); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 379, __pyx_L1_error)
          #else
          __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 379, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          #endif
        }
      } else {
        __pyx_t_6 = __pyx_t_10(__pyx_t_1);
        if (unlikely(!__pyx_t_6)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 379, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_6);
      }
      __Pyx_XDECREF_SET(__pyx_v_label_j, __pyx_t_6);
      __pyx_t_6 = 0;
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_3);
      __pyx_t_6 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 379, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_3);
      __pyx_t_3 = __pyx_t_6;
      __pyx_t_6 = 0;

      /* "gofast/tools/mathex.pyx":380
 *     for i, label_i in enumerate(labels[:-1]):
 *         for j, label_j in enumerate(labels[i+1:]):
 *             specific_y_true = y_bin[:, i]             # <<<<<<<<<<<<<<
 *             specific_y_pred = y_bin[:, j]
 *             auc_score = roc_auc_score(
 */
      __Pyx_TraceLine(380,0,__PYX_ERR(0, 380, __pyx_L1_error))
      __pyx_t_6 = PyTuple_New(2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 380, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_slice__9)) __PYX_ERR(0, 380, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_i);
      __Pyx_GIVEREF(__pyx_v_i);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_i)) __PYX_ERR(0, 380, __pyx_L1_error);
      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_y_bin, __pyx_t_6); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 380, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF_SET(__pyx_v_specific_y_true, __pyx_t_11);
      __pyx_t_11 = 0;

      /* "gofast/tools/mathex.pyx":381
 *         for j, label_j in enumerate(labels[i+1:]):
 *             specific_y_true = y_bin[:, i]
 *             specific_y_pred = y_bin[:, j]             # <<<<<<<<<<<<<<
 *             auc_score = roc_auc_score(
 *                 specific_y_true, specific_y_pred, sample_weight=sample_weight)
 */
      __Pyx_TraceLine(381,0,__PYX_ERR(0, 381, __pyx_L1_error))
      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 381, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_slice__9)) __PYX_ERR(0, 381, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_j);
      __Pyx_GIVEREF(__pyx_v_j);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_v_j)) __PYX_ERR(0, 381, __pyx_L1_error);
      __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_y_bin, __pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 381, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_XDECREF_SET(__pyx_v_specific_y_pred, __pyx_t_6);
      __pyx_t_6 = 0;

      /* "gofast/tools/mathex.pyx":382
 *             specific_y_true = y_bin[:, i]
 *             specific_y_pred = y_bin[:, j]
 *             auc_score = roc_auc_score(             # <<<<<<<<<<<<<<
 *                 specific_y_true, specific_y_pred, sample_weight=sample_weight)
 *             bal_acc_scores.append(auc_score)
 */
      __Pyx_TraceLine(382,0,__PYX_ERR(0, 382, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_roc_auc_score); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 382, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);

      /* "gofast/tools/mathex.pyx":383
 *             specific_y_pred = y_bin[:, j]
 *             auc_score = roc_auc_score(
 *                 specific_y_true, specific_y_pred, sample_weight=sample_weight)             # <<<<<<<<<<<<<<
 *             bal_acc_scores.append(auc_score)
 * 
 */
      __Pyx_TraceLine(383,0,__PYX_ERR(0, 383, __pyx_L1_error))
      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 382, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_INCREF(__pyx_v_specific_y_true);
      __Pyx_GIVEREF(__pyx_v_specific_y_true);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_v_specific_y_true)) __PYX_ERR(0, 382, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_specific_y_pred);
      __Pyx_GIVEREF(__pyx_v_specific_y_pred);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_v_specific_y_pred)) __PYX_ERR(0, 382, __pyx_L1_error);
      __pyx_t_12 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 383, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      if (PyDict_SetItem(__pyx_t_12, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 383, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":382
 *             specific_y_true = y_bin[:, i]
 *             specific_y_pred = y_bin[:, j]
 *             auc_score = roc_auc_score(             # <<<<<<<<<<<<<<
 *                 specific_y_true, specific_y_pred, sample_weight=sample_weight)
 *             bal_acc_scores.append(auc_score)
 */
      __Pyx_TraceLine(382,0,__PYX_ERR(0, 382, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_11, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 382, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_13);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_XDECREF_SET(__pyx_v_auc_score, __pyx_t_13);
      __pyx_t_13 = 0;

      /* "gofast/tools/mathex.pyx":384
 *             auc_score = roc_auc_score(
 *                 specific_y_true, specific_y_pred, sample_weight=sample_weight)
 *             bal_acc_scores.append(auc_score)             # <<<<<<<<<<<<<<
 * 
 *     return np.array(bal_acc_scores)
 */
      __Pyx_TraceLine(384,0,__PYX_ERR(0, 384, __pyx_L1_error))
      __pyx_t_14 = __Pyx_PyList_Append(__pyx_v_bal_acc_scores, __pyx_v_auc_score); if (unlikely(__pyx_t_14 == ((int)-1))) __PYX_ERR(0, 384, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":379
 *     bal_acc_scores = []
 *     for i, label_i in enumerate(labels[:-1]):
 *         for j, label_j in enumerate(labels[i+1:]):             # <<<<<<<<<<<<<<
 *             specific_y_true = y_bin[:, i]
 *             specific_y_pred = y_bin[:, j]
 */
      __Pyx_TraceLine(379,0,__PYX_ERR(0, 379, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":378
 * 
 *     bal_acc_scores = []
 *     for i, label_i in enumerate(labels[:-1]):             # <<<<<<<<<<<<<<
 *         for j, label_j in enumerate(labels[i+1:]):
 *             specific_y_true = y_bin[:, i]
 */
    __Pyx_TraceLine(378,0,__PYX_ERR(0, 378, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "gofast/tools/mathex.pyx":386
 *             bal_acc_scores.append(auc_score)
 * 
 *     return np.array(bal_acc_scores)             # <<<<<<<<<<<<<<
 * 
 * def compute_cost_based_threshold(
 */
  __Pyx_TraceLine(386,0,__PYX_ERR(0, 386, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 386, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_bal_acc_scores};
    __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 386, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":372
 *     return np.array(bal_acc_scores)
 * 
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):             # <<<<<<<<<<<<<<
 *     le = LabelEncoder()
 *     y_true_encoded = le.fit_transform(y_true)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex._balanced_accuracy_ovo", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_le);
  __Pyx_XDECREF(__pyx_v_y_true_encoded);
  __Pyx_XDECREF(__pyx_v_y_bin);
  __Pyx_XDECREF(__pyx_v_bal_acc_scores);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_label_i);
  __Pyx_XDECREF(__pyx_v_j);
  __Pyx_XDECREF(__pyx_v_label_j);
  __Pyx_XDECREF(__pyx_v_specific_y_true);
  __Pyx_XDECREF(__pyx_v_specific_y_pred);
  __Pyx_XDECREF(__pyx_v_auc_score);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":388
 *     return np.array(bal_acc_scores)
 * 
 * def compute_cost_based_threshold(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, costs, *,
 *     sample_weight=None
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_11compute_cost_based_threshold(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_10compute_cost_based_threshold, "\n    Compute threshold using a cost-based approach.\n\n    This method computes the total cost for each potential threshold and \n    selects the one that minimizes this cost.\n    \n    Parameters:\n    -----------\n    y_true : array-like of shape (n_samples,)\n        True binary labels.\n    y_scores : array-like of shape (n_samples,)\n        Target scores, can either be probability estimates of the positive class,\n        confidence values, or non-thresholded measure of decisions (as returned\n        by decision_function on some classifiers).\n    costs : tuple (C_FP, C_FN)\n        Costs associated with false positives (C_FP) and false negatives (C_FN).\n    sample_weight : array-like of shape (n_samples,), optional (default=None)\n        Sample weights.\n\n    Returns\n    --------\n    optimal_threshold : float\n        The threshold that minimizes the total cost.\n    total_cost : float\n        The total cost at the optimal threshold.\n\n    Examples\n    ---------\n    >>> from gofast.tools.mathex import compute_cost_based_threshold\n    >>> y_true = [0, 1, 1, 0, 1]\n    >>> y_scores = [0.1, 0.8, 0.3, 0.6, 0.9]\n    >>> costs = (1, 2)  # Cost of FP = 1, Cost of FN = 2\n    >>> optimal_threshold, total_cost = compute_cost_based_threshold(y_true, y_scores, costs)\n    >>> print(\"Optimal Threshold:\", optimal_threshold)\n    Optimal Threshold: 0.8\n    >>> print(\"Total Cost:\", total_cost)\n    Total Cost: 4.0\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_11compute_cost_based_threshold = {"compute_cost_based_threshold", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_11compute_cost_based_threshold, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_10compute_cost_based_threshold};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_11compute_cost_based_threshold(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_scores = 0;
  PyObject *__pyx_v_costs = 0;
  PyObject *__pyx_v_sample_weight = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_cost_based_threshold (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_scores,&__pyx_n_s_costs,&__pyx_n_s_sample_weight,0};

    /* "gofast/tools/mathex.pyx":390
 * def compute_cost_based_threshold(
 *     y_true, y_scores, costs, *,
 *     sample_weight=None             # <<<<<<<<<<<<<<
 *     ):
 *     """
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_scores)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("compute_cost_based_threshold", 1, 3, 3, 1); __PYX_ERR(0, 388, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_costs)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("compute_cost_based_threshold", 1, 3, 3, 2); __PYX_ERR(0, 388, __pyx_L3_error)
        }
      }
      if (kw_args == 1) {
        const Py_ssize_t index = 3;
        PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
        if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 388, __pyx_L3_error)
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_cost_based_threshold") < 0)) __PYX_ERR(0, 388, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_scores = values[1];
    __pyx_v_costs = values[2];
    __pyx_v_sample_weight = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_cost_based_threshold", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 388, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_cost_based_threshold", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_10compute_cost_based_threshold(__pyx_self, __pyx_v_y_true, __pyx_v_y_scores, __pyx_v_costs, __pyx_v_sample_weight);

  /* "gofast/tools/mathex.pyx":388
 *     return np.array(bal_acc_scores)
 * 
 * def compute_cost_based_threshold(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, costs, *,
 *     sample_weight=None
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_10compute_cost_based_threshold(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_scores, PyObject *__pyx_v_costs, PyObject *__pyx_v_sample_weight) {
  PyObject *__pyx_v_thresholds = NULL;
  PyObject *__pyx_v_best_threshold = NULL;
  PyObject *__pyx_v_C_FP = NULL;
  PyObject *__pyx_v_C_FN = NULL;
  PyObject *__pyx_v_min_cost = NULL;
  PyObject *__pyx_v_threshold = NULL;
  PyObject *__pyx_v_predicted_labels = NULL;
  PyObject *__pyx_v_FP = NULL;
  PyObject *__pyx_v_FN = NULL;
  PyObject *__pyx_v_total_cost = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  double __pyx_t_7;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__17)
  __Pyx_RefNannySetupContext("compute_cost_based_threshold", 0);
  __Pyx_TraceCall("compute_cost_based_threshold", __pyx_f[0], 388, 0, __PYX_ERR(0, 388, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_scores);
  __Pyx_INCREF(__pyx_v_sample_weight);

  /* "gofast/tools/mathex.pyx":430
 *     Total Cost: 4.0
 *     """
 *     y_true, y_scores = _ensure_y_is_valid(y_true, y_scores, y_numeric=True)             # <<<<<<<<<<<<<<
 *     # Get unique thresholds from the scores
 *     thresholds = np.unique(y_scores)
 */
  __Pyx_TraceLine(430,0,__PYX_ERR(0, 430, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 430, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_scores);
  __Pyx_GIVEREF(__pyx_v_y_scores);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_scores)) __PYX_ERR(0, 430, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 430, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 430, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 430, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 430, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 430, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 430, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_scores, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":432
 *     y_true, y_scores = _ensure_y_is_valid(y_true, y_scores, y_numeric=True)
 *     # Get unique thresholds from the scores
 *     thresholds = np.unique(y_scores)             # <<<<<<<<<<<<<<
 * 
 *     # Initialize variables to store the best threshold and minimum cost
 */
  __Pyx_TraceLine(432,0,__PYX_ERR(0, 432, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 432, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_unique); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 432, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_scores};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 432, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_thresholds = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":435
 * 
 *     # Initialize variables to store the best threshold and minimum cost
 *     best_threshold = None             # <<<<<<<<<<<<<<
 *     C_FP, C_FN = validate_length_range(costs, param_name="costs")
 *     min_cost = float('inf')
 */
  __Pyx_TraceLine(435,0,__PYX_ERR(0, 435, __pyx_L1_error))
  __Pyx_INCREF(Py_None);
  __pyx_v_best_threshold = Py_None;

  /* "gofast/tools/mathex.pyx":436
 *     # Initialize variables to store the best threshold and minimum cost
 *     best_threshold = None
 *     C_FP, C_FN = validate_length_range(costs, param_name="costs")             # <<<<<<<<<<<<<<
 *     min_cost = float('inf')
 * 
 */
  __Pyx_TraceLine(436,0,__PYX_ERR(0, 436, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_validate_length_range); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 436, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 436, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_costs);
  __Pyx_GIVEREF(__pyx_v_costs);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_costs)) __PYX_ERR(0, 436, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 436, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_param_name, __pyx_n_u_costs) < 0) __PYX_ERR(0, 436, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 436, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 436, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_3);
    #else
    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 436, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 436, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 436, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
    index = 0; __pyx_t_2 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L5_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    index = 1; __pyx_t_3 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_4), 2) < 0) __PYX_ERR(0, 436, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L6_unpacking_done;
    __pyx_L5_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 436, __pyx_L1_error)
    __pyx_L6_unpacking_done:;
  }
  __pyx_v_C_FP = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_v_C_FN = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":437
 *     best_threshold = None
 *     C_FP, C_FN = validate_length_range(costs, param_name="costs")
 *     min_cost = float('inf')             # <<<<<<<<<<<<<<
 * 
 *     # If sample weights are not provided, set them to ones
 */
  __Pyx_TraceLine(437,0,__PYX_ERR(0, 437, __pyx_L1_error))
  __pyx_t_7 = __Pyx_PyUnicode_AsDouble(__pyx_n_u_inf); if (unlikely(__pyx_t_7 == ((double)((double)-1)) && PyErr_Occurred())) __PYX_ERR(0, 437, __pyx_L1_error)
  __pyx_t_1 = PyFloat_FromDouble(__pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 437, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_min_cost = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":440
 * 
 *     # If sample weights are not provided, set them to ones
 *     if sample_weight is None:             # <<<<<<<<<<<<<<
 *         sample_weight = np.ones_like(y_true)
 * 
 */
  __Pyx_TraceLine(440,0,__PYX_ERR(0, 440, __pyx_L1_error))
  __pyx_t_8 = (__pyx_v_sample_weight == Py_None);
  if (__pyx_t_8) {

    /* "gofast/tools/mathex.pyx":441
 *     # If sample weights are not provided, set them to ones
 *     if sample_weight is None:
 *         sample_weight = np.ones_like(y_true)             # <<<<<<<<<<<<<<
 * 
 *     # Validate sample weights
 */
    __Pyx_TraceLine(441,0,__PYX_ERR(0, 441, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 441, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ones_like); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 441, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 441, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_sample_weight, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":440
 * 
 *     # If sample weights are not provided, set them to ones
 *     if sample_weight is None:             # <<<<<<<<<<<<<<
 *         sample_weight = np.ones_like(y_true)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":444
 * 
 *     # Validate sample weights
 *     sample_weight = validate_sample_weights(             # <<<<<<<<<<<<<<
 *         sample_weight, y_true, normalize=True)
 *     # Iterate over each unique threshold
 */
  __Pyx_TraceLine(444,0,__PYX_ERR(0, 444, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_validate_sample_weights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":445
 *     # Validate sample weights
 *     sample_weight = validate_sample_weights(
 *         sample_weight, y_true, normalize=True)             # <<<<<<<<<<<<<<
 *     # Iterate over each unique threshold
 *     for threshold in thresholds:
 */
  __Pyx_TraceLine(445,0,__PYX_ERR(0, 445, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_sample_weight);
  __Pyx_GIVEREF(__pyx_v_sample_weight);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_sample_weight)) __PYX_ERR(0, 444, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_true)) __PYX_ERR(0, 444, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 445, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_normalize, Py_True) < 0) __PYX_ERR(0, 445, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":444
 * 
 *     # Validate sample weights
 *     sample_weight = validate_sample_weights(             # <<<<<<<<<<<<<<
 *         sample_weight, y_true, normalize=True)
 *     # Iterate over each unique threshold
 */
  __Pyx_TraceLine(444,0,__PYX_ERR(0, 444, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 444, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_sample_weight, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":447
 *         sample_weight, y_true, normalize=True)
 *     # Iterate over each unique threshold
 *     for threshold in thresholds:             # <<<<<<<<<<<<<<
 *         # Predict labels based on the current threshold
 *         predicted_labels = (y_scores >= threshold).astype(int)
 */
  __Pyx_TraceLine(447,0,__PYX_ERR(0, 447, __pyx_L1_error))
  if (likely(PyList_CheckExact(__pyx_v_thresholds)) || PyTuple_CheckExact(__pyx_v_thresholds)) {
    __pyx_t_4 = __pyx_v_thresholds; __Pyx_INCREF(__pyx_t_4);
    __pyx_t_9 = 0;
    __pyx_t_10 = NULL;
  } else {
    __pyx_t_9 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_v_thresholds); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 447, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 447, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_10)) {
      if (likely(PyList_CheckExact(__pyx_t_4))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_4);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 447, __pyx_L1_error)
          #endif
          if (__pyx_t_9 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_9); __Pyx_INCREF(__pyx_t_3); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 447, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_4, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 447, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_4);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 447, __pyx_L1_error)
          #endif
          if (__pyx_t_9 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_9); __Pyx_INCREF(__pyx_t_3); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 447, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_4, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 447, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_10(__pyx_t_4);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 447, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_threshold, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":449
 *     for threshold in thresholds:
 *         # Predict labels based on the current threshold
 *         predicted_labels = (y_scores >= threshold).astype(int)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate false positives (FP) and false negatives (FN) using sample weights
 */
    __Pyx_TraceLine(449,0,__PYX_ERR(0, 449, __pyx_L1_error))
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_y_scores, __pyx_v_threshold, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 449, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_astype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 449, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, ((PyObject *)(&PyInt_Type))};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 449, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_predicted_labels, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":452
 * 
 *         # Calculate false positives (FP) and false negatives (FN) using sample weights
 *         FP = np.sum((predicted_labels == 1) & (y_true == 0) & (sample_weight > 0))             # <<<<<<<<<<<<<<
 *         FN = np.sum((predicted_labels == 0) & (y_true == 1) & (sample_weight > 0))
 * 
 */
    __Pyx_TraceLine(452,0,__PYX_ERR(0, 452, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyInt_EqObjC(__pyx_v_predicted_labels, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_v_y_true, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_12 = PyNumber_And(__pyx_t_1, __pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = PyObject_RichCompare(__pyx_v_sample_weight, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 452, __pyx_L1_error)
    __pyx_t_1 = PyNumber_And(__pyx_t_12, __pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 452, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_t_1};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 452, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_FP, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":453
 *         # Calculate false positives (FP) and false negatives (FN) using sample weights
 *         FP = np.sum((predicted_labels == 1) & (y_true == 0) & (sample_weight > 0))
 *         FN = np.sum((predicted_labels == 0) & (y_true == 1) & (sample_weight > 0))             # <<<<<<<<<<<<<<
 * 
 *         # Calculate total cost using the provided costs and weighted FP/FN counts
 */
    __Pyx_TraceLine(453,0,__PYX_ERR(0, 453, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_v_predicted_labels, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_11 = __Pyx_PyInt_EqObjC(__pyx_v_y_true, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_12 = PyNumber_And(__pyx_t_2, __pyx_t_11); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = PyObject_RichCompare(__pyx_v_sample_weight, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 453, __pyx_L1_error)
    __pyx_t_2 = PyNumber_And(__pyx_t_12, __pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 453, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_t_2};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 453, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_FN, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":456
 * 
 *         # Calculate total cost using the provided costs and weighted FP/FN counts
 *         total_cost = C_FP * FP + C_FN * FN             # <<<<<<<<<<<<<<
 * 
 *         # Update the minimum cost and best threshold if the current cost is lower
 */
    __Pyx_TraceLine(456,0,__PYX_ERR(0, 456, __pyx_L1_error))
    __pyx_t_3 = PyNumber_Multiply(__pyx_v_C_FP, __pyx_v_FP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 456, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyNumber_Multiply(__pyx_v_C_FN, __pyx_v_FN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 456, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 456, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_total_cost, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":459
 * 
 *         # Update the minimum cost and best threshold if the current cost is lower
 *         if total_cost < min_cost:             # <<<<<<<<<<<<<<
 *             min_cost = total_cost
 *             best_threshold = threshold
 */
    __Pyx_TraceLine(459,0,__PYX_ERR(0, 459, __pyx_L1_error))
    __pyx_t_2 = PyObject_RichCompare(__pyx_v_total_cost, __pyx_v_min_cost, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 459, __pyx_L1_error)
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 459, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (__pyx_t_8) {

      /* "gofast/tools/mathex.pyx":460
 *         # Update the minimum cost and best threshold if the current cost is lower
 *         if total_cost < min_cost:
 *             min_cost = total_cost             # <<<<<<<<<<<<<<
 *             best_threshold = threshold
 * 
 */
      __Pyx_TraceLine(460,0,__PYX_ERR(0, 460, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_total_cost);
      __Pyx_DECREF_SET(__pyx_v_min_cost, __pyx_v_total_cost);

      /* "gofast/tools/mathex.pyx":461
 *         if total_cost < min_cost:
 *             min_cost = total_cost
 *             best_threshold = threshold             # <<<<<<<<<<<<<<
 * 
 *     # Return the best threshold and its corresponding minimum cost
 */
      __Pyx_TraceLine(461,0,__PYX_ERR(0, 461, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_threshold);
      __Pyx_DECREF_SET(__pyx_v_best_threshold, __pyx_v_threshold);

      /* "gofast/tools/mathex.pyx":459
 * 
 *         # Update the minimum cost and best threshold if the current cost is lower
 *         if total_cost < min_cost:             # <<<<<<<<<<<<<<
 *             min_cost = total_cost
 *             best_threshold = threshold
 */
    }

    /* "gofast/tools/mathex.pyx":447
 *         sample_weight, y_true, normalize=True)
 *     # Iterate over each unique threshold
 *     for threshold in thresholds:             # <<<<<<<<<<<<<<
 *         # Predict labels based on the current threshold
 *         predicted_labels = (y_scores >= threshold).astype(int)
 */
    __Pyx_TraceLine(447,0,__PYX_ERR(0, 447, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":464
 * 
 *     # Return the best threshold and its corresponding minimum cost
 *     return best_threshold, min_cost             # <<<<<<<<<<<<<<
 * 
 * def compute_youdens_index(
 */
  __Pyx_TraceLine(464,0,__PYX_ERR(0, 464, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 464, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_best_threshold);
  __Pyx_GIVEREF(__pyx_v_best_threshold);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_best_threshold)) __PYX_ERR(0, 464, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_min_cost);
  __Pyx_GIVEREF(__pyx_v_min_cost);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_min_cost)) __PYX_ERR(0, 464, __pyx_L1_error);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":388
 *     return np.array(bal_acc_scores)
 * 
 * def compute_cost_based_threshold(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, costs, *,
 *     sample_weight=None
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_cost_based_threshold", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_thresholds);
  __Pyx_XDECREF(__pyx_v_best_threshold);
  __Pyx_XDECREF(__pyx_v_C_FP);
  __Pyx_XDECREF(__pyx_v_C_FN);
  __Pyx_XDECREF(__pyx_v_min_cost);
  __Pyx_XDECREF(__pyx_v_threshold);
  __Pyx_XDECREF(__pyx_v_predicted_labels);
  __Pyx_XDECREF(__pyx_v_FP);
  __Pyx_XDECREF(__pyx_v_FN);
  __Pyx_XDECREF(__pyx_v_total_cost);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_scores);
  __Pyx_XDECREF(__pyx_v_sample_weight);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":466
 *     return best_threshold, min_cost
 * 
 * def compute_youdens_index(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, *,
 *     sample_weight=None,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13compute_youdens_index(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_12compute_youdens_index, "\n    Compute Youden's Index and optimal threshold.\n\n    Youden's Index is a single statistic that captures the performance of a\n    binary classification test. \n    It's defined as the maximum vertical distance between the ROC curve and \n    the diagonal line.\n    Mathematically, it is calculated as:\n    \n    .. math::\n        J = \text{True Positive Rate} - \text{False Positive Rate}\n\n    Parameters:\n    -----------\n    y_true : array-like of shape (n_samples,)\n        True binary labels.\n    y_scores : array-like of shape (n_samples,)\n        Target scores, can either be probability estimates of the positive class,\n        confidence values, or non-thresholded measure of decisions (as returned\n        by decision_function on some classifiers).\n    sample_weight : array-like of shape (n_samples,), optional (default=None)\n        Sample weights.\n    pos_label : int or str, optional (default=None)\n        The label of the positive class.\n    drop_intermediate : bool, optional (default=True)\n        Whether to drop some suboptimal thresholds that do not appear\n        on a ROC curve with vertical drops.\n\n    Returns:\n    --------\n    optimal_threshold : float\n        The optimal threshold that maximizes Youden's Index.\n    optimal_youden : float\n        The value of Youden's Index at the optimal threshold.\n    \n    Examples:\n    ---------\n    >>> from gofast.tools.mathex import compute_youdens_index\n    >>> y_true = [0, 1, 1, 0, 1]\n    >>> y_scores = [0.1, 0.8, 0.3, 0.6, 0.9]\n    >>> optimal_threshold, optimal_youden = compute_youdens_index(y_true, y_scores)\n    >>> print(\"Optimal Threshold:\", optimal_threshold)\n    Optimal Threshold: 0.8\n    >>> print(\"Youden's Index:\", optimal_youden)\n    Youden's Index: 0.6\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_13compute_youdens_index = {"compute_youdens_index", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_13compute_youdens_index, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_12compute_youdens_index};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13compute_youdens_index(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_scores = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_pos_label = 0;
  PyObject *__pyx_v_drop_intermediate = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_youdens_index (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_scores,&__pyx_n_s_sample_weight,&__pyx_n_s_pos_label,&__pyx_n_s_drop_intermediate,0};

    /* "gofast/tools/mathex.pyx":468
 * def compute_youdens_index(
 *     y_true, y_scores, *,
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     pos_label=None,
 *     drop_intermediate=True
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));

    /* "gofast/tools/mathex.pyx":469
 *     y_true, y_scores, *,
 *     sample_weight=None,
 *     pos_label=None,             # <<<<<<<<<<<<<<
 *     drop_intermediate=True
 *     ):
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));

    /* "gofast/tools/mathex.pyx":470
 *     sample_weight=None,
 *     pos_label=None,
 *     drop_intermediate=True             # <<<<<<<<<<<<<<
 *     ):
 *     """
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 466, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_scores)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 466, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("compute_youdens_index", 1, 2, 2, 1); __PYX_ERR(0, 466, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && likely(kw_args <= 3)) {
        Py_ssize_t index;
        for (index = 2; index < 5 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 466, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_youdens_index") < 0)) __PYX_ERR(0, 466, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_scores = values[1];
    __pyx_v_sample_weight = values[2];
    __pyx_v_pos_label = values[3];
    __pyx_v_drop_intermediate = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_youdens_index", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 466, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_youdens_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_12compute_youdens_index(__pyx_self, __pyx_v_y_true, __pyx_v_y_scores, __pyx_v_sample_weight, __pyx_v_pos_label, __pyx_v_drop_intermediate);

  /* "gofast/tools/mathex.pyx":466
 *     return best_threshold, min_cost
 * 
 * def compute_youdens_index(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, *,
 *     sample_weight=None,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_12compute_youdens_index(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_scores, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_pos_label, PyObject *__pyx_v_drop_intermediate) {
  PyObject *__pyx_v_fpr = NULL;
  PyObject *__pyx_v_tpr = NULL;
  PyObject *__pyx_v_thresholds = NULL;
  PyObject *__pyx_v_youdens_index = NULL;
  PyObject *__pyx_v_optimal_idx = NULL;
  PyObject *__pyx_v_optimal_threshold = NULL;
  PyObject *__pyx_v_optimal_youden = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__18)
  __Pyx_RefNannySetupContext("compute_youdens_index", 0);
  __Pyx_TraceCall("compute_youdens_index", __pyx_f[0], 466, 0, __PYX_ERR(0, 466, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_scores);

  /* "gofast/tools/mathex.pyx":520
 *     """
 *     # Ensure input arrays y_true and y_scores are valid
 *     y_true, y_scores = _ensure_y_is_valid(y_true, y_scores, y_numeric=True)             # <<<<<<<<<<<<<<
 * 
 *     # Check if the class labels are binary
 */
  __Pyx_TraceLine(520,0,__PYX_ERR(0, 520, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 520, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 520, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 520, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_scores);
  __Pyx_GIVEREF(__pyx_v_y_scores);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_scores)) __PYX_ERR(0, 520, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 520, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 520, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 520, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 520, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 520, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 520, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_scores, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":523
 * 
 *     # Check if the class labels are binary
 *     if not is_binary_class(y_true):             # <<<<<<<<<<<<<<
 *         raise ValueError("Youden's index calculation requires binary class"
 *                          "labels. Provided labels are not binary.")
 */
  __Pyx_TraceLine(523,0,__PYX_ERR(0, 523, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_is_binary_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 523, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 523, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 523, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_8 = (!__pyx_t_7);
  if (unlikely(__pyx_t_8)) {

    /* "gofast/tools/mathex.pyx":524
 *     # Check if the class labels are binary
 *     if not is_binary_class(y_true):
 *         raise ValueError("Youden's index calculation requires binary class"             # <<<<<<<<<<<<<<
 *                          "labels. Provided labels are not binary.")
 * 
 */
    __Pyx_TraceLine(524,0,__PYX_ERR(0, 524, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 524, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __PYX_ERR(0, 524, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":523
 * 
 *     # Check if the class labels are binary
 *     if not is_binary_class(y_true):             # <<<<<<<<<<<<<<
 *         raise ValueError("Youden's index calculation requires binary class"
 *                          "labels. Provided labels are not binary.")
 */
  }

  /* "gofast/tools/mathex.pyx":528
 * 
 *     # Validate scores as proper probability distributions
 *     y_scores = validate_scores(y_scores, y_true, mode="passthrough")             # <<<<<<<<<<<<<<
 * 
 *     # Calculate the ROC curve and the corresponding AUC
 */
  __Pyx_TraceLine(528,0,__PYX_ERR(0, 528, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_validate_scores); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_scores);
  __Pyx_GIVEREF(__pyx_v_y_scores);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_scores)) __PYX_ERR(0, 528, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_true)) __PYX_ERR(0, 528, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_mode, __pyx_n_u_passthrough) < 0) __PYX_ERR(0, 528, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 528, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_scores, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":531
 * 
 *     # Calculate the ROC curve and the corresponding AUC
 *     fpr, tpr, thresholds = roc_curve(             # <<<<<<<<<<<<<<
 *         y_true, y_scores, pos_label=pos_label,
 *         sample_weight=sample_weight,
 */
  __Pyx_TraceLine(531,0,__PYX_ERR(0, 531, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_roc_curve); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 531, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":532
 *     # Calculate the ROC curve and the corresponding AUC
 *     fpr, tpr, thresholds = roc_curve(
 *         y_true, y_scores, pos_label=pos_label,             # <<<<<<<<<<<<<<
 *         sample_weight=sample_weight,
 *         drop_intermediate=drop_intermediate
 */
  __Pyx_TraceLine(532,0,__PYX_ERR(0, 532, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 531, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_y_true)) __PYX_ERR(0, 531, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_scores);
  __Pyx_GIVEREF(__pyx_v_y_scores);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_y_scores)) __PYX_ERR(0, 531, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 532, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_pos_label, __pyx_v_pos_label) < 0) __PYX_ERR(0, 532, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":533
 *     fpr, tpr, thresholds = roc_curve(
 *         y_true, y_scores, pos_label=pos_label,
 *         sample_weight=sample_weight,             # <<<<<<<<<<<<<<
 *         drop_intermediate=drop_intermediate
 *     )
 */
  __Pyx_TraceLine(533,0,__PYX_ERR(0, 533, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 532, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":534
 *         y_true, y_scores, pos_label=pos_label,
 *         sample_weight=sample_weight,
 *         drop_intermediate=drop_intermediate             # <<<<<<<<<<<<<<
 *     )
 * 
 */
  __Pyx_TraceLine(534,0,__PYX_ERR(0, 534, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_drop_intermediate, __pyx_v_drop_intermediate) < 0) __PYX_ERR(0, 532, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":531
 * 
 *     # Calculate the ROC curve and the corresponding AUC
 *     fpr, tpr, thresholds = roc_curve(             # <<<<<<<<<<<<<<
 *         y_true, y_scores, pos_label=pos_label,
 *         sample_weight=sample_weight,
 */
  __Pyx_TraceLine(531,0,__PYX_ERR(0, 531, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 531, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 3)) {
      if (size > 3) __Pyx_RaiseTooManyValuesError(3);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 531, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 2); 
    } else {
      __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
      __pyx_t_1 = PyList_GET_ITEM(sequence, 2); 
    }
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_1);
    #else
    __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 531, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 531, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 531, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_9 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 531, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9);
    index = 0; __pyx_t_2 = __pyx_t_5(__pyx_t_9); if (unlikely(!__pyx_t_2)) goto __pyx_L6_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    index = 1; __pyx_t_3 = __pyx_t_5(__pyx_t_9); if (unlikely(!__pyx_t_3)) goto __pyx_L6_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 2; __pyx_t_1 = __pyx_t_5(__pyx_t_9); if (unlikely(!__pyx_t_1)) goto __pyx_L6_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_9), 3) < 0) __PYX_ERR(0, 531, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    goto __pyx_L7_unpacking_done;
    __pyx_L6_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 531, __pyx_L1_error)
    __pyx_L7_unpacking_done:;
  }
  __pyx_v_fpr = __pyx_t_2;
  __pyx_t_2 = 0;
  __pyx_v_tpr = __pyx_t_3;
  __pyx_t_3 = 0;
  __pyx_v_thresholds = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":538
 * 
 *     # Calculate Youden's Index for each threshold
 *     youdens_index = tpr - fpr             # <<<<<<<<<<<<<<
 * 
 *     # Find the optimal threshold (maximizes Youden's Index)
 */
  __Pyx_TraceLine(538,0,__PYX_ERR(0, 538, __pyx_L1_error))
  __pyx_t_4 = PyNumber_Subtract(__pyx_v_tpr, __pyx_v_fpr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 538, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_youdens_index = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":541
 * 
 *     # Find the optimal threshold (maximizes Youden's Index)
 *     optimal_idx = np.argmax(youdens_index)             # <<<<<<<<<<<<<<
 *     optimal_threshold = thresholds[optimal_idx]
 *     optimal_youden = youdens_index[optimal_idx]
 */
  __Pyx_TraceLine(541,0,__PYX_ERR(0, 541, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_argmax); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 541, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_youdens_index};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 541, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_optimal_idx = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":542
 *     # Find the optimal threshold (maximizes Youden's Index)
 *     optimal_idx = np.argmax(youdens_index)
 *     optimal_threshold = thresholds[optimal_idx]             # <<<<<<<<<<<<<<
 *     optimal_youden = youdens_index[optimal_idx]
 * 
 */
  __Pyx_TraceLine(542,0,__PYX_ERR(0, 542, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_thresholds, __pyx_v_optimal_idx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 542, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_optimal_threshold = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":543
 *     optimal_idx = np.argmax(youdens_index)
 *     optimal_threshold = thresholds[optimal_idx]
 *     optimal_youden = youdens_index[optimal_idx]             # <<<<<<<<<<<<<<
 * 
 *     return optimal_threshold, optimal_youden
 */
  __Pyx_TraceLine(543,0,__PYX_ERR(0, 543, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_youdens_index, __pyx_v_optimal_idx); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_optimal_youden = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":545
 *     optimal_youden = youdens_index[optimal_idx]
 * 
 *     return optimal_threshold, optimal_youden             # <<<<<<<<<<<<<<
 * 
 * def calculate_multiclass_avg_lr(
 */
  __Pyx_TraceLine(545,0,__PYX_ERR(0, 545, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 545, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_optimal_threshold);
  __Pyx_GIVEREF(__pyx_v_optimal_threshold);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_optimal_threshold)) __PYX_ERR(0, 545, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_optimal_youden);
  __Pyx_GIVEREF(__pyx_v_optimal_youden);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_optimal_youden)) __PYX_ERR(0, 545, __pyx_L1_error);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":466
 *     return best_threshold, min_cost
 * 
 * def compute_youdens_index(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, *,
 *     sample_weight=None,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_youdens_index", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_fpr);
  __Pyx_XDECREF(__pyx_v_tpr);
  __Pyx_XDECREF(__pyx_v_thresholds);
  __Pyx_XDECREF(__pyx_v_youdens_index);
  __Pyx_XDECREF(__pyx_v_optimal_idx);
  __Pyx_XDECREF(__pyx_v_optimal_threshold);
  __Pyx_XDECREF(__pyx_v_optimal_youden);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_scores);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":547
 *     return optimal_threshold, optimal_youden
 * 
 * def calculate_multiclass_avg_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     strategy='ovr',
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_15calculate_multiclass_avg_lr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_14calculate_multiclass_avg_lr, "\n    Calculate the average likelihood ratio for multiclass classification \n    based on the average sensitivity and specificity across all classes or \n    class pairs.\n\n    This function supports one-versus-rest (OvR) and one-versus-one (OvO) \n    strategies for multiclass data and computes the likelihood ratio either \n    positively or negatively based on the specified consensus.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True class labels as integers.\n    y_pred : array-like\n        Predicted class labels as integers.\n    strategy : str, optional\n        Specifies the computation strategy: 'ovr' for one-versus-rest or 'ovo' \n        for one-versus-one.\n    consensus : str, optional\n        'positive' for positive likelihood ratio or 'negative' for negative \n        likelihood ratio.\n    sample_weight : array-like, optional\n        Weights applied to classes in averaging sensitivity and specificity. \n        If None, equal weighting is assumed.\n    epsilon : float, optional\n        A small value to prevent division by zero in calculations. \n        Default is 1e-10.\n\n    Returns\n    -------\n    float\n        The computed average likelihood ratio.\n    float\n        The average sensitivity computed across classes or class pairs.\n    float\n        The average specificity computed across classes or class pairs.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_multiclass_avg_lr\n    >>> y_true = [0, 1, 2, 2, 1, 0]\n    >>> y_pred = [0, 2, 1, 2, 1, 0]\n    >>> lr, avg_sens, avg_spec = calculate_multiclass_avg_lr(\n    ...    y_true, y_pred, strategy='ovr', consensus='positive')\n    >>> print(f\"Likelihood Ratio: {lr:.2f}, \n    ...          Average Sensitivity: {avg_sens:.2f},\n    ...          Average Specificity: {avg_spec:.2f}\")\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_15calculate_multiclass_avg_lr = {"calculate_multiclass_avg_lr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_15calculate_multiclass_avg_lr, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_14calculate_multiclass_avg_lr};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_15calculate_multiclass_avg_lr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_strategy = 0;
  PyObject *__pyx_v_consensus = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_multi_output = 0;
  PyObject *__pyx_v_epsilon = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_multiclass_avg_lr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_strategy,&__pyx_n_s_consensus,&__pyx_n_s_sample_weight,&__pyx_n_s_multi_output,&__pyx_n_s_epsilon,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_ovr)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_positive)));

    /* "gofast/tools/mathex.pyx":551
 *     strategy='ovr',
 *     consensus="positive",
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     multi_output='uniform_average',
 *     epsilon=1e-10
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_uniform_average)));
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_10)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 547, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 547, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("calculate_multiclass_avg_lr", 1, 2, 2, 1); __PYX_ERR(0, 547, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && likely(kw_args <= 5)) {
        Py_ssize_t index;
        for (index = 2; index < 7 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 547, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_multiclass_avg_lr") < 0)) __PYX_ERR(0, 547, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_strategy = values[2];
    __pyx_v_consensus = values[3];
    __pyx_v_sample_weight = values[4];
    __pyx_v_multi_output = values[5];
    __pyx_v_epsilon = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_multiclass_avg_lr", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 547, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_multiclass_avg_lr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_14calculate_multiclass_avg_lr(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_strategy, __pyx_v_consensus, __pyx_v_sample_weight, __pyx_v_multi_output, __pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":547
 *     return optimal_threshold, optimal_youden
 * 
 * def calculate_multiclass_avg_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     strategy='ovr',
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_14calculate_multiclass_avg_lr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_strategy, PyObject *__pyx_v_consensus, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_multi_output, PyObject *__pyx_v_epsilon) {
  PyObject *__pyx_v_classes = NULL;
  PyObject *__pyx_v_sensitivities = NULL;
  PyObject *__pyx_v_specificities = NULL;
  PyObject *__pyx_v_y_true_binarized = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_cls = NULL;
  PyObject *__pyx_v_sensitivity = NULL;
  PyObject *__pyx_v_specificity = NULL;
  PyObject *__pyx_v_cls1 = NULL;
  PyObject *__pyx_v_cls2 = NULL;
  PyObject *__pyx_v_relevant_mask = NULL;
  PyObject *__pyx_v_y_true_binary = NULL;
  PyObject *__pyx_v_y_pred_binary = NULL;
  PyObject *__pyx_v_avg_sensitivity = NULL;
  PyObject *__pyx_v_avg_specificity = NULL;
  PyObject *__pyx_v_lr = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *(*__pyx_t_12)(PyObject *);
  int __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__20)
  __Pyx_RefNannySetupContext("calculate_multiclass_avg_lr", 0);
  __Pyx_TraceCall("calculate_multiclass_avg_lr", __pyx_f[0], 547, 0, __PYX_ERR(0, 547, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_strategy);
  __Pyx_INCREF(__pyx_v_consensus);
  __Pyx_INCREF(__pyx_v_sample_weight);
  __Pyx_INCREF(__pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":603
 *     ...          Average Specificity: {avg_spec:.2f}")
 *     """
 *     _ensure_y_is_valid( y_true, y_pred, y_numeric =True)             # <<<<<<<<<<<<<<
 *     ensure_non_negative(
 *         y_true, y_pred,
 */
  __Pyx_TraceLine(603,0,__PYX_ERR(0, 603, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 603, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 603, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 603, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 603, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 603, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 603, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 603, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":604
 *     """
 *     _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     ensure_non_negative(             # <<<<<<<<<<<<<<
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."
 */
  __Pyx_TraceLine(604,0,__PYX_ERR(0, 604, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_ensure_non_negative); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":605
 *     _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     ensure_non_negative(
 *         y_true, y_pred,             # <<<<<<<<<<<<<<
 *         err_msg="y_true and y_pred must contain non-negative values."
 *     )
 */
  __Pyx_TraceLine(605,0,__PYX_ERR(0, 605, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 604, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_y_true)) __PYX_ERR(0, 604, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_y_pred)) __PYX_ERR(0, 604, __pyx_L1_error);

  /* "gofast/tools/mathex.pyx":606
 *     ensure_non_negative(
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."             # <<<<<<<<<<<<<<
 *     )
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 */
  __Pyx_TraceLine(606,0,__PYX_ERR(0, 606, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 606, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_err_msg, __pyx_kp_u_y_true_and_y_pred_must_contain_n) < 0) __PYX_ERR(0, 606, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":604
 *     """
 *     _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     ensure_non_negative(             # <<<<<<<<<<<<<<
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."
 */
  __Pyx_TraceLine(604,0,__PYX_ERR(0, 604, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 604, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":608
 *         err_msg="y_true and y_pred must contain non-negative values."
 *     )
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )             # <<<<<<<<<<<<<<
 * 
 *     consensus = parameter_validator(
 */
  __Pyx_TraceLine(608,0,__PYX_ERR(0, 608, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_check_epsilon); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_3, __pyx_v_epsilon, __pyx_v_y_true, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":610
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 * 
 *     consensus = parameter_validator(             # <<<<<<<<<<<<<<
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 */
  __Pyx_TraceLine(610,0,__PYX_ERR(0, 610, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":611
 * 
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)             # <<<<<<<<<<<<<<
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)
 */
  __Pyx_TraceLine(611,0,__PYX_ERR(0, 611, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 611, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PySet_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 611, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PySet_Add(__pyx_t_4, __pyx_n_u_negative) < 0) __PYX_ERR(0, 611, __pyx_L1_error)
  if (PySet_Add(__pyx_t_4, __pyx_n_u_positive) < 0) __PYX_ERR(0, 611, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_target_strs, __pyx_t_4) < 0) __PYX_ERR(0, 611, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":610
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 * 
 *     consensus = parameter_validator(             # <<<<<<<<<<<<<<
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 */
  __Pyx_TraceLine(610,0,__PYX_ERR(0, 610, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__21, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":611
 * 
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)             # <<<<<<<<<<<<<<
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)
 */
  __Pyx_TraceLine(611,0,__PYX_ERR(0, 611, __pyx_L1_error))
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_consensus};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 611, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_consensus, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":612
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)
 * 
 */
  __Pyx_TraceLine(612,0,__PYX_ERR(0, 612, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":613
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)             # <<<<<<<<<<<<<<
 * 
 *     classes = np.unique(y_true)
 */
  __Pyx_TraceLine(613,0,__PYX_ERR(0, 613, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PySet_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PySet_Add(__pyx_t_2, __pyx_n_u_ovr) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
  if (PySet_Add(__pyx_t_2, __pyx_n_u_ovo) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_target_strs, __pyx_t_2) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":612
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)
 * 
 */
  __Pyx_TraceLine(612,0,__PYX_ERR(0, 612, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__7, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":613
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)             # <<<<<<<<<<<<<<
 * 
 *     classes = np.unique(y_true)
 */
  __Pyx_TraceLine(613,0,__PYX_ERR(0, 613, __pyx_L1_error))
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_strategy};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 613, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_strategy, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":615
 *         "strategy", target_strs={'ovr', 'ovo'})( strategy)
 * 
 *     classes = np.unique(y_true)             # <<<<<<<<<<<<<<
 *     sensitivities, specificities = [], []
 *     # validate multitarget and samples weigths if exists
 */
  __Pyx_TraceLine(615,0,__PYX_ERR(0, 615, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 615, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_unique); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 615, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_true};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 615, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_classes = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":616
 * 
 *     classes = np.unique(y_true)
 *     sensitivities, specificities = [], []             # <<<<<<<<<<<<<<
 *     # validate multitarget and samples weigths if exists
 *     y_true = validate_multiclass_target( y_true )
 */
  __Pyx_TraceLine(616,0,__PYX_ERR(0, 616, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 616, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 616, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_sensitivities = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_v_specificities = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":618
 *     sensitivities, specificities = [], []
 *     # validate multitarget and samples weigths if exists
 *     y_true = validate_multiclass_target( y_true )             # <<<<<<<<<<<<<<
 * 
 *     if sample_weight is not None:
 */
  __Pyx_TraceLine(618,0,__PYX_ERR(0, 618, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_validate_multiclass_target); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 618, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_true};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 618, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":620
 *     y_true = validate_multiclass_target( y_true )
 * 
 *     if sample_weight is not None:             # <<<<<<<<<<<<<<
 *         sample_weight =validate_sample_weights( sample_weight, y_true)
 * 
 */
  __Pyx_TraceLine(620,0,__PYX_ERR(0, 620, __pyx_L1_error))
  __pyx_t_6 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":621
 * 
 *     if sample_weight is not None:
 *         sample_weight =validate_sample_weights( sample_weight, y_true)             # <<<<<<<<<<<<<<
 * 
 *     if strategy == 'ovr':
 */
    __Pyx_TraceLine(621,0,__PYX_ERR(0, 621, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_validate_sample_weights); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 621, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_sample_weight, __pyx_v_y_true};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 621, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_sample_weight, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":620
 *     y_true = validate_multiclass_target( y_true )
 * 
 *     if sample_weight is not None:             # <<<<<<<<<<<<<<
 *         sample_weight =validate_sample_weights( sample_weight, y_true)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":623
 *         sample_weight =validate_sample_weights( sample_weight, y_true)
 * 
 *     if strategy == 'ovr':             # <<<<<<<<<<<<<<
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):
 */
  __Pyx_TraceLine(623,0,__PYX_ERR(0, 623, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovr, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 623, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":624
 * 
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)             # <<<<<<<<<<<<<<
 *         for i, cls in enumerate(classes):
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 */
    __Pyx_TraceLine(624,0,__PYX_ERR(0, 624, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_label_binarize); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_y_true)) __PYX_ERR(0, 624, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_classes, __pyx_v_classes) < 0) __PYX_ERR(0, 624, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 624, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_y_true_binarized = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":625
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):             # <<<<<<<<<<<<<<
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 */
    __Pyx_TraceLine(625,0,__PYX_ERR(0, 625, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_4 = __pyx_int_0;
    if (likely(PyList_CheckExact(__pyx_v_classes)) || PyTuple_CheckExact(__pyx_v_classes)) {
      __pyx_t_2 = __pyx_v_classes; __Pyx_INCREF(__pyx_t_2);
      __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_v_classes); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 625, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 625, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 625, __pyx_L1_error)
            #endif
            if (__pyx_t_7 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 625, __pyx_L1_error)
          #else
          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 625, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 625, __pyx_L1_error)
            #endif
            if (__pyx_t_7 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_7); __Pyx_INCREF(__pyx_t_1); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 625, __pyx_L1_error)
          #else
          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 625, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_8(__pyx_t_2);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 625, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_cls, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 625, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4);
      __pyx_t_4 = __pyx_t_1;
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":626
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(626,0,__PYX_ERR(0, 626, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_compute_sensitivity_specificity); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 626, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);

      /* "gofast/tools/mathex.pyx":627
 *         for i, cls in enumerate(classes):
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),             # <<<<<<<<<<<<<<
 *                 sample_weight=sample_weight,
 *                 epsilon=epsilon
 */
      __Pyx_TraceLine(627,0,__PYX_ERR(0, 627, __pyx_L1_error))
      __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 627, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_slice__9)) __PYX_ERR(0, 627, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_i);
      __Pyx_GIVEREF(__pyx_v_i);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_i)) __PYX_ERR(0, 627, __pyx_L1_error);
      __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_y_true_binarized, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 627, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_10 = PyObject_RichCompare(__pyx_v_y_pred, __pyx_v_cls, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 627, __pyx_L1_error)
      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 627, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_11))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_11);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_11, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, ((PyObject *)(&PyInt_Type))};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 627, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }

      /* "gofast/tools/mathex.pyx":626
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(626,0,__PYX_ERR(0, 626, __pyx_L1_error))
      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 626, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_GIVEREF(__pyx_t_9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_t_9)) __PYX_ERR(0, 626, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_3);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_t_3)) __PYX_ERR(0, 626, __pyx_L1_error);
      __pyx_t_9 = 0;
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":628
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 *                 sample_weight=sample_weight,             # <<<<<<<<<<<<<<
 *                 epsilon=epsilon
 *             )
 */
      __Pyx_TraceLine(628,0,__PYX_ERR(0, 628, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 628, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 628, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":629
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 *                 sample_weight=sample_weight,
 *                 epsilon=epsilon             # <<<<<<<<<<<<<<
 *             )
 *             sensitivities.append(sensitivity)
 */
      __Pyx_TraceLine(629,0,__PYX_ERR(0, 629, __pyx_L1_error))
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_epsilon, __pyx_v_epsilon) < 0) __PYX_ERR(0, 628, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":626
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(626,0,__PYX_ERR(0, 626, __pyx_L1_error))
      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_11, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 626, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_9))) || (PyList_CheckExact(__pyx_t_9))) {
        PyObject* sequence = __pyx_t_9;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 626, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_11);
        #else
        __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 626, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 626, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        #endif
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_1 = PyObject_GetIter(__pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 626, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
        index = 0; __pyx_t_3 = __pyx_t_12(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L7_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_3);
        index = 1; __pyx_t_11 = __pyx_t_12(__pyx_t_1); if (unlikely(!__pyx_t_11)) goto __pyx_L7_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_11);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_1), 2) < 0) __PYX_ERR(0, 626, __pyx_L1_error)
        __pyx_t_12 = NULL;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        goto __pyx_L8_unpacking_done;
        __pyx_L7_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_12 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 626, __pyx_L1_error)
        __pyx_L8_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_sensitivity, __pyx_t_3);
      __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_specificity, __pyx_t_11);
      __pyx_t_11 = 0;

      /* "gofast/tools/mathex.pyx":631
 *                 epsilon=epsilon
 *             )
 *             sensitivities.append(sensitivity)             # <<<<<<<<<<<<<<
 *             specificities.append(specificity)
 * 
 */
      __Pyx_TraceLine(631,0,__PYX_ERR(0, 631, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_sensitivities, __pyx_v_sensitivity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 631, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":632
 *             )
 *             sensitivities.append(sensitivity)
 *             specificities.append(specificity)             # <<<<<<<<<<<<<<
 * 
 *     elif strategy == 'ovo':
 */
      __Pyx_TraceLine(632,0,__PYX_ERR(0, 632, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_specificities, __pyx_v_specificity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 632, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":625
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):             # <<<<<<<<<<<<<<
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binarized[:, i], (y_pred == cls).astype(int),
 */
      __Pyx_TraceLine(625,0,__PYX_ERR(0, 625, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":623
 *         sample_weight =validate_sample_weights( sample_weight, y_true)
 * 
 *     if strategy == 'ovr':             # <<<<<<<<<<<<<<
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, cls in enumerate(classes):
 */
    goto __pyx_L4;
  }

  /* "gofast/tools/mathex.pyx":634
 *             specificities.append(specificity)
 * 
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 */
  __Pyx_TraceLine(634,0,__PYX_ERR(0, 634, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovo, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 634, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":635
 * 
 *     elif strategy == 'ovo':
 *         for cls1, cls2 in itertools.combinations(classes, 2):             # <<<<<<<<<<<<<<
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 */
    __Pyx_TraceLine(635,0,__PYX_ERR(0, 635, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_itertools); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_combinations); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 635, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_classes, __pyx_int_2};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 635, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
      __pyx_t_9 = __pyx_t_4; __Pyx_INCREF(__pyx_t_9);
      __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 635, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 635, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_9))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_9);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
            #endif
            if (__pyx_t_7 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
          #else
          __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_9, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 635, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_9);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
            #endif
            if (__pyx_t_7 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 635, __pyx_L1_error)
          #else
          __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_9, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 635, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_8(__pyx_t_9);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 635, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
        PyObject* sequence = __pyx_t_4;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 635, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_11);
        #else
        __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        #endif
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_3 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 635, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3);
        index = 0; __pyx_t_2 = __pyx_t_12(__pyx_t_3); if (unlikely(!__pyx_t_2)) goto __pyx_L12_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_2);
        index = 1; __pyx_t_11 = __pyx_t_12(__pyx_t_3); if (unlikely(!__pyx_t_11)) goto __pyx_L12_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_11);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_3), 2) < 0) __PYX_ERR(0, 635, __pyx_L1_error)
        __pyx_t_12 = NULL;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L13_unpacking_done;
        __pyx_L12_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_12 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 635, __pyx_L1_error)
        __pyx_L13_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_cls1, __pyx_t_2);
      __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_cls2, __pyx_t_11);
      __pyx_t_11 = 0;

      /* "gofast/tools/mathex.pyx":636
 *     elif strategy == 'ovo':
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)             # <<<<<<<<<<<<<<
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 */
      __Pyx_TraceLine(636,0,__PYX_ERR(0, 636, __pyx_L1_error))
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_cls1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 636, __pyx_L1_error)
      __pyx_t_11 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_cls2, Py_EQ); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 636, __pyx_L1_error)
      __pyx_t_2 = PyNumber_Or(__pyx_t_4, __pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 636, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_XDECREF_SET(__pyx_v_relevant_mask, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":637
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)             # <<<<<<<<<<<<<<
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 */
      __Pyx_TraceLine(637,0,__PYX_ERR(0, 637, __pyx_L1_error))
      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_v_relevant_mask); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 637, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_11, __pyx_v_cls1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 637, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 637, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_11))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_11);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_11, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyInt_Type))};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 637, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_y_true_binary, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":638
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)             # <<<<<<<<<<<<<<
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binary, y_pred_binary,
 */
      __Pyx_TraceLine(638,0,__PYX_ERR(0, 638, __pyx_L1_error))
      __pyx_t_11 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_v_relevant_mask); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 638, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_11, __pyx_v_cls1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 638, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 638, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_5 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_11))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_11);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_11, function);
          __pyx_t_5 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyInt_Type))};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 638, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_y_pred_binary, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":639
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(639,0,__PYX_ERR(0, 639, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_compute_sensitivity_specificity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);

      /* "gofast/tools/mathex.pyx":640
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binary, y_pred_binary,             # <<<<<<<<<<<<<<
 *                 sample_weight=sample_weight,
 *                 epsilon=epsilon
 */
      __Pyx_TraceLine(640,0,__PYX_ERR(0, 640, __pyx_L1_error))
      __pyx_t_11 = PyTuple_New(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 639, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_INCREF(__pyx_v_y_true_binary);
      __Pyx_GIVEREF(__pyx_v_y_true_binary);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_v_y_true_binary)) __PYX_ERR(0, 639, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_y_pred_binary);
      __Pyx_GIVEREF(__pyx_v_y_pred_binary);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 1, __pyx_v_y_pred_binary)) __PYX_ERR(0, 639, __pyx_L1_error);

      /* "gofast/tools/mathex.pyx":641
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,             # <<<<<<<<<<<<<<
 *                 epsilon=epsilon
 *                 )
 */
      __Pyx_TraceLine(641,0,__PYX_ERR(0, 641, __pyx_L1_error))
      __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 641, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 641, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":642
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,
 *                 epsilon=epsilon             # <<<<<<<<<<<<<<
 *                 )
 *             sensitivities.append(sensitivity)
 */
      __Pyx_TraceLine(642,0,__PYX_ERR(0, 642, __pyx_L1_error))
      if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_epsilon, __pyx_v_epsilon) < 0) __PYX_ERR(0, 641, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":639
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(639,0,__PYX_ERR(0, 639, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_11, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 639, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
        PyObject* sequence = __pyx_t_3;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 639, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_11);
        #else
        __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 639, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 639, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        #endif
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 639, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2);
        index = 0; __pyx_t_4 = __pyx_t_12(__pyx_t_2); if (unlikely(!__pyx_t_4)) goto __pyx_L14_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_4);
        index = 1; __pyx_t_11 = __pyx_t_12(__pyx_t_2); if (unlikely(!__pyx_t_11)) goto __pyx_L14_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_11);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_2), 2) < 0) __PYX_ERR(0, 639, __pyx_L1_error)
        __pyx_t_12 = NULL;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L15_unpacking_done;
        __pyx_L14_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_12 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 639, __pyx_L1_error)
        __pyx_L15_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_sensitivity, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_specificity, __pyx_t_11);
      __pyx_t_11 = 0;

      /* "gofast/tools/mathex.pyx":644
 *                 epsilon=epsilon
 *                 )
 *             sensitivities.append(sensitivity)             # <<<<<<<<<<<<<<
 *             specificities.append(specificity)
 * 
 */
      __Pyx_TraceLine(644,0,__PYX_ERR(0, 644, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_sensitivities, __pyx_v_sensitivity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 644, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":645
 *                 )
 *             sensitivities.append(sensitivity)
 *             specificities.append(specificity)             # <<<<<<<<<<<<<<
 * 
 *     # Weighted averages if sample_weight is provided
 */
      __Pyx_TraceLine(645,0,__PYX_ERR(0, 645, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_specificities, __pyx_v_specificity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 645, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":635
 * 
 *     elif strategy == 'ovo':
 *         for cls1, cls2 in itertools.combinations(classes, 2):             # <<<<<<<<<<<<<<
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 */
      __Pyx_TraceLine(635,0,__PYX_ERR(0, 635, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":634
 *             specificities.append(specificity)
 * 
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 */
  }
  __pyx_L4:;

  /* "gofast/tools/mathex.pyx":648
 * 
 *     # Weighted averages if sample_weight is provided
 *     if  multi_output=='uniform_average':             # <<<<<<<<<<<<<<
 *         avg_sensitivity = np.average(sensitivities)
 *         avg_specificity = np.average(specificities)
 */
  __Pyx_TraceLine(648,0,__PYX_ERR(0, 648, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_multi_output, __pyx_n_u_uniform_average, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 648, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":649
 *     # Weighted averages if sample_weight is provided
 *     if  multi_output=='uniform_average':
 *         avg_sensitivity = np.average(sensitivities)             # <<<<<<<<<<<<<<
 *         avg_specificity = np.average(specificities)
 *     else:
 */
    __Pyx_TraceLine(649,0,__PYX_ERR(0, 649, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 649, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_average); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 649, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_sensitivities};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 649, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_v_avg_sensitivity = __pyx_t_9;
    __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":650
 *     if  multi_output=='uniform_average':
 *         avg_sensitivity = np.average(sensitivities)
 *         avg_specificity = np.average(specificities)             # <<<<<<<<<<<<<<
 *     else:
 *         avg_sensitivity = np.asarray(sensitivities)
 */
    __Pyx_TraceLine(650,0,__PYX_ERR(0, 650, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 650, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_average); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 650, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_v_specificities};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 650, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_avg_specificity = __pyx_t_9;
    __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":648
 * 
 *     # Weighted averages if sample_weight is provided
 *     if  multi_output=='uniform_average':             # <<<<<<<<<<<<<<
 *         avg_sensitivity = np.average(sensitivities)
 *         avg_specificity = np.average(specificities)
 */
    goto __pyx_L17;
  }

  /* "gofast/tools/mathex.pyx":652
 *         avg_specificity = np.average(specificities)
 *     else:
 *         avg_sensitivity = np.asarray(sensitivities)             # <<<<<<<<<<<<<<
 *         avg_specificity = np.asarray(specificities)
 * 
 */
  __Pyx_TraceLine(652,0,__PYX_ERR(0, 652, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 652, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 652, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_sensitivities};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 652, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_v_avg_sensitivity = __pyx_t_9;
    __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":653
 *     else:
 *         avg_sensitivity = np.asarray(sensitivities)
 *         avg_specificity = np.asarray(specificities)             # <<<<<<<<<<<<<<
 * 
 *     # Compute LR based on average values
 */
    __Pyx_TraceLine(653,0,__PYX_ERR(0, 653, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 653, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 653, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_v_specificities};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 653, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_avg_specificity = __pyx_t_9;
    __pyx_t_9 = 0;
  }
  __pyx_L17:;

  /* "gofast/tools/mathex.pyx":656
 * 
 *     # Compute LR based on average values
 *     lr = calculate_adjusted_lr(             # <<<<<<<<<<<<<<
 *         avg_sensitivity, avg_specificity,
 *         consensus = consensus,max_lr = 100.
 */
  __Pyx_TraceLine(656,0,__PYX_ERR(0, 656, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_calculate_adjusted_lr); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);

  /* "gofast/tools/mathex.pyx":657
 *     # Compute LR based on average values
 *     lr = calculate_adjusted_lr(
 *         avg_sensitivity, avg_specificity,             # <<<<<<<<<<<<<<
 *         consensus = consensus,max_lr = 100.
 *         )
 */
  __Pyx_TraceLine(657,0,__PYX_ERR(0, 657, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_avg_sensitivity);
  __Pyx_GIVEREF(__pyx_v_avg_sensitivity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_avg_sensitivity)) __PYX_ERR(0, 656, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_avg_specificity);
  __Pyx_GIVEREF(__pyx_v_avg_specificity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_avg_specificity)) __PYX_ERR(0, 656, __pyx_L1_error);

  /* "gofast/tools/mathex.pyx":658
 *     lr = calculate_adjusted_lr(
 *         avg_sensitivity, avg_specificity,
 *         consensus = consensus,max_lr = 100.             # <<<<<<<<<<<<<<
 *         )
 *     return lr, avg_sensitivity, avg_specificity
 */
  __Pyx_TraceLine(658,0,__PYX_ERR(0, 658, __pyx_L1_error))
  __pyx_t_11 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 658, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_consensus, __pyx_v_consensus) < 0) __PYX_ERR(0, 658, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_11, __pyx_n_s_max_lr, __pyx_float_100_) < 0) __PYX_ERR(0, 658, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":656
 * 
 *     # Compute LR based on average values
 *     lr = calculate_adjusted_lr(             # <<<<<<<<<<<<<<
 *         avg_sensitivity, avg_specificity,
 *         consensus = consensus,max_lr = 100.
 */
  __Pyx_TraceLine(656,0,__PYX_ERR(0, 656, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_3, __pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_v_lr = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":660
 *         consensus = consensus,max_lr = 100.
 *         )
 *     return lr, avg_sensitivity, avg_specificity             # <<<<<<<<<<<<<<
 * 
 * def calculate_multiclass_lr(
 */
  __Pyx_TraceLine(660,0,__PYX_ERR(0, 660, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 660, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_lr);
  __Pyx_GIVEREF(__pyx_v_lr);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_lr)) __PYX_ERR(0, 660, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_avg_sensitivity);
  __Pyx_GIVEREF(__pyx_v_avg_sensitivity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_avg_sensitivity)) __PYX_ERR(0, 660, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_avg_specificity);
  __Pyx_GIVEREF(__pyx_v_avg_specificity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_avg_specificity)) __PYX_ERR(0, 660, __pyx_L1_error);
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":547
 *     return optimal_threshold, optimal_youden
 * 
 * def calculate_multiclass_avg_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     strategy='ovr',
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_multiclass_avg_lr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_classes);
  __Pyx_XDECREF(__pyx_v_sensitivities);
  __Pyx_XDECREF(__pyx_v_specificities);
  __Pyx_XDECREF(__pyx_v_y_true_binarized);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_cls);
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XDECREF(__pyx_v_cls1);
  __Pyx_XDECREF(__pyx_v_cls2);
  __Pyx_XDECREF(__pyx_v_relevant_mask);
  __Pyx_XDECREF(__pyx_v_y_true_binary);
  __Pyx_XDECREF(__pyx_v_y_pred_binary);
  __Pyx_XDECREF(__pyx_v_avg_sensitivity);
  __Pyx_XDECREF(__pyx_v_avg_specificity);
  __Pyx_XDECREF(__pyx_v_lr);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_strategy);
  __Pyx_XDECREF(__pyx_v_consensus);
  __Pyx_XDECREF(__pyx_v_sample_weight);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":662
 *     return lr, avg_sensitivity, avg_specificity
 * 
 * def calculate_multiclass_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     consensus='positive',
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_17calculate_multiclass_lr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_16calculate_multiclass_lr, "\n    Calculate the multiclass likelihood ratio for classification using either \n    one-versus-rest (OvR) or one-versus-one (OvO) strategies. Optionally applies \n    logarithmic scaling to the likelihood ratios and can return sensitivity and \n    specificity values.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True class labels as integers.\n    y_pred : array-like\n        Predicted class labels as integers.\n    consensus : str, optional\n        Specifies the type of likelihood ratio to compute: 'positive' \n        (default) or 'negative'.\n    strategy : str, optional\n        Specifies the computation strategy: 'ovr' (one-versus-rest, default) \n        or 'ovo' (one-versus-one).\n    epsilon : float, optional\n        A small value to prevent division by zero in calculations. \n        Default is 1e-10. \n    multi_output : str, optional\n        If 'uniform_average', returns the average of the computed likelihood \n        ratios. If 'raw_values', returns the likelihood ratios for each class \n        comparison.\n    apply_log_scale : bool, optional\n        If True, applies the natural logarithm to the likelihood ratios, \n        returning the log-likelihood ratios.\n    include_metrics : bool, optional\n        If True, returns a tuple containing the likelihood ratios and arrays \n        of sensitivities and specificities.\n\n    Returns\n    -------\n    float or tuple\n        Depending on 'multi_output' and 'include_metrics', returns either the \n        average likelihood ratio, an array of likelihood ratios, or a tuple \n        containing the likelihood ratios and metrics arrays.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_multiclass_lr\n    >>> y_true = [0, 1, 2, 2, 1, 0]\n    >>> y_pred = [0, 2, 1, 2, 1, 0]\n    >>> calculate_multiclass_lr(y_true, y_pred, consensus='positive', strategy='ovr')\n    1.6765\n    \n    >>> from gofast.tools.mathex import calculate_multiclass_lr\n    >>>"" y_true = [0, 1, 2, 2, 1, 0]\n    >>> y_pred = [0, 2, 1, 2, 1, 0]\n    >>> calculate_multiclass_lr(y_true, y_pred, consensus='positive', strategy='ovr')\n    1.6765\n    \n    >>> calculate_multiclass_lr(y_true, y_pred, consensus='negative', strategy='ovo')\n    0.9890\n    \n    Notes\n    -----\n    The likelihood ratio (LR) for a given class or class pair is calculated as:\n    \n    .. math::\n        LR_+ = \\frac{\\text{sensitivity}}{1 - \\text{specificity}}\n    \n    or\n    \n    .. math::\n        LR_- = \\frac{1 - \\text{sensitivity}}{\\text{specificity}}\n    \n    If `apply_log_scale` is True, the log-likelihood ratio (LLR) is computed, \n    which transforms the LR using the natural logarithm:\n    \n    .. math::\n        LLR = \\log(LR)\n    \n    This transformation helps manage extreme values and improves the interpretability\n    of the results, especially when dealing with very high or very low likelihood ratios.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_17calculate_multiclass_lr = {"calculate_multiclass_lr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_17calculate_multiclass_lr, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_16calculate_multiclass_lr};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_17calculate_multiclass_lr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_consensus = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_strategy = 0;
  PyObject *__pyx_v_epsilon = 0;
  PyObject *__pyx_v_multi_output = 0;
  PyObject *__pyx_v_apply_log_scale = 0;
  PyObject *__pyx_v_include_metrics = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_multiclass_lr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_consensus,&__pyx_n_s_sample_weight,&__pyx_n_s_strategy,&__pyx_n_s_epsilon,&__pyx_n_s_multi_output,&__pyx_n_s_apply_log_scale,&__pyx_n_s_include_metrics,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_positive)));

    /* "gofast/tools/mathex.pyx":665
 *     y_true, y_pred, *,
 *     consensus='positive',
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     strategy='ovr',
 *     epsilon=1e-10,
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_ovr)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_10)));
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_uniform_average)));

    /* "gofast/tools/mathex.pyx":669
 *     epsilon=1e-10,
 *     multi_output='uniform_average',
 *     apply_log_scale=False,             # <<<<<<<<<<<<<<
 *     include_metrics=False
 *     ):
 */
    values[7] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":670
 *     multi_output='uniform_average',
 *     apply_log_scale=False,
 *     include_metrics=False             # <<<<<<<<<<<<<<
 *     ):
 *     """
 */
    values[8] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 662, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 662, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("calculate_multiclass_lr", 1, 2, 2, 1); __PYX_ERR(0, 662, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && likely(kw_args <= 7)) {
        Py_ssize_t index;
        for (index = 2; index < 9 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 662, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_multiclass_lr") < 0)) __PYX_ERR(0, 662, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_consensus = values[2];
    __pyx_v_sample_weight = values[3];
    __pyx_v_strategy = values[4];
    __pyx_v_epsilon = values[5];
    __pyx_v_multi_output = values[6];
    __pyx_v_apply_log_scale = values[7];
    __pyx_v_include_metrics = values[8];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_multiclass_lr", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 662, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_multiclass_lr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_16calculate_multiclass_lr(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_consensus, __pyx_v_sample_weight, __pyx_v_strategy, __pyx_v_epsilon, __pyx_v_multi_output, __pyx_v_apply_log_scale, __pyx_v_include_metrics);

  /* "gofast/tools/mathex.pyx":662
 *     return lr, avg_sensitivity, avg_specificity
 * 
 * def calculate_multiclass_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     consensus='positive',
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_16calculate_multiclass_lr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_consensus, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_strategy, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_multi_output, PyObject *__pyx_v_apply_log_scale, PyObject *__pyx_v_include_metrics) {
  PyObject *__pyx_v_classes = NULL;
  PyObject *__pyx_v_results = NULL;
  PyObject *__pyx_v_sensitivities = NULL;
  PyObject *__pyx_v_specificities = NULL;
  PyObject *__pyx_v_y_true_binarized = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_label = NULL;
  PyObject *__pyx_v_sensitivity = NULL;
  PyObject *__pyx_v_specificity = NULL;
  PyObject *__pyx_v_lr = NULL;
  PyObject *__pyx_v_cls1 = NULL;
  PyObject *__pyx_v_cls2 = NULL;
  PyObject *__pyx_v_relevant_mask = NULL;
  PyObject *__pyx_v_y_true_binary = NULL;
  PyObject *__pyx_v_y_pred_binary = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  int __pyx_t_7;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__22)
  __Pyx_RefNannySetupContext("calculate_multiclass_lr", 0);
  __Pyx_TraceCall("calculate_multiclass_lr", __pyx_f[0], 662, 0, __PYX_ERR(0, 662, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_consensus);
  __Pyx_INCREF(__pyx_v_strategy);
  __Pyx_INCREF(__pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":749
 *     of the results, especially when dealing with very high or very low likelihood ratios.
 *     """
 *     y_true, y_pred = _ensure_y_is_valid(y_true, y_pred, y_numeric=True)             # <<<<<<<<<<<<<<
 *     ensure_non_negative(
 *         y_true, y_pred,
 */
  __Pyx_TraceLine(749,0,__PYX_ERR(0, 749, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 749, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 749, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 749, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 749, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 749, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 749, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 749, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 749, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 749, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 749, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":750
 *     """
 *     y_true, y_pred = _ensure_y_is_valid(y_true, y_pred, y_numeric=True)
 *     ensure_non_negative(             # <<<<<<<<<<<<<<
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."
 */
  __Pyx_TraceLine(750,0,__PYX_ERR(0, 750, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_ensure_non_negative); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":751
 *     y_true, y_pred = _ensure_y_is_valid(y_true, y_pred, y_numeric=True)
 *     ensure_non_negative(
 *         y_true, y_pred,             # <<<<<<<<<<<<<<
 *         err_msg="y_true and y_pred must contain non-negative values."
 *     )
 */
  __Pyx_TraceLine(751,0,__PYX_ERR(0, 751, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 750, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 750, __pyx_L1_error);

  /* "gofast/tools/mathex.pyx":752
 *     ensure_non_negative(
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."             # <<<<<<<<<<<<<<
 *     )
 *     epsilon = check_epsilon(epsilon, y_true, y_pred)
 */
  __Pyx_TraceLine(752,0,__PYX_ERR(0, 752, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_err_msg, __pyx_kp_u_y_true_and_y_pred_must_contain_n) < 0) __PYX_ERR(0, 752, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":750
 *     """
 *     y_true, y_pred = _ensure_y_is_valid(y_true, y_pred, y_numeric=True)
 *     ensure_non_negative(             # <<<<<<<<<<<<<<
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."
 */
  __Pyx_TraceLine(750,0,__PYX_ERR(0, 750, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 750, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":754
 *         err_msg="y_true and y_pred must contain non-negative values."
 *     )
 *     epsilon = check_epsilon(epsilon, y_true, y_pred)             # <<<<<<<<<<<<<<
 * 
 *     consensus = parameter_validator(
 */
  __Pyx_TraceLine(754,0,__PYX_ERR(0, 754, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_check_epsilon); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 754, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_2, __pyx_v_epsilon, __pyx_v_y_true, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 3+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 754, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":756
 *     epsilon = check_epsilon(epsilon, y_true, y_pred)
 * 
 *     consensus = parameter_validator(             # <<<<<<<<<<<<<<
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 */
  __Pyx_TraceLine(756,0,__PYX_ERR(0, 756, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 756, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);

  /* "gofast/tools/mathex.pyx":757
 * 
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)             # <<<<<<<<<<<<<<
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 */
  __Pyx_TraceLine(757,0,__PYX_ERR(0, 757, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PySet_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PySet_Add(__pyx_t_4, __pyx_n_u_negative) < 0) __PYX_ERR(0, 757, __pyx_L1_error)
  if (PySet_Add(__pyx_t_4, __pyx_n_u_positive) < 0) __PYX_ERR(0, 757, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_target_strs, __pyx_t_4) < 0) __PYX_ERR(0, 757, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":756
 *     epsilon = check_epsilon(epsilon, y_true, y_pred)
 * 
 *     consensus = parameter_validator(             # <<<<<<<<<<<<<<
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 */
  __Pyx_TraceLine(756,0,__PYX_ERR(0, 756, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__21, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 756, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":757
 * 
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)             # <<<<<<<<<<<<<<
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 */
  __Pyx_TraceLine(757,0,__PYX_ERR(0, 757, __pyx_L1_error))
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_consensus};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 757, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_consensus, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":758
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 * 
 */
  __Pyx_TraceLine(758,0,__PYX_ERR(0, 758, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":759
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)             # <<<<<<<<<<<<<<
 * 
 *     classes = np.unique(y_true)
 */
  __Pyx_TraceLine(759,0,__PYX_ERR(0, 759, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 759, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PySet_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 759, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PySet_Add(__pyx_t_3, __pyx_n_u_ovr) < 0) __PYX_ERR(0, 759, __pyx_L1_error)
  if (PySet_Add(__pyx_t_3, __pyx_n_u_ovo) < 0) __PYX_ERR(0, 759, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_target_strs, __pyx_t_3) < 0) __PYX_ERR(0, 759, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":758
 *     consensus = parameter_validator(
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 * 
 */
  __Pyx_TraceLine(758,0,__PYX_ERR(0, 758, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_tuple__7, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":759
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)             # <<<<<<<<<<<<<<
 * 
 *     classes = np.unique(y_true)
 */
  __Pyx_TraceLine(759,0,__PYX_ERR(0, 759, __pyx_L1_error))
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_strategy};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 759, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_strategy, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":761
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 * 
 *     classes = np.unique(y_true)             # <<<<<<<<<<<<<<
 *     results = []
 *     sensitivities = []
 */
  __Pyx_TraceLine(761,0,__PYX_ERR(0, 761, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_unique); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 761, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_classes = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":762
 * 
 *     classes = np.unique(y_true)
 *     results = []             # <<<<<<<<<<<<<<
 *     sensitivities = []
 *     specificities = []
 */
  __Pyx_TraceLine(762,0,__PYX_ERR(0, 762, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_results = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":763
 *     classes = np.unique(y_true)
 *     results = []
 *     sensitivities = []             # <<<<<<<<<<<<<<
 *     specificities = []
 *     y_true = validate_multiclass_target( y_true )
 */
  __Pyx_TraceLine(763,0,__PYX_ERR(0, 763, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 763, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_sensitivities = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":764
 *     results = []
 *     sensitivities = []
 *     specificities = []             # <<<<<<<<<<<<<<
 *     y_true = validate_multiclass_target( y_true )
 *     if strategy == 'ovr':
 */
  __Pyx_TraceLine(764,0,__PYX_ERR(0, 764, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 764, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_specificities = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":765
 *     sensitivities = []
 *     specificities = []
 *     y_true = validate_multiclass_target( y_true )             # <<<<<<<<<<<<<<
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 */
  __Pyx_TraceLine(765,0,__PYX_ERR(0, 765, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_validate_multiclass_target); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 765, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 765, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":766
 *     specificities = []
 *     y_true = validate_multiclass_target( y_true )
 *     if strategy == 'ovr':             # <<<<<<<<<<<<<<
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, label in enumerate(classes):
 */
  __Pyx_TraceLine(766,0,__PYX_ERR(0, 766, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovr, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 766, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":767
 *     y_true = validate_multiclass_target( y_true )
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)             # <<<<<<<<<<<<<<
 *         for i, label in enumerate(classes):
 *             # Isolate the class against all others
 */
    __Pyx_TraceLine(767,0,__PYX_ERR(0, 767, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_label_binarize); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 767, __pyx_L1_error);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_classes, __pyx_v_classes) < 0) __PYX_ERR(0, 767, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_y_true_binarized = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":768
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, label in enumerate(classes):             # <<<<<<<<<<<<<<
 *             # Isolate the class against all others
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 */
    __Pyx_TraceLine(768,0,__PYX_ERR(0, 768, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_4 = __pyx_int_0;
    if (likely(PyList_CheckExact(__pyx_v_classes)) || PyTuple_CheckExact(__pyx_v_classes)) {
      __pyx_t_3 = __pyx_v_classes; __Pyx_INCREF(__pyx_t_3);
      __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_classes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 768, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 768, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_3))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 768, __pyx_L1_error)
            #endif
            if (__pyx_t_8 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 768, __pyx_L1_error)
          #else
          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 768, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 768, __pyx_L1_error)
            #endif
            if (__pyx_t_8 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 768, __pyx_L1_error)
          #else
          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 768, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_9(__pyx_t_3);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 768, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      __Pyx_XDECREF_SET(__pyx_v_label, __pyx_t_2);
      __pyx_t_2 = 0;
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
      __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 768, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4);
      __pyx_t_4 = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":770
 *         for i, label in enumerate(classes):
 *             # Isolate the class against all others
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binarized[:, i], (y_pred == label).astype(int),
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(770,0,__PYX_ERR(0, 770, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_compute_sensitivity_specificity); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 770, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);

      /* "gofast/tools/mathex.pyx":771
 *             # Isolate the class against all others
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binarized[:, i], (y_pred == label).astype(int),             # <<<<<<<<<<<<<<
 *                 sample_weight=sample_weight,
 *                 epsilon=epsilon
 */
      __Pyx_TraceLine(771,0,__PYX_ERR(0, 771, __pyx_L1_error))
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 771, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_slice__9)) __PYX_ERR(0, 771, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_i);
      __Pyx_GIVEREF(__pyx_v_i);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_i)) __PYX_ERR(0, 771, __pyx_L1_error);
      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_v_y_true_binarized, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 771, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_11 = PyObject_RichCompare(__pyx_v_y_pred, __pyx_v_label, Py_EQ); __Pyx_XGOTREF(__pyx_t_11); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 771, __pyx_L1_error)
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_astype); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 771, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_11, ((PyObject *)(&PyInt_Type))};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_12, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 771, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }

      /* "gofast/tools/mathex.pyx":770
 *         for i, label in enumerate(classes):
 *             # Isolate the class against all others
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binarized[:, i], (y_pred == label).astype(int),
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(770,0,__PYX_ERR(0, 770, __pyx_L1_error))
      __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 770, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_10);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_10)) __PYX_ERR(0, 770, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_1);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_1)) __PYX_ERR(0, 770, __pyx_L1_error);
      __pyx_t_10 = 0;
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":772
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binarized[:, i], (y_pred == label).astype(int),
 *                 sample_weight=sample_weight,             # <<<<<<<<<<<<<<
 *                 epsilon=epsilon
 *             )
 */
      __Pyx_TraceLine(772,0,__PYX_ERR(0, 772, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 772, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 772, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":773
 *                 y_true_binarized[:, i], (y_pred == label).astype(int),
 *                 sample_weight=sample_weight,
 *                 epsilon=epsilon             # <<<<<<<<<<<<<<
 *             )
 *             lr = calculate_adjusted_lr (
 */
      __Pyx_TraceLine(773,0,__PYX_ERR(0, 773, __pyx_L1_error))
      if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_epsilon, __pyx_v_epsilon) < 0) __PYX_ERR(0, 772, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":770
 *         for i, label in enumerate(classes):
 *             # Isolate the class against all others
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binarized[:, i], (y_pred == label).astype(int),
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(770,0,__PYX_ERR(0, 770, __pyx_L1_error))
      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_12, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 770, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
        PyObject* sequence = __pyx_t_10;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 770, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_12 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_12 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_12);
        #else
        __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 770, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_12 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 770, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        #endif
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_2 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 770, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2);
        index = 0; __pyx_t_1 = __pyx_t_5(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L8_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_1);
        index = 1; __pyx_t_12 = __pyx_t_5(__pyx_t_2); if (unlikely(!__pyx_t_12)) goto __pyx_L8_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_12);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_2), 2) < 0) __PYX_ERR(0, 770, __pyx_L1_error)
        __pyx_t_5 = NULL;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        goto __pyx_L9_unpacking_done;
        __pyx_L8_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_5 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 770, __pyx_L1_error)
        __pyx_L9_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_sensitivity, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_specificity, __pyx_t_12);
      __pyx_t_12 = 0;

      /* "gofast/tools/mathex.pyx":775
 *                 epsilon=epsilon
 *             )
 *             lr = calculate_adjusted_lr (             # <<<<<<<<<<<<<<
 *                 sensitivity, specificity,
 *                 consensus = consensus,
 */
      __Pyx_TraceLine(775,0,__PYX_ERR(0, 775, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_calculate_adjusted_lr); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 775, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);

      /* "gofast/tools/mathex.pyx":776
 *             )
 *             lr = calculate_adjusted_lr (
 *                 sensitivity, specificity,             # <<<<<<<<<<<<<<
 *                 consensus = consensus,
 *                 max_lr=1e1
 */
      __Pyx_TraceLine(776,0,__PYX_ERR(0, 776, __pyx_L1_error))
      __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 775, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_INCREF(__pyx_v_sensitivity);
      __Pyx_GIVEREF(__pyx_v_sensitivity);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_v_sensitivity)) __PYX_ERR(0, 775, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_specificity);
      __Pyx_GIVEREF(__pyx_v_specificity);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_v_specificity)) __PYX_ERR(0, 775, __pyx_L1_error);

      /* "gofast/tools/mathex.pyx":777
 *             lr = calculate_adjusted_lr (
 *                 sensitivity, specificity,
 *                 consensus = consensus,             # <<<<<<<<<<<<<<
 *                 max_lr=1e1
 *             )
 */
      __Pyx_TraceLine(777,0,__PYX_ERR(0, 777, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 777, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_consensus, __pyx_v_consensus) < 0) __PYX_ERR(0, 777, __pyx_L1_error)
      if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_max_lr, __pyx_float_1e1) < 0) __PYX_ERR(0, 777, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":775
 *                 epsilon=epsilon
 *             )
 *             lr = calculate_adjusted_lr (             # <<<<<<<<<<<<<<
 *                 sensitivity, specificity,
 *                 consensus = consensus,
 */
      __Pyx_TraceLine(775,0,__PYX_ERR(0, 775, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_12, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 775, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_lr, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":780
 *                 max_lr=1e1
 *             )
 *             results.append(np.log(lr) if apply_log_scale else lr)             # <<<<<<<<<<<<<<
 *             sensitivities.append(sensitivity)
 *             specificities.append(specificity)
 */
      __Pyx_TraceLine(780,0,__PYX_ERR(0, 780, __pyx_L1_error))
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_apply_log_scale); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 780, __pyx_L1_error)
      if (__pyx_t_7) {
        __Pyx_GetModuleGlobalName(__pyx_t_12, __pyx_n_s_np); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 780, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_log); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 780, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_12 = NULL;
        __pyx_t_6 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_12)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_12);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
            __pyx_t_6 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_v_lr};
          __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
          __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
          if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 780, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __pyx_t_2 = __pyx_t_1;
        __pyx_t_1 = 0;
      } else {
        __Pyx_INCREF(__pyx_v_lr);
        __pyx_t_2 = __pyx_v_lr;
      }
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_results, __pyx_t_2); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 780, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":781
 *             )
 *             results.append(np.log(lr) if apply_log_scale else lr)
 *             sensitivities.append(sensitivity)             # <<<<<<<<<<<<<<
 *             specificities.append(specificity)
 * 
 */
      __Pyx_TraceLine(781,0,__PYX_ERR(0, 781, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_sensitivities, __pyx_v_sensitivity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 781, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":782
 *             results.append(np.log(lr) if apply_log_scale else lr)
 *             sensitivities.append(sensitivity)
 *             specificities.append(specificity)             # <<<<<<<<<<<<<<
 * 
 *     elif strategy == 'ovo':
 */
      __Pyx_TraceLine(782,0,__PYX_ERR(0, 782, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_specificities, __pyx_v_specificity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 782, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":768
 *     if strategy == 'ovr':
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, label in enumerate(classes):             # <<<<<<<<<<<<<<
 *             # Isolate the class against all others
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 */
      __Pyx_TraceLine(768,0,__PYX_ERR(0, 768, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":766
 *     specificities = []
 *     y_true = validate_multiclass_target( y_true )
 *     if strategy == 'ovr':             # <<<<<<<<<<<<<<
 *         y_true_binarized = label_binarize(y_true, classes=classes)
 *         for i, label in enumerate(classes):
 */
    goto __pyx_L5;
  }

  /* "gofast/tools/mathex.pyx":784
 *             specificities.append(specificity)
 * 
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 */
  __Pyx_TraceLine(784,0,__PYX_ERR(0, 784, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovo, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 784, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":785
 * 
 *     elif strategy == 'ovo':
 *         for cls1, cls2 in itertools.combinations(classes, 2):             # <<<<<<<<<<<<<<
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 */
    __Pyx_TraceLine(785,0,__PYX_ERR(0, 785, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_itertools); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_combinations); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 785, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_classes, __pyx_int_2};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
      __pyx_t_2 = __pyx_t_4; __Pyx_INCREF(__pyx_t_2);
      __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
    } else {
      __pyx_t_8 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 785, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (likely(!__pyx_t_9)) {
        if (likely(PyList_CheckExact(__pyx_t_2))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
            #endif
            if (__pyx_t_8 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
          #else
          __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 785, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_2);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
            #endif
            if (__pyx_t_8 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 785, __pyx_L1_error)
          #else
          __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 785, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_9(__pyx_t_2);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 785, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
        PyObject* sequence = __pyx_t_4;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 785, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        #else
        __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 785, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 785, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_10 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 785, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_10);
        index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_10); if (unlikely(!__pyx_t_3)) goto __pyx_L13_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_3);
        index = 1; __pyx_t_1 = __pyx_t_5(__pyx_t_10); if (unlikely(!__pyx_t_1)) goto __pyx_L13_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_1);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_10), 2) < 0) __PYX_ERR(0, 785, __pyx_L1_error)
        __pyx_t_5 = NULL;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        goto __pyx_L14_unpacking_done;
        __pyx_L13_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_5 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 785, __pyx_L1_error)
        __pyx_L14_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_cls1, __pyx_t_3);
      __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_cls2, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":786
 *     elif strategy == 'ovo':
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)             # <<<<<<<<<<<<<<
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 */
      __Pyx_TraceLine(786,0,__PYX_ERR(0, 786, __pyx_L1_error))
      __pyx_t_4 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_cls1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 786, __pyx_L1_error)
      __pyx_t_1 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_cls2, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 786, __pyx_L1_error)
      __pyx_t_3 = PyNumber_Or(__pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 786, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF_SET(__pyx_v_relevant_mask, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":787
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)             # <<<<<<<<<<<<<<
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 */
      __Pyx_TraceLine(787,0,__PYX_ERR(0, 787, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_v_relevant_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 787, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_cls1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 787, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 787, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyInt_Type))};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 787, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_y_true_binary, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":788
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)             # <<<<<<<<<<<<<<
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binary, y_pred_binary,
 */
      __Pyx_TraceLine(788,0,__PYX_ERR(0, 788, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_v_relevant_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyObject_RichCompare(__pyx_t_1, __pyx_v_cls1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 788, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_astype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 788, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, ((PyObject *)(&PyInt_Type))};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 788, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_y_pred_binary, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":789
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(789,0,__PYX_ERR(0, 789, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_sensitivity_specificity); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 789, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);

      /* "gofast/tools/mathex.pyx":790
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binary, y_pred_binary,             # <<<<<<<<<<<<<<
 *                 sample_weight=sample_weight,
 *                 epsilon= epsilon,
 */
      __Pyx_TraceLine(790,0,__PYX_ERR(0, 790, __pyx_L1_error))
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 789, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_y_true_binary);
      __Pyx_GIVEREF(__pyx_v_y_true_binary);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_y_true_binary)) __PYX_ERR(0, 789, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_y_pred_binary);
      __Pyx_GIVEREF(__pyx_v_y_pred_binary);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_y_pred_binary)) __PYX_ERR(0, 789, __pyx_L1_error);

      /* "gofast/tools/mathex.pyx":791
 *             sensitivity, specificity = _compute_sensitivity_specificity(
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,             # <<<<<<<<<<<<<<
 *                 epsilon= epsilon,
 *                 )
 */
      __Pyx_TraceLine(791,0,__PYX_ERR(0, 791, __pyx_L1_error))
      __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 791, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 791, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":792
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,
 *                 epsilon= epsilon,             # <<<<<<<<<<<<<<
 *                 )
 *             lr = calculate_adjusted_lr (
 */
      __Pyx_TraceLine(792,0,__PYX_ERR(0, 792, __pyx_L1_error))
      if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_epsilon, __pyx_v_epsilon) < 0) __PYX_ERR(0, 791, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":789
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 *             y_pred_binary = (y_pred[relevant_mask] == cls1).astype(int)
 *             sensitivity, specificity = _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *                 y_true_binary, y_pred_binary,
 *                 sample_weight=sample_weight,
 */
      __Pyx_TraceLine(789,0,__PYX_ERR(0, 789, __pyx_L1_error))
      __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 789, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if ((likely(PyTuple_CheckExact(__pyx_t_10))) || (PyList_CheckExact(__pyx_t_10))) {
        PyObject* sequence = __pyx_t_10;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 789, __pyx_L1_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_1);
        #else
        __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 789, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 789, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_3 = PyObject_GetIter(__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 789, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3);
        index = 0; __pyx_t_4 = __pyx_t_5(__pyx_t_3); if (unlikely(!__pyx_t_4)) goto __pyx_L15_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_4);
        index = 1; __pyx_t_1 = __pyx_t_5(__pyx_t_3); if (unlikely(!__pyx_t_1)) goto __pyx_L15_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_1);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_3), 2) < 0) __PYX_ERR(0, 789, __pyx_L1_error)
        __pyx_t_5 = NULL;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        goto __pyx_L16_unpacking_done;
        __pyx_L15_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_5 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 789, __pyx_L1_error)
        __pyx_L16_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_v_sensitivity, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_specificity, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":794
 *                 epsilon= epsilon,
 *                 )
 *             lr = calculate_adjusted_lr (             # <<<<<<<<<<<<<<
 *                 sensitivity, specificity,
 *                 consensus = consensus, max_lr=1e1 )
 */
      __Pyx_TraceLine(794,0,__PYX_ERR(0, 794, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_calculate_adjusted_lr); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 794, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);

      /* "gofast/tools/mathex.pyx":795
 *                 )
 *             lr = calculate_adjusted_lr (
 *                 sensitivity, specificity,             # <<<<<<<<<<<<<<
 *                 consensus = consensus, max_lr=1e1 )
 *             results.append(np.log(lr) if apply_log_scale else lr)
 */
      __Pyx_TraceLine(795,0,__PYX_ERR(0, 795, __pyx_L1_error))
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 794, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_sensitivity);
      __Pyx_GIVEREF(__pyx_v_sensitivity);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sensitivity)) __PYX_ERR(0, 794, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_specificity);
      __Pyx_GIVEREF(__pyx_v_specificity);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_specificity)) __PYX_ERR(0, 794, __pyx_L1_error);

      /* "gofast/tools/mathex.pyx":796
 *             lr = calculate_adjusted_lr (
 *                 sensitivity, specificity,
 *                 consensus = consensus, max_lr=1e1 )             # <<<<<<<<<<<<<<
 *             results.append(np.log(lr) if apply_log_scale else lr)
 *             sensitivities.append(sensitivity)
 */
      __Pyx_TraceLine(796,0,__PYX_ERR(0, 796, __pyx_L1_error))
      __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 796, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_consensus, __pyx_v_consensus) < 0) __PYX_ERR(0, 796, __pyx_L1_error)
      if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_max_lr, __pyx_float_1e1) < 0) __PYX_ERR(0, 796, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":794
 *                 epsilon= epsilon,
 *                 )
 *             lr = calculate_adjusted_lr (             # <<<<<<<<<<<<<<
 *                 sensitivity, specificity,
 *                 consensus = consensus, max_lr=1e1 )
 */
      __Pyx_TraceLine(794,0,__PYX_ERR(0, 794, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 794, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_lr, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":797
 *                 sensitivity, specificity,
 *                 consensus = consensus, max_lr=1e1 )
 *             results.append(np.log(lr) if apply_log_scale else lr)             # <<<<<<<<<<<<<<
 *             sensitivities.append(sensitivity)
 *             specificities.append(specificity)
 */
      __Pyx_TraceLine(797,0,__PYX_ERR(0, 797, __pyx_L1_error))
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_apply_log_scale); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 797, __pyx_L1_error)
      if (__pyx_t_7) {
        __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 797, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_log); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 797, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = NULL;
        __pyx_t_6 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
            __pyx_t_6 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_lr};
          __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 797, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __pyx_t_3 = __pyx_t_4;
        __pyx_t_4 = 0;
      } else {
        __Pyx_INCREF(__pyx_v_lr);
        __pyx_t_3 = __pyx_v_lr;
      }
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_results, __pyx_t_3); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 797, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":798
 *                 consensus = consensus, max_lr=1e1 )
 *             results.append(np.log(lr) if apply_log_scale else lr)
 *             sensitivities.append(sensitivity)             # <<<<<<<<<<<<<<
 *             specificities.append(specificity)
 * 
 */
      __Pyx_TraceLine(798,0,__PYX_ERR(0, 798, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_sensitivities, __pyx_v_sensitivity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 798, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":799
 *             results.append(np.log(lr) if apply_log_scale else lr)
 *             sensitivities.append(sensitivity)
 *             specificities.append(specificity)             # <<<<<<<<<<<<<<
 * 
 *     if multi_output == 'uniform_average':
 */
      __Pyx_TraceLine(799,0,__PYX_ERR(0, 799, __pyx_L1_error))
      __pyx_t_13 = __Pyx_PyList_Append(__pyx_v_specificities, __pyx_v_specificity); if (unlikely(__pyx_t_13 == ((int)-1))) __PYX_ERR(0, 799, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":785
 * 
 *     elif strategy == 'ovo':
 *         for cls1, cls2 in itertools.combinations(classes, 2):             # <<<<<<<<<<<<<<
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 *             y_true_binary = (y_true[relevant_mask] == cls1).astype(int)
 */
      __Pyx_TraceLine(785,0,__PYX_ERR(0, 785, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":784
 *             specificities.append(specificity)
 * 
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         for cls1, cls2 in itertools.combinations(classes, 2):
 *             relevant_mask = (y_true == cls1) | (y_true == cls2)
 */
  }
  __pyx_L5:;

  /* "gofast/tools/mathex.pyx":801
 *             specificities.append(specificity)
 * 
 *     if multi_output == 'uniform_average':             # <<<<<<<<<<<<<<
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),
 */
  __Pyx_TraceLine(801,0,__PYX_ERR(0, 801, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_multi_output, __pyx_n_u_uniform_average, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 801, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":803
 *     if multi_output == 'uniform_average':
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),             # <<<<<<<<<<<<<<
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)
 *     else:
 */
    __Pyx_TraceLine(803,0,__PYX_ERR(0, 803, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);

    /* "gofast/tools/mathex.pyx":804
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)             # <<<<<<<<<<<<<<
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),
 */
    __Pyx_TraceLine(804,0,__PYX_ERR(0, 804, __pyx_L1_error))
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_include_metrics); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 804, __pyx_L1_error)
    if (__pyx_t_7) {

      /* "gofast/tools/mathex.pyx":803
 *     if multi_output == 'uniform_average':
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),             # <<<<<<<<<<<<<<
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)
 *     else:
 */
      __Pyx_TraceLine(803,0,__PYX_ERR(0, 803, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 803, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_mean); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 803, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_results};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 803, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 803, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 803, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_sensitivities};
        __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 803, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }

      /* "gofast/tools/mathex.pyx":804
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)             # <<<<<<<<<<<<<<
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),
 */
      __Pyx_TraceLine(804,0,__PYX_ERR(0, 804, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 804, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 804, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_specificities};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_12, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 804, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }

      /* "gofast/tools/mathex.pyx":803
 *     if multi_output == 'uniform_average':
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),             # <<<<<<<<<<<<<<
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)
 *     else:
 */
      __Pyx_TraceLine(803,0,__PYX_ERR(0, 803, __pyx_L1_error))
      __pyx_t_12 = PyTuple_New(3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 803, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_GIVEREF(__pyx_t_3);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_t_3)) __PYX_ERR(0, 803, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_10);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_t_10)) __PYX_ERR(0, 803, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_1);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 2, __pyx_t_1)) __PYX_ERR(0, 803, __pyx_L1_error);
      __pyx_t_3 = 0;
      __pyx_t_10 = 0;
      __pyx_t_1 = 0;
      __pyx_t_2 = __pyx_t_12;
      __pyx_t_12 = 0;
    } else {

      /* "gofast/tools/mathex.pyx":804
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)             # <<<<<<<<<<<<<<
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),
 */
      __Pyx_TraceLine(804,0,__PYX_ERR(0, 804, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 804, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_mean); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 804, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_results};
        __pyx_t_12 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 804, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __pyx_t_2 = __pyx_t_12;
      __pyx_t_12 = 0;
    }
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":801
 *             specificities.append(specificity)
 * 
 *     if multi_output == 'uniform_average':             # <<<<<<<<<<<<<<
 *         # Return raw values for each class comparison
 *         return (np.mean(results), np.asarray(sensitivities),
 */
  }

  /* "gofast/tools/mathex.pyx":806
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),             # <<<<<<<<<<<<<<
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 */
  __Pyx_TraceLine(806,0,__PYX_ERR(0, 806, __pyx_L1_error))
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);

    /* "gofast/tools/mathex.pyx":807
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),
 *                 np.asarray(specificities)) if include_metrics else np.array(results)             # <<<<<<<<<<<<<<
 * 
 * def calculate_adjusted_lr(
 */
    __Pyx_TraceLine(807,0,__PYX_ERR(0, 807, __pyx_L1_error))
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_include_metrics); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 807, __pyx_L1_error)
    if (__pyx_t_7) {

      /* "gofast/tools/mathex.pyx":806
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),             # <<<<<<<<<<<<<<
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 */
      __Pyx_TraceLine(806,0,__PYX_ERR(0, 806, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 806, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_array_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 806, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_results};
        __pyx_t_12 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 806, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 806, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_sensitivities};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }

      /* "gofast/tools/mathex.pyx":807
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),
 *                 np.asarray(specificities)) if include_metrics else np.array(results)             # <<<<<<<<<<<<<<
 * 
 * def calculate_adjusted_lr(
 */
      __Pyx_TraceLine(807,0,__PYX_ERR(0, 807, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 807, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 807, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_specificities};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 807, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }

      /* "gofast/tools/mathex.pyx":806
 *                 np.asarray(specificities)) if include_metrics else np.mean(results)
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),             # <<<<<<<<<<<<<<
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 */
      __Pyx_TraceLine(806,0,__PYX_ERR(0, 806, __pyx_L1_error))
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 806, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_12);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_12)) __PYX_ERR(0, 806, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_1);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1)) __PYX_ERR(0, 806, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_3);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_t_3)) __PYX_ERR(0, 806, __pyx_L1_error);
      __pyx_t_12 = 0;
      __pyx_t_1 = 0;
      __pyx_t_3 = 0;
      __pyx_t_2 = __pyx_t_4;
      __pyx_t_4 = 0;
    } else {

      /* "gofast/tools/mathex.pyx":807
 *     else:
 *         return (np.array(results), np.asarray(sensitivities),
 *                 np.asarray(specificities)) if include_metrics else np.array(results)             # <<<<<<<<<<<<<<
 * 
 * def calculate_adjusted_lr(
 */
      __Pyx_TraceLine(807,0,__PYX_ERR(0, 807, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 807, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 807, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_results};
        __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 807, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __pyx_t_2 = __pyx_t_4;
      __pyx_t_4 = 0;
    }
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
  }

  /* "gofast/tools/mathex.pyx":662
 *     return lr, avg_sensitivity, avg_specificity
 * 
 * def calculate_multiclass_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     consensus='positive',
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_multiclass_lr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_classes);
  __Pyx_XDECREF(__pyx_v_results);
  __Pyx_XDECREF(__pyx_v_sensitivities);
  __Pyx_XDECREF(__pyx_v_specificities);
  __Pyx_XDECREF(__pyx_v_y_true_binarized);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_label);
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XDECREF(__pyx_v_lr);
  __Pyx_XDECREF(__pyx_v_cls1);
  __Pyx_XDECREF(__pyx_v_cls2);
  __Pyx_XDECREF(__pyx_v_relevant_mask);
  __Pyx_XDECREF(__pyx_v_y_true_binary);
  __Pyx_XDECREF(__pyx_v_y_pred_binary);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_consensus);
  __Pyx_XDECREF(__pyx_v_strategy);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":809
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 * def calculate_adjusted_lr(             # <<<<<<<<<<<<<<
 *     sensitivity,
 *     specificity,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_19calculate_adjusted_lr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_18calculate_adjusted_lr, "\n    Calculate the likelihood ratio with modifications to avoid extremely high \n    values, particularly when specificity is close to 1.\n\n    Parameters\n    ----------\n    sensitivity : float or numpy.ndarray\n        The probability of correctly identifying a true positive, expressed as a \n        scalar for single measurement or an array for multiple measurements. Each\n        value represents the sensitivity for a given test or condition.\n    \n    specificity : float or numpy.ndarray\n        The probability of correctly identifying a true negative, similarly\n        expressed as either a scalar for a single measurement or an array for\n        multiple measurements. Each value corresponds to the specificity of \n        a test or condition and must match the dimensions of `sensitivity` if\n        provided as an array.\n\n    consensus : str, optional\n        Specifies the type of likelihood ratio to compute:\n        - 'positive': Computes the positive likelihood ratio (LR+), which\n          is sensitivity divided by (1 - specificity). This ratio indicates\n          how much the odds of the disease increase when a test is positive.\n        - 'negative': Computes the negative likelihood ratio (LR-), which\n          is (1 - sensitivity) divided by specificity. This ratio indicates\n          how much the odds of the disease decrease when a test is negative.\n          Default is 'positive'.\n    \n    max_lr : float, optional\n        The maximum allowed value for the likelihood ratio to prevent\n        extreme values that could be misleading or difficult to interpret.\n        Default is 100, which means likelihood ratios are capped at this value \n        to avoid disproportionately high results that could result from very\n        small denominators.\n\n    buffer : float, optional\n        A small value added to the denominator in the likelihood ratio\n        calculation to prevent division by near-zero, which can lead to\n        extremely ""high values. This buffer ensures stability in the calculations\n        by avoiding infinite or very large ratios. Default is 1e-2.\n\n    Returns\n    -------\n    float or numpy.ndarray\n        The adjusted likelihood ratio, either as a single value or an array of\n        values, depending on the input format. Each ratio is capped at `max_lr`\n        and adjusted for low denominators using `buffer`.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_adjusted_lr\n    >>> calculate_adjusted_lr(0.95, 0.89)\n    8.636363636363637\n\n    >>> calculate_adjusted_lr(np.array([0.95, 0.80]), np.array([0.89, 0.90]), \n                              consensus='negative', max_lr=10)\n    array([1.04545455, 2.        ])\n  \n    >>> calculate_adjusted_lr(0.99, 0.999, consensus='positive')\n    99.0\n    >>> calculate_adjusted_lr(0.80, 0.95, consensus='negative', max_lr=100,\n    ... buffer=0.005)\n    0.21052631578947364\n\n    Notes\n    -----\n    The likelihood ratio (LR) is calculated based on the specified `consensus`:\n    \n    For a 'positive' likelihood ratio:\n        \n    .. math::\n        LR_+ = \\frac{\\text{sensitivity}}{\\max(1 - \\text{specificity}, \n        \\text{buffer})}\n\n    For a 'negative' likelihood ratio:\n        \n    .. math::\n        LR_- = \\frac{1 - \\text{sensitivity}}{\\max(\\text{specificity}, \n        \\text{buffer})}\n\n    This approach helps to manage situations where specificity is very close to 1,\n    which would normally result in a very high LR due to a small denominator.\n    The `max_lr` parameter caps the LR to a maximum value, preventing extremely\n    high ratios that might be misleading or difficult to interpret in practical\n    scenarios.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_19calculate_adjusted_lr = {"calculate_adjusted_lr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_19calculate_adjusted_lr, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_18calculate_adjusted_lr};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_19calculate_adjusted_lr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_sensitivity = 0;
  PyObject *__pyx_v_specificity = 0;
  PyObject *__pyx_v_consensus = 0;
  PyObject *__pyx_v_max_lr = 0;
  PyObject *__pyx_v_buffer = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_adjusted_lr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_sensitivity,&__pyx_n_s_specificity,&__pyx_n_s_consensus,&__pyx_n_s_max_lr,&__pyx_n_s_buffer,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_positive)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_100)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_2)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sensitivity)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 809, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_specificity)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 809, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("calculate_adjusted_lr", 0, 2, 5, 1); __PYX_ERR(0, 809, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_consensus);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 809, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_max_lr);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 809, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_buffer);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 809, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_adjusted_lr") < 0)) __PYX_ERR(0, 809, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_sensitivity = values[0];
    __pyx_v_specificity = values[1];
    __pyx_v_consensus = values[2];
    __pyx_v_max_lr = values[3];
    __pyx_v_buffer = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_adjusted_lr", 0, 2, 5, __pyx_nargs); __PYX_ERR(0, 809, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_adjusted_lr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_18calculate_adjusted_lr(__pyx_self, __pyx_v_sensitivity, __pyx_v_specificity, __pyx_v_consensus, __pyx_v_max_lr, __pyx_v_buffer);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_18calculate_adjusted_lr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_sensitivity, PyObject *__pyx_v_specificity, PyObject *__pyx_v_consensus, PyObject *__pyx_v_max_lr, PyObject *__pyx_v_buffer) {
  PyObject *__pyx_v_lr = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__23)
  __Pyx_RefNannySetupContext("calculate_adjusted_lr", 0);
  __Pyx_TraceCall("calculate_adjusted_lr", __pyx_f[0], 809, 0, __PYX_ERR(0, 809, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_sensitivity);
  __Pyx_INCREF(__pyx_v_specificity);

  /* "gofast/tools/mathex.pyx":904
 *     # Ensure input compatibility if sensitivity and specificity are
 *     # provided as lists or tuples
 *     sensitivity = np.array(sensitivity)             # <<<<<<<<<<<<<<
 *     specificity = np.array(specificity)
 * 
 */
  __Pyx_TraceLine(904,0,__PYX_ERR(0, 904, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 904, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 904, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_sensitivity};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 904, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_sensitivity, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":905
 *     # provided as lists or tuples
 *     sensitivity = np.array(sensitivity)
 *     specificity = np.array(specificity)             # <<<<<<<<<<<<<<
 * 
 *     # Compute the likelihood ratio based on the given consensus
 */
  __Pyx_TraceLine(905,0,__PYX_ERR(0, 905, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 905, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 905, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_specificity};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 905, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_specificity, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":908
 * 
 *     # Compute the likelihood ratio based on the given consensus
 *     if consensus == "positive":             # <<<<<<<<<<<<<<
 *         lr = sensitivity / np.maximum(1 - specificity, buffer)
 *     elif consensus == "negative":
 */
  __Pyx_TraceLine(908,0,__PYX_ERR(0, 908, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_consensus, __pyx_n_u_positive, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 908, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":909
 *     # Compute the likelihood ratio based on the given consensus
 *     if consensus == "positive":
 *         lr = sensitivity / np.maximum(1 - specificity, buffer)             # <<<<<<<<<<<<<<
 *     elif consensus == "negative":
 *         lr = (1 - sensitivity) / np.maximum(specificity, buffer)
 */
    __Pyx_TraceLine(909,0,__PYX_ERR(0, 909, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 909, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_maximum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 909, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_specificity, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 909, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_6, __pyx_t_2, __pyx_v_buffer};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 909, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_v_sensitivity, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 909, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_lr = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":908
 * 
 *     # Compute the likelihood ratio based on the given consensus
 *     if consensus == "positive":             # <<<<<<<<<<<<<<
 *         lr = sensitivity / np.maximum(1 - specificity, buffer)
 *     elif consensus == "negative":
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":910
 *     if consensus == "positive":
 *         lr = sensitivity / np.maximum(1 - specificity, buffer)
 *     elif consensus == "negative":             # <<<<<<<<<<<<<<
 *         lr = (1 - sensitivity) / np.maximum(specificity, buffer)
 *     else:
 */
  __Pyx_TraceLine(910,0,__PYX_ERR(0, 910, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_consensus, __pyx_n_u_negative, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 910, __pyx_L1_error)
  if (likely(__pyx_t_5)) {

    /* "gofast/tools/mathex.pyx":911
 *         lr = sensitivity / np.maximum(1 - specificity, buffer)
 *     elif consensus == "negative":
 *         lr = (1 - sensitivity) / np.maximum(specificity, buffer)             # <<<<<<<<<<<<<<
 *     else:
 *         raise ValueError("Consensus must be either 'positive' or 'negative'")
 */
    __Pyx_TraceLine(911,0,__PYX_ERR(0, 911, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_sensitivity, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 911, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 911, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_maximum); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 911, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_specificity, __pyx_v_buffer};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 911, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_6 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 911, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_lr = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":910
 *     if consensus == "positive":
 *         lr = sensitivity / np.maximum(1 - specificity, buffer)
 *     elif consensus == "negative":             # <<<<<<<<<<<<<<
 *         lr = (1 - sensitivity) / np.maximum(specificity, buffer)
 *     else:
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":913
 *         lr = (1 - sensitivity) / np.maximum(specificity, buffer)
 *     else:
 *         raise ValueError("Consensus must be either 'positive' or 'negative'")             # <<<<<<<<<<<<<<
 * 
 *     # Cap the likelihood ratios at the maximum allowed value
 */
  __Pyx_TraceLine(913,0,__PYX_ERR(0, 913, __pyx_L1_error))
  /*else*/ {
    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 913, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_Raise(__pyx_t_6, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __PYX_ERR(0, 913, __pyx_L1_error)
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":916
 * 
 *     # Cap the likelihood ratios at the maximum allowed value
 *     lr = np.minimum(lr, max_lr)             # <<<<<<<<<<<<<<
 * 
 *     return lr
 */
  __Pyx_TraceLine(916,0,__PYX_ERR(0, 916, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 916, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_minimum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 916, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_1, __pyx_v_lr, __pyx_v_max_lr};
    __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 916, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_lr, __pyx_t_6);
  __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":918
 *     lr = np.minimum(lr, max_lr)
 * 
 *     return lr             # <<<<<<<<<<<<<<
 * 
 * def _compute_sensitivity_specificity(
 */
  __Pyx_TraceLine(918,0,__PYX_ERR(0, 918, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_lr);
  __pyx_r = __pyx_v_lr;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":809
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 * def calculate_adjusted_lr(             # <<<<<<<<<<<<<<
 *     sensitivity,
 *     specificity,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_adjusted_lr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_lr);
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":920
 *     return lr
 * 
 * def _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight=None, epsilon=1e-10):
 *     """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_21_compute_sensitivity_specificity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_20_compute_sensitivity_specificity, "\n    Calculate sensitivity and specificity for binary classification results,\n    optionally using sample weights to adjust the importance of each sample.\n\n    Parameters\n    ----------\n    y_true : array-like\n        Binary ground truth labels (1 for positive class, 0 for negative class).\n    y_pred : array-like\n        Binary predicted labels (1 for positive class, 0 for negative class).\n    sample_weight : array-like, optional\n        Weights applied to each sample when calculating sensitivity and specificity.\n        If None, all samples are assumed to have equal weight. Sample weights are\n        typically used in datasets where some samples are more important than\n        others or in the presence of class imbalance.\n    epsilon : float, optional\n        Small value added to denominators to avoid division by zero. \n        Default is 1e-10.\n\n    Returns\n    -------\n    tuple\n        A tuple containing the sensitivity and specificity values.\n\n    Notes\n    -----\n    Sensitivity and specificity are calculated using the following formulas:\n    \n    .. math::\n        \text{sensitivity} = \014rac{\\sum (w_i \\cdot [y_{true}^i = 1 \\cap y_{pred}^i = 1])}\n        {\\sum (w_i \\cdot [y_{true}^i = 1]) + \\epsilon}\n\n    .. math::\n        \text{specificity} = \014rac{\\sum (w_i \\cdot [y_{true}^i = 0 \\cap y_{pred}^i = 0])}\n        {\\sum (w_i \\cdot [y_{true}^i = 0]) + \\epsilon}\n\n    Where \\( w_i \\) are the sample weights. If `sample_weight` is None,\n    all weights are considered equal to 1.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_binary_metrics\n    >>> y_true = [1, 0, 1, 1, 0, 1, 0, 0]\n    >>> y_pred = [1, 0, 0, 1, 0, 1, 1, 0]\n    >>> sensitivity, specificity = calculate_binary_metrics(y_true, y_pred)\n    >>> print(f\"Sensitivity: {sensitivity:.2f}, Specificity: {specificity:.2f}\")\n    Sensitivity: 0.75, Specificity: 0.75\n\n    >>> weights = [1, 1, 2, 2, 1, 2, 1, 1]\n    >>> sensit""ivity, specificity = calculate_binary_metrics(y_true, y_pred, sample_weight=weights)\n    >>> print(f\"Sensitivity: {sensitivity:.2f}, Specificity: {specificity:.2f}\")\n    Sensitivity: 0.80, Specificity: 0.83\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_21_compute_sensitivity_specificity = {"_compute_sensitivity_specificity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_21_compute_sensitivity_specificity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_20_compute_sensitivity_specificity};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_21_compute_sensitivity_specificity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_epsilon = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_compute_sensitivity_specificity (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_sample_weight,&__pyx_n_s_epsilon,0};

    /* "gofast/tools/mathex.pyx":921
 * 
 * def _compute_sensitivity_specificity(
 *         y_true, y_pred, sample_weight=None, epsilon=1e-10):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate sensitivity and specificity for binary classification results,
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_10)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 920, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 920, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_sensitivity_specificity", 0, 2, 4, 1); __PYX_ERR(0, 920, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 920, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_epsilon);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 920, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_compute_sensitivity_specificity") < 0)) __PYX_ERR(0, 920, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_sample_weight = values[2];
    __pyx_v_epsilon = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_compute_sensitivity_specificity", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 920, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._compute_sensitivity_specificity", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_20_compute_sensitivity_specificity(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_sample_weight, __pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":920
 *     return lr
 * 
 * def _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight=None, epsilon=1e-10):
 *     """
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_20_compute_sensitivity_specificity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_epsilon) {
  PyObject *__pyx_v_true_positives = NULL;
  PyObject *__pyx_v_false_positives = NULL;
  PyObject *__pyx_v_false_negatives = NULL;
  PyObject *__pyx_v_true_negatives = NULL;
  PyObject *__pyx_v_sensitivity = NULL;
  PyObject *__pyx_v_specificity = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__25)
  __Pyx_RefNannySetupContext("_compute_sensitivity_specificity", 0);
  __Pyx_TraceCall("_compute_sensitivity_specificity", __pyx_f[0], 920, 0, __PYX_ERR(0, 920, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_sample_weight);
  __Pyx_INCREF(__pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":975
 *     Sensitivity: 0.80, Specificity: 0.83
 *     """
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)             # <<<<<<<<<<<<<<
 *     ensure_non_negative(
 *         y_true, y_pred,
 */
  __Pyx_TraceLine(975,0,__PYX_ERR(0, 975, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 975, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 975, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 975, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 975, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 975, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 975, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 975, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 975, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 975, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 975, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 975, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 975, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 975, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":976
 *     """
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     ensure_non_negative(             # <<<<<<<<<<<<<<
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."
 */
  __Pyx_TraceLine(976,0,__PYX_ERR(0, 976, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_ensure_non_negative); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 976, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":977
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     ensure_non_negative(
 *         y_true, y_pred,             # <<<<<<<<<<<<<<
 *         err_msg="y_true and y_pred must contain non-negative values."
 *     )
 */
  __Pyx_TraceLine(977,0,__PYX_ERR(0, 977, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 976, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 976, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 976, __pyx_L1_error);

  /* "gofast/tools/mathex.pyx":978
 *     ensure_non_negative(
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."             # <<<<<<<<<<<<<<
 *     )
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 */
  __Pyx_TraceLine(978,0,__PYX_ERR(0, 978, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 978, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_err_msg, __pyx_kp_u_y_true_and_y_pred_must_contain_n) < 0) __PYX_ERR(0, 978, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":976
 *     """
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     ensure_non_negative(             # <<<<<<<<<<<<<<
 *         y_true, y_pred,
 *         err_msg="y_true and y_pred must contain non-negative values."
 */
  __Pyx_TraceLine(976,0,__PYX_ERR(0, 976, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 976, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":980
 *         err_msg="y_true and y_pred must contain non-negative values."
 *     )
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )             # <<<<<<<<<<<<<<
 * 
 *     if sample_weight is not None:
 */
  __Pyx_TraceLine(980,0,__PYX_ERR(0, 980, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_check_epsilon); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 980, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_2, __pyx_v_epsilon, __pyx_v_y_true, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 3+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":982
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 * 
 *     if sample_weight is not None:             # <<<<<<<<<<<<<<
 *         sample_weight = validate_sample_weights(sample_weight, y_true)
 * 
 */
  __Pyx_TraceLine(982,0,__PYX_ERR(0, 982, __pyx_L1_error))
  __pyx_t_7 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":983
 * 
 *     if sample_weight is not None:
 *         sample_weight = validate_sample_weights(sample_weight, y_true)             # <<<<<<<<<<<<<<
 * 
 *     # Calculate true positives, false positives, false negatives, and true negatives
 */
    __Pyx_TraceLine(983,0,__PYX_ERR(0, 983, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_validate_sample_weights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 983, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_sample_weight, __pyx_v_y_true};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 983, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_sample_weight, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":982
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 * 
 *     if sample_weight is not None:             # <<<<<<<<<<<<<<
 *         sample_weight = validate_sample_weights(sample_weight, y_true)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":986
 * 
 *     # Calculate true positives, false positives, false negatives, and true negatives
 *     true_positives = np.sum(((y_true == 1) & (y_pred == 1)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (
 */
  __Pyx_TraceLine(986,0,__PYX_ERR(0, 986, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_y_true, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_v_y_pred, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = PyNumber_And(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":987
 *     # Calculate true positives, false positives, false negatives, and true negatives
 *     true_positives = np.sum(((y_true == 1) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))             # <<<<<<<<<<<<<<
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))
 */
  __Pyx_TraceLine(987,0,__PYX_ERR(0, 987, __pyx_L1_error))
  __pyx_t_7 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_7) {
    __Pyx_INCREF(__pyx_v_sample_weight);
    __pyx_t_4 = __pyx_v_sample_weight;
  } else {
    __Pyx_INCREF(__pyx_int_1);
    __pyx_t_4 = __pyx_int_1;
  }

  /* "gofast/tools/mathex.pyx":986
 * 
 *     # Calculate true positives, false positives, false negatives, and true negatives
 *     true_positives = np.sum(((y_true == 1) & (y_pred == 1)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (
 */
  __Pyx_TraceLine(986,0,__PYX_ERR(0, 986, __pyx_L1_error))
  __pyx_t_3 = PyNumber_Multiply(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 986, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_true_positives = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":988
 *     true_positives = np.sum(((y_true == 1) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (
 */
  __Pyx_TraceLine(988,0,__PYX_ERR(0, 988, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_v_y_true, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_v_y_pred, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = PyNumber_And(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":989
 *         sample_weight if sample_weight is not None else 1))
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))             # <<<<<<<<<<<<<<
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (
 *         sample_weight if sample_weight is not None else 1))
 */
  __Pyx_TraceLine(989,0,__PYX_ERR(0, 989, __pyx_L1_error))
  __pyx_t_7 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_7) {
    __Pyx_INCREF(__pyx_v_sample_weight);
    __pyx_t_4 = __pyx_v_sample_weight;
  } else {
    __Pyx_INCREF(__pyx_int_1);
    __pyx_t_4 = __pyx_int_1;
  }

  /* "gofast/tools/mathex.pyx":988
 *     true_positives = np.sum(((y_true == 1) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (
 */
  __Pyx_TraceLine(988,0,__PYX_ERR(0, 988, __pyx_L1_error))
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 988, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_false_positives = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":990
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 *     true_negatives = np.sum(((y_true == 0) & (y_pred == 0)) * (
 */
  __Pyx_TraceLine(990,0,__PYX_ERR(0, 990, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyInt_EqObjC(__pyx_v_y_true, __pyx_int_1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_v_y_pred, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = PyNumber_And(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":991
 *         sample_weight if sample_weight is not None else 1))
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (
 *         sample_weight if sample_weight is not None else 1))             # <<<<<<<<<<<<<<
 *     true_negatives = np.sum(((y_true == 0) & (y_pred == 0)) * (
 *         sample_weight if sample_weight is not None else 1))
 */
  __Pyx_TraceLine(991,0,__PYX_ERR(0, 991, __pyx_L1_error))
  __pyx_t_7 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_7) {
    __Pyx_INCREF(__pyx_v_sample_weight);
    __pyx_t_4 = __pyx_v_sample_weight;
  } else {
    __Pyx_INCREF(__pyx_int_1);
    __pyx_t_4 = __pyx_int_1;
  }

  /* "gofast/tools/mathex.pyx":990
 *     false_positives = np.sum(((y_true == 0) & (y_pred == 1)) * (
 *         sample_weight if sample_weight is not None else 1))
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 *     true_negatives = np.sum(((y_true == 0) & (y_pred == 0)) * (
 */
  __Pyx_TraceLine(990,0,__PYX_ERR(0, 990, __pyx_L1_error))
  __pyx_t_3 = PyNumber_Multiply(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 990, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_false_negatives = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":992
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (
 *         sample_weight if sample_weight is not None else 1))
 *     true_negatives = np.sum(((y_true == 0) & (y_pred == 0)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 * 
 */
  __Pyx_TraceLine(992,0,__PYX_ERR(0, 992, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 992, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 992, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_EqObjC(__pyx_v_y_true, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 992, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyInt_EqObjC(__pyx_v_y_pred, __pyx_int_0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 992, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = PyNumber_And(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 992, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":993
 *         sample_weight if sample_weight is not None else 1))
 *     true_negatives = np.sum(((y_true == 0) & (y_pred == 0)) * (
 *         sample_weight if sample_weight is not None else 1))             # <<<<<<<<<<<<<<
 * 
 *     # Calculate sensitivity and specificity with weighted counts
 */
  __Pyx_TraceLine(993,0,__PYX_ERR(0, 993, __pyx_L1_error))
  __pyx_t_7 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_7) {
    __Pyx_INCREF(__pyx_v_sample_weight);
    __pyx_t_4 = __pyx_v_sample_weight;
  } else {
    __Pyx_INCREF(__pyx_int_1);
    __pyx_t_4 = __pyx_int_1;
  }

  /* "gofast/tools/mathex.pyx":992
 *     false_negatives = np.sum(((y_true == 1) & (y_pred == 0)) * (
 *         sample_weight if sample_weight is not None else 1))
 *     true_negatives = np.sum(((y_true == 0) & (y_pred == 0)) * (             # <<<<<<<<<<<<<<
 *         sample_weight if sample_weight is not None else 1))
 * 
 */
  __Pyx_TraceLine(992,0,__PYX_ERR(0, 992, __pyx_L1_error))
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_8, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 992, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_true_negatives = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":996
 * 
 *     # Calculate sensitivity and specificity with weighted counts
 *     sensitivity = true_positives / (true_positives + false_negatives + epsilon)             # <<<<<<<<<<<<<<
 *     specificity = true_negatives / (true_negatives + false_positives + epsilon)
 * 
 */
  __Pyx_TraceLine(996,0,__PYX_ERR(0, 996, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Add(__pyx_v_true_positives, __pyx_v_false_negatives); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 996, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_epsilon); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 996, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_true_positives, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 996, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_sensitivity = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":997
 *     # Calculate sensitivity and specificity with weighted counts
 *     sensitivity = true_positives / (true_positives + false_negatives + epsilon)
 *     specificity = true_negatives / (true_negatives + false_positives + epsilon)             # <<<<<<<<<<<<<<
 * 
 *     return sensitivity, specificity
 */
  __Pyx_TraceLine(997,0,__PYX_ERR(0, 997, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Add(__pyx_v_true_negatives, __pyx_v_false_positives); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_epsilon); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_true_negatives, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_specificity = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":999
 *     specificity = true_negatives / (true_negatives + false_positives + epsilon)
 * 
 *     return sensitivity, specificity             # <<<<<<<<<<<<<<
 * 
 * def compute_sensitivity_specificity(
 */
  __Pyx_TraceLine(999,0,__PYX_ERR(0, 999, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 999, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_sensitivity);
  __Pyx_GIVEREF(__pyx_v_sensitivity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sensitivity)) __PYX_ERR(0, 999, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_specificity);
  __Pyx_GIVEREF(__pyx_v_specificity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_specificity)) __PYX_ERR(0, 999, __pyx_L1_error);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":920
 *     return lr
 * 
 * def _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight=None, epsilon=1e-10):
 *     """
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex._compute_sensitivity_specificity", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_true_positives);
  __Pyx_XDECREF(__pyx_v_false_positives);
  __Pyx_XDECREF(__pyx_v_false_negatives);
  __Pyx_XDECREF(__pyx_v_true_negatives);
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_sample_weight);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1001
 *     return sensitivity, specificity
 * 
 * def compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight=None,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_23compute_sensitivity_specificity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_22compute_sensitivity_specificity, "\n    Calculate sensitivity and specificity for binary or multiclass classification\n    results, with support for different strategies and averaging methods. \n\n    Parameters\n    ----------\n    y_true : array-like of shape (n_samples,)\n        True class labels. Each element in this array should be an integer\n        representing the actual class of the corresponding sample.\n    y_pred : array-like of shape (n_samples,)\n        Predicted class labels. Each element should correspond to the predicted\n        class label for the sample.\n    sample_weight : array-like of shape (n_samples,), optional\n        Weights applied to each sample when calculating metrics. If not provided,\n        all samples are assumed to have equal weight. Useful in cases of class\n        imbalance or when some samples are more critical than others.\n    strategy : {'ovr', 'ovo'}, default 'ovr'\n        The strategy to calculate metrics:\n        - 'ovr' (One-vs-Rest): Metrics are calculated by treating each class as\n          the positive class against all other classes combined.\n        - 'ovo' (One-vs-One): Metrics are calculated for each pair of classes.\n          This can be more computationally intensive.\n    average : {'macro', 'micro', 'weighted'}, default 'macro'\n        Specifies the method to average sensitivity and specificity:\n        - 'macro': Calculate metrics for each label, and find their unweighted mean.\n        - 'micro': Calculate metrics globally across all classes.\n        - 'weighted': Calculate metrics for each label, and find their average,\n          weighted by the number of true instances for each label.\n    epsilon : float or \"auto\", optional\n        A small constant added to the denominator to prevent division by zero. If\n        'auto', the machine epsilon for float64 is used. Defaults to \"auto\".\n\n    Returns\n    -------\n    tuple\n        A tuple containing the averaged or non-averaged sensitivity and specificity.\n\n    Example""s\n    --------\n    >>> from gofast.tools.mathex import compute_sensitivity_specificity\n    >>> y_true = [0, 1, 1, 0]\n    >>> y_pred = [0, 1, 0, 1]\n    >>> compute_sensitivity_specificity(y_true, y_pred)\n    (0.5, 0.5)\n\n    Notes\n    -----\n    Sensitivity (also known as recall or true positive rate) and specificity\n    (true negative rate) are calculated from the confusion matrix as:\n\n    .. math::\n        \text{sensitivity} = \014rac{TP}{TP + FN}\n\n    .. math::\n        \text{specificity} = \014rac{TN}{TN + FP}\n\n    Here, TP, TN, FN, and FP denote the counts of true positives, true negatives,\n    false negatives, and false positives, respectively.\n\n    - Micro averaging will sum the counts of true positives, false negatives, and\n      false positives across all classes and then compute the metrics.\n    - Macro averaging will compute the metrics independently for each class but\n      then take the unweighted mean. This does not take label imbalance into\n      account.\n    - Weighted averaging will compute the metrics for each class, and find their\n      average weighted by the number of true instances for each label, which\n      helps in addressing label imbalance.\n\n    The choice of averaging method depends on the balance of classes and the\n    importance of each class in the dataset.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_23compute_sensitivity_specificity = {"compute_sensitivity_specificity", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_23compute_sensitivity_specificity, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_22compute_sensitivity_specificity};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_23compute_sensitivity_specificity(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_strategy = 0;
  PyObject *__pyx_v_average = 0;
  PyObject *__pyx_v_epsilon = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[6] = {0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_sensitivity_specificity (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_sample_weight,&__pyx_n_s_strategy,&__pyx_n_s_average,&__pyx_n_s_epsilon,0};

    /* "gofast/tools/mathex.pyx":1003
 * def compute_sensitivity_specificity(
 *     y_true, y_pred, *,
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     strategy='ovr',
 *     average='macro',
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_ovr)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_macro)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_auto)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1001, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1001, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("compute_sensitivity_specificity", 1, 2, 2, 1); __PYX_ERR(0, 1001, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && likely(kw_args <= 4)) {
        Py_ssize_t index;
        for (index = 2; index < 6 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1001, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_sensitivity_specificity") < 0)) __PYX_ERR(0, 1001, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_sample_weight = values[2];
    __pyx_v_strategy = values[3];
    __pyx_v_average = values[4];
    __pyx_v_epsilon = values[5];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_sensitivity_specificity", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1001, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_sensitivity_specificity", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_22compute_sensitivity_specificity(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_sample_weight, __pyx_v_strategy, __pyx_v_average, __pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":1001
 *     return sensitivity, specificity
 * 
 * def compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight=None,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_22compute_sensitivity_specificity(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_strategy, PyObject *__pyx_v_average, PyObject *__pyx_v_epsilon) {
  PyObject *__pyx_v_labels = NULL;
  PyObject *__pyx_v_label_to_index = NULL;
  PyObject *__pyx_v_y_true_indices = NULL;
  PyObject *__pyx_v_y_pred_indices = NULL;
  PyObject *__pyx_v_cm = NULL;
  PyObject *__pyx_v_sensitivity = NULL;
  PyObject *__pyx_v_specificity = NULL;
  Py_ssize_t __pyx_v_i;
  PyObject *__pyx_v_TP = NULL;
  PyObject *__pyx_v_FN = NULL;
  PyObject *__pyx_v_FP = NULL;
  PyObject *__pyx_v_TN = NULL;
  PyObject *__pyx_v_support = NULL;
  PyObject *__pyx_v_total_TP = NULL;
  PyObject *__pyx_v_total_FN = NULL;
  PyObject *__pyx_v_total_FP = NULL;
  PyObject *__pyx_v_total_TN = NULL;
  PyObject *__pyx_v_micro_sensitivity = NULL;
  PyObject *__pyx_v_micro_specificity = NULL;
  PyObject *__pyx_8genexpr1__pyx_v_index = NULL;
  PyObject *__pyx_8genexpr1__pyx_v_label = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  PyObject *(*__pyx_t_11)(PyObject *);
  Py_ssize_t __pyx_t_12;
  Py_ssize_t __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__26)
  __Pyx_RefNannySetupContext("compute_sensitivity_specificity", 0);
  __Pyx_TraceCall("compute_sensitivity_specificity", __pyx_f[0], 1001, 0, __PYX_ERR(0, 1001, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_strategy);
  __Pyx_INCREF(__pyx_v_average);
  __Pyx_INCREF(__pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":1080
 *     """
 * 
 *     if is_binary_class(y_true, accept_multioutput= False) :             # <<<<<<<<<<<<<<
 *         return _compute_sensitivity_specificity (
 *             y_true, y_pred, sample_weight=sample_weight,
 */
  __Pyx_TraceLine(1080,0,__PYX_ERR(0, 1080, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_is_binary_class); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1080, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1080, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 1080, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1080, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_accept_multioutput, Py_False) < 0) __PYX_ERR(0, 1080, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1080, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1080, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1081
 * 
 *     if is_binary_class(y_true, accept_multioutput= False) :
 *         return _compute_sensitivity_specificity (             # <<<<<<<<<<<<<<
 *             y_true, y_pred, sample_weight=sample_weight,
 *             epsilon=epsilon # already defined.
 */
    __Pyx_TraceLine(1081,0,__PYX_ERR(0, 1081, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_compute_sensitivity_specificity); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1081, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);

    /* "gofast/tools/mathex.pyx":1082
 *     if is_binary_class(y_true, accept_multioutput= False) :
 *         return _compute_sensitivity_specificity (
 *             y_true, y_pred, sample_weight=sample_weight,             # <<<<<<<<<<<<<<
 *             epsilon=epsilon # already defined.
 *             )
 */
    __Pyx_TraceLine(1082,0,__PYX_ERR(0, 1082, __pyx_L1_error))
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1081, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_y_true)) __PYX_ERR(0, 1081, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_pred);
    __Pyx_GIVEREF(__pyx_v_y_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1081, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1082, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 1082, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":1083
 *         return _compute_sensitivity_specificity (
 *             y_true, y_pred, sample_weight=sample_weight,
 *             epsilon=epsilon # already defined.             # <<<<<<<<<<<<<<
 *             )
 * 
 */
    __Pyx_TraceLine(1083,0,__PYX_ERR(0, 1083, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_epsilon, __pyx_v_epsilon) < 0) __PYX_ERR(0, 1082, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":1081
 * 
 *     if is_binary_class(y_true, accept_multioutput= False) :
 *         return _compute_sensitivity_specificity (             # <<<<<<<<<<<<<<
 *             y_true, y_pred, sample_weight=sample_weight,
 *             epsilon=epsilon # already defined.
 */
    __Pyx_TraceLine(1081,0,__PYX_ERR(0, 1081, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1081, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1080
 *     """
 * 
 *     if is_binary_class(y_true, accept_multioutput= False) :             # <<<<<<<<<<<<<<
 *         return _compute_sensitivity_specificity (
 *             y_true, y_pred, sample_weight=sample_weight,
 */
  }

  /* "gofast/tools/mathex.pyx":1086
 *             )
 * 
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)             # <<<<<<<<<<<<<<
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 */
  __Pyx_TraceLine(1086,0,__PYX_ERR(0, 1086, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 1086, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1086, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 1086, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1086, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 1086, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1086, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1086, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1086, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_1), 2) < 0) __PYX_ERR(0, 1086, __pyx_L1_error)
    __pyx_t_6 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L5_unpacking_done;
    __pyx_L4_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 1086, __pyx_L1_error)
    __pyx_L5_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1087
 * 
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(
 */
  __Pyx_TraceLine(1087,0,__PYX_ERR(0, 1087, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1087, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":1088
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)             # <<<<<<<<<<<<<<
 *     average = parameter_validator(
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)
 */
  __Pyx_TraceLine(1088,0,__PYX_ERR(0, 1088, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1088, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = PySet_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1088, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PySet_Add(__pyx_t_1, __pyx_n_u_ovr) < 0) __PYX_ERR(0, 1088, __pyx_L1_error)
  if (PySet_Add(__pyx_t_1, __pyx_n_u_ovo) < 0) __PYX_ERR(0, 1088, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_target_strs, __pyx_t_1) < 0) __PYX_ERR(0, 1088, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1087
 * 
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(
 */
  __Pyx_TraceLine(1087,0,__PYX_ERR(0, 1087, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__7, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1087, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1088
 *     y_true, y_pred = _ensure_y_is_valid( y_true, y_pred, y_numeric =True)
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)             # <<<<<<<<<<<<<<
 *     average = parameter_validator(
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)
 */
  __Pyx_TraceLine(1088,0,__PYX_ERR(0, 1088, __pyx_L1_error))
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_strategy};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1088, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_strategy, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1089
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(             # <<<<<<<<<<<<<<
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)
 * 
 */
  __Pyx_TraceLine(1089,0,__PYX_ERR(0, 1089, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":1090
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)             # <<<<<<<<<<<<<<
 * 
 *     epsilon = check_epsilon(epsilon, y_true, y_pred , scale_factor =1e-10)
 */
  __Pyx_TraceLine(1090,0,__PYX_ERR(0, 1090, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1090, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PySet_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1090, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PySet_Add(__pyx_t_2, __pyx_n_u_macro) < 0) __PYX_ERR(0, 1090, __pyx_L1_error)
  if (PySet_Add(__pyx_t_2, __pyx_n_u_micro) < 0) __PYX_ERR(0, 1090, __pyx_L1_error)
  if (PySet_Add(__pyx_t_2, __pyx_n_u_weighted) < 0) __PYX_ERR(0, 1090, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_target_strs, __pyx_t_2) < 0) __PYX_ERR(0, 1090, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1089
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(             # <<<<<<<<<<<<<<
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)
 * 
 */
  __Pyx_TraceLine(1089,0,__PYX_ERR(0, 1089, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_tuple__27, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1090
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)             # <<<<<<<<<<<<<<
 * 
 *     epsilon = check_epsilon(epsilon, y_true, y_pred , scale_factor =1e-10)
 */
  __Pyx_TraceLine(1090,0,__PYX_ERR(0, 1090, __pyx_L1_error))
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_average};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1090, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_average, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1092
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)
 * 
 *     epsilon = check_epsilon(epsilon, y_true, y_pred , scale_factor =1e-10)             # <<<<<<<<<<<<<<
 *     # Encode labels to integer indices
 *     labels = np.unique(np.concatenate([y_true, y_pred]))
 */
  __Pyx_TraceLine(1092,0,__PYX_ERR(0, 1092, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_check_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1092, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1092, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_epsilon);
  __Pyx_GIVEREF(__pyx_v_epsilon);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_epsilon)) __PYX_ERR(0, 1092, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_true)) __PYX_ERR(0, 1092, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_y_pred)) __PYX_ERR(0, 1092, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1092, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_scale_factor, __pyx_float_1eneg_10) < 0) __PYX_ERR(0, 1092, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1092, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1094
 *     epsilon = check_epsilon(epsilon, y_true, y_pred , scale_factor =1e-10)
 *     # Encode labels to integer indices
 *     labels = np.unique(np.concatenate([y_true, y_pred]))             # <<<<<<<<<<<<<<
 *     label_to_index = {label: index for index, label in enumerate(labels)}
 *     y_true_indices = np.vectorize(label_to_index.get)(y_true)
 */
  __Pyx_TraceLine(1094,0,__PYX_ERR(0, 1094, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_unique); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_concatenate); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyList_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 0, __pyx_v_y_true)) __PYX_ERR(0, 1094, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1094, __pyx_L1_error);
  __pyx_t_9 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_4};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1094, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1094, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_labels = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1095
 *     # Encode labels to integer indices
 *     labels = np.unique(np.concatenate([y_true, y_pred]))
 *     label_to_index = {label: index for index, label in enumerate(labels)}             # <<<<<<<<<<<<<<
 *     y_true_indices = np.vectorize(label_to_index.get)(y_true)
 *     y_pred_indices = np.vectorize(label_to_index.get)(y_pred)
 */
  __Pyx_TraceLine(1095,0,__PYX_ERR(0, 1095, __pyx_L1_error))
  { /* enter inner scope */
    __pyx_t_1 = PyDict_New(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1095, __pyx_L8_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_2 = __pyx_int_0;
    if (likely(PyList_CheckExact(__pyx_v_labels)) || PyTuple_CheckExact(__pyx_v_labels)) {
      __pyx_t_3 = __pyx_v_labels; __Pyx_INCREF(__pyx_t_3);
      __pyx_t_10 = 0;
      __pyx_t_11 = NULL;
    } else {
      __pyx_t_10 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_labels); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1095, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1095, __pyx_L8_error)
    }
    for (;;) {
      if (likely(!__pyx_t_11)) {
        if (likely(PyList_CheckExact(__pyx_t_3))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1095, __pyx_L8_error)
            #endif
            if (__pyx_t_10 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_8 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_8); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 1095, __pyx_L8_error)
          #else
          __pyx_t_8 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1095, __pyx_L8_error)
          __Pyx_GOTREF(__pyx_t_8);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1095, __pyx_L8_error)
            #endif
            if (__pyx_t_10 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_10); __Pyx_INCREF(__pyx_t_8); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 1095, __pyx_L8_error)
          #else
          __pyx_t_8 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1095, __pyx_L8_error)
          __Pyx_GOTREF(__pyx_t_8);
          #endif
        }
      } else {
        __pyx_t_8 = __pyx_t_11(__pyx_t_3);
        if (unlikely(!__pyx_t_8)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 1095, __pyx_L8_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_8);
      }
      __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_label, __pyx_t_8);
      __pyx_t_8 = 0;
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_index, __pyx_t_2);
      __pyx_t_8 = __Pyx_PyInt_AddObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1095, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_2);
      __pyx_t_2 = __pyx_t_8;
      __pyx_t_8 = 0;
      if (unlikely(PyDict_SetItem(__pyx_t_1, (PyObject*)__pyx_8genexpr1__pyx_v_label, (PyObject*)__pyx_8genexpr1__pyx_v_index))) __PYX_ERR(0, 1095, __pyx_L8_error)
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_index); __pyx_8genexpr1__pyx_v_index = 0;
    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_label); __pyx_8genexpr1__pyx_v_label = 0;
    goto __pyx_L12_exit_scope;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_index); __pyx_8genexpr1__pyx_v_index = 0;
    __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_label); __pyx_8genexpr1__pyx_v_label = 0;
    goto __pyx_L1_error;
    __pyx_L12_exit_scope:;
  } /* exit inner scope */
  __pyx_v_label_to_index = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1096
 *     labels = np.unique(np.concatenate([y_true, y_pred]))
 *     label_to_index = {label: index for index, label in enumerate(labels)}
 *     y_true_indices = np.vectorize(label_to_index.get)(y_true)             # <<<<<<<<<<<<<<
 *     y_pred_indices = np.vectorize(label_to_index.get)(y_pred)
 * 
 */
  __Pyx_TraceLine(1096,0,__PYX_ERR(0, 1096, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vectorize); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_label_to_index, __pyx_n_s_get); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1096, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_3};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1096, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_y_true};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1096, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_y_true_indices = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1097
 *     label_to_index = {label: index for index, label in enumerate(labels)}
 *     y_true_indices = np.vectorize(label_to_index.get)(y_true)
 *     y_pred_indices = np.vectorize(label_to_index.get)(y_pred)             # <<<<<<<<<<<<<<
 * 
 *     # Compute confusion matrix
 */
  __Pyx_TraceLine(1097,0,__PYX_ERR(0, 1097, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_vectorize); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_label_to_index, __pyx_n_s_get); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_8};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_y_pred_indices = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1100
 * 
 *     # Compute confusion matrix
 *     cm = confusion_matrix(y_true_indices, y_pred_indices, labels=range(len(labels)))             # <<<<<<<<<<<<<<
 * 
 *     # Sensitivity and specificity calculation
 */
  __Pyx_TraceLine(1100,0,__PYX_ERR(0, 1100, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_confusion_matrix); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true_indices);
  __Pyx_GIVEREF(__pyx_v_y_true_indices);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true_indices)) __PYX_ERR(0, 1100, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred_indices);
  __Pyx_GIVEREF(__pyx_v_y_pred_indices);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred_indices)) __PYX_ERR(0, 1100, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_10 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1100, __pyx_L1_error)
  __pyx_t_8 = PyInt_FromSsize_t(__pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_labels, __pyx_t_4) < 0) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_cm = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1103
 * 
 *     # Sensitivity and specificity calculation
 *     sensitivity = np.zeros(len(labels))             # <<<<<<<<<<<<<<
 *     specificity = np.zeros(len(labels))
 * 
 */
  __Pyx_TraceLine(1103,0,__PYX_ERR(0, 1103, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_zeros); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_10 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1103, __pyx_L1_error)
  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_3};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1103, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_sensitivity = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1104
 *     # Sensitivity and specificity calculation
 *     sensitivity = np.zeros(len(labels))
 *     specificity = np.zeros(len(labels))             # <<<<<<<<<<<<<<
 * 
 *     if strategy == 'ovr':  # One-vs-Rest
 */
  __Pyx_TraceLine(1104,0,__PYX_ERR(0, 1104, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_10 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1104, __pyx_L1_error)
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1104, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1104, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_specificity = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1106
 *     specificity = np.zeros(len(labels))
 * 
 *     if strategy == 'ovr':  # One-vs-Rest             # <<<<<<<<<<<<<<
 *         for i in range(len(labels)):
 *             TP = cm[i, i]
 */
  __Pyx_TraceLine(1106,0,__PYX_ERR(0, 1106, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovr, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1106, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1107
 * 
 *     if strategy == 'ovr':  # One-vs-Rest
 *         for i in range(len(labels)):             # <<<<<<<<<<<<<<
 *             TP = cm[i, i]
 *             FN = np.sum(cm[i, :]) - TP
 */
    __Pyx_TraceLine(1107,0,__PYX_ERR(0, 1107, __pyx_L1_error))
    __pyx_t_10 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1107, __pyx_L1_error)
    __pyx_t_12 = __pyx_t_10;
    for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
      __pyx_v_i = __pyx_t_13;

      /* "gofast/tools/mathex.pyx":1108
 *     if strategy == 'ovr':  # One-vs-Rest
 *         for i in range(len(labels)):
 *             TP = cm[i, i]             # <<<<<<<<<<<<<<
 *             FN = np.sum(cm[i, :]) - TP
 *             FP = np.sum(cm[:, i]) - TP
 */
      __Pyx_TraceLine(1108,0,__PYX_ERR(0, 1108, __pyx_L1_error))
      __pyx_t_4 = PyInt_FromSsize_t(__pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1108, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1108, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_4);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4)) __PYX_ERR(0, 1108, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_3);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error);
      __pyx_t_4 = 0;
      __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1108, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_TP, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":1109
 *         for i in range(len(labels)):
 *             TP = cm[i, i]
 *             FN = np.sum(cm[i, :]) - TP             # <<<<<<<<<<<<<<
 *             FP = np.sum(cm[:, i]) - TP
 *             TN = np.sum(cm) - (TP + FP + FN)
 */
      __Pyx_TraceLine(1109,0,__PYX_ERR(0, 1109, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sum); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyInt_FromSsize_t(__pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_2);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2)) __PYX_ERR(0, 1109, __pyx_L1_error);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_slice__9)) __PYX_ERR(0, 1109, __pyx_L1_error);
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      __pyx_t_7 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_7 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_2};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1109, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __pyx_t_4 = PyNumber_Subtract(__pyx_t_3, __pyx_v_TP); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF_SET(__pyx_v_FN, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "gofast/tools/mathex.pyx":1110
 *             TP = cm[i, i]
 *             FN = np.sum(cm[i, :]) - TP
 *             FP = np.sum(cm[:, i]) - TP             # <<<<<<<<<<<<<<
 *             TN = np.sum(cm) - (TP + FP + FN)
 * 
 */
      __Pyx_TraceLine(1110,0,__PYX_ERR(0, 1110, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyInt_FromSsize_t(__pyx_v_i); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_slice__9)) __PYX_ERR(0, 1110, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_3);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error);
      __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      __pyx_t_7 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_7 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_3};
        __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1110, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __pyx_t_2 = PyNumber_Subtract(__pyx_t_4, __pyx_v_TP); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1110, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_FP, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":1111
 *             FN = np.sum(cm[i, :]) - TP
 *             FP = np.sum(cm[:, i]) - TP
 *             TN = np.sum(cm) - (TP + FP + FN)             # <<<<<<<<<<<<<<
 * 
 *             sensitivity[i] = TP / (TP + FN + epsilon)
 */
      __Pyx_TraceLine(1111,0,__PYX_ERR(0, 1111, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_7 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_7 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_cm};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1111, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __pyx_t_3 = PyNumber_Add(__pyx_v_TP, __pyx_v_FP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_v_FN); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_Subtract(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1111, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_XDECREF_SET(__pyx_v_TN, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":1113
 *             TN = np.sum(cm) - (TP + FP + FN)
 * 
 *             sensitivity[i] = TP / (TP + FN + epsilon)             # <<<<<<<<<<<<<<
 *             specificity[i] = TN / (TN + FP + epsilon)
 * 
 */
      __Pyx_TraceLine(1113,0,__PYX_ERR(0, 1113, __pyx_L1_error))
      __pyx_t_3 = PyNumber_Add(__pyx_v_TP, __pyx_v_FN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_v_TP, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely((__Pyx_SetItemInt(__pyx_v_sensitivity, __pyx_v_i, __pyx_t_3, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0))) __PYX_ERR(0, 1113, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":1114
 * 
 *             sensitivity[i] = TP / (TP + FN + epsilon)
 *             specificity[i] = TN / (TN + FP + epsilon)             # <<<<<<<<<<<<<<
 * 
 *     elif strategy == 'ovo':
 */
      __Pyx_TraceLine(1114,0,__PYX_ERR(0, 1114, __pyx_L1_error))
      __pyx_t_3 = PyNumber_Add(__pyx_v_TN, __pyx_v_FP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_v_TN, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1114, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely((__Pyx_SetItemInt(__pyx_v_specificity, __pyx_v_i, __pyx_t_3, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0))) __PYX_ERR(0, 1114, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }

    /* "gofast/tools/mathex.pyx":1106
 *     specificity = np.zeros(len(labels))
 * 
 *     if strategy == 'ovr':  # One-vs-Rest             # <<<<<<<<<<<<<<
 *         for i in range(len(labels)):
 *             TP = cm[i, i]
 */
    goto __pyx_L13;
  }

  /* "gofast/tools/mathex.pyx":1116
 *             specificity[i] = TN / (TN + FP + epsilon)
 * 
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         # Retrieve unique class labels
 *         labels = np.unique(y_true)
 */
  __Pyx_TraceLine(1116,0,__PYX_ERR(0, 1116, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_strategy, __pyx_n_u_ovo, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1116, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1118
 *     elif strategy == 'ovo':
 *         # Retrieve unique class labels
 *         labels = np.unique(y_true)             # <<<<<<<<<<<<<<
 *         return _compute_ovo_sens_spec(y_true, y_pred, labels,
 *                                       return_array=True
 */
    __Pyx_TraceLine(1118,0,__PYX_ERR(0, 1118, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1118, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_unique); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1118, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_y_true};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1118, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_labels, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1119
 *         # Retrieve unique class labels
 *         labels = np.unique(y_true)
 *         return _compute_ovo_sens_spec(y_true, y_pred, labels,             # <<<<<<<<<<<<<<
 *                                       return_array=True
 *                  )
 */
    __Pyx_TraceLine(1119,0,__PYX_ERR(0, 1119, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_compute_ovo_sens_spec); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1119, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1119, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 1119, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_pred);
    __Pyx_GIVEREF(__pyx_v_y_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1119, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_labels);
    __Pyx_GIVEREF(__pyx_v_labels);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_labels)) __PYX_ERR(0, 1119, __pyx_L1_error);

    /* "gofast/tools/mathex.pyx":1120
 *         labels = np.unique(y_true)
 *         return _compute_ovo_sens_spec(y_true, y_pred, labels,
 *                                       return_array=True             # <<<<<<<<<<<<<<
 *                  )
 *     # Handle averaging of results
 */
    __Pyx_TraceLine(1120,0,__PYX_ERR(0, 1120, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1120, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_return_array, Py_True) < 0) __PYX_ERR(0, 1120, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":1119
 *         # Retrieve unique class labels
 *         labels = np.unique(y_true)
 *         return _compute_ovo_sens_spec(y_true, y_pred, labels,             # <<<<<<<<<<<<<<
 *                                       return_array=True
 *                  )
 */
    __Pyx_TraceLine(1119,0,__PYX_ERR(0, 1119, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1119, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1116
 *             specificity[i] = TN / (TN + FP + epsilon)
 * 
 *     elif strategy == 'ovo':             # <<<<<<<<<<<<<<
 *         # Retrieve unique class labels
 *         labels = np.unique(y_true)
 */
  }
  __pyx_L13:;

  /* "gofast/tools/mathex.pyx":1123
 *                  )
 *     # Handle averaging of results
 *     if average == 'macro':             # <<<<<<<<<<<<<<
 *         return np.mean(sensitivity), np.mean(specificity)
 *     elif average == 'weighted':
 */
  __Pyx_TraceLine(1123,0,__PYX_ERR(0, 1123, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_average, __pyx_n_u_macro, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1123, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1124
 *     # Handle averaging of results
 *     if average == 'macro':
 *         return np.mean(sensitivity), np.mean(specificity)             # <<<<<<<<<<<<<<
 *     elif average == 'weighted':
 *         support = np.sum(cm, axis=1)
 */
    __Pyx_TraceLine(1124,0,__PYX_ERR(0, 1124, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_mean); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_sensitivity};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1124, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_mean); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_specificity};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1124, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1)) __PYX_ERR(0, 1124, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_2);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2)) __PYX_ERR(0, 1124, __pyx_L1_error);
    __pyx_t_1 = 0;
    __pyx_t_2 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1123
 *                  )
 *     # Handle averaging of results
 *     if average == 'macro':             # <<<<<<<<<<<<<<
 *         return np.mean(sensitivity), np.mean(specificity)
 *     elif average == 'weighted':
 */
  }

  /* "gofast/tools/mathex.pyx":1125
 *     if average == 'macro':
 *         return np.mean(sensitivity), np.mean(specificity)
 *     elif average == 'weighted':             # <<<<<<<<<<<<<<
 *         support = np.sum(cm, axis=1)
 *         return (np.average(sensitivity, weights=support),
 */
  __Pyx_TraceLine(1125,0,__PYX_ERR(0, 1125, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_average, __pyx_n_u_weighted, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1125, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1126
 *         return np.mean(sensitivity), np.mean(specificity)
 *     elif average == 'weighted':
 *         support = np.sum(cm, axis=1)             # <<<<<<<<<<<<<<
 *         return (np.average(sensitivity, weights=support),
 *                 np.average(specificity, weights=support))
 */
    __Pyx_TraceLine(1126,0,__PYX_ERR(0, 1126, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1126, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1126, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1126, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_cm);
    __Pyx_GIVEREF(__pyx_v_cm);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_cm)) __PYX_ERR(0, 1126, __pyx_L1_error);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1126, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_axis, __pyx_int_1) < 0) __PYX_ERR(0, 1126, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1126, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_support = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":1127
 *     elif average == 'weighted':
 *         support = np.sum(cm, axis=1)
 *         return (np.average(sensitivity, weights=support),             # <<<<<<<<<<<<<<
 *                 np.average(specificity, weights=support))
 *     elif average == 'micro':
 */
    __Pyx_TraceLine(1127,0,__PYX_ERR(0, 1127, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_average); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_sensitivity);
    __Pyx_GIVEREF(__pyx_v_sensitivity);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_sensitivity)) __PYX_ERR(0, 1127, __pyx_L1_error);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_weights, __pyx_v_support) < 0) __PYX_ERR(0, 1127, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1128
 *         support = np.sum(cm, axis=1)
 *         return (np.average(sensitivity, weights=support),
 *                 np.average(specificity, weights=support))             # <<<<<<<<<<<<<<
 *     elif average == 'micro':
 *         total_TP = np.sum(np.diag(cm))
 */
    __Pyx_TraceLine(1128,0,__PYX_ERR(0, 1128, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_average); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_specificity);
    __Pyx_GIVEREF(__pyx_v_specificity);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_specificity)) __PYX_ERR(0, 1128, __pyx_L1_error);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_weights, __pyx_v_support) < 0) __PYX_ERR(0, 1128, __pyx_L1_error)
    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1127
 *     elif average == 'weighted':
 *         support = np.sum(cm, axis=1)
 *         return (np.average(sensitivity, weights=support),             # <<<<<<<<<<<<<<
 *                 np.average(specificity, weights=support))
 *     elif average == 'micro':
 */
    __Pyx_TraceLine(1127,0,__PYX_ERR(0, 1127, __pyx_L1_error))
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1127, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2)) __PYX_ERR(0, 1127, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_8);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_8)) __PYX_ERR(0, 1127, __pyx_L1_error);
    __pyx_t_2 = 0;
    __pyx_t_8 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1125
 *     if average == 'macro':
 *         return np.mean(sensitivity), np.mean(specificity)
 *     elif average == 'weighted':             # <<<<<<<<<<<<<<
 *         support = np.sum(cm, axis=1)
 *         return (np.average(sensitivity, weights=support),
 */
  }

  /* "gofast/tools/mathex.pyx":1129
 *         return (np.average(sensitivity, weights=support),
 *                 np.average(specificity, weights=support))
 *     elif average == 'micro':             # <<<<<<<<<<<<<<
 *         total_TP = np.sum(np.diag(cm))
 *         total_FN = np.sum(np.sum(cm, axis=1) - np.diag(cm))
 */
  __Pyx_TraceLine(1129,0,__PYX_ERR(0, 1129, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_average, __pyx_n_u_micro, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1129, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1130
 *                 np.average(specificity, weights=support))
 *     elif average == 'micro':
 *         total_TP = np.sum(np.diag(cm))             # <<<<<<<<<<<<<<
 *         total_FN = np.sum(np.sum(cm, axis=1) - np.diag(cm))
 *         total_FP = np.sum(np.sum(cm, axis=0) - np.diag(cm))
 */
    __Pyx_TraceLine(1130,0,__PYX_ERR(0, 1130, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_diag); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_cm};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1130, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_8};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1130, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_v_total_TP = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1131
 *     elif average == 'micro':
 *         total_TP = np.sum(np.diag(cm))
 *         total_FN = np.sum(np.sum(cm, axis=1) - np.diag(cm))             # <<<<<<<<<<<<<<
 *         total_FP = np.sum(np.sum(cm, axis=0) - np.diag(cm))
 *         total_TN = np.sum(cm) - (total_TP + total_FP + total_FN)
 */
    __Pyx_TraceLine(1131,0,__PYX_ERR(0, 1131, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sum); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sum); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_cm);
    __Pyx_GIVEREF(__pyx_v_cm);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_cm)) __PYX_ERR(0, 1131, __pyx_L1_error);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_axis, __pyx_int_1) < 0) __PYX_ERR(0, 1131, __pyx_L1_error)
    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_diag); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_cm};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1131, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_t_4 = PyNumber_Subtract(__pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_4};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1131, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_v_total_FN = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1132
 *         total_TP = np.sum(np.diag(cm))
 *         total_FN = np.sum(np.sum(cm, axis=1) - np.diag(cm))
 *         total_FP = np.sum(np.sum(cm, axis=0) - np.diag(cm))             # <<<<<<<<<<<<<<
 *         total_TN = np.sum(cm) - (total_TP + total_FP + total_FN)
 *         micro_sensitivity = total_TP / (total_TP + total_FN + epsilon)
 */
    __Pyx_TraceLine(1132,0,__PYX_ERR(0, 1132, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_sum); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_v_cm);
    __Pyx_GIVEREF(__pyx_v_cm);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_cm)) __PYX_ERR(0, 1132, __pyx_L1_error);
    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1132, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_diag); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_cm};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1132, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = PyNumber_Subtract(__pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_3};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1132, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_v_total_FP = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1133
 *         total_FN = np.sum(np.sum(cm, axis=1) - np.diag(cm))
 *         total_FP = np.sum(np.sum(cm, axis=0) - np.diag(cm))
 *         total_TN = np.sum(cm) - (total_TP + total_FP + total_FN)             # <<<<<<<<<<<<<<
 *         micro_sensitivity = total_TP / (total_TP + total_FN + epsilon)
 *         micro_specificity = total_TN / (total_TN + total_FP + epsilon)
 */
    __Pyx_TraceLine(1133,0,__PYX_ERR(0, 1133, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1133, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1133, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_cm};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1133, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = PyNumber_Add(__pyx_v_total_TP, __pyx_v_total_FP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1133, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_v_total_FN); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1133, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Subtract(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1133, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_total_TN = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1134
 *         total_FP = np.sum(np.sum(cm, axis=0) - np.diag(cm))
 *         total_TN = np.sum(cm) - (total_TP + total_FP + total_FN)
 *         micro_sensitivity = total_TP / (total_TP + total_FN + epsilon)             # <<<<<<<<<<<<<<
 *         micro_specificity = total_TN / (total_TN + total_FP + epsilon)
 *         return micro_sensitivity, micro_specificity
 */
    __Pyx_TraceLine(1134,0,__PYX_ERR(0, 1134, __pyx_L1_error))
    __pyx_t_3 = PyNumber_Add(__pyx_v_total_TP, __pyx_v_total_FN); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1134, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1134, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_v_total_TP, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1134, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_micro_sensitivity = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1135
 *         total_TN = np.sum(cm) - (total_TP + total_FP + total_FN)
 *         micro_sensitivity = total_TP / (total_TP + total_FN + epsilon)
 *         micro_specificity = total_TN / (total_TN + total_FP + epsilon)             # <<<<<<<<<<<<<<
 *         return micro_sensitivity, micro_specificity
 * 
 */
    __Pyx_TraceLine(1135,0,__PYX_ERR(0, 1135, __pyx_L1_error))
    __pyx_t_3 = PyNumber_Add(__pyx_v_total_TN, __pyx_v_total_FP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1135, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PyNumber_Add(__pyx_t_3, __pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1135, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_v_total_TN, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1135, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_micro_specificity = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1136
 *         micro_sensitivity = total_TP / (total_TP + total_FN + epsilon)
 *         micro_specificity = total_TN / (total_TN + total_FP + epsilon)
 *         return micro_sensitivity, micro_specificity             # <<<<<<<<<<<<<<
 * 
 *     return sensitivity, specificity
 */
    __Pyx_TraceLine(1136,0,__PYX_ERR(0, 1136, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1136, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_micro_sensitivity);
    __Pyx_GIVEREF(__pyx_v_micro_sensitivity);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_micro_sensitivity)) __PYX_ERR(0, 1136, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_micro_specificity);
    __Pyx_GIVEREF(__pyx_v_micro_specificity);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_micro_specificity)) __PYX_ERR(0, 1136, __pyx_L1_error);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1129
 *         return (np.average(sensitivity, weights=support),
 *                 np.average(specificity, weights=support))
 *     elif average == 'micro':             # <<<<<<<<<<<<<<
 *         total_TP = np.sum(np.diag(cm))
 *         total_FN = np.sum(np.sum(cm, axis=1) - np.diag(cm))
 */
  }

  /* "gofast/tools/mathex.pyx":1138
 *         return micro_sensitivity, micro_specificity
 * 
 *     return sensitivity, specificity             # <<<<<<<<<<<<<<
 * 
 * def _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True):
 */
  __Pyx_TraceLine(1138,0,__PYX_ERR(0, 1138, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_sensitivity);
  __Pyx_GIVEREF(__pyx_v_sensitivity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_sensitivity)) __PYX_ERR(0, 1138, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_specificity);
  __Pyx_GIVEREF(__pyx_v_specificity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_specificity)) __PYX_ERR(0, 1138, __pyx_L1_error);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1001
 *     return sensitivity, specificity
 * 
 * def compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight=None,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_sensitivity_specificity", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_labels);
  __Pyx_XDECREF(__pyx_v_label_to_index);
  __Pyx_XDECREF(__pyx_v_y_true_indices);
  __Pyx_XDECREF(__pyx_v_y_pred_indices);
  __Pyx_XDECREF(__pyx_v_cm);
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XDECREF(__pyx_v_TP);
  __Pyx_XDECREF(__pyx_v_FN);
  __Pyx_XDECREF(__pyx_v_FP);
  __Pyx_XDECREF(__pyx_v_TN);
  __Pyx_XDECREF(__pyx_v_support);
  __Pyx_XDECREF(__pyx_v_total_TP);
  __Pyx_XDECREF(__pyx_v_total_FN);
  __Pyx_XDECREF(__pyx_v_total_FP);
  __Pyx_XDECREF(__pyx_v_total_TN);
  __Pyx_XDECREF(__pyx_v_micro_sensitivity);
  __Pyx_XDECREF(__pyx_v_micro_specificity);
  __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_index);
  __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_label);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_strategy);
  __Pyx_XDECREF(__pyx_v_average);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1140
 *     return sensitivity, specificity
 * 
 * def _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True):             # <<<<<<<<<<<<<<
 *     """
 *     Compute sensitivity and specificity for each pair of classes
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_25_compute_ovo_sens_spec(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_24_compute_ovo_sens_spec, "\n    Compute sensitivity and specificity for each pair of classes \n    (One-vs-One strategy).\n    Optionally returns sensitivity and specificity as arrays, averaging results \n    over all relevant pairs for each class.\n\n    Parameters:\n    y_true : array-like\n        Ground truth binary labels.\n    y_pred : array-like\n        Predicted binary labels.\n    labels : array-like\n        Array of unique class labels.\n    return_array : bool, default True\n        If True, returns sensitivity and specificity as numpy arrays averaged \n        over all pairs involving each class. If False, returns dictionaries\n        with pairs as keys.\n\n    Returns:\n    --------\n    tuple of (numpy.ndarray, numpy.ndarray) or (dict, dict)\n        Sensitivity and specificity either as arrays or dictionaries depending \n        on `return_array`.\n    Examples \n    ---------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import _compute_ovo_sens_spec\n    >>> labels = np.array([0, 1, 2])\n    >>> y_true = np.array([0, 1, 1, 2, 2, 0, 1, 2, 0])\n    >>> y_pred = np.array([0, 1, 2, 2, 0, 0, 1, 0, 2])\n    >>> sensitivity, specificity = _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True)\n    >>> print(\"Sensitivity:\", sensitivity)\n    >>> print(\"Specificity:\", specificity)\n    Sensitivity: [0.66666667 0.66666667 0.66666667]\n    Specificity: [0.66666667 1.         0.66666667]\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_25_compute_ovo_sens_spec = {"_compute_ovo_sens_spec", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_25_compute_ovo_sens_spec, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_24_compute_ovo_sens_spec};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_25_compute_ovo_sens_spec(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_labels = 0;
  PyObject *__pyx_v_return_array = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_compute_ovo_sens_spec (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_labels,&__pyx_n_s_return_array,0};
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1140, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1140, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_ovo_sens_spec", 0, 3, 4, 1); __PYX_ERR(0, 1140, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_labels)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1140, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_ovo_sens_spec", 0, 3, 4, 2); __PYX_ERR(0, 1140, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_return_array);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1140, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_compute_ovo_sens_spec") < 0)) __PYX_ERR(0, 1140, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_labels = values[2];
    __pyx_v_return_array = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_compute_ovo_sens_spec", 0, 3, 4, __pyx_nargs); __PYX_ERR(0, 1140, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._compute_ovo_sens_spec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_24_compute_ovo_sens_spec(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_labels, __pyx_v_return_array);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_24_compute_ovo_sens_spec(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_labels, PyObject *__pyx_v_return_array) {
  PyObject *__pyx_v_sensitivity = NULL;
  PyObject *__pyx_v_specificity = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_v_pair_indices = NULL;
  PyObject *__pyx_v_y_true_pair = NULL;
  PyObject *__pyx_v_y_pred_pair = NULL;
  PyObject *__pyx_v_y_true_binary = NULL;
  PyObject *__pyx_v_y_pred_binary = NULL;
  PyObject *__pyx_v_cm = NULL;
  PyObject *__pyx_v_TP = NULL;
  PyObject *__pyx_v_FN = NULL;
  PyObject *__pyx_v_FP = NULL;
  PyObject *__pyx_v_TN = NULL;
  PyObject *__pyx_v_sens_array = NULL;
  PyObject *__pyx_v_spec_array = NULL;
  PyObject *__pyx_v_idx = NULL;
  PyObject *__pyx_v_label = NULL;
  PyObject *__pyx_v_involved_pairs = NULL;
  PyObject *__pyx_8genexpr2__pyx_v_key = NULL;
  PyObject *__pyx_8genexpr3__pyx_v_pair = NULL;
  PyObject *__pyx_8genexpr4__pyx_v_pair = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *(*__pyx_t_9)(PyObject *);
  int __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__28)
  __Pyx_RefNannySetupContext("_compute_ovo_sens_spec", 1);
  __Pyx_TraceCall("_compute_ovo_sens_spec", __pyx_f[0], 1140, 0, __PYX_ERR(0, 1140, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":1177
 *     Specificity: [0.66666667 1.         0.66666667]
 *     """
 *     sensitivity = {}             # <<<<<<<<<<<<<<
 *     specificity = {}
 * 
 */
  __Pyx_TraceLine(1177,0,__PYX_ERR(0, 1177, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1177, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_sensitivity = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1178
 *     """
 *     sensitivity = {}
 *     specificity = {}             # <<<<<<<<<<<<<<
 * 
 *     # Iterate over all pairs of labels
 */
  __Pyx_TraceLine(1178,0,__PYX_ERR(0, 1178, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1178, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_specificity = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1181
 * 
 *     # Iterate over all pairs of labels
 *     for i, j in itertools.combinations(labels, 2):             # <<<<<<<<<<<<<<
 *         # Filter data for the pair (i, j)
 *         pair_indices = (y_true == i) | (y_true == j)
 */
  __Pyx_TraceLine(1181,0,__PYX_ERR(0, 1181, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_itertools); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1181, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_combinations); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1181, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_labels, __pyx_int_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1181, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1181, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1181, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1181, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 1181, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1181, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1181, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 1181, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1181, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_6(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1181, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
      PyObject* sequence = __pyx_t_1;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 1181, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_7 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_7 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_7);
      #else
      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1181, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1181, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      #endif
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1181, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8);
      index = 0; __pyx_t_2 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_2)) goto __pyx_L5_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_2);
      index = 1; __pyx_t_7 = __pyx_t_9(__pyx_t_8); if (unlikely(!__pyx_t_7)) goto __pyx_L5_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_7);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_8), 2) < 0) __PYX_ERR(0, 1181, __pyx_L1_error)
      __pyx_t_9 = NULL;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      goto __pyx_L6_unpacking_done;
      __pyx_L5_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 1181, __pyx_L1_error)
      __pyx_L6_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "gofast/tools/mathex.pyx":1183
 *     for i, j in itertools.combinations(labels, 2):
 *         # Filter data for the pair (i, j)
 *         pair_indices = (y_true == i) | (y_true == j)             # <<<<<<<<<<<<<<
 *         y_true_pair = y_true[pair_indices]
 *         y_pred_pair = y_pred[pair_indices]
 */
    __Pyx_TraceLine(1183,0,__PYX_ERR(0, 1183, __pyx_L1_error))
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_i, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1183, __pyx_L1_error)
    __pyx_t_7 = PyObject_RichCompare(__pyx_v_y_true, __pyx_v_j, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1183, __pyx_L1_error)
    __pyx_t_2 = PyNumber_Or(__pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1183, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_pair_indices, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1184
 *         # Filter data for the pair (i, j)
 *         pair_indices = (y_true == i) | (y_true == j)
 *         y_true_pair = y_true[pair_indices]             # <<<<<<<<<<<<<<
 *         y_pred_pair = y_pred[pair_indices]
 * 
 */
    __Pyx_TraceLine(1184,0,__PYX_ERR(0, 1184, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_v_pair_indices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1184, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_y_true_pair, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1185
 *         pair_indices = (y_true == i) | (y_true == j)
 *         y_true_pair = y_true[pair_indices]
 *         y_pred_pair = y_pred[pair_indices]             # <<<<<<<<<<<<<<
 * 
 *         # Map labels i and j to 0 and 1 for binary classification in this pair
 */
    __Pyx_TraceLine(1185,0,__PYX_ERR(0, 1185, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_v_pair_indices); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1185, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_y_pred_pair, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1188
 * 
 *         # Map labels i and j to 0 and 1 for binary classification in this pair
 *         y_true_binary = np.where(y_true_pair == i, 1, 0)             # <<<<<<<<<<<<<<
 *         y_pred_binary = np.where(y_pred_pair == i, 1, 0)
 * 
 */
    __Pyx_TraceLine(1188,0,__PYX_ERR(0, 1188, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_where); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = PyObject_RichCompare(__pyx_v_y_true_pair, __pyx_v_i, Py_EQ); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1188, __pyx_L1_error)
    __pyx_t_8 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_8, __pyx_t_7, __pyx_int_1, __pyx_int_0};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 3+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1188, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_y_true_binary, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1189
 *         # Map labels i and j to 0 and 1 for binary classification in this pair
 *         y_true_binary = np.where(y_true_pair == i, 1, 0)
 *         y_pred_binary = np.where(y_pred_pair == i, 1, 0)             # <<<<<<<<<<<<<<
 * 
 *         # Calculate confusion matrix for the binary case
 */
    __Pyx_TraceLine(1189,0,__PYX_ERR(0, 1189, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1189, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_where); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1189, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_y_pred_pair, __pyx_v_i, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1189, __pyx_L1_error)
    __pyx_t_8 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_8, __pyx_t_1, __pyx_int_1, __pyx_int_0};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_4, 3+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1189, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_y_pred_binary, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1192
 * 
 *         # Calculate confusion matrix for the binary case
 *         cm = confusion_matrix(y_true_binary, y_pred_binary, labels=[1, 0])             # <<<<<<<<<<<<<<
 *         TP = cm[0, 0]
 *         FN = cm[0, 1]
 */
    __Pyx_TraceLine(1192,0,__PYX_ERR(0, 1192, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_confusion_matrix); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_7 = PyTuple_New(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_INCREF(__pyx_v_y_true_binary);
    __Pyx_GIVEREF(__pyx_v_y_true_binary);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_y_true_binary)) __PYX_ERR(0, 1192, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_pred_binary);
    __Pyx_GIVEREF(__pyx_v_y_pred_binary);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_v_y_pred_binary)) __PYX_ERR(0, 1192, __pyx_L1_error);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyList_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_8, 0, __pyx_int_1)) __PYX_ERR(0, 1192, __pyx_L1_error);
    __Pyx_INCREF(__pyx_int_0);
    __Pyx_GIVEREF(__pyx_int_0);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_8, 1, __pyx_int_0)) __PYX_ERR(0, 1192, __pyx_L1_error);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_labels, __pyx_t_8) < 0) __PYX_ERR(0, 1192, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_7, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1192, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_cm, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1193
 *         # Calculate confusion matrix for the binary case
 *         cm = confusion_matrix(y_true_binary, y_pred_binary, labels=[1, 0])
 *         TP = cm[0, 0]             # <<<<<<<<<<<<<<
 *         FN = cm[0, 1]
 *         FP = cm[1, 0]
 */
    __Pyx_TraceLine(1193,0,__PYX_ERR(0, 1193, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__12); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1193, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_TP, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1194
 *         cm = confusion_matrix(y_true_binary, y_pred_binary, labels=[1, 0])
 *         TP = cm[0, 0]
 *         FN = cm[0, 1]             # <<<<<<<<<<<<<<
 *         FP = cm[1, 0]
 *         TN = cm[1, 1]
 */
    __Pyx_TraceLine(1194,0,__PYX_ERR(0, 1194, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__13); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1194, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_FN, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1195
 *         TP = cm[0, 0]
 *         FN = cm[0, 1]
 *         FP = cm[1, 0]             # <<<<<<<<<<<<<<
 *         TN = cm[1, 1]
 * 
 */
    __Pyx_TraceLine(1195,0,__PYX_ERR(0, 1195, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1195, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_FP, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1196
 *         FN = cm[0, 1]
 *         FP = cm[1, 0]
 *         TN = cm[1, 1]             # <<<<<<<<<<<<<<
 * 
 *         # Store sensitivity and specificity for this pair
 */
    __Pyx_TraceLine(1196,0,__PYX_ERR(0, 1196, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_cm, __pyx_tuple__10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1196, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_XDECREF_SET(__pyx_v_TN, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1199
 * 
 *         # Store sensitivity and specificity for this pair
 *         sensitivity[(i, j)] = TP / (TP + FN) if (TP + FN) > 0 else 0             # <<<<<<<<<<<<<<
 *         specificity[(i, j)] = TN / (TN + FP) if (TN + FP) > 0 else 0
 * 
 */
    __Pyx_TraceLine(1199,0,__PYX_ERR(0, 1199, __pyx_L1_error))
    __pyx_t_1 = PyNumber_Add(__pyx_v_TP, __pyx_v_FN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_1, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1199, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 1199, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_10) {
      __pyx_t_7 = PyNumber_Add(__pyx_v_TP, __pyx_v_FN); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_TP, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = __pyx_t_1;
      __pyx_t_1 = 0;
    } else {
      __Pyx_INCREF(__pyx_int_0);
      __pyx_t_8 = __pyx_int_0;
    }
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_i);
    __Pyx_GIVEREF(__pyx_v_i);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_i)) __PYX_ERR(0, 1199, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_j);
    __Pyx_GIVEREF(__pyx_v_j);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_j)) __PYX_ERR(0, 1199, __pyx_L1_error);
    if (unlikely((PyDict_SetItem(__pyx_v_sensitivity, __pyx_t_1, __pyx_t_8) < 0))) __PYX_ERR(0, 1199, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1200
 *         # Store sensitivity and specificity for this pair
 *         sensitivity[(i, j)] = TP / (TP + FN) if (TP + FN) > 0 else 0
 *         specificity[(i, j)] = TN / (TN + FP) if (TN + FP) > 0 else 0             # <<<<<<<<<<<<<<
 * 
 *     if return_array:
 */
    __Pyx_TraceLine(1200,0,__PYX_ERR(0, 1200, __pyx_L1_error))
    __pyx_t_1 = PyNumber_Add(__pyx_v_TN, __pyx_v_FP); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1200, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_1, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1200, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 1200, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_10) {
      __pyx_t_7 = PyNumber_Add(__pyx_v_TN, __pyx_v_FP); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1200, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_TN, __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1200, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = __pyx_t_1;
      __pyx_t_1 = 0;
    } else {
      __Pyx_INCREF(__pyx_int_0);
      __pyx_t_8 = __pyx_int_0;
    }
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1200, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_i);
    __Pyx_GIVEREF(__pyx_v_i);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_i)) __PYX_ERR(0, 1200, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_j);
    __Pyx_GIVEREF(__pyx_v_j);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_j)) __PYX_ERR(0, 1200, __pyx_L1_error);
    if (unlikely((PyDict_SetItem(__pyx_v_specificity, __pyx_t_1, __pyx_t_8) < 0))) __PYX_ERR(0, 1200, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1181
 * 
 *     # Iterate over all pairs of labels
 *     for i, j in itertools.combinations(labels, 2):             # <<<<<<<<<<<<<<
 *         # Filter data for the pair (i, j)
 *         pair_indices = (y_true == i) | (y_true == j)
 */
    __Pyx_TraceLine(1181,0,__PYX_ERR(0, 1181, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1202
 *         specificity[(i, j)] = TN / (TN + FP) if (TN + FP) > 0 else 0
 * 
 *     if return_array:             # <<<<<<<<<<<<<<
 *         # Convert to arrays, averaging results for each class across all pairs involving it
 *         sens_array = np.zeros(len(labels))
 */
  __Pyx_TraceLine(1202,0,__PYX_ERR(0, 1202, __pyx_L1_error))
  __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_v_return_array); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 1202, __pyx_L1_error)
  if (__pyx_t_10) {

    /* "gofast/tools/mathex.pyx":1204
 *     if return_array:
 *         # Convert to arrays, averaging results for each class across all pairs involving it
 *         sens_array = np.zeros(len(labels))             # <<<<<<<<<<<<<<
 *         spec_array = np.zeros(len(labels))
 * 
 */
    __Pyx_TraceLine(1204,0,__PYX_ERR(0, 1204, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1204, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_zeros); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1204, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_5 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1204, __pyx_L1_error)
    __pyx_t_8 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1204, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_7 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_8};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1204, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_v_sens_array = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1205
 *         # Convert to arrays, averaging results for each class across all pairs involving it
 *         sens_array = np.zeros(len(labels))
 *         spec_array = np.zeros(len(labels))             # <<<<<<<<<<<<<<
 * 
 *         for idx, label in enumerate(labels):
 */
    __Pyx_TraceLine(1205,0,__PYX_ERR(0, 1205, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = PyObject_Length(__pyx_v_labels); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1205, __pyx_L1_error)
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1205, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_1};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1205, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_v_spec_array = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1207
 *         spec_array = np.zeros(len(labels))
 * 
 *         for idx, label in enumerate(labels):             # <<<<<<<<<<<<<<
 *             # Averaging sensitivity and specificity for each label
 *             involved_pairs = [key for key in sensitivity if label in key]
 */
    __Pyx_TraceLine(1207,0,__PYX_ERR(0, 1207, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_3 = __pyx_int_0;
    if (likely(PyList_CheckExact(__pyx_v_labels)) || PyTuple_CheckExact(__pyx_v_labels)) {
      __pyx_t_8 = __pyx_v_labels; __Pyx_INCREF(__pyx_t_8);
      __pyx_t_5 = 0;
      __pyx_t_6 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_v_labels); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1207, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1207, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_6)) {
        if (likely(PyList_CheckExact(__pyx_t_8))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_8);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1207, __pyx_L1_error)
            #endif
            if (__pyx_t_5 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 1207, __pyx_L1_error)
          #else
          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1207, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_8);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1207, __pyx_L1_error)
            #endif
            if (__pyx_t_5 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_5); __Pyx_INCREF(__pyx_t_1); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 1207, __pyx_L1_error)
          #else
          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1207, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_6(__pyx_t_8);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 1207, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_label, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_idx, __pyx_t_3);
      __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1207, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3);
      __pyx_t_3 = __pyx_t_1;
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":1209
 *         for idx, label in enumerate(labels):
 *             # Averaging sensitivity and specificity for each label
 *             involved_pairs = [key for key in sensitivity if label in key]             # <<<<<<<<<<<<<<
 *             sens_array[idx] = np.mean([sensitivity[pair] for pair in involved_pairs])
 *             spec_array[idx] = np.mean([specificity[pair] for pair in involved_pairs])
 */
      __Pyx_TraceLine(1209,0,__PYX_ERR(0, 1209, __pyx_L1_error))
      { /* enter inner scope */
        __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1209, __pyx_L13_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_11 = 0;
        __pyx_t_2 = __Pyx_dict_iterator(__pyx_v_sensitivity, 1, ((PyObject *)NULL), (&__pyx_t_12), (&__pyx_t_4)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1209, __pyx_L13_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_XDECREF(__pyx_t_7);
        __pyx_t_7 = __pyx_t_2;
        __pyx_t_2 = 0;
        while (1) {
          __pyx_t_13 = __Pyx_dict_iter_next(__pyx_t_7, __pyx_t_12, &__pyx_t_11, &__pyx_t_2, NULL, NULL, __pyx_t_4);
          if (unlikely(__pyx_t_13 == 0)) break;
          if (unlikely(__pyx_t_13 == -1)) __PYX_ERR(0, 1209, __pyx_L13_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_XDECREF_SET(__pyx_8genexpr2__pyx_v_key, __pyx_t_2);
          __pyx_t_2 = 0;
          __pyx_t_10 = (__Pyx_PySequence_ContainsTF(__pyx_v_label, __pyx_8genexpr2__pyx_v_key, Py_EQ)); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 1209, __pyx_L13_error)
          if (__pyx_t_10) {
            if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_8genexpr2__pyx_v_key))) __PYX_ERR(0, 1209, __pyx_L13_error)
          }
        }
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_key); __pyx_8genexpr2__pyx_v_key = 0;
        goto __pyx_L17_exit_scope;
        __pyx_L13_error:;
        __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_key); __pyx_8genexpr2__pyx_v_key = 0;
        goto __pyx_L1_error;
        __pyx_L17_exit_scope:;
      } /* exit inner scope */
      __Pyx_XDECREF_SET(__pyx_v_involved_pairs, ((PyObject*)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":1210
 *             # Averaging sensitivity and specificity for each label
 *             involved_pairs = [key for key in sensitivity if label in key]
 *             sens_array[idx] = np.mean([sensitivity[pair] for pair in involved_pairs])             # <<<<<<<<<<<<<<
 *             spec_array[idx] = np.mean([specificity[pair] for pair in involved_pairs])
 * 
 */
      __Pyx_TraceLine(1210,0,__PYX_ERR(0, 1210, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1210, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_mean); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1210, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      { /* enter inner scope */
        __pyx_t_7 = PyList_New(0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1210, __pyx_L20_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_14 = __pyx_v_involved_pairs; __Pyx_INCREF(__pyx_t_14);
        __pyx_t_12 = 0;
        for (;;) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_14);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1210, __pyx_L20_error)
            #endif
            if (__pyx_t_12 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_15 = PyList_GET_ITEM(__pyx_t_14, __pyx_t_12); __Pyx_INCREF(__pyx_t_15); __pyx_t_12++; if (unlikely((0 < 0))) __PYX_ERR(0, 1210, __pyx_L20_error)
          #else
          __pyx_t_15 = __Pyx_PySequence_ITEM(__pyx_t_14, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 1210, __pyx_L20_error)
          __Pyx_GOTREF(__pyx_t_15);
          #endif
          __Pyx_XDECREF_SET(__pyx_8genexpr3__pyx_v_pair, __pyx_t_15);
          __pyx_t_15 = 0;
          __pyx_t_15 = __Pyx_PyDict_GetItem(__pyx_v_sensitivity, __pyx_8genexpr3__pyx_v_pair); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 1210, __pyx_L20_error)
          __Pyx_GOTREF(__pyx_t_15);
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_7, (PyObject*)__pyx_t_15))) __PYX_ERR(0, 1210, __pyx_L20_error)
          __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
        }
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_pair); __pyx_8genexpr3__pyx_v_pair = 0;
        goto __pyx_L24_exit_scope;
        __pyx_L20_error:;
        __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_pair); __pyx_8genexpr3__pyx_v_pair = 0;
        goto __pyx_L1_error;
        __pyx_L24_exit_scope:;
      } /* exit inner scope */
      __pyx_t_14 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_14)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_14);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_t_7};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1210, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      if (unlikely((PyObject_SetItem(__pyx_v_sens_array, __pyx_v_idx, __pyx_t_1) < 0))) __PYX_ERR(0, 1210, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":1211
 *             involved_pairs = [key for key in sensitivity if label in key]
 *             sens_array[idx] = np.mean([sensitivity[pair] for pair in involved_pairs])
 *             spec_array[idx] = np.mean([specificity[pair] for pair in involved_pairs])             # <<<<<<<<<<<<<<
 * 
 *         return sens_array, spec_array
 */
      __Pyx_TraceLine(1211,0,__PYX_ERR(0, 1211, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1211, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_mean); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1211, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      { /* enter inner scope */
        __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1211, __pyx_L27_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_14 = __pyx_v_involved_pairs; __Pyx_INCREF(__pyx_t_14);
        __pyx_t_12 = 0;
        for (;;) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_14);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1211, __pyx_L27_error)
            #endif
            if (__pyx_t_12 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_15 = PyList_GET_ITEM(__pyx_t_14, __pyx_t_12); __Pyx_INCREF(__pyx_t_15); __pyx_t_12++; if (unlikely((0 < 0))) __PYX_ERR(0, 1211, __pyx_L27_error)
          #else
          __pyx_t_15 = __Pyx_PySequence_ITEM(__pyx_t_14, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 1211, __pyx_L27_error)
          __Pyx_GOTREF(__pyx_t_15);
          #endif
          __Pyx_XDECREF_SET(__pyx_8genexpr4__pyx_v_pair, __pyx_t_15);
          __pyx_t_15 = 0;
          __pyx_t_15 = __Pyx_PyDict_GetItem(__pyx_v_specificity, __pyx_8genexpr4__pyx_v_pair); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 1211, __pyx_L27_error)
          __Pyx_GOTREF(__pyx_t_15);
          if (unlikely(__Pyx_ListComp_Append(__pyx_t_2, (PyObject*)__pyx_t_15))) __PYX_ERR(0, 1211, __pyx_L27_error)
          __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
        }
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_XDECREF(__pyx_8genexpr4__pyx_v_pair); __pyx_8genexpr4__pyx_v_pair = 0;
        goto __pyx_L31_exit_scope;
        __pyx_L27_error:;
        __Pyx_XDECREF(__pyx_8genexpr4__pyx_v_pair); __pyx_8genexpr4__pyx_v_pair = 0;
        goto __pyx_L1_error;
        __pyx_L31_exit_scope:;
      } /* exit inner scope */
      __pyx_t_14 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_14)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_14);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_t_2};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1211, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
      if (unlikely((PyObject_SetItem(__pyx_v_spec_array, __pyx_v_idx, __pyx_t_1) < 0))) __PYX_ERR(0, 1211, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":1207
 *         spec_array = np.zeros(len(labels))
 * 
 *         for idx, label in enumerate(labels):             # <<<<<<<<<<<<<<
 *             # Averaging sensitivity and specificity for each label
 *             involved_pairs = [key for key in sensitivity if label in key]
 */
      __Pyx_TraceLine(1207,0,__PYX_ERR(0, 1207, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1213
 *             spec_array[idx] = np.mean([specificity[pair] for pair in involved_pairs])
 * 
 *         return sens_array, spec_array             # <<<<<<<<<<<<<<
 * 
 *     return sensitivity, specificity
 */
    __Pyx_TraceLine(1213,0,__PYX_ERR(0, 1213, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1213, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_sens_array);
    __Pyx_GIVEREF(__pyx_v_sens_array);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_sens_array)) __PYX_ERR(0, 1213, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_spec_array);
    __Pyx_GIVEREF(__pyx_v_spec_array);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_spec_array)) __PYX_ERR(0, 1213, __pyx_L1_error);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1202
 *         specificity[(i, j)] = TN / (TN + FP) if (TN + FP) > 0 else 0
 * 
 *     if return_array:             # <<<<<<<<<<<<<<
 *         # Convert to arrays, averaging results for each class across all pairs involving it
 *         sens_array = np.zeros(len(labels))
 */
  }

  /* "gofast/tools/mathex.pyx":1215
 *         return sens_array, spec_array
 * 
 *     return sensitivity, specificity             # <<<<<<<<<<<<<<
 * 
 * def calculate_histogram_bins(
 */
  __Pyx_TraceLine(1215,0,__PYX_ERR(0, 1215, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1215, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_sensitivity);
  __Pyx_GIVEREF(__pyx_v_sensitivity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_sensitivity)) __PYX_ERR(0, 1215, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_specificity);
  __Pyx_GIVEREF(__pyx_v_specificity);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_specificity)) __PYX_ERR(0, 1215, __pyx_L1_error);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1140
 *     return sensitivity, specificity
 * 
 * def _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True):             # <<<<<<<<<<<<<<
 *     """
 *     Compute sensitivity and specificity for each pair of classes
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("gofast.tools.mathex._compute_ovo_sens_spec", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_sensitivity);
  __Pyx_XDECREF(__pyx_v_specificity);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_j);
  __Pyx_XDECREF(__pyx_v_pair_indices);
  __Pyx_XDECREF(__pyx_v_y_true_pair);
  __Pyx_XDECREF(__pyx_v_y_pred_pair);
  __Pyx_XDECREF(__pyx_v_y_true_binary);
  __Pyx_XDECREF(__pyx_v_y_pred_binary);
  __Pyx_XDECREF(__pyx_v_cm);
  __Pyx_XDECREF(__pyx_v_TP);
  __Pyx_XDECREF(__pyx_v_FN);
  __Pyx_XDECREF(__pyx_v_FP);
  __Pyx_XDECREF(__pyx_v_TN);
  __Pyx_XDECREF(__pyx_v_sens_array);
  __Pyx_XDECREF(__pyx_v_spec_array);
  __Pyx_XDECREF(__pyx_v_idx);
  __Pyx_XDECREF(__pyx_v_label);
  __Pyx_XDECREF(__pyx_v_involved_pairs);
  __Pyx_XDECREF(__pyx_8genexpr2__pyx_v_key);
  __Pyx_XDECREF(__pyx_8genexpr3__pyx_v_pair);
  __Pyx_XDECREF(__pyx_8genexpr4__pyx_v_pair);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1217
 *     return sensitivity, specificity
 * 
 * def calculate_histogram_bins(             # <<<<<<<<<<<<<<
 *         data:ArrayLike,  bins:Union [int, str, list]='auto', range:Tuple[float, float]=None, normalize: bool=False):
 *     """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_27calculate_histogram_bins(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_26calculate_histogram_bins, "\n    Calculates histogram bin edges from data with optional normalization.\n\n    Parameters\n    ----------\n    data : array_like\n        The input data to calculate histogram bins for.\n    bins : int, sequence of scalars, or str, optional\n        The criteria to bin the data. If an integer, it defines the number \n        of equal-width bins in the given range. If a sequence, it defines the \n        bin edges directly. If a string, it defines the method used to calculate \n        the optimal bin width, as defined by numpy.histogram_bin_edges().\n    range : (float, float), optional\n        The lower and upper range of the bins. If not provided, range is \n        simply (data.min(), data.max()).\n        Values outside the range are ignored.\n    normalize : bool, default False\n        If True, scales the data to range [0, 1] before calculating bins.\n\n    Returns\n    -------\n    bin_edges : ndarray\n        The computed or specified bin edges.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import calculate_histogram_bins\n    >>> data = np.random.randn(1000)\n    >>> bins = calculate_histogram_bins(data, bins=30)\n    >>> print(bins)\n\n    Notes\n    -----\n    This function is particularly useful in data preprocessing for histogram plotting.\n    Normalization before binning can be useful when dealing with data with outliers\n    or very skewed distributions.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_27calculate_histogram_bins = {"calculate_histogram_bins", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_27calculate_histogram_bins, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_26calculate_histogram_bins};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_27calculate_histogram_bins(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_bins = 0;
  PyObject *__pyx_v_range = 0;
  PyObject *__pyx_v_normalize = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_histogram_bins (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,&__pyx_n_s_bins,&__pyx_n_s_range,&__pyx_n_s_normalize,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_auto)));

    /* "gofast/tools/mathex.pyx":1218
 * 
 * def calculate_histogram_bins(
 *         data:ArrayLike,  bins:Union [int, str, list]='auto', range:Tuple[float, float]=None, normalize: bool=False):             # <<<<<<<<<<<<<<
 *     """
 *     Calculates histogram bin edges from data with optional normalization.
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1217, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bins);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1217, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_range);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1217, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_normalize);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1217, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_histogram_bins") < 0)) __PYX_ERR(0, 1217, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_bins = values[1];
    __pyx_v_range = values[2];
    __pyx_v_normalize = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_histogram_bins", 0, 1, 4, __pyx_nargs); __PYX_ERR(0, 1217, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_histogram_bins", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_26calculate_histogram_bins(__pyx_self, __pyx_v_data, __pyx_v_bins, __pyx_v_range, __pyx_v_normalize);

  /* "gofast/tools/mathex.pyx":1217
 *     return sensitivity, specificity
 * 
 * def calculate_histogram_bins(             # <<<<<<<<<<<<<<
 *         data:ArrayLike,  bins:Union [int, str, list]='auto', range:Tuple[float, float]=None, normalize: bool=False):
 *     """
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_26calculate_histogram_bins(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_bins, PyObject *__pyx_v_range, PyObject *__pyx_v_normalize) {
  PyObject *__pyx_v_bin_edges = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__29)
  __Pyx_RefNannySetupContext("calculate_histogram_bins", 0);
  __Pyx_TraceCall("calculate_histogram_bins", __pyx_f[0], 1217, 0, __PYX_ERR(0, 1217, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_data);

  /* "gofast/tools/mathex.pyx":1256
 *     or very skewed distributions.
 *     """
 *     data = np.asarray (data)             # <<<<<<<<<<<<<<
 *     if normalize:
 *         data = (data - np.min(data)) / (np.max(data) - np.min(data))
 */
  __Pyx_TraceLine(1256,0,__PYX_ERR(0, 1256, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1256, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1256, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_data};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1256, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1257
 *     """
 *     data = np.asarray (data)
 *     if normalize:             # <<<<<<<<<<<<<<
 *         data = (data - np.min(data)) / (np.max(data) - np.min(data))
 * 
 */
  __Pyx_TraceLine(1257,0,__PYX_ERR(0, 1257, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_normalize); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1257, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1258
 *     data = np.asarray (data)
 *     if normalize:
 *         data = (data - np.min(data)) / (np.max(data) - np.min(data))             # <<<<<<<<<<<<<<
 * 
 *     bin_edges = np.histogram_bin_edges(data, bins=bins, range=range)
 */
    __Pyx_TraceLine(1258,0,__PYX_ERR(0, 1258, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_min); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_data};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = PyNumber_Subtract(__pyx_v_data, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_max); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_data};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_min); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_data};
      __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __pyx_t_7 = PyNumber_Subtract(__pyx_t_1, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1258, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":1257
 *     """
 *     data = np.asarray (data)
 *     if normalize:             # <<<<<<<<<<<<<<
 *         data = (data - np.min(data)) / (np.max(data) - np.min(data))
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":1260
 *         data = (data - np.min(data)) / (np.max(data) - np.min(data))
 * 
 *     bin_edges = np.histogram_bin_edges(data, bins=bins, range=range)             # <<<<<<<<<<<<<<
 *     return bin_edges
 * 
 */
  __Pyx_TraceLine(1260,0,__PYX_ERR(0, 1260, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_histogram_bin_edges); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = PyTuple_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_INCREF(__pyx_v_data);
  __Pyx_GIVEREF(__pyx_v_data);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_data)) __PYX_ERR(0, 1260, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_bins, __pyx_v_bins) < 0) __PYX_ERR(0, 1260, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_range, __pyx_v_range) < 0) __PYX_ERR(0, 1260, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1260, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_bin_edges = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1261
 * 
 *     bin_edges = np.histogram_bin_edges(data, bins=bins, range=range)
 *     return bin_edges             # <<<<<<<<<<<<<<
 * 
 * def rank_data(data, method='average'):
 */
  __Pyx_TraceLine(1261,0,__PYX_ERR(0, 1261, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_bin_edges);
  __pyx_r = __pyx_v_bin_edges;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1217
 *     return sensitivity, specificity
 * 
 * def calculate_histogram_bins(             # <<<<<<<<<<<<<<
 *         data:ArrayLike,  bins:Union [int, str, list]='auto', range:Tuple[float, float]=None, normalize: bool=False):
 *     """
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_histogram_bins", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_bin_edges);
  __Pyx_XDECREF(__pyx_v_data);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1263
 *     return bin_edges
 * 
 * def rank_data(data, method='average'):             # <<<<<<<<<<<<<<
 *     """
 *     Assigns ranks to data, handling ties according to the specified method.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_29rank_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_28rank_data, "\n    Assigns ranks to data, handling ties according to the specified method.\n    This function supports several strategies for tie-breaking, making it\n    versatile for ranking tasks in statistical analyses and machine learning.\n\n    Parameters\n    ----------\n    data : array-like\n        The input data to rank. This can be any sequence that can be converted\n        to a numpy array.\n    method : {'average', 'min', 'max', 'dense', 'ordinal'}, optional\n        The method used to assign ranks to tied elements. The options are:\n        - 'average': Assign the average of the ranks to the tied elements.\n        - 'min': Assign the minimum of the ranks to the tied elements.\n        - 'max': Assign the maximum of the ranks to the tied elements.\n        - 'dense': Like 'min', but the next rank is always one greater than\n          the previous rank (i.e., no gaps in rank values).\n        - 'ordinal': Assign a unique rank to each element, with ties broken\n          by their order in the data.\n\n    Returns\n    -------\n    ranks : ndarray\n        The ranks of the input data.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import rank_data\n    >>> data = [40, 20, 30, 20]\n    >>> rank_data(data, method='average')\n    array([4. , 1.5, 3. , 1.5])\n\n    >>> rank_data(data, method='min')\n    array([4, 1, 3, 1])\n\n    Notes\n    -----\n    The ranking methods provided offer flexibility for different ranking\n    scenarios. 'average', 'min', and 'max' are particularly useful in\n    statistical contexts where ties need to be accounted for explicitly,\n    while 'dense' and 'ordinal' provide strategies for more ordinal or\n    categorical data ranking tasks.\n\n    References\n    ----------\n    - Freund, J.E., & Wilson, W.J. (1993). Statistical Methods, 2nd ed.\n    - Gibbons, J.D., & Chakraborti, S. (2011). Nonparametric Statistical Inference.\n    \n    See Also\n    --------\n    scipy.stats.rankdata : Rank the data in an array.\n    num""py.argsort : Returns the indices that would sort an array.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_29rank_data = {"rank_data", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_29rank_data, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_28rank_data};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_29rank_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_method = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("rank_data (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,&__pyx_n_s_method,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_average)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1263, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1263, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "rank_data") < 0)) __PYX_ERR(0, 1263, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_method = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("rank_data", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 1263, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.rank_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_28rank_data(__pyx_self, __pyx_v_data, __pyx_v_method);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_28rank_data(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_method) {
  PyObject *__pyx_v_sorter = NULL;
  PyObject *__pyx_v_inv = NULL;
  PyObject *__pyx_v_ranks = NULL;
  PyObject *__pyx_v_valid_methods = NULL;
  PyObject *__pyx_v_dense_rank = NULL;
  PyObject *__pyx_v_prev_val = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  Py_UCS4 __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  PyObject *(*__pyx_t_12)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__30)
  __Pyx_RefNannySetupContext("rank_data", 0);
  __Pyx_TraceCall("rank_data", __pyx_f[0], 1263, 0, __PYX_ERR(0, 1263, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_method);

  /* "gofast/tools/mathex.pyx":1317
 *     numpy.argsort : Returns the indices that would sort an array.
 *     """
 *     sorter = np.argsort(data)             # <<<<<<<<<<<<<<
 *     inv = np.empty_like(sorter)
 *     inv[sorter] = np.arange(len(data))
 */
  __Pyx_TraceLine(1317,0,__PYX_ERR(0, 1317, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_argsort); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_data};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1317, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_sorter = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1318
 *     """
 *     sorter = np.argsort(data)
 *     inv = np.empty_like(sorter)             # <<<<<<<<<<<<<<
 *     inv[sorter] = np.arange(len(data))
 *     ranks = np.empty_like(data, dtype=float)
 */
  __Pyx_TraceLine(1318,0,__PYX_ERR(0, 1318, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_empty_like); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_sorter};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1318, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_inv = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1319
 *     sorter = np.argsort(data)
 *     inv = np.empty_like(sorter)
 *     inv[sorter] = np.arange(len(data))             # <<<<<<<<<<<<<<
 *     ranks = np.empty_like(data, dtype=float)
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 */
  __Pyx_TraceLine(1319,0,__PYX_ERR(0, 1319, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1319, __pyx_L1_error)
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1319, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  if (unlikely((PyObject_SetItem(__pyx_v_inv, __pyx_v_sorter, __pyx_t_1) < 0))) __PYX_ERR(0, 1319, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1320
 *     inv = np.empty_like(sorter)
 *     inv[sorter] = np.arange(len(data))
 *     ranks = np.empty_like(data, dtype=float)             # <<<<<<<<<<<<<<
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     method = normalize_string(
 */
  __Pyx_TraceLine(1320,0,__PYX_ERR(0, 1320, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_empty_like); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_data);
  __Pyx_GIVEREF(__pyx_v_data);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_data)) __PYX_ERR(0, 1320, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, ((PyObject *)(&PyFloat_Type))) < 0) __PYX_ERR(0, 1320, __pyx_L1_error)
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1320, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ranks = __pyx_t_6;
  __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":1321
 *     inv[sorter] = np.arange(len(data))
 *     ranks = np.empty_like(data, dtype=float)
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']             # <<<<<<<<<<<<<<
 *     method = normalize_string(
 *         method, target_strs=valid_methods, raise_exception=True,
 */
  __Pyx_TraceLine(1321,0,__PYX_ERR(0, 1321, __pyx_L1_error))
  __pyx_t_6 = PyList_New(5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_INCREF(__pyx_n_u_average);
  __Pyx_GIVEREF(__pyx_n_u_average);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 0, __pyx_n_u_average)) __PYX_ERR(0, 1321, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_min);
  __Pyx_GIVEREF(__pyx_n_u_min);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 1, __pyx_n_u_min)) __PYX_ERR(0, 1321, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_max);
  __Pyx_GIVEREF(__pyx_n_u_max);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 2, __pyx_n_u_max)) __PYX_ERR(0, 1321, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_dense);
  __Pyx_GIVEREF(__pyx_n_u_dense);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 3, __pyx_n_u_dense)) __PYX_ERR(0, 1321, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_ordinal);
  __Pyx_GIVEREF(__pyx_n_u_ordinal);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 4, __pyx_n_u_ordinal)) __PYX_ERR(0, 1321, __pyx_L1_error);
  __pyx_v_valid_methods = ((PyObject*)__pyx_t_6);
  __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":1322
 *     ranks = np.empty_like(data, dtype=float)
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     method = normalize_string(             # <<<<<<<<<<<<<<
 *         method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (
 */
  __Pyx_TraceLine(1322,0,__PYX_ERR(0, 1322, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_normalize_string); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);

  /* "gofast/tools/mathex.pyx":1323
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     method = normalize_string(
 *         method, target_strs=valid_methods, raise_exception=True,             # <<<<<<<<<<<<<<
 *         return_target_only=True, error_msg= (
 *             f"Invalid method '{method}'. Expect {smart_format(valid_methods, 'or')} ")
 */
  __Pyx_TraceLine(1323,0,__PYX_ERR(0, 1323, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_method);
  __Pyx_GIVEREF(__pyx_v_method);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_method)) __PYX_ERR(0, 1322, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_target_strs, __pyx_v_valid_methods) < 0) __PYX_ERR(0, 1323, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_raise_exception, Py_True) < 0) __PYX_ERR(0, 1323, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1324
 *     method = normalize_string(
 *         method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (             # <<<<<<<<<<<<<<
 *             f"Invalid method '{method}'. Expect {smart_format(valid_methods, 'or')} ")
 *         )
 */
  __Pyx_TraceLine(1324,0,__PYX_ERR(0, 1324, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_return_target_only, Py_True) < 0) __PYX_ERR(0, 1323, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1325
 *         method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (
 *             f"Invalid method '{method}'. Expect {smart_format(valid_methods, 'or')} ")             # <<<<<<<<<<<<<<
 *         )
 *     if method == 'average':
 */
  __Pyx_TraceLine(1325,0,__PYX_ERR(0, 1325, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = 0;
  __pyx_t_7 = 127;
  __Pyx_INCREF(__pyx_kp_u_Invalid_method);
  __pyx_t_5 += 16;
  __Pyx_GIVEREF(__pyx_kp_u_Invalid_method);
  PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_Invalid_method);
  __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_v_method, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_7;
  __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_8);
  PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_8);
  __pyx_t_8 = 0;
  __Pyx_INCREF(__pyx_kp_u_Expect);
  __pyx_t_5 += 10;
  __Pyx_GIVEREF(__pyx_kp_u_Expect);
  PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_kp_u_Expect);
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_smart_format); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_10, __pyx_v_valid_methods, __pyx_n_u_or};
    __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1325, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __pyx_t_9 = __Pyx_PyObject_FormatSimple(__pyx_t_8, __pyx_empty_unicode); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_7 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_9) > __pyx_t_7) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_9) : __pyx_t_7;
  __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_9);
  __Pyx_GIVEREF(__pyx_t_9);
  PyTuple_SET_ITEM(__pyx_t_3, 3, __pyx_t_9);
  __pyx_t_9 = 0;
  __Pyx_INCREF(__pyx_kp_u__31);
  __pyx_t_5 += 1;
  __Pyx_GIVEREF(__pyx_kp_u__31);
  PyTuple_SET_ITEM(__pyx_t_3, 4, __pyx_kp_u__31);
  __pyx_t_9 = __Pyx_PyUnicode_Join(__pyx_t_3, 5, __pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1325, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_error_msg, __pyx_t_9) < 0) __PYX_ERR(0, 1323, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "gofast/tools/mathex.pyx":1322
 *     ranks = np.empty_like(data, dtype=float)
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     method = normalize_string(             # <<<<<<<<<<<<<<
 *         method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (
 */
  __Pyx_TraceLine(1322,0,__PYX_ERR(0, 1322, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_method, __pyx_t_9);
  __pyx_t_9 = 0;

  /* "gofast/tools/mathex.pyx":1327
 *             f"Invalid method '{method}'. Expect {smart_format(valid_methods, 'or')} ")
 *         )
 *     if method == 'average':             # <<<<<<<<<<<<<<
 *         # Average ranks of tied groups
 *         ranks[sorter] = np.mean([np.arange(len(data))], axis=0)
 */
  __Pyx_TraceLine(1327,0,__PYX_ERR(0, 1327, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_average, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 1327, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":1329
 *     if method == 'average':
 *         # Average ranks of tied groups
 *         ranks[sorter] = np.mean([np.arange(len(data))], axis=0)             # <<<<<<<<<<<<<<
 *     elif method == 'min':
 *         # Minimum rank for all tied entries
 */
    __Pyx_TraceLine(1329,0,__PYX_ERR(0, 1329, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1329, __pyx_L1_error)
    __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_9);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 0, __pyx_t_9)) __PYX_ERR(0, 1329, __pyx_L1_error);
    __pyx_t_9 = 0;
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_6);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6)) __PYX_ERR(0, 1329, __pyx_L1_error);
    __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1329, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely((PyObject_SetItem(__pyx_v_ranks, __pyx_v_sorter, __pyx_t_2) < 0))) __PYX_ERR(0, 1329, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1327
 *             f"Invalid method '{method}'. Expect {smart_format(valid_methods, 'or')} ")
 *         )
 *     if method == 'average':             # <<<<<<<<<<<<<<
 *         # Average ranks of tied groups
 *         ranks[sorter] = np.mean([np.arange(len(data))], axis=0)
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":1330
 *         # Average ranks of tied groups
 *         ranks[sorter] = np.mean([np.arange(len(data))], axis=0)
 *     elif method == 'min':             # <<<<<<<<<<<<<<
 *         # Minimum rank for all tied entries
 *         ranks[sorter] = np.min([np.arange(len(data))], axis=0)
 */
  __Pyx_TraceLine(1330,0,__PYX_ERR(0, 1330, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_min, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 1330, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":1332
 *     elif method == 'min':
 *         # Minimum rank for all tied entries
 *         ranks[sorter] = np.min([np.arange(len(data))], axis=0)             # <<<<<<<<<<<<<<
 *     elif method == 'max':
 *         # Maximum rank for all tied entries
 */
    __Pyx_TraceLine(1332,0,__PYX_ERR(0, 1332, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_min); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1332, __pyx_L1_error)
    __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_9};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1332, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_2);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_2)) __PYX_ERR(0, 1332, __pyx_L1_error);
    __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1332, __pyx_L1_error)
    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_6, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely((PyObject_SetItem(__pyx_v_ranks, __pyx_v_sorter, __pyx_t_9) < 0))) __PYX_ERR(0, 1332, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":1330
 *         # Average ranks of tied groups
 *         ranks[sorter] = np.mean([np.arange(len(data))], axis=0)
 *     elif method == 'min':             # <<<<<<<<<<<<<<
 *         # Minimum rank for all tied entries
 *         ranks[sorter] = np.min([np.arange(len(data))], axis=0)
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":1333
 *         # Minimum rank for all tied entries
 *         ranks[sorter] = np.min([np.arange(len(data))], axis=0)
 *     elif method == 'max':             # <<<<<<<<<<<<<<
 *         # Maximum rank for all tied entries
 *         ranks[sorter] = np.max([np.arange(len(data))], axis=0)
 */
  __Pyx_TraceLine(1333,0,__PYX_ERR(0, 1333, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_max, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 1333, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":1335
 *     elif method == 'max':
 *         # Maximum rank for all tied entries
 *         ranks[sorter] = np.max([np.arange(len(data))], axis=0)             # <<<<<<<<<<<<<<
 *     elif method == 'dense':
 *         # Like 'min', but rank always increases by 1 between groups
 */
    __Pyx_TraceLine(1335,0,__PYX_ERR(0, 1335, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_max); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1335, __pyx_L1_error)
    __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
      __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1335, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_6 = PyList_New(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_GIVEREF(__pyx_t_9);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_6, 0, __pyx_t_9)) __PYX_ERR(0, 1335, __pyx_L1_error);
    __pyx_t_9 = 0;
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_6);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_6)) __PYX_ERR(0, 1335, __pyx_L1_error);
    __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 1335, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_9, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely((PyObject_SetItem(__pyx_v_ranks, __pyx_v_sorter, __pyx_t_2) < 0))) __PYX_ERR(0, 1335, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1333
 *         # Minimum rank for all tied entries
 *         ranks[sorter] = np.min([np.arange(len(data))], axis=0)
 *     elif method == 'max':             # <<<<<<<<<<<<<<
 *         # Maximum rank for all tied entries
 *         ranks[sorter] = np.max([np.arange(len(data))], axis=0)
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":1336
 *         # Maximum rank for all tied entries
 *         ranks[sorter] = np.max([np.arange(len(data))], axis=0)
 *     elif method == 'dense':             # <<<<<<<<<<<<<<
 *         # Like 'min', but rank always increases by 1 between groups
 *         dense_rank = 0
 */
  __Pyx_TraceLine(1336,0,__PYX_ERR(0, 1336, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_dense, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 1336, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":1338
 *     elif method == 'dense':
 *         # Like 'min', but rank always increases by 1 between groups
 *         dense_rank = 0             # <<<<<<<<<<<<<<
 *         prev_val = np.nan
 *         for i in sorter:
 */
    __Pyx_TraceLine(1338,0,__PYX_ERR(0, 1338, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_v_dense_rank = __pyx_int_0;

    /* "gofast/tools/mathex.pyx":1339
 *         # Like 'min', but rank always increases by 1 between groups
 *         dense_rank = 0
 *         prev_val = np.nan             # <<<<<<<<<<<<<<
 *         for i in sorter:
 *             if data[i] != prev_val:
 */
    __Pyx_TraceLine(1339,0,__PYX_ERR(0, 1339, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1339, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_nan); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1339, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_prev_val = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":1340
 *         dense_rank = 0
 *         prev_val = np.nan
 *         for i in sorter:             # <<<<<<<<<<<<<<
 *             if data[i] != prev_val:
 *                 dense_rank += 1
 */
    __Pyx_TraceLine(1340,0,__PYX_ERR(0, 1340, __pyx_L1_error))
    if (likely(PyList_CheckExact(__pyx_v_sorter)) || PyTuple_CheckExact(__pyx_v_sorter)) {
      __pyx_t_6 = __pyx_v_sorter; __Pyx_INCREF(__pyx_t_6);
      __pyx_t_5 = 0;
      __pyx_t_12 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_v_sorter); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1340, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 1340, __pyx_L1_error)
    }
    for (;;) {
      if (likely(!__pyx_t_12)) {
        if (likely(PyList_CheckExact(__pyx_t_6))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_6);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1340, __pyx_L1_error)
            #endif
            if (__pyx_t_5 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_2 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 1340, __pyx_L1_error)
          #else
          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_6, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1340, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_6);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1340, __pyx_L1_error)
            #endif
            if (__pyx_t_5 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 1340, __pyx_L1_error)
          #else
          __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_6, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1340, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          #endif
        }
      } else {
        __pyx_t_2 = __pyx_t_12(__pyx_t_6);
        if (unlikely(!__pyx_t_2)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 1340, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_2);
      }
      __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":1341
 *         prev_val = np.nan
 *         for i in sorter:
 *             if data[i] != prev_val:             # <<<<<<<<<<<<<<
 *                 dense_rank += 1
 *                 prev_val = data[i]
 */
      __Pyx_TraceLine(1341,0,__PYX_ERR(0, 1341, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1341, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_2, __pyx_v_prev_val, Py_NE); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1341, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 1341, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (__pyx_t_11) {

        /* "gofast/tools/mathex.pyx":1342
 *         for i in sorter:
 *             if data[i] != prev_val:
 *                 dense_rank += 1             # <<<<<<<<<<<<<<
 *                 prev_val = data[i]
 *             ranks[i] = dense_rank
 */
        __Pyx_TraceLine(1342,0,__PYX_ERR(0, 1342, __pyx_L1_error))
        __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_v_dense_rank, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1342, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF_SET(__pyx_v_dense_rank, __pyx_t_9);
        __pyx_t_9 = 0;

        /* "gofast/tools/mathex.pyx":1343
 *             if data[i] != prev_val:
 *                 dense_rank += 1
 *                 prev_val = data[i]             # <<<<<<<<<<<<<<
 *             ranks[i] = dense_rank
 *     elif method == 'ordinal':
 */
        __Pyx_TraceLine(1343,0,__PYX_ERR(0, 1343, __pyx_L1_error))
        __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1343, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF_SET(__pyx_v_prev_val, __pyx_t_9);
        __pyx_t_9 = 0;

        /* "gofast/tools/mathex.pyx":1341
 *         prev_val = np.nan
 *         for i in sorter:
 *             if data[i] != prev_val:             # <<<<<<<<<<<<<<
 *                 dense_rank += 1
 *                 prev_val = data[i]
 */
      }

      /* "gofast/tools/mathex.pyx":1344
 *                 dense_rank += 1
 *                 prev_val = data[i]
 *             ranks[i] = dense_rank             # <<<<<<<<<<<<<<
 *     elif method == 'ordinal':
 *         # Distinct rank for every entry, resolving ties arbitrarily
 */
      __Pyx_TraceLine(1344,0,__PYX_ERR(0, 1344, __pyx_L1_error))
      if (unlikely((PyObject_SetItem(__pyx_v_ranks, __pyx_v_i, __pyx_v_dense_rank) < 0))) __PYX_ERR(0, 1344, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":1340
 *         dense_rank = 0
 *         prev_val = np.nan
 *         for i in sorter:             # <<<<<<<<<<<<<<
 *             if data[i] != prev_val:
 *                 dense_rank += 1
 */
      __Pyx_TraceLine(1340,0,__PYX_ERR(0, 1340, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":1336
 *         # Maximum rank for all tied entries
 *         ranks[sorter] = np.max([np.arange(len(data))], axis=0)
 *     elif method == 'dense':             # <<<<<<<<<<<<<<
 *         # Like 'min', but rank always increases by 1 between groups
 *         dense_rank = 0
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":1345
 *                 prev_val = data[i]
 *             ranks[i] = dense_rank
 *     elif method == 'ordinal':             # <<<<<<<<<<<<<<
 *         # Distinct rank for every entry, resolving ties arbitrarily
 *         ranks[sorter] = np.arange(len(data))
 */
  __Pyx_TraceLine(1345,0,__PYX_ERR(0, 1345, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_ordinal, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 1345, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":1347
 *     elif method == 'ordinal':
 *         # Distinct rank for every entry, resolving ties arbitrarily
 *         ranks[sorter] = np.arange(len(data))             # <<<<<<<<<<<<<<
 * 
 *     return ranks
 */
    __Pyx_TraceLine(1347,0,__PYX_ERR(0, 1347, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1347, __pyx_L1_error)
    __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1347, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_9};
      __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1347, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    if (unlikely((PyObject_SetItem(__pyx_v_ranks, __pyx_v_sorter, __pyx_t_6) < 0))) __PYX_ERR(0, 1347, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":1345
 *                 prev_val = data[i]
 *             ranks[i] = dense_rank
 *     elif method == 'ordinal':             # <<<<<<<<<<<<<<
 *         # Distinct rank for every entry, resolving ties arbitrarily
 *         ranks[sorter] = np.arange(len(data))
 */
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":1349
 *         ranks[sorter] = np.arange(len(data))
 * 
 *     return ranks             # <<<<<<<<<<<<<<
 * 
 * def optimized_spearmanr(
 */
  __Pyx_TraceLine(1349,0,__PYX_ERR(0, 1349, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ranks);
  __pyx_r = __pyx_v_ranks;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1263
 *     return bin_edges
 * 
 * def rank_data(data, method='average'):             # <<<<<<<<<<<<<<
 *     """
 *     Assigns ranks to data, handling ties according to the specified method.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex.rank_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_sorter);
  __Pyx_XDECREF(__pyx_v_inv);
  __Pyx_XDECREF(__pyx_v_ranks);
  __Pyx_XDECREF(__pyx_v_valid_methods);
  __Pyx_XDECREF(__pyx_v_dense_rank);
  __Pyx_XDECREF(__pyx_v_prev_val);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_method);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1351
 *     return ranks
 * 
 * def optimized_spearmanr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_31optimized_spearmanr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_30optimized_spearmanr, "\n    Compute Spearman's rank correlation coefficient with support for \n    sample weights, custom tie handling, and NaN policies. This function \n    extends the standard Spearman's rank correlation to offer more \n    flexibility and utility in statistical and machine learning applications.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True values for calculating the correlation. Must be 1D.\n    y_pred : array-like\n        Predicted values, corresponding to y_true.\n    sample_weight : array-like, optional\n        Weights for each pair of values. Default is None, which gives\n        equal weight to all values.\n    tie_method : {'average', 'min', 'max', 'dense', 'ordinal'}, optional\n        Method to handle ranking ties. Default is 'average'.\n    nan_policy : {'propagate', 'raise', 'omit'}, optional\n        Defines how to handle when input contains NaN. 'propagate' returns NaN,\n        'raise' throws an error, 'omit' ignores pairs with NaN.\n    control_vars : array-like, optional\n        Control variables for partial correlation. Default is None.\n    multioutput : {'raw_values', 'uniform_average'}, optional\n        Strategy for aggregating errors across multiple output dimensions:\n        - 'raw_values' : Returns an array of RMSLE values for each output.\n        - 'uniform_average' : Averages errors across all outputs.\n    Returns\n    -------\n    float\n        Spearman's rank correlation coefficient.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import optimized_spearmanr\n    >>> y_true = [1, 2, 3, 4, 5]\n    >>> y_pred = [5, 6, 7, 8, 7]\n    >>> optimized_spearmanr(y_true, y_pred)\n    0.8208\n\n    Notes\n    -----\n    Spearman's rank correlation assesses monotonic relationships by using the \n    ranked values for each variable. It is a non-parametric measure of \n    statistical dependence between two variables [1]_.\n\n    .. math::\n        \\rho = 1 - \\frac{6 \\sum d_i^2}{n(n^2 - 1)}\n\n    where"" \\(d_i\\) is the difference between the two ranks of each observation, \n    and \\(n\\) is the number of observations [2]_.\n\n    This extended implementation allows for weighted correlation calculation, \n    handling of NaN values according to a specified policy, and consideration \n    of control variables for partial correlation analysis.\n\n    References\n    ----------\n    .. [1] Spearman, C. (1904). \"The proof and measurement of association \n           between two things\".\n    .. [2] Myer, K., & Waller, N. (2009). Applied Spearman's rank correlation. \n           Statistics in Medicine.\n\n    See Also\n    --------\n    scipy.stats.spearmanr : Spearman correlation calculation in SciPy.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_31optimized_spearmanr = {"optimized_spearmanr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_31optimized_spearmanr, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_30optimized_spearmanr};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_31optimized_spearmanr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_tie_method = 0;
  PyObject *__pyx_v_nan_policy = 0;
  PyObject *__pyx_v_control_vars = 0;
  PyObject *__pyx_v_multioutput = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("optimized_spearmanr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_sample_weight,&__pyx_n_s_tie_method,&__pyx_n_s_nan_policy,&__pyx_n_s_control_vars,&__pyx_n_s_multioutput,0};

    /* "gofast/tools/mathex.pyx":1353
 * def optimized_spearmanr(
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,             # <<<<<<<<<<<<<<
 *     tie_method:str='average',
 *     nan_policy:str='propagate',
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_average)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_propagate)));

    /* "gofast/tools/mathex.pyx":1356
 *     tie_method:str='average',
 *     nan_policy:str='propagate',
 *     control_vars:Optional[ArrayLike]=None,             # <<<<<<<<<<<<<<
 *     multioutput:str='uniform_average'
 *     ):
 */
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_uniform_average)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1351, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1351, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("optimized_spearmanr", 1, 2, 2, 1); __PYX_ERR(0, 1351, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && likely(kw_args <= 5)) {
        Py_ssize_t index;
        for (index = 2; index < 7 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1351, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "optimized_spearmanr") < 0)) __PYX_ERR(0, 1351, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_sample_weight = values[2];
    __pyx_v_tie_method = ((PyObject*)values[3]);
    __pyx_v_nan_policy = ((PyObject*)values[4]);
    __pyx_v_control_vars = values[5];
    __pyx_v_multioutput = ((PyObject*)values[6]);
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("optimized_spearmanr", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1351, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.optimized_spearmanr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tie_method), (&PyUnicode_Type), 0, "tie_method", 1))) __PYX_ERR(0, 1354, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_nan_policy), (&PyUnicode_Type), 0, "nan_policy", 1))) __PYX_ERR(0, 1355, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_multioutput), (&PyUnicode_Type), 0, "multioutput", 1))) __PYX_ERR(0, 1357, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_30optimized_spearmanr(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_sample_weight, __pyx_v_tie_method, __pyx_v_nan_policy, __pyx_v_control_vars, __pyx_v_multioutput);

  /* "gofast/tools/mathex.pyx":1351
 *     return ranks
 * 
 * def optimized_spearmanr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_30optimized_spearmanr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_tie_method, PyObject *__pyx_v_nan_policy, PyObject *__pyx_v_control_vars, PyObject *__pyx_v_multioutput) {
  PyObject *__pyx_v_results = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_corr = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__32)
  __Pyx_RefNannySetupContext("optimized_spearmanr", 0);
  __Pyx_TraceCall("optimized_spearmanr", __pyx_f[0], 1351, 0, __PYX_ERR(0, 1351, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_multioutput);

  /* "gofast/tools/mathex.pyx":1426
 *     """
 *     # Handle the multioutput scenario
 *     if y_true.ndim == 1:             # <<<<<<<<<<<<<<
 *         y_true = y_true[:, np.newaxis]
 *     if y_pred.ndim == 1:
 */
  __Pyx_TraceLine(1426,0,__PYX_ERR(0, 1426, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y_true, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1426, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_1, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 1426, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":1427
 *     # Handle the multioutput scenario
 *     if y_true.ndim == 1:
 *         y_true = y_true[:, np.newaxis]             # <<<<<<<<<<<<<<
 *     if y_pred.ndim == 1:
 *         y_pred = y_pred[:, np.newaxis]
 */
    __Pyx_TraceLine(1427,0,__PYX_ERR(0, 1427, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1427, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_newaxis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1427, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1427, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_slice__9);
    __Pyx_GIVEREF(__pyx_slice__9);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_slice__9)) __PYX_ERR(0, 1427, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_3);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3)) __PYX_ERR(0, 1427, __pyx_L1_error);
    __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1427, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1426
 *     """
 *     # Handle the multioutput scenario
 *     if y_true.ndim == 1:             # <<<<<<<<<<<<<<
 *         y_true = y_true[:, np.newaxis]
 *     if y_pred.ndim == 1:
 */
  }

  /* "gofast/tools/mathex.pyx":1428
 *     if y_true.ndim == 1:
 *         y_true = y_true[:, np.newaxis]
 *     if y_pred.ndim == 1:             # <<<<<<<<<<<<<<
 *         y_pred = y_pred[:, np.newaxis]
 *     check_consistent_length(y_true, y_pred)
 */
  __Pyx_TraceLine(1428,0,__PYX_ERR(0, 1428, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_y_pred, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1428, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_3, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 1428, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":1429
 *         y_true = y_true[:, np.newaxis]
 *     if y_pred.ndim == 1:
 *         y_pred = y_pred[:, np.newaxis]             # <<<<<<<<<<<<<<
 *     check_consistent_length(y_true, y_pred)
 *     results = []
 */
    __Pyx_TraceLine(1429,0,__PYX_ERR(0, 1429, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1429, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_newaxis); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1429, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1429, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_slice__9);
    __Pyx_GIVEREF(__pyx_slice__9);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_slice__9)) __PYX_ERR(0, 1429, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1)) __PYX_ERR(0, 1429, __pyx_L1_error);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1429, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1428
 *     if y_true.ndim == 1:
 *         y_true = y_true[:, np.newaxis]
 *     if y_pred.ndim == 1:             # <<<<<<<<<<<<<<
 *         y_pred = y_pred[:, np.newaxis]
 *     check_consistent_length(y_true, y_pred)
 */
  }

  /* "gofast/tools/mathex.pyx":1430
 *     if y_pred.ndim == 1:
 *         y_pred = y_pred[:, np.newaxis]
 *     check_consistent_length(y_true, y_pred)             # <<<<<<<<<<<<<<
 *     results = []
 *     for i in range(y_true.shape[1]):
 */
  __Pyx_TraceLine(1430,0,__PYX_ERR(0, 1430, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_check_consistent_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1430, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_y_true, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1430, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1431
 *         y_pred = y_pred[:, np.newaxis]
 *     check_consistent_length(y_true, y_pred)
 *     results = []             # <<<<<<<<<<<<<<
 *     for i in range(y_true.shape[1]):
 *         corr = _compute_spearmanr(y_true[:, i], y_pred[:, i], sample_weight,
 */
  __Pyx_TraceLine(1431,0,__PYX_ERR(0, 1431, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1431, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_results = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1432
 *     check_consistent_length(y_true, y_pred)
 *     results = []
 *     for i in range(y_true.shape[1]):             # <<<<<<<<<<<<<<
 *         corr = _compute_spearmanr(y_true[:, i], y_pred[:, i], sample_weight,
 *                                   tie_method, nan_policy, control_vars)
 */
  __Pyx_TraceLine(1432,0,__PYX_ERR(0, 1432, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y_true, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1432, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1432, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1432, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1432, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1432, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1432, __pyx_L1_error)
          #endif
          if (__pyx_t_6 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1432, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1432, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1432, __pyx_L1_error)
          #endif
          if (__pyx_t_6 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 1432, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1432, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1432, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1433
 *     results = []
 *     for i in range(y_true.shape[1]):
 *         corr = _compute_spearmanr(y_true[:, i], y_pred[:, i], sample_weight,             # <<<<<<<<<<<<<<
 *                                   tie_method, nan_policy, control_vars)
 *         results.append(corr)
 */
    __Pyx_TraceLine(1433,0,__PYX_ERR(0, 1433, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_compute_spearmanr); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1433, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1433, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_slice__9);
    __Pyx_GIVEREF(__pyx_slice__9);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_slice__9)) __PYX_ERR(0, 1433, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_i);
    __Pyx_GIVEREF(__pyx_v_i);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_i)) __PYX_ERR(0, 1433, __pyx_L1_error);
    __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1433, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1433, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_slice__9);
    __Pyx_GIVEREF(__pyx_slice__9);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_slice__9)) __PYX_ERR(0, 1433, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_i);
    __Pyx_GIVEREF(__pyx_v_i);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_i)) __PYX_ERR(0, 1433, __pyx_L1_error);
    __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1433, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":1434
 *     for i in range(y_true.shape[1]):
 *         corr = _compute_spearmanr(y_true[:, i], y_pred[:, i], sample_weight,
 *                                   tie_method, nan_policy, control_vars)             # <<<<<<<<<<<<<<
 *         results.append(corr)
 * 
 */
    __Pyx_TraceLine(1434,0,__PYX_ERR(0, 1434, __pyx_L1_error))
    __pyx_t_8 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[7] = {__pyx_t_8, __pyx_t_9, __pyx_t_10, __pyx_v_sample_weight, __pyx_v_tie_method, __pyx_v_nan_policy, __pyx_v_control_vars};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 6+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1433, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_corr, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1435
 *         corr = _compute_spearmanr(y_true[:, i], y_pred[:, i], sample_weight,
 *                                   tie_method, nan_policy, control_vars)
 *         results.append(corr)             # <<<<<<<<<<<<<<
 * 
 *     multioutput = validate_multioutput(multioutput )
 */
    __Pyx_TraceLine(1435,0,__PYX_ERR(0, 1435, __pyx_L1_error))
    __pyx_t_11 = __Pyx_PyList_Append(__pyx_v_results, __pyx_v_corr); if (unlikely(__pyx_t_11 == ((int)-1))) __PYX_ERR(0, 1435, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":1432
 *     check_consistent_length(y_true, y_pred)
 *     results = []
 *     for i in range(y_true.shape[1]):             # <<<<<<<<<<<<<<
 *         corr = _compute_spearmanr(y_true[:, i], y_pred[:, i], sample_weight,
 *                                   tie_method, nan_policy, control_vars)
 */
    __Pyx_TraceLine(1432,0,__PYX_ERR(0, 1432, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1437
 *         results.append(corr)
 * 
 *     multioutput = validate_multioutput(multioutput )             # <<<<<<<<<<<<<<
 * 
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)
 */
  __Pyx_TraceLine(1437,0,__PYX_ERR(0, 1437, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_validate_multioutput); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1437, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_multioutput};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1437, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  if (!(likely(PyUnicode_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_3))) __PYX_ERR(0, 1437, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_multioutput, ((PyObject*)__pyx_t_3));
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1439
 *     multioutput = validate_multioutput(multioutput )
 * 
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)             # <<<<<<<<<<<<<<
 * 
 * def _compute_spearmanr(
 */
  __Pyx_TraceLine(1439,0,__PYX_ERR(0, 1439, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_multioutput, __pyx_n_u_raw_values, Py_EQ)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 1439, __pyx_L1_error)
  if (__pyx_t_2) {
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1439, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1439, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_results};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1439, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __pyx_t_3 = __pyx_t_1;
    __pyx_t_1 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1439, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_mean); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1439, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_results};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1439, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_t_3 = __pyx_t_1;
    __pyx_t_1 = 0;
  }
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1351
 *     return ranks
 * 
 * def optimized_spearmanr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex.optimized_spearmanr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_results);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_corr);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_multioutput);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1441
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)
 * 
 * def _compute_spearmanr(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight, tie_method, nan_policy, control_vars):
 *     # The key addition is the handling of multioutput by reshaping inputs if
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_33_compute_spearmanr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_33_compute_spearmanr = {"_compute_spearmanr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_33_compute_spearmanr, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_33_compute_spearmanr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_tie_method = 0;
  PyObject *__pyx_v_nan_policy = 0;
  PyObject *__pyx_v_control_vars = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[6] = {0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_compute_spearmanr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_sample_weight,&__pyx_n_s_tie_method,&__pyx_n_s_nan_policy,&__pyx_n_s_control_vars,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_spearmanr", 1, 6, 6, 1); __PYX_ERR(0, 1441, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_spearmanr", 1, 6, 6, 2); __PYX_ERR(0, 1441, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_tie_method)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_spearmanr", 1, 6, 6, 3); __PYX_ERR(0, 1441, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_nan_policy)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_spearmanr", 1, 6, 6, 4); __PYX_ERR(0, 1441, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_control_vars)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[5]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1441, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_compute_spearmanr", 1, 6, 6, 5); __PYX_ERR(0, 1441, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_compute_spearmanr") < 0)) __PYX_ERR(0, 1441, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 6)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
      values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
      values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
      values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_sample_weight = values[2];
    __pyx_v_tie_method = values[3];
    __pyx_v_nan_policy = values[4];
    __pyx_v_control_vars = values[5];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_compute_spearmanr", 1, 6, 6, __pyx_nargs); __PYX_ERR(0, 1441, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._compute_spearmanr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_32_compute_spearmanr(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_sample_weight, __pyx_v_tie_method, __pyx_v_nan_policy, __pyx_v_control_vars);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1447
 *     # correlation for each, aggregating the results according to the
 *     # multioutput strategy.
 *     def _weighted_spearman_corr(ranks_true, ranks_pred, weights):             # <<<<<<<<<<<<<<
 *         """
 *         Computes Spearman's rank correlation with support for sample weights.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_18_compute_spearmanr_1_weighted_spearman_corr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_18_compute_spearmanr__weighted_spearman_corr, "\n        Computes Spearman's rank correlation with support for sample weights.\n        ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_18_compute_spearmanr_1_weighted_spearman_corr = {"_weighted_spearman_corr", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_18_compute_spearmanr_1_weighted_spearman_corr, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_18_compute_spearmanr__weighted_spearman_corr};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_18_compute_spearmanr_1_weighted_spearman_corr(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ranks_true = 0;
  PyObject *__pyx_v_ranks_pred = 0;
  PyObject *__pyx_v_weights = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_weighted_spearman_corr (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ranks_true,&__pyx_n_s_ranks_pred,&__pyx_n_s_weights,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ranks_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1447, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ranks_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1447, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_weighted_spearman_corr", 1, 3, 3, 1); __PYX_ERR(0, 1447, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_weights)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1447, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_weighted_spearman_corr", 1, 3, 3, 2); __PYX_ERR(0, 1447, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_weighted_spearman_corr") < 0)) __PYX_ERR(0, 1447, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_ranks_true = values[0];
    __pyx_v_ranks_pred = values[1];
    __pyx_v_weights = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_weighted_spearman_corr", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 1447, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._compute_spearmanr._weighted_spearman_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_18_compute_spearmanr__weighted_spearman_corr(__pyx_self, __pyx_v_ranks_true, __pyx_v_ranks_pred, __pyx_v_weights);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_18_compute_spearmanr__weighted_spearman_corr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ranks_true, PyObject *__pyx_v_ranks_pred, PyObject *__pyx_v_weights) {
  PyObject *__pyx_v_mean_rank_true = NULL;
  PyObject *__pyx_v_mean_rank_pred = NULL;
  PyObject *__pyx_v_cov = NULL;
  PyObject *__pyx_v_var_true = NULL;
  PyObject *__pyx_v_var_pred = NULL;
  PyObject *__pyx_v_spearman_corr = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_weighted_spearman_corr", 1);
  __Pyx_TraceCall("_weighted_spearman_corr", __pyx_f[0], 1447, 0, __PYX_ERR(0, 1447, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":1452
 *         """
 *         # Weighted mean rank
 *         mean_rank_true = np.average(ranks_true, weights=weights)             # <<<<<<<<<<<<<<
 *         mean_rank_pred = np.average(ranks_pred, weights=weights)
 * 
 */
  __Pyx_TraceLine(1452,0,__PYX_ERR(0, 1452, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_average); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_ranks_true);
  __Pyx_GIVEREF(__pyx_v_ranks_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_ranks_true)) __PYX_ERR(0, 1452, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_weights, __pyx_v_weights) < 0) __PYX_ERR(0, 1452, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1452, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_mean_rank_true = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1453
 *         # Weighted mean rank
 *         mean_rank_true = np.average(ranks_true, weights=weights)
 *         mean_rank_pred = np.average(ranks_pred, weights=weights)             # <<<<<<<<<<<<<<
 * 
 *         # Weighted covariance and variances
 */
  __Pyx_TraceLine(1453,0,__PYX_ERR(0, 1453, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_average); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_v_ranks_pred);
  __Pyx_GIVEREF(__pyx_v_ranks_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_ranks_pred)) __PYX_ERR(0, 1453, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_weights, __pyx_v_weights) < 0) __PYX_ERR(0, 1453, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1453, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_mean_rank_pred = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1456
 * 
 *         # Weighted covariance and variances
 *         cov = np.average((ranks_true - mean_rank_true) * (             # <<<<<<<<<<<<<<
 *             ranks_pred - mean_rank_pred), weights=weights)
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)
 */
  __Pyx_TraceLine(1456,0,__PYX_ERR(0, 1456, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_average); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_ranks_true, __pyx_v_mean_rank_true); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":1457
 *         # Weighted covariance and variances
 *         cov = np.average((ranks_true - mean_rank_true) * (
 *             ranks_pred - mean_rank_pred), weights=weights)             # <<<<<<<<<<<<<<
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)
 *         var_pred = np.average((ranks_pred - mean_rank_pred)**2, weights=weights)
 */
  __Pyx_TraceLine(1457,0,__PYX_ERR(0, 1457, __pyx_L1_error))
  __pyx_t_4 = PyNumber_Subtract(__pyx_v_ranks_pred, __pyx_v_mean_rank_pred); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1457, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":1456
 * 
 *         # Weighted covariance and variances
 *         cov = np.average((ranks_true - mean_rank_true) * (             # <<<<<<<<<<<<<<
 *             ranks_pred - mean_rank_pred), weights=weights)
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)
 */
  __Pyx_TraceLine(1456,0,__PYX_ERR(0, 1456, __pyx_L1_error))
  __pyx_t_3 = PyNumber_Multiply(__pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_3);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3)) __PYX_ERR(0, 1456, __pyx_L1_error);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1457
 *         # Weighted covariance and variances
 *         cov = np.average((ranks_true - mean_rank_true) * (
 *             ranks_pred - mean_rank_pred), weights=weights)             # <<<<<<<<<<<<<<
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)
 *         var_pred = np.average((ranks_pred - mean_rank_pred)**2, weights=weights)
 */
  __Pyx_TraceLine(1457,0,__PYX_ERR(0, 1457, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1457, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_weights, __pyx_v_weights) < 0) __PYX_ERR(0, 1457, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1456
 * 
 *         # Weighted covariance and variances
 *         cov = np.average((ranks_true - mean_rank_true) * (             # <<<<<<<<<<<<<<
 *             ranks_pred - mean_rank_pred), weights=weights)
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)
 */
  __Pyx_TraceLine(1456,0,__PYX_ERR(0, 1456, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1456, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_cov = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1458
 *         cov = np.average((ranks_true - mean_rank_true) * (
 *             ranks_pred - mean_rank_pred), weights=weights)
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)             # <<<<<<<<<<<<<<
 *         var_pred = np.average((ranks_pred - mean_rank_pred)**2, weights=weights)
 * 
 */
  __Pyx_TraceLine(1458,0,__PYX_ERR(0, 1458, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_average); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_ranks_true, __pyx_v_mean_rank_true); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_4)) __PYX_ERR(0, 1458, __pyx_L1_error);
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_weights, __pyx_v_weights) < 0) __PYX_ERR(0, 1458, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1458, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_var_true = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1459
 *             ranks_pred - mean_rank_pred), weights=weights)
 *         var_true = np.average((ranks_true - mean_rank_true)**2, weights=weights)
 *         var_pred = np.average((ranks_pred - mean_rank_pred)**2, weights=weights)             # <<<<<<<<<<<<<<
 * 
 *         # Weighted Spearman's rank correlation
 */
  __Pyx_TraceLine(1459,0,__PYX_ERR(0, 1459, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_average); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_ranks_pred, __pyx_v_mean_rank_pred); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Power(__pyx_t_1, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2)) __PYX_ERR(0, 1459, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_weights, __pyx_v_weights) < 0) __PYX_ERR(0, 1459, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1459, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_var_pred = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1462
 * 
 *         # Weighted Spearman's rank correlation
 *         spearman_corr = cov / np.sqrt(var_true * var_pred)             # <<<<<<<<<<<<<<
 *         return spearman_corr
 * 
 */
  __Pyx_TraceLine(1462,0,__PYX_ERR(0, 1462, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1462, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1462, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_var_true, __pyx_v_var_pred); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1462, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1462, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_cov, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1462, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_spearman_corr = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1463
 *         # Weighted Spearman's rank correlation
 *         spearman_corr = cov / np.sqrt(var_true * var_pred)
 *         return spearman_corr             # <<<<<<<<<<<<<<
 * 
 *     # Validate and clean data based on `nan_policy`
 */
  __Pyx_TraceLine(1463,0,__PYX_ERR(0, 1463, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_spearman_corr);
  __pyx_r = __pyx_v_spearman_corr;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1447
 *     # correlation for each, aggregating the results according to the
 *     # multioutput strategy.
 *     def _weighted_spearman_corr(ranks_true, ranks_pred, weights):             # <<<<<<<<<<<<<<
 *         """
 *         Computes Spearman's rank correlation with support for sample weights.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("gofast.tools.mathex._compute_spearmanr._weighted_spearman_corr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_mean_rank_true);
  __Pyx_XDECREF(__pyx_v_mean_rank_pred);
  __Pyx_XDECREF(__pyx_v_cov);
  __Pyx_XDECREF(__pyx_v_var_true);
  __Pyx_XDECREF(__pyx_v_var_pred);
  __Pyx_XDECREF(__pyx_v_spearman_corr);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1441
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)
 * 
 * def _compute_spearmanr(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight, tie_method, nan_policy, control_vars):
 *     # The key addition is the handling of multioutput by reshaping inputs if
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_32_compute_spearmanr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_tie_method, PyObject *__pyx_v_nan_policy, PyObject *__pyx_v_control_vars) {
  PyObject *__pyx_v__weighted_spearman_corr = 0;
  PyObject *__pyx_v_valid_policies = NULL;
  PyObject *__pyx_v_valid_mask = NULL;
  PyObject *__pyx_v_valid_methods = NULL;
  PyObject *__pyx_v_ranks_true = NULL;
  PyObject *__pyx_v_ranks_pred = NULL;
  PyObject *__pyx_v_corr = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  Py_UCS4 __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *(*__pyx_t_13)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__33)
  __Pyx_RefNannySetupContext("_compute_spearmanr", 0);
  __Pyx_TraceCall("_compute_spearmanr", __pyx_f[0], 1441, 0, __PYX_ERR(0, 1441, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_sample_weight);
  __Pyx_INCREF(__pyx_v_tie_method);
  __Pyx_INCREF(__pyx_v_nan_policy);

  /* "gofast/tools/mathex.pyx":1447
 *     # correlation for each, aggregating the results according to the
 *     # multioutput strategy.
 *     def _weighted_spearman_corr(ranks_true, ranks_pred, weights):             # <<<<<<<<<<<<<<
 *         """
 *         Computes Spearman's rank correlation with support for sample weights.
 */
  __Pyx_TraceLine(1447,0,__PYX_ERR(0, 1447, __pyx_L1_error))
  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_18_compute_spearmanr_1_weighted_spearman_corr, 0, __pyx_n_s_compute_spearmanr_locals__weigh, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__35)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1447, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v__weighted_spearman_corr = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1466
 * 
 *     # Validate and clean data based on `nan_policy`
 *     valid_policies = ['propagate', 'raise', 'omit']             # <<<<<<<<<<<<<<
 *     nan_policy= normalize_string(
 *         nan_policy, target_strs= valid_policies,
 */
  __Pyx_TraceLine(1466,0,__PYX_ERR(0, 1466, __pyx_L1_error))
  __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_u_propagate);
  __Pyx_GIVEREF(__pyx_n_u_propagate);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_propagate)) __PYX_ERR(0, 1466, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_raise);
  __Pyx_GIVEREF(__pyx_n_u_raise);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_raise)) __PYX_ERR(0, 1466, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_omit);
  __Pyx_GIVEREF(__pyx_n_u_omit);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_omit)) __PYX_ERR(0, 1466, __pyx_L1_error);
  __pyx_v_valid_policies = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1467
 *     # Validate and clean data based on `nan_policy`
 *     valid_policies = ['propagate', 'raise', 'omit']
 *     nan_policy= normalize_string(             # <<<<<<<<<<<<<<
 *         nan_policy, target_strs= valid_policies,
 *         raise_exception=True, deep=True,
 */
  __Pyx_TraceLine(1467,0,__PYX_ERR(0, 1467, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_normalize_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1467, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":1468
 *     valid_policies = ['propagate', 'raise', 'omit']
 *     nan_policy= normalize_string(
 *         nan_policy, target_strs= valid_policies,             # <<<<<<<<<<<<<<
 *         raise_exception=True, deep=True,
 *         return_target_only=True,
 */
  __Pyx_TraceLine(1468,0,__PYX_ERR(0, 1468, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1467, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_nan_policy);
  __Pyx_GIVEREF(__pyx_v_nan_policy);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_nan_policy)) __PYX_ERR(0, 1467, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1468, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_target_strs, __pyx_v_valid_policies) < 0) __PYX_ERR(0, 1468, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1469
 *     nan_policy= normalize_string(
 *         nan_policy, target_strs= valid_policies,
 *         raise_exception=True, deep=True,             # <<<<<<<<<<<<<<
 *         return_target_only=True,
 *         error_msg=(f"Invalid nan_policy: {nan_policy}")
 */
  __Pyx_TraceLine(1469,0,__PYX_ERR(0, 1469, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_raise_exception, Py_True) < 0) __PYX_ERR(0, 1468, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_deep, Py_True) < 0) __PYX_ERR(0, 1468, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1470
 *         nan_policy, target_strs= valid_policies,
 *         raise_exception=True, deep=True,
 *         return_target_only=True,             # <<<<<<<<<<<<<<
 *         error_msg=(f"Invalid nan_policy: {nan_policy}")
 *     )
 */
  __Pyx_TraceLine(1470,0,__PYX_ERR(0, 1470, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return_target_only, Py_True) < 0) __PYX_ERR(0, 1468, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1471
 *         raise_exception=True, deep=True,
 *         return_target_only=True,
 *         error_msg=(f"Invalid nan_policy: {nan_policy}")             # <<<<<<<<<<<<<<
 *     )
 *     if nan_policy == 'omit':
 */
  __Pyx_TraceLine(1471,0,__PYX_ERR(0, 1471, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_v_nan_policy, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1471, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Invalid_nan_policy, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1471, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_error_msg, __pyx_t_5) < 0) __PYX_ERR(0, 1468, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":1467
 *     # Validate and clean data based on `nan_policy`
 *     valid_policies = ['propagate', 'raise', 'omit']
 *     nan_policy= normalize_string(             # <<<<<<<<<<<<<<
 *         nan_policy, target_strs= valid_policies,
 *         raise_exception=True, deep=True,
 */
  __Pyx_TraceLine(1467,0,__PYX_ERR(0, 1467, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1467, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_nan_policy, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":1473
 *         error_msg=(f"Invalid nan_policy: {nan_policy}")
 *     )
 *     if nan_policy == 'omit':             # <<<<<<<<<<<<<<
 *         valid_mask = ~np.isnan(y_true) & ~np.isnan(y_pred)
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]
 */
  __Pyx_TraceLine(1473,0,__PYX_ERR(0, 1473, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_nan_policy, __pyx_n_u_omit, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 1473, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":1474
 *     )
 *     if nan_policy == 'omit':
 *         valid_mask = ~np.isnan(y_true) & ~np.isnan(y_pred)             # <<<<<<<<<<<<<<
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]
 *         if sample_weight is not None:
 */
    __Pyx_TraceLine(1474,0,__PYX_ERR(0, 1474, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_isnan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1474, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = PyNumber_Invert(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_isnan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_pred};
      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1474, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = PyNumber_Invert(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = PyNumber_And(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1474, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_valid_mask = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":1475
 *     if nan_policy == 'omit':
 *         valid_mask = ~np.isnan(y_true) & ~np.isnan(y_pred)
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]             # <<<<<<<<<<<<<<
 *         if sample_weight is not None:
 *             sample_weight = sample_weight[valid_mask]
 */
    __Pyx_TraceLine(1475,0,__PYX_ERR(0, 1475, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_v_valid_mask); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1475, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_v_valid_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1475, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_5);
    __pyx_t_5 = 0;
    __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1476
 *         valid_mask = ~np.isnan(y_true) & ~np.isnan(y_pred)
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]
 *         if sample_weight is not None:             # <<<<<<<<<<<<<<
 *             sample_weight = sample_weight[valid_mask]
 *     elif nan_policy == 'raise':
 */
    __Pyx_TraceLine(1476,0,__PYX_ERR(0, 1476, __pyx_L1_error))
    __pyx_t_6 = (__pyx_v_sample_weight != Py_None);
    if (__pyx_t_6) {

      /* "gofast/tools/mathex.pyx":1477
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]
 *         if sample_weight is not None:
 *             sample_weight = sample_weight[valid_mask]             # <<<<<<<<<<<<<<
 *     elif nan_policy == 'raise':
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():
 */
      __Pyx_TraceLine(1477,0,__PYX_ERR(0, 1477, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_sample_weight, __pyx_v_valid_mask); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1477, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF_SET(__pyx_v_sample_weight, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":1476
 *         valid_mask = ~np.isnan(y_true) & ~np.isnan(y_pred)
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]
 *         if sample_weight is not None:             # <<<<<<<<<<<<<<
 *             sample_weight = sample_weight[valid_mask]
 *     elif nan_policy == 'raise':
 */
    }

    /* "gofast/tools/mathex.pyx":1473
 *         error_msg=(f"Invalid nan_policy: {nan_policy}")
 *     )
 *     if nan_policy == 'omit':             # <<<<<<<<<<<<<<
 *         valid_mask = ~np.isnan(y_true) & ~np.isnan(y_pred)
 *         y_true, y_pred = y_true[valid_mask], y_pred[valid_mask]
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":1478
 *         if sample_weight is not None:
 *             sample_weight = sample_weight[valid_mask]
 *     elif nan_policy == 'raise':             # <<<<<<<<<<<<<<
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():
 *             raise ValueError("Input values contain NaNs.")
 */
  __Pyx_TraceLine(1478,0,__PYX_ERR(0, 1478, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_nan_policy, __pyx_n_u_raise, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 1478, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":1479
 *             sample_weight = sample_weight[valid_mask]
 *     elif nan_policy == 'raise':
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():             # <<<<<<<<<<<<<<
 *             raise ValueError("Input values contain NaNs.")
 * 
 */
    __Pyx_TraceLine(1479,0,__PYX_ERR(0, 1479, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_isnan); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_true};
      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1479, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_any); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1479, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (!__pyx_t_8) {
    } else {
      __pyx_t_6 = __pyx_t_8;
      goto __pyx_L6_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_isnan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_y_pred};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1479, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_any); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1479, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 1479, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __pyx_t_8;
    __pyx_L6_bool_binop_done:;
    if (unlikely(__pyx_t_6)) {

      /* "gofast/tools/mathex.pyx":1480
 *     elif nan_policy == 'raise':
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():
 *             raise ValueError("Input values contain NaNs.")             # <<<<<<<<<<<<<<
 * 
 *     # Implement tie handling
 */
      __Pyx_TraceLine(1480,0,__PYX_ERR(0, 1480, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1480, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __PYX_ERR(0, 1480, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":1479
 *             sample_weight = sample_weight[valid_mask]
 *     elif nan_policy == 'raise':
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():             # <<<<<<<<<<<<<<
 *             raise ValueError("Input values contain NaNs.")
 * 
 */
    }

    /* "gofast/tools/mathex.pyx":1478
 *         if sample_weight is not None:
 *             sample_weight = sample_weight[valid_mask]
 *     elif nan_policy == 'raise':             # <<<<<<<<<<<<<<
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():
 *             raise ValueError("Input values contain NaNs.")
 */
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":1483
 * 
 *     # Implement tie handling
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']             # <<<<<<<<<<<<<<
 *     tie_method = normalize_string(
 *         tie_method, target_strs=valid_methods, raise_exception=True,
 */
  __Pyx_TraceLine(1483,0,__PYX_ERR(0, 1483, __pyx_L1_error))
  __pyx_t_1 = PyList_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1483, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_u_average);
  __Pyx_GIVEREF(__pyx_n_u_average);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_u_average)) __PYX_ERR(0, 1483, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_min);
  __Pyx_GIVEREF(__pyx_n_u_min);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 1, __pyx_n_u_min)) __PYX_ERR(0, 1483, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_max);
  __Pyx_GIVEREF(__pyx_n_u_max);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_max)) __PYX_ERR(0, 1483, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_dense);
  __Pyx_GIVEREF(__pyx_n_u_dense);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 3, __pyx_n_u_dense)) __PYX_ERR(0, 1483, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_ordinal);
  __Pyx_GIVEREF(__pyx_n_u_ordinal);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 4, __pyx_n_u_ordinal)) __PYX_ERR(0, 1483, __pyx_L1_error);
  __pyx_v_valid_methods = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1484
 *     # Implement tie handling
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     tie_method = normalize_string(             # <<<<<<<<<<<<<<
 *         tie_method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (
 */
  __Pyx_TraceLine(1484,0,__PYX_ERR(0, 1484, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_normalize_string); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1484, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":1485
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     tie_method = normalize_string(
 *         tie_method, target_strs=valid_methods, raise_exception=True,             # <<<<<<<<<<<<<<
 *         return_target_only=True, error_msg= (
 *             f"Invalid method '{tie_method}'. Expect {smart_format(valid_methods, 'or')} ")
 */
  __Pyx_TraceLine(1485,0,__PYX_ERR(0, 1485, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1484, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_tie_method);
  __Pyx_GIVEREF(__pyx_v_tie_method);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_tie_method)) __PYX_ERR(0, 1484, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1485, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_target_strs, __pyx_v_valid_methods) < 0) __PYX_ERR(0, 1485, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_raise_exception, Py_True) < 0) __PYX_ERR(0, 1485, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1486
 *     tie_method = normalize_string(
 *         tie_method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (             # <<<<<<<<<<<<<<
 *             f"Invalid method '{tie_method}'. Expect {smart_format(valid_methods, 'or')} ")
 *         )
 */
  __Pyx_TraceLine(1486,0,__PYX_ERR(0, 1486, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return_target_only, Py_True) < 0) __PYX_ERR(0, 1485, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1487
 *         tie_method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (
 *             f"Invalid method '{tie_method}'. Expect {smart_format(valid_methods, 'or')} ")             # <<<<<<<<<<<<<<
 *         )
 *     # Rank data with specified tie handling method
 */
  __Pyx_TraceLine(1487,0,__PYX_ERR(0, 1487, __pyx_L1_error))
  __pyx_t_5 = PyTuple_New(5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1487, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_9 = 0;
  __pyx_t_10 = 127;
  __Pyx_INCREF(__pyx_kp_u_Invalid_method);
  __pyx_t_9 += 16;
  __Pyx_GIVEREF(__pyx_kp_u_Invalid_method);
  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_kp_u_Invalid_method);
  __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_v_tie_method, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1487, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_10 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_10) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_10;
  __pyx_t_9 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_4);
  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4);
  __pyx_t_4 = 0;
  __Pyx_INCREF(__pyx_kp_u_Expect);
  __pyx_t_9 += 10;
  __Pyx_GIVEREF(__pyx_kp_u_Expect);
  PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_kp_u_Expect);
  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_smart_format); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1487, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_11))) {
    __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
    if (likely(__pyx_t_12)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
      __Pyx_INCREF(__pyx_t_12);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_11, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_12, __pyx_v_valid_methods, __pyx_n_u_or};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1487, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  }
  __pyx_t_11 = __Pyx_PyObject_FormatSimple(__pyx_t_4, __pyx_empty_unicode); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1487, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_10 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_11) > __pyx_t_10) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_11) : __pyx_t_10;
  __pyx_t_9 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_11);
  __Pyx_GIVEREF(__pyx_t_11);
  PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_t_11);
  __pyx_t_11 = 0;
  __Pyx_INCREF(__pyx_kp_u__31);
  __pyx_t_9 += 1;
  __Pyx_GIVEREF(__pyx_kp_u__31);
  PyTuple_SET_ITEM(__pyx_t_5, 4, __pyx_kp_u__31);
  __pyx_t_11 = __Pyx_PyUnicode_Join(__pyx_t_5, 5, __pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1487, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_error_msg, __pyx_t_11) < 0) __PYX_ERR(0, 1485, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

  /* "gofast/tools/mathex.pyx":1484
 *     # Implement tie handling
 *     valid_methods = ['average', 'min', 'max', 'dense', 'ordinal']
 *     tie_method = normalize_string(             # <<<<<<<<<<<<<<
 *         tie_method, target_strs=valid_methods, raise_exception=True,
 *         return_target_only=True, error_msg= (
 */
  __Pyx_TraceLine(1484,0,__PYX_ERR(0, 1484, __pyx_L1_error))
  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1484, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_tie_method, __pyx_t_11);
  __pyx_t_11 = 0;

  /* "gofast/tools/mathex.pyx":1490
 *         )
 *     # Rank data with specified tie handling method
 *     ranks_true = rankdata(y_true, method=tie_method)             # <<<<<<<<<<<<<<
 *     ranks_pred = rankdata(y_pred, method=tie_method)
 * 
 */
  __Pyx_TraceLine(1490,0,__PYX_ERR(0, 1490, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_rankdata); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_y_true)) __PYX_ERR(0, 1490, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_method, __pyx_v_tie_method) < 0) __PYX_ERR(0, 1490, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ranks_true = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1491
 *     # Rank data with specified tie handling method
 *     ranks_true = rankdata(y_true, method=tie_method)
 *     ranks_pred = rankdata(y_pred, method=tie_method)             # <<<<<<<<<<<<<<
 * 
 *     if control_vars is not None:
 */
  __Pyx_TraceLine(1491,0,__PYX_ERR(0, 1491, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_rankdata); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_pred)) __PYX_ERR(0, 1491, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_method, __pyx_v_tie_method) < 0) __PYX_ERR(0, 1491, __pyx_L1_error)
  __pyx_t_11 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_ranks_pred = __pyx_t_11;
  __pyx_t_11 = 0;

  /* "gofast/tools/mathex.pyx":1493
 *     ranks_pred = rankdata(y_pred, method=tie_method)
 * 
 *     if control_vars is not None:             # <<<<<<<<<<<<<<
 *         ranks_true, ranks_pred = adjust_for_control_vars (
 *             ranks_true, ranks_pred, control_vars )
 */
  __Pyx_TraceLine(1493,0,__PYX_ERR(0, 1493, __pyx_L1_error))
  __pyx_t_6 = (__pyx_v_control_vars != Py_None);
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":1494
 * 
 *     if control_vars is not None:
 *         ranks_true, ranks_pred = adjust_for_control_vars (             # <<<<<<<<<<<<<<
 *             ranks_true, ranks_pred, control_vars )
 * 
 */
    __Pyx_TraceLine(1494,0,__PYX_ERR(0, 1494, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_adjust_for_control_vars); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1494, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "gofast/tools/mathex.pyx":1495
 *     if control_vars is not None:
 *         ranks_true, ranks_pred = adjust_for_control_vars (
 *             ranks_true, ranks_pred, control_vars )             # <<<<<<<<<<<<<<
 * 
 *     # Compute weighted Spearman's rank correlation
 */
    __Pyx_TraceLine(1495,0,__PYX_ERR(0, 1495, __pyx_L1_error))
    __pyx_t_2 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_2, __pyx_v_ranks_true, __pyx_v_ranks_pred, __pyx_v_control_vars};
      __pyx_t_11 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 3+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1494, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_11))) || (PyList_CheckExact(__pyx_t_11))) {
      PyObject* sequence = __pyx_t_11;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 1494, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      #else
      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1494, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1494, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      #endif
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_1 = PyObject_GetIter(__pyx_t_11); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1494, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_13 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
      index = 0; __pyx_t_3 = __pyx_t_13(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L9_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      index = 1; __pyx_t_2 = __pyx_t_13(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L9_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_2);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_13(__pyx_t_1), 2) < 0) __PYX_ERR(0, 1494, __pyx_L1_error)
      __pyx_t_13 = NULL;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L10_unpacking_done;
      __pyx_L9_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_13 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 1494, __pyx_L1_error)
      __pyx_L10_unpacking_done:;
    }

    /* "gofast/tools/mathex.pyx":1494
 * 
 *     if control_vars is not None:
 *         ranks_true, ranks_pred = adjust_for_control_vars (             # <<<<<<<<<<<<<<
 *             ranks_true, ranks_pred, control_vars )
 * 
 */
    __Pyx_TraceLine(1494,0,__PYX_ERR(0, 1494, __pyx_L1_error))
    __Pyx_DECREF_SET(__pyx_v_ranks_true, __pyx_t_3);
    __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_ranks_pred, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1493
 *     ranks_pred = rankdata(y_pred, method=tie_method)
 * 
 *     if control_vars is not None:             # <<<<<<<<<<<<<<
 *         ranks_true, ranks_pred = adjust_for_control_vars (
 *             ranks_true, ranks_pred, control_vars )
 */
  }

  /* "gofast/tools/mathex.pyx":1499
 *     # Compute weighted Spearman's rank correlation
 *     # if sample_weight is provided
 *     if sample_weight is not None:             # <<<<<<<<<<<<<<
 *         corr = _weighted_spearman_corr(ranks_true, ranks_pred, sample_weight)
 *     else:
 */
  __Pyx_TraceLine(1499,0,__PYX_ERR(0, 1499, __pyx_L1_error))
  __pyx_t_6 = (__pyx_v_sample_weight != Py_None);
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":1500
 *     # if sample_weight is provided
 *     if sample_weight is not None:
 *         corr = _weighted_spearman_corr(ranks_true, ranks_pred, sample_weight)             # <<<<<<<<<<<<<<
 *     else:
 *         corr = np.corrcoef(ranks_true, ranks_pred)[0, 1]
 */
    __Pyx_TraceLine(1500,0,__PYX_ERR(0, 1500, __pyx_L1_error))
    __pyx_t_11 = __pyx_pf_6gofast_5tools_6mathex_18_compute_spearmanr__weighted_spearman_corr(__pyx_v__weighted_spearman_corr, __pyx_v_ranks_true, __pyx_v_ranks_pred, __pyx_v_sample_weight); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1500, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_v_corr = __pyx_t_11;
    __pyx_t_11 = 0;

    /* "gofast/tools/mathex.pyx":1499
 *     # Compute weighted Spearman's rank correlation
 *     # if sample_weight is provided
 *     if sample_weight is not None:             # <<<<<<<<<<<<<<
 *         corr = _weighted_spearman_corr(ranks_true, ranks_pred, sample_weight)
 *     else:
 */
    goto __pyx_L11;
  }

  /* "gofast/tools/mathex.pyx":1502
 *         corr = _weighted_spearman_corr(ranks_true, ranks_pred, sample_weight)
 *     else:
 *         corr = np.corrcoef(ranks_true, ranks_pred)[0, 1]             # <<<<<<<<<<<<<<
 *     return corr
 * 
 */
  __Pyx_TraceLine(1502,0,__PYX_ERR(0, 1502, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_corrcoef); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_ranks_true, __pyx_v_ranks_pred};
      __pyx_t_11 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1502, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_11, __pyx_tuple__13); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1502, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_v_corr = __pyx_t_3;
    __pyx_t_3 = 0;
  }
  __pyx_L11:;

  /* "gofast/tools/mathex.pyx":1503
 *     else:
 *         corr = np.corrcoef(ranks_true, ranks_pred)[0, 1]
 *     return corr             # <<<<<<<<<<<<<<
 * 
 * def adjust_for_control_vars(y_true:ArrayLike, y_pred:ArrayLike, control_vars:Optional[Union[ArrayLike, List[ArrayLike]]]=None):
 */
  __Pyx_TraceLine(1503,0,__PYX_ERR(0, 1503, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_corr);
  __pyx_r = __pyx_v_corr;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1441
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)
 * 
 * def _compute_spearmanr(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight, tie_method, nan_policy, control_vars):
 *     # The key addition is the handling of multioutput by reshaping inputs if
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("gofast.tools.mathex._compute_spearmanr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v__weighted_spearman_corr);
  __Pyx_XDECREF(__pyx_v_valid_policies);
  __Pyx_XDECREF(__pyx_v_valid_mask);
  __Pyx_XDECREF(__pyx_v_valid_methods);
  __Pyx_XDECREF(__pyx_v_ranks_true);
  __Pyx_XDECREF(__pyx_v_ranks_pred);
  __Pyx_XDECREF(__pyx_v_corr);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_sample_weight);
  __Pyx_XDECREF(__pyx_v_tie_method);
  __Pyx_XDECREF(__pyx_v_nan_policy);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1505
 *     return corr
 * 
 * def adjust_for_control_vars(y_true:ArrayLike, y_pred:ArrayLike, control_vars:Optional[Union[ArrayLike, List[ArrayLike]]]=None):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts y_true and y_pred for either regression or classification tasks by
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_35adjust_for_control_vars(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_34adjust_for_control_vars, "\n    Adjusts y_true and y_pred for either regression or classification tasks by \n    removing the influence of control variables. \n    \n    The function serves as a wrapper that decides the adjustment strategy \n    based on the type of task (regression or classification) inferred from y_true.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True target values. The nature of these values (continuous for regression or \n        categorical for classification) determines the adjustment strategy.\n    y_pred : array-like\n        Predicted target values. Must have the same shape as `y_true`.\n    control_vars : array-like or list of array-likes, optional\n        Control variables to adjust for. Can be a single array or a list of arrays. \n        If None, no adjustment is performed.\n\n    Returns\n    -------\n    adjusted_y_true : ndarray\n        Adjusted true target values, with the influence of control variables \n        removed.\n    adjusted_y_pred : ndarray\n        Adjusted predicted target values, with the influence of control \n        variables removed.\n\n    Notes\n    -----\n    The function dynamically determines whether the targets suggest a \n    regression or classification task and applies the appropriate adjustment\n    method. For regression, the adjustment involves residualizing the targets \n    against the control variables. \n    For classification, the approach might involve stratification or other \n    methods to control for the variables' influence.\n\n    In practice, this adjustment is crucial when control variables might \n    confound or otherwise influence the relationship between the predictors \n    and the target variable, potentially biasing the correlation measure.\n\n    Examples\n    --------\n    >>> y_true = np.array([1, 2, 3, 4])\n    >>> y_pred = np.array([1.1, 1.9, 3.2, 3.8])\n    >>> control_vars = np.array([1, 1, 2, 2])\n    >>> adjusted_y_true, adjusted_y_pred = adjust_for_control_vars(\n    ..."" y_true, y_pred, control_vars)\n    # Adjusted values depend on the specific implementation for regression\n    or classification.\n\n    See Also\n    --------\n    adjust_for_control_vars_regression : \n        Function to adjust targets in a regression task.\n    adjust_for_control_vars_classification : \n        Function to adjust targets in a classification task.\n\n    References\n    ----------\n    .. [1] K. Pearson, \"On the theory of contingency and its relation to \n           association and normal correlation,\" Drapers' Company Research \n           Memoirs (Biometric Series I), London, 1904.\n    .. [2] D. C. Montgomery, E. A. Peck, and G. G. Vining, \"Introduction to\n           Linear Regression Analysis,\" 5th ed., Wiley, 2012.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_35adjust_for_control_vars = {"adjust_for_control_vars", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_35adjust_for_control_vars, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_34adjust_for_control_vars};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_35adjust_for_control_vars(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_control_vars = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("adjust_for_control_vars (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_control_vars,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1505, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1505, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars", 0, 2, 3, 1); __PYX_ERR(0, 1505, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_control_vars);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1505, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "adjust_for_control_vars") < 0)) __PYX_ERR(0, 1505, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_control_vars = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars", 0, 2, 3, __pyx_nargs); __PYX_ERR(0, 1505, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.adjust_for_control_vars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_34adjust_for_control_vars(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_control_vars);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_34adjust_for_control_vars(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_control_vars) {
  PyObject *__pyx_v_adjusted_y_true = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *(*__pyx_t_7)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__37)
  __Pyx_RefNannySetupContext("adjust_for_control_vars", 0);
  __Pyx_TraceCall("adjust_for_control_vars", __pyx_f[0], 1505, 0, __PYX_ERR(0, 1505, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_control_vars);

  /* "gofast/tools/mathex.pyx":1571
 *            Linear Regression Analysis," 5th ed., Wiley, 2012.
 *     """
 *     if control_vars is None:             # <<<<<<<<<<<<<<
 *         return y_true, y_pred
 *     # Convert control_vars to numpy array if not already
 */
  __Pyx_TraceLine(1571,0,__PYX_ERR(0, 1571, __pyx_L1_error))
  __pyx_t_1 = (__pyx_v_control_vars == Py_None);
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":1572
 *     """
 *     if control_vars is None:
 *         return y_true, y_pred             # <<<<<<<<<<<<<<
 *     # Convert control_vars to numpy array if not already
 *     control_vars = np.asarray(control_vars)
 */
    __Pyx_TraceLine(1572,0,__PYX_ERR(0, 1572, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1572, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 1572, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_pred);
    __Pyx_GIVEREF(__pyx_v_y_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1572, __pyx_L1_error);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1571
 *            Linear Regression Analysis," 5th ed., Wiley, 2012.
 *     """
 *     if control_vars is None:             # <<<<<<<<<<<<<<
 *         return y_true, y_pred
 *     # Convert control_vars to numpy array if not already
 */
  }

  /* "gofast/tools/mathex.pyx":1574
 *         return y_true, y_pred
 *     # Convert control_vars to numpy array if not already
 *     control_vars = np.asarray(control_vars)             # <<<<<<<<<<<<<<
 * 
 *     # statistical method suitable for the specific use case.
 */
  __Pyx_TraceLine(1574,0,__PYX_ERR(0, 1574, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1574, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1574, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_control_vars};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1574, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_control_vars, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1577
 * 
 *     # statistical method suitable for the specific use case.
 *     if type_of_target(y_true) =='continuous':             # <<<<<<<<<<<<<<
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_regression(
 *             y_true, y_pred, control_vars)
 */
  __Pyx_TraceLine(1577,0,__PYX_ERR(0, 1577, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_type_of_target); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1577, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1577, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_t_2, __pyx_n_u_continuous, Py_EQ)); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 1577, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":1578
 *     # statistical method suitable for the specific use case.
 *     if type_of_target(y_true) =='continuous':
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_regression(             # <<<<<<<<<<<<<<
 *             y_true, y_pred, control_vars)
 *     else:
 */
    __Pyx_TraceLine(1578,0,__PYX_ERR(0, 1578, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_adjust_for_control_vars_regressi); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1578, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);

    /* "gofast/tools/mathex.pyx":1579
 *     if type_of_target(y_true) =='continuous':
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_regression(
 *             y_true, y_pred, control_vars)             # <<<<<<<<<<<<<<
 *     else:
 *         # is classification
 */
    __Pyx_TraceLine(1579,0,__PYX_ERR(0, 1579, __pyx_L1_error))
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_3, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_control_vars};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1578, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 1578, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      #else
      __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1578, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1578, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_6 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1578, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6);
      index = 0; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L5_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      index = 1; __pyx_t_3 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 1578, __pyx_L1_error)
      __pyx_t_7 = NULL;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L6_unpacking_done;
      __pyx_L5_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 1578, __pyx_L1_error)
      __pyx_L6_unpacking_done:;
    }

    /* "gofast/tools/mathex.pyx":1578
 *     # statistical method suitable for the specific use case.
 *     if type_of_target(y_true) =='continuous':
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_regression(             # <<<<<<<<<<<<<<
 *             y_true, y_pred, control_vars)
 *     else:
 */
    __Pyx_TraceLine(1578,0,__PYX_ERR(0, 1578, __pyx_L1_error))
    __pyx_v_adjusted_y_true = __pyx_t_4;
    __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_adjusted_y_true, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1577
 * 
 *     # statistical method suitable for the specific use case.
 *     if type_of_target(y_true) =='continuous':             # <<<<<<<<<<<<<<
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_regression(
 *             y_true, y_pred, control_vars)
 */
    goto __pyx_L4;
  }

  /* "gofast/tools/mathex.pyx":1582
 *     else:
 *         # is classification
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_classification(             # <<<<<<<<<<<<<<
 *             y_true, y_pred, control_vars)
 * 
 */
  __Pyx_TraceLine(1582,0,__PYX_ERR(0, 1582, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_adjust_for_control_vars_classifi); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1582, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "gofast/tools/mathex.pyx":1583
 *         # is classification
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_classification(
 *             y_true, y_pred, control_vars)             # <<<<<<<<<<<<<<
 * 
 *     return adjusted_y_true, adjusted_y_true
 */
    __Pyx_TraceLine(1583,0,__PYX_ERR(0, 1583, __pyx_L1_error))
    __pyx_t_4 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_4, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_control_vars};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 3+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 1582, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_6 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1582, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6);
      index = 0; __pyx_t_3 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_3)) goto __pyx_L7_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      index = 1; __pyx_t_4 = __pyx_t_7(__pyx_t_6); if (unlikely(!__pyx_t_4)) goto __pyx_L7_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_7(__pyx_t_6), 2) < 0) __PYX_ERR(0, 1582, __pyx_L1_error)
      __pyx_t_7 = NULL;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      goto __pyx_L8_unpacking_done;
      __pyx_L7_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 1582, __pyx_L1_error)
      __pyx_L8_unpacking_done:;
    }

    /* "gofast/tools/mathex.pyx":1582
 *     else:
 *         # is classification
 *         adjusted_y_true, adjusted_y_true = adjust_for_control_vars_classification(             # <<<<<<<<<<<<<<
 *             y_true, y_pred, control_vars)
 * 
 */
    __Pyx_TraceLine(1582,0,__PYX_ERR(0, 1582, __pyx_L1_error))
    __pyx_v_adjusted_y_true = __pyx_t_3;
    __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_adjusted_y_true, __pyx_t_4);
    __pyx_t_4 = 0;
  }
  __pyx_L4:;

  /* "gofast/tools/mathex.pyx":1585
 *             y_true, y_pred, control_vars)
 * 
 *     return adjusted_y_true, adjusted_y_true             # <<<<<<<<<<<<<<
 * 
 * def adjust_for_control_vars_regression(y_true:ArrayLike, y_pred: ArrayLike, control_vars: Union[ArrayLike, List[ArrayLike]]):
 */
  __Pyx_TraceLine(1585,0,__PYX_ERR(0, 1585, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_adjusted_y_true);
  __Pyx_GIVEREF(__pyx_v_adjusted_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_adjusted_y_true)) __PYX_ERR(0, 1585, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_adjusted_y_true);
  __Pyx_GIVEREF(__pyx_v_adjusted_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_adjusted_y_true)) __PYX_ERR(0, 1585, __pyx_L1_error);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1505
 *     return corr
 * 
 * def adjust_for_control_vars(y_true:ArrayLike, y_pred:ArrayLike, control_vars:Optional[Union[ArrayLike, List[ArrayLike]]]=None):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts y_true and y_pred for either regression or classification tasks by
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.adjust_for_control_vars", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_adjusted_y_true);
  __Pyx_XDECREF(__pyx_v_control_vars);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1587
 *     return adjusted_y_true, adjusted_y_true
 * 
 * def adjust_for_control_vars_regression(y_true:ArrayLike, y_pred: ArrayLike, control_vars: Union[ArrayLike, List[ArrayLike]]):             # <<<<<<<<<<<<<<
 *     """
 *     Adjust y_true and y_pred for regression tasks by accounting for the influence
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_37adjust_for_control_vars_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_36adjust_for_control_vars_regression, "\n    Adjust y_true and y_pred for regression tasks by accounting for the influence\n    of specified control variables through residualization.\n\n    This approach fits a linear model to predict y_true and y_pred solely based on\n    control variables, and then computes the residuals. These residuals represent\n    the portion of y_true and y_pred that cannot be explained by the control\n    variables, effectively isolating the effect of the predictors of interest.\n\n    Parameters\n    ----------\n    y_true : array-like of shape (n_samples,)\n        True target values for regression.\n    y_pred : array-like of shape (n_samples,)\n        Predicted target values for regression.\n    control_vars : array-like or list of array-likes\n        Control variables to adjust for. Can be a single array or a list of arrays.\n\n    Returns\n    -------\n    adjusted_y_true : ndarray of shape (n_samples,)\n        Adjusted true target values, with the influence of control variables removed.\n    adjusted_y_pred : ndarray of shape (n_samples,)\n        Adjusted predicted target values, with the influence of control variables removed.\n\n    Raises\n    ------\n    ValueError\n        If y_true or y_pred are not 1-dimensional arrays.\n\n    Notes\n    -----\n    This function uses LinearRegression from sklearn.linear_model to fit models\n    predicting y_true and y_pred from the control variables. The residuals from\n    these models (the differences between the observed and predicted values) are\n    the adjusted targets.\n\n    The mathematical concept behind this adjustment is as follows:\n    \n    .. math::\n        \text{adjusted\\_y} = y - \\hat{y}_{\text{control}}\n        \n    where :math:`\\hat{y}_{\text{control}}` is the prediction from a linear model\n    trained only on the control variables.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import adjust_for_control_vars_regression\n    >>> y_true = np.array([3, 5, 7, 9])\n    >>> y_pred = np.ar""ray([4, 6, 8, 10])\n    >>> control_vars = np.array([1, 2, 3, 4])\n    >>> adjusted_y_true, adjusted_y_pred = adjust_for_control_vars_regression(\n    ... y_true, y_pred, control_vars)\n    >>> print(adjusted_y_true)\n    >>> print(adjusted_y_pred)\n\n    References\n    ----------\n    .. [1] Freedman, D. A. (2009). Statistical Models: Theory and Practice. \n          Cambridge University Press.\n    \n    See Also\n    --------\n    sklearn.linear_model.LinearRegression\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_37adjust_for_control_vars_regression = {"adjust_for_control_vars_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_37adjust_for_control_vars_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_36adjust_for_control_vars_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_37adjust_for_control_vars_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_control_vars = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("adjust_for_control_vars_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_control_vars,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1587, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1587, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars_regression", 1, 3, 3, 1); __PYX_ERR(0, 1587, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_control_vars)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1587, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars_regression", 1, 3, 3, 2); __PYX_ERR(0, 1587, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "adjust_for_control_vars_regression") < 0)) __PYX_ERR(0, 1587, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_control_vars = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars_regression", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 1587, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.adjust_for_control_vars_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_36adjust_for_control_vars_regression(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_control_vars);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_36adjust_for_control_vars_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_control_vars) {
  PyObject *__pyx_v_LinearRegression = NULL;
  PyObject *__pyx_v_model_true = NULL;
  PyObject *__pyx_v_residuals_true = NULL;
  PyObject *__pyx_v_model_pred = NULL;
  PyObject *__pyx_v_residuals_pred = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__38)
  __Pyx_RefNannySetupContext("adjust_for_control_vars_regression", 0);
  __Pyx_TraceCall("adjust_for_control_vars_regression", __pyx_f[0], 1587, 0, __PYX_ERR(0, 1587, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_control_vars);

  /* "gofast/tools/mathex.pyx":1653
 *     sklearn.linear_model.LinearRegression
 *     """
 *     from sklearn.linear_model import LinearRegression             # <<<<<<<<<<<<<<
 *     # Convert inputs to numpy arrays for consistency
 *     y_true = np.asarray(y_true)
 */
  __Pyx_TraceLine(1653,0,__PYX_ERR(0, 1653, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1653, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_LinearRegression);
  __Pyx_GIVEREF(__pyx_n_s_LinearRegression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_LinearRegression)) __PYX_ERR(0, 1653, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_sklearn_linear_model, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1653, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_LinearRegression); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1653, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_LinearRegression = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1655
 *     from sklearn.linear_model import LinearRegression
 *     # Convert inputs to numpy arrays for consistency
 *     y_true = np.asarray(y_true)             # <<<<<<<<<<<<<<
 *     y_pred = np.asarray(y_pred)
 *     control_vars = np.asarray(control_vars)
 */
  __Pyx_TraceLine(1655,0,__PYX_ERR(0, 1655, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_y_true};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1656
 *     # Convert inputs to numpy arrays for consistency
 *     y_true = np.asarray(y_true)
 *     y_pred = np.asarray(y_pred)             # <<<<<<<<<<<<<<
 *     control_vars = np.asarray(control_vars)
 * 
 */
  __Pyx_TraceLine(1656,0,__PYX_ERR(0, 1656, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_asarray); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_pred};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1656, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1657
 *     y_true = np.asarray(y_true)
 *     y_pred = np.asarray(y_pred)
 *     control_vars = np.asarray(control_vars)             # <<<<<<<<<<<<<<
 * 
 *     # Ensure the task is appropriate for the data
 */
  __Pyx_TraceLine(1657,0,__PYX_ERR(0, 1657, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1657, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_control_vars};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1657, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_control_vars, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1660
 * 
 *     # Ensure the task is appropriate for the data
 *     if y_true.ndim > 1 or y_pred.ndim > 1:             # <<<<<<<<<<<<<<
 *         raise ValueError(
 *             "y_true and y_pred should be 1-dimensional arrays for regression tasks.")
 */
  __Pyx_TraceLine(1660,0,__PYX_ERR(0, 1660, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_y_true, __pyx_n_s_ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1660, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1660, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 1660, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (!__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_y_pred, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1660, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyObject_RichCompare(__pyx_t_3, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1660, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 1660, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_t_6;
  __pyx_L4_bool_binop_done:;
  if (unlikely(__pyx_t_5)) {

    /* "gofast/tools/mathex.pyx":1661
 *     # Ensure the task is appropriate for the data
 *     if y_true.ndim > 1 or y_pred.ndim > 1:
 *         raise ValueError(             # <<<<<<<<<<<<<<
 *             "y_true and y_pred should be 1-dimensional arrays for regression tasks.")
 * 
 */
    __Pyx_TraceLine(1661,0,__PYX_ERR(0, 1661, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1661, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 1661, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":1660
 * 
 *     # Ensure the task is appropriate for the data
 *     if y_true.ndim > 1 or y_pred.ndim > 1:             # <<<<<<<<<<<<<<
 *         raise ValueError(
 *             "y_true and y_pred should be 1-dimensional arrays for regression tasks.")
 */
  }

  /* "gofast/tools/mathex.pyx":1664
 *             "y_true and y_pred should be 1-dimensional arrays for regression tasks.")
 * 
 *     if control_vars is None or len(control_vars) == 0:             # <<<<<<<<<<<<<<
 *         # No adjustment needed if there are no control variables
 *         return y_true, y_pred
 */
  __Pyx_TraceLine(1664,0,__PYX_ERR(0, 1664, __pyx_L1_error))
  __pyx_t_6 = (__pyx_v_control_vars == Py_None);
  if (!__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_7 = PyObject_Length(__pyx_v_control_vars); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1664, __pyx_L1_error)
  __pyx_t_6 = (__pyx_t_7 == 0);
  __pyx_t_5 = __pyx_t_6;
  __pyx_L7_bool_binop_done:;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1666
 *     if control_vars is None or len(control_vars) == 0:
 *         # No adjustment needed if there are no control variables
 *         return y_true, y_pred             # <<<<<<<<<<<<<<
 * 
 *     # Check if control_vars is a single array; if so,
 */
    __Pyx_TraceLine(1666,0,__PYX_ERR(0, 1666, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1666, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_y_true);
    __Pyx_GIVEREF(__pyx_v_y_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 1666, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_pred);
    __Pyx_GIVEREF(__pyx_v_y_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1666, __pyx_L1_error);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1664
 *             "y_true and y_pred should be 1-dimensional arrays for regression tasks.")
 * 
 *     if control_vars is None or len(control_vars) == 0:             # <<<<<<<<<<<<<<
 *         # No adjustment needed if there are no control variables
 *         return y_true, y_pred
 */
  }

  /* "gofast/tools/mathex.pyx":1670
 *     # Check if control_vars is a single array; if so,
 *     # reshape for sklearn compatibility
 *     if control_vars.ndim == 1:             # <<<<<<<<<<<<<<
 *         control_vars = control_vars.reshape(-1, 1)
 * 
 */
  __Pyx_TraceLine(1670,0,__PYX_ERR(0, 1670, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_control_vars, __pyx_n_s_ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_2, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1670, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1671
 *     # reshape for sklearn compatibility
 *     if control_vars.ndim == 1:
 *         control_vars = control_vars.reshape(-1, 1)             # <<<<<<<<<<<<<<
 * 
 *     # Adjust y_true based on control variables
 */
    __Pyx_TraceLine(1671,0,__PYX_ERR(0, 1671, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_control_vars, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1671, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_control_vars, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1670
 *     # Check if control_vars is a single array; if so,
 *     # reshape for sklearn compatibility
 *     if control_vars.ndim == 1:             # <<<<<<<<<<<<<<
 *         control_vars = control_vars.reshape(-1, 1)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":1674
 * 
 *     # Adjust y_true based on control variables
 *     model_true = LinearRegression().fit(control_vars, y_true)             # <<<<<<<<<<<<<<
 *     residuals_true = y_true - model_true.predict(control_vars)
 * 
 */
  __Pyx_TraceLine(1674,0,__PYX_ERR(0, 1674, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_LinearRegression);
  __pyx_t_1 = __pyx_v_LinearRegression; __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1674, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_fit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1674, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_control_vars, __pyx_v_y_true};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1674, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_model_true = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1675
 *     # Adjust y_true based on control variables
 *     model_true = LinearRegression().fit(control_vars, y_true)
 *     residuals_true = y_true - model_true.predict(control_vars)             # <<<<<<<<<<<<<<
 * 
 *     # Adjust y_pred based on control variables
 */
  __Pyx_TraceLine(1675,0,__PYX_ERR(0, 1675, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_model_true, __pyx_n_s_predict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1675, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_control_vars};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1675, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_y_true, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1675, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_residuals_true = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1678
 * 
 *     # Adjust y_pred based on control variables
 *     model_pred = LinearRegression().fit(control_vars, y_pred)             # <<<<<<<<<<<<<<
 *     residuals_pred = y_pred - model_pred.predict(control_vars)
 * 
 */
  __Pyx_TraceLine(1678,0,__PYX_ERR(0, 1678, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_LinearRegression);
  __pyx_t_2 = __pyx_v_LinearRegression; __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, NULL};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_fit); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1678, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_control_vars, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_model_pred = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1679
 *     # Adjust y_pred based on control variables
 *     model_pred = LinearRegression().fit(control_vars, y_pred)
 *     residuals_pred = y_pred - model_pred.predict(control_vars)             # <<<<<<<<<<<<<<
 * 
 *     return residuals_true, residuals_pred
 */
  __Pyx_TraceLine(1679,0,__PYX_ERR(0, 1679, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_model_pred, __pyx_n_s_predict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_control_vars};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1679, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_y_pred, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_residuals_pred = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1681
 *     residuals_pred = y_pred - model_pred.predict(control_vars)
 * 
 *     return residuals_true, residuals_pred             # <<<<<<<<<<<<<<
 * 
 * def adjust_for_control_vars_classification(y_true:ArrayLike, y_pred:ArrayLike, control_vars:DataFrame):
 */
  __Pyx_TraceLine(1681,0,__PYX_ERR(0, 1681, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1681, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_residuals_true);
  __Pyx_GIVEREF(__pyx_v_residuals_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_residuals_true)) __PYX_ERR(0, 1681, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_residuals_pred);
  __Pyx_GIVEREF(__pyx_v_residuals_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_residuals_pred)) __PYX_ERR(0, 1681, __pyx_L1_error);
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1587
 *     return adjusted_y_true, adjusted_y_true
 * 
 * def adjust_for_control_vars_regression(y_true:ArrayLike, y_pred: ArrayLike, control_vars: Union[ArrayLike, List[ArrayLike]]):             # <<<<<<<<<<<<<<
 *     """
 *     Adjust y_true and y_pred for regression tasks by accounting for the influence
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex.adjust_for_control_vars_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_LinearRegression);
  __Pyx_XDECREF(__pyx_v_model_true);
  __Pyx_XDECREF(__pyx_v_residuals_true);
  __Pyx_XDECREF(__pyx_v_model_pred);
  __Pyx_XDECREF(__pyx_v_residuals_pred);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_control_vars);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1683
 *     return residuals_true, residuals_pred
 * 
 * def adjust_for_control_vars_classification(y_true:ArrayLike, y_pred:ArrayLike, control_vars:DataFrame):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts `y_true` and `y_pred` in a classification task by stratifying the
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_39adjust_for_control_vars_classification(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_38adjust_for_control_vars_classification, "\n    Adjusts `y_true` and `y_pred` in a classification task by stratifying the\n    data based on control variables. It optionally applies logistic regression\n    within each stratum  for adjustment, aiming to refine predictions based \n    on the influence of control variables.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True class labels. Must be a 1D array of classification targets.\n    y_pred : array-like\n        Predicted class labels, corresponding to `y_true`. Must be of the \n        same shape as `y_true`.\n    control_vars : pandas.DataFrame\n        DataFrame containing one or more columns that represent control \n        variables. These variables are used to stratify the data before \n        applying any adjustment logic.\n\n    Returns\n    -------\n    adjusted_y_true : numpy.ndarray\n        Adjusted array of true class labels, same as input `y_true` \n        (adjustment process does not alter true labels).\n    adjusted_y_pred : numpy.ndarray\n        Adjusted array of predicted class labels after considering the \n        stratification by control variables.\n\n    Notes\n    -----\n    This function aims to account for potential confounders or additional\n    information represented by control variables.\n    Logistic regression is utilized within each stratum defined by unique \n    combinations of control variables to adjust predictions.\n    The essence is to mitigate the influence of control variables on the \n    prediction outcomes, thereby potentially enhancing the prediction accuracy\n    or fairness across different groups.\n\n    The adjustment is particularly useful in scenarios where control variables\n    significantly influence the target variable, and their effects need to be\n    isolated from the primary predictive modeling process.\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex import adjust_for_control_vars_classification\n    >>> y_true = [0, 1, 0, 1]\n    >>> y_pred = [0, 0, 1, 1]""\n    >>> control_vars = pd.DataFrame({'age': [25, 30, 35, 40], 'gender': [0, 1, 0, 1]})\n    >>> adjusted_y_true, adjusted_y_pred = adjust_for_control_vars_classification(\n    ... y_true, y_pred, control_vars)\n    >>> print(adjusted_y_pred)\n    [0 0 1 1]\n\n    The function does not modify `y_true` but adjusts `y_pred` based on \n    logistic regression adjustments within each stratum defined by \n    `control_vars`.\n\n    See Also\n    --------\n    sklearn.metrics.classification_report : Compute precision, recall,\n        F-measure and support for each class.\n    sklearn.preprocessing.LabelEncoder : \n        Encode target labels with value between 0 and n_classes-1.\n    sklearn.linear_model.LogisticRegression : \n        Logistic Regression (aka logit, MaxEnt) classifier.\n\n    References\n    ----------\n    .. [2] J. D. Hunter. \"Matplotlib: A 2D graphics environment\", \n           Computing in Science & Engineering, vol. 9, no. 3, pp. 90-95, 2007.\n    .. [1] F. Pedregosa et al., \"Scikit-learn: Machine Learning in Python\",\n           Journal of Machine Learning Research, vol. 12, pp. 2825-2830, 2011.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_39adjust_for_control_vars_classification = {"adjust_for_control_vars_classification", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_39adjust_for_control_vars_classification, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_38adjust_for_control_vars_classification};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_39adjust_for_control_vars_classification(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_control_vars = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("adjust_for_control_vars_classification (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_control_vars,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1683, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1683, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars_classification", 1, 3, 3, 1); __PYX_ERR(0, 1683, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_control_vars)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1683, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars_classification", 1, 3, 3, 2); __PYX_ERR(0, 1683, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "adjust_for_control_vars_classification") < 0)) __PYX_ERR(0, 1683, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_control_vars = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("adjust_for_control_vars_classification", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 1683, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.adjust_for_control_vars_classification", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_38adjust_for_control_vars_classification(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_control_vars);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_38adjust_for_control_vars_classification(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_control_vars) {
  PyObject *__pyx_v_LogisticRegression = NULL;
  PyObject *__pyx_v_LabelEncoder = NULL;
  PyObject *__pyx_v_data = NULL;
  PyObject *__pyx_v_col = NULL;
  PyObject *__pyx_v_le_true = NULL;
  PyObject *__pyx_v_le_pred = NULL;
  PyObject *__pyx_v_adjusted_preds = NULL;
  CYTHON_UNUSED PyObject *__pyx_v__ = NULL;
  PyObject *__pyx_v_group = NULL;
  PyObject *__pyx_v_lr = NULL;
  PyObject *__pyx_v_adjusted_pred = NULL;
  PyObject *__pyx_v_adjusted_y_pred = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__42)
  __Pyx_RefNannySetupContext("adjust_for_control_vars_classification", 0);
  __Pyx_TraceCall("adjust_for_control_vars_classification", __pyx_f[0], 1683, 0, __PYX_ERR(0, 1683, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);

  /* "gofast/tools/mathex.pyx":1756
 *            Journal of Machine Learning Research, vol. 12, pp. 2825-2830, 2011.
 *     """
 *     from sklearn.linear_model import LogisticRegression             # <<<<<<<<<<<<<<
 *     from sklearn.preprocessing import LabelEncoder
 * 
 */
  __Pyx_TraceLine(1756,0,__PYX_ERR(0, 1756, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1756, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_LogisticRegression);
  __Pyx_GIVEREF(__pyx_n_s_LogisticRegression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_LogisticRegression)) __PYX_ERR(0, 1756, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_sklearn_linear_model, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1756, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_LogisticRegression); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1756, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_LogisticRegression = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1757
 *     """
 *     from sklearn.linear_model import LogisticRegression
 *     from sklearn.preprocessing import LabelEncoder             # <<<<<<<<<<<<<<
 * 
 *     # first check whether y_true and y_pred are classification data
 */
  __Pyx_TraceLine(1757,0,__PYX_ERR(0, 1757, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_LabelEncoder);
  __Pyx_GIVEREF(__pyx_n_s_LabelEncoder);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_LabelEncoder)) __PYX_ERR(0, 1757, __pyx_L1_error);
  __pyx_t_1 = __Pyx_Import(__pyx_n_s_sklearn_preprocessing, __pyx_t_2, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_1, __pyx_n_s_LabelEncoder); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_t_2);
  __pyx_v_LabelEncoder = __pyx_t_2;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1760
 * 
 *     # first check whether y_true and y_pred are classification data
 *     y_true, y_pred = check_classification_targets(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, strategy='custom logic')
 * 
 */
  __Pyx_TraceLine(1760,0,__PYX_ERR(0, 1760, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_check_classification_targets); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":1761
 *     # first check whether y_true and y_pred are classification data
 *     y_true, y_pred = check_classification_targets(
 *         y_true, y_pred, strategy='custom logic')             # <<<<<<<<<<<<<<
 * 
 *     # Ensure input is a DataFrame for easier manipulation
 */
  __Pyx_TraceLine(1761,0,__PYX_ERR(0, 1761, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_true)) __PYX_ERR(0, 1760, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1760, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_strategy, __pyx_kp_u_custom_logic) < 0) __PYX_ERR(0, 1761, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1760
 * 
 *     # first check whether y_true and y_pred are classification data
 *     y_true, y_pred = check_classification_targets(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, strategy='custom logic')
 * 
 */
  __Pyx_TraceLine(1760,0,__PYX_ERR(0, 1760, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 1760, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1760, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1760, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1760, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 1760, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 1760, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1764
 * 
 *     # Ensure input is a DataFrame for easier manipulation
 *     data = pd.DataFrame({             # <<<<<<<<<<<<<<
 *         'y_true': y_true,
 *         'y_pred': y_pred
 */
  __Pyx_TraceLine(1764,0,__PYX_ERR(0, 1764, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1764, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1764, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1765
 *     # Ensure input is a DataFrame for easier manipulation
 *     data = pd.DataFrame({
 *         'y_true': y_true,             # <<<<<<<<<<<<<<
 *         'y_pred': y_pred
 *     })
 */
  __Pyx_TraceLine(1765,0,__PYX_ERR(0, 1765, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1765, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_y_true, __pyx_v_y_true) < 0) __PYX_ERR(0, 1765, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1766
 *     data = pd.DataFrame({
 *         'y_true': y_true,
 *         'y_pred': y_pred             # <<<<<<<<<<<<<<
 *     })
 *     for col in control_vars.columns:
 */
  __Pyx_TraceLine(1766,0,__PYX_ERR(0, 1766, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_y_pred, __pyx_v_y_pred) < 0) __PYX_ERR(0, 1765, __pyx_L1_error)
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1764, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_data = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1768
 *         'y_pred': y_pred
 *     })
 *     for col in control_vars.columns:             # <<<<<<<<<<<<<<
 *         data[col] = control_vars[col]
 * 
 */
  __Pyx_TraceLine(1768,0,__PYX_ERR(0, 1768, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_control_vars, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1768, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
    __pyx_t_3 = __pyx_t_4; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1768, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1768, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1768, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 1768, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1768, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1768, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 1768, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1768, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_8(__pyx_t_3);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1768, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_col, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":1769
 *     })
 *     for col in control_vars.columns:
 *         data[col] = control_vars[col]             # <<<<<<<<<<<<<<
 * 
 *     # Encode y_true and y_pred if they are not numerical
 */
    __Pyx_TraceLine(1769,0,__PYX_ERR(0, 1769, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_control_vars, __pyx_v_col); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1769, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (unlikely((PyObject_SetItem(__pyx_v_data, __pyx_v_col, __pyx_t_4) < 0))) __PYX_ERR(0, 1769, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":1768
 *         'y_pred': y_pred
 *     })
 *     for col in control_vars.columns:             # <<<<<<<<<<<<<<
 *         data[col] = control_vars[col]
 * 
 */
    __Pyx_TraceLine(1768,0,__PYX_ERR(0, 1768, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1772
 * 
 *     # Encode y_true and y_pred if they are not numerical
 *     le_true = LabelEncoder().fit(y_true)             # <<<<<<<<<<<<<<
 *     data['y_true'] = le_true.transform(data['y_true'])
 * 
 */
  __Pyx_TraceLine(1772,0,__PYX_ERR(0, 1772, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_LabelEncoder);
  __pyx_t_2 = __pyx_v_LabelEncoder; __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_fit); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1772, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_y_true};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1772, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_le_true = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1773
 *     # Encode y_true and y_pred if they are not numerical
 *     le_true = LabelEncoder().fit(y_true)
 *     data['y_true'] = le_true.transform(data['y_true'])             # <<<<<<<<<<<<<<
 * 
 *     if not np.issubdtype(data['y_pred'].dtype, np.number):
 */
  __Pyx_TraceLine(1773,0,__PYX_ERR(0, 1773, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_le_true, __pyx_n_s_transform); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1773, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_data, __pyx_n_u_y_true); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1773, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_4};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1773, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  if (unlikely((PyObject_SetItem(__pyx_v_data, __pyx_n_u_y_true, __pyx_t_3) < 0))) __PYX_ERR(0, 1773, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1775
 *     data['y_true'] = le_true.transform(data['y_true'])
 * 
 *     if not np.issubdtype(data['y_pred'].dtype, np.number):             # <<<<<<<<<<<<<<
 *         le_pred = LabelEncoder().fit(y_pred)
 *         data['y_pred'] = le_pred.transform(data['y_pred'])
 */
  __Pyx_TraceLine(1775,0,__PYX_ERR(0, 1775, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_issubdtype); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Dict_GetItem(__pyx_v_data, __pyx_n_u_y_pred); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_number); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_t_1, __pyx_t_9};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1775, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 1775, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_11 = (!__pyx_t_10);
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":1776
 * 
 *     if not np.issubdtype(data['y_pred'].dtype, np.number):
 *         le_pred = LabelEncoder().fit(y_pred)             # <<<<<<<<<<<<<<
 *         data['y_pred'] = le_pred.transform(data['y_pred'])
 * 
 */
    __Pyx_TraceLine(1776,0,__PYX_ERR(0, 1776, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_LabelEncoder);
    __pyx_t_9 = __pyx_v_LabelEncoder; __pyx_t_1 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1776, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_fit); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1776, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_y_pred};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1776, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __pyx_v_le_pred = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1777
 *     if not np.issubdtype(data['y_pred'].dtype, np.number):
 *         le_pred = LabelEncoder().fit(y_pred)
 *         data['y_pred'] = le_pred.transform(data['y_pred'])             # <<<<<<<<<<<<<<
 * 
 *     # Iterate over each unique combination of control variables (each stratum)
 */
    __Pyx_TraceLine(1777,0,__PYX_ERR(0, 1777, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_le_pred, __pyx_n_s_transform); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1777, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_data, __pyx_n_u_y_pred); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1777, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_4};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1777, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    if (unlikely((PyObject_SetItem(__pyx_v_data, __pyx_n_u_y_pred, __pyx_t_3) < 0))) __PYX_ERR(0, 1777, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1775
 *     data['y_true'] = le_true.transform(data['y_true'])
 * 
 *     if not np.issubdtype(data['y_pred'].dtype, np.number):             # <<<<<<<<<<<<<<
 *         le_pred = LabelEncoder().fit(y_pred)
 *         data['y_pred'] = le_pred.transform(data['y_pred'])
 */
  }

  /* "gofast/tools/mathex.pyx":1780
 * 
 *     # Iterate over each unique combination of control variables (each stratum)
 *     adjusted_preds = []             # <<<<<<<<<<<<<<
 *     for _, group in data.groupby(list(control_vars.columns)):
 *         if len(group) > 1:  # Enough data for logistic regression
 */
  __Pyx_TraceLine(1780,0,__PYX_ERR(0, 1780, __pyx_L1_error))
  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1780, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_adjusted_preds = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1781
 *     # Iterate over each unique combination of control variables (each stratum)
 *     adjusted_preds = []
 *     for _, group in data.groupby(list(control_vars.columns)):             # <<<<<<<<<<<<<<
 *         if len(group) > 1:  # Enough data for logistic regression
 *             # Apply logistic regression within each stratum
 */
  __Pyx_TraceLine(1781,0,__PYX_ERR(0, 1781, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_groupby); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1781, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_control_vars, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1781, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PySequence_ListKeepNew(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1781, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_1};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1781, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_9 = __pyx_t_3; __Pyx_INCREF(__pyx_t_9);
    __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1781, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1781, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_9))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_9);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1781, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 1781, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_9, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1781, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_9);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1781, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_7); __Pyx_INCREF(__pyx_t_3); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 1781, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_9, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1781, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_8(__pyx_t_9);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1781, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
      PyObject* sequence = __pyx_t_3;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 1781, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_2 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1781, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2);
      index = 0; __pyx_t_1 = __pyx_t_5(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L11_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_4 = __pyx_t_5(__pyx_t_2); if (unlikely(!__pyx_t_4)) goto __pyx_L11_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_2), 2) < 0) __PYX_ERR(0, 1781, __pyx_L1_error)
      __pyx_t_5 = NULL;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L12_unpacking_done;
      __pyx_L11_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_5 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 1781, __pyx_L1_error)
      __pyx_L12_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v__, __pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_group, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":1782
 *     adjusted_preds = []
 *     for _, group in data.groupby(list(control_vars.columns)):
 *         if len(group) > 1:  # Enough data for logistic regression             # <<<<<<<<<<<<<<
 *             # Apply logistic regression within each stratum
 *             lr = LogisticRegression().fit(group[control_vars.columns], group['y_true'])
 */
    __Pyx_TraceLine(1782,0,__PYX_ERR(0, 1782, __pyx_L1_error))
    __pyx_t_12 = PyObject_Length(__pyx_v_group); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1782, __pyx_L1_error)
    __pyx_t_11 = (__pyx_t_12 > 1);
    if (__pyx_t_11) {

      /* "gofast/tools/mathex.pyx":1784
 *         if len(group) > 1:  # Enough data for logistic regression
 *             # Apply logistic regression within each stratum
 *             lr = LogisticRegression().fit(group[control_vars.columns], group['y_true'])             # <<<<<<<<<<<<<<
 *             adjusted_pred = lr.predict(group[control_vars.columns])
 *             adjusted_preds.extend(adjusted_pred)
 */
      __Pyx_TraceLine(1784,0,__PYX_ERR(0, 1784, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_LogisticRegression);
      __pyx_t_1 = __pyx_v_LogisticRegression; __pyx_t_2 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
        __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1784, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_fit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1784, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_control_vars, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1784, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_group, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1784, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_Dict_GetItem(__pyx_v_group, __pyx_n_u_y_true); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1784, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_13 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_13, __pyx_t_2, __pyx_t_4};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1784, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_lr, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":1785
 *             # Apply logistic regression within each stratum
 *             lr = LogisticRegression().fit(group[control_vars.columns], group['y_true'])
 *             adjusted_pred = lr.predict(group[control_vars.columns])             # <<<<<<<<<<<<<<
 *             adjusted_preds.extend(adjusted_pred)
 *         else:
 */
      __Pyx_TraceLine(1785,0,__PYX_ERR(0, 1785, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_lr, __pyx_n_s_predict); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_control_vars, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_group, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1785, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1785, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_adjusted_pred, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":1786
 *             lr = LogisticRegression().fit(group[control_vars.columns], group['y_true'])
 *             adjusted_pred = lr.predict(group[control_vars.columns])
 *             adjusted_preds.extend(adjusted_pred)             # <<<<<<<<<<<<<<
 *         else:
 *             # Not enough data for logistic regression, use original predictions
 */
      __Pyx_TraceLine(1786,0,__PYX_ERR(0, 1786, __pyx_L1_error))
      __pyx_t_14 = __Pyx_PyList_Extend(__pyx_v_adjusted_preds, __pyx_v_adjusted_pred); if (unlikely(__pyx_t_14 == ((int)-1))) __PYX_ERR(0, 1786, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":1782
 *     adjusted_preds = []
 *     for _, group in data.groupby(list(control_vars.columns)):
 *         if len(group) > 1:  # Enough data for logistic regression             # <<<<<<<<<<<<<<
 *             # Apply logistic regression within each stratum
 *             lr = LogisticRegression().fit(group[control_vars.columns], group['y_true'])
 */
      goto __pyx_L13;
    }

    /* "gofast/tools/mathex.pyx":1789
 *         else:
 *             # Not enough data for logistic regression, use original predictions
 *             adjusted_preds.extend(group['y_pred'])             # <<<<<<<<<<<<<<
 * 
 *     # Convert adjusted predictions back to original class labels
 */
    __Pyx_TraceLine(1789,0,__PYX_ERR(0, 1789, __pyx_L1_error))
    /*else*/ {
      __pyx_t_3 = __Pyx_PyObject_Dict_GetItem(__pyx_v_group, __pyx_n_u_y_pred); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1789, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_14 = __Pyx_PyList_Extend(__pyx_v_adjusted_preds, __pyx_t_3); if (unlikely(__pyx_t_14 == ((int)-1))) __PYX_ERR(0, 1789, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_L13:;

    /* "gofast/tools/mathex.pyx":1781
 *     # Iterate over each unique combination of control variables (each stratum)
 *     adjusted_preds = []
 *     for _, group in data.groupby(list(control_vars.columns)):             # <<<<<<<<<<<<<<
 *         if len(group) > 1:  # Enough data for logistic regression
 *             # Apply logistic regression within each stratum
 */
    __Pyx_TraceLine(1781,0,__PYX_ERR(0, 1781, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

  /* "gofast/tools/mathex.pyx":1792
 * 
 *     # Convert adjusted predictions back to original class labels
 *     adjusted_y_pred = le_true.inverse_transform(adjusted_preds)             # <<<<<<<<<<<<<<
 *     return np.array(y_true), adjusted_y_pred
 * 
 */
  __Pyx_TraceLine(1792,0,__PYX_ERR(0, 1792, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_le_true, __pyx_n_s_inverse_transform); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_adjusted_preds};
    __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1792, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_adjusted_y_pred = __pyx_t_9;
  __pyx_t_9 = 0;

  /* "gofast/tools/mathex.pyx":1793
 *     # Convert adjusted predictions back to original class labels
 *     adjusted_y_pred = le_true.inverse_transform(adjusted_preds)
 *     return np.array(y_true), adjusted_y_pred             # <<<<<<<<<<<<<<
 * 
 * def weighted_spearman_rank(
 */
  __Pyx_TraceLine(1793,0,__PYX_ERR(0, 1793, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_true};
    __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1793, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_9);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_9)) __PYX_ERR(0, 1793, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_adjusted_y_pred);
  __Pyx_GIVEREF(__pyx_v_adjusted_y_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_adjusted_y_pred)) __PYX_ERR(0, 1793, __pyx_L1_error);
  __pyx_t_9 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1683
 *     return residuals_true, residuals_pred
 * 
 * def adjust_for_control_vars_classification(y_true:ArrayLike, y_pred:ArrayLike, control_vars:DataFrame):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts `y_true` and `y_pred` in a classification task by stratifying the
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex.adjust_for_control_vars_classification", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_LogisticRegression);
  __Pyx_XDECREF(__pyx_v_LabelEncoder);
  __Pyx_XDECREF(__pyx_v_data);
  __Pyx_XDECREF(__pyx_v_col);
  __Pyx_XDECREF(__pyx_v_le_true);
  __Pyx_XDECREF(__pyx_v_le_pred);
  __Pyx_XDECREF(__pyx_v_adjusted_preds);
  __Pyx_XDECREF(__pyx_v__);
  __Pyx_XDECREF(__pyx_v_group);
  __Pyx_XDECREF(__pyx_v_lr);
  __Pyx_XDECREF(__pyx_v_adjusted_pred);
  __Pyx_XDECREF(__pyx_v_adjusted_y_pred);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1795
 *     return np.array(y_true), adjusted_y_pred
 * 
 * def weighted_spearman_rank(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_41weighted_spearman_rank(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_40weighted_spearman_rank, "\n    Compute Spearman's rank correlation coefficient with sample weights,\n    offering an extension to the standard Spearman's correlation by incorporating\n    sample weights into the rank calculation. This method is particularly useful\n    for datasets where some observations are more important than others.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True target values.\n    y_pred : array-like\n        Predicted target values. Both `y_true` and `y_pred` must have the same length.\n    sample_weight : array-like\n        Weights for each sample, indicating the importance of each observation\n        in `y_true` and `y_pred`. Must be the same length as `y_true` and `y_pred`.\n    return_weighted_rank : bool, optional\n        If True, returns the weighted ranks of `y_true` and `y_pred` instead of\n        Spearman's rho. Default is False.\n    epsilon : float, optional\n        A small value added to the denominator to avoid division by zero in the\n        computation of Spearman's rho. Default is 1e-10.\n\n    Returns\n    -------\n    float or tuple of ndarray\n        If `return_weighted_rank` is False (default), returns Spearman's rho,\n        considering sample weights. If `return_weighted_rank` is True, returns\n        a tuple containing the weighted ranks of `y_true` and `y_pred`.\n\n    Notes\n    -----\n    The weighted Spearman's rank correlation coefficient is computed as:\n\n    .. math::\n        \\rho = 1 - \\frac{6 \\sum d_i^2 w_i}{\\sum w_i(n^3 - n)}\n\n    where :math:`d_i` is the difference between the weighted ranks of each observation,\n    :math:`w_i` is the weight of each observation, and :math:`n` is the number of observations.\n\n    This function calculates weighted ranks based on the sample weights, adjusting\n    the influence of each data point in the final correlation measure. It is useful\n    in scenarios where certain observations are deemed more critical than others.\n\n    Examples\n    --------\n    >"">> from gofast.tools.mathex import weighted_spearman_corr\n    >>> y_true = [1, 2, 3, 4, 5]\n    >>> y_pred = [5, 6, 7, 8, 7]\n    >>> sample_weight = [1, 1, 1, 1, 2]\n    >>> weighted_spearman_corr(y_true, y_pred, sample_weight)\n    0.8208\n\n    References\n    ----------\n    .. [1] Myatt, G.J. (2007). Making Sense of Data, A Practical Guide to \n           Exploratory Data Analysis and Data Mining. John Wiley & Sons.\n\n    See Also\n    --------\n    scipy.stats.spearmanr : Spearman rank-order correlation coefficient.\n    numpy.cov : Covariance matrix.\n    numpy.var : Variance.\n\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_41weighted_spearman_rank = {"weighted_spearman_rank", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_41weighted_spearman_rank, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_40weighted_spearman_rank};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_41weighted_spearman_rank(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_sample_weight = 0;
  PyObject *__pyx_v_return_weighted_rank = 0;
  PyObject *__pyx_v_epsilon = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("weighted_spearman_rank (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_sample_weight,&__pyx_n_s_return_weighted_rank,&__pyx_n_s_epsilon,0};

    /* "gofast/tools/mathex.pyx":1797
 * def weighted_spearman_rank(
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,             # <<<<<<<<<<<<<<
 *     epsilon=1e-10
 *     ):
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_10)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1795, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1795, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("weighted_spearman_rank", 0, 3, 5, 1); __PYX_ERR(0, 1795, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_sample_weight)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1795, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("weighted_spearman_rank", 0, 3, 5, 2); __PYX_ERR(0, 1795, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_return_weighted_rank);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1795, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_epsilon);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1795, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "weighted_spearman_rank") < 0)) __PYX_ERR(0, 1795, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_sample_weight = values[2];
    __pyx_v_return_weighted_rank = values[3];
    __pyx_v_epsilon = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("weighted_spearman_rank", 0, 3, 5, __pyx_nargs); __PYX_ERR(0, 1795, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.weighted_spearman_rank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_40weighted_spearman_rank(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_sample_weight, __pyx_v_return_weighted_rank, __pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":1795
 *     return np.array(y_true), adjusted_y_pred
 * 
 * def weighted_spearman_rank(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1871
 * 
 *     # Compute weighted ranks
 *     def weighted_rank(data, weights):             # <<<<<<<<<<<<<<
 *         order = np.argsort(data)
 *         ranks = np.empty_like(order, dtype=float)
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_22weighted_spearman_rank_1weighted_rank(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_22weighted_spearman_rank_1weighted_rank = {"weighted_rank", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_22weighted_spearman_rank_1weighted_rank, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_22weighted_spearman_rank_1weighted_rank(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_weights = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("weighted_rank (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,&__pyx_n_s_weights,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1871, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_weights)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1871, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("weighted_rank", 1, 2, 2, 1); __PYX_ERR(0, 1871, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "weighted_rank") < 0)) __PYX_ERR(0, 1871, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_data = values[0];
    __pyx_v_weights = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("weighted_rank", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 1871, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.weighted_spearman_rank.weighted_rank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_22weighted_spearman_rank_weighted_rank(__pyx_self, __pyx_v_data, __pyx_v_weights);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_22weighted_spearman_rank_weighted_rank(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_weights) {
  PyObject *__pyx_v_order = NULL;
  PyObject *__pyx_v_ranks = NULL;
  PyObject *__pyx_v_cum_weights = NULL;
  PyObject *__pyx_v_total_weight = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  Py_ssize_t __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("weighted_rank", 1);
  __Pyx_TraceCall("weighted_rank", __pyx_f[0], 1871, 0, __PYX_ERR(0, 1871, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":1872
 *     # Compute weighted ranks
 *     def weighted_rank(data, weights):
 *         order = np.argsort(data)             # <<<<<<<<<<<<<<
 *         ranks = np.empty_like(order, dtype=float)
 *         cum_weights = np.cumsum(weights[order])
 */
  __Pyx_TraceLine(1872,0,__PYX_ERR(0, 1872, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1872, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_argsort); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1872, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_data};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1872, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_order = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1873
 *     def weighted_rank(data, weights):
 *         order = np.argsort(data)
 *         ranks = np.empty_like(order, dtype=float)             # <<<<<<<<<<<<<<
 *         cum_weights = np.cumsum(weights[order])
 *         total_weight = cum_weights[-1]
 */
  __Pyx_TraceLine(1873,0,__PYX_ERR(0, 1873, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1873, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_empty_like); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1873, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1873, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_order);
  __Pyx_GIVEREF(__pyx_v_order);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_order)) __PYX_ERR(0, 1873, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1873, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dtype, ((PyObject *)(&PyFloat_Type))) < 0) __PYX_ERR(0, 1873, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1873, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_ranks = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":1874
 *         order = np.argsort(data)
 *         ranks = np.empty_like(order, dtype=float)
 *         cum_weights = np.cumsum(weights[order])             # <<<<<<<<<<<<<<
 *         total_weight = cum_weights[-1]
 *         ranks[order] = cum_weights / total_weight * len(data)
 */
  __Pyx_TraceLine(1874,0,__PYX_ERR(0, 1874, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1874, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cumsum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1874, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_weights, __pyx_v_order); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1874, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1874, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_cum_weights = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":1875
 *         ranks = np.empty_like(order, dtype=float)
 *         cum_weights = np.cumsum(weights[order])
 *         total_weight = cum_weights[-1]             # <<<<<<<<<<<<<<
 *         ranks[order] = cum_weights / total_weight * len(data)
 *         return ranks
 */
  __Pyx_TraceLine(1875,0,__PYX_ERR(0, 1875, __pyx_L1_error))
  __pyx_t_5 = __Pyx_GetItemInt(__pyx_v_cum_weights, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1875, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_v_total_weight = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":1876
 *         cum_weights = np.cumsum(weights[order])
 *         total_weight = cum_weights[-1]
 *         ranks[order] = cum_weights / total_weight * len(data)             # <<<<<<<<<<<<<<
 *         return ranks
 * 
 */
  __Pyx_TraceLine(1876,0,__PYX_ERR(0, 1876, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyNumber_Divide(__pyx_v_cum_weights, __pyx_v_total_weight); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1876, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1876, __pyx_L1_error)
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1876, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1876, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely((PyObject_SetItem(__pyx_v_ranks, __pyx_v_order, __pyx_t_2) < 0))) __PYX_ERR(0, 1876, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1877
 *         total_weight = cum_weights[-1]
 *         ranks[order] = cum_weights / total_weight * len(data)
 *         return ranks             # <<<<<<<<<<<<<<
 * 
 *     ranks_true = weighted_rank(y_true, sample_weight)
 */
  __Pyx_TraceLine(1877,0,__PYX_ERR(0, 1877, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ranks);
  __pyx_r = __pyx_v_ranks;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1871
 * 
 *     # Compute weighted ranks
 *     def weighted_rank(data, weights):             # <<<<<<<<<<<<<<
 *         order = np.argsort(data)
 *         ranks = np.empty_like(order, dtype=float)
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex.weighted_spearman_rank.weighted_rank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_order);
  __Pyx_XDECREF(__pyx_v_ranks);
  __Pyx_XDECREF(__pyx_v_cum_weights);
  __Pyx_XDECREF(__pyx_v_total_weight);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1795
 *     return np.array(y_true), adjusted_y_pred
 * 
 * def weighted_spearman_rank(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_40weighted_spearman_rank(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_sample_weight, PyObject *__pyx_v_return_weighted_rank, PyObject *__pyx_v_epsilon) {
  PyObject *__pyx_v_weighted_rank = 0;
  PyObject *__pyx_v_ranks_true = NULL;
  PyObject *__pyx_v_ranks_pred = NULL;
  PyObject *__pyx_v_cov = NULL;
  PyObject *__pyx_v_std_true = NULL;
  PyObject *__pyx_v_std_pred = NULL;
  PyObject *__pyx_v_rho = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__43)
  __Pyx_RefNannySetupContext("weighted_spearman_rank", 0);
  __Pyx_TraceCall("weighted_spearman_rank", __pyx_f[0], 1795, 0, __PYX_ERR(0, 1795, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_sample_weight);
  __Pyx_INCREF(__pyx_v_epsilon);

  /* "gofast/tools/mathex.pyx":1865
 *     """
 *     # Check and convert inputs to numpy arrays
 *     y_true, y_pred, sample_weight = map(np.asarray, [y_true, y_pred, sample_weight])             # <<<<<<<<<<<<<<
 * 
 *     if str(epsilon).lower() =='auto':
 */
  __Pyx_TraceLine(1865,0,__PYX_ERR(0, 1865, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyList_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_GIVEREF(__pyx_v_y_true);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_y_true)) __PYX_ERR(0, 1865, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_GIVEREF(__pyx_v_y_pred);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 1, __pyx_v_y_pred)) __PYX_ERR(0, 1865, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_sample_weight);
  __Pyx_GIVEREF(__pyx_v_sample_weight);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 2, __pyx_v_sample_weight)) __PYX_ERR(0, 1865, __pyx_L1_error);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 1865, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1)) __PYX_ERR(0, 1865, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1865, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 3)) {
      if (size > 3) __Pyx_RaiseTooManyValuesError(3);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 1865, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
      __pyx_t_4 = PyTuple_GET_ITEM(sequence, 2); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
      __pyx_t_4 = PyList_GET_ITEM(sequence, 2); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_t_4);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PySequence_ITEM(sequence, 2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1865, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
    index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    index = 2; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_4);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 3) < 0) __PYX_ERR(0, 1865, __pyx_L1_error)
    __pyx_t_6 = NULL;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 1865, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
  __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_sample_weight, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1867
 *     y_true, y_pred, sample_weight = map(np.asarray, [y_true, y_pred, sample_weight])
 * 
 *     if str(epsilon).lower() =='auto':             # <<<<<<<<<<<<<<
 *         epsilon = determine_epsilon(y_pred, scale_factor= 1e-10)
 * 
 */
  __Pyx_TraceLine(1867,0,__PYX_ERR(0, 1867, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Str(__pyx_v_epsilon); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1867, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_lower); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1867, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1867, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_auto, Py_EQ)); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 1867, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_8) {

    /* "gofast/tools/mathex.pyx":1868
 * 
 *     if str(epsilon).lower() =='auto':
 *         epsilon = determine_epsilon(y_pred, scale_factor= 1e-10)             # <<<<<<<<<<<<<<
 * 
 *     # Compute weighted ranks
 */
    __Pyx_TraceLine(1868,0,__PYX_ERR(0, 1868, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_determine_epsilon); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1868, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1868, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_y_pred);
    __Pyx_GIVEREF(__pyx_v_y_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_y_pred)) __PYX_ERR(0, 1868, __pyx_L1_error);
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1868, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_scale_factor, __pyx_float_1eneg_10) < 0) __PYX_ERR(0, 1868, __pyx_L1_error)
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1868, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1867
 *     y_true, y_pred, sample_weight = map(np.asarray, [y_true, y_pred, sample_weight])
 * 
 *     if str(epsilon).lower() =='auto':             # <<<<<<<<<<<<<<
 *         epsilon = determine_epsilon(y_pred, scale_factor= 1e-10)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":1871
 * 
 *     # Compute weighted ranks
 *     def weighted_rank(data, weights):             # <<<<<<<<<<<<<<
 *         order = np.argsort(data)
 *         ranks = np.empty_like(order, dtype=float)
 */
  __Pyx_TraceLine(1871,0,__PYX_ERR(0, 1871, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_22weighted_spearman_rank_1weighted_rank, 0, __pyx_n_s_weighted_spearman_rank_locals_we, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__45)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_weighted_rank = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1879
 *         return ranks
 * 
 *     ranks_true = weighted_rank(y_true, sample_weight)             # <<<<<<<<<<<<<<
 *     ranks_pred = weighted_rank(y_pred, sample_weight)
 * 
 */
  __Pyx_TraceLine(1879,0,__PYX_ERR(0, 1879, __pyx_L1_error))
  __pyx_t_3 = __pyx_pf_6gofast_5tools_6mathex_22weighted_spearman_rank_weighted_rank(__pyx_v_weighted_rank, __pyx_v_y_true, __pyx_v_sample_weight); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_ranks_true = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1880
 * 
 *     ranks_true = weighted_rank(y_true, sample_weight)
 *     ranks_pred = weighted_rank(y_pred, sample_weight)             # <<<<<<<<<<<<<<
 * 
 *     if return_weighted_rank:
 */
  __Pyx_TraceLine(1880,0,__PYX_ERR(0, 1880, __pyx_L1_error))
  __pyx_t_3 = __pyx_pf_6gofast_5tools_6mathex_22weighted_spearman_rank_weighted_rank(__pyx_v_weighted_rank, __pyx_v_y_pred, __pyx_v_sample_weight); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_ranks_pred = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1882
 *     ranks_pred = weighted_rank(y_pred, sample_weight)
 * 
 *     if return_weighted_rank:             # <<<<<<<<<<<<<<
 *         return ranks_true, ranks_pred
 *     # Compute covariance between the weighted ranks
 */
  __Pyx_TraceLine(1882,0,__PYX_ERR(0, 1882, __pyx_L1_error))
  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_return_weighted_rank); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 1882, __pyx_L1_error)
  if (__pyx_t_8) {

    /* "gofast/tools/mathex.pyx":1883
 * 
 *     if return_weighted_rank:
 *         return ranks_true, ranks_pred             # <<<<<<<<<<<<<<
 *     # Compute covariance between the weighted ranks
 *     cov = np.cov(ranks_true, ranks_pred, aweights=sample_weight)[0, 1]
 */
    __Pyx_TraceLine(1883,0,__PYX_ERR(0, 1883, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1883, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_ranks_true);
    __Pyx_GIVEREF(__pyx_v_ranks_true);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_ranks_true)) __PYX_ERR(0, 1883, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_ranks_pred);
    __Pyx_GIVEREF(__pyx_v_ranks_pred);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_ranks_pred)) __PYX_ERR(0, 1883, __pyx_L1_error);
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1882
 *     ranks_pred = weighted_rank(y_pred, sample_weight)
 * 
 *     if return_weighted_rank:             # <<<<<<<<<<<<<<
 *         return ranks_true, ranks_pred
 *     # Compute covariance between the weighted ranks
 */
  }

  /* "gofast/tools/mathex.pyx":1885
 *         return ranks_true, ranks_pred
 *     # Compute covariance between the weighted ranks
 *     cov = np.cov(ranks_true, ranks_pred, aweights=sample_weight)[0, 1]             # <<<<<<<<<<<<<<
 * 
 *     # Compute standard deviations of the weighted ranks
 */
  __Pyx_TraceLine(1885,0,__PYX_ERR(0, 1885, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1885, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cov); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1885, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1885, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_ranks_true);
  __Pyx_GIVEREF(__pyx_v_ranks_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_ranks_true)) __PYX_ERR(0, 1885, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_ranks_pred);
  __Pyx_GIVEREF(__pyx_v_ranks_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_ranks_pred)) __PYX_ERR(0, 1885, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1885, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_aweights, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 1885, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1885, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_tuple__13); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1885, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_cov = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1888
 * 
 *     # Compute standard deviations of the weighted ranks
 *     std_true = np.sqrt(np.var(ranks_true, ddof=1, aweights=sample_weight))             # <<<<<<<<<<<<<<
 *     std_pred = np.sqrt(np.var(ranks_pred, ddof=1, aweights=sample_weight))
 * 
 */
  __Pyx_TraceLine(1888,0,__PYX_ERR(0, 1888, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_var); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_ranks_true);
  __Pyx_GIVEREF(__pyx_v_ranks_true);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_ranks_true)) __PYX_ERR(0, 1888, __pyx_L1_error);
  __pyx_t_5 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_ddof, __pyx_int_1) < 0) __PYX_ERR(0, 1888, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_aweights, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 1888, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1888, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_9};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1888, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_std_true = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1889
 *     # Compute standard deviations of the weighted ranks
 *     std_true = np.sqrt(np.var(ranks_true, ddof=1, aweights=sample_weight))
 *     std_pred = np.sqrt(np.var(ranks_pred, ddof=1, aweights=sample_weight))             # <<<<<<<<<<<<<<
 * 
 *     # Compute Spearman's rho
 */
  __Pyx_TraceLine(1889,0,__PYX_ERR(0, 1889, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_var); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_ranks_pred);
  __Pyx_GIVEREF(__pyx_v_ranks_pred);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_ranks_pred)) __PYX_ERR(0, 1889, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_ddof, __pyx_int_1) < 0) __PYX_ERR(0, 1889, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_aweights, __pyx_v_sample_weight) < 0) __PYX_ERR(0, 1889, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_4};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1889, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __pyx_v_std_pred = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1892
 * 
 *     # Compute Spearman's rho
 *     rho = cov / ( (std_true * std_pred) + epsilon)             # <<<<<<<<<<<<<<
 *     return rho
 * 
 */
  __Pyx_TraceLine(1892,0,__PYX_ERR(0, 1892, __pyx_L1_error))
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_std_true, __pyx_v_std_pred); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_9 = PyNumber_Add(__pyx_t_2, __pyx_v_epsilon); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_v_cov, __pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_v_rho = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1893
 *     # Compute Spearman's rho
 *     rho = cov / ( (std_true * std_pred) + epsilon)
 *     return rho             # <<<<<<<<<<<<<<
 * 
 * def calculate_optimal_bins(y_pred, method='freedman_diaconis', data_range=None):
 */
  __Pyx_TraceLine(1893,0,__PYX_ERR(0, 1893, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_rho);
  __pyx_r = __pyx_v_rho;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1795
 *     return np.array(y_true), adjusted_y_pred
 * 
 * def weighted_spearman_rank(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.weighted_spearman_rank", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_weighted_rank);
  __Pyx_XDECREF(__pyx_v_ranks_true);
  __Pyx_XDECREF(__pyx_v_ranks_pred);
  __Pyx_XDECREF(__pyx_v_cov);
  __Pyx_XDECREF(__pyx_v_std_true);
  __Pyx_XDECREF(__pyx_v_std_pred);
  __Pyx_XDECREF(__pyx_v_rho);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_sample_weight);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1895
 *     return rho
 * 
 * def calculate_optimal_bins(y_pred, method='freedman_diaconis', data_range=None):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the optimal number of bins for histogramming a given set of
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_43calculate_optimal_bins(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_42calculate_optimal_bins, "\n    Calculate the optimal number of bins for histogramming a given set of \n    predictions, utilizing various heuristics. This function supports the \n    Freedman-Diaconis rule, Sturges' formula, and the Square-root choice, \n    allowing users to select the most appropriate method based on their data \n    distribution and size.\n\n    Parameters\n    ----------\n    y_pred : array-like\n        Predicted probabilities for the positive class. This array should be \n        one-dimensional.\n    method : str, optional\n        The binning method to use. Options include:\n        - 'freedman_diaconis': Uses the Freedman-Diaconis rule, which is \n          particularly useful for data with skewed distributions.\n          .. math:: \text{bin width} = 2 \\cdot \014rac{IQR}{\\sqrt[3]{n}}\n        - 'sturges': Uses Sturges' formula, ideal for normal distributions \n          but may be suboptimal for large datasets or non-normal distributions.\n          .. math:: \text{bins} = \\lceil \\log_2(n) + 1 \rceil\n        - 'sqrt': Employs the Square-root choice, a simple rule that works well \n          for small datasets.\n          .. math:: \text{bins} = \\lceil \\sqrt{n} \rceil\n        Default is 'freedman_diaconis'.\n    data_range : tuple, optional\n        A tuple specifying the range of the data as (min, max). If None, the \n        minimum and maximum values in `y_pred` are used. Default is None.\n\n    Returns\n    -------\n    int\n        The calculated optimal number of bins.\n\n    Raises\n    ------\n    ValueError\n        If an invalid `method` is specified.\n\n    Examples\n    --------\n    Calculate the optimal number of bins for a dataset of random predictions \n    using different methods:\n    \n    >>> from gofast.tools.mathex import calculate_optimal_bins\n    >>> y_pred = np.random.rand(100)\n    >>> print(calculate_optimal_bins(y_pred, method='freedman_diaconis'))\n    9\n    >>> print(calculate_optimal_bins(y_pred, method='sturges'))\n    7""\n    >>> print(calculate_optimal_bins(y_pred, method='sqrt'))\n    10\n\n    References\n    ----------\n    - Freedman, D. and Diaconis, P. (1981). On the histogram as a density estimator:\n      L2 theory. Zeitschrift f\303\274r Wahrscheinlichkeitstheorie und verwandte Gebiete, \n      57(4), 453-476.\n    - Sturges, H. A. (1926). The choice of a class interval. Journal of the American \n      Statistical Association, 21(153), 65-66.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_43calculate_optimal_bins = {"calculate_optimal_bins", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_43calculate_optimal_bins, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_42calculate_optimal_bins};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_43calculate_optimal_bins(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_method = 0;
  PyObject *__pyx_v_data_range = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_optimal_bins (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_pred,&__pyx_n_s_method,&__pyx_n_s_data_range,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_freedman_diaconis)));
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1895, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1895, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data_range);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1895, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_optimal_bins") < 0)) __PYX_ERR(0, 1895, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_pred = values[0];
    __pyx_v_method = values[1];
    __pyx_v_data_range = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_optimal_bins", 0, 1, 3, __pyx_nargs); __PYX_ERR(0, 1895, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_optimal_bins", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_42calculate_optimal_bins(__pyx_self, __pyx_v_y_pred, __pyx_v_method, __pyx_v_data_range);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}
static PyObject *__pyx_gb_6gofast_5tools_6mathex_22calculate_optimal_bins_2generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */

/* "gofast/tools/mathex.pyx":1962
 *             raise ValueError(
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):             # <<<<<<<<<<<<<<
 *             raise ValueError("data_range must contain numeric values.")
 *         data_min, data_max = data_range
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_22calculate_optimal_bins_genexpr(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_genexpr_arg_0) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct__genexpr(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 1962, __pyx_L1_error)
  } else {
    __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
  }
  __pyx_cur_scope->__pyx_genexpr_arg_0 = __pyx_genexpr_arg_0;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_genexpr_arg_0);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_genexpr_arg_0);
  {
    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_6gofast_5tools_6mathex_22calculate_optimal_bins_2generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_calculate_optimal_bins_locals_ge, __pyx_n_s_gofast_tools_mathex); if (unlikely(!gen)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_DECREF(__pyx_cur_scope);
    __Pyx_RefNannyFinishContext();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_optimal_bins.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __Pyx_DECREF((PyObject *)__pyx_cur_scope);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_gb_6gofast_5tools_6mathex_22calculate_optimal_bins_2generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *__pyx_cur_scope = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *)__pyx_generator->closure);
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  PyObject *(*__pyx_t_3)(PyObject *);
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  int __pyx_t_10;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("genexpr", 0);
  __Pyx_TraceCall("genexpr", __pyx_f[0], 1962, 0, __PYX_ERR(0, 1962, __pyx_L1_error));
  switch (__pyx_generator->resume_label) {
    case 0: goto __pyx_L3_first_run;
    default: /* CPython raises the right error here */
    __Pyx_TraceReturn(Py_None, 0);
    __Pyx_RefNannyFinishContext();
    return NULL;
  }
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1962, __pyx_L1_error)
  if (unlikely(!__pyx_cur_scope->__pyx_genexpr_arg_0)) { __Pyx_RaiseUnboundLocalError(".0"); __PYX_ERR(0, 1962, __pyx_L1_error) }
  if (likely(PyList_CheckExact(__pyx_cur_scope->__pyx_genexpr_arg_0)) || PyTuple_CheckExact(__pyx_cur_scope->__pyx_genexpr_arg_0)) {
    __pyx_t_1 = __pyx_cur_scope->__pyx_genexpr_arg_0; __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = 0;
    __pyx_t_3 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_cur_scope->__pyx_genexpr_arg_0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1962, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_3)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
          #endif
          if (__pyx_t_2 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1962, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
          #endif
          if (__pyx_t_2 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1962, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 1962, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_v);
    __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_v, __pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    __pyx_t_4 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_isscalar); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_8 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_7))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_7);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_7, function);
        __pyx_t_8 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_cur_scope->__pyx_v_v};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1962, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    }
    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_10 = (!__pyx_t_9);
    if (!__pyx_t_10) {
    } else {
      __pyx_t_5 = __pyx_t_10;
      goto __pyx_L7_bool_binop_done;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_isreal); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = NULL;
    __pyx_t_8 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_8 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_cur_scope->__pyx_v_v};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1962, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_9 = (!__pyx_t_10);
    __pyx_t_5 = __pyx_t_9;
    __pyx_L7_bool_binop_done:;
    if (__pyx_t_5) {
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(Py_True);
      __pyx_r = Py_True;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L0;
    }
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  /*else*/ {
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(Py_False);
    __pyx_r = Py_False;
    goto __pyx_L0;
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_Generator_Replace_StopIteration(0);
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  #if !CYTHON_USE_EXC_INFO_STACK
  __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
  #endif
  __pyx_generator->resume_label = -1;
  __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1895
 *     return rho
 * 
 * def calculate_optimal_bins(y_pred, method='freedman_diaconis', data_range=None):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the optimal number of bins for histogramming a given set of
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_42calculate_optimal_bins(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_method, PyObject *__pyx_v_data_range) {
  PyObject *__pyx_v_data_min = NULL;
  PyObject *__pyx_v_data_max = NULL;
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_v_iqr = NULL;
  PyObject *__pyx_v_bin_width = NULL;
  PyObject *__pyx_v_optimal_bins = NULL;
  PyObject *__pyx_gb_6gofast_5tools_6mathex_22calculate_optimal_bins_2generator = 0;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  Py_ssize_t __pyx_t_8;
  PyObject *(*__pyx_t_9)(PyObject *);
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  long __pyx_t_12;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__46)
  __Pyx_RefNannySetupContext("calculate_optimal_bins", 0);
  __Pyx_TraceCall("calculate_optimal_bins", __pyx_f[0], 1895, 0, __PYX_ERR(0, 1895, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_method);

  /* "gofast/tools/mathex.pyx":1956
 *       Statistical Association, 21(153), 65-66.
 *     """
 *     y_pred = np.asarray(y_pred)             # <<<<<<<<<<<<<<
 * 
 *     if data_range is not None:
 */
  __Pyx_TraceLine(1956,0,__PYX_ERR(0, 1956, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1956, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1956, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_pred};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1956, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":1958
 *     y_pred = np.asarray(y_pred)
 * 
 *     if data_range is not None:             # <<<<<<<<<<<<<<
 *         if not isinstance(data_range, tuple) or len(data_range) != 2:
 *             raise ValueError(
 */
  __Pyx_TraceLine(1958,0,__PYX_ERR(0, 1958, __pyx_L1_error))
  __pyx_t_5 = (__pyx_v_data_range != Py_None);
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1959
 * 
 *     if data_range is not None:
 *         if not isinstance(data_range, tuple) or len(data_range) != 2:             # <<<<<<<<<<<<<<
 *             raise ValueError(
 *                 "data_range must be a tuple of two numeric values (min, max).")
 */
    __Pyx_TraceLine(1959,0,__PYX_ERR(0, 1959, __pyx_L1_error))
    __pyx_t_6 = PyTuple_Check(__pyx_v_data_range); 
    __pyx_t_7 = (!__pyx_t_6);
    if (!__pyx_t_7) {
    } else {
      __pyx_t_5 = __pyx_t_7;
      goto __pyx_L5_bool_binop_done;
    }
    __pyx_t_8 = PyObject_Length(__pyx_v_data_range); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1959, __pyx_L1_error)
    __pyx_t_7 = (__pyx_t_8 != 2);
    __pyx_t_5 = __pyx_t_7;
    __pyx_L5_bool_binop_done:;
    if (unlikely(__pyx_t_5)) {

      /* "gofast/tools/mathex.pyx":1960
 *     if data_range is not None:
 *         if not isinstance(data_range, tuple) or len(data_range) != 2:
 *             raise ValueError(             # <<<<<<<<<<<<<<
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):
 */
      __Pyx_TraceLine(1960,0,__PYX_ERR(0, 1960, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__47, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1960, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __PYX_ERR(0, 1960, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":1959
 * 
 *     if data_range is not None:
 *         if not isinstance(data_range, tuple) or len(data_range) != 2:             # <<<<<<<<<<<<<<
 *             raise ValueError(
 *                 "data_range must be a tuple of two numeric values (min, max).")
 */
    }

    /* "gofast/tools/mathex.pyx":1962
 *             raise ValueError(
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):             # <<<<<<<<<<<<<<
 *             raise ValueError("data_range must contain numeric values.")
 *         data_min, data_max = data_range
 */
    __Pyx_TraceLine(1962,0,__PYX_ERR(0, 1962, __pyx_L1_error))
    __pyx_t_1 = __pyx_pf_6gofast_5tools_6mathex_22calculate_optimal_bins_genexpr(NULL, __pyx_v_data_range); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_Generator_Next(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1962, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(__pyx_t_5)) {

      /* "gofast/tools/mathex.pyx":1963
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):
 *             raise ValueError("data_range must contain numeric values.")             # <<<<<<<<<<<<<<
 *         data_min, data_max = data_range
 *     else:
 */
      __Pyx_TraceLine(1963,0,__PYX_ERR(0, 1963, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__48, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1963, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __PYX_ERR(0, 1963, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":1962
 *             raise ValueError(
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):             # <<<<<<<<<<<<<<
 *             raise ValueError("data_range must contain numeric values.")
 *         data_min, data_max = data_range
 */
    }

    /* "gofast/tools/mathex.pyx":1964
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):
 *             raise ValueError("data_range must contain numeric values.")
 *         data_min, data_max = data_range             # <<<<<<<<<<<<<<
 *     else:
 *         data_min, data_max = np.min(y_pred), np.max(y_pred)
 */
    __Pyx_TraceLine(1964,0,__PYX_ERR(0, 1964, __pyx_L1_error))
    if ((likely(PyTuple_CheckExact(__pyx_v_data_range))) || (PyList_CheckExact(__pyx_v_data_range))) {
      PyObject* sequence = __pyx_v_data_range;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 1964, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      #else
      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1964, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1964, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      #endif
    } else {
      Py_ssize_t index = -1;
      __pyx_t_2 = PyObject_GetIter(__pyx_v_data_range); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1964, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2);
      index = 0; __pyx_t_3 = __pyx_t_9(__pyx_t_2); if (unlikely(!__pyx_t_3)) goto __pyx_L8_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      index = 1; __pyx_t_1 = __pyx_t_9(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L8_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_2), 2) < 0) __PYX_ERR(0, 1964, __pyx_L1_error)
      __pyx_t_9 = NULL;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L9_unpacking_done;
      __pyx_L8_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 1964, __pyx_L1_error)
      __pyx_L9_unpacking_done:;
    }
    __pyx_v_data_min = __pyx_t_3;
    __pyx_t_3 = 0;
    __pyx_v_data_max = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":1958
 *     y_pred = np.asarray(y_pred)
 * 
 *     if data_range is not None:             # <<<<<<<<<<<<<<
 *         if not isinstance(data_range, tuple) or len(data_range) != 2:
 *             raise ValueError(
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":1966
 *         data_min, data_max = data_range
 *     else:
 *         data_min, data_max = np.min(y_pred), np.max(y_pred)             # <<<<<<<<<<<<<<
 *     # Handle case where data is uniform
 *     if data_min == data_max:
 */
  __Pyx_TraceLine(1966,0,__PYX_ERR(0, 1966, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1966, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_min); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1966, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_pred};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1966, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1966, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_max); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1966, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y_pred};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1966, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __pyx_v_data_min = __pyx_t_1;
    __pyx_t_1 = 0;
    __pyx_v_data_max = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":1968
 *         data_min, data_max = np.min(y_pred), np.max(y_pred)
 *     # Handle case where data is uniform
 *     if data_min == data_max:             # <<<<<<<<<<<<<<
 *         return 1
 * 
 */
  __Pyx_TraceLine(1968,0,__PYX_ERR(0, 1968, __pyx_L1_error))
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_data_min, __pyx_v_data_max, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1968, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1968, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1969
 *     # Handle case where data is uniform
 *     if data_min == data_max:
 *         return 1             # <<<<<<<<<<<<<<
 * 
 *     n = len(y_pred)
 */
    __Pyx_TraceLine(1969,0,__PYX_ERR(0, 1969, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_int_1);
    __pyx_r = __pyx_int_1;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":1968
 *         data_min, data_max = np.min(y_pred), np.max(y_pred)
 *     # Handle case where data is uniform
 *     if data_min == data_max:             # <<<<<<<<<<<<<<
 *         return 1
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":1971
 *         return 1
 * 
 *     n = len(y_pred)             # <<<<<<<<<<<<<<
 * 
 *     method = normalize_string(
 */
  __Pyx_TraceLine(1971,0,__PYX_ERR(0, 1971, __pyx_L1_error))
  __pyx_t_8 = PyObject_Length(__pyx_v_y_pred); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1971, __pyx_L1_error)
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1971, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_n = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1973
 *     n = len(y_pred)
 * 
 *     method = normalize_string(             # <<<<<<<<<<<<<<
 *         method, target_strs=["freedman_diaconis","sturges","sqrt"],
 *         return_target_only= True, match_method="contains", raise_exception=True,
 */
  __Pyx_TraceLine(1973,0,__PYX_ERR(0, 1973, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_normalize_string); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1973, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":1974
 * 
 *     method = normalize_string(
 *         method, target_strs=["freedman_diaconis","sturges","sqrt"],             # <<<<<<<<<<<<<<
 *         return_target_only= True, match_method="contains", raise_exception=True,
 *         error_msg=("Invalid method specified. Choose among"
 */
  __Pyx_TraceLine(1974,0,__PYX_ERR(0, 1974, __pyx_L1_error))
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1973, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_method);
  __Pyx_GIVEREF(__pyx_v_method);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_method)) __PYX_ERR(0, 1973, __pyx_L1_error);
  __pyx_t_10 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1974, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_3 = PyList_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1974, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_u_freedman_diaconis);
  __Pyx_GIVEREF(__pyx_n_u_freedman_diaconis);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_u_freedman_diaconis)) __PYX_ERR(0, 1974, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_sturges);
  __Pyx_GIVEREF(__pyx_n_u_sturges);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_u_sturges)) __PYX_ERR(0, 1974, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_sqrt);
  __Pyx_GIVEREF(__pyx_n_u_sqrt);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 2, __pyx_n_u_sqrt)) __PYX_ERR(0, 1974, __pyx_L1_error);
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_target_strs, __pyx_t_3) < 0) __PYX_ERR(0, 1974, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1975
 *     method = normalize_string(
 *         method, target_strs=["freedman_diaconis","sturges","sqrt"],
 *         return_target_only= True, match_method="contains", raise_exception=True,             # <<<<<<<<<<<<<<
 *         error_msg=("Invalid method specified. Choose among"
 *                    " 'freedman_diaconis', 'sturges', 'sqrt'.")
 */
  __Pyx_TraceLine(1975,0,__PYX_ERR(0, 1975, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_return_target_only, Py_True) < 0) __PYX_ERR(0, 1974, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_match_method, __pyx_n_u_contains) < 0) __PYX_ERR(0, 1974, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_raise_exception, Py_True) < 0) __PYX_ERR(0, 1974, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_error_msg, __pyx_kp_u_Invalid_method_specified_Choose) < 0) __PYX_ERR(0, 1974, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1973
 *     n = len(y_pred)
 * 
 *     method = normalize_string(             # <<<<<<<<<<<<<<
 *         method, target_strs=["freedman_diaconis","sturges","sqrt"],
 *         return_target_only= True, match_method="contains", raise_exception=True,
 */
  __Pyx_TraceLine(1973,0,__PYX_ERR(0, 1973, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1973, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF_SET(__pyx_v_method, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1979
 *                    " 'freedman_diaconis', 'sturges', 'sqrt'.")
 *         )
 *     if method == 'freedman_diaconis':             # <<<<<<<<<<<<<<
 *         iqr = np.subtract(*np.percentile(y_pred, [75, 25]))  # Interquartile range
 *         if iqr == 0:  # Handle case where IQR is 0
 */
  __Pyx_TraceLine(1979,0,__PYX_ERR(0, 1979, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_freedman_diaconis, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1979, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1980
 *         )
 *     if method == 'freedman_diaconis':
 *         iqr = np.subtract(*np.percentile(y_pred, [75, 25]))  # Interquartile range             # <<<<<<<<<<<<<<
 *         if iqr == 0:  # Handle case where IQR is 0
 *             return max(1, n // 2)  # Fallback to avoid division by zero
 */
    __Pyx_TraceLine(1980,0,__PYX_ERR(0, 1980, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_subtract); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_percentile); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_int_75);
    __Pyx_GIVEREF(__pyx_int_75);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_int_75)) __PYX_ERR(0, 1980, __pyx_L1_error);
    __Pyx_INCREF(__pyx_int_25);
    __Pyx_GIVEREF(__pyx_int_25);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 1, __pyx_int_25)) __PYX_ERR(0, 1980, __pyx_L1_error);
    __pyx_t_11 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_11, __pyx_v_y_pred, __pyx_t_1};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1980, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_2, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1980, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_iqr = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1981
 *     if method == 'freedman_diaconis':
 *         iqr = np.subtract(*np.percentile(y_pred, [75, 25]))  # Interquartile range
 *         if iqr == 0:  # Handle case where IQR is 0             # <<<<<<<<<<<<<<
 *             return max(1, n // 2)  # Fallback to avoid division by zero
 * 
 */
    __Pyx_TraceLine(1981,0,__PYX_ERR(0, 1981, __pyx_L1_error))
    __pyx_t_5 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_iqr, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1981, __pyx_L1_error)
    if (__pyx_t_5) {

      /* "gofast/tools/mathex.pyx":1982
 *         iqr = np.subtract(*np.percentile(y_pred, [75, 25]))  # Interquartile range
 *         if iqr == 0:  # Handle case where IQR is 0
 *             return max(1, n // 2)  # Fallback to avoid division by zero             # <<<<<<<<<<<<<<
 * 
 *         bin_width = 2 * iqr * (n ** (-1/3))
 */
      __Pyx_TraceLine(1982,0,__PYX_ERR(0, 1982, __pyx_L1_error))
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_3 = __Pyx_PyInt_FloorDivideObjC(__pyx_v_n, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1982, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_12 = 1;
      __pyx_t_10 = __Pyx_PyInt_From_long(__pyx_t_12); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1982, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_t_10, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1982, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1982, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (__pyx_t_5) {
        __Pyx_INCREF(__pyx_t_3);
        __pyx_t_2 = __pyx_t_3;
      } else {
        __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1982, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = __pyx_t_1;
        __pyx_t_1 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_INCREF(__pyx_t_2);
      __pyx_r = __pyx_t_2;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      goto __pyx_L0;

      /* "gofast/tools/mathex.pyx":1981
 *     if method == 'freedman_diaconis':
 *         iqr = np.subtract(*np.percentile(y_pred, [75, 25]))  # Interquartile range
 *         if iqr == 0:  # Handle case where IQR is 0             # <<<<<<<<<<<<<<
 *             return max(1, n // 2)  # Fallback to avoid division by zero
 * 
 */
    }

    /* "gofast/tools/mathex.pyx":1984
 *             return max(1, n // 2)  # Fallback to avoid division by zero
 * 
 *         bin_width = 2 * iqr * (n ** (-1/3))             # <<<<<<<<<<<<<<
 *         optimal_bins = int(np.ceil((data_max - data_min) / bin_width))
 *     elif method == 'sturges':
 */
    __Pyx_TraceLine(1984,0,__PYX_ERR(0, 1984, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyInt_MultiplyCObj(__pyx_int_2, __pyx_v_iqr, 2, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1984, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = PyFloat_FromDouble((-1.0 / 3.0)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1984, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyNumber_Power(__pyx_v_n, __pyx_t_3, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1984, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyNumber_Multiply(__pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1984, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_bin_width = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":1985
 * 
 *         bin_width = 2 * iqr * (n ** (-1/3))
 *         optimal_bins = int(np.ceil((data_max - data_min) / bin_width))             # <<<<<<<<<<<<<<
 *     elif method == 'sturges':
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))
 */
    __Pyx_TraceLine(1985,0,__PYX_ERR(0, 1985, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1985, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ceil); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1985, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Subtract(__pyx_v_data_max, __pyx_v_data_min); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1985, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_v_bin_width); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1985, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_10};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1985, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1985, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_optimal_bins = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":1979
 *                    " 'freedman_diaconis', 'sturges', 'sqrt'.")
 *         )
 *     if method == 'freedman_diaconis':             # <<<<<<<<<<<<<<
 *         iqr = np.subtract(*np.percentile(y_pred, [75, 25]))  # Interquartile range
 *         if iqr == 0:  # Handle case where IQR is 0
 */
    goto __pyx_L11;
  }

  /* "gofast/tools/mathex.pyx":1986
 *         bin_width = 2 * iqr * (n ** (-1/3))
 *         optimal_bins = int(np.ceil((data_max - data_min) / bin_width))
 *     elif method == 'sturges':             # <<<<<<<<<<<<<<
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))
 *     elif method == 'sqrt':
 */
  __Pyx_TraceLine(1986,0,__PYX_ERR(0, 1986, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_sturges, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1986, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1987
 *         optimal_bins = int(np.ceil((data_max - data_min) / bin_width))
 *     elif method == 'sturges':
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))             # <<<<<<<<<<<<<<
 *     elif method == 'sqrt':
 *         optimal_bins = int(np.ceil(np.sqrt(n)))
 */
    __Pyx_TraceLine(1987,0,__PYX_ERR(0, 1987, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ceil); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_log2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_n};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_t_11 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_11};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1987, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __pyx_t_10 = __Pyx_PyNumber_Int(__pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_optimal_bins = __pyx_t_10;
    __pyx_t_10 = 0;

    /* "gofast/tools/mathex.pyx":1986
 *         bin_width = 2 * iqr * (n ** (-1/3))
 *         optimal_bins = int(np.ceil((data_max - data_min) / bin_width))
 *     elif method == 'sturges':             # <<<<<<<<<<<<<<
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))
 *     elif method == 'sqrt':
 */
    goto __pyx_L11;
  }

  /* "gofast/tools/mathex.pyx":1988
 *     elif method == 'sturges':
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))
 *     elif method == 'sqrt':             # <<<<<<<<<<<<<<
 *         optimal_bins = int(np.ceil(np.sqrt(n)))
 * 
 */
  __Pyx_TraceLine(1988,0,__PYX_ERR(0, 1988, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_sqrt, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1988, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":1989
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))
 *     elif method == 'sqrt':
 *         optimal_bins = int(np.ceil(np.sqrt(n)))             # <<<<<<<<<<<<<<
 * 
 *     return max(1, optimal_bins)  # Ensure at least one bin
 */
    __Pyx_TraceLine(1989,0,__PYX_ERR(0, 1989, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1989, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ceil); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1989, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1989, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1989, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_n};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_2};
      __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 1989, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_t_11 = __Pyx_PyNumber_Int(__pyx_t_10); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1989, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_v_optimal_bins = __pyx_t_11;
    __pyx_t_11 = 0;

    /* "gofast/tools/mathex.pyx":1988
 *     elif method == 'sturges':
 *         optimal_bins = int(np.ceil(np.log2(n) + 1))
 *     elif method == 'sqrt':             # <<<<<<<<<<<<<<
 *         optimal_bins = int(np.ceil(np.sqrt(n)))
 * 
 */
  }
  __pyx_L11:;

  /* "gofast/tools/mathex.pyx":1991
 *         optimal_bins = int(np.ceil(np.sqrt(n)))
 * 
 *     return max(1, optimal_bins)  # Ensure at least one bin             # <<<<<<<<<<<<<<
 * 
 * def calculate_binary_iv(
 */
  __Pyx_TraceLine(1991,0,__PYX_ERR(0, 1991, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_v_optimal_bins)) { __Pyx_RaiseUnboundLocalError("optimal_bins"); __PYX_ERR(0, 1991, __pyx_L1_error) }
  __Pyx_INCREF(__pyx_v_optimal_bins);
  __pyx_t_11 = __pyx_v_optimal_bins;
  __pyx_t_12 = 1;
  __pyx_t_2 = __Pyx_PyInt_From_long(__pyx_t_12); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1991, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyObject_RichCompare(__pyx_t_11, __pyx_t_2, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1991, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 1991, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_5) {
    __Pyx_INCREF(__pyx_t_11);
    __pyx_t_10 = __pyx_t_11;
  } else {
    __pyx_t_1 = __Pyx_PyInt_From_long(__pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1991, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = __pyx_t_1;
    __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __Pyx_INCREF(__pyx_t_10);
  __pyx_r = __pyx_t_10;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":1895
 *     return rho
 * 
 * def calculate_optimal_bins(y_pred, method='freedman_diaconis', data_range=None):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the optimal number of bins for histogramming a given set of
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_optimal_bins", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_data_min);
  __Pyx_XDECREF(__pyx_v_data_max);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XDECREF(__pyx_v_iqr);
  __Pyx_XDECREF(__pyx_v_bin_width);
  __Pyx_XDECREF(__pyx_v_optimal_bins);
  __Pyx_XDECREF(__pyx_gb_6gofast_5tools_6mathex_22calculate_optimal_bins_2generator);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_method);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":1993
 *     return max(1, optimal_bins)  # Ensure at least one bin
 * 
 * def calculate_binary_iv(             # <<<<<<<<<<<<<<
 *     y_true,
 *     y_pred,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_45calculate_binary_iv(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_44calculate_binary_iv, "\n    Calculate the Information Value (IV) for binary classification problems\n    using a base or binning approach. This function provides flexibility in\n    IV calculation by allowing for simple percentage-based calculations or\n    detailed binning techniques to understand the predictive power across\n    the distribution of predicted probabilities.\n\n    Parameters\n    ----------\n    y_true : array-like\n        True binary labels.\n    y_pred : array-like\n        Predicted probabilities for the positive class.\n    epsilon : float or 'auto', optional\n        A small epsilon value added to probabilities to prevent division\n        by zero in logarithmic calculations. If 'auto', dynamically determines\n        an appropriate epsilon based on `y_pred`. Default is 1e-15.\n    method : str, optional\n        The method for calculating IV. Options are 'base' for a direct approach\n        using the overall percentage of events, and 'binning' for a detailed\n        analysis using bins of predicted probabilities. Default is 'base'.\n    bins : int or 'auto', optional\n        The number of bins to use for the 'binning' method. If 'auto', the\n        optimal number of bins is calculated based on `bins_method`.\n        Default is 'auto'.\n    bins_method : str, optional\n        Method to use for calculating the optimal number of bins when\n        `bins` is 'auto'. Options include 'freedman_diaconis', 'sturges', \n        and 'sqrt'. Default is 'freedman_diaconis'.\n    data_range : tuple, optional\n        A tuple specifying the range of the data as (min, max) for bin\n        calculation. If None, the range is derived from `y_pred`. Default is None.\n\n    Returns\n    -------\n    float\n        The calculated Information Value (IV).\n\n    Raises\n    ------\n    ValueError\n        If an invalid method is specified.\n\n    Examples\n    --------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import calculate_binary_iv\n    >>> y_true = np.""array([0, 1, 0, 1, 1])\n    >>> y_pred = np.array([0.1, 0.8, 0.2, 0.7, 0.9])\n    >>> print(calculate_binary_iv(y_true, y_pred, method='base'))\n    1.6094379124341003\n\n    >>> print(calculate_binary_iv(y_true, y_pred, method='binning', bins=3,\n    ...                           bins_method='sturges'))\n    0.6931471805599453\n\n    Notes\n    -----\n    The Information Value (IV) quantifies the predictive power of a feature or\n    model in binary classification, illustrating its ability to distinguish\n    between classes.\n\n    - The 'base' method calculates IV using the overall percentage of events\n      and non-events:\n\n      .. math::\n        IV = \\sum ((\\% \text{{ of non-events}} - \\% \text{{ of events}}) \times\n        \\ln\\left(\014rac{\\% \text{{ of non-events}} + \\epsilon}\n        {\\% \text{{ of events}} + \\epsilon}\right))\n\n    - The 'binning' method divides `y_pred` into bins and calculates IV for\n      each bin, summing up the contributions from all bins.\n\n    References\n    ----------\n    - Freedman, D. and Diaconis, P. (1981). \"On the histogram as a density estimator:\n      L2 theory.\" Zeitschrift f\303\274r Wahrscheinlichkeitstheorie und verwandte Gebiete.\n    - Sturges, H. A. (1926). \"The choice of a class interval.\" Journal of the American\n      Statistical Association.\n      \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_45calculate_binary_iv = {"calculate_binary_iv", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_45calculate_binary_iv, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_44calculate_binary_iv};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_45calculate_binary_iv(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_true = 0;
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_epsilon = 0;
  PyObject *__pyx_v_method = 0;
  PyObject *__pyx_v_bins = 0;
  PyObject *__pyx_v_bins_method = 0;
  PyObject *__pyx_v_data_range = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_binary_iv (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_true,&__pyx_n_s_y_pred,&__pyx_n_s_epsilon,&__pyx_n_s_method,&__pyx_n_s_bins,&__pyx_n_s_bins_method,&__pyx_n_s_data_range,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_15)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_base)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_auto)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_freedman_diaconis)));

    /* "gofast/tools/mathex.pyx":2000
 *     bins='auto',
 *     bins_method='freedman_diaconis',
 *     data_range=None):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the Information Value (IV) for binary classification problems
 */
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_true)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("calculate_binary_iv", 0, 2, 7, 1); __PYX_ERR(0, 1993, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_epsilon);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bins);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bins_method);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data_range);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1993, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_binary_iv") < 0)) __PYX_ERR(0, 1993, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_true = values[0];
    __pyx_v_y_pred = values[1];
    __pyx_v_epsilon = values[2];
    __pyx_v_method = values[3];
    __pyx_v_bins = values[4];
    __pyx_v_bins_method = values[5];
    __pyx_v_data_range = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_binary_iv", 0, 2, 7, __pyx_nargs); __PYX_ERR(0, 1993, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_binary_iv", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_44calculate_binary_iv(__pyx_self, __pyx_v_y_true, __pyx_v_y_pred, __pyx_v_epsilon, __pyx_v_method, __pyx_v_bins, __pyx_v_bins_method, __pyx_v_data_range);

  /* "gofast/tools/mathex.pyx":1993
 *     return max(1, optimal_bins)  # Ensure at least one bin
 * 
 * def calculate_binary_iv(             # <<<<<<<<<<<<<<
 *     y_true,
 *     y_pred,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_44calculate_binary_iv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_true, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_epsilon, PyObject *__pyx_v_method, PyObject *__pyx_v_bins, PyObject *__pyx_v_bins_method, PyObject *__pyx_v_data_range) {
  PyObject *__pyx_v_msg_meth = NULL;
  PyObject *__pyx_v_percent_events = NULL;
  PyObject *__pyx_v_percent_non_events = NULL;
  PyObject *__pyx_v_bins_array = NULL;
  PyObject *__pyx_v_digitized = NULL;
  PyObject *__pyx_v_iv = NULL;
  Py_ssize_t __pyx_v_bin_index;
  PyObject *__pyx_v_in_bin = NULL;
  PyObject *__pyx_v_bin_true = NULL;
  PyObject *__pyx_v_percent_events_bin = NULL;
  PyObject *__pyx_v_percent_non_events_bin = NULL;
  PyObject *__pyx_v_bin_contribution = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  Py_ssize_t __pyx_t_8;
  Py_UCS4 __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  Py_ssize_t __pyx_t_15;
  Py_ssize_t __pyx_t_16;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__49)
  __Pyx_RefNannySetupContext("calculate_binary_iv", 0);
  __Pyx_TraceCall("calculate_binary_iv", __pyx_f[0], 1993, 0, __PYX_ERR(0, 1993, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_true);
  __Pyx_INCREF(__pyx_v_y_pred);
  __Pyx_INCREF(__pyx_v_epsilon);
  __Pyx_INCREF(__pyx_v_method);
  __Pyx_INCREF(__pyx_v_bins);
  __Pyx_INCREF(__pyx_v_bins_method);

  /* "gofast/tools/mathex.pyx":2083
 *     """
 *     # Ensure y_true and y_pred are numpy arrays for efficient computation
 *     y_true, y_pred = np.asarray(y_true), np.asarray(y_pred)             # <<<<<<<<<<<<<<
 * 
 *     # Validate and process epsilon
 */
  __Pyx_TraceLine(2083,0,__PYX_ERR(0, 2083, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2083, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2083, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_true};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2083, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2083, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2083, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y_pred};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2083, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y_true, __pyx_t_1);
  __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2086
 * 
 *     # Validate and process epsilon
 *     if isinstance(epsilon, str):             # <<<<<<<<<<<<<<
 *         if epsilon == 'auto':
 *             epsilon = determine_epsilon(y_pred)
 */
  __Pyx_TraceLine(2086,0,__PYX_ERR(0, 2086, __pyx_L1_error))
  __pyx_t_6 = PyUnicode_Check(__pyx_v_epsilon); 
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":2087
 *     # Validate and process epsilon
 *     if isinstance(epsilon, str):
 *         if epsilon == 'auto':             # <<<<<<<<<<<<<<
 *             epsilon = determine_epsilon(y_pred)
 *         else:
 */
    __Pyx_TraceLine(2087,0,__PYX_ERR(0, 2087, __pyx_L1_error))
    __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_epsilon, __pyx_n_u_auto, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 2087, __pyx_L1_error)
    if (likely(__pyx_t_6)) {

      /* "gofast/tools/mathex.pyx":2088
 *     if isinstance(epsilon, str):
 *         if epsilon == 'auto':
 *             epsilon = determine_epsilon(y_pred)             # <<<<<<<<<<<<<<
 *         else:
 *             raise ValueError(
 */
      __Pyx_TraceLine(2088,0,__PYX_ERR(0, 2088, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_determine_epsilon); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2088, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_5 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_5)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_5);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_y_pred};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2088, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2087
 *     # Validate and process epsilon
 *     if isinstance(epsilon, str):
 *         if epsilon == 'auto':             # <<<<<<<<<<<<<<
 *             epsilon = determine_epsilon(y_pred)
 *         else:
 */
      goto __pyx_L4;
    }

    /* "gofast/tools/mathex.pyx":2090
 *             epsilon = determine_epsilon(y_pred)
 *         else:
 *             raise ValueError(             # <<<<<<<<<<<<<<
 *                 "Epsilon value 'auto' is acceptable or should be a numeric value.")
 * 
 */
    __Pyx_TraceLine(2090,0,__PYX_ERR(0, 2090, __pyx_L1_error))
    /*else*/ {
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__50, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2090, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __PYX_ERR(0, 2090, __pyx_L1_error)
    }
    __pyx_L4:;

    /* "gofast/tools/mathex.pyx":2086
 * 
 *     # Validate and process epsilon
 *     if isinstance(epsilon, str):             # <<<<<<<<<<<<<<
 *         if epsilon == 'auto':
 *             epsilon = determine_epsilon(y_pred)
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":2093
 *                 "Epsilon value 'auto' is acceptable or should be a numeric value.")
 * 
 *     elif not isinstance(epsilon, (int, float)):             # <<<<<<<<<<<<<<
 *         raise ValueError("Epsilon must be a numeric value or 'auto'.")
 *     else:
 */
  __Pyx_TraceLine(2093,0,__PYX_ERR(0, 2093, __pyx_L1_error))
  __pyx_t_7 = PyInt_Check(__pyx_v_epsilon); 
  if (!__pyx_t_7) {
  } else {
    __pyx_t_6 = __pyx_t_7;
    goto __pyx_L5_bool_binop_done;
  }
  __pyx_t_7 = PyFloat_Check(__pyx_v_epsilon); 
  __pyx_t_6 = __pyx_t_7;
  __pyx_L5_bool_binop_done:;
  __pyx_t_7 = (!__pyx_t_6);
  if (unlikely(__pyx_t_7)) {

    /* "gofast/tools/mathex.pyx":2094
 * 
 *     elif not isinstance(epsilon, (int, float)):
 *         raise ValueError("Epsilon must be a numeric value or 'auto'.")             # <<<<<<<<<<<<<<
 *     else:
 *         epsilon = float(epsilon)
 */
    __Pyx_TraceLine(2094,0,__PYX_ERR(0, 2094, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__51, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2094, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 2094, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2093
 *                 "Epsilon value 'auto' is acceptable or should be a numeric value.")
 * 
 *     elif not isinstance(epsilon, (int, float)):             # <<<<<<<<<<<<<<
 *         raise ValueError("Epsilon must be a numeric value or 'auto'.")
 *     else:
 */
  }

  /* "gofast/tools/mathex.pyx":2096
 *         raise ValueError("Epsilon must be a numeric value or 'auto'.")
 *     else:
 *         epsilon = float(epsilon)             # <<<<<<<<<<<<<<
 * 
 *     # Validate method parameter
 */
  __Pyx_TraceLine(2096,0,__PYX_ERR(0, 2096, __pyx_L1_error))
  /*else*/ {
    __pyx_t_3 = __Pyx_PyNumber_Float(__pyx_v_epsilon); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2096, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_epsilon, __pyx_t_3);
    __pyx_t_3 = 0;
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":2099
 * 
 *     # Validate method parameter
 *     msg_meth=copy.deepcopy(method)             # <<<<<<<<<<<<<<
 *     method = normalize_string(
 *         method, target_strs= ['base', 'binning'], match_method='contains',
 */
  __Pyx_TraceLine(2099,0,__PYX_ERR(0, 2099, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2099, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2099, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_method};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2099, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_v_msg_meth = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2100
 *     # Validate method parameter
 *     msg_meth=copy.deepcopy(method)
 *     method = normalize_string(             # <<<<<<<<<<<<<<
 *         method, target_strs= ['base', 'binning'], match_method='contains',
 *         return_target_only=True, raise_exception=True , error_msg= (
 */
  __Pyx_TraceLine(2100,0,__PYX_ERR(0, 2100, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_normalize_string); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);

  /* "gofast/tools/mathex.pyx":2101
 *     msg_meth=copy.deepcopy(method)
 *     method = normalize_string(
 *         method, target_strs= ['base', 'binning'], match_method='contains',             # <<<<<<<<<<<<<<
 *         return_target_only=True, raise_exception=True , error_msg= (
 *             f"Invalid method '{msg_meth}'. Use 'base' or 'binning'.")
 */
  __Pyx_TraceLine(2101,0,__PYX_ERR(0, 2101, __pyx_L1_error))
  __pyx_t_5 = PyTuple_New(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF(__pyx_v_method);
  __Pyx_GIVEREF(__pyx_v_method);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_method)) __PYX_ERR(0, 2100, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_u_base);
  __Pyx_GIVEREF(__pyx_n_u_base);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_u_base)) __PYX_ERR(0, 2101, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_binning);
  __Pyx_GIVEREF(__pyx_n_u_binning);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_u_binning)) __PYX_ERR(0, 2101, __pyx_L1_error);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_target_strs, __pyx_t_2) < 0) __PYX_ERR(0, 2101, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_match_method, __pyx_n_u_contains) < 0) __PYX_ERR(0, 2101, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2102
 *     method = normalize_string(
 *         method, target_strs= ['base', 'binning'], match_method='contains',
 *         return_target_only=True, raise_exception=True , error_msg= (             # <<<<<<<<<<<<<<
 *             f"Invalid method '{msg_meth}'. Use 'base' or 'binning'.")
 *         )
 */
  __Pyx_TraceLine(2102,0,__PYX_ERR(0, 2102, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_return_target_only, Py_True) < 0) __PYX_ERR(0, 2101, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_raise_exception, Py_True) < 0) __PYX_ERR(0, 2101, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2103
 *         method, target_strs= ['base', 'binning'], match_method='contains',
 *         return_target_only=True, raise_exception=True , error_msg= (
 *             f"Invalid method '{msg_meth}'. Use 'base' or 'binning'.")             # <<<<<<<<<<<<<<
 *         )
 *     # Base method for IV calculation
 */
  __Pyx_TraceLine(2103,0,__PYX_ERR(0, 2103, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = 0;
  __pyx_t_9 = 127;
  __Pyx_INCREF(__pyx_kp_u_Invalid_method);
  __pyx_t_8 += 16;
  __Pyx_GIVEREF(__pyx_kp_u_Invalid_method);
  PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Invalid_method);
  __pyx_t_10 = __Pyx_PyObject_FormatSimple(__pyx_v_msg_meth, __pyx_empty_unicode); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_9 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_10) > __pyx_t_9) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_10) : __pyx_t_9;
  __pyx_t_8 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_10);
  __Pyx_GIVEREF(__pyx_t_10);
  PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_10);
  __pyx_t_10 = 0;
  __Pyx_INCREF(__pyx_kp_u_Use_base_or_binning);
  __pyx_t_8 += 27;
  __Pyx_GIVEREF(__pyx_kp_u_Use_base_or_binning);
  PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_Use_base_or_binning);
  __pyx_t_10 = __Pyx_PyUnicode_Join(__pyx_t_2, 3, __pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2103, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_error_msg, __pyx_t_10) < 0) __PYX_ERR(0, 2101, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

  /* "gofast/tools/mathex.pyx":2100
 *     # Validate method parameter
 *     msg_meth=copy.deepcopy(method)
 *     method = normalize_string(             # <<<<<<<<<<<<<<
 *         method, target_strs= ['base', 'binning'], match_method='contains',
 *         return_target_only=True, raise_exception=True , error_msg= (
 */
  __Pyx_TraceLine(2100,0,__PYX_ERR(0, 2100, __pyx_L1_error))
  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_method, __pyx_t_10);
  __pyx_t_10 = 0;

  /* "gofast/tools/mathex.pyx":2106
 *         )
 *     # Base method for IV calculation
 *     if method == 'base':             # <<<<<<<<<<<<<<
 *         percent_events = y_true.mean()
 *         percent_non_events = 1 - percent_events
 */
  __Pyx_TraceLine(2106,0,__PYX_ERR(0, 2106, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_base, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 2106, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":2107
 *     # Base method for IV calculation
 *     if method == 'base':
 *         percent_events = y_true.mean()             # <<<<<<<<<<<<<<
 *         percent_non_events = 1 - percent_events
 *         return np.sum((percent_non_events - percent_events) * np.log(
 */
    __Pyx_TraceLine(2107,0,__PYX_ERR(0, 2107, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y_true, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2107, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
      __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2107, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_v_percent_events = __pyx_t_10;
    __pyx_t_10 = 0;

    /* "gofast/tools/mathex.pyx":2108
 *     if method == 'base':
 *         percent_events = y_true.mean()
 *         percent_non_events = 1 - percent_events             # <<<<<<<<<<<<<<
 *         return np.sum((percent_non_events - percent_events) * np.log(
 *             (percent_non_events + epsilon) / (percent_events + epsilon)))
 */
    __Pyx_TraceLine(2108,0,__PYX_ERR(0, 2108, __pyx_L1_error))
    __pyx_t_10 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_percent_events, 1, 0, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2108, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_v_percent_non_events = __pyx_t_10;
    __pyx_t_10 = 0;

    /* "gofast/tools/mathex.pyx":2109
 *         percent_events = y_true.mean()
 *         percent_non_events = 1 - percent_events
 *         return np.sum((percent_non_events - percent_events) * np.log(             # <<<<<<<<<<<<<<
 *             (percent_non_events + epsilon) / (percent_events + epsilon)))
 * 
 */
    __Pyx_TraceLine(2109,0,__PYX_ERR(0, 2109, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_Subtract(__pyx_v_percent_non_events, __pyx_v_percent_events); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_log); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2110
 *         percent_non_events = 1 - percent_events
 *         return np.sum((percent_non_events - percent_events) * np.log(
 *             (percent_non_events + epsilon) / (percent_events + epsilon)))             # <<<<<<<<<<<<<<
 * 
 *     # Binning method for IV calculation
 */
    __Pyx_TraceLine(2110,0,__PYX_ERR(0, 2110, __pyx_L1_error))
    __pyx_t_2 = PyNumber_Add(__pyx_v_percent_non_events, __pyx_v_epsilon); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2110, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_12 = PyNumber_Add(__pyx_v_percent_events, __pyx_v_epsilon); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2110, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_12);
    __pyx_t_13 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2110, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_13);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
    __pyx_t_12 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_12)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_12);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_t_13};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
      __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }

    /* "gofast/tools/mathex.pyx":2109
 *         percent_events = y_true.mean()
 *         percent_non_events = 1 - percent_events
 *         return np.sum((percent_non_events - percent_events) * np.log(             # <<<<<<<<<<<<<<
 *             (percent_non_events + epsilon) / (percent_events + epsilon)))
 * 
 */
    __Pyx_TraceLine(2109,0,__PYX_ERR(0, 2109, __pyx_L1_error))
    __pyx_t_11 = PyNumber_Multiply(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2109, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_11};
      __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2109, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_r = __pyx_t_10;
    __pyx_t_10 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":2106
 *         )
 *     # Base method for IV calculation
 *     if method == 'base':             # <<<<<<<<<<<<<<
 *         percent_events = y_true.mean()
 *         percent_non_events = 1 - percent_events
 */
  }

  /* "gofast/tools/mathex.pyx":2113
 * 
 *     # Binning method for IV calculation
 *     elif method == 'binning':             # <<<<<<<<<<<<<<
 *         if isinstance (bins, str):
 *             if bins=='auto' and bins_method is None:
 */
  __Pyx_TraceLine(2113,0,__PYX_ERR(0, 2113, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_binning, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 2113, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":2114
 *     # Binning method for IV calculation
 *     elif method == 'binning':
 *         if isinstance (bins, str):             # <<<<<<<<<<<<<<
 *             if bins=='auto' and bins_method is None:
 *                 warnings.warn(
 */
    __Pyx_TraceLine(2114,0,__PYX_ERR(0, 2114, __pyx_L1_error))
    __pyx_t_7 = PyUnicode_Check(__pyx_v_bins); 
    if (__pyx_t_7) {

      /* "gofast/tools/mathex.pyx":2115
 *     elif method == 'binning':
 *         if isinstance (bins, str):
 *             if bins=='auto' and bins_method is None:             # <<<<<<<<<<<<<<
 *                 warnings.warn(
 *                     "The 'bins' parameter is set to 'auto', but no 'bins_method'"
 */
      __Pyx_TraceLine(2115,0,__PYX_ERR(0, 2115, __pyx_L1_error))
      __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_bins, __pyx_n_u_auto, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 2115, __pyx_L1_error)
      if (__pyx_t_6) {
      } else {
        __pyx_t_7 = __pyx_t_6;
        goto __pyx_L10_bool_binop_done;
      }
      __pyx_t_6 = (__pyx_v_bins_method == Py_None);
      __pyx_t_7 = __pyx_t_6;
      __pyx_L10_bool_binop_done:;
      if (__pyx_t_7) {

        /* "gofast/tools/mathex.pyx":2116
 *         if isinstance (bins, str):
 *             if bins=='auto' and bins_method is None:
 *                 warnings.warn(             # <<<<<<<<<<<<<<
 *                     "The 'bins' parameter is set to 'auto', but no 'bins_method'"
 *                     " has been specified. Defaulting to the 'freedman_diaconis'"
 */
        __Pyx_TraceLine(2116,0,__PYX_ERR(0, 2116, __pyx_L1_error))
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_warnings); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2116, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_warn); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2116, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_11);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __pyx_t_5 = NULL;
        __pyx_t_4 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_11))) {
          __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_11);
          if (likely(__pyx_t_5)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
            __Pyx_INCREF(__pyx_t_5);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_11, function);
            __pyx_t_4 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_kp_u_The_bins_parameter_is_set_to_aut};
          __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2116, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
        }
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;

        /* "gofast/tools/mathex.pyx":2120
 *                     " has been specified. Defaulting to the 'freedman_diaconis'"
 *                     " method for determining the optimal number of bins.")
 *                 bins_method="freedman_diaconis"             # <<<<<<<<<<<<<<
 *             bins = calculate_optimal_bins(
 *                 y_pred, method=bins_method, data_range=data_range)
 */
        __Pyx_TraceLine(2120,0,__PYX_ERR(0, 2120, __pyx_L1_error))
        __Pyx_INCREF(__pyx_n_u_freedman_diaconis);
        __Pyx_DECREF_SET(__pyx_v_bins_method, __pyx_n_u_freedman_diaconis);

        /* "gofast/tools/mathex.pyx":2115
 *     elif method == 'binning':
 *         if isinstance (bins, str):
 *             if bins=='auto' and bins_method is None:             # <<<<<<<<<<<<<<
 *                 warnings.warn(
 *                     "The 'bins' parameter is set to 'auto', but no 'bins_method'"
 */
      }

      /* "gofast/tools/mathex.pyx":2121
 *                     " method for determining the optimal number of bins.")
 *                 bins_method="freedman_diaconis"
 *             bins = calculate_optimal_bins(             # <<<<<<<<<<<<<<
 *                 y_pred, method=bins_method, data_range=data_range)
 * 
 */
      __Pyx_TraceLine(2121,0,__PYX_ERR(0, 2121, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_calculate_optimal_bins); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2121, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);

      /* "gofast/tools/mathex.pyx":2122
 *                 bins_method="freedman_diaconis"
 *             bins = calculate_optimal_bins(
 *                 y_pred, method=bins_method, data_range=data_range)             # <<<<<<<<<<<<<<
 * 
 *         elif not isinstance(bins, (int, float)) or bins < 1:
 */
      __Pyx_TraceLine(2122,0,__PYX_ERR(0, 2122, __pyx_L1_error))
      __pyx_t_11 = PyTuple_New(1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2121, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_INCREF(__pyx_v_y_pred);
      __Pyx_GIVEREF(__pyx_v_y_pred);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_11, 0, __pyx_v_y_pred)) __PYX_ERR(0, 2121, __pyx_L1_error);
      __pyx_t_5 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2122, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_method, __pyx_v_bins_method) < 0) __PYX_ERR(0, 2122, __pyx_L1_error)
      if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_data_range, __pyx_v_data_range) < 0) __PYX_ERR(0, 2122, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":2121
 *                     " method for determining the optimal number of bins.")
 *                 bins_method="freedman_diaconis"
 *             bins = calculate_optimal_bins(             # <<<<<<<<<<<<<<
 *                 y_pred, method=bins_method, data_range=data_range)
 * 
 */
      __Pyx_TraceLine(2121,0,__PYX_ERR(0, 2121, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_11, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2121, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF_SET(__pyx_v_bins, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2114
 *     # Binning method for IV calculation
 *     elif method == 'binning':
 *         if isinstance (bins, str):             # <<<<<<<<<<<<<<
 *             if bins=='auto' and bins_method is None:
 *                 warnings.warn(
 */
      goto __pyx_L8;
    }

    /* "gofast/tools/mathex.pyx":2124
 *                 y_pred, method=bins_method, data_range=data_range)
 * 
 *         elif not isinstance(bins, (int, float)) or bins < 1:             # <<<<<<<<<<<<<<
 *             raise ValueError("Bins must be 'auto' or a positive integer.")
 * 
 */
    __Pyx_TraceLine(2124,0,__PYX_ERR(0, 2124, __pyx_L1_error))
    __pyx_t_14 = PyInt_Check(__pyx_v_bins); 
    if (!__pyx_t_14) {
    } else {
      __pyx_t_6 = __pyx_t_14;
      goto __pyx_L14_bool_binop_done;
    }
    __pyx_t_14 = PyFloat_Check(__pyx_v_bins); 
    __pyx_t_6 = __pyx_t_14;
    __pyx_L14_bool_binop_done:;
    __pyx_t_14 = (!__pyx_t_6);
    if (!__pyx_t_14) {
    } else {
      __pyx_t_7 = __pyx_t_14;
      goto __pyx_L12_bool_binop_done;
    }
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_bins, __pyx_int_1, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2124, __pyx_L1_error)
    __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 2124, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = __pyx_t_14;
    __pyx_L12_bool_binop_done:;
    if (unlikely(__pyx_t_7)) {

      /* "gofast/tools/mathex.pyx":2125
 * 
 *         elif not isinstance(bins, (int, float)) or bins < 1:
 *             raise ValueError("Bins must be 'auto' or a positive integer.")             # <<<<<<<<<<<<<<
 * 
 *         if isinstance ( bins, float):
 */
      __Pyx_TraceLine(2125,0,__PYX_ERR(0, 2125, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__52, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2125, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_Raise(__pyx_t_3, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __PYX_ERR(0, 2125, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":2124
 *                 y_pred, method=bins_method, data_range=data_range)
 * 
 *         elif not isinstance(bins, (int, float)) or bins < 1:             # <<<<<<<<<<<<<<
 *             raise ValueError("Bins must be 'auto' or a positive integer.")
 * 
 */
    }
    __pyx_L8:;

    /* "gofast/tools/mathex.pyx":2127
 *             raise ValueError("Bins must be 'auto' or a positive integer.")
 * 
 *         if isinstance ( bins, float):             # <<<<<<<<<<<<<<
 *             bins =int (bins )
 * 
 */
    __Pyx_TraceLine(2127,0,__PYX_ERR(0, 2127, __pyx_L1_error))
    __pyx_t_7 = PyFloat_Check(__pyx_v_bins); 
    if (__pyx_t_7) {

      /* "gofast/tools/mathex.pyx":2128
 * 
 *         if isinstance ( bins, float):
 *             bins =int (bins )             # <<<<<<<<<<<<<<
 * 
 *         bins_array = np.linspace(0, 1, bins + 1)
 */
      __Pyx_TraceLine(2128,0,__PYX_ERR(0, 2128, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyNumber_Int(__pyx_v_bins); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2128, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF_SET(__pyx_v_bins, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2127
 *             raise ValueError("Bins must be 'auto' or a positive integer.")
 * 
 *         if isinstance ( bins, float):             # <<<<<<<<<<<<<<
 *             bins =int (bins )
 * 
 */
    }

    /* "gofast/tools/mathex.pyx":2130
 *             bins =int (bins )
 * 
 *         bins_array = np.linspace(0, 1, bins + 1)             # <<<<<<<<<<<<<<
 *         digitized = np.digitize(y_pred, bins_array) - 1
 *         iv = 0
 */
    __Pyx_TraceLine(2130,0,__PYX_ERR(0, 2130, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_linspace); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_v_bins, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2130, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_10 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_10, __pyx_int_0, __pyx_int_1, __pyx_t_5};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_4, 3+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2130, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_v_bins_array = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":2131
 * 
 *         bins_array = np.linspace(0, 1, bins + 1)
 *         digitized = np.digitize(y_pred, bins_array) - 1             # <<<<<<<<<<<<<<
 *         iv = 0
 * 
 */
    __Pyx_TraceLine(2131,0,__PYX_ERR(0, 2131, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_digitize); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_11, __pyx_v_y_pred, __pyx_v_bins_array};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2131, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_5 = __Pyx_PyInt_SubtractObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_digitized = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":2132
 *         bins_array = np.linspace(0, 1, bins + 1)
 *         digitized = np.digitize(y_pred, bins_array) - 1
 *         iv = 0             # <<<<<<<<<<<<<<
 * 
 *         for bin_index in range(len(bins_array) - 1):
 */
    __Pyx_TraceLine(2132,0,__PYX_ERR(0, 2132, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_v_iv = __pyx_int_0;

    /* "gofast/tools/mathex.pyx":2134
 *         iv = 0
 * 
 *         for bin_index in range(len(bins_array) - 1):             # <<<<<<<<<<<<<<
 *             in_bin = digitized == bin_index
 *             if not in_bin.any(): # if np.sum(indices) == 0:
 */
    __Pyx_TraceLine(2134,0,__PYX_ERR(0, 2134, __pyx_L1_error))
    __pyx_t_8 = PyObject_Length(__pyx_v_bins_array); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2134, __pyx_L1_error)
    __pyx_t_15 = (__pyx_t_8 - 1);
    __pyx_t_8 = __pyx_t_15;
    for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_8; __pyx_t_16+=1) {
      __pyx_v_bin_index = __pyx_t_16;

      /* "gofast/tools/mathex.pyx":2135
 * 
 *         for bin_index in range(len(bins_array) - 1):
 *             in_bin = digitized == bin_index             # <<<<<<<<<<<<<<
 *             if not in_bin.any(): # if np.sum(indices) == 0:
 *                 continue # # Skip empty bins
 */
      __Pyx_TraceLine(2135,0,__PYX_ERR(0, 2135, __pyx_L1_error))
      __pyx_t_5 = PyInt_FromSsize_t(__pyx_v_bin_index); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2135, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_3 = PyObject_RichCompare(__pyx_v_digitized, __pyx_t_5, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2135, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_in_bin, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2136
 *         for bin_index in range(len(bins_array) - 1):
 *             in_bin = digitized == bin_index
 *             if not in_bin.any(): # if np.sum(indices) == 0:             # <<<<<<<<<<<<<<
 *                 continue # # Skip empty bins
 * 
 */
      __Pyx_TraceLine(2136,0,__PYX_ERR(0, 2136, __pyx_L1_error))
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_in_bin, __pyx_n_s_any); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2136, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_11 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_11, NULL};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2136, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 2136, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_14 = (!__pyx_t_7);
      if (__pyx_t_14) {

        /* "gofast/tools/mathex.pyx":2137
 *             in_bin = digitized == bin_index
 *             if not in_bin.any(): # if np.sum(indices) == 0:
 *                 continue # # Skip empty bins             # <<<<<<<<<<<<<<
 * 
 *             bin_true = y_true[in_bin]
 */
        __Pyx_TraceLine(2137,0,__PYX_ERR(0, 2137, __pyx_L1_error))
        goto __pyx_L17_continue;

        /* "gofast/tools/mathex.pyx":2136
 *         for bin_index in range(len(bins_array) - 1):
 *             in_bin = digitized == bin_index
 *             if not in_bin.any(): # if np.sum(indices) == 0:             # <<<<<<<<<<<<<<
 *                 continue # # Skip empty bins
 * 
 */
      }

      /* "gofast/tools/mathex.pyx":2139
 *                 continue # # Skip empty bins
 * 
 *             bin_true = y_true[in_bin]             # <<<<<<<<<<<<<<
 *             percent_events_bin = bin_true.mean()
 *             percent_non_events_bin = 1 - percent_events_bin
 */
      __Pyx_TraceLine(2139,0,__PYX_ERR(0, 2139, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_y_true, __pyx_v_in_bin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2139, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_bin_true, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2140
 * 
 *             bin_true = y_true[in_bin]
 *             percent_events_bin = bin_true.mean()             # <<<<<<<<<<<<<<
 *             percent_non_events_bin = 1 - percent_events_bin
 *             bin_contribution = (percent_non_events_bin - percent_events_bin) * np.log(
 */
      __Pyx_TraceLine(2140,0,__PYX_ERR(0, 2140, __pyx_L1_error))
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_bin_true, __pyx_n_s_mean); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2140, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_11 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_11, NULL};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2140, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_XDECREF_SET(__pyx_v_percent_events_bin, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2141
 *             bin_true = y_true[in_bin]
 *             percent_events_bin = bin_true.mean()
 *             percent_non_events_bin = 1 - percent_events_bin             # <<<<<<<<<<<<<<
 *             bin_contribution = (percent_non_events_bin - percent_events_bin) * np.log(
 *                 (percent_non_events_bin + epsilon) / (percent_events_bin + epsilon))
 */
      __Pyx_TraceLine(2141,0,__PYX_ERR(0, 2141, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_percent_events_bin, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2141, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_XDECREF_SET(__pyx_v_percent_non_events_bin, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":2142
 *             percent_events_bin = bin_true.mean()
 *             percent_non_events_bin = 1 - percent_events_bin
 *             bin_contribution = (percent_non_events_bin - percent_events_bin) * np.log(             # <<<<<<<<<<<<<<
 *                 (percent_non_events_bin + epsilon) / (percent_events_bin + epsilon))
 *             iv += bin_contribution if not np.isnan(bin_contribution) else 0
 */
      __Pyx_TraceLine(2142,0,__PYX_ERR(0, 2142, __pyx_L1_error))
      __pyx_t_3 = PyNumber_Subtract(__pyx_v_percent_non_events_bin, __pyx_v_percent_events_bin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2142, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2142, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_log); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2142, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;

      /* "gofast/tools/mathex.pyx":2143
 *             percent_non_events_bin = 1 - percent_events_bin
 *             bin_contribution = (percent_non_events_bin - percent_events_bin) * np.log(
 *                 (percent_non_events_bin + epsilon) / (percent_events_bin + epsilon))             # <<<<<<<<<<<<<<
 *             iv += bin_contribution if not np.isnan(bin_contribution) else 0
 * 
 */
      __Pyx_TraceLine(2143,0,__PYX_ERR(0, 2143, __pyx_L1_error))
      __pyx_t_11 = PyNumber_Add(__pyx_v_percent_non_events_bin, __pyx_v_epsilon); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2143, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_1 = PyNumber_Add(__pyx_v_percent_events_bin, __pyx_v_epsilon); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2143, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_13 = __Pyx_PyNumber_Divide(__pyx_t_11, __pyx_t_1); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2143, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_13);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_13};
        __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2142, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }

      /* "gofast/tools/mathex.pyx":2142
 *             percent_events_bin = bin_true.mean()
 *             percent_non_events_bin = 1 - percent_events_bin
 *             bin_contribution = (percent_non_events_bin - percent_events_bin) * np.log(             # <<<<<<<<<<<<<<
 *                 (percent_non_events_bin + epsilon) / (percent_events_bin + epsilon))
 *             iv += bin_contribution if not np.isnan(bin_contribution) else 0
 */
      __Pyx_TraceLine(2142,0,__PYX_ERR(0, 2142, __pyx_L1_error))
      __pyx_t_10 = PyNumber_Multiply(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2142, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF_SET(__pyx_v_bin_contribution, __pyx_t_10);
      __pyx_t_10 = 0;

      /* "gofast/tools/mathex.pyx":2144
 *             bin_contribution = (percent_non_events_bin - percent_events_bin) * np.log(
 *                 (percent_non_events_bin + epsilon) / (percent_events_bin + epsilon))
 *             iv += bin_contribution if not np.isnan(bin_contribution) else 0             # <<<<<<<<<<<<<<
 * 
 *         return iv
 */
      __Pyx_TraceLine(2144,0,__PYX_ERR(0, 2144, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2144, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_13 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_isnan); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2144, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_13);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_13))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_13);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_13);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_13, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_bin_contribution};
        __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_13, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2144, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
      }
      __pyx_t_14 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 2144, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_7 = (!__pyx_t_14);
      if (__pyx_t_7) {
        __Pyx_INCREF(__pyx_v_bin_contribution);
        __pyx_t_10 = __pyx_v_bin_contribution;
      } else {
        __Pyx_INCREF(__pyx_int_0);
        __pyx_t_10 = __pyx_int_0;
      }
      __pyx_t_5 = PyNumber_InPlaceAdd(__pyx_v_iv, __pyx_t_10); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2144, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF_SET(__pyx_v_iv, __pyx_t_5);
      __pyx_t_5 = 0;
      __pyx_L17_continue:;
    }

    /* "gofast/tools/mathex.pyx":2146
 *             iv += bin_contribution if not np.isnan(bin_contribution) else 0
 * 
 *         return iv             # <<<<<<<<<<<<<<
 * 
 * def determine_epsilon(y_pred, base_epsilon=1e-15, scale_factor=1e-5):
 */
    __Pyx_TraceLine(2146,0,__PYX_ERR(0, 2146, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_iv);
    __pyx_r = __pyx_v_iv;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":2113
 * 
 *     # Binning method for IV calculation
 *     elif method == 'binning':             # <<<<<<<<<<<<<<
 *         if isinstance (bins, str):
 *             if bins=='auto' and bins_method is None:
 */
  }

  /* "gofast/tools/mathex.pyx":1993
 *     return max(1, optimal_bins)  # Ensure at least one bin
 * 
 * def calculate_binary_iv(             # <<<<<<<<<<<<<<
 *     y_true,
 *     y_pred,
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_binary_iv", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_msg_meth);
  __Pyx_XDECREF(__pyx_v_percent_events);
  __Pyx_XDECREF(__pyx_v_percent_non_events);
  __Pyx_XDECREF(__pyx_v_bins_array);
  __Pyx_XDECREF(__pyx_v_digitized);
  __Pyx_XDECREF(__pyx_v_iv);
  __Pyx_XDECREF(__pyx_v_in_bin);
  __Pyx_XDECREF(__pyx_v_bin_true);
  __Pyx_XDECREF(__pyx_v_percent_events_bin);
  __Pyx_XDECREF(__pyx_v_percent_non_events_bin);
  __Pyx_XDECREF(__pyx_v_bin_contribution);
  __Pyx_XDECREF(__pyx_v_y_true);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XDECREF(__pyx_v_method);
  __Pyx_XDECREF(__pyx_v_bins);
  __Pyx_XDECREF(__pyx_v_bins_method);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2148
 *         return iv
 * 
 * def determine_epsilon(y_pred, base_epsilon=1e-15, scale_factor=1e-5):             # <<<<<<<<<<<<<<
 *     """
 *     Determine an appropriate epsilon value based on the predictions.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_47determine_epsilon(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_46determine_epsilon, "\n    Determine an appropriate epsilon value based on the predictions.\n\n    If any predicted value is greater than 0, epsilon is set as a fraction \n    of the smallest non-zero prediction to avoid division by zero in \n    logarithmic calculations. Otherwise, a default small epsilon value is used.\n\n    Parameters\n    ----------\n    y_pred : array-like\n        Predicted probabilities or values.\n    base_epsilon : float, optional\n        The minimum allowed epsilon value to ensure it's not too small, \n        by default 1e-15.\n    scale_factor : float, optional\n        The factor to scale the minimum non-zero prediction by to determine \n        epsilon, by default 1e-5.\n\n    Returns\n    -------\n    float\n        The determined epsilon value.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_47determine_epsilon = {"determine_epsilon", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_47determine_epsilon, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_46determine_epsilon};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_47determine_epsilon(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y_pred = 0;
  PyObject *__pyx_v_base_epsilon = 0;
  PyObject *__pyx_v_scale_factor = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("determine_epsilon (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y_pred,&__pyx_n_s_base_epsilon,&__pyx_n_s_scale_factor,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_15)));
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1eneg_5)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y_pred)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2148, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_base_epsilon);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2148, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_scale_factor);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2148, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "determine_epsilon") < 0)) __PYX_ERR(0, 2148, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y_pred = values[0];
    __pyx_v_base_epsilon = values[1];
    __pyx_v_scale_factor = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("determine_epsilon", 0, 1, 3, __pyx_nargs); __PYX_ERR(0, 2148, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.determine_epsilon", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_46determine_epsilon(__pyx_self, __pyx_v_y_pred, __pyx_v_base_epsilon, __pyx_v_scale_factor);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_46determine_epsilon(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y_pred, PyObject *__pyx_v_base_epsilon, PyObject *__pyx_v_scale_factor) {
  PyObject *__pyx_v_positive_preds = NULL;
  PyObject *__pyx_v_min_non_zero_pred = NULL;
  PyObject *__pyx_v_epsilon = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__53)
  __Pyx_RefNannySetupContext("determine_epsilon", 0);
  __Pyx_TraceCall("determine_epsilon", __pyx_f[0], 2148, 0, __PYX_ERR(0, 2148, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y_pred);

  /* "gofast/tools/mathex.pyx":2172
 *         The determined epsilon value.
 *     """
 *     if not isinstance (y_pred, np.ndarray):             # <<<<<<<<<<<<<<
 *         y_pred = np.asarray(y_pred )
 *     # if np.any(y_pred > 0):
 */
  __Pyx_TraceLine(2172,0,__PYX_ERR(0, 2172, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2172, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2172, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = PyObject_IsInstance(__pyx_v_y_pred, __pyx_t_2); if (unlikely(__pyx_t_3 == ((int)-1))) __PYX_ERR(0, 2172, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = (!__pyx_t_3);
  if (__pyx_t_4) {

    /* "gofast/tools/mathex.pyx":2173
 *     """
 *     if not isinstance (y_pred, np.ndarray):
 *         y_pred = np.asarray(y_pred )             # <<<<<<<<<<<<<<
 *     # if np.any(y_pred > 0):
 *     #     # Find the minimum non-zero predicted probability/value
 */
    __Pyx_TraceLine(2173,0,__PYX_ERR(0, 2173, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_y_pred};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2173, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_y_pred, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2172
 *         The determined epsilon value.
 *     """
 *     if not isinstance (y_pred, np.ndarray):             # <<<<<<<<<<<<<<
 *         y_pred = np.asarray(y_pred )
 *     # if np.any(y_pred > 0):
 */
  }

  /* "gofast/tools/mathex.pyx":2186
 * 
 *     # return epsilon
 *     positive_preds = y_pred[y_pred > 0]             # <<<<<<<<<<<<<<
 *     if positive_preds.size > 0:
 *         min_non_zero_pred = np.min(positive_preds)
 */
  __Pyx_TraceLine(2186,0,__PYX_ERR(0, 2186, __pyx_L1_error))
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_y_pred, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2186, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_y_pred, __pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2186, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_positive_preds = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":2187
 *     # return epsilon
 *     positive_preds = y_pred[y_pred > 0]
 *     if positive_preds.size > 0:             # <<<<<<<<<<<<<<
 *         min_non_zero_pred = np.min(positive_preds)
 *         epsilon = max(min_non_zero_pred * scale_factor, base_epsilon)
 */
  __Pyx_TraceLine(2187,0,__PYX_ERR(0, 2187, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_positive_preds, __pyx_n_s_size); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2187, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_2 = PyObject_RichCompare(__pyx_t_5, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2187, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 2187, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_4) {

    /* "gofast/tools/mathex.pyx":2188
 *     positive_preds = y_pred[y_pred > 0]
 *     if positive_preds.size > 0:
 *         min_non_zero_pred = np.min(positive_preds)             # <<<<<<<<<<<<<<
 *         epsilon = max(min_non_zero_pred * scale_factor, base_epsilon)
 *     else:
 */
    __Pyx_TraceLine(2188,0,__PYX_ERR(0, 2188, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_min); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_positive_preds};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2188, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_v_min_non_zero_pred = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2189
 *     if positive_preds.size > 0:
 *         min_non_zero_pred = np.min(positive_preds)
 *         epsilon = max(min_non_zero_pred * scale_factor, base_epsilon)             # <<<<<<<<<<<<<<
 *     else:
 *         epsilon = base_epsilon
 */
    __Pyx_TraceLine(2189,0,__PYX_ERR(0, 2189, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_base_epsilon);
    __pyx_t_2 = __pyx_v_base_epsilon;
    __pyx_t_1 = PyNumber_Multiply(__pyx_v_min_non_zero_pred, __pyx_v_scale_factor); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2189, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_7 = PyObject_RichCompare(__pyx_t_2, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2189, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 2189, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (__pyx_t_4) {
      __Pyx_INCREF(__pyx_t_2);
      __pyx_t_5 = __pyx_t_2;
    } else {
      __Pyx_INCREF(__pyx_t_1);
      __pyx_t_5 = __pyx_t_1;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_t_5;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_epsilon = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2187
 *     # return epsilon
 *     positive_preds = y_pred[y_pred > 0]
 *     if positive_preds.size > 0:             # <<<<<<<<<<<<<<
 *         min_non_zero_pred = np.min(positive_preds)
 *         epsilon = max(min_non_zero_pred * scale_factor, base_epsilon)
 */
    goto __pyx_L4;
  }

  /* "gofast/tools/mathex.pyx":2191
 *         epsilon = max(min_non_zero_pred * scale_factor, base_epsilon)
 *     else:
 *         epsilon = base_epsilon             # <<<<<<<<<<<<<<
 * 
 *     return epsilon
 */
  __Pyx_TraceLine(2191,0,__PYX_ERR(0, 2191, __pyx_L1_error))
  /*else*/ {
    __Pyx_INCREF(__pyx_v_base_epsilon);
    __pyx_v_epsilon = __pyx_v_base_epsilon;
  }
  __pyx_L4:;

  /* "gofast/tools/mathex.pyx":2193
 *         epsilon = base_epsilon
 * 
 *     return epsilon             # <<<<<<<<<<<<<<
 * 
 * def calculate_residuals(
 */
  __Pyx_TraceLine(2193,0,__PYX_ERR(0, 2193, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_epsilon);
  __pyx_r = __pyx_v_epsilon;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2148
 *         return iv
 * 
 * def determine_epsilon(y_pred, base_epsilon=1e-15, scale_factor=1e-5):             # <<<<<<<<<<<<<<
 *     """
 *     Determine an appropriate epsilon value based on the predictions.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("gofast.tools.mathex.determine_epsilon", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_positive_preds);
  __Pyx_XDECREF(__pyx_v_min_non_zero_pred);
  __Pyx_XDECREF(__pyx_v_epsilon);
  __Pyx_XDECREF(__pyx_v_y_pred);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2195
 *     return epsilon
 * 
 * def calculate_residuals(             # <<<<<<<<<<<<<<
 *     actual: ArrayLike,
 *     predicted: Union[np.ndarray, List[ArrayLike]],
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_49calculate_residuals(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_48calculate_residuals, "\n    Calculate the residuals for regression, binary, or multiclass \n    classification tasks.\n\n    Parameters\n    ----------\n    actual : np.ndarray\n        The actual observed values or class labels.\n    predicted : Union[np.ndarray, List[np.ndarray]]\n        The predicted values for regression or class labels for classification.\n        Can be a list of predicted probabilities for each class from predict_proba.\n    task_type : str, default='regression'\n        The type of task: 'regression', 'binary', or 'multiclass'.\n    predict_proba : np.ndarray, optional\n        Predicted probabilities for each class from predict_proba \n        (for classification tasks).\n\n    Returns\n    -------\n    residuals : np.ndarray\n        The residuals of the model.\n\n    Example\n    -------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import calculate_residuals\n    >>> # For regression\n    >>> actual = np.array([3, -0.5, 2, 7])\n    >>> predicted = np.array([2.5, 0.0, 2, 8])\n    >>> residuals = calculate_residuals(actual, predicted, task_type='regression')\n    >>> print(residuals)\n\n    >>> # For binary classification\n    >>> actual = np.array([0, 1, 0, 1])\n    >>> predicted = np.array([0, 1, 0, 1])  # predicted class labels\n    >>> residuals = calculate_residuals(actual, predicted, task_type='binary')\n    >>> print(residuals)\n\n    >>> # For multiclass classification with predict_proba\n    >>> actual = np.array([0, 1, 2, 1])\n    >>> predict_proba = np.array([[0.7, 0.2, 0.1], [0.1, 0.7, 0.2], \n                                  [0.2, 0.2, 0.6], [0.1, 0.8, 0.1]])\n    >>> residuals = calculate_residuals(actual, None, task_type='multiclass',\n                                        predict_proba=predict_proba)\n    >>> print(residuals)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_49calculate_residuals = {"calculate_residuals", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_49calculate_residuals, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_48calculate_residuals};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_49calculate_residuals(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_actual = 0;
  PyObject *__pyx_v_predicted = 0;
  PyObject *__pyx_v_task_type = 0;
  PyObject *__pyx_v_predict_proba = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("calculate_residuals (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_actual,&__pyx_n_s_predicted,&__pyx_n_s_task_type,&__pyx_n_s_predict_proba,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_regression)));

    /* "gofast/tools/mathex.pyx":2199
 *     predicted: Union[np.ndarray, List[ArrayLike]],
 *     task_type: str = 'regression',
 *     predict_proba: Optional[ArrayLike] = None             # <<<<<<<<<<<<<<
 * ) -> ArrayLike:
 *     """
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_actual)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2195, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_predicted)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2195, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("calculate_residuals", 0, 2, 4, 1); __PYX_ERR(0, 2195, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_task_type);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2195, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_predict_proba);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2195, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "calculate_residuals") < 0)) __PYX_ERR(0, 2195, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_actual = values[0];
    __pyx_v_predicted = values[1];
    __pyx_v_task_type = ((PyObject*)values[2]);
    __pyx_v_predict_proba = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("calculate_residuals", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2195, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_residuals", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_task_type), (&PyUnicode_Type), 0, "task_type", 1))) __PYX_ERR(0, 2198, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_48calculate_residuals(__pyx_self, __pyx_v_actual, __pyx_v_predicted, __pyx_v_task_type, __pyx_v_predict_proba);

  /* "gofast/tools/mathex.pyx":2195
 *     return epsilon
 * 
 * def calculate_residuals(             # <<<<<<<<<<<<<<
 *     actual: ArrayLike,
 *     predicted: Union[np.ndarray, List[ArrayLike]],
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_48calculate_residuals(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_actual, PyObject *__pyx_v_predicted, PyObject *__pyx_v_task_type, PyObject *__pyx_v_predict_proba) {
  PyObject *__pyx_v_prob_true_class = NULL;
  PyObject *__pyx_v_residuals = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  Py_ssize_t __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__54)
  __Pyx_RefNannySetupContext("calculate_residuals", 1);
  __Pyx_TraceCall("calculate_residuals", __pyx_f[0], 2195, 0, __PYX_ERR(0, 2195, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2247
 *     >>> print(residuals)
 *     """
 *     if task_type == 'regression':             # <<<<<<<<<<<<<<
 *         if predicted is None:
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 */
  __Pyx_TraceLine(2247,0,__PYX_ERR(0, 2247, __pyx_L1_error))
  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_task_type, __pyx_n_u_regression, Py_EQ)); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 2247, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":2248
 *     """
 *     if task_type == 'regression':
 *         if predicted is None:             # <<<<<<<<<<<<<<
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 *         return actual - predicted
 */
    __Pyx_TraceLine(2248,0,__PYX_ERR(0, 2248, __pyx_L1_error))
    __pyx_t_1 = (__pyx_v_predicted == Py_None);
    if (unlikely(__pyx_t_1)) {

      /* "gofast/tools/mathex.pyx":2249
 *     if task_type == 'regression':
 *         if predicted is None:
 *             raise ValueError("Predicted values must be provided for regression tasks.")             # <<<<<<<<<<<<<<
 *         return actual - predicted
 *     elif task_type in ['binary', 'multiclass']:
 */
      __Pyx_TraceLine(2249,0,__PYX_ERR(0, 2249, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__55, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2249, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_ERR(0, 2249, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":2248
 *     """
 *     if task_type == 'regression':
 *         if predicted is None:             # <<<<<<<<<<<<<<
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 *         return actual - predicted
 */
    }

    /* "gofast/tools/mathex.pyx":2250
 *         if predicted is None:
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 *         return actual - predicted             # <<<<<<<<<<<<<<
 *     elif task_type in ['binary', 'multiclass']:
 *         if predict_proba is not None:
 */
    __Pyx_TraceLine(2250,0,__PYX_ERR(0, 2250, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_2 = PyNumber_Subtract(__pyx_v_actual, __pyx_v_predicted); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2250, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":2247
 *     >>> print(residuals)
 *     """
 *     if task_type == 'regression':             # <<<<<<<<<<<<<<
 *         if predicted is None:
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 */
  }

  /* "gofast/tools/mathex.pyx":2251
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 *         return actual - predicted
 *     elif task_type in ['binary', 'multiclass']:             # <<<<<<<<<<<<<<
 *         if predict_proba is not None:
 *             if predict_proba.shape[0] != actual.shape[0]:
 */
  __Pyx_TraceLine(2251,0,__PYX_ERR(0, 2251, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_task_type);
  __pyx_t_3 = __pyx_v_task_type;
  __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_binary, Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 2251, __pyx_L1_error)
  if (!__pyx_t_4) {
  } else {
    __pyx_t_1 = __pyx_t_4;
    goto __pyx_L5_bool_binop_done;
  }
  __pyx_t_4 = (__Pyx_PyUnicode_Equals(__pyx_t_3, __pyx_n_u_multiclass, Py_EQ)); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 2251, __pyx_L1_error)
  __pyx_t_1 = __pyx_t_4;
  __pyx_L5_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_4 = __pyx_t_1;
  if (likely(__pyx_t_4)) {

    /* "gofast/tools/mathex.pyx":2252
 *         return actual - predicted
 *     elif task_type in ['binary', 'multiclass']:
 *         if predict_proba is not None:             # <<<<<<<<<<<<<<
 *             if predict_proba.shape[0] != actual.shape[0]:
 *                 raise ValueError("The length of predict_proba does not match "
 */
    __Pyx_TraceLine(2252,0,__PYX_ERR(0, 2252, __pyx_L1_error))
    __pyx_t_4 = (__pyx_v_predict_proba != Py_None);
    if (__pyx_t_4) {

      /* "gofast/tools/mathex.pyx":2253
 *     elif task_type in ['binary', 'multiclass']:
 *         if predict_proba is not None:
 *             if predict_proba.shape[0] != actual.shape[0]:             # <<<<<<<<<<<<<<
 *                 raise ValueError("The length of predict_proba does not match "
 *                                  "the number of actual values.")
 */
      __Pyx_TraceLine(2253,0,__PYX_ERR(0, 2253, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_predict_proba, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2253, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2253, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_actual, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2253, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2253, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_RichCompare(__pyx_t_5, __pyx_t_6, Py_NE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2253, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_4 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_4 < 0))) __PYX_ERR(0, 2253, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(__pyx_t_4)) {

        /* "gofast/tools/mathex.pyx":2254
 *         if predict_proba is not None:
 *             if predict_proba.shape[0] != actual.shape[0]:
 *                 raise ValueError("The length of predict_proba does not match "             # <<<<<<<<<<<<<<
 *                                  "the number of actual values.")
 *             # For each sample, find the predicted probability of the true class
 */
        __Pyx_TraceLine(2254,0,__PYX_ERR(0, 2254, __pyx_L1_error))
        __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__56, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2254, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_Raise(__pyx_t_2, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __PYX_ERR(0, 2254, __pyx_L1_error)

        /* "gofast/tools/mathex.pyx":2253
 *     elif task_type in ['binary', 'multiclass']:
 *         if predict_proba is not None:
 *             if predict_proba.shape[0] != actual.shape[0]:             # <<<<<<<<<<<<<<
 *                 raise ValueError("The length of predict_proba does not match "
 *                                  "the number of actual values.")
 */
      }

      /* "gofast/tools/mathex.pyx":2257
 *                                  "the number of actual values.")
 *             # For each sample, find the predicted probability of the true class
 *             prob_true_class = predict_proba[np.arange(len(actual)), actual]             # <<<<<<<<<<<<<<
 *             residuals = 1 - prob_true_class  # Residuals are 1 - P(true class)
 *         elif predicted is not None:
 */
      __Pyx_TraceLine(2257,0,__PYX_ERR(0, 2257, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_7 = PyObject_Length(__pyx_v_actual); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2257, __pyx_L1_error)
      __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_8 = NULL;
      __pyx_t_9 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_9 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_6};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2257, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_2);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 2257, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_actual);
      __Pyx_GIVEREF(__pyx_v_actual);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_actual)) __PYX_ERR(0, 2257, __pyx_L1_error);
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_predict_proba, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2257, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_v_prob_true_class = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":2258
 *             # For each sample, find the predicted probability of the true class
 *             prob_true_class = predict_proba[np.arange(len(actual)), actual]
 *             residuals = 1 - prob_true_class  # Residuals are 1 - P(true class)             # <<<<<<<<<<<<<<
 *         elif predicted is not None:
 *             # For binary classification without probabilities, residuals
 */
      __Pyx_TraceLine(2258,0,__PYX_ERR(0, 2258, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_prob_true_class, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2258, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_v_residuals = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":2252
 *         return actual - predicted
 *     elif task_type in ['binary', 'multiclass']:
 *         if predict_proba is not None:             # <<<<<<<<<<<<<<
 *             if predict_proba.shape[0] != actual.shape[0]:
 *                 raise ValueError("The length of predict_proba does not match "
 */
      goto __pyx_L7;
    }

    /* "gofast/tools/mathex.pyx":2259
 *             prob_true_class = predict_proba[np.arange(len(actual)), actual]
 *             residuals = 1 - prob_true_class  # Residuals are 1 - P(true class)
 *         elif predicted is not None:             # <<<<<<<<<<<<<<
 *             # For binary classification without probabilities, residuals
 *             # are 0 for correct predictions and 1 for incorrect
 */
    __Pyx_TraceLine(2259,0,__PYX_ERR(0, 2259, __pyx_L1_error))
    __pyx_t_4 = (__pyx_v_predicted != Py_None);
    if (likely(__pyx_t_4)) {

      /* "gofast/tools/mathex.pyx":2262
 *             # For binary classification without probabilities, residuals
 *             # are 0 for correct predictions and 1 for incorrect
 *             residuals = np.where(actual == predicted, 0, 1)             # <<<<<<<<<<<<<<
 *         else:
 *             raise ValueError("Either predicted class labels or predict_proba "
 */
      __Pyx_TraceLine(2262,0,__PYX_ERR(0, 2262, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2262, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_where); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2262, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_actual, __pyx_v_predicted, Py_EQ); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2262, __pyx_L1_error)
      __pyx_t_8 = NULL;
      __pyx_t_9 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_6))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_6, function);
          __pyx_t_9 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[4] = {__pyx_t_8, __pyx_t_5, __pyx_int_0, __pyx_int_1};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_9, 3+__pyx_t_9);
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2262, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      }
      __pyx_v_residuals = __pyx_t_2;
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":2259
 *             prob_true_class = predict_proba[np.arange(len(actual)), actual]
 *             residuals = 1 - prob_true_class  # Residuals are 1 - P(true class)
 *         elif predicted is not None:             # <<<<<<<<<<<<<<
 *             # For binary classification without probabilities, residuals
 *             # are 0 for correct predictions and 1 for incorrect
 */
      goto __pyx_L7;
    }

    /* "gofast/tools/mathex.pyx":2264
 *             residuals = np.where(actual == predicted, 0, 1)
 *         else:
 *             raise ValueError("Either predicted class labels or predict_proba "             # <<<<<<<<<<<<<<
 *                              "must be provided for classification tasks.")
 *     else:
 */
    __Pyx_TraceLine(2264,0,__PYX_ERR(0, 2264, __pyx_L1_error))
    /*else*/ {
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__57, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2264, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_ERR(0, 2264, __pyx_L1_error)
    }
    __pyx_L7:;

    /* "gofast/tools/mathex.pyx":2251
 *             raise ValueError("Predicted values must be provided for regression tasks.")
 *         return actual - predicted
 *     elif task_type in ['binary', 'multiclass']:             # <<<<<<<<<<<<<<
 *         if predict_proba is not None:
 *             if predict_proba.shape[0] != actual.shape[0]:
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":2267
 *                              "must be provided for classification tasks.")
 *     else:
 *         raise ValueError("The task_type must be 'regression', 'binary', or"             # <<<<<<<<<<<<<<
 *                          " 'multiclass'.")
 * 
 */
  __Pyx_TraceLine(2267,0,__PYX_ERR(0, 2267, __pyx_L1_error))
  /*else*/ {
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__58, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2267, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 2267, __pyx_L1_error)
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":2270
 *                          " 'multiclass'.")
 * 
 *     return residuals             # <<<<<<<<<<<<<<
 * 
 * def infer_sankey_columns(data: DataFrame,
 */
  __Pyx_TraceLine(2270,0,__PYX_ERR(0, 2270, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_residuals);
  __pyx_r = __pyx_v_residuals;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2195
 *     return epsilon
 * 
 * def calculate_residuals(             # <<<<<<<<<<<<<<
 *     actual: ArrayLike,
 *     predicted: Union[np.ndarray, List[ArrayLike]],
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex.calculate_residuals", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_prob_true_class);
  __Pyx_XDECREF(__pyx_v_residuals);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2272
 *     return residuals
 * 
 * def infer_sankey_columns(data: DataFrame,             # <<<<<<<<<<<<<<
 *   ) -> Tuple[List[str], List[str], List[int]]:
 *     """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_51infer_sankey_columns(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_50infer_sankey_columns, "\n    Infers source, target, and value columns for a Sankey diagram \n    from a DataFrame.\n\n    Parameters\n    ----------\n    data : pd.DataFrame\n        The DataFrame from which to infer the source, target, and value columns.\n\n    Returns\n    -------\n    Tuple[List[str], List[str], List[int]]\n        Three lists containing the names of the source nodes, target nodes,\n        and the values of the flows between them, respectively.\n\n    Raises\n    ------\n    ValueError\n        If the DataFrame does not contain at least two columns for source and target,\n        and an additional column for value.\n\n    Examples\n    --------\n    >>> import pandas as pd\n    >>> from gofast.tools.mathex import infer_sankey_columns\n    >>> df = pd.DataFrame({\n    ...     'from': ['A', 'A', 'B', 'B'],\n    ...     'to': ['X', 'Y', 'X', 'Y'],\n    ...     'amount': [10, 20, 30, 40]\n    ... })\n    >>> sources, targets, values = infer_sankey_columns(df)\n    >>> print(sources, targets, values)\n    ['A', 'A', 'B', 'B'] ['X', 'Y', 'X', 'Y'] [10, 20, 30, 40]\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_51infer_sankey_columns = {"infer_sankey_columns", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_51infer_sankey_columns, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_50infer_sankey_columns};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_51infer_sankey_columns(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[1] = {0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("infer_sankey_columns (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2272, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "infer_sankey_columns") < 0)) __PYX_ERR(0, 2272, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_data = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("infer_sankey_columns", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 2272, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.infer_sankey_columns", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_50infer_sankey_columns(__pyx_self, __pyx_v_data);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_50infer_sankey_columns(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data) {
  PyObject *__pyx_v_numeric_cols = NULL;
  PyObject *__pyx_v_value_col = NULL;
  PyObject *__pyx_v_source_col = NULL;
  PyObject *__pyx_v_target_col = NULL;
  PyObject *__pyx_v_col = NULL;
  PyObject *__pyx_v_sources = NULL;
  PyObject *__pyx_v_targets = NULL;
  PyObject *__pyx_v_values = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  Py_ssize_t __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__59)
  __Pyx_RefNannySetupContext("infer_sankey_columns", 1);
  __Pyx_TraceCall("infer_sankey_columns", __pyx_f[0], 2272, 0, __PYX_ERR(0, 2272, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2308
 *     ['A', 'A', 'B', 'B'] ['X', 'Y', 'X', 'Y'] [10, 20, 30, 40]
 *     """
 *     if len(data.columns) < 3:             # <<<<<<<<<<<<<<
 *         raise ValueError("DataFrame must have at least three columns:"
 *                          " source, target, and value")
 */
  __Pyx_TraceLine(2308,0,__PYX_ERR(0, 2308, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2308, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyObject_Length(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2308, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = (__pyx_t_2 < 3);
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":2309
 *     """
 *     if len(data.columns) < 3:
 *         raise ValueError("DataFrame must have at least three columns:"             # <<<<<<<<<<<<<<
 *                          " source, target, and value")
 * 
 */
    __Pyx_TraceLine(2309,0,__PYX_ERR(0, 2309, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__60, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2309, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 2309, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2308
 *     ['A', 'A', 'B', 'B'] ['X', 'Y', 'X', 'Y'] [10, 20, 30, 40]
 *     """
 *     if len(data.columns) < 3:             # <<<<<<<<<<<<<<
 *         raise ValueError("DataFrame must have at least three columns:"
 *                          " source, target, and value")
 */
  }

  /* "gofast/tools/mathex.pyx":2314
 *     # Heuristic: The source is often the first column, the target is the second,
 *     # and the value is the third or the one with numeric data
 *     numeric_cols = data.select_dtypes([float, int]).columns             # <<<<<<<<<<<<<<
 * 
 *     if len(numeric_cols) == 0:
 */
  __Pyx_TraceLine(2314,0,__PYX_ERR(0, 2314, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_select_dtypes); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyList_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_INCREF((PyObject *)(&PyFloat_Type));
  __Pyx_GIVEREF((PyObject *)(&PyFloat_Type));
  if (__Pyx_PyList_SET_ITEM(__pyx_t_5, 0, ((PyObject *)(&PyFloat_Type)))) __PYX_ERR(0, 2314, __pyx_L1_error);
  __Pyx_INCREF((PyObject *)(&PyInt_Type));
  __Pyx_GIVEREF((PyObject *)(&PyInt_Type));
  if (__Pyx_PyList_SET_ITEM(__pyx_t_5, 1, ((PyObject *)(&PyInt_Type)))) __PYX_ERR(0, 2314, __pyx_L1_error);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_5};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2314, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2314, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_numeric_cols = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":2316
 *     numeric_cols = data.select_dtypes([float, int]).columns
 * 
 *     if len(numeric_cols) == 0:             # <<<<<<<<<<<<<<
 *         raise ValueError(
 *             "DataFrame does not contain any numeric columns for values")
 */
  __Pyx_TraceLine(2316,0,__PYX_ERR(0, 2316, __pyx_L1_error))
  __pyx_t_2 = PyObject_Length(__pyx_v_numeric_cols); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2316, __pyx_L1_error)
  __pyx_t_3 = (__pyx_t_2 == 0);
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":2317
 * 
 *     if len(numeric_cols) == 0:
 *         raise ValueError(             # <<<<<<<<<<<<<<
 *             "DataFrame does not contain any numeric columns for values")
 * 
 */
    __Pyx_TraceLine(2317,0,__PYX_ERR(0, 2317, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__61, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2317, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __PYX_ERR(0, 2317, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2316
 *     numeric_cols = data.select_dtypes([float, int]).columns
 * 
 *     if len(numeric_cols) == 0:             # <<<<<<<<<<<<<<
 *         raise ValueError(
 *             "DataFrame does not contain any numeric columns for values")
 */
  }

  /* "gofast/tools/mathex.pyx":2321
 * 
 *     # Choose the first numeric column as the value by default
 *     value_col = numeric_cols[0]             # <<<<<<<<<<<<<<
 *     source_col = data.columns[0]
 *     target_col = data.columns[1]
 */
  __Pyx_TraceLine(2321,0,__PYX_ERR(0, 2321, __pyx_L1_error))
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_numeric_cols, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v_value_col = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":2322
 *     # Choose the first numeric column as the value by default
 *     value_col = numeric_cols[0]
 *     source_col = data.columns[0]             # <<<<<<<<<<<<<<
 *     target_col = data.columns[1]
 * 
 */
  __Pyx_TraceLine(2322,0,__PYX_ERR(0, 2322, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2322, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_source_col = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2323
 *     value_col = numeric_cols[0]
 *     source_col = data.columns[0]
 *     target_col = data.columns[1]             # <<<<<<<<<<<<<<
 * 
 *     # If there's a 'source' or 'target' column, prefer that
 */
  __Pyx_TraceLine(2323,0,__PYX_ERR(0, 2323, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2323, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_target_col = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":2326
 * 
 *     # If there's a 'source' or 'target' column, prefer that
 *     for col in data.columns:             # <<<<<<<<<<<<<<
 *         if 'source' in col.lower():
 *             source_col = col
 */
  __Pyx_TraceLine(2326,0,__PYX_ERR(0, 2326, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2326, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
    __pyx_t_1 = __pyx_t_4; __Pyx_INCREF(__pyx_t_1);
    __pyx_t_2 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2326, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2326, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2326, __pyx_L1_error)
          #endif
          if (__pyx_t_2 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 2326, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2326, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2326, __pyx_L1_error)
          #endif
          if (__pyx_t_2 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 2326, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2326, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_8(__pyx_t_1);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2326, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_col, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":2327
 *     # If there's a 'source' or 'target' column, prefer that
 *     for col in data.columns:
 *         if 'source' in col.lower():             # <<<<<<<<<<<<<<
 *             source_col = col
 *         elif 'target' in col.lower():
 */
    __Pyx_TraceLine(2327,0,__PYX_ERR(0, 2327, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_col, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2327, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2327, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_source, __pyx_t_4, Py_EQ)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2327, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_3) {

      /* "gofast/tools/mathex.pyx":2328
 *     for col in data.columns:
 *         if 'source' in col.lower():
 *             source_col = col             # <<<<<<<<<<<<<<
 *         elif 'target' in col.lower():
 *             target_col = col
 */
      __Pyx_TraceLine(2328,0,__PYX_ERR(0, 2328, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_col);
      __Pyx_DECREF_SET(__pyx_v_source_col, __pyx_v_col);

      /* "gofast/tools/mathex.pyx":2327
 *     # If there's a 'source' or 'target' column, prefer that
 *     for col in data.columns:
 *         if 'source' in col.lower():             # <<<<<<<<<<<<<<
 *             source_col = col
 *         elif 'target' in col.lower():
 */
      goto __pyx_L7;
    }

    /* "gofast/tools/mathex.pyx":2329
 *         if 'source' in col.lower():
 *             source_col = col
 *         elif 'target' in col.lower():             # <<<<<<<<<<<<<<
 *             target_col = col
 *         elif 'value' in col.lower() or 'amount' in col.lower() or 'count' in col.lower():
 */
    __Pyx_TraceLine(2329,0,__PYX_ERR(0, 2329, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_col, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2329, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2329, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_target, __pyx_t_4, Py_EQ)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2329, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (__pyx_t_3) {

      /* "gofast/tools/mathex.pyx":2330
 *             source_col = col
 *         elif 'target' in col.lower():
 *             target_col = col             # <<<<<<<<<<<<<<
 *         elif 'value' in col.lower() or 'amount' in col.lower() or 'count' in col.lower():
 *             value_col = col
 */
      __Pyx_TraceLine(2330,0,__PYX_ERR(0, 2330, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_col);
      __Pyx_DECREF_SET(__pyx_v_target_col, __pyx_v_col);

      /* "gofast/tools/mathex.pyx":2329
 *         if 'source' in col.lower():
 *             source_col = col
 *         elif 'target' in col.lower():             # <<<<<<<<<<<<<<
 *             target_col = col
 *         elif 'value' in col.lower() or 'amount' in col.lower() or 'count' in col.lower():
 */
      goto __pyx_L7;
    }

    /* "gofast/tools/mathex.pyx":2331
 *         elif 'target' in col.lower():
 *             target_col = col
 *         elif 'value' in col.lower() or 'amount' in col.lower() or 'count' in col.lower():             # <<<<<<<<<<<<<<
 *             value_col = col
 * 
 */
    __Pyx_TraceLine(2331,0,__PYX_ERR(0, 2331, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_col, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2331, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2331, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_9 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_value, __pyx_t_4, Py_EQ)); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 2331, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (!__pyx_t_9) {
    } else {
      __pyx_t_3 = __pyx_t_9;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_col, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2331, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2331, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_9 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_amount, __pyx_t_4, Py_EQ)); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 2331, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (!__pyx_t_9) {
    } else {
      __pyx_t_3 = __pyx_t_9;
      goto __pyx_L8_bool_binop_done;
    }
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_col, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2331, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2331, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    __pyx_t_9 = (__Pyx_PySequence_ContainsTF(__pyx_n_u_count, __pyx_t_4, Py_EQ)); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 2331, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_3 = __pyx_t_9;
    __pyx_L8_bool_binop_done:;
    if (__pyx_t_3) {

      /* "gofast/tools/mathex.pyx":2332
 *             target_col = col
 *         elif 'value' in col.lower() or 'amount' in col.lower() or 'count' in col.lower():
 *             value_col = col             # <<<<<<<<<<<<<<
 * 
 *     # Check for consistency in data
 */
      __Pyx_TraceLine(2332,0,__PYX_ERR(0, 2332, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_col);
      __Pyx_DECREF_SET(__pyx_v_value_col, __pyx_v_col);

      /* "gofast/tools/mathex.pyx":2331
 *         elif 'target' in col.lower():
 *             target_col = col
 *         elif 'value' in col.lower() or 'amount' in col.lower() or 'count' in col.lower():             # <<<<<<<<<<<<<<
 *             value_col = col
 * 
 */
    }
    __pyx_L7:;

    /* "gofast/tools/mathex.pyx":2326
 * 
 *     # If there's a 'source' or 'target' column, prefer that
 *     for col in data.columns:             # <<<<<<<<<<<<<<
 *         if 'source' in col.lower():
 *             source_col = col
 */
    __Pyx_TraceLine(2326,0,__PYX_ERR(0, 2326, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2335
 * 
 *     # Check for consistency in data
 *     if data[source_col].isnull().any() or data[target_col].isnull().any():             # <<<<<<<<<<<<<<
 *         raise ValueError("Source and Target columns must not contain null values")
 * 
 */
  __Pyx_TraceLine(2335,0,__PYX_ERR(0, 2335, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_source_col); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_isnull); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_any); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (!__pyx_t_9) {
  } else {
    __pyx_t_3 = __pyx_t_9;
    goto __pyx_L13_bool_binop_done;
  }
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_target_col); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_isnull); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_any); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2335, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 2335, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __pyx_t_9;
  __pyx_L13_bool_binop_done:;
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":2336
 *     # Check for consistency in data
 *     if data[source_col].isnull().any() or data[target_col].isnull().any():
 *         raise ValueError("Source and Target columns must not contain null values")             # <<<<<<<<<<<<<<
 * 
 *     if data[value_col].isnull().any():
 */
    __Pyx_TraceLine(2336,0,__PYX_ERR(0, 2336, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__62, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2336, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 2336, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2335
 * 
 *     # Check for consistency in data
 *     if data[source_col].isnull().any() or data[target_col].isnull().any():             # <<<<<<<<<<<<<<
 *         raise ValueError("Source and Target columns must not contain null values")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2338
 *         raise ValueError("Source and Target columns must not contain null values")
 * 
 *     if data[value_col].isnull().any():             # <<<<<<<<<<<<<<
 *         raise ValueError("Value column must not contain null values")
 * 
 */
  __Pyx_TraceLine(2338,0,__PYX_ERR(0, 2338, __pyx_L1_error))
  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_value_col); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2338, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_isnull); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2338, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_any); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2338, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2338, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":2339
 * 
 *     if data[value_col].isnull().any():
 *         raise ValueError("Value column must not contain null values")             # <<<<<<<<<<<<<<
 * 
 *     # Extract the columns and return
 */
    __Pyx_TraceLine(2339,0,__PYX_ERR(0, 2339, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__63, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2339, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 2339, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2338
 *         raise ValueError("Source and Target columns must not contain null values")
 * 
 *     if data[value_col].isnull().any():             # <<<<<<<<<<<<<<
 *         raise ValueError("Value column must not contain null values")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2342
 * 
 *     # Extract the columns and return
 *     sources = data[source_col].tolist()             # <<<<<<<<<<<<<<
 *     targets = data[target_col].tolist()
 *     values = data[value_col].tolist()
 */
  __Pyx_TraceLine(2342,0,__PYX_ERR(0, 2342, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_source_col); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2342, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tolist); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2342, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2342, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_v_sources = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2343
 *     # Extract the columns and return
 *     sources = data[source_col].tolist()
 *     targets = data[target_col].tolist()             # <<<<<<<<<<<<<<
 *     values = data[value_col].tolist()
 * 
 */
  __Pyx_TraceLine(2343,0,__PYX_ERR(0, 2343, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_target_col); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2343, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_tolist); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2343, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2343, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_v_targets = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2344
 *     sources = data[source_col].tolist()
 *     targets = data[target_col].tolist()
 *     values = data[value_col].tolist()             # <<<<<<<<<<<<<<
 * 
 *     return sources, targets, values
 */
  __Pyx_TraceLine(2344,0,__PYX_ERR(0, 2344, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_data, __pyx_v_value_col); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_tolist); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2344, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_v_values = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2346
 *     values = data[value_col].tolist()
 * 
 *     return sources, targets, values             # <<<<<<<<<<<<<<
 * 
 * def compute_sunburst_data(
 */
  __Pyx_TraceLine(2346,0,__PYX_ERR(0, 2346, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2346, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_sources);
  __Pyx_GIVEREF(__pyx_v_sources);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_sources)) __PYX_ERR(0, 2346, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_targets);
  __Pyx_GIVEREF(__pyx_v_targets);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_targets)) __PYX_ERR(0, 2346, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_values);
  __Pyx_GIVEREF(__pyx_v_values);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_v_values)) __PYX_ERR(0, 2346, __pyx_L1_error);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2272
 *     return residuals
 * 
 * def infer_sankey_columns(data: DataFrame,             # <<<<<<<<<<<<<<
 *   ) -> Tuple[List[str], List[str], List[int]]:
 *     """
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.infer_sankey_columns", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_numeric_cols);
  __Pyx_XDECREF(__pyx_v_value_col);
  __Pyx_XDECREF(__pyx_v_source_col);
  __Pyx_XDECREF(__pyx_v_target_col);
  __Pyx_XDECREF(__pyx_v_col);
  __Pyx_XDECREF(__pyx_v_sources);
  __Pyx_XDECREF(__pyx_v_targets);
  __Pyx_XDECREF(__pyx_v_values);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2348
 *     return sources, targets, values
 * 
 * def compute_sunburst_data(             # <<<<<<<<<<<<<<
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_53compute_sunburst_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_52compute_sunburst_data, "\n    Computes the data structure required for generating a sunburst chart from\n    a DataFrame.\n    \n    The function allows for automatic inference of hierarchy and values if \n    not explicitly provided. This is useful for visualizing hierarchical \n    datasets where the relationship between parent and child categories is \n    important.\n\n    The sunburst chart provides insights into the proportion of categories at \n    multiple levels of the hierarchy through their area size. It is especially \n    useful in identifying patterns and contributions of various parts to the \n    whole in a dataset.\n\n    Parameters\n    ----------\n    df : pd.DataFrame\n        The DataFrame containing the hierarchical data. It should have columns \n        representing levels of the hierarchy and optionally a column for values.\n    hierarchy : Optional[List[str]], optional\n        The list of columns that represent the hierarchy levels, ordered from \n        top to bottom. If not provided, the function assumes all columns except\n        the last one are part of the hierarchy.\n    value_column : Optional[str], optional\n        The name of the column that contains the values for each leaf node in \n        the sunburst chart. If not provided, the function will count the \n        occurrences of the lowest hierarchy level and use this count as the \n        value for each leaf node.\n\n    Returns\n    -------\n    List[Dict[str, str]]\n        A list of dictionaries where each dictionary represents a node in the\n        sunburst chart with 'name', 'value', and 'parent' keys.\n\n    Examples\n    --------\n    >>> df = pd.DataFrame({\n    ...     'Category': ['A', 'A', 'B', 'B'],\n    ...     'Subcategory': ['A1', 'A2', 'B1', 'B2']\n    ... })\n    >>> data = compute_sunburst_data(df)\n    >>> print(data)\n    [\n        {'name': 'A', 'value': 2, 'parent': ''},\n        {'name': 'B', 'value': 2, 'parent': ''},\n        {'name': 'A1', 'value': 1, 'parent': 'A'},\n   ""     {'name': 'A2', 'value': 1, 'parent': 'A'},\n        {'name': 'B1', 'value': 1, 'parent': 'B'},\n        {'name': 'B2', 'value': 1, 'parent': 'B'}\n    ]\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_53compute_sunburst_data = {"compute_sunburst_data", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_53compute_sunburst_data, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_52compute_sunburst_data};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_53compute_sunburst_data(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_hierarchy = 0;
  PyObject *__pyx_v_value_column = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_sunburst_data (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,&__pyx_n_s_hierarchy,&__pyx_n_s_value_column,0};

    /* "gofast/tools/mathex.pyx":2350
 * def compute_sunburst_data(
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,             # <<<<<<<<<<<<<<
 *     value_column: Optional[str] = None
 *   ) -> List[Dict[str, str]]:
 */
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));

    /* "gofast/tools/mathex.pyx":2351
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,
 *     value_column: Optional[str] = None             # <<<<<<<<<<<<<<
 *   ) -> List[Dict[str, str]]:
 *     """
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2348, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_hierarchy);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2348, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_value_column);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2348, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_sunburst_data") < 0)) __PYX_ERR(0, 2348, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_hierarchy = values[1];
    __pyx_v_value_column = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_sunburst_data", 0, 1, 3, __pyx_nargs); __PYX_ERR(0, 2348, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_sunburst_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_52compute_sunburst_data(__pyx_self, __pyx_v_data, __pyx_v_hierarchy, __pyx_v_value_column);

  /* "gofast/tools/mathex.pyx":2348
 *     return sources, targets, values
 * 
 * def compute_sunburst_data(             # <<<<<<<<<<<<<<
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_52compute_sunburst_data(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_hierarchy, PyObject *__pyx_v_value_column) {
  PyObject *__pyx_v_df_full = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_df_level = NULL;
  PyObject *__pyx_v_sunburst_data = NULL;
  PyObject *__pyx_v_seen = NULL;
  Py_ssize_t __pyx_8genexpr6__pyx_v_i;
  CYTHON_UNUSED PyObject *__pyx_8genexpr6__pyx_v__ = NULL;
  PyObject *__pyx_8genexpr6__pyx_v_row = NULL;
  PyObject *__pyx_8genexpr7__pyx_v_x = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  Py_ssize_t __pyx_t_12;
  Py_ssize_t __pyx_t_13;
  Py_ssize_t __pyx_t_14;
  PyObject *(*__pyx_t_15)(PyObject *);
  int __pyx_t_16;
  int __pyx_t_17;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__64)
  __Pyx_RefNannySetupContext("compute_sunburst_data", 0);
  __Pyx_TraceCall("compute_sunburst_data", __pyx_f[0], 2348, 0, __PYX_ERR(0, 2348, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_data);
  __Pyx_INCREF(__pyx_v_hierarchy);
  __Pyx_INCREF(__pyx_v_value_column);

  /* "gofast/tools/mathex.pyx":2406
 *     """
 * 
 *     is_frame ( data, df_only =True , raise_exception=True )             # <<<<<<<<<<<<<<
 *     # If hierarchy is not provided, infer it from all columns except the last
 *     if hierarchy is None:
 */
  __Pyx_TraceLine(2406,0,__PYX_ERR(0, 2406, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_is_frame); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2406, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2406, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_data);
  __Pyx_GIVEREF(__pyx_v_data);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_data)) __PYX_ERR(0, 2406, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2406, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_df_only, Py_True) < 0) __PYX_ERR(0, 2406, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_raise_exception, Py_True) < 0) __PYX_ERR(0, 2406, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2406, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":2408
 *     is_frame ( data, df_only =True , raise_exception=True )
 *     # If hierarchy is not provided, infer it from all columns except the last
 *     if hierarchy is None:             # <<<<<<<<<<<<<<
 *         hierarchy = data.columns[:-1].tolist()
 * 
 */
  __Pyx_TraceLine(2408,0,__PYX_ERR(0, 2408, __pyx_L1_error))
  __pyx_t_5 = (__pyx_v_hierarchy == Py_None);
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":2409
 *     # If hierarchy is not provided, infer it from all columns except the last
 *     if hierarchy is None:
 *         hierarchy = data.columns[:-1].tolist()             # <<<<<<<<<<<<<<
 * 
 *     # If value_column is not provided, create a 'Count' column and use
 */
    __Pyx_TraceLine(2409,0,__PYX_ERR(0, 2409, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_columns); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2409, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetSlice(__pyx_t_3, 0, -1L, NULL, NULL, &__pyx_slice__16, 0, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2409, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_tolist); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2409, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2409, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_hierarchy, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":2408
 *     is_frame ( data, df_only =True , raise_exception=True )
 *     # If hierarchy is not provided, infer it from all columns except the last
 *     if hierarchy is None:             # <<<<<<<<<<<<<<
 *         hierarchy = data.columns[:-1].tolist()
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2413
 *     # If value_column is not provided, create a 'Count' column and use
 *     # it as the value column
 *     if value_column is None:             # <<<<<<<<<<<<<<
 *         data = data.assign(Count=1)
 *         value_column = 'Count'
 */
  __Pyx_TraceLine(2413,0,__PYX_ERR(0, 2413, __pyx_L1_error))
  __pyx_t_5 = (__pyx_v_value_column == Py_None);
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":2414
 *     # it as the value column
 *     if value_column is None:
 *         data = data.assign(Count=1)             # <<<<<<<<<<<<<<
 *         value_column = 'Count'
 * 
 */
    __Pyx_TraceLine(2414,0,__PYX_ERR(0, 2414, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_assign); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_Count, __pyx_int_1) < 0) __PYX_ERR(0, 2414, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_empty_tuple, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2414, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2415
 *     if value_column is None:
 *         data = data.assign(Count=1)
 *         value_column = 'Count'             # <<<<<<<<<<<<<<
 * 
 *     # Compute the values for each level of the hierarchy
 */
    __Pyx_TraceLine(2415,0,__PYX_ERR(0, 2415, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_Count);
    __Pyx_DECREF_SET(__pyx_v_value_column, __pyx_n_u_Count);

    /* "gofast/tools/mathex.pyx":2413
 *     # If value_column is not provided, create a 'Count' column and use
 *     # it as the value column
 *     if value_column is None:             # <<<<<<<<<<<<<<
 *         data = data.assign(Count=1)
 *         value_column = 'Count'
 */
  }

  /* "gofast/tools/mathex.pyx":2418
 * 
 *     # Compute the values for each level of the hierarchy
 *     df_full = data.copy()             # <<<<<<<<<<<<<<
 *     for i in range(1, len(hierarchy)):
 *         df_level = df_full[hierarchy[:i+1] + [value_column]].groupby(
 */
  __Pyx_TraceLine(2418,0,__PYX_ERR(0, 2418, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_data, __pyx_n_s_copy); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2418, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2418, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_df_full = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2419
 *     # Compute the values for each level of the hierarchy
 *     df_full = data.copy()
 *     for i in range(1, len(hierarchy)):             # <<<<<<<<<<<<<<
 *         df_level = df_full[hierarchy[:i+1] + [value_column]].groupby(
 *             hierarchy[:i+1]).sum().reset_index()
 */
  __Pyx_TraceLine(2419,0,__PYX_ERR(0, 2419, __pyx_L1_error))
  __pyx_t_7 = PyObject_Length(__pyx_v_hierarchy); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2419, __pyx_L1_error)
  __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2419, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2419, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_int_1)) __PYX_ERR(0, 2419, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2)) __PYX_ERR(0, 2419, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2419, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_7 = 0;
    __pyx_t_8 = NULL;
  } else {
    __pyx_t_7 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2419, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2419, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_8)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2419, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 2419, __pyx_L1_error)
        #else
        __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2419, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2419, __pyx_L1_error)
          #endif
          if (__pyx_t_7 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 2419, __pyx_L1_error)
        #else
        __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2419, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_8(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2419, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2420
 *     df_full = data.copy()
 *     for i in range(1, len(hierarchy)):
 *         df_level = df_full[hierarchy[:i+1] + [value_column]].groupby(             # <<<<<<<<<<<<<<
 *             hierarchy[:i+1]).sum().reset_index()
 *         df_full = pd.concat([df_full, df_level], ignore_index=True)
 */
    __Pyx_TraceLine(2420,0,__PYX_ERR(0, 2420, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2420, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = __Pyx_PyObject_GetSlice(__pyx_v_hierarchy, 0, 0, NULL, &__pyx_t_9, NULL, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2420, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2420, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_v_value_column);
    __Pyx_GIVEREF(__pyx_v_value_column);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_9, 0, __pyx_v_value_column)) __PYX_ERR(0, 2420, __pyx_L1_error);
    __pyx_t_11 = PyNumber_Add(__pyx_t_10, __pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2420, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_df_full, __pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2420, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_groupby); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2420, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":2421
 *     for i in range(1, len(hierarchy)):
 *         df_level = df_full[hierarchy[:i+1] + [value_column]].groupby(
 *             hierarchy[:i+1]).sum().reset_index()             # <<<<<<<<<<<<<<
 *         df_full = pd.concat([df_full, df_level], ignore_index=True)
 * 
 */
    __Pyx_TraceLine(2421,0,__PYX_ERR(0, 2421, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2421, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_10 = __Pyx_PyObject_GetSlice(__pyx_v_hierarchy, 0, 0, NULL, &__pyx_t_9, NULL, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2421, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_10};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2420, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2421, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2421, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_reset_index); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2421, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_11))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_11);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_11, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2421, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_df_level, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2422
 *         df_level = df_full[hierarchy[:i+1] + [value_column]].groupby(
 *             hierarchy[:i+1]).sum().reset_index()
 *         df_full = pd.concat([df_full, df_level], ignore_index=True)             # <<<<<<<<<<<<<<
 * 
 *     df_full = df_full.drop_duplicates(subset=hierarchy).reset_index(drop=True)
 */
    __Pyx_TraceLine(2422,0,__PYX_ERR(0, 2422, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2422, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_concat); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2422, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_11);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2422, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_df_full);
    __Pyx_GIVEREF(__pyx_v_df_full);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_v_df_full)) __PYX_ERR(0, 2422, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_df_level);
    __Pyx_GIVEREF(__pyx_v_df_level);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_v_df_level)) __PYX_ERR(0, 2422, __pyx_L1_error);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2422, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_2);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2)) __PYX_ERR(0, 2422, __pyx_L1_error);
    __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2422, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_ignore_index, Py_True) < 0) __PYX_ERR(0, 2422, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_11, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2422, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_df_full, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":2419
 *     # Compute the values for each level of the hierarchy
 *     df_full = data.copy()
 *     for i in range(1, len(hierarchy)):             # <<<<<<<<<<<<<<
 *         df_level = df_full[hierarchy[:i+1] + [value_column]].groupby(
 *             hierarchy[:i+1]).sum().reset_index()
 */
    __Pyx_TraceLine(2419,0,__PYX_ERR(0, 2419, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2424
 *         df_full = pd.concat([df_full, df_level], ignore_index=True)
 * 
 *     df_full = df_full.drop_duplicates(subset=hierarchy).reset_index(drop=True)             # <<<<<<<<<<<<<<
 * 
 *     # Generate the sunburst data structure
 */
  __Pyx_TraceLine(2424,0,__PYX_ERR(0, 2424, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_df_full, __pyx_n_s_drop_duplicates); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_subset, __pyx_v_hierarchy) < 0) __PYX_ERR(0, 2424, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_reset_index); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_drop, Py_True) < 0) __PYX_ERR(0, 2424, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2424, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_df_full, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2427
 * 
 *     # Generate the sunburst data structure
 *     sunburst_data = [             # <<<<<<<<<<<<<<
 *         {"name": row[hierarchy[-1]],
 *          "value": row[value_column],
 */
  __Pyx_TraceLine(2427,0,__PYX_ERR(0, 2427, __pyx_L1_error))
  { /* enter inner scope */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2427, __pyx_L10_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "gofast/tools/mathex.pyx":2431
 *          "value": row[value_column],
 *          "parent": row[hierarchy[-2]] if i > 0 else ""}
 *         for i in range(len(hierarchy))             # <<<<<<<<<<<<<<
 *         for _, row in df_full[hierarchy[:i+1] + [value_column]].iterrows()
 *     ]
 */
    __Pyx_TraceLine(2431,0,__PYX_ERR(0, 2431, __pyx_L10_error))
    __pyx_t_7 = PyObject_Length(__pyx_v_hierarchy); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 2431, __pyx_L10_error)
    __pyx_t_12 = __pyx_t_7;
    for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
      __pyx_8genexpr6__pyx_v_i = __pyx_t_13;

      /* "gofast/tools/mathex.pyx":2432
 *          "parent": row[hierarchy[-2]] if i > 0 else ""}
 *         for i in range(len(hierarchy))
 *         for _, row in df_full[hierarchy[:i+1] + [value_column]].iterrows()             # <<<<<<<<<<<<<<
 *     ]
 * 
 */
      __Pyx_TraceLine(2432,0,__PYX_ERR(0, 2432, __pyx_L10_error))
      __pyx_t_1 = __Pyx_PyObject_GetSlice(__pyx_v_hierarchy, 0, (__pyx_8genexpr6__pyx_v_i + 1), NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2432, __pyx_L10_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2432, __pyx_L10_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_INCREF(__pyx_v_value_column);
      __Pyx_GIVEREF(__pyx_v_value_column);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 0, __pyx_v_value_column)) __PYX_ERR(0, 2432, __pyx_L10_error);
      __pyx_t_11 = PyNumber_Add(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2432, __pyx_L10_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_df_full, __pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2432, __pyx_L10_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_iterrows); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2432, __pyx_L10_error)
      __Pyx_GOTREF(__pyx_t_11);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_11))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_11);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_11);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_11, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_11, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2432, __pyx_L10_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      }
      if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
        __pyx_t_11 = __pyx_t_2; __Pyx_INCREF(__pyx_t_11);
        __pyx_t_14 = 0;
        __pyx_t_8 = NULL;
      } else {
        __pyx_t_14 = -1; __pyx_t_11 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2432, __pyx_L10_error)
        __Pyx_GOTREF(__pyx_t_11);
        __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2432, __pyx_L10_error)
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      for (;;) {
        if (likely(!__pyx_t_8)) {
          if (likely(PyList_CheckExact(__pyx_t_11))) {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_11);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2432, __pyx_L10_error)
              #endif
              if (__pyx_t_14 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyList_GET_ITEM(__pyx_t_11, __pyx_t_14); __Pyx_INCREF(__pyx_t_2); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 2432, __pyx_L10_error)
            #else
            __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_11, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2432, __pyx_L10_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          } else {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_11);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2432, __pyx_L10_error)
              #endif
              if (__pyx_t_14 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_11, __pyx_t_14); __Pyx_INCREF(__pyx_t_2); __pyx_t_14++; if (unlikely((0 < 0))) __PYX_ERR(0, 2432, __pyx_L10_error)
            #else
            __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_11, __pyx_t_14); __pyx_t_14++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2432, __pyx_L10_error)
            __Pyx_GOTREF(__pyx_t_2);
            #endif
          }
        } else {
          __pyx_t_2 = __pyx_t_8(__pyx_t_11);
          if (unlikely(!__pyx_t_2)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 2432, __pyx_L10_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_2);
        }
        if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
          PyObject* sequence = __pyx_t_2;
          Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
          if (unlikely(size != 2)) {
            if (size > 2) __Pyx_RaiseTooManyValuesError(2);
            else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
            __PYX_ERR(0, 2432, __pyx_L10_error)
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          if (likely(PyTuple_CheckExact(sequence))) {
            __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
            __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
          } else {
            __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
            __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
          }
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_1);
          #else
          __pyx_t_4 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2432, __pyx_L10_error)
          __Pyx_GOTREF(__pyx_t_4);
          __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2432, __pyx_L10_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        } else {
          Py_ssize_t index = -1;
          __pyx_t_10 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2432, __pyx_L10_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_15 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_10);
          index = 0; __pyx_t_4 = __pyx_t_15(__pyx_t_10); if (unlikely(!__pyx_t_4)) goto __pyx_L15_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_4);
          index = 1; __pyx_t_1 = __pyx_t_15(__pyx_t_10); if (unlikely(!__pyx_t_1)) goto __pyx_L15_unpacking_failed;
          __Pyx_GOTREF(__pyx_t_1);
          if (__Pyx_IternextUnpackEndCheck(__pyx_t_15(__pyx_t_10), 2) < 0) __PYX_ERR(0, 2432, __pyx_L10_error)
          __pyx_t_15 = NULL;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          goto __pyx_L16_unpacking_done;
          __pyx_L15_unpacking_failed:;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          __pyx_t_15 = NULL;
          if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
          __PYX_ERR(0, 2432, __pyx_L10_error)
          __pyx_L16_unpacking_done:;
        }
        __Pyx_XDECREF_SET(__pyx_8genexpr6__pyx_v__, __pyx_t_4);
        __pyx_t_4 = 0;
        __Pyx_XDECREF_SET(__pyx_8genexpr6__pyx_v_row, __pyx_t_1);
        __pyx_t_1 = 0;

        /* "gofast/tools/mathex.pyx":2428
 *     # Generate the sunburst data structure
 *     sunburst_data = [
 *         {"name": row[hierarchy[-1]],             # <<<<<<<<<<<<<<
 *          "value": row[value_column],
 *          "parent": row[hierarchy[-2]] if i > 0 else ""}
 */
        __Pyx_TraceLine(2428,0,__PYX_ERR(0, 2428, __pyx_L10_error))
        __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2428, __pyx_L10_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_hierarchy, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2428, __pyx_L10_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_8genexpr6__pyx_v_row, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2428, __pyx_L10_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_name_2, __pyx_t_4) < 0) __PYX_ERR(0, 2428, __pyx_L10_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "gofast/tools/mathex.pyx":2429
 *     sunburst_data = [
 *         {"name": row[hierarchy[-1]],
 *          "value": row[value_column],             # <<<<<<<<<<<<<<
 *          "parent": row[hierarchy[-2]] if i > 0 else ""}
 *         for i in range(len(hierarchy))
 */
        __Pyx_TraceLine(2429,0,__PYX_ERR(0, 2429, __pyx_L10_error))
        __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_8genexpr6__pyx_v_row, __pyx_v_value_column); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2429, __pyx_L10_error)
        __Pyx_GOTREF(__pyx_t_4);
        if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_value, __pyx_t_4) < 0) __PYX_ERR(0, 2428, __pyx_L10_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "gofast/tools/mathex.pyx":2430
 *         {"name": row[hierarchy[-1]],
 *          "value": row[value_column],
 *          "parent": row[hierarchy[-2]] if i > 0 else ""}             # <<<<<<<<<<<<<<
 *         for i in range(len(hierarchy))
 *         for _, row in df_full[hierarchy[:i+1] + [value_column]].iterrows()
 */
        __Pyx_TraceLine(2430,0,__PYX_ERR(0, 2430, __pyx_L10_error))
        __pyx_t_5 = (__pyx_8genexpr6__pyx_v_i > 0);
        if (__pyx_t_5) {
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_hierarchy, -2L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2430, __pyx_L10_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_8genexpr6__pyx_v_row, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2430, __pyx_L10_error)
          __Pyx_GOTREF(__pyx_t_10);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_4 = __pyx_t_10;
          __pyx_t_10 = 0;
        } else {
          __Pyx_INCREF(__pyx_kp_u__65);
          __pyx_t_4 = __pyx_kp_u__65;
        }
        if (PyDict_SetItem(__pyx_t_2, __pyx_n_u_parent, __pyx_t_4) < 0) __PYX_ERR(0, 2428, __pyx_L10_error)
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 2427, __pyx_L10_error)
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "gofast/tools/mathex.pyx":2432
 *          "parent": row[hierarchy[-2]] if i > 0 else ""}
 *         for i in range(len(hierarchy))
 *         for _, row in df_full[hierarchy[:i+1] + [value_column]].iterrows()             # <<<<<<<<<<<<<<
 *     ]
 * 
 */
        __Pyx_TraceLine(2432,0,__PYX_ERR(0, 2432, __pyx_L10_error))
      }
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    }
    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__); __pyx_8genexpr6__pyx_v__ = 0;
    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_row); __pyx_8genexpr6__pyx_v_row = 0;
    goto __pyx_L18_exit_scope;
    __pyx_L10_error:;
    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__); __pyx_8genexpr6__pyx_v__ = 0;
    __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_row); __pyx_8genexpr6__pyx_v_row = 0;
    goto __pyx_L1_error;
    __pyx_L18_exit_scope:;
  } /* exit inner scope */
  __pyx_v_sunburst_data = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2436
 * 
 *     # Remove duplicates, preserve order, and return
 *     seen = set()             # <<<<<<<<<<<<<<
 *     return [x for x in sunburst_data if not (
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 */
  __Pyx_TraceLine(2436,0,__PYX_ERR(0, 2436, __pyx_L1_error))
  __pyx_t_3 = PySet_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2436, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_seen = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2437
 *     # Remove duplicates, preserve order, and return
 *     seen = set()
 *     return [x for x in sunburst_data if not (             # <<<<<<<<<<<<<<
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 */
  __Pyx_TraceLine(2437,0,__PYX_ERR(0, 2437, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  { /* enter inner scope */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2437, __pyx_L21_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_11 = __pyx_v_sunburst_data; __Pyx_INCREF(__pyx_t_11);
    __pyx_t_7 = 0;
    for (;;) {
      {
        Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_11);
        #if !CYTHON_ASSUME_SAFE_MACROS
        if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2437, __pyx_L21_error)
        #endif
        if (__pyx_t_7 >= __pyx_temp) break;
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_11, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 2437, __pyx_L21_error)
      #else
      __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_11, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2437, __pyx_L21_error)
      __Pyx_GOTREF(__pyx_t_2);
      #endif
      __Pyx_XDECREF_SET(__pyx_8genexpr7__pyx_v_x, __pyx_t_2);
      __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":2438
 *     seen = set()
 *     return [x for x in sunburst_data if not (
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]             # <<<<<<<<<<<<<<
 * 
 * def compute_effort_yield(
 */
      __Pyx_TraceLine(2438,0,__PYX_ERR(0, 2438, __pyx_L21_error))
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_8genexpr7__pyx_v_x, __pyx_n_s_items); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2438, __pyx_L21_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_10 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_4))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_4);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_4, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, NULL};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2438, __pyx_L21_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      }
      __pyx_t_4 = __Pyx_PySequence_Tuple(__pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2438, __pyx_L21_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_16 = (__Pyx_PySet_ContainsTF(__pyx_t_4, __pyx_v_seen, Py_EQ)); if (unlikely((__pyx_t_16 < 0))) __PYX_ERR(0, 2438, __pyx_L21_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (!__pyx_t_16) {
      } else {
        __pyx_t_5 = __pyx_t_16;
        goto __pyx_L25_bool_binop_done;
      }
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_8genexpr7__pyx_v_x, __pyx_n_s_items); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2438, __pyx_L21_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, NULL};
        __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2438, __pyx_L21_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __pyx_t_2 = __Pyx_PySequence_Tuple(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2438, __pyx_L21_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_17 = PySet_Add(__pyx_v_seen, __pyx_t_2); if (unlikely(__pyx_t_17 == ((int)-1))) __PYX_ERR(0, 2438, __pyx_L21_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_16 = (__pyx_t_17 != 0);
      __pyx_t_5 = __pyx_t_16;
      __pyx_L25_bool_binop_done:;

      /* "gofast/tools/mathex.pyx":2437
 *     # Remove duplicates, preserve order, and return
 *     seen = set()
 *     return [x for x in sunburst_data if not (             # <<<<<<<<<<<<<<
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 */
      __Pyx_TraceLine(2437,0,__PYX_ERR(0, 2437, __pyx_L21_error))
      __pyx_t_16 = (!__pyx_t_5);
      if (__pyx_t_16) {
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_8genexpr7__pyx_v_x))) __PYX_ERR(0, 2437, __pyx_L21_error)
      }
    }
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v_x); __pyx_8genexpr7__pyx_v_x = 0;
    goto __pyx_L28_exit_scope;
    __pyx_L21_error:;
    __Pyx_XDECREF(__pyx_8genexpr7__pyx_v_x); __pyx_8genexpr7__pyx_v_x = 0;
    goto __pyx_L1_error;
    __pyx_L28_exit_scope:;
  } /* exit inner scope */
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2348
 *     return sources, targets, values
 * 
 * def compute_sunburst_data(             # <<<<<<<<<<<<<<
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_sunburst_data", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_df_full);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_df_level);
  __Pyx_XDECREF(__pyx_v_sunburst_data);
  __Pyx_XDECREF(__pyx_v_seen);
  __Pyx_XDECREF(__pyx_8genexpr6__pyx_v__);
  __Pyx_XDECREF(__pyx_8genexpr6__pyx_v_row);
  __Pyx_XDECREF(__pyx_8genexpr7__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_data);
  __Pyx_XDECREF(__pyx_v_hierarchy);
  __Pyx_XDECREF(__pyx_v_value_column);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2440
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 * def compute_effort_yield(             # <<<<<<<<<<<<<<
 *         d: ArrayLike,  reverse: bool = True
 *         ) -> Tuple[ArrayLike, np.ndarray]:
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_55compute_effort_yield(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_54compute_effort_yield, "\n    Compute effort and yield values from importance data for use in \n    ABC analysis or similar plots.\n\n    This function takes an array of importance measures (e.g., weights, scores) \n    and computes the cumulative effort and corresponding yield. \n    The effort is the cumulative percentage of items when sorted by importance,\n    and the yield is the cumulative sum of importance\n    measures, also as a percentage of the total sum.\n\n    Parameters\n    ----------\n    d : np.ndarray\n        1D array of importance measures for each item or feature.\n    reverse : bool, optional\n        If True (default), sort the data in descending order \n        (highest importance first).\n        If False, sort in ascending order (lowest importance first).\n    \n    Returns\n    -------\n    effort : np.ndarray\n        The cumulative percentage of items considered, sorted by importance.\n    yield_ : np.ndarray\n        The cumulative sum of importance measures, normalized to the total \n        sum to represent the yield as a proportion of the total importance.\n\n    Example\n    -------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex import compute_effort_yield\n    >>> importances = np.array([0.1, 0.4, 0.3, 0.2])\n    >>> effort, yield_ = compute_effort_yield(importances)\n    >>> print(effort)\n    >>> print(yield_)\n    \n    This would output:\n    >>> effort\n    [0.25 0.5  0.75 1.  ]\n    >>> yield_\n    [0.4  0.7  0.9  1.  ]\n\n    Note that the effort is simply the proportion of total items, \n    and the yield is the\n    cumulative proportion of the sum of importances.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_55compute_effort_yield = {"compute_effort_yield", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_55compute_effort_yield, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_54compute_effort_yield};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_55compute_effort_yield(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_d = 0;
  PyObject *__pyx_v_reverse = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_effort_yield (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_d,&__pyx_n_s_reverse,0};

    /* "gofast/tools/mathex.pyx":2441
 * 
 * def compute_effort_yield(
 *         d: ArrayLike,  reverse: bool = True             # <<<<<<<<<<<<<<
 *         ) -> Tuple[ArrayLike, np.ndarray]:
 *     """
 */
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_d)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2440, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_reverse);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2440, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_effort_yield") < 0)) __PYX_ERR(0, 2440, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_d = values[0];
    __pyx_v_reverse = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_effort_yield", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 2440, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_effort_yield", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_54compute_effort_yield(__pyx_self, __pyx_v_d, __pyx_v_reverse);

  /* "gofast/tools/mathex.pyx":2440
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 * def compute_effort_yield(             # <<<<<<<<<<<<<<
 *         d: ArrayLike,  reverse: bool = True
 *         ) -> Tuple[ArrayLike, np.ndarray]:
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_54compute_effort_yield(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_d, PyObject *__pyx_v_reverse) {
  PyObject *__pyx_v_sorted_indices = NULL;
  PyObject *__pyx_v_sorted_data = NULL;
  PyObject *__pyx_v_cumulative_data = NULL;
  PyObject *__pyx_v_yield_ = NULL;
  PyObject *__pyx_v_effort = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__66)
  __Pyx_RefNannySetupContext("compute_effort_yield", 0);
  __Pyx_TraceCall("compute_effort_yield", __pyx_f[0], 2440, 0, __PYX_ERR(0, 2440, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_d);

  /* "gofast/tools/mathex.pyx":2489
 *     cumulative proportion of the sum of importances.
 *     """
 *     d = np.array (d)             # <<<<<<<<<<<<<<
 *     # Validate input data
 *     if not isinstance(d, np.ndarray) or d.ndim != 1:
 */
  __Pyx_TraceLine(2489,0,__PYX_ERR(0, 2489, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_d};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2489, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_d, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2491
 *     d = np.array (d)
 *     # Validate input data
 *     if not isinstance(d, np.ndarray) or d.ndim != 1:             # <<<<<<<<<<<<<<
 *         raise ValueError("Input data must be a one-dimensional numpy array.")
 * 
 */
  __Pyx_TraceLine(2491,0,__PYX_ERR(0, 2491, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = PyObject_IsInstance(__pyx_v_d, __pyx_t_3); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 2491, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = (!__pyx_t_6);
  if (!__pyx_t_7) {
  } else {
    __pyx_t_5 = __pyx_t_7;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_d, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2491, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = (__Pyx_PyInt_BoolNeObjC(__pyx_t_3, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 2491, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_5 = __pyx_t_7;
  __pyx_L4_bool_binop_done:;
  if (unlikely(__pyx_t_5)) {

    /* "gofast/tools/mathex.pyx":2492
 *     # Validate input data
 *     if not isinstance(d, np.ndarray) or d.ndim != 1:
 *         raise ValueError("Input data must be a one-dimensional numpy array.")             # <<<<<<<<<<<<<<
 * 
 *     if not np.issubdtype(d.dtype, np.number):
 */
    __Pyx_TraceLine(2492,0,__PYX_ERR(0, 2492, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__67, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2492, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 2492, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2491
 *     d = np.array (d)
 *     # Validate input data
 *     if not isinstance(d, np.ndarray) or d.ndim != 1:             # <<<<<<<<<<<<<<
 *         raise ValueError("Input data must be a one-dimensional numpy array.")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2494
 *         raise ValueError("Input data must be a one-dimensional numpy array.")
 * 
 *     if not np.issubdtype(d.dtype, np.number):             # <<<<<<<<<<<<<<
 *         raise ValueError("Input data must be a numpy array of numerical type.")
 * 
 */
  __Pyx_TraceLine(2494,0,__PYX_ERR(0, 2494, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2494, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_issubdtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2494, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_d, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2494, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2494, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_number); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2494, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_8, __pyx_t_1, __pyx_t_9};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2494, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2494, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = (!__pyx_t_5);
  if (unlikely(__pyx_t_7)) {

    /* "gofast/tools/mathex.pyx":2495
 * 
 *     if not np.issubdtype(d.dtype, np.number):
 *         raise ValueError("Input data must be a numpy array of numerical type.")             # <<<<<<<<<<<<<<
 * 
 *     # Sort the data by importance
 */
    __Pyx_TraceLine(2495,0,__PYX_ERR(0, 2495, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__68, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2495, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 2495, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2494
 *         raise ValueError("Input data must be a one-dimensional numpy array.")
 * 
 *     if not np.issubdtype(d.dtype, np.number):             # <<<<<<<<<<<<<<
 *         raise ValueError("Input data must be a numpy array of numerical type.")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2498
 * 
 *     # Sort the data by importance
 *     sorted_indices = np.argsort(d)             # <<<<<<<<<<<<<<
 *     sorted_data = d[sorted_indices]
 *     if reverse:
 */
  __Pyx_TraceLine(2498,0,__PYX_ERR(0, 2498, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2498, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_argsort); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2498, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_d};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2498, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __pyx_v_sorted_indices = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2499
 *     # Sort the data by importance
 *     sorted_indices = np.argsort(d)
 *     sorted_data = d[sorted_indices]             # <<<<<<<<<<<<<<
 *     if reverse:
 *         sorted_data = sorted_data[::-1]
 */
  __Pyx_TraceLine(2499,0,__PYX_ERR(0, 2499, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_d, __pyx_v_sorted_indices); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2499, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_sorted_data = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2500
 *     sorted_indices = np.argsort(d)
 *     sorted_data = d[sorted_indices]
 *     if reverse:             # <<<<<<<<<<<<<<
 *         sorted_data = sorted_data[::-1]
 * 
 */
  __Pyx_TraceLine(2500,0,__PYX_ERR(0, 2500, __pyx_L1_error))
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_reverse); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 2500, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":2501
 *     sorted_data = d[sorted_indices]
 *     if reverse:
 *         sorted_data = sorted_data[::-1]             # <<<<<<<<<<<<<<
 * 
 *     # Calculate cumulative sum of the sorted data
 */
    __Pyx_TraceLine(2501,0,__PYX_ERR(0, 2501, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_sorted_data, __pyx_slice__69); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2501, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF_SET(__pyx_v_sorted_data, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":2500
 *     sorted_indices = np.argsort(d)
 *     sorted_data = d[sorted_indices]
 *     if reverse:             # <<<<<<<<<<<<<<
 *         sorted_data = sorted_data[::-1]
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2504
 * 
 *     # Calculate cumulative sum of the sorted data
 *     cumulative_data = np.cumsum(sorted_data)             # <<<<<<<<<<<<<<
 * 
 *     # Normalize cumulative sum to get yield as a proportion of the total sum
 */
  __Pyx_TraceLine(2504,0,__PYX_ERR(0, 2504, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2504, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_cumsum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2504, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_v_sorted_data};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_cumulative_data = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2507
 * 
 *     # Normalize cumulative sum to get yield as a proportion of the total sum
 *     yield_ = cumulative_data / cumulative_data[-1]             # <<<<<<<<<<<<<<
 * 
 *     # Calculate the effort as the proportion of total number of items
 */
  __Pyx_TraceLine(2507,0,__PYX_ERR(0, 2507, __pyx_L1_error))
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_cumulative_data, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2507, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_v_cumulative_data, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2507, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_yield_ = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2510
 * 
 *     # Calculate the effort as the proportion of total number of items
 *     effort = np.arange(1, d.size + 1) / d.size             # <<<<<<<<<<<<<<
 * 
 *     return effort, yield_
 */
  __Pyx_TraceLine(2510,0,__PYX_ERR(0, 2510, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_d, __pyx_n_s_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_int_1, __pyx_t_1};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2510, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_d, __pyx_n_s_size); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2510, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_v_effort = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2512
 *     effort = np.arange(1, d.size + 1) / d.size
 * 
 *     return effort, yield_             # <<<<<<<<<<<<<<
 * 
 * def make_mxs(
 */
  __Pyx_TraceLine(2512,0,__PYX_ERR(0, 2512, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2512, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_effort);
  __Pyx_GIVEREF(__pyx_v_effort);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_effort)) __PYX_ERR(0, 2512, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_yield_);
  __Pyx_GIVEREF(__pyx_v_yield_);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_yield_)) __PYX_ERR(0, 2512, __pyx_L1_error);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2440
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 * def compute_effort_yield(             # <<<<<<<<<<<<<<
 *         d: ArrayLike,  reverse: bool = True
 *         ) -> Tuple[ArrayLike, np.ndarray]:
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_effort_yield", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_sorted_indices);
  __Pyx_XDECREF(__pyx_v_sorted_data);
  __Pyx_XDECREF(__pyx_v_cumulative_data);
  __Pyx_XDECREF(__pyx_v_yield_);
  __Pyx_XDECREF(__pyx_v_effort);
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2514
 *     return effort, yield_
 * 
 * def make_mxs(             # <<<<<<<<<<<<<<
 *     y,
 *     yt,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_57make_mxs(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_56make_mxs, "\n    Compute the similarity between labels in arrays true y and predicted yt. \n    \n    Function transform yt based on these similarities, and create a new \n    array `ymxs` by filling NaN values in y with corresponding labels from \n    transformed yt. Handles NaN values in `yt` based on the `mode` and\n    `include_nan` parameters. See more in [1]_\n\n    Parameters\n    ----------\n    y : array-like\n        The target array containing valid labels and potentially NaN values.\n    yt : array-like\n        The array containing predicted labels from KMeans.\n    threshold : float, optional\n        The threshold for considering a label in `y` as similar to a label \n        in `yt` (default is 0.5).\n    star_mxs : bool, optional\n        If True, appends `trailer` to labels in `yt` when similarity is found \n        (default is True).\n    return_ymx : bool, optional\n        If True, returns the mixed array `ymx`; otherwise, returns a \n        dictionary of label similarities (default is False).\n    mode : str, optional\n        \"strict\" or \"soft\" handling of NaN values in `yt` (default is \"strict\").\n    include_nan : bool, optional\n        If True and `mode` is \"soft\", includes NaN values in `yt` during \n        similarity computation (default is False).\n    trailer : str, optional\n        The string to append to labels in `yt` when `star_mxs` is True\n        (default is \"*\").\n\n    Returns\n    -------\n    array or dict\n        Mixed array `ymx` if `return_ymx` is True; otherwise, a \n        dictionary representing similarities of labels in `y` and `yt`.\n\n    Raises\n    ------\n    ValueError\n        If `yt` contains NaN values in \"strict\" mode or if `trailer` \n        is a number.\n        \n    References\n    -----------\n    [1] Kouadio, K.L, Liu R., Liu J., A mixture Learning Strategy for predicting \n        permeability coefficient K (2024). Computers and Geosciences, doi:XXXXX \n\n    Examples\n    --------\n    >>> y ="" np.array([1, 2, np.nan, 4])\n    >>> yt = np.array([1, 2, 3, 4])\n    >>> make_mxs(y, yt, threshold=0.5, star_mxs=True, return_ymx=True, trailer=\"#\")\n    array([1, 2, '3#', '44#'])\n\n    >>> make_mxs(y, yt, threshold=1.5, star_mxs=False, return_ymx=False, mode=\"soft\")\n    {1: True, 2: True, np.nan: False, 4: True}\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_57make_mxs = {"make_mxs", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_57make_mxs, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_56make_mxs};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_57make_mxs(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_yt = 0;
  PyObject *__pyx_v_threshold = 0;
  PyObject *__pyx_v_star_mxs = 0;
  PyObject *__pyx_v_return_ymxs = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_include_nan = 0;
  PyObject *__pyx_v_trailer = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[8] = {0,0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("make_mxs (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y,&__pyx_n_s_yt,&__pyx_n_s_threshold,&__pyx_n_s_star_mxs,&__pyx_n_s_return_ymxs,&__pyx_n_s_mode,&__pyx_n_s_include_nan,&__pyx_n_s_trailer,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_5)));

    /* "gofast/tools/mathex.pyx":2518
 *     yt,
 *     threshold=0.5,
 *     star_mxs=True,             # <<<<<<<<<<<<<<
 *     return_ymxs=False,
 *     mode="strict",
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));

    /* "gofast/tools/mathex.pyx":2519
 *     threshold=0.5,
 *     star_mxs=True,
 *     return_ymxs=False,             # <<<<<<<<<<<<<<
 *     mode="strict",
 *     include_nan=False,
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_strict)));

    /* "gofast/tools/mathex.pyx":2521
 *     return_ymxs=False,
 *     mode="strict",
 *     include_nan=False,             # <<<<<<<<<<<<<<
 *     trailer="*"
 *     ):
 */
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    values[7] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_kp_u__70)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_yt)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("make_mxs", 0, 2, 8, 1); __PYX_ERR(0, 2514, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_threshold);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_star_mxs);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_return_ymxs);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mode);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_include_nan);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_trailer);
          if (value) { values[7] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2514, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "make_mxs") < 0)) __PYX_ERR(0, 2514, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y = values[0];
    __pyx_v_yt = values[1];
    __pyx_v_threshold = values[2];
    __pyx_v_star_mxs = values[3];
    __pyx_v_return_ymxs = values[4];
    __pyx_v_mode = values[5];
    __pyx_v_include_nan = values[6];
    __pyx_v_trailer = values[7];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("make_mxs", 0, 2, 8, __pyx_nargs); __PYX_ERR(0, 2514, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.make_mxs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_56make_mxs(__pyx_self, __pyx_v_y, __pyx_v_yt, __pyx_v_threshold, __pyx_v_star_mxs, __pyx_v_return_ymxs, __pyx_v_mode, __pyx_v_include_nan, __pyx_v_trailer);

  /* "gofast/tools/mathex.pyx":2514
 *     return effort, yield_
 * 
 * def make_mxs(             # <<<<<<<<<<<<<<
 *     y,
 *     yt,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_56make_mxs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y, PyObject *__pyx_v_yt, PyObject *__pyx_v_threshold, PyObject *__pyx_v_star_mxs, PyObject *__pyx_v_return_ymxs, PyObject *__pyx_v_mode, PyObject *__pyx_v_include_nan, PyObject *__pyx_v_trailer) {
  PyObject *__pyx_v_pairwise_distances = NULL;
  PyObject *__pyx_v_yt_transformed = NULL;
  PyObject *__pyx_v_similarities = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_label_y = NULL;
  PyObject *__pyx_v_include_label = NULL;
  PyObject *__pyx_v_similarity = NULL;
  PyObject *__pyx_v_label_yt_trailer = NULL;
  PyObject *__pyx_v_ymxs = NULL;
  PyObject *__pyx_8genexpr8__pyx_v_label = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_t_4;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  PyObject *(*__pyx_t_11)(PyObject *);
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__71)
  __Pyx_RefNannySetupContext("make_mxs", 1);
  __Pyx_TraceCall("make_mxs", __pyx_f[0], 2514, 0, __PYX_ERR(0, 2514, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2583
 *     {1: True, 2: True, np.nan: False, 4: True}
 *     """
 *     from sklearn.metrics import pairwise_distances             # <<<<<<<<<<<<<<
 * 
 *     if not isinstance(trailer, str) or trailer.isdigit():
 */
  __Pyx_TraceLine(2583,0,__PYX_ERR(0, 2583, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2583, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_pairwise_distances);
  __Pyx_GIVEREF(__pyx_n_s_pairwise_distances);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_pairwise_distances)) __PYX_ERR(0, 2583, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_sklearn_metrics, __pyx_t_1, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2583, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_pairwise_distances); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2583, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_pairwise_distances = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2585
 *     from sklearn.metrics import pairwise_distances
 * 
 *     if not isinstance(trailer, str) or trailer.isdigit():             # <<<<<<<<<<<<<<
 *         raise ValueError("trailer must be a non-numeric string.")
 * 
 */
  __Pyx_TraceLine(2585,0,__PYX_ERR(0, 2585, __pyx_L1_error))
  __pyx_t_4 = PyUnicode_Check(__pyx_v_trailer); 
  __pyx_t_5 = (!__pyx_t_4);
  if (!__pyx_t_5) {
  } else {
    __pyx_t_3 = __pyx_t_5;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_trailer, __pyx_n_s_isdigit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2585, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2585, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2585, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __pyx_t_5;
  __pyx_L4_bool_binop_done:;
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":2586
 * 
 *     if not isinstance(trailer, str) or trailer.isdigit():
 *         raise ValueError("trailer must be a non-numeric string.")             # <<<<<<<<<<<<<<
 * 
 *     if mode == "strict" and np.isnan(yt).any():
 */
    __Pyx_TraceLine(2586,0,__PYX_ERR(0, 2586, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__72, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2586, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 2586, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2585
 *     from sklearn.metrics import pairwise_distances
 * 
 *     if not isinstance(trailer, str) or trailer.isdigit():             # <<<<<<<<<<<<<<
 *         raise ValueError("trailer must be a non-numeric string.")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2588
 *         raise ValueError("trailer must be a non-numeric string.")
 * 
 *     if mode == "strict" and np.isnan(yt).any():             # <<<<<<<<<<<<<<
 *         raise ValueError("yt should not contain NaN values in 'strict' mode.")
 * 
 */
  __Pyx_TraceLine(2588,0,__PYX_ERR(0, 2588, __pyx_L1_error))
  __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_v_mode, __pyx_n_u_strict, Py_EQ)); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2588, __pyx_L1_error)
  if (__pyx_t_5) {
  } else {
    __pyx_t_3 = __pyx_t_5;
    goto __pyx_L7_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_isnan); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_v_yt};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2588, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_any); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2588, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2588, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2588, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_3 = __pyx_t_5;
  __pyx_L7_bool_binop_done:;
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":2589
 * 
 *     if mode == "strict" and np.isnan(yt).any():
 *         raise ValueError("yt should not contain NaN values in 'strict' mode.")             # <<<<<<<<<<<<<<
 * 
 *     # Appending trailer to yt if star_mxs is True
 */
    __Pyx_TraceLine(2589,0,__PYX_ERR(0, 2589, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__73, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2589, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 2589, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":2588
 *         raise ValueError("trailer must be a non-numeric string.")
 * 
 *     if mode == "strict" and np.isnan(yt).any():             # <<<<<<<<<<<<<<
 *         raise ValueError("yt should not contain NaN values in 'strict' mode.")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":2593
 *     # Appending trailer to yt if star_mxs is True
 *     yt_transformed = np.array([f"{label}{trailer}" for label in yt]
 *                               ) if star_mxs else yt.copy()             # <<<<<<<<<<<<<<
 * 
 *     # Computing similarities and transforming yt
 */
  __Pyx_TraceLine(2593,0,__PYX_ERR(0, 2593, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_star_mxs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2593, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":2592
 * 
 *     # Appending trailer to yt if star_mxs is True
 *     yt_transformed = np.array([f"{label}{trailer}" for label in yt]             # <<<<<<<<<<<<<<
 *                               ) if star_mxs else yt.copy()
 * 
 */
    __Pyx_TraceLine(2592,0,__PYX_ERR(0, 2592, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2592, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2592, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    { /* enter inner scope */
      __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2592, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_1);
      if (likely(PyList_CheckExact(__pyx_v_yt)) || PyTuple_CheckExact(__pyx_v_yt)) {
        __pyx_t_9 = __pyx_v_yt; __Pyx_INCREF(__pyx_t_9);
        __pyx_t_10 = 0;
        __pyx_t_11 = NULL;
      } else {
        __pyx_t_10 = -1; __pyx_t_9 = PyObject_GetIter(__pyx_v_yt); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2592, __pyx_L11_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2592, __pyx_L11_error)
      }
      for (;;) {
        if (likely(!__pyx_t_11)) {
          if (likely(PyList_CheckExact(__pyx_t_9))) {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_9);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2592, __pyx_L11_error)
              #endif
              if (__pyx_t_10 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_12 = PyList_GET_ITEM(__pyx_t_9, __pyx_t_10); __Pyx_INCREF(__pyx_t_12); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 2592, __pyx_L11_error)
            #else
            __pyx_t_12 = __Pyx_PySequence_ITEM(__pyx_t_9, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2592, __pyx_L11_error)
            __Pyx_GOTREF(__pyx_t_12);
            #endif
          } else {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_9);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2592, __pyx_L11_error)
              #endif
              if (__pyx_t_10 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_12 = PyTuple_GET_ITEM(__pyx_t_9, __pyx_t_10); __Pyx_INCREF(__pyx_t_12); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 2592, __pyx_L11_error)
            #else
            __pyx_t_12 = __Pyx_PySequence_ITEM(__pyx_t_9, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2592, __pyx_L11_error)
            __Pyx_GOTREF(__pyx_t_12);
            #endif
          }
        } else {
          __pyx_t_12 = __pyx_t_11(__pyx_t_9);
          if (unlikely(!__pyx_t_12)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 2592, __pyx_L11_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_12);
        }
        __Pyx_XDECREF_SET(__pyx_8genexpr8__pyx_v_label, __pyx_t_12);
        __pyx_t_12 = 0;
        __pyx_t_12 = __Pyx_PyObject_FormatSimple(__pyx_8genexpr8__pyx_v_label, __pyx_empty_unicode); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2592, __pyx_L11_error)
        __Pyx_GOTREF(__pyx_t_12);
        __pyx_t_13 = __Pyx_PyObject_FormatSimple(__pyx_v_trailer, __pyx_empty_unicode); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 2592, __pyx_L11_error)
        __Pyx_GOTREF(__pyx_t_13);
        __pyx_t_14 = __Pyx_PyUnicode_ConcatInPlace(__pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2592, __pyx_L11_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_14))) __PYX_ERR(0, 2592, __pyx_L11_error)
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      }
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_8genexpr8__pyx_v_label); __pyx_8genexpr8__pyx_v_label = 0;
      goto __pyx_L15_exit_scope;
      __pyx_L11_error:;
      __Pyx_XDECREF(__pyx_8genexpr8__pyx_v_label); __pyx_8genexpr8__pyx_v_label = 0;
      goto __pyx_L1_error;
      __pyx_L15_exit_scope:;
    } /* exit inner scope */
    __pyx_t_9 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_1};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2592, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_2 = __pyx_t_8;
    __pyx_t_8 = 0;
  } else {

    /* "gofast/tools/mathex.pyx":2593
 *     # Appending trailer to yt if star_mxs is True
 *     yt_transformed = np.array([f"{label}{trailer}" for label in yt]
 *                               ) if star_mxs else yt.copy()             # <<<<<<<<<<<<<<
 * 
 *     # Computing similarities and transforming yt
 */
    __Pyx_TraceLine(2593,0,__PYX_ERR(0, 2593, __pyx_L1_error))
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_yt, __pyx_n_s_copy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2593, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_1 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2593, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_2 = __pyx_t_8;
    __pyx_t_8 = 0;
  }
  __pyx_v_yt_transformed = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2596
 * 
 *     # Computing similarities and transforming yt
 *     similarities = {}             # <<<<<<<<<<<<<<
 *     for i, label_y in enumerate(y):
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")
 */
  __Pyx_TraceLine(2596,0,__PYX_ERR(0, 2596, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_v_similarities = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2597
 *     # Computing similarities and transforming yt
 *     similarities = {}
 *     for i, label_y in enumerate(y):             # <<<<<<<<<<<<<<
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")
 *         if include_label:
 */
  __Pyx_TraceLine(2597,0,__PYX_ERR(0, 2597, __pyx_L1_error))
  __Pyx_INCREF(__pyx_int_0);
  __pyx_t_2 = __pyx_int_0;
  if (likely(PyList_CheckExact(__pyx_v_y)) || PyTuple_CheckExact(__pyx_v_y)) {
    __pyx_t_8 = __pyx_v_y; __Pyx_INCREF(__pyx_t_8);
    __pyx_t_10 = 0;
    __pyx_t_11 = NULL;
  } else {
    __pyx_t_10 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_v_y); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2597, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2597, __pyx_L1_error)
  }
  for (;;) {
    if (likely(!__pyx_t_11)) {
      if (likely(PyList_CheckExact(__pyx_t_8))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_8);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2597, __pyx_L1_error)
          #endif
          if (__pyx_t_10 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_6 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 2597, __pyx_L1_error)
        #else
        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2597, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_8);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2597, __pyx_L1_error)
          #endif
          if (__pyx_t_10 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_6 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_10); __Pyx_INCREF(__pyx_t_6); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 2597, __pyx_L1_error)
        #else
        __pyx_t_6 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2597, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        #endif
      }
    } else {
      __pyx_t_6 = __pyx_t_11(__pyx_t_8);
      if (unlikely(!__pyx_t_6)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 2597, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_6);
    }
    __Pyx_XDECREF_SET(__pyx_v_label_y, __pyx_t_6);
    __pyx_t_6 = 0;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
    __pyx_t_6 = __Pyx_PyInt_AddObjC(__pyx_t_2, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2597, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2);
    __pyx_t_2 = __pyx_t_6;
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":2598
 *     similarities = {}
 *     for i, label_y in enumerate(y):
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")             # <<<<<<<<<<<<<<
 *         if include_label:
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold
 */
    __Pyx_TraceLine(2598,0,__PYX_ERR(0, 2598, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2598, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_isnan); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2598, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_14))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_14);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_14);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_14, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_v_label_y};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_14, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    }
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2598, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = (!__pyx_t_3);
    if (!__pyx_t_5) {
    } else {
      __pyx_t_1 = __Pyx_PyBool_FromLong(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2598, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = __pyx_t_1;
      __pyx_t_1 = 0;
      goto __pyx_L18_bool_binop_done;
    }
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_include_nan); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2598, __pyx_L1_error)
    if (__pyx_t_5) {
    } else {
      __Pyx_INCREF(__pyx_v_include_nan);
      __pyx_t_6 = __pyx_v_include_nan;
      goto __pyx_L18_bool_binop_done;
    }
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_mode, __pyx_n_u_soft, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2598, __pyx_L1_error)
    __Pyx_INCREF(__pyx_t_1);
    __pyx_t_6 = __pyx_t_1;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_L18_bool_binop_done:;
    __Pyx_XDECREF_SET(__pyx_v_include_label, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":2599
 *     for i, label_y in enumerate(y):
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")
 *         if include_label:             # <<<<<<<<<<<<<<
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold
 *             similarities[label_y] = similarity
 */
    __Pyx_TraceLine(2599,0,__PYX_ERR(0, 2599, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_include_label); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2599, __pyx_L1_error)
    if (__pyx_t_5) {

      /* "gofast/tools/mathex.pyx":2600
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")
 *         if include_label:
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold             # <<<<<<<<<<<<<<
 *             similarities[label_y] = similarity
 *             if similarity and star_mxs:
 */
      __Pyx_TraceLine(2600,0,__PYX_ERR(0, 2600, __pyx_L1_error))
      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_label_y);
      __Pyx_GIVEREF(__pyx_v_label_y);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_label_y)) __PYX_ERR(0, 2600, __pyx_L1_error);
      __pyx_t_14 = PyList_New(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_14);
      __Pyx_GIVEREF(__pyx_t_1);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_14, 0, __pyx_t_1)) __PYX_ERR(0, 2600, __pyx_L1_error);
      __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_yt, __pyx_v_i); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_1);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_1)) __PYX_ERR(0, 2600, __pyx_L1_error);
      __pyx_t_1 = 0;
      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_9);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_t_9)) __PYX_ERR(0, 2600, __pyx_L1_error);
      __pyx_t_9 = 0;
      __Pyx_INCREF(__pyx_v_pairwise_distances);
      __pyx_t_9 = __pyx_v_pairwise_distances; __pyx_t_13 = NULL;
      __pyx_t_7 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_13)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_13);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
          __pyx_t_7 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_13, __pyx_t_14, __pyx_t_1};
        __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2600, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __pyx_t_9 = __Pyx_GetItemInt(__pyx_t_6, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_9, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = PyObject_RichCompare(__pyx_t_6, __pyx_v_threshold, Py_LE); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2600, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF_SET(__pyx_v_similarity, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":2601
 *         if include_label:
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold
 *             similarities[label_y] = similarity             # <<<<<<<<<<<<<<
 *             if similarity and star_mxs:
 *                 # Transform similar labels in yt
 */
      __Pyx_TraceLine(2601,0,__PYX_ERR(0, 2601, __pyx_L1_error))
      if (unlikely((PyDict_SetItem(__pyx_v_similarities, __pyx_v_label_y, __pyx_v_similarity) < 0))) __PYX_ERR(0, 2601, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":2602
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold
 *             similarities[label_y] = similarity
 *             if similarity and star_mxs:             # <<<<<<<<<<<<<<
 *                 # Transform similar labels in yt
 *                 label_yt_trailer = f"{yt[i]}{trailer}"
 */
      __Pyx_TraceLine(2602,0,__PYX_ERR(0, 2602, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_similarity); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2602, __pyx_L1_error)
      if (__pyx_t_3) {
      } else {
        __pyx_t_5 = __pyx_t_3;
        goto __pyx_L23_bool_binop_done;
      }
      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_star_mxs); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2602, __pyx_L1_error)
      __pyx_t_5 = __pyx_t_3;
      __pyx_L23_bool_binop_done:;
      if (__pyx_t_5) {

        /* "gofast/tools/mathex.pyx":2604
 *             if similarity and star_mxs:
 *                 # Transform similar labels in yt
 *                 label_yt_trailer = f"{yt[i]}{trailer}"             # <<<<<<<<<<<<<<
 *                 yt_transformed[yt_transformed == label_yt_trailer
 *                                ] = f"{label_y}{label_yt_trailer}"
 */
        __Pyx_TraceLine(2604,0,__PYX_ERR(0, 2604, __pyx_L1_error))
        __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_v_yt, __pyx_v_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_6 = __Pyx_PyObject_FormatSimple(__pyx_t_9, __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = __Pyx_PyObject_FormatSimple(__pyx_v_trailer, __pyx_empty_unicode); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_1 = __Pyx_PyUnicode_ConcatInPlace(__pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2604, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_XDECREF_SET(__pyx_v_label_yt_trailer, ((PyObject*)__pyx_t_1));
        __pyx_t_1 = 0;

        /* "gofast/tools/mathex.pyx":2606
 *                 label_yt_trailer = f"{yt[i]}{trailer}"
 *                 yt_transformed[yt_transformed == label_yt_trailer
 *                                ] = f"{label_y}{label_yt_trailer}"             # <<<<<<<<<<<<<<
 *     # Filling NaN positions in y with corresponding labels from transformed yt
 *     ymxs = np.where(np.isnan(y), yt_transformed, y)
 */
        __Pyx_TraceLine(2606,0,__PYX_ERR(0, 2606, __pyx_L1_error))
        __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_v_label_y, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_9 = __Pyx_PyUnicode_ConcatInPlace(__pyx_t_1, __pyx_v_label_yt_trailer); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2606, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

        /* "gofast/tools/mathex.pyx":2605
 *                 # Transform similar labels in yt
 *                 label_yt_trailer = f"{yt[i]}{trailer}"
 *                 yt_transformed[yt_transformed == label_yt_trailer             # <<<<<<<<<<<<<<
 *                                ] = f"{label_y}{label_yt_trailer}"
 *     # Filling NaN positions in y with corresponding labels from transformed yt
 */
        __Pyx_TraceLine(2605,0,__PYX_ERR(0, 2605, __pyx_L1_error))
        __pyx_t_1 = PyObject_RichCompare(__pyx_v_yt_transformed, __pyx_v_label_yt_trailer, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2605, __pyx_L1_error)
        if (unlikely((PyObject_SetItem(__pyx_v_yt_transformed, __pyx_t_1, __pyx_t_9) < 0))) __PYX_ERR(0, 2605, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "gofast/tools/mathex.pyx":2602
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold
 *             similarities[label_y] = similarity
 *             if similarity and star_mxs:             # <<<<<<<<<<<<<<
 *                 # Transform similar labels in yt
 *                 label_yt_trailer = f"{yt[i]}{trailer}"
 */
      }

      /* "gofast/tools/mathex.pyx":2599
 *     for i, label_y in enumerate(y):
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")
 *         if include_label:             # <<<<<<<<<<<<<<
 *             similarity = pairwise_distances([[label_y]], [[yt[i]]])[0][0] <= threshold
 *             similarities[label_y] = similarity
 */
    }

    /* "gofast/tools/mathex.pyx":2597
 *     # Computing similarities and transforming yt
 *     similarities = {}
 *     for i, label_y in enumerate(y):             # <<<<<<<<<<<<<<
 *         include_label = not np.isnan(label_y) or (include_nan and mode == "soft")
 *         if include_label:
 */
    __Pyx_TraceLine(2597,0,__PYX_ERR(0, 2597, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2608
 *                                ] = f"{label_y}{label_yt_trailer}"
 *     # Filling NaN positions in y with corresponding labels from transformed yt
 *     ymxs = np.where(np.isnan(y), yt_transformed, y)             # <<<<<<<<<<<<<<
 * 
 *     return ymxs if return_ymxs else similarities
 */
  __Pyx_TraceLine(2608,0,__PYX_ERR(0, 2608, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_where); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 2608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_isnan); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2608, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_y};
    __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_9))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_9);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_9, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_6, __pyx_t_8, __pyx_v_yt_transformed, __pyx_v_y};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_7, 3+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2608, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  }
  __pyx_v_ymxs = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2610
 *     ymxs = np.where(np.isnan(y), yt_transformed, y)
 * 
 *     return ymxs if return_ymxs else similarities             # <<<<<<<<<<<<<<
 * 
 * def label_importance(y, include_nan=False):
 */
  __Pyx_TraceLine(2610,0,__PYX_ERR(0, 2610, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_return_ymxs); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2610, __pyx_L1_error)
  if (__pyx_t_5) {
    __Pyx_INCREF(__pyx_v_ymxs);
    __pyx_t_2 = __pyx_v_ymxs;
  } else {
    __Pyx_INCREF(__pyx_v_similarities);
    __pyx_t_2 = __pyx_v_similarities;
  }
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2514
 *     return effort, yield_
 * 
 * def make_mxs(             # <<<<<<<<<<<<<<
 *     y,
 *     yt,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("gofast.tools.mathex.make_mxs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_pairwise_distances);
  __Pyx_XDECREF(__pyx_v_yt_transformed);
  __Pyx_XDECREF(__pyx_v_similarities);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_label_y);
  __Pyx_XDECREF(__pyx_v_include_label);
  __Pyx_XDECREF(__pyx_v_similarity);
  __Pyx_XDECREF(__pyx_v_label_yt_trailer);
  __Pyx_XDECREF(__pyx_v_ymxs);
  __Pyx_XDECREF(__pyx_8genexpr8__pyx_v_label);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2612
 *     return ymxs if return_ymxs else similarities
 * 
 * def label_importance(y, include_nan=False):             # <<<<<<<<<<<<<<
 *     """
 *     Compute the importance of each label in a target array.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_59label_importance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_58label_importance, "\n    Compute the importance of each label in a target array.\n\n    This function calculates the frequency of each unique label \n    in the target array `y`. Importance is defined as the proportion of \n    occurrences of each label in the array.\n\n    Parameters\n    ----------\n    y : array-like\n        The target array containing labels.\n    include_nan : bool, optional\n        If True, includes NaN values in the calculation, otherwise \n        excludes them (default is False).\n\n    Returns\n    -------\n    dict\n        A dictionary with labels as keys and their corresponding \n        importance as values.\n\n    Notes\n    -----\n    The mathematical formulation for the importance of a label `l` is given by:\n\n    .. math::\n\n        I(l) = \\frac{\\text{{count of }} l \\text{{ in }} y}{\\text{{total number of elements in }} y}\n\n    Examples\n    --------\n    >>> y = np.array([1, 2, 2, 3, 3, 3, np.nan])\n    >>> label_importance(y)\n    {1.0: 0.16666666666666666, 2.0: 0.3333333333333333, 3.0: 0.5}\n\n    >>> label_importance(y, include_nan=True)\n    {1.0: 0.14285714285714285, 2.0: 0.2857142857142857, 3.0: 0.42857142857142855,\n     nan: 0.14285714285714285}\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_59label_importance = {"label_importance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_59label_importance, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_58label_importance};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_59label_importance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_include_nan = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("label_importance (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y,&__pyx_n_s_include_nan,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2612, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_include_nan);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2612, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "label_importance") < 0)) __PYX_ERR(0, 2612, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_y = values[0];
    __pyx_v_include_nan = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("label_importance", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 2612, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.label_importance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_58label_importance(__pyx_self, __pyx_v_y, __pyx_v_include_nan);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_58label_importance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y, PyObject *__pyx_v_include_nan) {
  PyObject *__pyx_v_labels = NULL;
  PyObject *__pyx_v_counts = NULL;
  PyObject *__pyx_v_total = NULL;
  PyObject *__pyx_8genexpr9__pyx_v_label = NULL;
  PyObject *__pyx_8genexpr9__pyx_v_count = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *(*__pyx_t_8)(PyObject *);
  Py_ssize_t __pyx_t_9;
  PyObject *(*__pyx_t_10)(PyObject *);
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__74)
  __Pyx_RefNannySetupContext("label_importance", 0);
  __Pyx_TraceCall("label_importance", __pyx_f[0], 2612, 0, __PYX_ERR(0, 2612, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y);

  /* "gofast/tools/mathex.pyx":2652
 *      nan: 0.14285714285714285}
 *     """
 *     y = np.array ( y )             # <<<<<<<<<<<<<<
 *     if not include_nan:
 *         y = y[~np.isnan(y)]
 */
  __Pyx_TraceLine(2652,0,__PYX_ERR(0, 2652, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2652, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2652, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2652, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2653
 *     """
 *     y = np.array ( y )
 *     if not include_nan:             # <<<<<<<<<<<<<<
 *         y = y[~np.isnan(y)]
 *     labels, counts = np.unique(y, return_counts=True)
 */
  __Pyx_TraceLine(2653,0,__PYX_ERR(0, 2653, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_include_nan); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 2653, __pyx_L1_error)
  __pyx_t_6 = (!__pyx_t_5);
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":2654
 *     y = np.array ( y )
 *     if not include_nan:
 *         y = y[~np.isnan(y)]             # <<<<<<<<<<<<<<
 *     labels, counts = np.unique(y, return_counts=True)
 *     total = counts.sum()
 */
    __Pyx_TraceLine(2654,0,__PYX_ERR(0, 2654, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2654, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_isnan); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2654, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_y};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2654, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = PyNumber_Invert(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2654, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_y, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2654, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":2653
 *     """
 *     y = np.array ( y )
 *     if not include_nan:             # <<<<<<<<<<<<<<
 *         y = y[~np.isnan(y)]
 *     labels, counts = np.unique(y, return_counts=True)
 */
  }

  /* "gofast/tools/mathex.pyx":2655
 *     if not include_nan:
 *         y = y[~np.isnan(y)]
 *     labels, counts = np.unique(y, return_counts=True)             # <<<<<<<<<<<<<<
 *     total = counts.sum()
 *     return {label: count / total for label, count in zip(labels, counts)}
 */
  __Pyx_TraceLine(2655,0,__PYX_ERR(0, 2655, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_unique); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_GIVEREF(__pyx_v_y);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_y)) __PYX_ERR(0, 2655, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return_counts, Py_True) < 0) __PYX_ERR(0, 2655, __pyx_L1_error)
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2655, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_7))) || (PyList_CheckExact(__pyx_t_7))) {
    PyObject* sequence = __pyx_t_7;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 2655, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_1);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    #endif
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_2 = PyObject_GetIter(__pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2);
    index = 0; __pyx_t_3 = __pyx_t_8(__pyx_t_2); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_1 = __pyx_t_8(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_2), 2) < 0) __PYX_ERR(0, 2655, __pyx_L1_error)
    __pyx_t_8 = NULL;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L5_unpacking_done;
    __pyx_L4_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_8 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 2655, __pyx_L1_error)
    __pyx_L5_unpacking_done:;
  }
  __pyx_v_labels = __pyx_t_3;
  __pyx_t_3 = 0;
  __pyx_v_counts = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2656
 *         y = y[~np.isnan(y)]
 *     labels, counts = np.unique(y, return_counts=True)
 *     total = counts.sum()             # <<<<<<<<<<<<<<
 *     return {label: count / total for label, count in zip(labels, counts)}
 * 
 */
  __Pyx_TraceLine(2656,0,__PYX_ERR(0, 2656, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_counts, __pyx_n_s_sum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2656, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2656, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_total = __pyx_t_7;
  __pyx_t_7 = 0;

  /* "gofast/tools/mathex.pyx":2657
 *     labels, counts = np.unique(y, return_counts=True)
 *     total = counts.sum()
 *     return {label: count / total for label, count in zip(labels, counts)}             # <<<<<<<<<<<<<<
 * 
 * def linear_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2657,0,__PYX_ERR(0, 2657, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  { /* enter inner scope */
    __pyx_t_7 = PyDict_New(); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 2657, __pyx_L8_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2657, __pyx_L8_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_labels);
    __Pyx_GIVEREF(__pyx_v_labels);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_labels)) __PYX_ERR(0, 2657, __pyx_L8_error);
    __Pyx_INCREF(__pyx_v_counts);
    __Pyx_GIVEREF(__pyx_v_counts);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_counts)) __PYX_ERR(0, 2657, __pyx_L8_error);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_zip, __pyx_t_1, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2657, __pyx_L8_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
      __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1);
      __pyx_t_9 = 0;
      __pyx_t_10 = NULL;
    } else {
      __pyx_t_9 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2657, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_10 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 2657, __pyx_L8_error)
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    for (;;) {
      if (likely(!__pyx_t_10)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2657, __pyx_L8_error)
            #endif
            if (__pyx_t_9 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_3); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 2657, __pyx_L8_error)
          #else
          __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2657, __pyx_L8_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 2657, __pyx_L8_error)
            #endif
            if (__pyx_t_9 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_9); __Pyx_INCREF(__pyx_t_3); __pyx_t_9++; if (unlikely((0 < 0))) __PYX_ERR(0, 2657, __pyx_L8_error)
          #else
          __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_9); __pyx_t_9++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2657, __pyx_L8_error)
          __Pyx_GOTREF(__pyx_t_3);
          #endif
        }
      } else {
        __pyx_t_3 = __pyx_t_10(__pyx_t_1);
        if (unlikely(!__pyx_t_3)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 2657, __pyx_L8_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_3);
      }
      if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
        PyObject* sequence = __pyx_t_3;
        Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
        if (unlikely(size != 2)) {
          if (size > 2) __Pyx_RaiseTooManyValuesError(2);
          else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
          __PYX_ERR(0, 2657, __pyx_L8_error)
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        if (likely(PyTuple_CheckExact(sequence))) {
          __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyTuple_GET_ITEM(sequence, 1); 
        } else {
          __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
          __pyx_t_11 = PyList_GET_ITEM(sequence, 1); 
        }
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_11);
        #else
        __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2657, __pyx_L8_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_11 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 2657, __pyx_L8_error)
        __Pyx_GOTREF(__pyx_t_11);
        #endif
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      } else {
        Py_ssize_t index = -1;
        __pyx_t_12 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 2657, __pyx_L8_error)
        __Pyx_GOTREF(__pyx_t_12);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_12);
        index = 0; __pyx_t_2 = __pyx_t_8(__pyx_t_12); if (unlikely(!__pyx_t_2)) goto __pyx_L11_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_2);
        index = 1; __pyx_t_11 = __pyx_t_8(__pyx_t_12); if (unlikely(!__pyx_t_11)) goto __pyx_L11_unpacking_failed;
        __Pyx_GOTREF(__pyx_t_11);
        if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_12), 2) < 0) __PYX_ERR(0, 2657, __pyx_L8_error)
        __pyx_t_8 = NULL;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        goto __pyx_L12_unpacking_done;
        __pyx_L11_unpacking_failed:;
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
        __pyx_t_8 = NULL;
        if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
        __PYX_ERR(0, 2657, __pyx_L8_error)
        __pyx_L12_unpacking_done:;
      }
      __Pyx_XDECREF_SET(__pyx_8genexpr9__pyx_v_label, __pyx_t_2);
      __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_8genexpr9__pyx_v_count, __pyx_t_11);
      __pyx_t_11 = 0;
      __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_8genexpr9__pyx_v_count, __pyx_v_total); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2657, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (unlikely(PyDict_SetItem(__pyx_t_7, (PyObject*)__pyx_8genexpr9__pyx_v_label, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 2657, __pyx_L8_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_count); __pyx_8genexpr9__pyx_v_count = 0;
    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_label); __pyx_8genexpr9__pyx_v_label = 0;
    goto __pyx_L14_exit_scope;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_count); __pyx_8genexpr9__pyx_v_count = 0;
    __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_label); __pyx_8genexpr9__pyx_v_label = 0;
    goto __pyx_L1_error;
    __pyx_L14_exit_scope:;
  } /* exit inner scope */
  __pyx_r = __pyx_t_7;
  __pyx_t_7 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2612
 *     return ymxs if return_ymxs else similarities
 * 
 * def label_importance(y, include_nan=False):             # <<<<<<<<<<<<<<
 *     """
 *     Compute the importance of each label in a target array.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("gofast.tools.mathex.label_importance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_labels);
  __Pyx_XDECREF(__pyx_v_counts);
  __Pyx_XDECREF(__pyx_v_total);
  __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_label);
  __Pyx_XDECREF(__pyx_8genexpr9__pyx_v_count);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2659
 *     return {label: count / total for label, count in zip(labels, counts)}
 * 
 * def linear_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     linear regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_61linear_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_60linear_regression, "\n    linear regression.\n    \n    Generate output for linear regression, modeling a relationship between\n    features and a response using a linear approach.\n\n    Linear regression is one of the simplest formss of regression, useful for\n    understanding relationships between variables and for making predictions.\n    It's widely used in various fields like economics, biology, and engineering.\n\n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n\n    Returns\n    -------\n    y : ndarray\n        The output values for linear regression with shape (n_samples,).\n\n    Formula\n    -------\n    y = X \\cdot coef + bias + noise\n    \n    Applications\n    ------------\n    - Trend analysis in time series data.\n    - Predictive modeling in business and finance.\n    - Estimating relationships in scientific experiments.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_61linear_regression = {"linear_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_61linear_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_60linear_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_61linear_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("linear_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2659, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2659, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("linear_regression", 0, 2, 4, 1); __PYX_ERR(0, 2659, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2659, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2659, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "linear_regression") < 0)) __PYX_ERR(0, 2659, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("linear_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2659, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.linear_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_60linear_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_60linear_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__75)
  __Pyx_RefNannySetupContext("linear_regression", 1);
  __Pyx_TraceCall("linear_regression", __pyx_f[0], 2659, 0, __PYX_ERR(0, 2659, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2696
 *     - Estimating relationships in scientific experiments.
 *     """
 *     return np.dot(X, coef) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def quadratic_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2696,0,__PYX_ERR(0, 2696, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_X, __pyx_v_coef};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_random); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_randn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2696, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2696, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2659
 *     return {label: count / total for label, count in zip(labels, counts)}
 * 
 * def linear_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     linear regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.linear_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2698
 *     return np.dot(X, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def quadratic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Quadratic regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_63quadratic_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_62quadratic_regression, "\n    Quadratic regression.\n\n    Generate output for quadratic regression, which models a parabolic \n    relationship between the dependent variable and independent variables.\n\n    Quadratic regression is suitable for datasets with a non-linear trend. It's \n    often used in areas where the rate of change increases or decreases rapidly.\n\n    Applications\n    ------------\n    - Modeling acceleration or deceleration patterns in physics.\n    - Growth rate analysis in biology and economics.\n    - Prediction in financial markets with parabolic trends.\n    \n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n        \n    Formula\n    -------\n    y = (X^2) \\cdot coef + bias + noise\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_63quadratic_regression = {"quadratic_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_63quadratic_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_62quadratic_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_63quadratic_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("quadratic_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2698, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2698, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("quadratic_regression", 0, 2, 4, 1); __PYX_ERR(0, 2698, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2698, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2698, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "quadratic_regression") < 0)) __PYX_ERR(0, 2698, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("quadratic_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2698, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.quadratic_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_62quadratic_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_62quadratic_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__76)
  __Pyx_RefNannySetupContext("quadratic_regression", 1);
  __Pyx_TraceCall("quadratic_regression", __pyx_f[0], 2698, 0, __PYX_ERR(0, 2698, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2729
 *     y = (X^2) \cdot coef + bias + noise
 *     """
 *     return np.dot(X**2, coef) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def cubic_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2729,0,__PYX_ERR(0, 2729, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Power(__pyx_v_X, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_t_2, __pyx_v_coef};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2729, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_random); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_randn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2729, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2698
 *     return np.dot(X, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def quadratic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Quadratic regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.quadratic_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2731
 *     return np.dot(X**2, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def cubic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Cubic regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_65cubic_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_64cubic_regression, "\n    Cubic regression.\n\n    Generate output for cubic regression, fitting a cubic polynomial to the data.\n\n    Cubic regression provides a more flexible curve than quadratic models and is \n    beneficial in studying more complex relationships, especially where inflection \n    points are present.\n\n    Applications\n    ------------\n    - Analyzing drug response curves in pharmacology.\n    - Studying the growth patterns of organisms or populations.\n    - Complex trend analysis in economic data.\n    \n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n\n    Formula\n    -------\n    y = (X^3) \\cdot coef + bias + noise\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_65cubic_regression = {"cubic_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_65cubic_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_64cubic_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_65cubic_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("cubic_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2731, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2731, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("cubic_regression", 0, 2, 4, 1); __PYX_ERR(0, 2731, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2731, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2731, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "cubic_regression") < 0)) __PYX_ERR(0, 2731, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("cubic_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2731, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.cubic_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_64cubic_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_64cubic_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__77)
  __Pyx_RefNannySetupContext("cubic_regression", 1);
  __Pyx_TraceCall("cubic_regression", __pyx_f[0], 2731, 0, __PYX_ERR(0, 2731, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2762
 *     y = (X^3) \cdot coef + bias + noise
 *     """
 *     return np.dot(X**3, coef) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def exponential_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2762,0,__PYX_ERR(0, 2762, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Power(__pyx_v_X, __pyx_int_3, Py_None); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_t_2, __pyx_v_coef};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_random); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_randn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2731
 *     return np.dot(X**2, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def cubic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Cubic regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.cubic_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2764
 *     return np.dot(X**3, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def exponential_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Exponential regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_67exponential_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_66exponential_regression, "\n    Exponential regression.\n\n    Generate output for exponential regression, ideal for modeling growth or decay.\n\n    Exponential regression is used when data grows or decays at a constant\n    percentage rate. It's crucial in fields like biology for population growth \n    studies or in finance for compound interest calculations.\n\n    Applications\n    ------------\n    - Modeling population growth or decline.\n    - Financial modeling for compound interest.\n    - Radioactive decay in physics.\n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n\n    Formula\n    -------\n    y = exp(X \\cdot coef) + bias + noise\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_67exponential_regression = {"exponential_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_67exponential_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_66exponential_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_67exponential_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("exponential_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2764, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2764, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("exponential_regression", 0, 2, 4, 1); __PYX_ERR(0, 2764, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2764, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2764, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "exponential_regression") < 0)) __PYX_ERR(0, 2764, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("exponential_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2764, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.exponential_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_66exponential_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_66exponential_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__78)
  __Pyx_RefNannySetupContext("exponential_regression", 1);
  __Pyx_TraceCall("exponential_regression", __pyx_f[0], 2764, 0, __PYX_ERR(0, 2764, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2794
 *     y = exp(X \cdot coef) + bias + noise
 *     """
 *     return np.exp(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def logarithmic_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2794,0,__PYX_ERR(0, 2794, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_exp); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_dot); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_X, __pyx_v_coef};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2794, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2794, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_random); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_randn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2794, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2794, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2764
 *     return np.dot(X**3, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def exponential_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Exponential regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex.exponential_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2796
 *     return np.exp(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def logarithmic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Logarithmic regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_69logarithmic_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_68logarithmic_regression, "\n    Logarithmic regression.\n\n    Generate output for logarithmic regression, suitable for modeling processes \n    that rapidly increase or decrease and then level off.\n\n    Logarithmic regression is particularly useful in situations where the rate of\n    change decreases over time. It's often used in scientific data analysis.\n\n    Applications\n    ------------\n    - Analyzing diminishing returns in economics.\n    - Growth rate analysis in biological processes.\n    - Signal processing and sound intensity measurements.\n    \n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n\n    Formula\n    -------\n    y = log(X) \\cdot coef + bias + noise\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_69logarithmic_regression = {"logarithmic_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_69logarithmic_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_68logarithmic_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_69logarithmic_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("logarithmic_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2796, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2796, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("logarithmic_regression", 0, 2, 4, 1); __PYX_ERR(0, 2796, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2796, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2796, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "logarithmic_regression") < 0)) __PYX_ERR(0, 2796, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("logarithmic_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2796, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.logarithmic_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_68logarithmic_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_68logarithmic_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__79)
  __Pyx_RefNannySetupContext("logarithmic_regression", 1);
  __Pyx_TraceCall("logarithmic_regression", __pyx_f[0], 2796, 0, __PYX_ERR(0, 2796, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2827
 *     y = log(X) \cdot coef + bias + noise
 *     """
 *     return np.dot(np.log(X), coef) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def sinusoidal_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2827,0,__PYX_ERR(0, 2827, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_log); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_X};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2827, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_5, __pyx_t_2, __pyx_v_coef};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2827, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_random); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_randn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2827, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2827, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2796
 *     return np.exp(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def logarithmic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Logarithmic regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex.logarithmic_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2829
 *     return np.dot(np.log(X), coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def sinusoidal_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Sinusoidal regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_71sinusoidal_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_70sinusoidal_regression, "\n    Sinusoidal regression.\n\n    Generate output for sinusoidal regression, fitting a sinusoidal model to the data.\n\n    This type of regression is useful for modeling cyclical patterns and is commonly\n    used in fields like meteorology, seasonal studies, and signal processing.\n\n    Applications\n    ------------\n    - Seasonal pattern analysis in climatology.\n    - Modeling cyclical trends in economics.\n    - Signal analysis in electrical engineering.\n    \n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n\n    Formula\n    -------\n    y = sin(X \\cdot coef) + bias + noise\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_71sinusoidal_regression = {"sinusoidal_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_71sinusoidal_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_70sinusoidal_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_71sinusoidal_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("sinusoidal_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2829, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2829, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("sinusoidal_regression", 0, 2, 4, 1); __PYX_ERR(0, 2829, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2829, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2829, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "sinusoidal_regression") < 0)) __PYX_ERR(0, 2829, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("sinusoidal_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2829, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.sinusoidal_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_70sinusoidal_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_70sinusoidal_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__80)
  __Pyx_RefNannySetupContext("sinusoidal_regression", 1);
  __Pyx_TraceCall("sinusoidal_regression", __pyx_f[0], 2829, 0, __PYX_ERR(0, 2829, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2859
 *     y = sin(X \cdot coef) + bias + noise
 *     """
 *     return np.sin(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def step_regression(X, coef, bias=0., noise=0.):
 */
  __Pyx_TraceLine(2859,0,__PYX_ERR(0, 2859, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sin); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_dot); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_X, __pyx_v_coef};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_random); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_randn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2859, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2859, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2829
 *     return np.dot(np.log(X), coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def sinusoidal_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Sinusoidal regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex.sinusoidal_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2861
 *     return np.sin(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def step_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Step regression.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_73step_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_72step_regression, "\n    Step regression.\n\n    Step regression is valuable for modeling scenarios where the dependent variable\n    changes abruptly at specific thresholds. It's used in quality control and market\n    segmentation analysis.\n\n    Applications\n    ------------\n    - Quality assessment in manufacturing processes.\n    - Customer segmentation in marketing.\n    - Modeling sudden changes in environmental data.\n    \n    Parameters\n    ----------\n    X : ndarray\n        The input samples with shape (n_samples, n_features).\n    coef : ndarray\n        The coefficients for the linear regression with shape (n_features,).\n    bias : float\n        The bias term in the linear equation.\n    noise : float\n        The standard deviation of the Gaussian noise added to the output.\n\n\n    Formula\n    -------\n    y = step_function(X \\cdot coef) + bias + noise\n\n    Note: step_function returns 1 if x >= 0, else 0.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_73step_regression = {"step_regression", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_73step_regression, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_72step_regression};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_73step_regression(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_coef = 0;
  PyObject *__pyx_v_bias = 0;
  PyObject *__pyx_v_noise = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("step_regression (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_coef,&__pyx_n_s_bias,&__pyx_n_s_noise,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2861, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_coef)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2861, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("step_regression", 0, 2, 4, 1); __PYX_ERR(0, 2861, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_bias);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2861, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_noise);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2861, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "step_regression") < 0)) __PYX_ERR(0, 2861, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_coef = values[1];
    __pyx_v_bias = values[2];
    __pyx_v_noise = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("step_regression", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 2861, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.step_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_72step_regression(__pyx_self, __pyx_v_X, __pyx_v_coef, __pyx_v_bias, __pyx_v_noise);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2893
 *     Note: step_function returns 1 if x >= 0, else 0.
 *     """
 *     step_function = np.vectorize(lambda x: 1 if x >= 0 else 0)             # <<<<<<<<<<<<<<
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_15step_regression_lambda1(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_15step_regression_lambda1 = {"lambda1", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_15step_regression_lambda1, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_15step_regression_lambda1(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[1] = {0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lambda1 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2893, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda1") < 0)) __PYX_ERR(0, 2893, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_x = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lambda1", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 2893, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.step_regression.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_lambda_funcdef_lambda1(__pyx_self, __pyx_v_x);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_lambda_funcdef_lambda1(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lambda1", 1);
  __Pyx_TraceCall("lambda1", __pyx_f[0], 2893, 0, __PYX_ERR(0, 2893, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_x, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2893, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 2893, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_3) {
    __Pyx_INCREF(__pyx_int_1);
    __pyx_t_1 = __pyx_int_1;
  } else {
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_1 = __pyx_int_0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("gofast.tools.mathex.step_regression.lambda1", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2861
 *     return np.sin(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def step_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Step regression.
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_72step_regression(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_coef, PyObject *__pyx_v_bias, PyObject *__pyx_v_noise) {
  PyObject *__pyx_v_step_function = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__81)
  __Pyx_RefNannySetupContext("step_regression", 1);
  __Pyx_TraceCall("step_regression", __pyx_f[0], 2861, 0, __PYX_ERR(0, 2861, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2893
 *     Note: step_function returns 1 if x >= 0, else 0.
 *     """
 *     step_function = np.vectorize(lambda x: 1 if x >= 0 else 0)             # <<<<<<<<<<<<<<
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 */
  __Pyx_TraceLine(2893,0,__PYX_ERR(0, 2893, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_vectorize); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_15step_regression_lambda1, 0, __pyx_n_s_step_regression_locals_lambda, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2893, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_step_function = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2894
 *     """
 *     step_function = np.vectorize(lambda x: 1 if x >= 0 else 0)
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])             # <<<<<<<<<<<<<<
 * 
 * def standard_scaler(X, y=None):
 */
  __Pyx_TraceLine(2894,0,__PYX_ERR(0, 2894, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_X, __pyx_v_coef};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2894, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __Pyx_INCREF(__pyx_v_step_function);
  __pyx_t_4 = __pyx_v_step_function; __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_3};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2894, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = PyNumber_Add(__pyx_t_1, __pyx_v_bias); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_random); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_randn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2894, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Multiply(__pyx_v_noise, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2894, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2861
 *     return np.sin(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def step_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Step regression.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex.step_regression", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_step_function);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2896
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def standard_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales features to have zero mean and unit variance.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_75standard_scaler(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_74standard_scaler, "\n    Scales features to have zero mean and unit variance.\n\n    Standard scaling is vital in many machine learning algorithms that are \n    sensitive to the scale of input features. It's commonly used in algorithms\n    like Support Vector Machines and k-Nearest Neighbors.\n\n    Applications\n    ------------\n    - Data preprocessing for machine learning models.\n    - Feature normalization in image processing.\n    - Standardizing variables in statistical analysis.\n    \n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,), optional\n        The output values. If provided, it will be scaled as well.\n\n    Returns\n    -------\n    X_scaled : ndarray\n        Scaled version of X.\n    y_scaled : ndarray, optional\n        Scaled version of y, if y is provided.\n\n    Formula\n    -------\n    For each feature, the Standard Scaler performs the following operation:\n        z = \014rac{x - \\mu}{\\sigma}\n    where \\mu is the mean and \\sigma is the standard deviation of the feature.\n\n    Examples\n    --------\n    >>> X = np.array([[1, 2], [3, 4], [5, 6]])\n    >>> X_scaled = standard_scaler(X)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_75standard_scaler = {"standard_scaler", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_75standard_scaler, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_74standard_scaler};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_75standard_scaler(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("standard_scaler (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_y,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2896, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2896, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "standard_scaler") < 0)) __PYX_ERR(0, 2896, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_y = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("standard_scaler", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 2896, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.standard_scaler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_74standard_scaler(__pyx_self, __pyx_v_X, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_74standard_scaler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y) {
  PyObject *__pyx_v_X_mean = NULL;
  PyObject *__pyx_v_X_std = NULL;
  PyObject *__pyx_v_X_scaled = NULL;
  PyObject *__pyx_v_y_mean = NULL;
  PyObject *__pyx_v_y_std = NULL;
  PyObject *__pyx_v_y_scaled = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__82)
  __Pyx_RefNannySetupContext("standard_scaler", 1);
  __Pyx_TraceCall("standard_scaler", __pyx_f[0], 2896, 0, __PYX_ERR(0, 2896, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2935
 *     >>> X_scaled = standard_scaler(X)
 *     """
 *     X_mean = X.mean(axis=0)             # <<<<<<<<<<<<<<
 *     X_std = X.std(axis=0)
 *     X_scaled = (X - X_mean) / X_std
 */
  __Pyx_TraceLine(2935,0,__PYX_ERR(0, 2935, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 2935, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2935, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_X_mean = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2936
 *     """
 *     X_mean = X.mean(axis=0)
 *     X_std = X.std(axis=0)             # <<<<<<<<<<<<<<
 *     X_scaled = (X - X_mean) / X_std
 * 
 */
  __Pyx_TraceLine(2936,0,__PYX_ERR(0, 2936, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_std); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2936, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2936, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 2936, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2936, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_X_std = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2937
 *     X_mean = X.mean(axis=0)
 *     X_std = X.std(axis=0)
 *     X_scaled = (X - X_mean) / X_std             # <<<<<<<<<<<<<<
 * 
 *     if y is not None:
 */
  __Pyx_TraceLine(2937,0,__PYX_ERR(0, 2937, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_X, __pyx_v_X_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_v_X_std); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_X_scaled = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":2939
 *     X_scaled = (X - X_mean) / X_std
 * 
 *     if y is not None:             # <<<<<<<<<<<<<<
 *         y_mean = y.mean()
 *         y_std = y.std()
 */
  __Pyx_TraceLine(2939,0,__PYX_ERR(0, 2939, __pyx_L1_error))
  __pyx_t_4 = (__pyx_v_y != Py_None);
  if (__pyx_t_4) {

    /* "gofast/tools/mathex.pyx":2940
 * 
 *     if y is not None:
 *         y_mean = y.mean()             # <<<<<<<<<<<<<<
 *         y_std = y.std()
 *         y_scaled = (y - y_mean) / y_std
 */
    __Pyx_TraceLine(2940,0,__PYX_ERR(0, 2940, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2940, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_v_y_mean = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2941
 *     if y is not None:
 *         y_mean = y.mean()
 *         y_std = y.std()             # <<<<<<<<<<<<<<
 *         y_scaled = (y - y_mean) / y_std
 *         return X_scaled, y_scaled
 */
    __Pyx_TraceLine(2941,0,__PYX_ERR(0, 2941, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_std); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2941, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2941, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_v_y_std = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":2942
 *         y_mean = y.mean()
 *         y_std = y.std()
 *         y_scaled = (y - y_mean) / y_std             # <<<<<<<<<<<<<<
 *         return X_scaled, y_scaled
 * 
 */
    __Pyx_TraceLine(2942,0,__PYX_ERR(0, 2942, __pyx_L1_error))
    __pyx_t_2 = PyNumber_Subtract(__pyx_v_y, __pyx_v_y_mean); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_2, __pyx_v_y_std); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_y_scaled = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":2943
 *         y_std = y.std()
 *         y_scaled = (y - y_mean) / y_std
 *         return X_scaled, y_scaled             # <<<<<<<<<<<<<<
 * 
 *     return X_scaled
 */
    __Pyx_TraceLine(2943,0,__PYX_ERR(0, 2943, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2943, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_X_scaled);
    __Pyx_GIVEREF(__pyx_v_X_scaled);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_X_scaled)) __PYX_ERR(0, 2943, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_scaled);
    __Pyx_GIVEREF(__pyx_v_y_scaled);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_y_scaled)) __PYX_ERR(0, 2943, __pyx_L1_error);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":2939
 *     X_scaled = (X - X_mean) / X_std
 * 
 *     if y is not None:             # <<<<<<<<<<<<<<
 *         y_mean = y.mean()
 *         y_std = y.std()
 */
  }

  /* "gofast/tools/mathex.pyx":2945
 *         return X_scaled, y_scaled
 * 
 *     return X_scaled             # <<<<<<<<<<<<<<
 * 
 * def minmax_scaler(X, y=None):
 */
  __Pyx_TraceLine(2945,0,__PYX_ERR(0, 2945, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_X_scaled);
  __pyx_r = __pyx_v_X_scaled;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2896
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def standard_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales features to have zero mean and unit variance.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("gofast.tools.mathex.standard_scaler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_X_mean);
  __Pyx_XDECREF(__pyx_v_X_std);
  __Pyx_XDECREF(__pyx_v_X_scaled);
  __Pyx_XDECREF(__pyx_v_y_mean);
  __Pyx_XDECREF(__pyx_v_y_std);
  __Pyx_XDECREF(__pyx_v_y_scaled);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2947
 *     return X_scaled
 * 
 * def minmax_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales each feature to a given range, typically [0, 1].
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_77minmax_scaler(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_76minmax_scaler, "\n    Scales each feature to a given range, typically [0, 1].\n\n    MinMax scaling is often used when the algorithm requires a bounded interval. \n    It's particularly useful in neural networks and image processing where values \n    need to be normalized.\n\n    Applications\n    ------------\n    - Data normalization for neural networks.\n    - Preprocessing data in computer vision tasks.\n    - Scaling features for optimization problems.\n    \n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,), optional\n        The output values. If provided, it will be scaled as well.\n\n    Returns\n    -------\n    X_scaled : ndarray\n        Scaled version of X.\n    y_scaled : ndarray, optional\n        Scaled version of y, if y is provided.\n\n    Formula\n    -------\n    The MinMax Scaler performs the following operation for each feature:\n        z = \014rac{x - \\min(x)}{\\max(x) - \\min(x)}\n\n    Examples\n    --------\n    >>> X = np.array([[1, 2], [3, 4], [5, 6]])\n    >>> X_scaled = minmax_scaler(X)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_77minmax_scaler = {"minmax_scaler", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_77minmax_scaler, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_76minmax_scaler};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_77minmax_scaler(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("minmax_scaler (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_y,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2947, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2947, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "minmax_scaler") < 0)) __PYX_ERR(0, 2947, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_y = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("minmax_scaler", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 2947, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.minmax_scaler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_76minmax_scaler(__pyx_self, __pyx_v_X, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_76minmax_scaler(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y) {
  PyObject *__pyx_v_X_min = NULL;
  PyObject *__pyx_v_X_max = NULL;
  PyObject *__pyx_v_X_scaled = NULL;
  PyObject *__pyx_v_y_min = NULL;
  PyObject *__pyx_v_y_max = NULL;
  PyObject *__pyx_v_y_scaled = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__83)
  __Pyx_RefNannySetupContext("minmax_scaler", 1);
  __Pyx_TraceCall("minmax_scaler", __pyx_f[0], 2947, 0, __PYX_ERR(0, 2947, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":2985
 *     >>> X_scaled = minmax_scaler(X)
 *     """
 *     X_min = X.min(axis=0)             # <<<<<<<<<<<<<<
 *     X_max = X.max(axis=0)
 *     X_scaled = (X - X_min) / (X_max - X_min)
 */
  __Pyx_TraceLine(2985,0,__PYX_ERR(0, 2985, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_min); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2985, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2985, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 2985, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2985, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_X_min = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2986
 *     """
 *     X_min = X.min(axis=0)
 *     X_max = X.max(axis=0)             # <<<<<<<<<<<<<<
 *     X_scaled = (X - X_min) / (X_max - X_min)
 * 
 */
  __Pyx_TraceLine(2986,0,__PYX_ERR(0, 2986, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_X, __pyx_n_s_max); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 2986, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2986, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_X_max = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":2987
 *     X_min = X.min(axis=0)
 *     X_max = X.max(axis=0)
 *     X_scaled = (X - X_min) / (X_max - X_min)             # <<<<<<<<<<<<<<
 * 
 *     if y is not None:
 */
  __Pyx_TraceLine(2987,0,__PYX_ERR(0, 2987, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_X, __pyx_v_X_min); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_X_max, __pyx_v_X_min); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_X_scaled = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2989
 *     X_scaled = (X - X_min) / (X_max - X_min)
 * 
 *     if y is not None:             # <<<<<<<<<<<<<<
 *         y_min = y.min()
 *         y_max = y.max()
 */
  __Pyx_TraceLine(2989,0,__PYX_ERR(0, 2989, __pyx_L1_error))
  __pyx_t_4 = (__pyx_v_y != Py_None);
  if (__pyx_t_4) {

    /* "gofast/tools/mathex.pyx":2990
 * 
 *     if y is not None:
 *         y_min = y.min()             # <<<<<<<<<<<<<<
 *         y_max = y.max()
 *         y_scaled = (y - y_min) / (y_max - y_min)
 */
    __Pyx_TraceLine(2990,0,__PYX_ERR(0, 2990, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_min); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2990, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2990, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_v_y_min = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":2991
 *     if y is not None:
 *         y_min = y.min()
 *         y_max = y.max()             # <<<<<<<<<<<<<<
 *         y_scaled = (y - y_min) / (y_max - y_min)
 *         return X_scaled, y_scaled
 */
    __Pyx_TraceLine(2991,0,__PYX_ERR(0, 2991, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_max); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2991, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2991, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_v_y_max = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":2992
 *         y_min = y.min()
 *         y_max = y.max()
 *         y_scaled = (y - y_min) / (y_max - y_min)             # <<<<<<<<<<<<<<
 *         return X_scaled, y_scaled
 * 
 */
    __Pyx_TraceLine(2992,0,__PYX_ERR(0, 2992, __pyx_L1_error))
    __pyx_t_3 = PyNumber_Subtract(__pyx_v_y, __pyx_v_y_min); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyNumber_Subtract(__pyx_v_y_max, __pyx_v_y_min); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 2992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_y_scaled = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":2993
 *         y_max = y.max()
 *         y_scaled = (y - y_min) / (y_max - y_min)
 *         return X_scaled, y_scaled             # <<<<<<<<<<<<<<
 * 
 *     return X_scaled
 */
    __Pyx_TraceLine(2993,0,__PYX_ERR(0, 2993, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 2993, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_X_scaled);
    __Pyx_GIVEREF(__pyx_v_X_scaled);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_X_scaled)) __PYX_ERR(0, 2993, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_scaled);
    __Pyx_GIVEREF(__pyx_v_y_scaled);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_y_scaled)) __PYX_ERR(0, 2993, __pyx_L1_error);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":2989
 *     X_scaled = (X - X_min) / (X_max - X_min)
 * 
 *     if y is not None:             # <<<<<<<<<<<<<<
 *         y_min = y.min()
 *         y_max = y.max()
 */
  }

  /* "gofast/tools/mathex.pyx":2995
 *         return X_scaled, y_scaled
 * 
 *     return X_scaled             # <<<<<<<<<<<<<<
 * 
 * def normalize(X, y=None):
 */
  __Pyx_TraceLine(2995,0,__PYX_ERR(0, 2995, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_X_scaled);
  __pyx_r = __pyx_v_X_scaled;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2947
 *     return X_scaled
 * 
 * def minmax_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales each feature to a given range, typically [0, 1].
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("gofast.tools.mathex.minmax_scaler", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_X_min);
  __Pyx_XDECREF(__pyx_v_X_max);
  __Pyx_XDECREF(__pyx_v_X_scaled);
  __Pyx_XDECREF(__pyx_v_y_min);
  __Pyx_XDECREF(__pyx_v_y_max);
  __Pyx_XDECREF(__pyx_v_y_scaled);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":2997
 *     return X_scaled
 * 
 * def normalize(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales individual samples to have unit norm.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_79normalize(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_78normalize, "\n    Scales individual samples to have unit norm.\n\n    Normalization is critical for distance-based algorithms like k-Nearest \n    Neighbors and clustering algorithms. It ensures that each feature \n    contributes proportionately to the final distance.\n\n    Applications\n    ------------\n    - Preprocessing for clustering algorithms.\n    - Normalizing data in natural language processing.\n    - Feature scaling in bioinformatics.\n    \n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,), optional\n        The output values. If provided, it will be normalized as well.\n\n    Returns\n    -------\n    X_normalized : ndarray\n        Normalized version of X.\n    y_normalized : ndarray, optional\n        Normalized version of y, if y is provided.\n\n    Formula\n    -------\n    The Normalize method scales each sample as follows:\n        z = \014rac{x}{||x||}\n    where ||x|| is the Euclidean norm (L2 norm) of the sample.\n\n    Examples\n    --------\n    >>> X = np.array([[1, 2], [3, 4], [5, 6]])\n    >>> X_normalized = normalize(X)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_79normalize = {"normalize", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_79normalize, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_78normalize};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_79normalize(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("normalize (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_y,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2997, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 2997, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "normalize") < 0)) __PYX_ERR(0, 2997, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_y = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("normalize", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 2997, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.normalize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_78normalize(__pyx_self, __pyx_v_X, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_78normalize(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y) {
  PyObject *__pyx_v_X_norm = NULL;
  PyObject *__pyx_v_X_normalized = NULL;
  PyObject *__pyx_v_y_norm = NULL;
  PyObject *__pyx_v_y_normalized = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__84)
  __Pyx_RefNannySetupContext("normalize", 0);
  __Pyx_TraceCall("normalize", __pyx_f[0], 2997, 0, __PYX_ERR(0, 2997, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_X);

  /* "gofast/tools/mathex.pyx":3036
 *     >>> X_normalized = normalize(X)
 *     """
 *     X = ensure_2d(X)             # <<<<<<<<<<<<<<
 *     X_norm = np.linalg.norm(X, axis=1, keepdims=True)
 *     X_normalized = X / X_norm
 */
  __Pyx_TraceLine(3036,0,__PYX_ERR(0, 3036, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_ensure_2d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3036, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_X};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3036, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_X, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3037
 *     """
 *     X = ensure_2d(X)
 *     X_norm = np.linalg.norm(X, axis=1, keepdims=True)             # <<<<<<<<<<<<<<
 *     X_normalized = X / X_norm
 * 
 */
  __Pyx_TraceLine(3037,0,__PYX_ERR(0, 3037, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_linalg); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_norm); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_X);
  __Pyx_GIVEREF(__pyx_v_X);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_X)) __PYX_ERR(0, 3037, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_axis, __pyx_int_1) < 0) __PYX_ERR(0, 3037, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_keepdims, Py_True) < 0) __PYX_ERR(0, 3037, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3037, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_X_norm = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":3038
 *     X = ensure_2d(X)
 *     X_norm = np.linalg.norm(X, axis=1, keepdims=True)
 *     X_normalized = X / X_norm             # <<<<<<<<<<<<<<
 * 
 *     if y is not None:
 */
  __Pyx_TraceLine(3038,0,__PYX_ERR(0, 3038, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyNumber_Divide(__pyx_v_X, __pyx_v_X_norm); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_v_X_normalized = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":3040
 *     X_normalized = X / X_norm
 * 
 *     if y is not None:             # <<<<<<<<<<<<<<
 *         y_norm = np.linalg.norm(y, axis=0, keepdims=True)
 *         y_normalized = y / y_norm
 */
  __Pyx_TraceLine(3040,0,__PYX_ERR(0, 3040, __pyx_L1_error))
  __pyx_t_6 = (__pyx_v_y != Py_None);
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3041
 * 
 *     if y is not None:
 *         y_norm = np.linalg.norm(y, axis=0, keepdims=True)             # <<<<<<<<<<<<<<
 *         y_normalized = y / y_norm
 *         return X_normalized, y_normalized
 */
    __Pyx_TraceLine(3041,0,__PYX_ERR(0, 3041, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3041, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_linalg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3041, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_norm); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3041, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3041, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_y);
    __Pyx_GIVEREF(__pyx_v_y);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_y)) __PYX_ERR(0, 3041, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3041, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 3041, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_keepdims, Py_True) < 0) __PYX_ERR(0, 3041, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3041, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_v_y_norm = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3042
 *     if y is not None:
 *         y_norm = np.linalg.norm(y, axis=0, keepdims=True)
 *         y_normalized = y / y_norm             # <<<<<<<<<<<<<<
 *         return X_normalized, y_normalized
 * 
 */
    __Pyx_TraceLine(3042,0,__PYX_ERR(0, 3042, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_v_y, __pyx_v_y_norm); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3042, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_v_y_normalized = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3043
 *         y_norm = np.linalg.norm(y, axis=0, keepdims=True)
 *         y_normalized = y / y_norm
 *         return X_normalized, y_normalized             # <<<<<<<<<<<<<<
 * 
 *     return X_normalized
 */
    __Pyx_TraceLine(3043,0,__PYX_ERR(0, 3043, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3043, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_X_normalized);
    __Pyx_GIVEREF(__pyx_v_X_normalized);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_X_normalized)) __PYX_ERR(0, 3043, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y_normalized);
    __Pyx_GIVEREF(__pyx_v_y_normalized);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_y_normalized)) __PYX_ERR(0, 3043, __pyx_L1_error);
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":3040
 *     X_normalized = X / X_norm
 * 
 *     if y is not None:             # <<<<<<<<<<<<<<
 *         y_norm = np.linalg.norm(y, axis=0, keepdims=True)
 *         y_normalized = y / y_norm
 */
  }

  /* "gofast/tools/mathex.pyx":3045
 *         return X_normalized, y_normalized
 * 
 *     return X_normalized             # <<<<<<<<<<<<<<
 * def moving_average (
 *     y:ArrayLike,
 */
  __Pyx_TraceLine(3045,0,__PYX_ERR(0, 3045, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_X_normalized);
  __pyx_r = __pyx_v_X_normalized;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":2997
 *     return X_scaled
 * 
 * def normalize(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales individual samples to have unit norm.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex.normalize", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_X_norm);
  __Pyx_XDECREF(__pyx_v_X_normalized);
  __Pyx_XDECREF(__pyx_v_y_norm);
  __Pyx_XDECREF(__pyx_v_y_normalized);
  __Pyx_XDECREF(__pyx_v_X);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3046
 * 
 *     return X_normalized
 * def moving_average (             # <<<<<<<<<<<<<<
 *     y:ArrayLike,
 *     *,
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_136__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__defaults__", 1);
  __Pyx_TraceCall("__defaults__", __pyx_f[0], 3046, 0, __PYX_ERR(0, 3046, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3046, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_window_size, __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self)->__pyx_arg_window_size) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_method, ((PyObject*)__pyx_n_u_sma)) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_mode, ((PyObject*)__pyx_n_u_same)) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_alpha, ((PyObject*)__pyx_float__5)) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3046, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, Py_None)) __PYX_ERR(0, 3046, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_1)) __PYX_ERR(0, 3046, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("gofast.tools.mathex.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_81moving_average(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_80moving_average, " A moving average is  used with time series data to smooth out\n    short-term fluctuations and highlight longer-term trends or cycles.\n    \n    Funtion analyzes data points by creating a series of averages of different\n    subsets of the full data set. \n    \n    Parameters \n    ----------\n    y : array_like, shape (N,)\n        the values of the time history of the signal.\n        \n    window_size : int\n        the length of the window. Must be greater than 1 and preferably\n        an odd integer number.Default is ``3``\n        \n    method: str \n        variant of moving-average. Can be ``sma``, ``cma``, ``wma`` and ``ema`` \n        for simple, cummulative, weight and exponential moving average. Default \n        is ``sma``. \n        \n    mode: str\n        returns the convolution at each point of overlap, with an output shape\n        of (N+M-1,). At the end-points of the convolution, the signals do not \n        overlap completely, and boundary effects may be seen. Can be ``full``,\n        ``same`` and ``valid``. See :doc:`~np.convole` for more details. Default \n        is ``same``. \n        \n    alpha: float, \n        smoothing factor. Only uses in exponential moving-average. Default is \n        ``.5``.\n    \n    Returns \n    --------\n    ya: array like, shape (N,) \n        Averaged time history of the signal\n    \n    Notes \n    -------\n    The first element of the moving average is obtained by taking the average \n    of the initial fixed subset of the number series. Then the subset is\n    modified by \"shifting forward\"; that is, excluding the first number of the\n    series and including the next value in the subset.\n    \n    Examples\n    --------- \n    >>> import numpy as np ; import matplotlib.pyplot as plt \n    >>> from gofast.tools.tools   import moving_average \n    >>> data = np.random.randn (37) \n    >>> # add gaussion noise to the data \n    >>> data = 2 * np.sin( data)  + np.random.normal (0, 1 , len(data))\n   "" >>> window = 5  # fixed size to 5 \n    >>> sma = moving_average(data, window) \n    >>> cma = moving_average(data, window, method ='cma' )\n    >>> wma = moving_average(data, window, method ='wma' )\n    >>> ema = moving_average(data, window, method ='ema' , alpha =0.6)\n    >>> x = np.arange(len(data))\n    >>> plt.plot (x, data, 'o', x, sma , 'ok--', x, cma, 'g-.', x, wma, 'b:')\n    >>> plt.legend (['data', 'sma', 'cma', 'wma'])\n    \n    References \n    ----------\n    .. * [1] https://en.wikipedia.org/wiki/Moving_average\n    .. * [2] https://www.sciencedirect.com/topics/engineering/hanning-window\n    .. * [3] https://stackoverflow.com/questions/12816011/weighted-moving-average-with-numpy-convolve\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_81moving_average = {"moving_average", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_81moving_average, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_80moving_average};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_81moving_average(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_window_size = 0;
  PyObject *__pyx_v_method = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_alpha = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("moving_average (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_y,&__pyx_n_s_window_size,&__pyx_n_s_method,&__pyx_n_s_mode,&__pyx_n_s_alpha,0};
    __pyx_defaults1 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_self);
    values[1] = __Pyx_Arg_NewRef_FASTCALL(__pyx_dynamic_args->__pyx_arg_window_size);
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_sma)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_same)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float__5)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3046, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (kw_args > 0 && likely(kw_args <= 4)) {
        Py_ssize_t index;
        for (index = 1; index < 5 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3046, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "moving_average") < 0)) __PYX_ERR(0, 3046, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_y = values[0];
    __pyx_v_window_size = ((PyObject*)values[1]);
    __pyx_v_method = ((PyObject*)values[2]);
    __pyx_v_mode = ((PyObject*)values[3]);
    __pyx_v_alpha = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("moving_average", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 3046, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.moving_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_window_size), (&PyInt_Type), 0, "window_size", 1))) __PYX_ERR(0, 3049, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 0, "method", 1))) __PYX_ERR(0, 3050, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mode), (&PyUnicode_Type), 0, "mode", 1))) __PYX_ERR(0, 3051, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_80moving_average(__pyx_self, __pyx_v_y, __pyx_v_window_size, __pyx_v_method, __pyx_v_mode, __pyx_v_alpha);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_80moving_average(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_y, PyObject *__pyx_v_window_size, PyObject *__pyx_v_method, PyObject *__pyx_v_mode, PyObject *__pyx_v_alpha) {
  PyObject *__pyx_v_ya = NULL;
  PyObject *__pyx_v_w = NULL;
  PyObject *__pyx_v_ii = NULL;
  PyObject *__pyx_v_v = NULL;
  Py_ssize_t __pyx_9genexpr10__pyx_v_ii;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_t_14;
  Py_ssize_t __pyx_t_15;
  Py_ssize_t __pyx_t_16;
  Py_ssize_t __pyx_t_17;
  PyObject *(*__pyx_t_18)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__85)
  __Pyx_RefNannySetupContext("moving_average", 0);
  __Pyx_TraceCall("moving_average", __pyx_f[0], 3046, 0, __PYX_ERR(0, 3046, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_INCREF(__pyx_v_window_size);
  __Pyx_INCREF(__pyx_v_method);

  /* "gofast/tools/mathex.pyx":3120
 * 
 *     """
 *     y = np.array(y)             # <<<<<<<<<<<<<<
 *     try:
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 */
  __Pyx_TraceLine(3120,0,__PYX_ERR(0, 3120, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3120, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3120, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3120, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3121
 *     """
 *     y = np.array(y)
 *     try:             # <<<<<<<<<<<<<<
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 *     except ValueError:
 */
  __Pyx_TraceLine(3121,0,__PYX_ERR(0, 3121, __pyx_L1_error))
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7);
    __Pyx_XGOTREF(__pyx_t_5);
    __Pyx_XGOTREF(__pyx_t_6);
    __Pyx_XGOTREF(__pyx_t_7);
    /*try:*/ {

      /* "gofast/tools/mathex.pyx":3122
 *     y = np.array(y)
 *     try:
 *         window_size = np.abs(_assert_all_types(int(window_size), int))             # <<<<<<<<<<<<<<
 *     except ValueError:
 *         raise ValueError("window_size has to be of type int")
 */
      __Pyx_TraceLine(3122,0,__PYX_ERR(0, 3122, __pyx_L3_error))
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3122, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_abs); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3122, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3122, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_9 = __Pyx_PyNumber_Int(__pyx_v_window_size); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3122, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_10 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_8))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_8);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_8, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_10, __pyx_t_9, ((PyObject *)(&PyInt_Type))};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3122, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      }
      __pyx_t_8 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_3};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3122, __pyx_L3_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_t_1))) __PYX_ERR(0, 3122, __pyx_L3_error)
      __Pyx_DECREF_SET(__pyx_v_window_size, ((PyObject*)__pyx_t_1));
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":3121
 *     """
 *     y = np.array(y)
 *     try:             # <<<<<<<<<<<<<<
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 *     except ValueError:
 */
    }
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":3123
 *     try:
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 *     except ValueError:             # <<<<<<<<<<<<<<
 *         raise ValueError("window_size has to be of type int")
 *     if window_size < 1:
 */
    __Pyx_TraceLine(3123,0,__PYX_ERR(0, 3123, __pyx_L5_except_error))
    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_ValueError);
    if (__pyx_t_4) {
      __Pyx_AddTraceback("gofast.tools.mathex.moving_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 3123, __pyx_L5_except_error)
      __Pyx_XGOTREF(__pyx_t_1);
      __Pyx_XGOTREF(__pyx_t_2);
      __Pyx_XGOTREF(__pyx_t_3);

      /* "gofast/tools/mathex.pyx":3124
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 *     except ValueError:
 *         raise ValueError("window_size has to be of type int")             # <<<<<<<<<<<<<<
 *     if window_size < 1:
 *         raise TypeError("window_size size must be a positive odd number")
 */
      __Pyx_TraceLine(3124,0,__PYX_ERR(0, 3124, __pyx_L5_except_error))
      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__86, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3124, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __PYX_ERR(0, 3124, __pyx_L5_except_error)
    }
    goto __pyx_L5_except_error;

    /* "gofast/tools/mathex.pyx":3121
 *     """
 *     y = np.array(y)
 *     try:             # <<<<<<<<<<<<<<
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 *     except ValueError:
 */
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_5);
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_XGIVEREF(__pyx_t_7);
    __Pyx_ExceptionReset(__pyx_t_5, __pyx_t_6, __pyx_t_7);
    goto __pyx_L1_error;
    __pyx_L8_try_end:;
  }

  /* "gofast/tools/mathex.pyx":3125
 *     except ValueError:
 *         raise ValueError("window_size has to be of type int")
 *     if window_size < 1:             # <<<<<<<<<<<<<<
 *         raise TypeError("window_size size must be a positive odd number")
 *     if  window_size > len(y):
 */
  __Pyx_TraceLine(3125,0,__PYX_ERR(0, 3125, __pyx_L1_error))
  __pyx_t_3 = PyObject_RichCompare(__pyx_v_window_size, __pyx_int_1, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3125, __pyx_L1_error)
  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3125, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(__pyx_t_11)) {

    /* "gofast/tools/mathex.pyx":3126
 *         raise ValueError("window_size has to be of type int")
 *     if window_size < 1:
 *         raise TypeError("window_size size must be a positive odd number")             # <<<<<<<<<<<<<<
 *     if  window_size > len(y):
 *         raise TypeError("window_size is too large for averaging. Window"
 */
    __Pyx_TraceLine(3126,0,__PYX_ERR(0, 3126, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__87, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3126, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 3126, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3125
 *     except ValueError:
 *         raise ValueError("window_size has to be of type int")
 *     if window_size < 1:             # <<<<<<<<<<<<<<
 *         raise TypeError("window_size size must be a positive odd number")
 *     if  window_size > len(y):
 */
  }

  /* "gofast/tools/mathex.pyx":3127
 *     if window_size < 1:
 *         raise TypeError("window_size size must be a positive odd number")
 *     if  window_size > len(y):             # <<<<<<<<<<<<<<
 *         raise TypeError("window_size is too large for averaging. Window"
 *                         f" must be greater than 0 and less than {len(y)}")
 */
  __Pyx_TraceLine(3127,0,__PYX_ERR(0, 3127, __pyx_L1_error))
  __pyx_t_12 = PyObject_Length(__pyx_v_y); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3127, __pyx_L1_error)
  __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_12); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3127, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = PyObject_RichCompare(__pyx_v_window_size, __pyx_t_3, Py_GT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3127, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3127, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(__pyx_t_11)) {

    /* "gofast/tools/mathex.pyx":3129
 *     if  window_size > len(y):
 *         raise TypeError("window_size is too large for averaging. Window"
 *                         f" must be greater than 0 and less than {len(y)}")             # <<<<<<<<<<<<<<
 * 
 *     method =str(method).lower().strip().replace ('-', ' ')
 */
    __Pyx_TraceLine(3129,0,__PYX_ERR(0, 3129, __pyx_L1_error))
    __pyx_t_12 = PyObject_Length(__pyx_v_y); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3129, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_t_12, 0, ' ', 'd'); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3129, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);

    /* "gofast/tools/mathex.pyx":3128
 *         raise TypeError("window_size size must be a positive odd number")
 *     if  window_size > len(y):
 *         raise TypeError("window_size is too large for averaging. Window"             # <<<<<<<<<<<<<<
 *                         f" must be greater than 0 and less than {len(y)}")
 * 
 */
    __Pyx_TraceLine(3128,0,__PYX_ERR(0, 3128, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyUnicode_Concat(__pyx_kp_u_window_size_is_too_large_for_ave, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 3128, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3127
 *     if window_size < 1:
 *         raise TypeError("window_size size must be a positive odd number")
 *     if  window_size > len(y):             # <<<<<<<<<<<<<<
 *         raise TypeError("window_size is too large for averaging. Window"
 *                         f" must be greater than 0 and less than {len(y)}")
 */
  }

  /* "gofast/tools/mathex.pyx":3131
 *                         f" must be greater than 0 and less than {len(y)}")
 * 
 *     method =str(method).lower().strip().replace ('-', ' ')             # <<<<<<<<<<<<<<
 * 
 *     if method in ('simple moving average',
 */
  __Pyx_TraceLine(3131,0,__PYX_ERR(0, 3131, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Str(__pyx_v_method); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_lower); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_strip); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_replace); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_8, __pyx_tuple__89, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (!(likely(PyUnicode_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_2))) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_method, ((PyObject*)__pyx_t_2));
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3133
 *     method =str(method).lower().strip().replace ('-', ' ')
 * 
 *     if method in ('simple moving average',             # <<<<<<<<<<<<<<
 *                   'simple', 'sma'):
 *         method = 'sma'
 */
  __Pyx_TraceLine(3133,0,__PYX_ERR(0, 3133, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_method);
  __pyx_t_13 = __pyx_v_method;
  __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_kp_u_simple_moving_average, Py_EQ)); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 3133, __pyx_L1_error)
  if (!__pyx_t_14) {
  } else {
    __pyx_t_11 = __pyx_t_14;
    goto __pyx_L14_bool_binop_done;
  }
  __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_simple, Py_EQ)); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 3133, __pyx_L1_error)
  if (!__pyx_t_14) {
  } else {
    __pyx_t_11 = __pyx_t_14;
    goto __pyx_L14_bool_binop_done;
  }
  __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_sma, Py_EQ)); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 3133, __pyx_L1_error)
  __pyx_t_11 = __pyx_t_14;
  __pyx_L14_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_14 = __pyx_t_11;
  if (__pyx_t_14) {

    /* "gofast/tools/mathex.pyx":3135
 *     if method in ('simple moving average',
 *                   'simple', 'sma'):
 *         method = 'sma'             # <<<<<<<<<<<<<<
 *     elif method  in ('cumulative average',
 *                      'cumulative', 'cma'):
 */
    __Pyx_TraceLine(3135,0,__PYX_ERR(0, 3135, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_sma);
    __Pyx_DECREF_SET(__pyx_v_method, __pyx_n_u_sma);

    /* "gofast/tools/mathex.pyx":3133
 *     method =str(method).lower().strip().replace ('-', ' ')
 * 
 *     if method in ('simple moving average',             # <<<<<<<<<<<<<<
 *                   'simple', 'sma'):
 *         method = 'sma'
 */
    goto __pyx_L13;
  }

  /* "gofast/tools/mathex.pyx":3136
 *                   'simple', 'sma'):
 *         method = 'sma'
 *     elif method  in ('cumulative average',             # <<<<<<<<<<<<<<
 *                      'cumulative', 'cma'):
 *         method ='cma'
 */
  __Pyx_TraceLine(3136,0,__PYX_ERR(0, 3136, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_method);
  __pyx_t_13 = __pyx_v_method;
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_kp_u_cumulative_average, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3136, __pyx_L1_error)
  if (!__pyx_t_11) {
  } else {
    __pyx_t_14 = __pyx_t_11;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_cumulative, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3136, __pyx_L1_error)
  if (!__pyx_t_11) {
  } else {
    __pyx_t_14 = __pyx_t_11;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_cma, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3136, __pyx_L1_error)
  __pyx_t_14 = __pyx_t_11;
  __pyx_L17_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_11 = __pyx_t_14;
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":3138
 *     elif method  in ('cumulative average',
 *                      'cumulative', 'cma'):
 *         method ='cma'             # <<<<<<<<<<<<<<
 *     elif method  in ('weighted moving average',
 *                      'weight', 'wma'):
 */
    __Pyx_TraceLine(3138,0,__PYX_ERR(0, 3138, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_cma);
    __Pyx_DECREF_SET(__pyx_v_method, __pyx_n_u_cma);

    /* "gofast/tools/mathex.pyx":3136
 *                   'simple', 'sma'):
 *         method = 'sma'
 *     elif method  in ('cumulative average',             # <<<<<<<<<<<<<<
 *                      'cumulative', 'cma'):
 *         method ='cma'
 */
    goto __pyx_L13;
  }

  /* "gofast/tools/mathex.pyx":3139
 *                      'cumulative', 'cma'):
 *         method ='cma'
 *     elif method  in ('weighted moving average',             # <<<<<<<<<<<<<<
 *                      'weight', 'wma'):
 *         method = 'wma'
 */
  __Pyx_TraceLine(3139,0,__PYX_ERR(0, 3139, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_method);
  __pyx_t_13 = __pyx_v_method;
  __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_kp_u_weighted_moving_average, Py_EQ)); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 3139, __pyx_L1_error)
  if (!__pyx_t_14) {
  } else {
    __pyx_t_11 = __pyx_t_14;
    goto __pyx_L20_bool_binop_done;
  }
  __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_weight, Py_EQ)); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 3139, __pyx_L1_error)
  if (!__pyx_t_14) {
  } else {
    __pyx_t_11 = __pyx_t_14;
    goto __pyx_L20_bool_binop_done;
  }
  __pyx_t_14 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_wma, Py_EQ)); if (unlikely((__pyx_t_14 < 0))) __PYX_ERR(0, 3139, __pyx_L1_error)
  __pyx_t_11 = __pyx_t_14;
  __pyx_L20_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_14 = __pyx_t_11;
  if (__pyx_t_14) {

    /* "gofast/tools/mathex.pyx":3141
 *     elif method  in ('weighted moving average',
 *                      'weight', 'wma'):
 *         method = 'wma'             # <<<<<<<<<<<<<<
 *     elif method in('exponential moving average',
 *                    'exponential', 'ema'):
 */
    __Pyx_TraceLine(3141,0,__PYX_ERR(0, 3141, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_wma);
    __Pyx_DECREF_SET(__pyx_v_method, __pyx_n_u_wma);

    /* "gofast/tools/mathex.pyx":3139
 *                      'cumulative', 'cma'):
 *         method ='cma'
 *     elif method  in ('weighted moving average',             # <<<<<<<<<<<<<<
 *                      'weight', 'wma'):
 *         method = 'wma'
 */
    goto __pyx_L13;
  }

  /* "gofast/tools/mathex.pyx":3142
 *                      'weight', 'wma'):
 *         method = 'wma'
 *     elif method in('exponential moving average',             # <<<<<<<<<<<<<<
 *                    'exponential', 'ema'):
 *         method = 'ema'
 */
  __Pyx_TraceLine(3142,0,__PYX_ERR(0, 3142, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_method);
  __pyx_t_13 = __pyx_v_method;
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_kp_u_exponential_moving_average, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3142, __pyx_L1_error)
  if (!__pyx_t_11) {
  } else {
    __pyx_t_14 = __pyx_t_11;
    goto __pyx_L23_bool_binop_done;
  }
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_exponential, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3142, __pyx_L1_error)
  if (!__pyx_t_11) {
  } else {
    __pyx_t_14 = __pyx_t_11;
    goto __pyx_L23_bool_binop_done;
  }
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_t_13, __pyx_n_u_ema, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3142, __pyx_L1_error)
  __pyx_t_14 = __pyx_t_11;
  __pyx_L23_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_11 = __pyx_t_14;
  if (likely(__pyx_t_11)) {

    /* "gofast/tools/mathex.pyx":3144
 *     elif method in('exponential moving average',
 *                    'exponential', 'ema'):
 *         method = 'ema'             # <<<<<<<<<<<<<<
 *     else :
 *         raise ValueError ("Variant average methods only includes "
 */
    __Pyx_TraceLine(3144,0,__PYX_ERR(0, 3144, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_ema);
    __Pyx_DECREF_SET(__pyx_v_method, __pyx_n_u_ema);

    /* "gofast/tools/mathex.pyx":3142
 *                      'weight', 'wma'):
 *         method = 'wma'
 *     elif method in('exponential moving average',             # <<<<<<<<<<<<<<
 *                    'exponential', 'ema'):
 *         method = 'ema'
 */
    goto __pyx_L13;
  }

  /* "gofast/tools/mathex.pyx":3146
 *         method = 'ema'
 *     else :
 *         raise ValueError ("Variant average methods only includes "             # <<<<<<<<<<<<<<
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")
 *     if  1. <= alpha <= 0 :
 */
  __Pyx_TraceLine(3146,0,__PYX_ERR(0, 3146, __pyx_L1_error))
  /*else*/ {

    /* "gofast/tools/mathex.pyx":3147
 *     else :
 *         raise ValueError ("Variant average methods only includes "
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")             # <<<<<<<<<<<<<<
 *     if  1. <= alpha <= 0 :
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')
 */
    __Pyx_TraceLine(3147,0,__PYX_ERR(0, 3147, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_smart_format); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = PyList_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_n_u_sma);
    __Pyx_GIVEREF(__pyx_n_u_sma);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_u_sma)) __PYX_ERR(0, 3147, __pyx_L1_error);
    __Pyx_INCREF(__pyx_n_u_cma);
    __Pyx_GIVEREF(__pyx_n_u_cma);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_u_cma)) __PYX_ERR(0, 3147, __pyx_L1_error);
    __Pyx_INCREF(__pyx_n_u_wma);
    __Pyx_GIVEREF(__pyx_n_u_wma);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 2, __pyx_n_u_wma)) __PYX_ERR(0, 3147, __pyx_L1_error);
    __Pyx_INCREF(__pyx_n_u_ema);
    __Pyx_GIVEREF(__pyx_n_u_ema);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 3, __pyx_n_u_ema)) __PYX_ERR(0, 3147, __pyx_L1_error);
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_1, __pyx_t_3, __pyx_n_u_or};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3147, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3147, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3146
 *         method = 'ema'
 *     else :
 *         raise ValueError ("Variant average methods only includes "             # <<<<<<<<<<<<<<
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")
 *     if  1. <= alpha <= 0 :
 */
    __Pyx_TraceLine(3146,0,__PYX_ERR(0, 3146, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Variant_average_methods_only_inc, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3146, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3146, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_Raise(__pyx_t_8, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __PYX_ERR(0, 3146, __pyx_L1_error)
  }
  __pyx_L13:;

  /* "gofast/tools/mathex.pyx":3148
 *         raise ValueError ("Variant average methods only includes "
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")
 *     if  1. <= alpha <= 0 :             # <<<<<<<<<<<<<<
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')
 * 
 */
  __Pyx_TraceLine(3148,0,__PYX_ERR(0, 3148, __pyx_L1_error))
  __pyx_t_8 = PyObject_RichCompare(__pyx_float_1_, __pyx_v_alpha, Py_LE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3148, __pyx_L1_error)
  if (__Pyx_PyObject_IsTrue(__pyx_t_8)) {
    __Pyx_DECREF(__pyx_t_8);
    __pyx_t_8 = PyObject_RichCompare(__pyx_v_alpha, __pyx_int_0, Py_LE); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3148, __pyx_L1_error)
  }
  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3148, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely(__pyx_t_11)) {

    /* "gofast/tools/mathex.pyx":3149
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")
 *     if  1. <= alpha <= 0 :
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')             # <<<<<<<<<<<<<<
 * 
 *     if method =='cma':
 */
    __Pyx_TraceLine(3149,0,__PYX_ERR(0, 3149, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__90, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3149, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_Raise(__pyx_t_8, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __PYX_ERR(0, 3149, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3148
 *         raise ValueError ("Variant average methods only includes "
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")
 *     if  1. <= alpha <= 0 :             # <<<<<<<<<<<<<<
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":3151
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')
 * 
 *     if method =='cma':             # <<<<<<<<<<<<<<
 *         y = np.cumsum (y)
 *         ya = np.array([ y[ii]/ len(y[:ii +1]) for ii in range(len(y))])
 */
  __Pyx_TraceLine(3151,0,__PYX_ERR(0, 3151, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_cma, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3151, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":3152
 * 
 *     if method =='cma':
 *         y = np.cumsum (y)             # <<<<<<<<<<<<<<
 *         ya = np.array([ y[ii]/ len(y[:ii +1]) for ii in range(len(y))])
 * 
 */
    __Pyx_TraceLine(3152,0,__PYX_ERR(0, 3152, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3152, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cumsum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3152, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_y};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3152, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3153
 *     if method =='cma':
 *         y = np.cumsum (y)
 *         ya = np.array([ y[ii]/ len(y[:ii +1]) for ii in range(len(y))])             # <<<<<<<<<<<<<<
 * 
 *     elif method =='wma':
 */
    __Pyx_TraceLine(3153,0,__PYX_ERR(0, 3153, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3153, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3153, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    { /* enter inner scope */
      __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_12 = PyObject_Length(__pyx_v_y); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3153, __pyx_L1_error)
      __pyx_t_15 = __pyx_t_12;
      for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
        __pyx_9genexpr10__pyx_v_ii = __pyx_t_16;
        __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_y, __pyx_9genexpr10__pyx_v_ii, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3153, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_9 = __Pyx_PyObject_GetSlice(__pyx_v_y, 0, (__pyx_9genexpr10__pyx_v_ii + 1), NULL, NULL, NULL, 0, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3153, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_17 = PyObject_Length(__pyx_t_9); if (unlikely(__pyx_t_17 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3153, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_17); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3153, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3153, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_10))) __PYX_ERR(0, 3153, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
    } /* exit inner scope */
    __pyx_t_10 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_3};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3153, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_v_ya = __pyx_t_8;
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3151
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')
 * 
 *     if method =='cma':             # <<<<<<<<<<<<<<
 *         y = np.cumsum (y)
 *         ya = np.array([ y[ii]/ len(y[:ii +1]) for ii in range(len(y))])
 */
    goto __pyx_L27;
  }

  /* "gofast/tools/mathex.pyx":3155
 *         ya = np.array([ y[ii]/ len(y[:ii +1]) for ii in range(len(y))])
 * 
 *     elif method =='wma':             # <<<<<<<<<<<<<<
 *         w = np.cumsum(np.ones(window_size, dtype = float))
 *         w /= np.sum(w)
 */
  __Pyx_TraceLine(3155,0,__PYX_ERR(0, 3155, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_wma, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3155, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":3156
 * 
 *     elif method =='wma':
 *         w = np.cumsum(np.ones(window_size, dtype = float))             # <<<<<<<<<<<<<<
 *         w /= np.sum(w)
 *         ya = np.convolve(y, w[::-1], mode ) #/window_size
 */
    __Pyx_TraceLine(3156,0,__PYX_ERR(0, 3156, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cumsum); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_window_size);
    __Pyx_GIVEREF(__pyx_v_window_size);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_window_size)) __PYX_ERR(0, 3156, __pyx_L1_error);
    __pyx_t_9 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    if (PyDict_SetItem(__pyx_t_9, __pyx_n_s_dtype, ((PyObject *)(&PyFloat_Type))) < 0) __PYX_ERR(0, 3156, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_2, __pyx_t_9); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_1};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3156, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_w = __pyx_t_8;
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3157
 *     elif method =='wma':
 *         w = np.cumsum(np.ones(window_size, dtype = float))
 *         w /= np.sum(w)             # <<<<<<<<<<<<<<
 *         ya = np.convolve(y, w[::-1], mode ) #/window_size
 * 
 */
    __Pyx_TraceLine(3157,0,__PYX_ERR(0, 3157, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3157, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3157, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_w};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3157, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = __Pyx_PyNumber_InPlaceDivide(__pyx_v_w, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3157, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF_SET(__pyx_v_w, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3158
 *         w = np.cumsum(np.ones(window_size, dtype = float))
 *         w /= np.sum(w)
 *         ya = np.convolve(y, w[::-1], mode ) #/window_size             # <<<<<<<<<<<<<<
 * 
 *     elif method =='ema':
 */
    __Pyx_TraceLine(3158,0,__PYX_ERR(0, 3158, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3158, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_convolve); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3158, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_w, __pyx_slice__69); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3158, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_9, __pyx_v_y, __pyx_t_8, __pyx_v_mode};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 3+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3158, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_ya = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3155
 *         ya = np.array([ y[ii]/ len(y[:ii +1]) for ii in range(len(y))])
 * 
 *     elif method =='wma':             # <<<<<<<<<<<<<<
 *         w = np.cumsum(np.ones(window_size, dtype = float))
 *         w /= np.sum(w)
 */
    goto __pyx_L27;
  }

  /* "gofast/tools/mathex.pyx":3160
 *         ya = np.convolve(y, w[::-1], mode ) #/window_size
 * 
 *     elif method =='ema':             # <<<<<<<<<<<<<<
 *         ya = np.array ([y[0]])
 *         for ii in range(1, len(y)):
 */
  __Pyx_TraceLine(3160,0,__PYX_ERR(0, 3160, __pyx_L1_error))
  __pyx_t_11 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_ema, Py_EQ)); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 3160, __pyx_L1_error)
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":3161
 * 
 *     elif method =='ema':
 *         ya = np.array ([y[0]])             # <<<<<<<<<<<<<<
 *         for ii in range(1, len(y)):
 *             v = y[ii] * alpha + ( 1- alpha ) * ya[-1]
 */
    __Pyx_TraceLine(3161,0,__PYX_ERR(0, 3161, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3161, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3161, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_y, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3161, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = PyList_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3161, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_GIVEREF(__pyx_t_3);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_9, 0, __pyx_t_3)) __PYX_ERR(0, 3161, __pyx_L1_error);
    __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_9};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3161, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_v_ya = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3162
 *     elif method =='ema':
 *         ya = np.array ([y[0]])
 *         for ii in range(1, len(y)):             # <<<<<<<<<<<<<<
 *             v = y[ii] * alpha + ( 1- alpha ) * ya[-1]
 *             ya = np.append(ya, v)
 */
    __Pyx_TraceLine(3162,0,__PYX_ERR(0, 3162, __pyx_L1_error))
    __pyx_t_12 = PyObject_Length(__pyx_v_y); if (unlikely(__pyx_t_12 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3162, __pyx_L1_error)
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_int_1)) __PYX_ERR(0, 3162, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_1)) __PYX_ERR(0, 3162, __pyx_L1_error);
    __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3162, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
      __pyx_t_8 = __pyx_t_1; __Pyx_INCREF(__pyx_t_8);
      __pyx_t_12 = 0;
      __pyx_t_18 = NULL;
    } else {
      __pyx_t_12 = -1; __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3162, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_18 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8); if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 3162, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    for (;;) {
      if (likely(!__pyx_t_18)) {
        if (likely(PyList_CheckExact(__pyx_t_8))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_8);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 3162, __pyx_L1_error)
            #endif
            if (__pyx_t_12 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyList_GET_ITEM(__pyx_t_8, __pyx_t_12); __Pyx_INCREF(__pyx_t_1); __pyx_t_12++; if (unlikely((0 < 0))) __PYX_ERR(0, 3162, __pyx_L1_error)
          #else
          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3162, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_8);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 3162, __pyx_L1_error)
            #endif
            if (__pyx_t_12 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_8, __pyx_t_12); __Pyx_INCREF(__pyx_t_1); __pyx_t_12++; if (unlikely((0 < 0))) __PYX_ERR(0, 3162, __pyx_L1_error)
          #else
          __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_8, __pyx_t_12); __pyx_t_12++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3162, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_1);
          #endif
        }
      } else {
        __pyx_t_1 = __pyx_t_18(__pyx_t_8);
        if (unlikely(!__pyx_t_1)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 3162, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_1);
      }
      __Pyx_XDECREF_SET(__pyx_v_ii, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":3163
 *         ya = np.array ([y[0]])
 *         for ii in range(1, len(y)):
 *             v = y[ii] * alpha + ( 1- alpha ) * ya[-1]             # <<<<<<<<<<<<<<
 *             ya = np.append(ya, v)
 *     else:
 */
      __Pyx_TraceLine(3163,0,__PYX_ERR(0, 3163, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_y, __pyx_v_ii); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3163, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = PyNumber_Multiply(__pyx_t_1, __pyx_v_alpha); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3163, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_alpha, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3163, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ya, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3163, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3163, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyNumber_Add(__pyx_t_9, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3163, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":3164
 *         for ii in range(1, len(y)):
 *             v = y[ii] * alpha + ( 1- alpha ) * ya[-1]
 *             ya = np.append(ya, v)             # <<<<<<<<<<<<<<
 *     else:
 *         ya = np.convolve(y , np.ones (window_size), mode ) / window_size
 */
      __Pyx_TraceLine(3164,0,__PYX_ERR(0, 3164, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3164, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_append); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3164, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_9))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_9);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_9, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_ya, __pyx_v_v};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3164, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      }
      __Pyx_DECREF_SET(__pyx_v_ya, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":3162
 *     elif method =='ema':
 *         ya = np.array ([y[0]])
 *         for ii in range(1, len(y)):             # <<<<<<<<<<<<<<
 *             v = y[ii] * alpha + ( 1- alpha ) * ya[-1]
 *             ya = np.append(ya, v)
 */
      __Pyx_TraceLine(3162,0,__PYX_ERR(0, 3162, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3160
 *         ya = np.convolve(y, w[::-1], mode ) #/window_size
 * 
 *     elif method =='ema':             # <<<<<<<<<<<<<<
 *         ya = np.array ([y[0]])
 *         for ii in range(1, len(y)):
 */
    goto __pyx_L27;
  }

  /* "gofast/tools/mathex.pyx":3166
 *             ya = np.append(ya, v)
 *     else:
 *         ya = np.convolve(y , np.ones (window_size), mode ) / window_size             # <<<<<<<<<<<<<<
 * 
 *     return ya
 */
  __Pyx_TraceLine(3166,0,__PYX_ERR(0, 3166, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_convolve); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_ones); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_window_size};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3166, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_1, __pyx_v_y, __pyx_t_3, __pyx_v_mode};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_4, 3+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3166, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __pyx_t_9 = __Pyx_PyNumber_Divide(__pyx_t_8, __pyx_v_window_size); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3166, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_v_ya = __pyx_t_9;
    __pyx_t_9 = 0;
  }
  __pyx_L27:;

  /* "gofast/tools/mathex.pyx":3168
 *         ya = np.convolve(y , np.ones (window_size), mode ) / window_size
 * 
 *     return ya             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(3168,0,__PYX_ERR(0, 3168, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_ya);
  __pyx_r = __pyx_v_ya;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3046
 * 
 *     return X_normalized
 * def moving_average (             # <<<<<<<<<<<<<<
 *     y:ArrayLike,
 *     *,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex.moving_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ya);
  __Pyx_XDECREF(__pyx_v_w);
  __Pyx_XDECREF(__pyx_v_ii);
  __Pyx_XDECREF(__pyx_v_v);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF(__pyx_v_window_size);
  __Pyx_XDECREF(__pyx_v_method);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3171
 * 
 * 
 * def count_local_minima(arr,  method='robust', order=1):             # <<<<<<<<<<<<<<
 *     """
 *     Count the number of local minima in a 1D array.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_83count_local_minima(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_82count_local_minima, "\n    Count the number of local minima in a 1D array.\n    \n    Parameters\n    ----------\n    arr : array_like\n        Input array.\n    method : {'base', 'robust'}, optional\n        Method to use for finding local minima. \n        'base' uses a simple comparison, while 'robust' \n        uses scipy's argrelextrema function. Default is 'robust'.\n    order : int, optional\n        How many points on each side to use for the comparison \n        to consider a point as a local minimum (only used with \n        'robust' method). Default is 1.\n    \n    Returns\n    -------\n    int\n        Number of local minima in the array.\n    \n    Examples\n    --------\n    >>> from gofast.tools.mathex import count_local_minima\n    >>> arr = [1, 3, 2, 4, 1, 0, 2, 1]\n    >>> count_local_minima(arr, method='base')\n    2\n    >>> count_local_minima(arr, method='robust')\n    3\n    \n    Notes\n    -----\n    - The 'base' method compares each element with its immediate \n      neighbors, which might be less accurate for noisy data.\n    - The 'robust' method uses scipy's argrelextrema function, which \n      allows for more flexible and accurate detection of local minima \n      by considering a specified number of neighboring points.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_83count_local_minima = {"count_local_minima", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_83count_local_minima, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_82count_local_minima};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_83count_local_minima(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_arr = 0;
  PyObject *__pyx_v_method = 0;
  PyObject *__pyx_v_order = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("count_local_minima (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arr,&__pyx_n_s_method,&__pyx_n_s_order,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_robust)));
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_1)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_arr)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3171, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3171, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_order);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3171, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "count_local_minima") < 0)) __PYX_ERR(0, 3171, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arr = values[0];
    __pyx_v_method = values[1];
    __pyx_v_order = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("count_local_minima", 0, 1, 3, __pyx_nargs); __PYX_ERR(0, 3171, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.count_local_minima", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_82count_local_minima(__pyx_self, __pyx_v_arr, __pyx_v_method, __pyx_v_order);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_82count_local_minima(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, PyObject *__pyx_v_method, PyObject *__pyx_v_order) {
  PyObject *__pyx_v_local_minima_count = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_local_minima_indices = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__91)
  __Pyx_RefNannySetupContext("count_local_minima", 0);
  __Pyx_TraceCall("count_local_minima", __pyx_f[0], 3171, 0, __PYX_ERR(0, 3171, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_INCREF(__pyx_v_method);

  /* "gofast/tools/mathex.pyx":3210
 *       by considering a specified number of neighboring points.
 *     """
 *     arr= check_y (arr , y_numeric =True, estimator="Array" )             # <<<<<<<<<<<<<<
 *     method= parameter_validator(
 *         "method", target_strs= {"base", "robust"})(method)
 */
  __Pyx_TraceLine(3210,0,__PYX_ERR(0, 3210, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_check_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3210, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3210, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_GIVEREF(__pyx_v_arr);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_arr)) __PYX_ERR(0, 3210, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3210, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_numeric, Py_True) < 0) __PYX_ERR(0, 3210, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_estimator, __pyx_n_u_Array) < 0) __PYX_ERR(0, 3210, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3210, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":3211
 *     """
 *     arr= check_y (arr , y_numeric =True, estimator="Array" )
 *     method= parameter_validator(             # <<<<<<<<<<<<<<
 *         "method", target_strs= {"base", "robust"})(method)
 *     if method == 'base':
 */
  __Pyx_TraceLine(3211,0,__PYX_ERR(0, 3211, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);

  /* "gofast/tools/mathex.pyx":3212
 *     arr= check_y (arr , y_numeric =True, estimator="Array" )
 *     method= parameter_validator(
 *         "method", target_strs= {"base", "robust"})(method)             # <<<<<<<<<<<<<<
 *     if method == 'base':
 *         local_minima_count = 0
 */
  __Pyx_TraceLine(3212,0,__PYX_ERR(0, 3212, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3212, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PySet_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3212, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PySet_Add(__pyx_t_1, __pyx_n_u_base) < 0) __PYX_ERR(0, 3212, __pyx_L1_error)
  if (PySet_Add(__pyx_t_1, __pyx_n_u_robust) < 0) __PYX_ERR(0, 3212, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_target_strs, __pyx_t_1) < 0) __PYX_ERR(0, 3212, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3211
 *     """
 *     arr= check_y (arr , y_numeric =True, estimator="Array" )
 *     method= parameter_validator(             # <<<<<<<<<<<<<<
 *         "method", target_strs= {"base", "robust"})(method)
 *     if method == 'base':
 */
  __Pyx_TraceLine(3211,0,__PYX_ERR(0, 3211, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__92, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3212
 *     arr= check_y (arr , y_numeric =True, estimator="Array" )
 *     method= parameter_validator(
 *         "method", target_strs= {"base", "robust"})(method)             # <<<<<<<<<<<<<<
 *     if method == 'base':
 *         local_minima_count = 0
 */
  __Pyx_TraceLine(3212,0,__PYX_ERR(0, 3212, __pyx_L1_error))
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_method};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3212, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_method, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":3213
 *     method= parameter_validator(
 *         "method", target_strs= {"base", "robust"})(method)
 *     if method == 'base':             # <<<<<<<<<<<<<<
 *         local_minima_count = 0
 *         # Iterate through the array from the second element
 */
  __Pyx_TraceLine(3213,0,__PYX_ERR(0, 3213, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_base, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3213, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3214
 *         "method", target_strs= {"base", "robust"})(method)
 *     if method == 'base':
 *         local_minima_count = 0             # <<<<<<<<<<<<<<
 *         # Iterate through the array from the second element
 *         # to the second-to-last element
 */
    __Pyx_TraceLine(3214,0,__PYX_ERR(0, 3214, __pyx_L1_error))
    __Pyx_INCREF(__pyx_int_0);
    __pyx_v_local_minima_count = __pyx_int_0;

    /* "gofast/tools/mathex.pyx":3217
 *         # Iterate through the array from the second element
 *         # to the second-to-last element
 *         for i in range(1, len(arr) - 1):             # <<<<<<<<<<<<<<
 *             if arr[i] < arr[i - 1] and arr[i] < arr[i + 1]:
 *                 local_minima_count += 1
 */
    __Pyx_TraceLine(3217,0,__PYX_ERR(0, 3217, __pyx_L1_error))
    __pyx_t_7 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3217, __pyx_L1_error)
    __pyx_t_4 = PyInt_FromSsize_t((__pyx_t_7 - 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_int_1)) __PYX_ERR(0, 3217, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_4);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4)) __PYX_ERR(0, 3217, __pyx_L1_error);
    __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_1, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3217, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
      __pyx_t_1 = __pyx_t_4; __Pyx_INCREF(__pyx_t_1);
      __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
    } else {
      __pyx_t_7 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3217, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3217, __pyx_L1_error)
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    for (;;) {
      if (likely(!__pyx_t_8)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 3217, __pyx_L1_error)
            #endif
            if (__pyx_t_7 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 3217, __pyx_L1_error)
          #else
          __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3217, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 3217, __pyx_L1_error)
            #endif
            if (__pyx_t_7 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_4); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 3217, __pyx_L1_error)
          #else
          __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3217, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_4);
          #endif
        }
      } else {
        __pyx_t_4 = __pyx_t_8(__pyx_t_1);
        if (unlikely(!__pyx_t_4)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 3217, __pyx_L1_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_4);
      }
      __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
      __pyx_t_4 = 0;

      /* "gofast/tools/mathex.pyx":3218
 *         # to the second-to-last element
 *         for i in range(1, len(arr) - 1):
 *             if arr[i] < arr[i - 1] and arr[i] < arr[i + 1]:             # <<<<<<<<<<<<<<
 *                 local_minima_count += 1
 *         return local_minima_count
 */
      __Pyx_TraceLine(3218,0,__PYX_ERR(0, 3218, __pyx_L1_error))
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_arr, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_v_arr, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = PyObject_RichCompare(__pyx_t_4, __pyx_t_3, Py_LT); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (__pyx_t_9) {
      } else {
        __pyx_t_6 = __pyx_t_9;
        goto __pyx_L7_bool_binop_done;
      }
      __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_arr, __pyx_v_i); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_arr, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = PyObject_RichCompare(__pyx_t_2, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 3218, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_6 = __pyx_t_9;
      __pyx_L7_bool_binop_done:;
      if (__pyx_t_6) {

        /* "gofast/tools/mathex.pyx":3219
 *         for i in range(1, len(arr) - 1):
 *             if arr[i] < arr[i - 1] and arr[i] < arr[i + 1]:
 *                 local_minima_count += 1             # <<<<<<<<<<<<<<
 *         return local_minima_count
 *     elif method == 'robust':
 */
        __Pyx_TraceLine(3219,0,__PYX_ERR(0, 3219, __pyx_L1_error))
        __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_local_minima_count, __pyx_int_1, 1, 1, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3219, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF_SET(__pyx_v_local_minima_count, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "gofast/tools/mathex.pyx":3218
 *         # to the second-to-last element
 *         for i in range(1, len(arr) - 1):
 *             if arr[i] < arr[i - 1] and arr[i] < arr[i + 1]:             # <<<<<<<<<<<<<<
 *                 local_minima_count += 1
 *         return local_minima_count
 */
      }

      /* "gofast/tools/mathex.pyx":3217
 *         # Iterate through the array from the second element
 *         # to the second-to-last element
 *         for i in range(1, len(arr) - 1):             # <<<<<<<<<<<<<<
 *             if arr[i] < arr[i - 1] and arr[i] < arr[i + 1]:
 *                 local_minima_count += 1
 */
      __Pyx_TraceLine(3217,0,__PYX_ERR(0, 3217, __pyx_L1_error))
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3220
 *             if arr[i] < arr[i - 1] and arr[i] < arr[i + 1]:
 *                 local_minima_count += 1
 *         return local_minima_count             # <<<<<<<<<<<<<<
 *     elif method == 'robust':
 *         # Find indices of local minima
 */
    __Pyx_TraceLine(3220,0,__PYX_ERR(0, 3220, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_local_minima_count);
    __pyx_r = __pyx_v_local_minima_count;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":3213
 *     method= parameter_validator(
 *         "method", target_strs= {"base", "robust"})(method)
 *     if method == 'base':             # <<<<<<<<<<<<<<
 *         local_minima_count = 0
 *         # Iterate through the array from the second element
 */
  }

  /* "gofast/tools/mathex.pyx":3221
 *                 local_minima_count += 1
 *         return local_minima_count
 *     elif method == 'robust':             # <<<<<<<<<<<<<<
 *         # Find indices of local minima
 *         local_minima_indices = argrelextrema(np.array(arr),
 */
  __Pyx_TraceLine(3221,0,__PYX_ERR(0, 3221, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_method, __pyx_n_u_robust, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3221, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3223
 *     elif method == 'robust':
 *         # Find indices of local minima
 *         local_minima_indices = argrelextrema(np.array(arr),             # <<<<<<<<<<<<<<
 *                                              np.less,
 *                                              order=order)[0]
 */
    __Pyx_TraceLine(3223,0,__PYX_ERR(0, 3223, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_argrelextrema); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_arr};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3223, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }

    /* "gofast/tools/mathex.pyx":3224
 *         # Find indices of local minima
 *         local_minima_indices = argrelextrema(np.array(arr),
 *                                              np.less,             # <<<<<<<<<<<<<<
 *                                              order=order)[0]
 *         # The number of local minima is the length of the indices array
 */
    __Pyx_TraceLine(3224,0,__PYX_ERR(0, 3224, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3224, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_less); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3224, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3223
 *     elif method == 'robust':
 *         # Find indices of local minima
 *         local_minima_indices = argrelextrema(np.array(arr),             # <<<<<<<<<<<<<<
 *                                              np.less,
 *                                              order=order)[0]
 */
    __Pyx_TraceLine(3223,0,__PYX_ERR(0, 3223, __pyx_L1_error))
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3)) __PYX_ERR(0, 3223, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_4);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_4)) __PYX_ERR(0, 3223, __pyx_L1_error);
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":3225
 *         local_minima_indices = argrelextrema(np.array(arr),
 *                                              np.less,
 *                                              order=order)[0]             # <<<<<<<<<<<<<<
 *         # The number of local minima is the length of the indices array
 *         return len(local_minima_indices)
 */
    __Pyx_TraceLine(3225,0,__PYX_ERR(0, 3225, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3225, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_order, __pyx_v_order) < 0) __PYX_ERR(0, 3225, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3223
 *     elif method == 'robust':
 *         # Find indices of local minima
 *         local_minima_indices = argrelextrema(np.array(arr),             # <<<<<<<<<<<<<<
 *                                              np.less,
 *                                              order=order)[0]
 */
    __Pyx_TraceLine(3223,0,__PYX_ERR(0, 3223, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3223, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":3225
 *         local_minima_indices = argrelextrema(np.array(arr),
 *                                              np.less,
 *                                              order=order)[0]             # <<<<<<<<<<<<<<
 *         # The number of local minima is the length of the indices array
 *         return len(local_minima_indices)
 */
    __Pyx_TraceLine(3225,0,__PYX_ERR(0, 3225, __pyx_L1_error))
    __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3225, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_v_local_minima_indices = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":3227
 *                                              order=order)[0]
 *         # The number of local minima is the length of the indices array
 *         return len(local_minima_indices)             # <<<<<<<<<<<<<<
 * 
 * def get_azimuth (
 */
    __Pyx_TraceLine(3227,0,__PYX_ERR(0, 3227, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __pyx_t_7 = PyObject_Length(__pyx_v_local_minima_indices); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3227, __pyx_L1_error)
    __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3227, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_r = __pyx_t_4;
    __pyx_t_4 = 0;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":3221
 *                 local_minima_count += 1
 *         return local_minima_count
 *     elif method == 'robust':             # <<<<<<<<<<<<<<
 *         # Find indices of local minima
 *         local_minima_indices = argrelextrema(np.array(arr),
 */
  }

  /* "gofast/tools/mathex.pyx":3171
 * 
 * 
 * def count_local_minima(arr,  method='robust', order=1):             # <<<<<<<<<<<<<<
 *     """
 *     Count the number of local minima in a 1D array.
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("gofast.tools.mathex.count_local_minima", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_local_minima_count);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_local_minima_indices);
  __Pyx_XDECREF(__pyx_v_arr);
  __Pyx_XDECREF(__pyx_v_method);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_85get_azimuth(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_84get_azimuth, "Compute azimuth from coordinate locations ( latitude,  longitude). \n    \n    If `easting` and `northing` are given rather than `longitude` and  \n    `latitude`, the projection should explicitely set to ``UTM`` to perform \n    the ideal conversion. However if mode is set to `soft` (default), the type\n    of projection is automatically detected . Note that when UTM coordinates \n    are provided, `xlon` and `ylat` fit ``easting`` and ``northing`` \n    respectively.\n    \n    Parameters\n    -----------\n    xlon, ylat : Arraylike 1d or str, str \n       ArrayLike of easting/longitude and arraylike of nothing/latitude. They \n       should be one dimensional. In principle if data is supplied, they must \n       be series.  If `xlon` and `ylat` are given as string values, the \n       `data` must be supplied. xlon and ylat names must be included in the  \n       dataframe otherwise an error raises. \n       \n    data: pd.DataFrame, \n       Data containing x and y names. Need to be supplied when x and y \n       are given as string names. \n       \n    utm_zone: Optional, string\n       zone number and 'S' or 'N' e.g. '55S'. Default to the centre point\n       of coordinates points in the survey area. It should be a string (##N or ##S)\n       in the form of number and North or South hemisphere, 10S or 03N\n       \n    projection: str, ['utm'|'ll'] \n       The coordinate system in which the data points for the profile is collected. \n       when `mode='soft'`,  the auto-detection will be triggered and find the \n       suitable coordinate system. However, it is recommended to explicitly \n       provide projection when data is in UTM coordinates. \n       Note that if `x` and `y` are composed of value greater than 180 degrees \n       for longitude and 90 degrees for latitude, and method is still in \n       the ``soft` mode, it should be considered as  longitude-latitude ``UTM``\n       coordinates system. \n       \n    isdeg: bool, default=True \n      By ""default xlon and xlat are in degree coordinates. If both arguments \n      are given in radians, set to ``False`` instead. \n      \n    mode: str , ['soft'|'strict']\n      ``strict`` mode does not convert any coordinates system to other at least\n      it is explicitly set to `projection` whereas the `soft` does.\n      \n    extrapolate: bool, default=False \n      In principle, the azimuth is compute between two points. Thus, the number\n      of values computed for :math:`N` stations should  be  :math:`N-1`. To fit\n      values to match the number of size of the array, `extrapolate` should be \n      ``True``. In that case, the first station holds a <<fake>> azimuth as \n      the closer value computed from interpolation of all azimuths. \n      \n    view: bool, default=False, \n       Quick view of the azimuth. It is usefull especially when \n       extrapolate is set to ``True``. \n       \n    Return \n    --------\n    azim: ArrayLike \n       Azimuth computed from locations. \n       \n    Examples \n    ----------\n    >>> import gofast as gf \n    >>> from gofast.tools.mathex  import get_azimuth \n    >>> # generate a data from ERP \n    >>> data = gf.make_erp (n_stations =7 ).frame \n    >>> get_azimuth ( data.longitude, data.latitude)\n    array([54.575, 54.575, 54.575, 54.575, 54.575, 54.575])\n    >>> get_azimuth ( data.longitude, data.latitude, view =True, extrapolate=True)\n    array([54.57500007, 54.575     , 54.575     , 54.575     , 54.575     ,\n           54.575     , 54.575     ])\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_85get_azimuth = {"get_azimuth", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_85get_azimuth, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_84get_azimuth};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_85get_azimuth(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_xlon = 0;
  PyObject *__pyx_v_ylat = 0;
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_utm_zone = 0;
  PyObject *__pyx_v_projection = 0;
  PyObject *__pyx_v_isdeg = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_extrapolate = 0;
  PyObject *__pyx_v_view = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_azimuth (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_xlon,&__pyx_n_s_ylat,&__pyx_n_s_data,&__pyx_n_s_utm_zone,&__pyx_n_s_projection,&__pyx_n_s_isdeg,&__pyx_n_s_mode,&__pyx_n_s_extrapolate,&__pyx_n_s_view,0};

    /* "gofast/tools/mathex.pyx":3233
 *     ylat:Union[ str, ArrayLike],
 *     *,
 *     data: DataFrame =None,             # <<<<<<<<<<<<<<
 *     utm_zone:str=None,
 *     projection:str='ll',
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));

    /* "gofast/tools/mathex.pyx":3234
 *     *,
 *     data: DataFrame =None,
 *     utm_zone:str=None,             # <<<<<<<<<<<<<<
 *     projection:str='ll',
 *     isdeg:bool=True,
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)Py_None));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_ll)));

    /* "gofast/tools/mathex.pyx":3236
 *     utm_zone:str=None,
 *     projection:str='ll',
 *     isdeg:bool=True,             # <<<<<<<<<<<<<<
 *     mode:str='soft',
 *     extrapolate:bool =...,
 */
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_soft)));

    /* "gofast/tools/mathex.pyx":3238
 *     isdeg:bool=True,
 *     mode:str='soft',
 *     extrapolate:bool =...,             # <<<<<<<<<<<<<<
 *     view:bool=...,
 *     ):
 */
    values[7] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_Ellipsis)));

    /* "gofast/tools/mathex.pyx":3239
 *     mode:str='soft',
 *     extrapolate:bool =...,
 *     view:bool=...,             # <<<<<<<<<<<<<<
 *     ):
 *     """Compute azimuth from coordinate locations ( latitude,  longitude).
 */
    values[8] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_Ellipsis)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_xlon)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3229, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ylat)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3229, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("get_azimuth", 1, 2, 2, 1); __PYX_ERR(0, 3229, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && likely(kw_args <= 7)) {
        Py_ssize_t index;
        for (index = 2; index < 9 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3229, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_azimuth") < 0)) __PYX_ERR(0, 3229, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_xlon = values[0];
    __pyx_v_ylat = values[1];
    __pyx_v_data = values[2];
    __pyx_v_utm_zone = ((PyObject*)values[3]);
    __pyx_v_projection = ((PyObject*)values[4]);
    __pyx_v_isdeg = values[5];
    __pyx_v_mode = ((PyObject*)values[6]);
    __pyx_v_extrapolate = values[7];
    __pyx_v_view = values[8];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_azimuth", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 3229, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_utm_zone), (&PyUnicode_Type), 1, "utm_zone", 1))) __PYX_ERR(0, 3234, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_projection), (&PyUnicode_Type), 0, "projection", 1))) __PYX_ERR(0, 3235, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_mode), (&PyUnicode_Type), 0, "mode", 1))) __PYX_ERR(0, 3237, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_84get_azimuth(__pyx_self, __pyx_v_xlon, __pyx_v_ylat, __pyx_v_data, __pyx_v_utm_zone, __pyx_v_projection, __pyx_v_isdeg, __pyx_v_mode, __pyx_v_extrapolate, __pyx_v_view);

  /* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3351
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)
 * 
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -             # <<<<<<<<<<<<<<
 *         np.sin(ylat[ii]) * np.cos( ylat[ii+1]) * np.cos (xlon[ii+1]- xlon[ii]),
 *         range (len(xlon)-1)
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_11get_azimuth_lambda2(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_11get_azimuth_lambda2 = {"lambda2", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_11get_azimuth_lambda2, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_11get_azimuth_lambda2(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ii = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[1] = {0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lambda2 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ii,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ii)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3351, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda2") < 0)) __PYX_ERR(0, 3351, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_ii = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lambda2", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 3351, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth.lambda2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_lambda_funcdef_lambda2(__pyx_self, __pyx_v_ii);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_lambda_funcdef_lambda2(PyObject *__pyx_self, PyObject *__pyx_v_ii) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *__pyx_cur_scope;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *__pyx_outer_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lambda2", 1);
  __pyx_outer_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;
  __Pyx_TraceCall("lambda2", __pyx_f[0], 3351, 0, __PYX_ERR(0, 3351, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cos); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_ylat)) { __Pyx_RaiseClosureNameError("ylat"); __PYX_ERR(0, 3351, __pyx_L1_error) }
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_ylat, __pyx_v_ii); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_ylat)) { __Pyx_RaiseClosureNameError("ylat"); __PYX_ERR(0, 3351, __pyx_L1_error) }
  __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_ii, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_ylat, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_6};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3351, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = PyNumber_Multiply(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3352
 * 
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -
 *         np.sin(ylat[ii]) * np.cos( ylat[ii+1]) * np.cos (xlon[ii+1]- xlon[ii]),             # <<<<<<<<<<<<<<
 *         range (len(xlon)-1)
 *         )
 */
  __Pyx_TraceLine(3352,0,__PYX_ERR(0, 3352, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sin); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_ylat)) { __Pyx_RaiseClosureNameError("ylat"); __PYX_ERR(0, 3352, __pyx_L1_error) }
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_ylat, __pyx_v_ii); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_1};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3352, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_cos); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_ylat)) { __Pyx_RaiseClosureNameError("ylat"); __PYX_ERR(0, 3352, __pyx_L1_error) }
  __pyx_t_1 = __Pyx_PyInt_AddObjC(__pyx_v_ii, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_ylat, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_7};
    __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3352, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_3, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cos); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_xlon)) { __Pyx_RaiseClosureNameError("xlon"); __PYX_ERR(0, 3352, __pyx_L1_error) }
  __pyx_t_3 = __Pyx_PyInt_AddObjC(__pyx_v_ii, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_xlon, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_xlon)) { __Pyx_RaiseClosureNameError("xlon"); __PYX_ERR(0, 3352, __pyx_L1_error) }
  __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_xlon, __pyx_v_ii); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = PyNumber_Subtract(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_8};
    __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3352, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = PyNumber_Multiply(__pyx_t_2, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":3351
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)
 * 
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -             # <<<<<<<<<<<<<<
 *         np.sin(ylat[ii]) * np.cos( ylat[ii+1]) * np.cos (xlon[ii+1]- xlon[ii]),
 *         range (len(xlon)-1)
 */
  __Pyx_TraceLine(3351,0,__PYX_ERR(0, 3351, __pyx_L1_error))
  __pyx_t_6 = PyNumber_Subtract(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth.lambda2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3355
 *         range (len(xlon)-1)
 *         )
 *     dy = map( lambda ii: np.cos (ylat[ii+1])* np.sin( xlon[ii+1]- xlon[ii]),             # <<<<<<<<<<<<<<
 *                    range ( len(xlon)-1)
 *                    )
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_11get_azimuth_1lambda3(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_11get_azimuth_1lambda3 = {"lambda3", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_11get_azimuth_1lambda3, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_11get_azimuth_1lambda3(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ii = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[1] = {0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lambda3 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ii,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ii)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3355, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda3") < 0)) __PYX_ERR(0, 3355, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_ii = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lambda3", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 3355, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth.lambda3", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_lambda_funcdef_lambda3(__pyx_self, __pyx_v_ii);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_lambda_funcdef_lambda3(PyObject *__pyx_self, PyObject *__pyx_v_ii) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *__pyx_cur_scope;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *__pyx_outer_scope;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lambda3", 1);
  __pyx_outer_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;
  __Pyx_TraceCall("lambda3", __pyx_f[0], 3355, 0, __PYX_ERR(0, 3355, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cos); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_ylat)) { __Pyx_RaiseClosureNameError("ylat"); __PYX_ERR(0, 3355, __pyx_L1_error) }
  __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_ii, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_ylat, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3355, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sin); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_xlon)) { __Pyx_RaiseClosureNameError("xlon"); __PYX_ERR(0, 3355, __pyx_L1_error) }
  __pyx_t_4 = __Pyx_PyInt_AddObjC(__pyx_v_ii, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_xlon, __pyx_t_4); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely(!__pyx_cur_scope->__pyx_v_xlon)) { __Pyx_RaiseClosureNameError("xlon"); __PYX_ERR(0, 3355, __pyx_L1_error) }
  __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_cur_scope->__pyx_v_xlon, __pyx_v_ii); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_7 = PyNumber_Subtract(__pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_7};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3355, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth.lambda3", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_84get_azimuth(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_xlon, PyObject *__pyx_v_ylat, PyObject *__pyx_v_data, PyObject *__pyx_v_utm_zone, PyObject *__pyx_v_projection, PyObject *__pyx_v_isdeg, PyObject *__pyx_v_mode, PyObject *__pyx_v_extrapolate, PyObject *__pyx_v_view) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *__pyx_cur_scope;
  PyObject *__pyx_v_Location = NULL;
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_v_dx = NULL;
  PyObject *__pyx_v_dy = NULL;
  PyObject *__pyx_v_z = NULL;
  PyObject *__pyx_v_azim = NULL;
  PyObject *__pyx_v_x = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_fig = NULL;
  PyObject *__pyx_v_ax = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  int __pyx_t_8;
  Py_ssize_t __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  PyObject *__pyx_t_19 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__93)
  __Pyx_RefNannySetupContext("get_azimuth", 0);
  __pyx_cur_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 3229, __pyx_L1_error)
  } else {
    __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
  }
  __Pyx_TraceCall("get_azimuth", __pyx_f[0], 3229, 0, __PYX_ERR(0, 3229, __pyx_L1_error));
  __pyx_cur_scope->__pyx_v_xlon = __pyx_v_xlon;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_xlon);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_xlon);
  __pyx_cur_scope->__pyx_v_ylat = __pyx_v_ylat;
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_ylat);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_ylat);
  __Pyx_INCREF(__pyx_v_projection);
  __Pyx_INCREF(__pyx_v_mode);
  __Pyx_INCREF(__pyx_v_extrapolate);
  __Pyx_INCREF(__pyx_v_view);

  /* "gofast/tools/mathex.pyx":3315
 * 
 *     """
 *     from ..site import Location             # <<<<<<<<<<<<<<
 * 
 *     mode = str(mode).lower()
 */
  __Pyx_TraceLine(3315,0,__PYX_ERR(0, 3315, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_Location);
  __Pyx_GIVEREF(__pyx_n_s_Location);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_Location)) __PYX_ERR(0, 3315, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_site, __pyx_t_1, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Location); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3315, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_Location = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3317
 *     from ..site import Location
 * 
 *     mode = str(mode).lower()             # <<<<<<<<<<<<<<
 *     projection= str(projection).lower()
 *     extrapolate, view = ellipsis2false (extrapolate, view)
 */
  __Pyx_TraceLine(3317,0,__PYX_ERR(0, 3317, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Str(__pyx_v_mode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_lower); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3317, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  if (!(likely(PyUnicode_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_2))) __PYX_ERR(0, 3317, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_mode, ((PyObject*)__pyx_t_2));
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3318
 * 
 *     mode = str(mode).lower()
 *     projection= str(projection).lower()             # <<<<<<<<<<<<<<
 *     extrapolate, view = ellipsis2false (extrapolate, view)
 * 
 */
  __Pyx_TraceLine(3318,0,__PYX_ERR(0, 3318, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_Str(__pyx_v_projection); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3318, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3318, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  if (!(likely(PyUnicode_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_2))) __PYX_ERR(0, 3318, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_projection, ((PyObject*)__pyx_t_2));
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3319
 *     mode = str(mode).lower()
 *     projection= str(projection).lower()
 *     extrapolate, view = ellipsis2false (extrapolate, view)             # <<<<<<<<<<<<<<
 * 
 *     xlon , ylat = assert_xy_in(xlon , ylat , data = data )
 */
  __Pyx_TraceLine(3319,0,__PYX_ERR(0, 3319, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_ellipsis2false); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3319, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_extrapolate, __pyx_v_view};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3319, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
    PyObject* sequence = __pyx_t_2;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 3319, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_3);
    #else
    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3319, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3319, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    #endif
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_5 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3319, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
    index = 0; __pyx_t_1 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 2) < 0) __PYX_ERR(0, 3319, __pyx_L1_error)
    __pyx_t_6 = NULL;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 3319, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_extrapolate, __pyx_t_1);
  __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_view, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3321
 *     extrapolate, view = ellipsis2false (extrapolate, view)
 * 
 *     xlon , ylat = assert_xy_in(xlon , ylat , data = data )             # <<<<<<<<<<<<<<
 * 
 *     if (
 */
  __Pyx_TraceLine(3321,0,__PYX_ERR(0, 3321, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_assert_xy_in); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_xlon);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_xlon);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_cur_scope->__pyx_v_xlon)) __PYX_ERR(0, 3321, __pyx_L1_error);
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_ylat);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_ylat);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_cur_scope->__pyx_v_ylat)) __PYX_ERR(0, 3321, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_data, __pyx_v_data) < 0) __PYX_ERR(0, 3321, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_5))) || (PyList_CheckExact(__pyx_t_5))) {
    PyObject* sequence = __pyx_t_5;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 3321, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_3 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_3);
    #else
    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3321, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3321, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    #endif
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_2 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3321, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2);
    index = 0; __pyx_t_1 = __pyx_t_6(__pyx_t_2); if (unlikely(!__pyx_t_1)) goto __pyx_L5_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    index = 1; __pyx_t_3 = __pyx_t_6(__pyx_t_2); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_2), 2) < 0) __PYX_ERR(0, 3321, __pyx_L1_error)
    __pyx_t_6 = NULL;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    goto __pyx_L6_unpacking_done;
    __pyx_L5_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_6 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 3321, __pyx_L1_error)
    __pyx_L6_unpacking_done:;
  }
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_xlon);
  __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_xlon, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_ylat);
  __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_ylat, __pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3324
 * 
 *     if (
 *             xlon.max() > 180.  and ylat.max() > 90.             # <<<<<<<<<<<<<<
 *             and projection=='ll'
 *             and mode=='soft'
 */
  __Pyx_TraceLine(3324,0,__PYX_ERR(0, 3324, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_xlon, __pyx_n_s_max); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3324, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_5, __pyx_float_180_, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L8_bool_binop_done;
  }

  /* "gofast/tools/mathex.pyx":3325
 *     if (
 *             xlon.max() > 180.  and ylat.max() > 90.
 *             and projection=='ll'             # <<<<<<<<<<<<<<
 *             and mode=='soft'
 *             ):
 */
  __Pyx_TraceLine(3325,0,__PYX_ERR(0, 3325, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_cur_scope->__pyx_v_ylat, __pyx_n_s_max); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_1 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3324, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = PyObject_RichCompare(__pyx_t_3, __pyx_float_90_, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3324
 * 
 *     if (
 *             xlon.max() > 180.  and ylat.max() > 90.             # <<<<<<<<<<<<<<
 *             and projection=='ll'
 *             and mode=='soft'
 */
  __Pyx_TraceLine(3324,0,__PYX_ERR(0, 3324, __pyx_L1_error))
  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 3324, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L8_bool_binop_done;
  }

  /* "gofast/tools/mathex.pyx":3325
 *     if (
 *             xlon.max() > 180.  and ylat.max() > 90.
 *             and projection=='ll'             # <<<<<<<<<<<<<<
 *             and mode=='soft'
 *             ):
 */
  __Pyx_TraceLine(3325,0,__PYX_ERR(0, 3325, __pyx_L1_error))
  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_projection, __pyx_n_u_ll, Py_EQ)); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 3325, __pyx_L1_error)
  if (__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L8_bool_binop_done;
  }

  /* "gofast/tools/mathex.pyx":3326
 *             xlon.max() > 180.  and ylat.max() > 90.
 *             and projection=='ll'
 *             and mode=='soft'             # <<<<<<<<<<<<<<
 *             ):
 *         warnings.warn("xlon and ylat arguments are greater than 180 degrees."
 */
  __Pyx_TraceLine(3326,0,__PYX_ERR(0, 3326, __pyx_L1_error))
  __pyx_t_8 = (__Pyx_PyUnicode_Equals(__pyx_v_mode, __pyx_n_u_soft, Py_EQ)); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 3326, __pyx_L1_error)
  __pyx_t_7 = __pyx_t_8;
  __pyx_L8_bool_binop_done:;

  /* "gofast/tools/mathex.pyx":3323
 *     xlon , ylat = assert_xy_in(xlon , ylat , data = data )
 * 
 *     if (             # <<<<<<<<<<<<<<
 *             xlon.max() > 180.  and ylat.max() > 90.
 *             and projection=='ll'
 */
  __Pyx_TraceLine(3323,0,__PYX_ERR(0, 3323, __pyx_L1_error))
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":3328
 *             and mode=='soft'
 *             ):
 *         warnings.warn("xlon and ylat arguments are greater than 180 degrees."             # <<<<<<<<<<<<<<
 *                      " we assume the coordinates are UTM. Set explicitly"
 *                      " projection to ``UTM`` to avoid this warning.")
 */
    __Pyx_TraceLine(3328,0,__PYX_ERR(0, 3328, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_warnings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3328, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_warn); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3328, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_kp_u_xlon_and_ylat_arguments_are_grea};
      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3328, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":3331
 *                      " we assume the coordinates are UTM. Set explicitly"
 *                      " projection to ``UTM`` to avoid this warning.")
 *         projection='utm'             # <<<<<<<<<<<<<<
 * 
 *     if projection=='utm':
 */
    __Pyx_TraceLine(3331,0,__PYX_ERR(0, 3331, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_utm);
    __Pyx_DECREF_SET(__pyx_v_projection, __pyx_n_u_utm);

    /* "gofast/tools/mathex.pyx":3323
 *     xlon , ylat = assert_xy_in(xlon , ylat , data = data )
 * 
 *     if (             # <<<<<<<<<<<<<<
 *             xlon.max() > 180.  and ylat.max() > 90.
 *             and projection=='ll'
 */
  }

  /* "gofast/tools/mathex.pyx":3333
 *         projection='utm'
 * 
 *     if projection=='utm':             # <<<<<<<<<<<<<<
 *         if utm_zone is None:
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")
 */
  __Pyx_TraceLine(3333,0,__PYX_ERR(0, 3333, __pyx_L1_error))
  __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_projection, __pyx_n_u_utm, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 3333, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":3334
 * 
 *     if projection=='utm':
 *         if utm_zone is None:             # <<<<<<<<<<<<<<
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")
 * 
 */
    __Pyx_TraceLine(3334,0,__PYX_ERR(0, 3334, __pyx_L1_error))
    __pyx_t_7 = (__pyx_v_utm_zone == ((PyObject*)Py_None));
    if (unlikely(__pyx_t_7)) {

      /* "gofast/tools/mathex.pyx":3335
 *     if projection=='utm':
 *         if utm_zone is None:
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")             # <<<<<<<<<<<<<<
 * 
 *         ylat , xlon = Location.to_latlon_in(
 */
      __Pyx_TraceLine(3335,0,__PYX_ERR(0, 3335, __pyx_L1_error))
      __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__94, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3335, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_Raise(__pyx_t_5, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __PYX_ERR(0, 3335, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":3334
 * 
 *     if projection=='utm':
 *         if utm_zone is None:             # <<<<<<<<<<<<<<
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")
 * 
 */
    }

    /* "gofast/tools/mathex.pyx":3337
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")
 * 
 *         ylat , xlon = Location.to_latlon_in(             # <<<<<<<<<<<<<<
 *             xlon, ylat, utm_zone= utm_zone)
 * 
 */
    __Pyx_TraceLine(3337,0,__PYX_ERR(0, 3337, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_Location, __pyx_n_s_to_latlon_in); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);

    /* "gofast/tools/mathex.pyx":3338
 * 
 *         ylat , xlon = Location.to_latlon_in(
 *             xlon, ylat, utm_zone= utm_zone)             # <<<<<<<<<<<<<<
 * 
 *     if len(xlon) ==1 or len(ylat)==1:
 */
    __Pyx_TraceLine(3338,0,__PYX_ERR(0, 3338, __pyx_L1_error))
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_xlon);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_xlon);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_cur_scope->__pyx_v_xlon)) __PYX_ERR(0, 3337, __pyx_L1_error);
    __Pyx_INCREF(__pyx_cur_scope->__pyx_v_ylat);
    __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_ylat);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_ylat)) __PYX_ERR(0, 3337, __pyx_L1_error);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3338, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_utm_zone, __pyx_v_utm_zone) < 0) __PYX_ERR(0, 3338, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3337
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")
 * 
 *         ylat , xlon = Location.to_latlon_in(             # <<<<<<<<<<<<<<
 *             xlon, ylat, utm_zone= utm_zone)
 * 
 */
    __Pyx_TraceLine(3337,0,__PYX_ERR(0, 3337, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3337, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 3337, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_1);
      #else
      __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3337, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3337, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_5 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3337, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
      index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L14_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_3);
      index = 1; __pyx_t_1 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L14_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 2) < 0) __PYX_ERR(0, 3337, __pyx_L1_error)
      __pyx_t_6 = NULL;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L15_unpacking_done;
      __pyx_L14_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_6 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 3337, __pyx_L1_error)
      __pyx_L15_unpacking_done:;
    }
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_ylat);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_ylat, __pyx_t_3);
    __Pyx_GIVEREF(__pyx_t_3);
    __pyx_t_3 = 0;
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_xlon);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_xlon, __pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3333
 *         projection='utm'
 * 
 *     if projection=='utm':             # <<<<<<<<<<<<<<
 *         if utm_zone is None:
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")
 */
  }

  /* "gofast/tools/mathex.pyx":3340
 *             xlon, ylat, utm_zone= utm_zone)
 * 
 *     if len(xlon) ==1 or len(ylat)==1:             # <<<<<<<<<<<<<<
 *         msg = "Azimuth computation expects at least two points. Got 1"
 *         if mode=='soft':
 */
  __Pyx_TraceLine(3340,0,__PYX_ERR(0, 3340, __pyx_L1_error))
  __pyx_t_2 = __pyx_cur_scope->__pyx_v_xlon;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_9 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3340, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = (__pyx_t_9 == 1);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L17_bool_binop_done;
  }
  __pyx_t_2 = __pyx_cur_scope->__pyx_v_ylat;
  __Pyx_INCREF(__pyx_t_2);
  __pyx_t_9 = PyObject_Length(__pyx_t_2); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3340, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_8 = (__pyx_t_9 == 1);
  __pyx_t_7 = __pyx_t_8;
  __pyx_L17_bool_binop_done:;
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":3341
 * 
 *     if len(xlon) ==1 or len(ylat)==1:
 *         msg = "Azimuth computation expects at least two points. Got 1"             # <<<<<<<<<<<<<<
 *         if mode=='soft':
 *             warnings.warn(msg)
 */
    __Pyx_TraceLine(3341,0,__PYX_ERR(0, 3341, __pyx_L1_error))
    __Pyx_INCREF(__pyx_kp_u_Azimuth_computation_expects_at_l);
    __pyx_v_msg = __pyx_kp_u_Azimuth_computation_expects_at_l;

    /* "gofast/tools/mathex.pyx":3342
 *     if len(xlon) ==1 or len(ylat)==1:
 *         msg = "Azimuth computation expects at least two points. Got 1"
 *         if mode=='soft':             # <<<<<<<<<<<<<<
 *             warnings.warn(msg)
 *             return 0.
 */
    __Pyx_TraceLine(3342,0,__PYX_ERR(0, 3342, __pyx_L1_error))
    __pyx_t_7 = (__Pyx_PyUnicode_Equals(__pyx_v_mode, __pyx_n_u_soft, Py_EQ)); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 3342, __pyx_L1_error)
    if (__pyx_t_7) {

      /* "gofast/tools/mathex.pyx":3343
 *         msg = "Azimuth computation expects at least two points. Got 1"
 *         if mode=='soft':
 *             warnings.warn(msg)             # <<<<<<<<<<<<<<
 *             return 0.
 * 
 */
      __Pyx_TraceLine(3343,0,__PYX_ERR(0, 3343, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_warnings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3343, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_warn); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3343, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_1 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_msg};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3343, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":3344
 *         if mode=='soft':
 *             warnings.warn(msg)
 *             return 0.             # <<<<<<<<<<<<<<
 * 
 *         raise TypeError(msg )
 */
      __Pyx_TraceLine(3344,0,__PYX_ERR(0, 3344, __pyx_L1_error))
      __Pyx_XDECREF(__pyx_r);
      __Pyx_INCREF(__pyx_float_0_);
      __pyx_r = __pyx_float_0_;
      goto __pyx_L0;

      /* "gofast/tools/mathex.pyx":3342
 *     if len(xlon) ==1 or len(ylat)==1:
 *         msg = "Azimuth computation expects at least two points. Got 1"
 *         if mode=='soft':             # <<<<<<<<<<<<<<
 *             warnings.warn(msg)
 *             return 0.
 */
    }

    /* "gofast/tools/mathex.pyx":3346
 *             return 0.
 * 
 *         raise TypeError(msg )             # <<<<<<<<<<<<<<
 *     # convert to radian
 *     if isdeg:
 */
    __Pyx_TraceLine(3346,0,__PYX_ERR(0, 3346, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_v_msg); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3346, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 3346, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3340
 *             xlon, ylat, utm_zone= utm_zone)
 * 
 *     if len(xlon) ==1 or len(ylat)==1:             # <<<<<<<<<<<<<<
 *         msg = "Azimuth computation expects at least two points. Got 1"
 *         if mode=='soft':
 */
  }

  /* "gofast/tools/mathex.pyx":3348
 *         raise TypeError(msg )
 *     # convert to radian
 *     if isdeg:             # <<<<<<<<<<<<<<
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)
 * 
 */
  __Pyx_TraceLine(3348,0,__PYX_ERR(0, 3348, __pyx_L1_error))
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_isdeg); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 3348, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":3349
 *     # convert to radian
 *     if isdeg:
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)             # <<<<<<<<<<<<<<
 * 
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -
 */
    __Pyx_TraceLine(3349,0,__PYX_ERR(0, 3349, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_deg2rad); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_cur_scope->__pyx_v_xlon};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3349, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_xlon);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_xlon, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_deg2rad); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3349, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_cur_scope->__pyx_v_ylat};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3349, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_ylat);
    __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_ylat, __pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3348
 *         raise TypeError(msg )
 *     # convert to radian
 *     if isdeg:             # <<<<<<<<<<<<<<
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":3351
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)
 * 
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -             # <<<<<<<<<<<<<<
 *         np.sin(ylat[ii]) * np.cos( ylat[ii+1]) * np.cos (xlon[ii+1]- xlon[ii]),
 *         range (len(xlon)-1)
 */
  __Pyx_TraceLine(3351,0,__PYX_ERR(0, 3351, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_11get_azimuth_lambda2, 0, __pyx_n_s_get_azimuth_locals_lambda, ((PyObject*)__pyx_cur_scope), __pyx_n_s_gofast_tools_mathex, __pyx_d, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":3353
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -
 *         np.sin(ylat[ii]) * np.cos( ylat[ii+1]) * np.cos (xlon[ii+1]- xlon[ii]),
 *         range (len(xlon)-1)             # <<<<<<<<<<<<<<
 *         )
 *     dy = map( lambda ii: np.cos (ylat[ii+1])* np.sin( xlon[ii+1]- xlon[ii]),
 */
  __Pyx_TraceLine(3353,0,__PYX_ERR(0, 3353, __pyx_L1_error))
  __pyx_t_3 = __pyx_cur_scope->__pyx_v_xlon;
  __Pyx_INCREF(__pyx_t_3);
  __pyx_t_9 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3353, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyInt_FromSsize_t((__pyx_t_9 - 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3351
 *         xlon = np.deg2rad (xlon ) ; ylat = np.deg2rad ( ylat)
 * 
 *     dx = map (lambda ii: np.cos ( ylat[ii]) * np.sin( ylat [ii+1 ]) -             # <<<<<<<<<<<<<<
 *         np.sin(ylat[ii]) * np.cos( ylat[ii+1]) * np.cos (xlon[ii+1]- xlon[ii]),
 *         range (len(xlon)-1)
 */
  __Pyx_TraceLine(3351,0,__PYX_ERR(0, 3351, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 3351, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1)) __PYX_ERR(0, 3351, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_dx = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3355
 *         range (len(xlon)-1)
 *         )
 *     dy = map( lambda ii: np.cos (ylat[ii+1])* np.sin( xlon[ii+1]- xlon[ii]),             # <<<<<<<<<<<<<<
 *                    range ( len(xlon)-1)
 *                    )
 */
  __Pyx_TraceLine(3355,0,__PYX_ERR(0, 3355, __pyx_L1_error))
  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_11get_azimuth_1lambda3, 0, __pyx_n_s_get_azimuth_locals_lambda, ((PyObject*)__pyx_cur_scope), __pyx_n_s_gofast_tools_mathex, __pyx_d, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":3356
 *         )
 *     dy = map( lambda ii: np.cos (ylat[ii+1])* np.sin( xlon[ii+1]- xlon[ii]),
 *                    range ( len(xlon)-1)             # <<<<<<<<<<<<<<
 *                    )
 *     # to deg
 */
  __Pyx_TraceLine(3356,0,__PYX_ERR(0, 3356, __pyx_L1_error))
  __pyx_t_3 = __pyx_cur_scope->__pyx_v_xlon;
  __Pyx_INCREF(__pyx_t_3);
  __pyx_t_9 = PyObject_Length(__pyx_t_3); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3356, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyInt_FromSsize_t((__pyx_t_9 - 1)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3356, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3355
 *         range (len(xlon)-1)
 *         )
 *     dy = map( lambda ii: np.cos (ylat[ii+1])* np.sin( xlon[ii+1]- xlon[ii]),             # <<<<<<<<<<<<<<
 *                    range ( len(xlon)-1)
 *                    )
 */
  __Pyx_TraceLine(3355,0,__PYX_ERR(0, 3355, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1)) __PYX_ERR(0, 3355, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2)) __PYX_ERR(0, 3355, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3355, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_dy = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3359
 *                    )
 *     # to deg
 *     z = np.around ( np.rad2deg ( np.arctan2(list(dx) , list(dy) ) ), 3)             # <<<<<<<<<<<<<<
 *     azim = z.copy()
 *     if extrapolate:
 */
  __Pyx_TraceLine(3359,0,__PYX_ERR(0, 3359, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_around); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_rad2deg); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_np); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_arctan2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_11 = PySequence_List(__pyx_v_dx); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_11);
  __pyx_t_13 = PySequence_List(__pyx_v_dy); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 3359, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_13);
  __pyx_t_14 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_12))) {
    __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_12);
    if (likely(__pyx_t_14)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
      __Pyx_INCREF(__pyx_t_14);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_12, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_14, __pyx_t_11, __pyx_t_13};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_12, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3359, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  }
  __pyx_t_12 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_10))) {
    __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_10);
    if (likely(__pyx_t_12)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
      __Pyx_INCREF(__pyx_t_12);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_10, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_12, __pyx_t_5};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3359, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  }
  __pyx_t_10 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_10, __pyx_t_3, __pyx_int_3};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3359, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_z = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3360
 *     # to deg
 *     z = np.around ( np.rad2deg ( np.arctan2(list(dx) , list(dy) ) ), 3)
 *     azim = z.copy()             # <<<<<<<<<<<<<<
 *     if extrapolate:
 *         # use mean azimum of the total area zone and
 */
  __Pyx_TraceLine(3360,0,__PYX_ERR(0, 3360, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_z, __pyx_n_s_copy); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3360, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3360, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_azim = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3361
 *     z = np.around ( np.rad2deg ( np.arctan2(list(dx) , list(dy) ) ), 3)
 *     azim = z.copy()
 *     if extrapolate:             # <<<<<<<<<<<<<<
 *         # use mean azimum of the total area zone and
 *         # recompute the position by interpolation
 */
  __Pyx_TraceLine(3361,0,__PYX_ERR(0, 3361, __pyx_L1_error))
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_v_extrapolate); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 3361, __pyx_L1_error)
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":3364
 *         # use mean azimum of the total area zone and
 *         # recompute the position by interpolation
 *         azim = np.hstack ( ( [z.mean(), z ]))             # <<<<<<<<<<<<<<
 *         # reset the interpolare value at the first position
 *         with warnings.catch_warnings():
 */
    __Pyx_TraceLine(3364,0,__PYX_ERR(0, 3364, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3364, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_hstack); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3364, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_z, __pyx_n_s_mean); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3364, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_5 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3364, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __pyx_t_10 = PyList_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3364, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_GIVEREF(__pyx_t_1);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_10, 0, __pyx_t_1)) __PYX_ERR(0, 3364, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_z);
    __Pyx_GIVEREF(__pyx_v_z);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_10, 1, __pyx_v_z)) __PYX_ERR(0, 3364, __pyx_L1_error);
    __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_10};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3364, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_azim, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3366
 *         azim = np.hstack ( ( [z.mean(), z ]))
 *         # reset the interpolare value at the first position
 *         with warnings.catch_warnings():             # <<<<<<<<<<<<<<
 *             #warnings.filterwarnings(action='ignore', category=OptimizeWarning)
 *             warnings.simplefilter("ignore")
 */
    __Pyx_TraceLine(3366,0,__PYX_ERR(0, 3366, __pyx_L1_error))
    /*with:*/ {
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_warnings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3366, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_catch_warnings); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3366, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3366, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __pyx_t_15 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_exit); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3366, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_15);
      __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_2, __pyx_n_s_enter); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3366, __pyx_L22_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_1 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
        __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3366, __pyx_L22_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      /*try:*/ {
        {
          __Pyx_PyThreadState_declare
          __Pyx_PyThreadState_assign
          __Pyx_ExceptionSave(&__pyx_t_16, &__pyx_t_17, &__pyx_t_18);
          __Pyx_XGOTREF(__pyx_t_16);
          __Pyx_XGOTREF(__pyx_t_17);
          __Pyx_XGOTREF(__pyx_t_18);
          /*try:*/ {

            /* "gofast/tools/mathex.pyx":3368
 *         with warnings.catch_warnings():
 *             #warnings.filterwarnings(action='ignore', category=OptimizeWarning)
 *             warnings.simplefilter("ignore")             # <<<<<<<<<<<<<<
 *             azim [0] = scalePosition(azim )[0][0]
 * 
 */
            __Pyx_TraceLine(3368,0,__PYX_ERR(0, 3368, __pyx_L26_error))
            __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_warnings); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3368, __pyx_L26_error)
            __Pyx_GOTREF(__pyx_t_10);
            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_simplefilter); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3368, __pyx_L26_error)
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
            __pyx_t_10 = NULL;
            __pyx_t_4 = 0;
            #if CYTHON_UNPACK_METHODS
            if (unlikely(PyMethod_Check(__pyx_t_3))) {
              __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_3);
              if (likely(__pyx_t_10)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
                __Pyx_INCREF(__pyx_t_10);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_3, function);
                __pyx_t_4 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_n_u_ignore};
              __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
              __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
              if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3368, __pyx_L26_error)
              __Pyx_GOTREF(__pyx_t_2);
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            }
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

            /* "gofast/tools/mathex.pyx":3369
 *             #warnings.filterwarnings(action='ignore', category=OptimizeWarning)
 *             warnings.simplefilter("ignore")
 *             azim [0] = scalePosition(azim )[0][0]             # <<<<<<<<<<<<<<
 * 
 *     if view:
 */
            __Pyx_TraceLine(3369,0,__PYX_ERR(0, 3369, __pyx_L26_error))
            __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_scalePosition); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3369, __pyx_L26_error)
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_10 = NULL;
            __pyx_t_4 = 0;
            #if CYTHON_UNPACK_METHODS
            if (unlikely(PyMethod_Check(__pyx_t_3))) {
              __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_3);
              if (likely(__pyx_t_10)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
                __Pyx_INCREF(__pyx_t_10);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_3, function);
                __pyx_t_4 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_v_azim};
              __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
              __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
              if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3369, __pyx_L26_error)
              __Pyx_GOTREF(__pyx_t_2);
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            }
            __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3369, __pyx_L26_error)
            __Pyx_GOTREF(__pyx_t_3);
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
            __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3369, __pyx_L26_error)
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            if (unlikely((__Pyx_SetItemInt(__pyx_v_azim, 0, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 0, 1) < 0))) __PYX_ERR(0, 3369, __pyx_L26_error)
            __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

            /* "gofast/tools/mathex.pyx":3366
 *         azim = np.hstack ( ( [z.mean(), z ]))
 *         # reset the interpolare value at the first position
 *         with warnings.catch_warnings():             # <<<<<<<<<<<<<<
 *             #warnings.filterwarnings(action='ignore', category=OptimizeWarning)
 *             warnings.simplefilter("ignore")
 */
          }
          __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
          __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
          __Pyx_XDECREF(__pyx_t_18); __pyx_t_18 = 0;
          goto __pyx_L31_try_end;
          __pyx_L26_error:;
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
          __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
          __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
          __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          /*except:*/ {
            __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth", __pyx_clineno, __pyx_lineno, __pyx_filename);
            if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_3, &__pyx_t_10) < 0) __PYX_ERR(0, 3366, __pyx_L28_except_error)
            __Pyx_XGOTREF(__pyx_t_2);
            __Pyx_XGOTREF(__pyx_t_3);
            __Pyx_XGOTREF(__pyx_t_10);
            __pyx_t_1 = PyTuple_Pack(3, __pyx_t_2, __pyx_t_3, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3366, __pyx_L28_except_error)
            __Pyx_GOTREF(__pyx_t_1);
            __pyx_t_19 = __Pyx_PyObject_Call(__pyx_t_15, __pyx_t_1, NULL);
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            if (unlikely(!__pyx_t_19)) __PYX_ERR(0, 3366, __pyx_L28_except_error)
            __Pyx_GOTREF(__pyx_t_19);
            __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_19);
            __Pyx_DECREF(__pyx_t_19); __pyx_t_19 = 0;
            if (__pyx_t_7 < 0) __PYX_ERR(0, 3366, __pyx_L28_except_error)
            __pyx_t_8 = (!__pyx_t_7);
            if (unlikely(__pyx_t_8)) {
              __Pyx_GIVEREF(__pyx_t_2);
              __Pyx_GIVEREF(__pyx_t_3);
              __Pyx_XGIVEREF(__pyx_t_10);
              __Pyx_ErrRestoreWithState(__pyx_t_2, __pyx_t_3, __pyx_t_10);
              __pyx_t_2 = 0; __pyx_t_3 = 0; __pyx_t_10 = 0; 
              __PYX_ERR(0, 3366, __pyx_L28_except_error)
            }
            __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
            __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
            goto __pyx_L27_exception_handled;
          }
          __pyx_L28_except_error:;
          __Pyx_XGIVEREF(__pyx_t_16);
          __Pyx_XGIVEREF(__pyx_t_17);
          __Pyx_XGIVEREF(__pyx_t_18);
          __Pyx_ExceptionReset(__pyx_t_16, __pyx_t_17, __pyx_t_18);
          goto __pyx_L1_error;
          __pyx_L27_exception_handled:;
          __Pyx_XGIVEREF(__pyx_t_16);
          __Pyx_XGIVEREF(__pyx_t_17);
          __Pyx_XGIVEREF(__pyx_t_18);
          __Pyx_ExceptionReset(__pyx_t_16, __pyx_t_17, __pyx_t_18);
          __pyx_L31_try_end:;
        }
      }
      /*finally:*/ {
        /*normal exit:*/{
          if (__pyx_t_15) {
            __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_15, __pyx_tuple__95, NULL);
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
            if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 3366, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_18);
            __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
          }
          goto __pyx_L25;
        }
        __pyx_L25:;
      }
      goto __pyx_L35;
      __pyx_L22_error:;
      __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      goto __pyx_L1_error;
      __pyx_L35:;
    }

    /* "gofast/tools/mathex.pyx":3361
 *     z = np.around ( np.rad2deg ( np.arctan2(list(dx) , list(dy) ) ), 3)
 *     azim = z.copy()
 *     if extrapolate:             # <<<<<<<<<<<<<<
 *         # use mean azimum of the total area zone and
 *         # recompute the position by interpolation
 */
  }

  /* "gofast/tools/mathex.pyx":3371
 *             azim [0] = scalePosition(azim )[0][0]
 * 
 *     if view:             # <<<<<<<<<<<<<<
 *         x = np.arange ( len(azim ))
 *         fig,  ax = plt.subplots (1, 1, figsize = (10, 4))
 */
  __Pyx_TraceLine(3371,0,__PYX_ERR(0, 3371, __pyx_L1_error))
  __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_view); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 3371, __pyx_L1_error)
  if (__pyx_t_8) {

    /* "gofast/tools/mathex.pyx":3372
 * 
 *     if view:
 *         x = np.arange ( len(azim ))             # <<<<<<<<<<<<<<
 *         fig,  ax = plt.subplots (1, 1, figsize = (10, 4))
 *         # add Nan to the first position of z
 */
    __Pyx_TraceLine(3372,0,__PYX_ERR(0, 3372, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3372, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_arange); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3372, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_9 = PyObject_Length(__pyx_v_azim); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3372, __pyx_L1_error)
    __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3372, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_3};
      __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3372, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_v_x = __pyx_t_10;
    __pyx_t_10 = 0;

    /* "gofast/tools/mathex.pyx":3373
 *     if view:
 *         x = np.arange ( len(azim ))
 *         fig,  ax = plt.subplots (1, 1, figsize = (10, 4))             # <<<<<<<<<<<<<<
 *         # add Nan to the first position of z
 *         z = np.hstack (([np.nan], z )) if extrapolate else z
 */
    __Pyx_TraceLine(3373,0,__PYX_ERR(0, 3373, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_plt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3373, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_subplots); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3373, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3373, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_figsize, __pyx_tuple__96) < 0) __PYX_ERR(0, 3373, __pyx_L1_error)
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__10, __pyx_t_10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3373, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
      PyObject* sequence = __pyx_t_3;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 3373, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_10 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_10 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_t_2);
      #else
      __pyx_t_10 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3373, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3373, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      #endif
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3373, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
      index = 0; __pyx_t_10 = __pyx_t_6(__pyx_t_1); if (unlikely(!__pyx_t_10)) goto __pyx_L37_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_10);
      index = 1; __pyx_t_2 = __pyx_t_6(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L37_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_2);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_1), 2) < 0) __PYX_ERR(0, 3373, __pyx_L1_error)
      __pyx_t_6 = NULL;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L38_unpacking_done;
      __pyx_L37_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_6 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 3373, __pyx_L1_error)
      __pyx_L38_unpacking_done:;
    }
    __pyx_v_fig = __pyx_t_10;
    __pyx_t_10 = 0;
    __pyx_v_ax = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3375
 *         fig,  ax = plt.subplots (1, 1, figsize = (10, 4))
 *         # add Nan to the first position of z
 *         z = np.hstack (([np.nan], z )) if extrapolate else z             # <<<<<<<<<<<<<<
 * 
 *         ax.plot (x,
 */
    __Pyx_TraceLine(3375,0,__PYX_ERR(0, 3375, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_v_extrapolate); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 3375, __pyx_L1_error)
    if (__pyx_t_8) {
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3375, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_hstack); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3375, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3375, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_nan); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3375, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyList_New(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3375, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_5);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_10, 0, __pyx_t_5)) __PYX_ERR(0, 3375, __pyx_L1_error);
      __pyx_t_5 = 0;
      __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3375, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_10);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_10)) __PYX_ERR(0, 3375, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_z);
      __Pyx_GIVEREF(__pyx_v_z);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_z)) __PYX_ERR(0, 3375, __pyx_L1_error);
      __pyx_t_10 = 0;
      __pyx_t_10 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_10)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_10);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_5};
        __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3375, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __pyx_t_3 = __pyx_t_2;
      __pyx_t_2 = 0;
    } else {
      __Pyx_INCREF(__pyx_v_z);
      __pyx_t_3 = __pyx_v_z;
    }
    __Pyx_DECREF_SET(__pyx_v_z, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":3377
 *         z = np.hstack (([np.nan], z )) if extrapolate else z
 * 
 *         ax.plot (x,             # <<<<<<<<<<<<<<
 *                  azim,
 *                  c='#0A4CEE',
 */
    __Pyx_TraceLine(3377,0,__PYX_ERR(0, 3377, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_ax, __pyx_n_s_plot); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3377, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "gofast/tools/mathex.pyx":3378
 * 
 *         ax.plot (x,
 *                  azim,             # <<<<<<<<<<<<<<
 *                  c='#0A4CEE',
 *                  marker = 'o',
 */
    __Pyx_TraceLine(3378,0,__PYX_ERR(0, 3378, __pyx_L1_error))
    __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3377, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_x)) __PYX_ERR(0, 3377, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_azim);
    __Pyx_GIVEREF(__pyx_v_azim);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_azim)) __PYX_ERR(0, 3377, __pyx_L1_error);

    /* "gofast/tools/mathex.pyx":3379
 *         ax.plot (x,
 *                  azim,
 *                  c='#0A4CEE',             # <<<<<<<<<<<<<<
 *                  marker = 'o',
 *                  label ='extra-azimuth'
 */
    __Pyx_TraceLine(3379,0,__PYX_ERR(0, 3379, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3379, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_c, __pyx_kp_u_0A4CEE) < 0) __PYX_ERR(0, 3379, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_marker, __pyx_n_u_o) < 0) __PYX_ERR(0, 3379, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_label, __pyx_kp_u_extra_azimuth) < 0) __PYX_ERR(0, 3379, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3377
 *         z = np.hstack (([np.nan], z )) if extrapolate else z
 * 
 *         ax.plot (x,             # <<<<<<<<<<<<<<
 *                  azim,
 *                  c='#0A4CEE',
 */
    __Pyx_TraceLine(3377,0,__PYX_ERR(0, 3377, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_2, __pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3377, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":3384
 *                  )
 * 
 *         ax.plot (x,             # <<<<<<<<<<<<<<
 *                 z,
 *                 'ok-',
 */
    __Pyx_TraceLine(3384,0,__PYX_ERR(0, 3384, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_ax, __pyx_n_s_plot); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3384, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);

    /* "gofast/tools/mathex.pyx":3385
 * 
 *         ax.plot (x,
 *                 z,             # <<<<<<<<<<<<<<
 *                 'ok-',
 *                 label ='raw azimuth'
 */
    __Pyx_TraceLine(3385,0,__PYX_ERR(0, 3385, __pyx_L1_error))
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3384, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_x)) __PYX_ERR(0, 3384, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_z);
    __Pyx_GIVEREF(__pyx_v_z);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_z)) __PYX_ERR(0, 3384, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_ok);
    __Pyx_GIVEREF(__pyx_kp_u_ok);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_ok)) __PYX_ERR(0, 3384, __pyx_L1_error);

    /* "gofast/tools/mathex.pyx":3387
 *                 z,
 *                 'ok-',
 *                 label ='raw azimuth'             # <<<<<<<<<<<<<<
 *                 )
 *         ax.legend ( )
 */
    __Pyx_TraceLine(3387,0,__PYX_ERR(0, 3387, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3387, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_label, __pyx_kp_u_raw_azimuth) < 0) __PYX_ERR(0, 3387, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3384
 *                  )
 * 
 *         ax.plot (x,             # <<<<<<<<<<<<<<
 *                 z,
 *                 'ok-',
 */
    __Pyx_TraceLine(3384,0,__PYX_ERR(0, 3384, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3384, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":3389
 *                 label ='raw azimuth'
 *                 )
 *         ax.legend ( )             # <<<<<<<<<<<<<<
 *         ax.set_xlabel ('x')
 *         ax.set_ylabel ('y')
 */
    __Pyx_TraceLine(3389,0,__PYX_ERR(0, 3389, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ax, __pyx_n_s_legend); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3389, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3389, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":3390
 *                 )
 *         ax.legend ( )
 *         ax.set_xlabel ('x')             # <<<<<<<<<<<<<<
 *         ax.set_ylabel ('y')
 * 
 */
    __Pyx_TraceLine(3390,0,__PYX_ERR(0, 3390, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ax, __pyx_n_s_set_xlabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3390, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_n_u_x};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3390, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":3391
 *         ax.legend ( )
 *         ax.set_xlabel ('x')
 *         ax.set_ylabel ('y')             # <<<<<<<<<<<<<<
 * 
 *     return azim
 */
    __Pyx_TraceLine(3391,0,__PYX_ERR(0, 3391, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ax, __pyx_n_s_set_ylabel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3391, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_n_u_y};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3391, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":3371
 *             azim [0] = scalePosition(azim )[0][0]
 * 
 *     if view:             # <<<<<<<<<<<<<<
 *         x = np.arange ( len(azim ))
 *         fig,  ax = plt.subplots (1, 1, figsize = (10, 4))
 */
  }

  /* "gofast/tools/mathex.pyx":3393
 *         ax.set_ylabel ('y')
 * 
 *     return azim             # <<<<<<<<<<<<<<
 * 
 * def linkage_matrix(
 */
  __Pyx_TraceLine(3393,0,__PYX_ERR(0, 3393, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_azim);
  __pyx_r = __pyx_v_azim;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_AddTraceback("gofast.tools.mathex.get_azimuth", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_Location);
  __Pyx_XDECREF(__pyx_v_msg);
  __Pyx_XDECREF(__pyx_v_dx);
  __Pyx_XDECREF(__pyx_v_dy);
  __Pyx_XDECREF(__pyx_v_z);
  __Pyx_XDECREF(__pyx_v_azim);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_fig);
  __Pyx_XDECREF(__pyx_v_ax);
  __Pyx_XDECREF(__pyx_v_projection);
  __Pyx_XDECREF(__pyx_v_mode);
  __Pyx_XDECREF(__pyx_v_extrapolate);
  __Pyx_XDECREF(__pyx_v_view);
  __Pyx_DECREF((PyObject *)__pyx_cur_scope);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3395
 *     return azim
 * 
 * def linkage_matrix(             # <<<<<<<<<<<<<<
 *     df: DataFrame ,
 *     columns:List[str] =None,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_87linkage_matrix(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_86linkage_matrix, " Compute the distance matrix from the hierachical clustering algorithm.\n    \n    Parameters \n    ------------ \n    df: dataframe or NDArray of (n_samples, n_features) \n        dataframe of Ndarray. If array is given , must specify the column names\n        to much the array shape 1 \n    columns: list \n        list of labels to name each columns of arrays of (n_samples, n_features) \n        If dataframe is given, don't need to specify the columns. \n        \n    kind: str, ['squareform'|'condense'|'design'], default is {'design'}\n        kind of approach to summing up the linkage matrix. \n        Indeed, a condensed distance matrix is a flat array containing the \n        upper triangular of the distance matrix. This is the form that ``pdist`` \n        returns. Alternatively, a collection of :math:`m` observation vectors \n        in :math:`n` dimensions may be passed as  an :math:`m` by :math:`n` \n        array. All elements of the condensed distance matrix must be finite, \n        i.e., no NaNs or infs.\n        Alternatively, we could used the ``squareform`` distance matrix to yield\n        different distance values than expected. \n        the ``design`` approach uses the complete inpout example matrix  also \n        called 'design matrix' to lead correct linkage matrix similar to \n        `squareform` and `condense``. \n        \n    metric : str or callable, default is {'euclidean'}\n        The metric to use when calculating distance between instances in a\n        feature array. If metric is a string, it must be one of the options\n        allowed by :func:`sklearn.metrics.pairwise.pairwise_distances`.\n        If ``X`` is the distance array itself, use \"precomputed\" as the metric.\n        Precomputed distance matrices must have 0 along the diagonal.\n        \n    method : str, optional, default is {'complete'}\n        The linkage algorithm to use. See the ``Linkage Methods`` section below\n        for full descriptions.\n        \n    o""ptimal_ordering : bool, optional\n        If True, the linkage matrix will be reordered so that the distance\n        between successive leaves is minimal. This results in a more intuitive\n        tree structure when the data are visualized. defaults to False, because\n        this algorithm can be slow, particularly on large datasets. See\n        also :func:`scipy.cluster.hierarchy.linkage`. \n        \n        \n    Returns \n    --------\n    row_clusters: linkage matrix \n        consist of several rows where each rw represents one merge. The first \n        and second columns denotes the most dissimilar members of each cluster \n        and the third columns reports the distance between those members \n        \n        \n    Linkage Methods \n    -----------------\n    The following are methods for calculating the distance between the\n    newly formed cluster :math:`u` and each :math:`v`.\n\n    * method='single' assigns\n\n      .. math::\n         d(u,v) = \\min(dist(u[i],v[j]))\n\n      for all points :math:`i` in cluster :math:`u` and\n      :math:`j` in cluster :math:`v`. This is also known as the\n      Nearest Point Algorithm.\n\n    * method='complete' assigns\n\n      .. math::\n         d(u, v) = \\max(dist(u[i],v[j]))\n\n      for all points :math:`i` in cluster u and :math:`j` in\n      cluster :math:`v`. This is also known by the Farthest Point\n      Algorithm or Voor Hees Algorithm.\n\n    * method='average' assigns\n\n      .. math::\n         d(u,v) = \\sum_{ij} \\\\frac{d(u[i], v[j])}{(|u|*|v|)}\n\n      for all points :math:`i` and :math:`j` where :math:`|u|`\n      and :math:`|v|` are the cardinalities of clusters :math:`u`\n      and :math:`v`, respectively. This is also called the UPGMA\n      algorithm.\n\n    * method='weighted' assigns\n\n      .. math::\n         d(u,v) = (dist(s,v) + dist(t,v))/2\n\n      where cluster u was formed with cluster s and t and v\n      is a remaining cluster in the forest (also called WPGMA).\n\n    *"" method='centroid' assigns\n\n      .. math::\n         dist(s,t) = ||c_s-c_t||_2\n\n      where :math:`c_s` and :math:`c_t` are the centroids of\n      clusters :math:`s` and :math:`t`, respectively. When two\n      clusters :math:`s` and :math:`t` are combined into a new\n      cluster :math:`u`, the new centroid is computed over all the\n      original objects in clusters :math:`s` and :math:`t`. The\n      distance then becomes the Euclidean distance between the\n      centroid of :math:`u` and the centroid of a remaining cluster\n      :math:`v` in the forest. This is also known as the UPGMC\n      algorithm.\n\n    * method='median' assigns :math:`d(s,t)` like the ``centroid``\n      method. When two clusters :math:`s` and :math:`t` are combined\n      into a new cluster :math:`u`, the average of centroids s and t\n      give the new centroid :math:`u`. This is also known as the\n      WPGMC algorithm.\n\n    * method='ward' uses the Ward variance minimization algorithm.\n      The new entry :math:`d(u,v)` is computed as follows,\n\n      .. math::\n\n         d(u,v) = \\sqrt{\\frac{|v|+|s|}{_T}d(v,s)^2 \\\\\n                      + \\frac{|v|+|t|}{_T}d(v,t)^2 \\\\\n                      - \\frac{|v|}{_T}d(s,t)^2}\n\n      where :math:`u` is the newly joined cluster consisting of\n      clusters :math:`s` and :math:`t`, :math:`v` is an unused\n      cluster in the forest, :math:`_T=|v|+|s|+|t|`, and\n      :math:`|*|` is the cardinality of its argument. This is also\n      known as the incremental algorithm.\n\n    Warning: When the minimum distance pair in the forest is chosen, there\n    may be two or more pairs with the same minimum distance. This\n    implementation may choose a different minimum than the MATLAB\n    version.\n    \n    See Also\n    --------\n    scipy.spatial.distance.pdist : pairwise distance metrics\n\n    References\n    ----------\n    .. [1] Daniel Mullner, \"Modern hierarchical, agglomerative clustering\n           algorithms\", :a""rXiv:`1109.2378v1`.\n    .. [2] Ziv Bar-Joseph, David K. Gifford, Tommi S. Jaakkola, \"Fast optimal\n           leaf ordering for hierarchical clustering\", 2001. Bioinformatics\n           :doi:`10.1093/bioinformatics/17.suppl_1.S22`\n\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_87linkage_matrix = {"linkage_matrix", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_87linkage_matrix, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_86linkage_matrix};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_87linkage_matrix(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_df = 0;
  PyObject *__pyx_v_columns = 0;
  PyObject *__pyx_v_kind = 0;
  PyObject *__pyx_v_metric = 0;
  PyObject *__pyx_v_method = 0;
  PyObject *__pyx_v_as_frame = 0;
  PyObject *__pyx_v_optimal_ordering = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("linkage_matrix (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_df,&__pyx_n_s_columns,&__pyx_n_s_kind,&__pyx_n_s_metric,&__pyx_n_s_method,&__pyx_n_s_as_frame,&__pyx_n_s_optimal_ordering,0};

    /* "gofast/tools/mathex.pyx":3397
 * def linkage_matrix(
 *     df: DataFrame ,
 *     columns:List[str] =None,             # <<<<<<<<<<<<<<
 *     kind:str ='design',
 *     metric:str ='euclidean',
 */
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_design)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_euclidean)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_complete)));

    /* "gofast/tools/mathex.pyx":3401
 *     metric:str ='euclidean',
 *     method:str ='complete',
 *     as_frame =False,             # <<<<<<<<<<<<<<
 *     optimal_ordering=False,
 *  )->NDArray:
 */
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":3402
 *     method:str ='complete',
 *     as_frame =False,
 *     optimal_ordering=False,             # <<<<<<<<<<<<<<
 *  )->NDArray:
 *     r""" Compute the distance matrix from the hierachical clustering algorithm.
 */
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_df)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_columns);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kind);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_metric);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_method);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_as_frame);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_optimal_ordering);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3395, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "linkage_matrix") < 0)) __PYX_ERR(0, 3395, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_df = values[0];
    __pyx_v_columns = values[1];
    __pyx_v_kind = ((PyObject*)values[2]);
    __pyx_v_metric = ((PyObject*)values[3]);
    __pyx_v_method = ((PyObject*)values[4]);
    __pyx_v_as_frame = values[5];
    __pyx_v_optimal_ordering = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("linkage_matrix", 0, 1, 7, __pyx_nargs); __PYX_ERR(0, 3395, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.linkage_matrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_kind), (&PyUnicode_Type), 0, "kind", 1))) __PYX_ERR(0, 3398, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_metric), (&PyUnicode_Type), 0, "metric", 1))) __PYX_ERR(0, 3399, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_method), (&PyUnicode_Type), 0, "method", 1))) __PYX_ERR(0, 3400, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_86linkage_matrix(__pyx_self, __pyx_v_df, __pyx_v_columns, __pyx_v_kind, __pyx_v_metric, __pyx_v_method, __pyx_v_as_frame, __pyx_v_optimal_ordering);

  /* "gofast/tools/mathex.pyx":3395
 *     return azim
 * 
 * def linkage_matrix(             # <<<<<<<<<<<<<<
 *     df: DataFrame ,
 *     columns:List[str] =None,
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_86linkage_matrix(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_df, PyObject *__pyx_v_columns, PyObject *__pyx_v_kind, PyObject *__pyx_v_metric, PyObject *__pyx_v_method, PyObject *__pyx_v_as_frame, PyObject *__pyx_v_optimal_ordering) {
  PyObject *__pyx_v_labels = NULL;
  PyObject *__pyx_v_row_dist = NULL;
  PyObject *__pyx_v_row_clusters = NULL;
  Py_ssize_t __pyx_9genexpr11__pyx_v_i;
  PyObject *__pyx_9genexpr12__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  int __pyx_t_7;
  Py_ssize_t __pyx_t_8;
  Py_UCS4 __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  int __pyx_t_12;
  Py_ssize_t __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *(*__pyx_t_16)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__97)
  __Pyx_RefNannySetupContext("linkage_matrix", 0);
  __Pyx_TraceCall("linkage_matrix", __pyx_f[0], 3395, 0, __PYX_ERR(0, 3395, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_df);
  __Pyx_INCREF(__pyx_v_columns);
  __Pyx_INCREF(__pyx_v_kind);

  /* "gofast/tools/mathex.pyx":3551
 * 
 *     """
 *     df = _assert_all_types(df, pd.DataFrame, np.ndarray)             # <<<<<<<<<<<<<<
 * 
 *     if columns is not None:
 */
  __Pyx_TraceLine(3551,0,__PYX_ERR(0, 3551, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_pd); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3551, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_3, __pyx_v_df, __pyx_t_4, __pyx_t_5};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 3+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3551, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_df, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3553
 *     df = _assert_all_types(df, pd.DataFrame, np.ndarray)
 * 
 *     if columns is not None:             # <<<<<<<<<<<<<<
 *         if isinstance (columns , str):
 *             columns = [columns]
 */
  __Pyx_TraceLine(3553,0,__PYX_ERR(0, 3553, __pyx_L1_error))
  __pyx_t_7 = (__pyx_v_columns != Py_None);
  if (__pyx_t_7) {

    /* "gofast/tools/mathex.pyx":3554
 * 
 *     if columns is not None:
 *         if isinstance (columns , str):             # <<<<<<<<<<<<<<
 *             columns = [columns]
 *         if len(columns)!= df.shape [1]:
 */
    __Pyx_TraceLine(3554,0,__PYX_ERR(0, 3554, __pyx_L1_error))
    __pyx_t_7 = PyUnicode_Check(__pyx_v_columns); 
    if (__pyx_t_7) {

      /* "gofast/tools/mathex.pyx":3555
 *     if columns is not None:
 *         if isinstance (columns , str):
 *             columns = [columns]             # <<<<<<<<<<<<<<
 *         if len(columns)!= df.shape [1]:
 *             raise TypeError("Number of columns must fit the shape of X."
 */
      __Pyx_TraceLine(3555,0,__PYX_ERR(0, 3555, __pyx_L1_error))
      __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3555, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_v_columns);
      __Pyx_GIVEREF(__pyx_v_columns);
      if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_columns)) __PYX_ERR(0, 3555, __pyx_L1_error);
      __Pyx_DECREF_SET(__pyx_v_columns, __pyx_t_1);
      __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":3554
 * 
 *     if columns is not None:
 *         if isinstance (columns , str):             # <<<<<<<<<<<<<<
 *             columns = [columns]
 *         if len(columns)!= df.shape [1]:
 */
    }

    /* "gofast/tools/mathex.pyx":3556
 *         if isinstance (columns , str):
 *             columns = [columns]
 *         if len(columns)!= df.shape [1]:             # <<<<<<<<<<<<<<
 *             raise TypeError("Number of columns must fit the shape of X."
 *                             f" got {len(columns)} instead of {df.shape [1]}"
 */
    __Pyx_TraceLine(3556,0,__PYX_ERR(0, 3556, __pyx_L1_error))
    __pyx_t_8 = PyObject_Length(__pyx_v_columns); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3556, __pyx_L1_error)
    __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3556, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3556, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3556, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyObject_RichCompare(__pyx_t_1, __pyx_t_5, Py_NE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3556, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 3556, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(__pyx_t_7)) {

      /* "gofast/tools/mathex.pyx":3557
 *             columns = [columns]
 *         if len(columns)!= df.shape [1]:
 *             raise TypeError("Number of columns must fit the shape of X."             # <<<<<<<<<<<<<<
 *                             f" got {len(columns)} instead of {df.shape [1]}"
 *                             )
 */
      __Pyx_TraceLine(3557,0,__PYX_ERR(0, 3557, __pyx_L1_error))
      __pyx_t_2 = PyTuple_New(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3557, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_8 = 0;
      __pyx_t_9 = 127;
      __Pyx_INCREF(__pyx_kp_u_Number_of_columns_must_fit_the_s);
      __pyx_t_8 += 47;
      __Pyx_GIVEREF(__pyx_kp_u_Number_of_columns_must_fit_the_s);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Number_of_columns_must_fit_the_s);

      /* "gofast/tools/mathex.pyx":3558
 *         if len(columns)!= df.shape [1]:
 *             raise TypeError("Number of columns must fit the shape of X."
 *                             f" got {len(columns)} instead of {df.shape [1]}"             # <<<<<<<<<<<<<<
 *                             )
 *         df = pd.DataFrame(data = df.values if hasattr(df, 'columns') else df ,
 */
      __Pyx_TraceLine(3558,0,__PYX_ERR(0, 3558, __pyx_L1_error))
      __pyx_t_10 = PyObject_Length(__pyx_v_columns); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3558, __pyx_L1_error)
      __pyx_t_5 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_t_10, 0, ' ', 'd'); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3558, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_8 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5);
      __pyx_t_5 = 0;
      __Pyx_INCREF(__pyx_kp_u_instead_of);
      __pyx_t_8 += 12;
      __Pyx_GIVEREF(__pyx_kp_u_instead_of);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_instead_of);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3558, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_5, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3558, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_FormatSimple(__pyx_t_1, __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3558, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) > __pyx_t_9) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_5) : __pyx_t_9;
      __pyx_t_8 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_5);
      __Pyx_GIVEREF(__pyx_t_5);
      PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_5);
      __pyx_t_5 = 0;

      /* "gofast/tools/mathex.pyx":3557
 *             columns = [columns]
 *         if len(columns)!= df.shape [1]:
 *             raise TypeError("Number of columns must fit the shape of X."             # <<<<<<<<<<<<<<
 *                             f" got {len(columns)} instead of {df.shape [1]}"
 *                             )
 */
      __Pyx_TraceLine(3557,0,__PYX_ERR(0, 3557, __pyx_L1_error))
      __pyx_t_5 = __Pyx_PyUnicode_Join(__pyx_t_2, 4, __pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3557, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3557, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_ERR(0, 3557, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":3556
 *         if isinstance (columns , str):
 *             columns = [columns]
 *         if len(columns)!= df.shape [1]:             # <<<<<<<<<<<<<<
 *             raise TypeError("Number of columns must fit the shape of X."
 *                             f" got {len(columns)} instead of {df.shape [1]}"
 */
    }

    /* "gofast/tools/mathex.pyx":3560
 *                             f" got {len(columns)} instead of {df.shape [1]}"
 *                             )
 *         df = pd.DataFrame(data = df.values if hasattr(df, 'columns') else df ,             # <<<<<<<<<<<<<<
 *                           columns = columns )
 * 
 */
    __Pyx_TraceLine(3560,0,__PYX_ERR(0, 3560, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_7 = __Pyx_HasAttr(__pyx_v_df, __pyx_n_u_columns); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 3560, __pyx_L1_error)
    if (__pyx_t_7) {
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_values); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3560, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_1 = __pyx_t_4;
      __pyx_t_4 = 0;
    } else {
      __Pyx_INCREF(__pyx_v_df);
      __pyx_t_1 = __pyx_v_df;
    }
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_data, __pyx_t_1) < 0) __PYX_ERR(0, 3560, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3561
 *                             )
 *         df = pd.DataFrame(data = df.values if hasattr(df, 'columns') else df ,
 *                           columns = columns )             # <<<<<<<<<<<<<<
 * 
 *     kind= str(kind).lower().strip()
 */
    __Pyx_TraceLine(3561,0,__PYX_ERR(0, 3561, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_columns, __pyx_v_columns) < 0) __PYX_ERR(0, 3560, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3560
 *                             f" got {len(columns)} instead of {df.shape [1]}"
 *                             )
 *         df = pd.DataFrame(data = df.values if hasattr(df, 'columns') else df ,             # <<<<<<<<<<<<<<
 *                           columns = columns )
 * 
 */
    __Pyx_TraceLine(3560,0,__PYX_ERR(0, 3560, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3560, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_df, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3553
 *     df = _assert_all_types(df, pd.DataFrame, np.ndarray)
 * 
 *     if columns is not None:             # <<<<<<<<<<<<<<
 *         if isinstance (columns , str):
 *             columns = [columns]
 */
  }

  /* "gofast/tools/mathex.pyx":3563
 *                           columns = columns )
 * 
 *     kind= str(kind).lower().strip()             # <<<<<<<<<<<<<<
 *     if kind not in ('squareform', 'condense', 'design'):
 *         raise ValueError(f"Unknown method {method!r}. Expect 'squareform',"
 */
  __Pyx_TraceLine(3563,0,__PYX_ERR(0, 3563, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_Str(__pyx_v_kind); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3563, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_strip); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3563, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  if (!(likely(PyUnicode_CheckExact(__pyx_t_1))||((__pyx_t_1) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_1))) __PYX_ERR(0, 3563, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_kind, ((PyObject*)__pyx_t_1));
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3564
 * 
 *     kind= str(kind).lower().strip()
 *     if kind not in ('squareform', 'condense', 'design'):             # <<<<<<<<<<<<<<
 *         raise ValueError(f"Unknown method {method!r}. Expect 'squareform',"
 *                          " 'condense' or 'design'.")
 */
  __Pyx_TraceLine(3564,0,__PYX_ERR(0, 3564, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_kind);
  __pyx_t_11 = __pyx_v_kind;
  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_t_11, __pyx_n_u_squareform, Py_NE)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3564, __pyx_L1_error)
  if (__pyx_t_12) {
  } else {
    __pyx_t_7 = __pyx_t_12;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_t_11, __pyx_n_u_condense, Py_NE)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3564, __pyx_L1_error)
  if (__pyx_t_12) {
  } else {
    __pyx_t_7 = __pyx_t_12;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_t_11, __pyx_n_u_design, Py_NE)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3564, __pyx_L1_error)
  __pyx_t_7 = __pyx_t_12;
  __pyx_L7_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
  __pyx_t_12 = __pyx_t_7;
  if (unlikely(__pyx_t_12)) {

    /* "gofast/tools/mathex.pyx":3565
 *     kind= str(kind).lower().strip()
 *     if kind not in ('squareform', 'condense', 'design'):
 *         raise ValueError(f"Unknown method {method!r}. Expect 'squareform',"             # <<<<<<<<<<<<<<
 *                          " 'condense' or 'design'.")
 * 
 */
    __Pyx_TraceLine(3565,0,__PYX_ERR(0, 3565, __pyx_L1_error))
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3565, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = 0;
    __pyx_t_9 = 127;
    __Pyx_INCREF(__pyx_kp_u_Unknown_method);
    __pyx_t_8 += 15;
    __Pyx_GIVEREF(__pyx_kp_u_Unknown_method);
    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Unknown_method);
    __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_method), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3565, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_9 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_9) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_9;
    __pyx_t_8 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_4);
    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
    __pyx_t_4 = 0;
    __Pyx_INCREF(__pyx_kp_u_Expect_squareform_condense_or_d);
    __pyx_t_8 += 46;
    __Pyx_GIVEREF(__pyx_kp_u_Expect_squareform_condense_or_d);
    PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_Expect_squareform_condense_or_d);
    __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_8, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3565, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3565, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 3565, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3564
 * 
 *     kind= str(kind).lower().strip()
 *     if kind not in ('squareform', 'condense', 'design'):             # <<<<<<<<<<<<<<
 *         raise ValueError(f"Unknown method {method!r}. Expect 'squareform',"
 *                          " 'condense' or 'design'.")
 */
  }

  /* "gofast/tools/mathex.pyx":3568
 *                          " 'condense' or 'design'.")
 * 
 *     labels = [f'ID_{i}' for i in range(len(df))]             # <<<<<<<<<<<<<<
 *     if kind =='squareform':
 *         row_dist = pd.DataFrame (squareform (
 */
  __Pyx_TraceLine(3568,0,__PYX_ERR(0, 3568, __pyx_L1_error))
  { /* enter inner scope */
    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3568, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyObject_Length(__pyx_v_df); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3568, __pyx_L1_error)
    __pyx_t_10 = __pyx_t_8;
    for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_10; __pyx_t_13+=1) {
      __pyx_9genexpr11__pyx_v_i = __pyx_t_13;
      __pyx_t_4 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_9genexpr11__pyx_v_i, 0, ' ', 'd'); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3568, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_n_u_ID, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3568, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 3568, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
  } /* exit inner scope */
  __pyx_v_labels = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3569
 * 
 *     labels = [f'ID_{i}' for i in range(len(df))]
 *     if kind =='squareform':             # <<<<<<<<<<<<<<
 *         row_dist = pd.DataFrame (squareform (
 *         pdist(df, metric= metric )), columns = labels  ,
 */
  __Pyx_TraceLine(3569,0,__PYX_ERR(0, 3569, __pyx_L1_error))
  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_v_kind, __pyx_n_u_squareform, Py_EQ)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3569, __pyx_L1_error)
  if (__pyx_t_12) {

    /* "gofast/tools/mathex.pyx":3570
 *     labels = [f'ID_{i}' for i in range(len(df))]
 *     if kind =='squareform':
 *         row_dist = pd.DataFrame (squareform (             # <<<<<<<<<<<<<<
 *         pdist(df, metric= metric )), columns = labels  ,
 *         index = labels)
 */
    __Pyx_TraceLine(3570,0,__PYX_ERR(0, 3570, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_pd); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3570, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3570, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_squareform); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3570, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);

    /* "gofast/tools/mathex.pyx":3571
 *     if kind =='squareform':
 *         row_dist = pd.DataFrame (squareform (
 *         pdist(df, metric= metric )), columns = labels  ,             # <<<<<<<<<<<<<<
 *         index = labels)
 *         row_clusters = linkage (row_dist, method =method, metric =metric
 */
    __Pyx_TraceLine(3571,0,__PYX_ERR(0, 3571, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_pdist); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3571, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3571, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_df);
    __Pyx_GIVEREF(__pyx_v_df);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_df)) __PYX_ERR(0, 3571, __pyx_L1_error);
    __pyx_t_14 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 3571, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    if (PyDict_SetItem(__pyx_t_14, __pyx_n_s_metric, __pyx_v_metric) < 0) __PYX_ERR(0, 3571, __pyx_L1_error)
    __pyx_t_15 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_3, __pyx_t_14); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3571, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    __pyx_t_14 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_14)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_14);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_14, __pyx_t_15};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
      __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3570, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }

    /* "gofast/tools/mathex.pyx":3570
 *     labels = [f'ID_{i}' for i in range(len(df))]
 *     if kind =='squareform':
 *         row_dist = pd.DataFrame (squareform (             # <<<<<<<<<<<<<<
 *         pdist(df, metric= metric )), columns = labels  ,
 *         index = labels)
 */
    __Pyx_TraceLine(3570,0,__PYX_ERR(0, 3570, __pyx_L1_error))
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3570, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 3570, __pyx_L1_error);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3571
 *     if kind =='squareform':
 *         row_dist = pd.DataFrame (squareform (
 *         pdist(df, metric= metric )), columns = labels  ,             # <<<<<<<<<<<<<<
 *         index = labels)
 *         row_clusters = linkage (row_dist, method =method, metric =metric
 */
    __Pyx_TraceLine(3571,0,__PYX_ERR(0, 3571, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3571, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_columns, __pyx_v_labels) < 0) __PYX_ERR(0, 3571, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3572
 *         row_dist = pd.DataFrame (squareform (
 *         pdist(df, metric= metric )), columns = labels  ,
 *         index = labels)             # <<<<<<<<<<<<<<
 *         row_clusters = linkage (row_dist, method =method, metric =metric
 *                                 )
 */
    __Pyx_TraceLine(3572,0,__PYX_ERR(0, 3572, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_index, __pyx_v_labels) < 0) __PYX_ERR(0, 3571, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3570
 *     labels = [f'ID_{i}' for i in range(len(df))]
 *     if kind =='squareform':
 *         row_dist = pd.DataFrame (squareform (             # <<<<<<<<<<<<<<
 *         pdist(df, metric= metric )), columns = labels  ,
 *         index = labels)
 */
    __Pyx_TraceLine(3570,0,__PYX_ERR(0, 3570, __pyx_L1_error))
    __pyx_t_15 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3570, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_row_dist = __pyx_t_15;
    __pyx_t_15 = 0;

    /* "gofast/tools/mathex.pyx":3573
 *         pdist(df, metric= metric )), columns = labels  ,
 *         index = labels)
 *         row_clusters = linkage (row_dist, method =method, metric =metric             # <<<<<<<<<<<<<<
 *                                 )
 *     if kind =='condens':
 */
    __Pyx_TraceLine(3573,0,__PYX_ERR(0, 3573, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_linkage); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3573, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3573, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_row_dist);
    __Pyx_GIVEREF(__pyx_v_row_dist);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_row_dist)) __PYX_ERR(0, 3573, __pyx_L1_error);
    __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3573, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_method, __pyx_v_method) < 0) __PYX_ERR(0, 3573, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_metric, __pyx_v_metric) < 0) __PYX_ERR(0, 3573, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_15, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3573, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_row_clusters = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3569
 * 
 *     labels = [f'ID_{i}' for i in range(len(df))]
 *     if kind =='squareform':             # <<<<<<<<<<<<<<
 *         row_dist = pd.DataFrame (squareform (
 *         pdist(df, metric= metric )), columns = labels  ,
 */
  }

  /* "gofast/tools/mathex.pyx":3575
 *         row_clusters = linkage (row_dist, method =method, metric =metric
 *                                 )
 *     if kind =='condens':             # <<<<<<<<<<<<<<
 *         row_clusters = linkage (pdist(df, metric =metric), method =method
 *                                 )
 */
  __Pyx_TraceLine(3575,0,__PYX_ERR(0, 3575, __pyx_L1_error))
  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_v_kind, __pyx_n_u_condens, Py_EQ)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3575, __pyx_L1_error)
  if (__pyx_t_12) {

    /* "gofast/tools/mathex.pyx":3576
 *                                 )
 *     if kind =='condens':
 *         row_clusters = linkage (pdist(df, metric =metric), method =method             # <<<<<<<<<<<<<<
 *                                 )
 *     if kind =='design':
 */
    __Pyx_TraceLine(3576,0,__PYX_ERR(0, 3576, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_linkage); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_pdist); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_df);
    __Pyx_GIVEREF(__pyx_v_df);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_df)) __PYX_ERR(0, 3576, __pyx_L1_error);
    __pyx_t_15 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    if (PyDict_SetItem(__pyx_t_15, __pyx_n_s_metric, __pyx_v_metric) < 0) __PYX_ERR(0, 3576, __pyx_L1_error)
    __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_15); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __pyx_t_15 = PyTuple_New(1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_GIVEREF(__pyx_t_14);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_14)) __PYX_ERR(0, 3576, __pyx_L1_error);
    __pyx_t_14 = 0;
    __pyx_t_14 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    if (PyDict_SetItem(__pyx_t_14, __pyx_n_s_method, __pyx_v_method) < 0) __PYX_ERR(0, 3576, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_15, __pyx_t_14); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3576, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_XDECREF_SET(__pyx_v_row_clusters, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3575
 *         row_clusters = linkage (row_dist, method =method, metric =metric
 *                                 )
 *     if kind =='condens':             # <<<<<<<<<<<<<<
 *         row_clusters = linkage (pdist(df, metric =metric), method =method
 *                                 )
 */
  }

  /* "gofast/tools/mathex.pyx":3578
 *         row_clusters = linkage (pdist(df, metric =metric), method =method
 *                                 )
 *     if kind =='design':             # <<<<<<<<<<<<<<
 *         row_clusters = linkage(df.values if hasattr (df, 'columns') else df,
 *                                method = method,
 */
  __Pyx_TraceLine(3578,0,__PYX_ERR(0, 3578, __pyx_L1_error))
  __pyx_t_12 = (__Pyx_PyUnicode_Equals(__pyx_v_kind, __pyx_n_u_design, Py_EQ)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3578, __pyx_L1_error)
  if (__pyx_t_12) {

    /* "gofast/tools/mathex.pyx":3579
 *                                 )
 *     if kind =='design':
 *         row_clusters = linkage(df.values if hasattr (df, 'columns') else df,             # <<<<<<<<<<<<<<
 *                                method = method,
 *                                optimal_ordering=optimal_ordering )
 */
    __Pyx_TraceLine(3579,0,__PYX_ERR(0, 3579, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_linkage); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_12 = __Pyx_HasAttr(__pyx_v_df, __pyx_n_u_columns); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 3579, __pyx_L1_error)
    if (__pyx_t_12) {
      __pyx_t_15 = __Pyx_PyObject_GetAttrStr(__pyx_v_df, __pyx_n_s_values); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3579, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_15);
      __pyx_t_14 = __pyx_t_15;
      __pyx_t_15 = 0;
    } else {
      __Pyx_INCREF(__pyx_v_df);
      __pyx_t_14 = __pyx_v_df;
    }
    __pyx_t_15 = PyTuple_New(1); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __Pyx_GIVEREF(__pyx_t_14);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_15, 0, __pyx_t_14)) __PYX_ERR(0, 3579, __pyx_L1_error);
    __pyx_t_14 = 0;

    /* "gofast/tools/mathex.pyx":3580
 *     if kind =='design':
 *         row_clusters = linkage(df.values if hasattr (df, 'columns') else df,
 *                                method = method,             # <<<<<<<<<<<<<<
 *                                optimal_ordering=optimal_ordering )
 * 
 */
    __Pyx_TraceLine(3580,0,__PYX_ERR(0, 3580, __pyx_L1_error))
    __pyx_t_14 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 3580, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    if (PyDict_SetItem(__pyx_t_14, __pyx_n_s_method, __pyx_v_method) < 0) __PYX_ERR(0, 3580, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3581
 *         row_clusters = linkage(df.values if hasattr (df, 'columns') else df,
 *                                method = method,
 *                                optimal_ordering=optimal_ordering )             # <<<<<<<<<<<<<<
 * 
 *     if as_frame:
 */
    __Pyx_TraceLine(3581,0,__PYX_ERR(0, 3581, __pyx_L1_error))
    if (PyDict_SetItem(__pyx_t_14, __pyx_n_s_optimal_ordering, __pyx_v_optimal_ordering) < 0) __PYX_ERR(0, 3580, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3579
 *                                 )
 *     if kind =='design':
 *         row_clusters = linkage(df.values if hasattr (df, 'columns') else df,             # <<<<<<<<<<<<<<
 *                                method = method,
 *                                optimal_ordering=optimal_ordering )
 */
    __Pyx_TraceLine(3579,0,__PYX_ERR(0, 3579, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_15, __pyx_t_14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3579, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_XDECREF_SET(__pyx_v_row_clusters, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3578
 *         row_clusters = linkage (pdist(df, metric =metric), method =method
 *                                 )
 *     if kind =='design':             # <<<<<<<<<<<<<<
 *         row_clusters = linkage(df.values if hasattr (df, 'columns') else df,
 *                                method = method,
 */
  }

  /* "gofast/tools/mathex.pyx":3583
 *                                optimal_ordering=optimal_ordering )
 * 
 *     if as_frame:             # <<<<<<<<<<<<<<
 *         row_clusters = pd.DataFrame ( row_clusters,
 *                                      columns = [ 'row label 1',
 */
  __Pyx_TraceLine(3583,0,__PYX_ERR(0, 3583, __pyx_L1_error))
  __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_v_as_frame); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3583, __pyx_L1_error)
  if (__pyx_t_12) {

    /* "gofast/tools/mathex.pyx":3584
 * 
 *     if as_frame:
 *         row_clusters = pd.DataFrame ( row_clusters,             # <<<<<<<<<<<<<<
 *                                      columns = [ 'row label 1',
 *                                                 'row lable 2',
 */
    __Pyx_TraceLine(3584,0,__PYX_ERR(0, 3584, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3584, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_14 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 3584, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_14);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_v_row_clusters)) { __Pyx_RaiseUnboundLocalError("row_clusters"); __PYX_ERR(0, 3584, __pyx_L1_error) }
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3584, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_row_clusters);
    __Pyx_GIVEREF(__pyx_v_row_clusters);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_row_clusters)) __PYX_ERR(0, 3584, __pyx_L1_error);

    /* "gofast/tools/mathex.pyx":3585
 *     if as_frame:
 *         row_clusters = pd.DataFrame ( row_clusters,
 *                                      columns = [ 'row label 1',             # <<<<<<<<<<<<<<
 *                                                 'row lable 2',
 *                                                 'distance',
 */
    __Pyx_TraceLine(3585,0,__PYX_ERR(0, 3585, __pyx_L1_error))
    __pyx_t_15 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 3585, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_15);
    __pyx_t_1 = PyList_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3585, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_kp_u_row_label_1);
    __Pyx_GIVEREF(__pyx_kp_u_row_label_1);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_row_label_1)) __PYX_ERR(0, 3585, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_row_lable_2);
    __Pyx_GIVEREF(__pyx_kp_u_row_lable_2);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 1, __pyx_kp_u_row_lable_2)) __PYX_ERR(0, 3585, __pyx_L1_error);
    __Pyx_INCREF(__pyx_n_u_distance);
    __Pyx_GIVEREF(__pyx_n_u_distance);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 2, __pyx_n_u_distance)) __PYX_ERR(0, 3585, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_no_of_items_in_clust);
    __Pyx_GIVEREF(__pyx_kp_u_no_of_items_in_clust);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 3, __pyx_kp_u_no_of_items_in_clust)) __PYX_ERR(0, 3585, __pyx_L1_error);
    if (PyDict_SetItem(__pyx_t_15, __pyx_n_s_columns, __pyx_t_1) < 0) __PYX_ERR(0, 3585, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    { /* enter inner scope */

      /* "gofast/tools/mathex.pyx":3590
 *                                                 'no. of items in clust.'
 *                                                 ],
 *                                      index = ['cluster %d' % (i +1) for i in             # <<<<<<<<<<<<<<
 *                                               range(row_clusters.shape[0])
 *                                               ]
 */
      __Pyx_TraceLine(3590,0,__PYX_ERR(0, 3590, __pyx_L18_error))
      __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3590, __pyx_L18_error)
      __Pyx_GOTREF(__pyx_t_1);

      /* "gofast/tools/mathex.pyx":3591
 *                                                 ],
 *                                      index = ['cluster %d' % (i +1) for i in
 *                                               range(row_clusters.shape[0])             # <<<<<<<<<<<<<<
 *                                               ]
 *                                      )
 */
      __Pyx_TraceLine(3591,0,__PYX_ERR(0, 3591, __pyx_L18_error))
      if (unlikely(!__pyx_v_row_clusters)) { __Pyx_RaiseUnboundLocalError("row_clusters"); __PYX_ERR(0, 3591, __pyx_L18_error) }
      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_row_clusters, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3591, __pyx_L18_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_t_4, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3591, __pyx_L18_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3591, __pyx_L18_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
        __pyx_t_3 = __pyx_t_4; __Pyx_INCREF(__pyx_t_3);
        __pyx_t_8 = 0;
        __pyx_t_16 = NULL;
      } else {
        __pyx_t_8 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3591, __pyx_L18_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_16 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 3591, __pyx_L18_error)
      }
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      for (;;) {
        if (likely(!__pyx_t_16)) {
          if (likely(PyList_CheckExact(__pyx_t_3))) {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 3591, __pyx_L18_error)
              #endif
              if (__pyx_t_8 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 3591, __pyx_L18_error)
            #else
            __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3591, __pyx_L18_error)
            __Pyx_GOTREF(__pyx_t_4);
            #endif
          } else {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 3591, __pyx_L18_error)
              #endif
              if (__pyx_t_8 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_4); __pyx_t_8++; if (unlikely((0 < 0))) __PYX_ERR(0, 3591, __pyx_L18_error)
            #else
            __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3591, __pyx_L18_error)
            __Pyx_GOTREF(__pyx_t_4);
            #endif
          }
        } else {
          __pyx_t_4 = __pyx_t_16(__pyx_t_3);
          if (unlikely(!__pyx_t_4)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 3591, __pyx_L18_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_4);
        }
        __Pyx_XDECREF_SET(__pyx_9genexpr12__pyx_v_i, __pyx_t_4);
        __pyx_t_4 = 0;

        /* "gofast/tools/mathex.pyx":3590
 *                                                 'no. of items in clust.'
 *                                                 ],
 *                                      index = ['cluster %d' % (i +1) for i in             # <<<<<<<<<<<<<<
 *                                               range(row_clusters.shape[0])
 *                                               ]
 */
        __Pyx_TraceLine(3590,0,__PYX_ERR(0, 3590, __pyx_L18_error))
        __pyx_t_4 = __Pyx_PyInt_AddObjC(__pyx_9genexpr12__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3590, __pyx_L18_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_5 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_cluster_d, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3590, __pyx_L18_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_5))) __PYX_ERR(0, 3590, __pyx_L18_error)
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_i); __pyx_9genexpr12__pyx_v_i = 0;
      goto __pyx_L22_exit_scope;
      __pyx_L18_error:;
      __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_i); __pyx_9genexpr12__pyx_v_i = 0;
      goto __pyx_L1_error;
      __pyx_L22_exit_scope:;
    } /* exit inner scope */
    if (PyDict_SetItem(__pyx_t_15, __pyx_n_s_index, __pyx_t_1) < 0) __PYX_ERR(0, 3585, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3584
 * 
 *     if as_frame:
 *         row_clusters = pd.DataFrame ( row_clusters,             # <<<<<<<<<<<<<<
 *                                      columns = [ 'row label 1',
 *                                                 'row lable 2',
 */
    __Pyx_TraceLine(3584,0,__PYX_ERR(0, 3584, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_14, __pyx_t_2, __pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3584, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
    __Pyx_XDECREF_SET(__pyx_v_row_clusters, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3583
 *                                optimal_ordering=optimal_ordering )
 * 
 *     if as_frame:             # <<<<<<<<<<<<<<
 *         row_clusters = pd.DataFrame ( row_clusters,
 *                                      columns = [ 'row label 1',
 */
  }

  /* "gofast/tools/mathex.pyx":3594
 *                                               ]
 *                                      )
 *     return row_clusters             # <<<<<<<<<<<<<<
 * 
 * @AppendDocReferences(refglossary.__doc__)
 */
  __Pyx_TraceLine(3594,0,__PYX_ERR(0, 3594, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_v_row_clusters)) { __Pyx_RaiseUnboundLocalError("row_clusters"); __PYX_ERR(0, 3594, __pyx_L1_error) }
  __Pyx_INCREF(__pyx_v_row_clusters);
  __pyx_r = __pyx_v_row_clusters;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3395
 *     return azim
 * 
 * def linkage_matrix(             # <<<<<<<<<<<<<<
 *     df: DataFrame ,
 *     columns:List[str] =None,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_AddTraceback("gofast.tools.mathex.linkage_matrix", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_labels);
  __Pyx_XDECREF(__pyx_v_row_dist);
  __Pyx_XDECREF(__pyx_v_row_clusters);
  __Pyx_XDECREF(__pyx_9genexpr12__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_df);
  __Pyx_XDECREF(__pyx_v_columns);
  __Pyx_XDECREF(__pyx_v_kind);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_89scalePosition(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_88scalePosition, " Correct data location or position and return new corrected location \n    \n    Parameters \n    ----------\n    ydata: array_like, series or dataframe\n        The dependent data, a length M array - nominally ``f(xdata, ...)``.\n        \n    xdata: array_like or object\n        The independent variable where the data is measured. Should usually \n        be an M-length sequence or an (k,M)-shaped array for functions with\n        k predictors, but can actually be any object. If ``None``, `xdata` is \n        generated by default using the length of the given `ydata`.\n        \n    func: callable \n        The model function, ``f(x, ...)``. It must take the independent variable \n        as the first argument and the parameters to fit as separate remaining\n        arguments. The default `func` is ``linear`` function i.e  for ``f(x)= ax +b``. \n        where `a` is slope and `b` is the intercept value. Setting your own \n        function for better fitting is recommended. \n        \n    c_order: int or str\n        The index or the column name if ``ydata`` is given as a dataframe to \n        select the right column for scaling.\n    show: bool \n        Quick visualization of data distribution. \n\n    kws: dict \n        Additional keyword argument from  `scipy.optimize_curvefit` parameters. \n        Refer to `scipy.optimize.curve_fit`_.  \n        \n    Returns \n    --------\n    - ydata - array -like - Data scaled \n    - popt - array-like Optimal values for the parameters so that the sum of \n        the squared residuals of ``f(xdata, *popt) - ydata`` is minimized.\n    - pcov - array like The estimated covariance of popt. The diagonals provide\n        the variance of the parameter estimate. To compute one standard deviation \n        errors on the parameters use ``perr = np.sqrt(np.diag(pcov))``. How the\n        sigma parameter affects the estimated covariance depends on absolute_sigma \n        argument, as described above. If the Jacobian matrix at ""the solution\n        doesn\342\200\231t have a full rank, then \342\200\230lm\342\200\231 method returns a matrix filled with\n        np.inf, on the other hand 'trf' and 'dogbox' methods use Moore-Penrose\n        pseudoinverse to compute the covariance matrix.\n        \n    Examples\n    --------\n    >>> from gofast.tools import erpSelector, scalePosition \n    >>> df = erpSelector('data/erp/l10_gbalo.xlsx') \n    >>> df.columns \n    ... Index(['station', 'resistivity', 'longitude', 'latitude', 'easting',\n           'northing'],\n          dtype='object')\n    >>> # correcting northing coordinates from easting data \n    >>> northing_corrected, popt, pcov = scalePosition(ydata =df.northing , \n                                               xdata = df.easting, show=True)\n    >>> len(df.northing.values) , len(northing_corrected)\n    ... (20, 20)\n    >>> popt  # by default popt =(slope:a ,intercept: b)\n    ...  array([1.01151734e+00, 2.93731377e+05])\n    >>> # corrected easting coordinates using the default x.\n    >>> easting_corrected, *_= scalePosition(ydata =df.easting , show=True)\n    >>> df.easting.values \n    ... array([790284, 790281, 790277, 790270, 790265, 790260, 790254, 790248,\n    ...       790243, 790237, 790231, 790224, 790218, 790211, 790206, 790200,\n    ...       790194, 790187, 790181, 790175], dtype=int64)\n    >>> easting_corrected\n    ... array([790288.18571705, 790282.30300999, 790276.42030293, 790270.53759587,\n    ...       790264.6548888 , 790258.77218174, 790252.88947468, 790247.00676762,\n    ...       790241.12406056, 790235.2413535 , 790229.35864644, 790223.47593938,\n    ...       790217.59323232, 790211.71052526, 790205.8278182 , 790199.94511114,\n    ...       790194.06240407, 790188.17969701, 790182.29698995, 790176.41428289])\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_89scalePosition = {"scalePosition", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_89scalePosition, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_88scalePosition};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_89scalePosition(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ydata = 0;
  PyObject *__pyx_v_xdata = 0;
  PyObject *__pyx_v_func = 0;
  PyObject *__pyx_v_c_order = 0;
  PyObject *__pyx_v_show = 0;
  PyObject *__pyx_v_kws = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scalePosition (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  __pyx_v_kws = PyDict_New(); if (unlikely(!__pyx_v_kws)) return NULL;
  __Pyx_GOTREF(__pyx_v_kws);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ydata,&__pyx_n_s_xdata,&__pyx_n_s_func,&__pyx_n_s_c_order,&__pyx_n_s_show,0};

    /* "gofast/tools/mathex.pyx":3599
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 *         xdata: Union[ArrayLike, Series] = None,             # <<<<<<<<<<<<<<
 *         func: Optional[_F] = None,
 *         c_order: Optional[Union[int, str]] = 0,
 */
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));

    /* "gofast/tools/mathex.pyx":3600
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 *         xdata: Union[ArrayLike, Series] = None,
 *         func: Optional[_F] = None,             # <<<<<<<<<<<<<<
 *         c_order: Optional[Union[int, str]] = 0,
 *         show: bool = False,
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_0)));

    /* "gofast/tools/mathex.pyx":3602
 *         func: Optional[_F] = None,
 *         c_order: Optional[Union[int, str]] = 0,
 *         show: bool = False,             # <<<<<<<<<<<<<<
 *         **kws):
 *     """ Correct data location or position and return new corrected location
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ydata)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3596, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_xdata);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3596, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_func);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3596, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_c_order);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3596, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_show);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3596, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kws, values + 0, kwd_pos_args, "scalePosition") < 0)) __PYX_ERR(0, 3596, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ydata = values[0];
    __pyx_v_xdata = values[1];
    __pyx_v_func = values[2];
    __pyx_v_c_order = values[3];
    __pyx_v_show = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("scalePosition", 0, 1, 5, __pyx_nargs); __PYX_ERR(0, 3596, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_DECREF(__pyx_v_kws); __pyx_v_kws = 0;
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_88scalePosition(__pyx_self, __pyx_v_ydata, __pyx_v_xdata, __pyx_v_func, __pyx_v_c_order, __pyx_v_show, __pyx_v_kws);

  /* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */

  /* function exit code */
  __Pyx_DECREF(__pyx_v_kws);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3677
 * 
 *     """
 *     def linfunc (x, a, b):             # <<<<<<<<<<<<<<
 *         """ Set the simple linear function"""
 *         return a * x + b
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13scalePosition_1linfunc(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_13scalePosition_linfunc, " Set the simple linear function");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_13scalePosition_1linfunc = {"linfunc", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_13scalePosition_1linfunc, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_13scalePosition_linfunc};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13scalePosition_1linfunc(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_a = 0;
  PyObject *__pyx_v_b = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("linfunc (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_a,&__pyx_n_s_b,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3677, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_a)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3677, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("linfunc", 1, 3, 3, 1); __PYX_ERR(0, 3677, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_b)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3677, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("linfunc", 1, 3, 3, 2); __PYX_ERR(0, 3677, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "linfunc") < 0)) __PYX_ERR(0, 3677, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_x = values[0];
    __pyx_v_a = values[1];
    __pyx_v_b = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("linfunc", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 3677, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition.linfunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_13scalePosition_linfunc(__pyx_self, __pyx_v_x, __pyx_v_a, __pyx_v_b);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_13scalePosition_linfunc(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("linfunc", 1);
  __Pyx_TraceCall("linfunc", __pyx_f[0], 3677, 0, __PYX_ERR(0, 3677, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":3679
 *     def linfunc (x, a, b):
 *         """ Set the simple linear function"""
 *         return a * x + b             # <<<<<<<<<<<<<<
 * 
 *     if str(func).lower() in ('none' , 'linear'):
 */
  __Pyx_TraceLine(3679,0,__PYX_ERR(0, 3679, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyNumber_Multiply(__pyx_v_a, __pyx_v_x); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyNumber_Add(__pyx_t_1, __pyx_v_b); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3679, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3677
 * 
 *     """
 *     def linfunc (x, a, b):             # <<<<<<<<<<<<<<
 *         """ Set the simple linear function"""
 *         return a * x + b
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition.linfunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3704
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(
 *                     lambda x :x.lower(), ydata.columns)):             # <<<<<<<<<<<<<<
 *                 raise ValueError (
 *                     f'c_order {c_order!r} not found in {list(ydata.columns)}'
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13scalePosition_2lambda4(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_13scalePosition_2lambda4 = {"lambda4", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_13scalePosition_2lambda4, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13scalePosition_2lambda4(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[1] = {0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lambda4 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3704, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda4") < 0)) __PYX_ERR(0, 3704, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_x = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lambda4", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 3704, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition.lambda4", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_lambda_funcdef_lambda4(__pyx_self, __pyx_v_x);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_lambda_funcdef_lambda4(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lambda4", 1);
  __Pyx_TraceCall("lambda4", __pyx_f[0], 3704, 0, __PYX_ERR(0, 3704, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_lower); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3704, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3704, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition.lambda4", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3710
 *                 # if c_order exists find the index and get the
 *                 # right column name
 *             ix_c = list(map( lambda x :x.lower(), ydata.columns)             # <<<<<<<<<<<<<<
 *                         ).index(c_order.lower())
 *             ydata = ydata.iloc [:, ix_c] # series
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13scalePosition_3lambda5(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_13scalePosition_3lambda5 = {"lambda5", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_13scalePosition_3lambda5, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_13scalePosition_3lambda5(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[1] = {0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("lambda5 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3710, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "lambda5") < 0)) __PYX_ERR(0, 3710, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 1)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
    }
    __pyx_v_x = values[0];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("lambda5", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 3710, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition.lambda5", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_lambda_funcdef_lambda5(__pyx_self, __pyx_v_x);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_lambda_funcdef_lambda5(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("lambda5", 1);
  __Pyx_TraceCall("lambda5", __pyx_f[0], 3710, 0, __PYX_ERR(0, 3710, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_lower); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3710, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3710, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition.lambda5", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_88scalePosition(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ydata, PyObject *__pyx_v_xdata, PyObject *__pyx_v_func, PyObject *__pyx_v_c_order, PyObject *__pyx_v_show, PyObject *__pyx_v_kws) {
  PyObject *__pyx_v_linfunc = 0;
  PyObject *__pyx_v_ix_c = NULL;
  PyObject *__pyx_v_popt = NULL;
  PyObject *__pyx_v_pcov = NULL;
  PyObject *__pyx_v_ydata_new = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  Py_ssize_t __pyx_t_14;
  Py_UCS4 __pyx_t_15;
  Py_ssize_t __pyx_t_16;
  PyObject *(*__pyx_t_17)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__98)
  __Pyx_RefNannySetupContext("scalePosition", 0);
  __Pyx_TraceCall("scalePosition", __pyx_f[0], 3596, 0, __PYX_ERR(0, 3596, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_ydata);
  __Pyx_INCREF(__pyx_v_xdata);
  __Pyx_INCREF(__pyx_v_func);
  __Pyx_INCREF(__pyx_v_c_order);

  /* "gofast/tools/mathex.pyx":3677
 * 
 *     """
 *     def linfunc (x, a, b):             # <<<<<<<<<<<<<<
 *         """ Set the simple linear function"""
 *         return a * x + b
 */
  __Pyx_TraceLine(3677,0,__PYX_ERR(0, 3677, __pyx_L1_error))
  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_13scalePosition_1linfunc, 0, __pyx_n_s_scalePosition_locals_linfunc, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__100)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3677, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_linfunc = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3681
 *         return a * x + b
 * 
 *     if str(func).lower() in ('none' , 'linear'):             # <<<<<<<<<<<<<<
 *         func = linfunc
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):
 */
  __Pyx_TraceLine(3681,0,__PYX_ERR(0, 3681, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_Str(__pyx_v_func); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3681, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_lower); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3681, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3681, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_none, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3681, __pyx_L1_error)
  if (!__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_linear, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3681, __pyx_L1_error)
  __pyx_t_5 = __pyx_t_6;
  __pyx_L4_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = __pyx_t_5;
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3682
 * 
 *     if str(func).lower() in ('none' , 'linear'):
 *         func = linfunc             # <<<<<<<<<<<<<<
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):
 *         raise TypeError(
 */
    __Pyx_TraceLine(3682,0,__PYX_ERR(0, 3682, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_linfunc);
    __Pyx_DECREF_SET(__pyx_v_func, __pyx_v_linfunc);

    /* "gofast/tools/mathex.pyx":3681
 *         return a * x + b
 * 
 *     if str(func).lower() in ('none' , 'linear'):             # <<<<<<<<<<<<<<
 *         func = linfunc
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":3683
 *     if str(func).lower() in ('none' , 'linear'):
 *         func = linfunc
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):             # <<<<<<<<<<<<<<
 *         raise TypeError(
 *             f'`func` argument is a callable not {type(func).__name__!r}')
 */
  __Pyx_TraceLine(3683,0,__PYX_ERR(0, 3683, __pyx_L1_error))
  __pyx_t_5 = __Pyx_HasAttr(__pyx_v_func, __pyx_n_u_call); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 3683, __pyx_L1_error)
  __pyx_t_7 = (!__pyx_t_5);
  if (!__pyx_t_7) {
  } else {
    __pyx_t_6 = __pyx_t_7;
    goto __pyx_L6_bool_binop_done;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_inspect); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_isfunction); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_func};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3683, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_7 < 0))) __PYX_ERR(0, 3683, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_5 = (!__pyx_t_7);
  __pyx_t_6 = __pyx_t_5;
  __pyx_L6_bool_binop_done:;
  if (unlikely(__pyx_t_6)) {

    /* "gofast/tools/mathex.pyx":3685
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):
 *         raise TypeError(
 *             f'`func` argument is a callable not {type(func).__name__!r}')             # <<<<<<<<<<<<<<
 * 
 *     ydata = _assert_all_types(ydata, list, tuple, np.ndarray,
 */
    __Pyx_TraceLine(3685,0,__PYX_ERR(0, 3685, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_func)), __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3685, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_1), __pyx_empty_unicode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3685, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyUnicode_Concat(__pyx_kp_u_func_argument_is_a_callable_not, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3685, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3684
 *         func = linfunc
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):
 *         raise TypeError(             # <<<<<<<<<<<<<<
 *             f'`func` argument is a callable not {type(func).__name__!r}')
 * 
 */
    __Pyx_TraceLine(3684,0,__PYX_ERR(0, 3684, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3684, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_ERR(0, 3684, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3683
 *     if str(func).lower() in ('none' , 'linear'):
 *         func = linfunc
 *     elif not hasattr(func, '__call__') or not inspect.isfunction (func):             # <<<<<<<<<<<<<<
 *         raise TypeError(
 *             f'`func` argument is a callable not {type(func).__name__!r}')
 */
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":3687
 *             f'`func` argument is a callable not {type(func).__name__!r}')
 * 
 *     ydata = _assert_all_types(ydata, list, tuple, np.ndarray,             # <<<<<<<<<<<<<<
 *                               pd.Series, pd.DataFrame  )
 *     c_order = _assert_all_types(c_order, int, float, str)
 */
  __Pyx_TraceLine(3687,0,__PYX_ERR(0, 3687, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_ndarray); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3688
 * 
 *     ydata = _assert_all_types(ydata, list, tuple, np.ndarray,
 *                               pd.Series, pd.DataFrame  )             # <<<<<<<<<<<<<<
 *     c_order = _assert_all_types(c_order, int, float, str)
 *     try : c_order = int(c_order)
 */
  __Pyx_TraceLine(3688,0,__PYX_ERR(0, 3688, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_pd); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_Series); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_pd); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[7] = {__pyx_t_3, __pyx_v_ydata, ((PyObject *)(&PyList_Type)), ((PyObject *)(&PyTuple_Type)), __pyx_t_8, __pyx_t_9, __pyx_t_10};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 6+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3687, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_ydata, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3689
 *     ydata = _assert_all_types(ydata, list, tuple, np.ndarray,
 *                               pd.Series, pd.DataFrame  )
 *     c_order = _assert_all_types(c_order, int, float, str)             # <<<<<<<<<<<<<<
 *     try : c_order = int(c_order)
 *     except: pass
 */
  __Pyx_TraceLine(3689,0,__PYX_ERR(0, 3689, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_10 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_10)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_10);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[5] = {__pyx_t_10, __pyx_v_c_order, ((PyObject *)(&PyInt_Type)), ((PyObject *)(&PyFloat_Type)), ((PyObject *)(&PyUnicode_Type))};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 4+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3689, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_c_order, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3690
 *                               pd.Series, pd.DataFrame  )
 *     c_order = _assert_all_types(c_order, int, float, str)
 *     try : c_order = int(c_order)             # <<<<<<<<<<<<<<
 *     except: pass
 * 
 */
  __Pyx_TraceLine(3690,0,__PYX_ERR(0, 3690, __pyx_L1_error))
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_11, &__pyx_t_12, &__pyx_t_13);
    __Pyx_XGOTREF(__pyx_t_11);
    __Pyx_XGOTREF(__pyx_t_12);
    __Pyx_XGOTREF(__pyx_t_13);
    /*try:*/ {
      __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_v_c_order); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3690, __pyx_L8_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF_SET(__pyx_v_c_order, __pyx_t_2);
      __pyx_t_2 = 0;
    }
    __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
    __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
    __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
    goto __pyx_L13_try_end;
    __pyx_L8_error:;
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":3691
 *     c_order = _assert_all_types(c_order, int, float, str)
 *     try : c_order = int(c_order)
 *     except: pass             # <<<<<<<<<<<<<<
 * 
 *     if isinstance(ydata, pd.DataFrame):
 */
    __Pyx_TraceLine(3691,0,__PYX_ERR(0, 3691, __pyx_L10_except_error))
    /*except:*/ {
      __Pyx_ErrRestore(0,0,0);
      goto __pyx_L9_exception_handled;
    }

    /* "gofast/tools/mathex.pyx":3690
 *                               pd.Series, pd.DataFrame  )
 *     c_order = _assert_all_types(c_order, int, float, str)
 *     try : c_order = int(c_order)             # <<<<<<<<<<<<<<
 *     except: pass
 * 
 */
    __pyx_L10_except_error:;
    __Pyx_XGIVEREF(__pyx_t_11);
    __Pyx_XGIVEREF(__pyx_t_12);
    __Pyx_XGIVEREF(__pyx_t_13);
    __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
    goto __pyx_L1_error;
    __pyx_L9_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_11);
    __Pyx_XGIVEREF(__pyx_t_12);
    __Pyx_XGIVEREF(__pyx_t_13);
    __Pyx_ExceptionReset(__pyx_t_11, __pyx_t_12, __pyx_t_13);
    __pyx_L13_try_end:;
  }

  /* "gofast/tools/mathex.pyx":3693
 *     except: pass
 * 
 *     if isinstance(ydata, pd.DataFrame):             # <<<<<<<<<<<<<<
 *         if c_order ==0:
 *             warnings.warn("The first column of the data should be considered"
 */
  __Pyx_TraceLine(3693,0,__PYX_ERR(0, 3693, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_pd); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3693, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3693, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_6 = PyObject_IsInstance(__pyx_v_ydata, __pyx_t_1); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 3693, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3694
 * 
 *     if isinstance(ydata, pd.DataFrame):
 *         if c_order ==0:             # <<<<<<<<<<<<<<
 *             warnings.warn("The first column of the data should be considered"
 *                           " as the `y` target.")
 */
    __Pyx_TraceLine(3694,0,__PYX_ERR(0, 3694, __pyx_L1_error))
    __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_c_order, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3694, __pyx_L1_error)
    if (__pyx_t_6) {

      /* "gofast/tools/mathex.pyx":3695
 *     if isinstance(ydata, pd.DataFrame):
 *         if c_order ==0:
 *             warnings.warn("The first column of the data should be considered"             # <<<<<<<<<<<<<<
 *                           " as the `y` target.")
 *         if c_order is None:
 */
      __Pyx_TraceLine(3695,0,__PYX_ERR(0, 3695, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_warnings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3695, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_warn); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3695, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_kp_u_The_first_column_of_the_data_sho};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3695, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

      /* "gofast/tools/mathex.pyx":3694
 * 
 *     if isinstance(ydata, pd.DataFrame):
 *         if c_order ==0:             # <<<<<<<<<<<<<<
 *             warnings.warn("The first column of the data should be considered"
 *                           " as the `y` target.")
 */
    }

    /* "gofast/tools/mathex.pyx":3697
 *             warnings.warn("The first column of the data should be considered"
 *                           " as the `y` target.")
 *         if c_order is None:             # <<<<<<<<<<<<<<
 *             raise TypeError('Dataframe is given. The `c_order` argument should '
 *                             'be defined for column selection. Use column name'
 */
    __Pyx_TraceLine(3697,0,__PYX_ERR(0, 3697, __pyx_L1_error))
    __pyx_t_6 = (__pyx_v_c_order == Py_None);
    if (unlikely(__pyx_t_6)) {

      /* "gofast/tools/mathex.pyx":3698
 *                           " as the `y` target.")
 *         if c_order is None:
 *             raise TypeError('Dataframe is given. The `c_order` argument should '             # <<<<<<<<<<<<<<
 *                             'be defined for column selection. Use column name'
 *                             ' instead')
 */
      __Pyx_TraceLine(3698,0,__PYX_ERR(0, 3698, __pyx_L1_error))
      __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__101, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3698, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __PYX_ERR(0, 3698, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":3697
 *             warnings.warn("The first column of the data should be considered"
 *                           " as the `y` target.")
 *         if c_order is None:             # <<<<<<<<<<<<<<
 *             raise TypeError('Dataframe is given. The `c_order` argument should '
 *                             'be defined for column selection. Use column name'
 */
    }

    /* "gofast/tools/mathex.pyx":3701
 *                             'be defined for column selection. Use column name'
 *                             ' instead')
 *         if isinstance(c_order, str):             # <<<<<<<<<<<<<<
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(
 */
    __Pyx_TraceLine(3701,0,__PYX_ERR(0, 3701, __pyx_L1_error))
    __pyx_t_6 = PyUnicode_Check(__pyx_v_c_order); 
    if (__pyx_t_6) {

      /* "gofast/tools/mathex.pyx":3703
 *         if isinstance(c_order, str):
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(             # <<<<<<<<<<<<<<
 *                     lambda x :x.lower(), ydata.columns)):
 *                 raise ValueError (
 */
      __Pyx_TraceLine(3703,0,__PYX_ERR(0, 3703, __pyx_L1_error))
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_c_order, __pyx_n_s_lower); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3703, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_2 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
        __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3703, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }

      /* "gofast/tools/mathex.pyx":3704
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(
 *                     lambda x :x.lower(), ydata.columns)):             # <<<<<<<<<<<<<<
 *                 raise ValueError (
 *                     f'c_order {c_order!r} not found in {list(ydata.columns)}'
 */
      __Pyx_TraceLine(3704,0,__PYX_ERR(0, 3704, __pyx_L1_error))
      __pyx_t_10 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_13scalePosition_2lambda4, 0, __pyx_n_s_scalePosition_locals_lambda, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3704, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_columns); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3704, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);

      /* "gofast/tools/mathex.pyx":3703
 *         if isinstance(c_order, str):
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(             # <<<<<<<<<<<<<<
 *                     lambda x :x.lower(), ydata.columns)):
 *                 raise ValueError (
 */
      __Pyx_TraceLine(3703,0,__PYX_ERR(0, 3703, __pyx_L1_error))
      __pyx_t_9 = PyTuple_New(2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3703, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_10);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_10)) __PYX_ERR(0, 3703, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_2);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_2)) __PYX_ERR(0, 3703, __pyx_L1_error);
      __pyx_t_10 = 0;
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3703, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = __Pyx_PySequence_ListKeepNew(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3703, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_6 = (__Pyx_PySequence_ContainsTF(__pyx_t_1, __pyx_t_9, Py_NE)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3703, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      if (unlikely(__pyx_t_6)) {

        /* "gofast/tools/mathex.pyx":3706
 *                     lambda x :x.lower(), ydata.columns)):
 *                 raise ValueError (
 *                     f'c_order {c_order!r} not found in {list(ydata.columns)}'             # <<<<<<<<<<<<<<
 *                     ' Use the index instead.')
 *                 # if c_order exists find the index and get the
 */
        __Pyx_TraceLine(3706,0,__PYX_ERR(0, 3706, __pyx_L1_error))
        __pyx_t_9 = PyTuple_New(5); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __pyx_t_14 = 0;
        __pyx_t_15 = 127;
        __Pyx_INCREF(__pyx_kp_u_c_order_2);
        __pyx_t_14 += 8;
        __Pyx_GIVEREF(__pyx_kp_u_c_order_2);
        PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_kp_u_c_order_2);
        __pyx_t_1 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_c_order), __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_15 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_15) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_15;
        __pyx_t_14 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_9, 1, __pyx_t_1);
        __pyx_t_1 = 0;
        __Pyx_INCREF(__pyx_kp_u_not_found_in);
        __pyx_t_14 += 14;
        __Pyx_GIVEREF(__pyx_kp_u_not_found_in);
        PyTuple_SET_ITEM(__pyx_t_9, 2, __pyx_kp_u_not_found_in);
        __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_columns); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_2 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __pyx_t_15 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_15) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_15;
        __pyx_t_14 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_9, 3, __pyx_t_1);
        __pyx_t_1 = 0;
        __Pyx_INCREF(__pyx_kp_u_Use_the_index_instead);
        __pyx_t_14 += 23;
        __Pyx_GIVEREF(__pyx_kp_u_Use_the_index_instead);
        PyTuple_SET_ITEM(__pyx_t_9, 4, __pyx_kp_u_Use_the_index_instead);
        __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_9, 5, __pyx_t_14, __pyx_t_15); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3706, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

        /* "gofast/tools/mathex.pyx":3705
 *             if c_order.lower() not in list(map(
 *                     lambda x :x.lower(), ydata.columns)):
 *                 raise ValueError (             # <<<<<<<<<<<<<<
 *                     f'c_order {c_order!r} not found in {list(ydata.columns)}'
 *                     ' Use the index instead.')
 */
        __Pyx_TraceLine(3705,0,__PYX_ERR(0, 3705, __pyx_L1_error))
        __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3705, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_Raise(__pyx_t_9, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __PYX_ERR(0, 3705, __pyx_L1_error)

        /* "gofast/tools/mathex.pyx":3703
 *         if isinstance(c_order, str):
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(             # <<<<<<<<<<<<<<
 *                     lambda x :x.lower(), ydata.columns)):
 *                 raise ValueError (
 */
      }

      /* "gofast/tools/mathex.pyx":3710
 *                 # if c_order exists find the index and get the
 *                 # right column name
 *             ix_c = list(map( lambda x :x.lower(), ydata.columns)             # <<<<<<<<<<<<<<
 *                         ).index(c_order.lower())
 *             ydata = ydata.iloc [:, ix_c] # series
 */
      __Pyx_TraceLine(3710,0,__PYX_ERR(0, 3710, __pyx_L1_error))
      __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_13scalePosition_3lambda5, 0, __pyx_n_s_scalePosition_locals_lambda, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3710, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_columns); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3710, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3710, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_GIVEREF(__pyx_t_1);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_1)) __PYX_ERR(0, 3710, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_2);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_2)) __PYX_ERR(0, 3710, __pyx_L1_error);
      __pyx_t_1 = 0;
      __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_map, __pyx_t_10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3710, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = __Pyx_PySequence_ListKeepNew(__pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3710, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":3711
 *                 # right column name
 *             ix_c = list(map( lambda x :x.lower(), ydata.columns)
 *                         ).index(c_order.lower())             # <<<<<<<<<<<<<<
 *             ydata = ydata.iloc [:, ix_c] # series
 *         elif isinstance (c_order, (int, float)):
 */
      __Pyx_TraceLine(3711,0,__PYX_ERR(0, 3711, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3711, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_c_order, __pyx_n_s_lower); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3711, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_8 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_1))) {
        __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
        if (likely(__pyx_t_8)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
          __Pyx_INCREF(__pyx_t_8);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_1, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_8, NULL};
        __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      }
      __pyx_t_1 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_1)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_1);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_10};
        __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3711, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __pyx_v_ix_c = __pyx_t_9;
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":3712
 *             ix_c = list(map( lambda x :x.lower(), ydata.columns)
 *                         ).index(c_order.lower())
 *             ydata = ydata.iloc [:, ix_c] # series             # <<<<<<<<<<<<<<
 *         elif isinstance (c_order, (int, float)):
 *             c_order =int(c_order)
 */
      __Pyx_TraceLine(3712,0,__PYX_ERR(0, 3712, __pyx_L1_error))
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_iloc); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3712, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3712, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_slice__9)) __PYX_ERR(0, 3712, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_ix_c);
      __Pyx_GIVEREF(__pyx_v_ix_c);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_ix_c)) __PYX_ERR(0, 3712, __pyx_L1_error);
      __pyx_t_10 = __Pyx_PyObject_GetItem(__pyx_t_9, __pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3712, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF_SET(__pyx_v_ydata, __pyx_t_10);
      __pyx_t_10 = 0;

      /* "gofast/tools/mathex.pyx":3701
 *                             'be defined for column selection. Use column name'
 *                             ' instead')
 *         if isinstance(c_order, str):             # <<<<<<<<<<<<<<
 *             # check whether the value is on the column name
 *             if c_order.lower() not in list(map(
 */
      goto __pyx_L17;
    }

    /* "gofast/tools/mathex.pyx":3713
 *                         ).index(c_order.lower())
 *             ydata = ydata.iloc [:, ix_c] # series
 *         elif isinstance (c_order, (int, float)):             # <<<<<<<<<<<<<<
 *             c_order =int(c_order)
 *             if c_order >= len(ydata.columns):
 */
    __Pyx_TraceLine(3713,0,__PYX_ERR(0, 3713, __pyx_L1_error))
    __pyx_t_5 = PyInt_Check(__pyx_v_c_order); 
    if (!__pyx_t_5) {
    } else {
      __pyx_t_6 = __pyx_t_5;
      goto __pyx_L19_bool_binop_done;
    }
    __pyx_t_5 = PyFloat_Check(__pyx_v_c_order); 
    __pyx_t_6 = __pyx_t_5;
    __pyx_L19_bool_binop_done:;
    if (__pyx_t_6) {

      /* "gofast/tools/mathex.pyx":3714
 *             ydata = ydata.iloc [:, ix_c] # series
 *         elif isinstance (c_order, (int, float)):
 *             c_order =int(c_order)             # <<<<<<<<<<<<<<
 *             if c_order >= len(ydata.columns):
 *                 raise ValueError(
 */
      __Pyx_TraceLine(3714,0,__PYX_ERR(0, 3714, __pyx_L1_error))
      __pyx_t_10 = __Pyx_PyNumber_Int(__pyx_v_c_order); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3714, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF_SET(__pyx_v_c_order, __pyx_t_10);
      __pyx_t_10 = 0;

      /* "gofast/tools/mathex.pyx":3715
 *         elif isinstance (c_order, (int, float)):
 *             c_order =int(c_order)
 *             if c_order >= len(ydata.columns):             # <<<<<<<<<<<<<<
 *                 raise ValueError(
 *                     f"`c_order`'{c_order}' should be less than the number of "
 */
      __Pyx_TraceLine(3715,0,__PYX_ERR(0, 3715, __pyx_L1_error))
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_columns); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3715, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_14 = PyObject_Length(__pyx_t_10); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3715, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_14); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3715, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_2 = PyObject_RichCompare(__pyx_v_c_order, __pyx_t_10, Py_GE); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3715, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3715, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(__pyx_t_6)) {

        /* "gofast/tools/mathex.pyx":3717
 *             if c_order >= len(ydata.columns):
 *                 raise ValueError(
 *                     f"`c_order`'{c_order}' should be less than the number of "             # <<<<<<<<<<<<<<
 *                     f"given columns '{len(ydata.columns)}'. Use column name instead.")
 *             ydata= ydata.iloc[:, c_order]
 */
        __Pyx_TraceLine(3717,0,__PYX_ERR(0, 3717, __pyx_L1_error))
        __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3717, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __pyx_t_14 = 0;
        __pyx_t_15 = 127;
        __Pyx_INCREF(__pyx_kp_u_c_order_3);
        __pyx_t_14 += 10;
        __Pyx_GIVEREF(__pyx_kp_u_c_order_3);
        PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_c_order_3);
        __pyx_t_10 = __Pyx_PyObject_FormatSimple(__pyx_v_c_order, __pyx_empty_unicode); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3717, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_15 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_10) > __pyx_t_15) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_10) : __pyx_t_15;
        __pyx_t_14 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_10);
        __pyx_t_10 = 0;
        __Pyx_INCREF(__pyx_kp_u_should_be_less_than_the_number);
        __pyx_t_14 += 51;
        __Pyx_GIVEREF(__pyx_kp_u_should_be_less_than_the_number);
        PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_should_be_less_than_the_number);

        /* "gofast/tools/mathex.pyx":3718
 *                 raise ValueError(
 *                     f"`c_order`'{c_order}' should be less than the number of "
 *                     f"given columns '{len(ydata.columns)}'. Use column name instead.")             # <<<<<<<<<<<<<<
 *             ydata= ydata.iloc[:, c_order]
 * 
 */
        __Pyx_TraceLine(3718,0,__PYX_ERR(0, 3718, __pyx_L1_error))
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_columns); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3718, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_16 = PyObject_Length(__pyx_t_10); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3718, __pyx_L1_error)
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_t_16, 0, ' ', 'd'); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3718, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_14 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_2, 3, __pyx_t_10);
        __pyx_t_10 = 0;
        __Pyx_INCREF(__pyx_kp_u_Use_column_name_instead);
        __pyx_t_14 += 27;
        __Pyx_GIVEREF(__pyx_kp_u_Use_column_name_instead);
        PyTuple_SET_ITEM(__pyx_t_2, 4, __pyx_kp_u_Use_column_name_instead);

        /* "gofast/tools/mathex.pyx":3717
 *             if c_order >= len(ydata.columns):
 *                 raise ValueError(
 *                     f"`c_order`'{c_order}' should be less than the number of "             # <<<<<<<<<<<<<<
 *                     f"given columns '{len(ydata.columns)}'. Use column name instead.")
 *             ydata= ydata.iloc[:, c_order]
 */
        __Pyx_TraceLine(3717,0,__PYX_ERR(0, 3717, __pyx_L1_error))
        __pyx_t_10 = __Pyx_PyUnicode_Join(__pyx_t_2, 5, __pyx_t_14, __pyx_t_15); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3717, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

        /* "gofast/tools/mathex.pyx":3716
 *             c_order =int(c_order)
 *             if c_order >= len(ydata.columns):
 *                 raise ValueError(             # <<<<<<<<<<<<<<
 *                     f"`c_order`'{c_order}' should be less than the number of "
 *                     f"given columns '{len(ydata.columns)}'. Use column name instead.")
 */
        __Pyx_TraceLine(3716,0,__PYX_ERR(0, 3716, __pyx_L1_error))
        __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3716, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_Raise(__pyx_t_2, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __PYX_ERR(0, 3716, __pyx_L1_error)

        /* "gofast/tools/mathex.pyx":3715
 *         elif isinstance (c_order, (int, float)):
 *             c_order =int(c_order)
 *             if c_order >= len(ydata.columns):             # <<<<<<<<<<<<<<
 *                 raise ValueError(
 *                     f"`c_order`'{c_order}' should be less than the number of "
 */
      }

      /* "gofast/tools/mathex.pyx":3719
 *                     f"`c_order`'{c_order}' should be less than the number of "
 *                     f"given columns '{len(ydata.columns)}'. Use column name instead.")
 *             ydata= ydata.iloc[:, c_order]             # <<<<<<<<<<<<<<
 * 
 *     ydata = check_y (np.array(ydata)  , input_name= "ydata")
 */
      __Pyx_TraceLine(3719,0,__PYX_ERR(0, 3719, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ydata, __pyx_n_s_iloc); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3719, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3719, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_INCREF(__pyx_slice__9);
      __Pyx_GIVEREF(__pyx_slice__9);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_slice__9)) __PYX_ERR(0, 3719, __pyx_L1_error);
      __Pyx_INCREF(__pyx_v_c_order);
      __Pyx_GIVEREF(__pyx_v_c_order);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_c_order)) __PYX_ERR(0, 3719, __pyx_L1_error);
      __pyx_t_9 = __Pyx_PyObject_GetItem(__pyx_t_2, __pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3719, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF_SET(__pyx_v_ydata, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":3713
 *                         ).index(c_order.lower())
 *             ydata = ydata.iloc [:, ix_c] # series
 *         elif isinstance (c_order, (int, float)):             # <<<<<<<<<<<<<<
 *             c_order =int(c_order)
 *             if c_order >= len(ydata.columns):
 */
    }
    __pyx_L17:;

    /* "gofast/tools/mathex.pyx":3693
 *     except: pass
 * 
 *     if isinstance(ydata, pd.DataFrame):             # <<<<<<<<<<<<<<
 *         if c_order ==0:
 *             warnings.warn("The first column of the data should be considered"
 */
  }

  /* "gofast/tools/mathex.pyx":3721
 *             ydata= ydata.iloc[:, c_order]
 * 
 *     ydata = check_y (np.array(ydata)  , input_name= "ydata")             # <<<<<<<<<<<<<<
 * 
 *     if xdata is None:
 */
  __Pyx_TraceLine(3721,0,__PYX_ERR(0, 3721, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_check_y); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3721, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3721, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3721, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_ydata};
    __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3721, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3721, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_10);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10)) __PYX_ERR(0, 3721, __pyx_L1_error);
  __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3721, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_input_name, __pyx_n_u_ydata) < 0) __PYX_ERR(0, 3721, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3721, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF_SET(__pyx_v_ydata, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3723
 *     ydata = check_y (np.array(ydata)  , input_name= "ydata")
 * 
 *     if xdata is None:             # <<<<<<<<<<<<<<
 *         xdata = np.linspace(0, 4, len(ydata))
 * 
 */
  __Pyx_TraceLine(3723,0,__PYX_ERR(0, 3723, __pyx_L1_error))
  __pyx_t_6 = (__pyx_v_xdata == Py_None);
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3724
 * 
 *     if xdata is None:
 *         xdata = np.linspace(0, 4, len(ydata))             # <<<<<<<<<<<<<<
 * 
 *     xdata = check_y (xdata , input_name= "Xdata")
 */
    __Pyx_TraceLine(3724,0,__PYX_ERR(0, 3724, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3724, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_linspace); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3724, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_14 = PyObject_Length(__pyx_v_ydata); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3724, __pyx_L1_error)
    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_14); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3724, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_9 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[4] = {__pyx_t_9, __pyx_int_0, __pyx_int_4, __pyx_t_10};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 3+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3724, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_xdata, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3723
 *     ydata = check_y (np.array(ydata)  , input_name= "ydata")
 * 
 *     if xdata is None:             # <<<<<<<<<<<<<<
 *         xdata = np.linspace(0, 4, len(ydata))
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":3726
 *         xdata = np.linspace(0, 4, len(ydata))
 * 
 *     xdata = check_y (xdata , input_name= "Xdata")             # <<<<<<<<<<<<<<
 * 
 *     if len(xdata) != len(ydata):
 */
  __Pyx_TraceLine(3726,0,__PYX_ERR(0, 3726, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_check_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3726, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3726, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_xdata);
  __Pyx_GIVEREF(__pyx_v_xdata);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_xdata)) __PYX_ERR(0, 3726, __pyx_L1_error);
  __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3726, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_input_name, __pyx_n_u_Xdata) < 0) __PYX_ERR(0, 3726, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3726, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF_SET(__pyx_v_xdata, __pyx_t_9);
  __pyx_t_9 = 0;

  /* "gofast/tools/mathex.pyx":3728
 *     xdata = check_y (xdata , input_name= "Xdata")
 * 
 *     if len(xdata) != len(ydata):             # <<<<<<<<<<<<<<
 *         raise ValueError(" `x` and `y` arrays must have the same length."
 *                         "'{len(xdata)}' and '{len(ydata)}' are given.")
 */
  __Pyx_TraceLine(3728,0,__PYX_ERR(0, 3728, __pyx_L1_error))
  __pyx_t_14 = PyObject_Length(__pyx_v_xdata); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3728, __pyx_L1_error)
  __pyx_t_16 = PyObject_Length(__pyx_v_ydata); if (unlikely(__pyx_t_16 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3728, __pyx_L1_error)
  __pyx_t_6 = (__pyx_t_14 != __pyx_t_16);
  if (unlikely(__pyx_t_6)) {

    /* "gofast/tools/mathex.pyx":3729
 * 
 *     if len(xdata) != len(ydata):
 *         raise ValueError(" `x` and `y` arrays must have the same length."             # <<<<<<<<<<<<<<
 *                         "'{len(xdata)}' and '{len(ydata)}' are given.")
 * 
 */
    __Pyx_TraceLine(3729,0,__PYX_ERR(0, 3729, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__102, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3729, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_Raise(__pyx_t_9, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __PYX_ERR(0, 3729, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3728
 *     xdata = check_y (xdata , input_name= "Xdata")
 * 
 *     if len(xdata) != len(ydata):             # <<<<<<<<<<<<<<
 *         raise ValueError(" `x` and `y` arrays must have the same length."
 *                         "'{len(xdata)}' and '{len(ydata)}' are given.")
 */
  }

  /* "gofast/tools/mathex.pyx":3732
 *                         "'{len(xdata)}' and '{len(ydata)}' are given.")
 * 
 *     popt, pcov = curve_fit(func, xdata, ydata, **kws)             # <<<<<<<<<<<<<<
 *     ydata_new = func(xdata, *popt)
 * 
 */
  __Pyx_TraceLine(3732,0,__PYX_ERR(0, 3732, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_curve_fit); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_INCREF(__pyx_v_func);
  __Pyx_GIVEREF(__pyx_v_func);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_func)) __PYX_ERR(0, 3732, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_xdata);
  __Pyx_GIVEREF(__pyx_v_xdata);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_xdata)) __PYX_ERR(0, 3732, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_ydata);
  __Pyx_GIVEREF(__pyx_v_ydata);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_v_ydata)) __PYX_ERR(0, 3732, __pyx_L1_error);
  __pyx_t_1 = PyDict_Copy(__pyx_v_kws); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_9, __pyx_t_10, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3732, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
    PyObject* sequence = __pyx_t_2;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 3732, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_10 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_10 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_10);
    #else
    __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3732, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3732, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    #endif
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_9 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3732, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_17 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_9);
    index = 0; __pyx_t_1 = __pyx_t_17(__pyx_t_9); if (unlikely(!__pyx_t_1)) goto __pyx_L24_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_1);
    index = 1; __pyx_t_10 = __pyx_t_17(__pyx_t_9); if (unlikely(!__pyx_t_10)) goto __pyx_L24_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_10);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_17(__pyx_t_9), 2) < 0) __PYX_ERR(0, 3732, __pyx_L1_error)
    __pyx_t_17 = NULL;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    goto __pyx_L25_unpacking_done;
    __pyx_L24_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_17 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 3732, __pyx_L1_error)
    __pyx_L25_unpacking_done:;
  }
  __pyx_v_popt = __pyx_t_1;
  __pyx_t_1 = 0;
  __pyx_v_pcov = __pyx_t_10;
  __pyx_t_10 = 0;

  /* "gofast/tools/mathex.pyx":3733
 * 
 *     popt, pcov = curve_fit(func, xdata, ydata, **kws)
 *     ydata_new = func(xdata, *popt)             # <<<<<<<<<<<<<<
 * 
 *     if show:
 */
  __Pyx_TraceLine(3733,0,__PYX_ERR(0, 3733, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3733, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_xdata);
  __Pyx_GIVEREF(__pyx_v_xdata);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_xdata)) __PYX_ERR(0, 3733, __pyx_L1_error);
  __pyx_t_10 = __Pyx_PySequence_Tuple(__pyx_v_popt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3733, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __pyx_t_1 = PyNumber_Add(__pyx_t_2, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3733, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_v_func, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3733, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ydata_new = __pyx_t_10;
  __pyx_t_10 = 0;

  /* "gofast/tools/mathex.pyx":3735
 *     ydata_new = func(xdata, *popt)
 * 
 *     if show:             # <<<<<<<<<<<<<<
 *         plt.plot(xdata, ydata, 'b-', label='data')
 *         plt.plot(xdata, func(xdata, *popt), 'r-',
 */
  __Pyx_TraceLine(3735,0,__PYX_ERR(0, 3735, __pyx_L1_error))
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_show); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3735, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3736
 * 
 *     if show:
 *         plt.plot(xdata, ydata, 'b-', label='data')             # <<<<<<<<<<<<<<
 *         plt.plot(xdata, func(xdata, *popt), 'r-',
 *              label='fit: a=%5.3f, b=%5.3f' % tuple(popt))
 */
    __Pyx_TraceLine(3736,0,__PYX_ERR(0, 3736, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_plt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3736, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_plot); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3736, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = PyTuple_New(3); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3736, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_v_xdata);
    __Pyx_GIVEREF(__pyx_v_xdata);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_xdata)) __PYX_ERR(0, 3736, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_ydata);
    __Pyx_GIVEREF(__pyx_v_ydata);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_v_ydata)) __PYX_ERR(0, 3736, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_b_2);
    __Pyx_GIVEREF(__pyx_kp_u_b_2);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_kp_u_b_2)) __PYX_ERR(0, 3736, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3736, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_label, __pyx_n_u_data) < 0) __PYX_ERR(0, 3736, __pyx_L1_error)
    __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_10, __pyx_t_2); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3736, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":3737
 *     if show:
 *         plt.plot(xdata, ydata, 'b-', label='data')
 *         plt.plot(xdata, func(xdata, *popt), 'r-',             # <<<<<<<<<<<<<<
 *              label='fit: a=%5.3f, b=%5.3f' % tuple(popt))
 *         plt.xlabel('x')
 */
    __Pyx_TraceLine(3737,0,__PYX_ERR(0, 3737, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_plt); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_plot); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_v_xdata);
    __Pyx_GIVEREF(__pyx_v_xdata);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_xdata)) __PYX_ERR(0, 3737, __pyx_L1_error);
    __pyx_t_10 = __Pyx_PySequence_Tuple(__pyx_v_popt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_1 = PyNumber_Add(__pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_v_func, __pyx_t_1, NULL); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_xdata);
    __Pyx_GIVEREF(__pyx_v_xdata);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_xdata)) __PYX_ERR(0, 3737, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_10);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_10)) __PYX_ERR(0, 3737, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_r);
    __Pyx_GIVEREF(__pyx_kp_u_r);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_r)) __PYX_ERR(0, 3737, __pyx_L1_error);
    __pyx_t_10 = 0;

    /* "gofast/tools/mathex.pyx":3738
 *         plt.plot(xdata, ydata, 'b-', label='data')
 *         plt.plot(xdata, func(xdata, *popt), 'r-',
 *              label='fit: a=%5.3f, b=%5.3f' % tuple(popt))             # <<<<<<<<<<<<<<
 *         plt.xlabel('x')
 *         plt.ylabel('y')
 */
    __Pyx_TraceLine(3738,0,__PYX_ERR(0, 3738, __pyx_L1_error))
    __pyx_t_10 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3738, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_9 = __Pyx_PySequence_Tuple(__pyx_v_popt); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3738, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_8 = PyUnicode_Format(__pyx_kp_u_fit_a_5_3f_b_5_3f, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3738, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (PyDict_SetItem(__pyx_t_10, __pyx_n_s_label, __pyx_t_8) < 0) __PYX_ERR(0, 3738, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3737
 *     if show:
 *         plt.plot(xdata, ydata, 'b-', label='data')
 *         plt.plot(xdata, func(xdata, *popt), 'r-',             # <<<<<<<<<<<<<<
 *              label='fit: a=%5.3f, b=%5.3f' % tuple(popt))
 *         plt.xlabel('x')
 */
    __Pyx_TraceLine(3737,0,__PYX_ERR(0, 3737, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_10); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3737, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3739
 *         plt.plot(xdata, func(xdata, *popt), 'r-',
 *              label='fit: a=%5.3f, b=%5.3f' % tuple(popt))
 *         plt.xlabel('x')             # <<<<<<<<<<<<<<
 *         plt.ylabel('y')
 *         plt.legend()
 */
    __Pyx_TraceLine(3739,0,__PYX_ERR(0, 3739, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_plt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3739, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_xlabel); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3739, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_n_u_x};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3739, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3740
 *              label='fit: a=%5.3f, b=%5.3f' % tuple(popt))
 *         plt.xlabel('x')
 *         plt.ylabel('y')             # <<<<<<<<<<<<<<
 *         plt.legend()
 *         plt.show()
 */
    __Pyx_TraceLine(3740,0,__PYX_ERR(0, 3740, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_plt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3740, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ylabel); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3740, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_n_u_y};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3740, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3741
 *         plt.xlabel('x')
 *         plt.ylabel('y')
 *         plt.legend()             # <<<<<<<<<<<<<<
 *         plt.show()
 * 
 */
    __Pyx_TraceLine(3741,0,__PYX_ERR(0, 3741, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_plt); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3741, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_legend); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3741, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, NULL};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3741, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3742
 *         plt.ylabel('y')
 *         plt.legend()
 *         plt.show()             # <<<<<<<<<<<<<<
 * 
 *     return ydata_new, popt, pcov
 */
    __Pyx_TraceLine(3742,0,__PYX_ERR(0, 3742, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_plt); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3742, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_show); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3742, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3742, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3735
 *     ydata_new = func(xdata, *popt)
 * 
 *     if show:             # <<<<<<<<<<<<<<
 *         plt.plot(xdata, ydata, 'b-', label='data')
 *         plt.plot(xdata, func(xdata, *popt), 'r-',
 */
  }

  /* "gofast/tools/mathex.pyx":3744
 *         plt.show()
 * 
 *     return ydata_new, popt, pcov             # <<<<<<<<<<<<<<
 * 
 * def detect_station_position (
 */
  __Pyx_TraceLine(3744,0,__PYX_ERR(0, 3744, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3744, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_INCREF(__pyx_v_ydata_new);
  __Pyx_GIVEREF(__pyx_v_ydata_new);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_ydata_new)) __PYX_ERR(0, 3744, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_popt);
  __Pyx_GIVEREF(__pyx_v_popt);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_popt)) __PYX_ERR(0, 3744, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_pcov);
  __Pyx_GIVEREF(__pyx_v_pcov);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_v_pcov)) __PYX_ERR(0, 3744, __pyx_L1_error);
  __pyx_r = __pyx_t_8;
  __pyx_t_8 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex.scalePosition", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_linfunc);
  __Pyx_XDECREF(__pyx_v_ix_c);
  __Pyx_XDECREF(__pyx_v_popt);
  __Pyx_XDECREF(__pyx_v_pcov);
  __Pyx_XDECREF(__pyx_v_ydata_new);
  __Pyx_XDECREF(__pyx_v_ydata);
  __Pyx_XDECREF(__pyx_v_xdata);
  __Pyx_XDECREF(__pyx_v_func);
  __Pyx_XDECREF(__pyx_v_c_order);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3746
 *     return ydata_new, popt, pcov
 * 
 * def detect_station_position (             # <<<<<<<<<<<<<<
 *         s : Union[str, int] ,
 *         p: _SP,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_91detect_station_position(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_90detect_station_position, " Detect station position and return the index in positions\n    \n    :param s: str, int - Station location  in the position array. It should \n        be the positionning of the drilling location. If the value given\n        is type string. It should be match the exact position to \n        locate the drilling. Otherwise, if the value given is in float or \n        integer type, it should be match the index of the position array. \n         \n    :param p: Array-like - Should be the  conductive zone as array of \n        station location values. \n            \n    :returns: \n        - `s_index`- the position index location in the conductive zone.  \n        - `s`- the station position in distance. \n        \n    :Example: \n        \n        >>> import numpy as np \n        >>> from gofast.tools.mathex  import detect_station_position \n        >>> pos = np.arange(0 , 50 , 10 )\n        >>> detect_station_position (s ='S30', p = pos)\n        ... (3, 30.0)\n        >>> detect_station_position (s ='40', p = pos)\n        ... (4, 40.0)\n        >>> detect_station_position (s =2, p = pos)\n        ... (2, 20)\n        >>> detect_station_position (s ='sta200', p = pos)\n        ... WATexError_station: Station sta200             is out of the range; max position = 40\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_91detect_station_position = {"detect_station_position", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_91detect_station_position, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_90detect_station_position};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_91detect_station_position(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_s = 0;
  PyObject *__pyx_v_p = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("detect_station_position (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_s,&__pyx_n_s_p,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3746, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_p)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3746, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("detect_station_position", 1, 2, 2, 1); __PYX_ERR(0, 3746, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "detect_station_position") < 0)) __PYX_ERR(0, 3746, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_s = values[0];
    __pyx_v_p = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("detect_station_position", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 3746, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.detect_station_position", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_90detect_station_position(__pyx_self, __pyx_v_s, __pyx_v_p);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_90detect_station_position(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_s, PyObject *__pyx_v_p) {
  PyObject *__pyx_v_S = NULL;
  PyObject *__pyx_v_dl = NULL;
  PyObject *__pyx_v_s_index = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  Py_ssize_t __pyx_t_11;
  int __pyx_t_12;
  Py_UCS4 __pyx_t_13;
  Py_ssize_t __pyx_t_14;
  PyObject *(*__pyx_t_15)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__103)
  __Pyx_RefNannySetupContext("detect_station_position", 0);
  __Pyx_TraceCall("detect_station_position", __pyx_f[0], 3746, 0, __PYX_ERR(0, 3746, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_s);
  __Pyx_INCREF(__pyx_v_p);

  /* "gofast/tools/mathex.pyx":3780
 *             is out of the range; max position = 40
 *     """
 *     s = _assert_all_types( s, float, int, str)             # <<<<<<<<<<<<<<
 * 
 *     p = check_y (p, input_name ="Position array 'p'", to_frame =True )
 */
  __Pyx_TraceLine(3780,0,__PYX_ERR(0, 3780, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3780, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[5] = {__pyx_t_3, __pyx_v_s, ((PyObject *)(&PyFloat_Type)), ((PyObject *)(&PyInt_Type)), ((PyObject *)(&PyUnicode_Type))};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 4+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3780, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_s, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3782
 *     s = _assert_all_types( s, float, int, str)
 * 
 *     p = check_y (p, input_name ="Position array 'p'", to_frame =True )             # <<<<<<<<<<<<<<
 * 
 *     S=copy.deepcopy(s)
 */
  __Pyx_TraceLine(3782,0,__PYX_ERR(0, 3782, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_check_y); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_p);
  __Pyx_GIVEREF(__pyx_v_p);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_p)) __PYX_ERR(0, 3782, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_input_name, __pyx_kp_u_Position_array_p) < 0) __PYX_ERR(0, 3782, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_to_frame, Py_True) < 0) __PYX_ERR(0, 3782, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3782, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_p, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":3784
 *     p = check_y (p, input_name ="Position array 'p'", to_frame =True )
 * 
 *     S=copy.deepcopy(s)             # <<<<<<<<<<<<<<
 *     if isinstance(s, str):
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 */
  __Pyx_TraceLine(3784,0,__PYX_ERR(0, 3784, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_copy); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3784, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3784, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_s};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3784, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_S = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":3785
 * 
 *     S=copy.deepcopy(s)
 *     if isinstance(s, str):             # <<<<<<<<<<<<<<
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 *         try :
 */
  __Pyx_TraceLine(3785,0,__PYX_ERR(0, 3785, __pyx_L1_error))
  __pyx_t_6 = PyUnicode_Check(__pyx_v_s); 
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3786
 *     S=copy.deepcopy(s)
 *     if isinstance(s, str):
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')             # <<<<<<<<<<<<<<
 *         try :
 *             s=int(s)
 */
    __Pyx_TraceLine(3786,0,__PYX_ERR(0, 3786, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_s, __pyx_n_s_lower); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
      __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3786, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_replace); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__104, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_replace); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__105, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_replace); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_tuple__106, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3786, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_s, __pyx_t_5);
    __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":3787
 *     if isinstance(s, str):
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 *         try :             # <<<<<<<<<<<<<<
 *             s=int(s)
 *         except :
 */
    __Pyx_TraceLine(3787,0,__PYX_ERR(0, 3787, __pyx_L1_error))
    {
      __Pyx_PyThreadState_declare
      __Pyx_PyThreadState_assign
      __Pyx_ExceptionSave(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
      __Pyx_XGOTREF(__pyx_t_7);
      __Pyx_XGOTREF(__pyx_t_8);
      __Pyx_XGOTREF(__pyx_t_9);
      /*try:*/ {

        /* "gofast/tools/mathex.pyx":3788
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 *         try :
 *             s=int(s)             # <<<<<<<<<<<<<<
 *         except :
 *             raise ValueError (f'could not convert string to float: {S}')
 */
        __Pyx_TraceLine(3788,0,__PYX_ERR(0, 3788, __pyx_L4_error))
        __pyx_t_5 = __Pyx_PyNumber_Int(__pyx_v_s); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3788, __pyx_L4_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF_SET(__pyx_v_s, __pyx_t_5);
        __pyx_t_5 = 0;

        /* "gofast/tools/mathex.pyx":3787
 *     if isinstance(s, str):
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 *         try :             # <<<<<<<<<<<<<<
 *             s=int(s)
 *         except :
 */
      }
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      goto __pyx_L9_try_end;
      __pyx_L4_error:;
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "gofast/tools/mathex.pyx":3789
 *         try :
 *             s=int(s)
 *         except :             # <<<<<<<<<<<<<<
 *             raise ValueError (f'could not convert string to float: {S}')
 * 
 */
      __Pyx_TraceLine(3789,0,__PYX_ERR(0, 3789, __pyx_L6_except_error))
      /*except:*/ {
        __Pyx_AddTraceback("gofast.tools.mathex.detect_station_position", __pyx_clineno, __pyx_lineno, __pyx_filename);
        if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 3789, __pyx_L6_except_error)
        __Pyx_XGOTREF(__pyx_t_5);
        __Pyx_XGOTREF(__pyx_t_2);
        __Pyx_XGOTREF(__pyx_t_3);

        /* "gofast/tools/mathex.pyx":3790
 *             s=int(s)
 *         except :
 *             raise ValueError (f'could not convert string to float: {S}')             # <<<<<<<<<<<<<<
 * 
 *     p = np.array(p, dtype = np.int32)
 */
        __Pyx_TraceLine(3790,0,__PYX_ERR(0, 3790, __pyx_L6_except_error))
        __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_v_S, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3790, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_10 = __Pyx_PyUnicode_Concat(__pyx_kp_u_could_not_convert_string_to_floa, __pyx_t_1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3790, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_10); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3790, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __Pyx_Raise(__pyx_t_1, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __PYX_ERR(0, 3790, __pyx_L6_except_error)
      }

      /* "gofast/tools/mathex.pyx":3787
 *     if isinstance(s, str):
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 *         try :             # <<<<<<<<<<<<<<
 *             s=int(s)
 *         except :
 */
      __pyx_L6_except_error:;
      __Pyx_XGIVEREF(__pyx_t_7);
      __Pyx_XGIVEREF(__pyx_t_8);
      __Pyx_XGIVEREF(__pyx_t_9);
      __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
      goto __pyx_L1_error;
      __pyx_L9_try_end:;
    }

    /* "gofast/tools/mathex.pyx":3785
 * 
 *     S=copy.deepcopy(s)
 *     if isinstance(s, str):             # <<<<<<<<<<<<<<
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')
 *         try :
 */
  }

  /* "gofast/tools/mathex.pyx":3792
 *             raise ValueError (f'could not convert string to float: {S}')
 * 
 *     p = np.array(p, dtype = np.int32)             # <<<<<<<<<<<<<<
 *     dl = (p.max() - p.min() ) / (len(p) -1)
 *     if isinstance(s, (int, float)):
 */
  __Pyx_TraceLine(3792,0,__PYX_ERR(0, 3792, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_p);
  __Pyx_GIVEREF(__pyx_v_p);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_p)) __PYX_ERR(0, 3792, __pyx_L1_error);
  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_int32); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_10) < 0) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3792, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF_SET(__pyx_v_p, __pyx_t_10);
  __pyx_t_10 = 0;

  /* "gofast/tools/mathex.pyx":3793
 * 
 *     p = np.array(p, dtype = np.int32)
 *     dl = (p.max() - p.min() ) / (len(p) -1)             # <<<<<<<<<<<<<<
 *     if isinstance(s, (int, float)):
 *         if s > len(p): # consider this as the dipole length position:
 */
  __Pyx_TraceLine(3793,0,__PYX_ERR(0, 3793, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_max); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
    __pyx_t_10 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3793, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_min); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3793, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyNumber_Subtract(__pyx_t_10, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_11 = PyObject_Length(__pyx_v_p); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3793, __pyx_L1_error)
  __pyx_t_5 = PyInt_FromSsize_t((__pyx_t_11 - 1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_10 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3793, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_dl = __pyx_t_10;
  __pyx_t_10 = 0;

  /* "gofast/tools/mathex.pyx":3794
 *     p = np.array(p, dtype = np.int32)
 *     dl = (p.max() - p.min() ) / (len(p) -1)
 *     if isinstance(s, (int, float)):             # <<<<<<<<<<<<<<
 *         if s > len(p): # consider this as the dipole length position:
 *             # now let check whether the given value is module of the station
 */
  __Pyx_TraceLine(3794,0,__PYX_ERR(0, 3794, __pyx_L1_error))
  __pyx_t_12 = PyInt_Check(__pyx_v_s); 
  if (!__pyx_t_12) {
  } else {
    __pyx_t_6 = __pyx_t_12;
    goto __pyx_L13_bool_binop_done;
  }
  __pyx_t_12 = PyFloat_Check(__pyx_v_s); 
  __pyx_t_6 = __pyx_t_12;
  __pyx_L13_bool_binop_done:;
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3795
 *     dl = (p.max() - p.min() ) / (len(p) -1)
 *     if isinstance(s, (int, float)):
 *         if s > len(p): # consider this as the dipole length position:             # <<<<<<<<<<<<<<
 *             # now let check whether the given value is module of the station
 *             if s % dl !=0 :
 */
    __Pyx_TraceLine(3795,0,__PYX_ERR(0, 3795, __pyx_L1_error))
    __pyx_t_11 = PyObject_Length(__pyx_v_p); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3795, __pyx_L1_error)
    __pyx_t_10 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3795, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_s, __pyx_t_10, Py_GT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3795, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3795, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_6) {

      /* "gofast/tools/mathex.pyx":3797
 *         if s > len(p): # consider this as the dipole length position:
 *             # now let check whether the given value is module of the station
 *             if s % dl !=0 :             # <<<<<<<<<<<<<<
 *                 raise SiteError  (
 *                     f'Unable to detect the station position {S}')
 */
      __Pyx_TraceLine(3797,0,__PYX_ERR(0, 3797, __pyx_L1_error))
      __pyx_t_5 = PyNumber_Remainder(__pyx_v_s, __pyx_v_dl); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3797, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_6 = (__Pyx_PyInt_BoolNeObjC(__pyx_t_5, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3797, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(__pyx_t_6)) {

        /* "gofast/tools/mathex.pyx":3798
 *             # now let check whether the given value is module of the station
 *             if s % dl !=0 :
 *                 raise SiteError  (             # <<<<<<<<<<<<<<
 *                     f'Unable to detect the station position {S}')
 *             elif s % dl == 0 and s <= p.max():
 */
        __Pyx_TraceLine(3798,0,__PYX_ERR(0, 3798, __pyx_L1_error))
        __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_SiteError); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3798, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);

        /* "gofast/tools/mathex.pyx":3799
 *             if s % dl !=0 :
 *                 raise SiteError  (
 *                     f'Unable to detect the station position {S}')             # <<<<<<<<<<<<<<
 *             elif s % dl == 0 and s <= p.max():
 *                 # take the index
 */
        __Pyx_TraceLine(3799,0,__PYX_ERR(0, 3799, __pyx_L1_error))
        __pyx_t_3 = __Pyx_PyObject_FormatSimple(__pyx_v_S, __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3799, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Unable_to_detect_the_station_pos, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3799, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = NULL;
        __pyx_t_4 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_10))) {
          __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_10);
          if (likely(__pyx_t_3)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
            __Pyx_INCREF(__pyx_t_3);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_10, function);
            __pyx_t_4 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
          __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
          __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3798, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        }
        __Pyx_Raise(__pyx_t_5, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __PYX_ERR(0, 3798, __pyx_L1_error)

        /* "gofast/tools/mathex.pyx":3797
 *         if s > len(p): # consider this as the dipole length position:
 *             # now let check whether the given value is module of the station
 *             if s % dl !=0 :             # <<<<<<<<<<<<<<
 *                 raise SiteError  (
 *                     f'Unable to detect the station position {S}')
 */
      }

      /* "gofast/tools/mathex.pyx":3800
 *                 raise SiteError  (
 *                     f'Unable to detect the station position {S}')
 *             elif s % dl == 0 and s <= p.max():             # <<<<<<<<<<<<<<
 *                 # take the index
 *                 s_index = s//dl
 */
      __Pyx_TraceLine(3800,0,__PYX_ERR(0, 3800, __pyx_L1_error))
      __pyx_t_5 = PyNumber_Remainder(__pyx_v_s, __pyx_v_dl); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3800, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_12 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_5, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3800, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_12) {
      } else {
        __pyx_t_6 = __pyx_t_12;
        goto __pyx_L17_bool_binop_done;
      }
      __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_max); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3800, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __pyx_t_2 = NULL;
      __pyx_t_4 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_10))) {
        __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_10);
        if (likely(__pyx_t_2)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
          __Pyx_INCREF(__pyx_t_2);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_10, function);
          __pyx_t_4 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
        __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3800, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      }
      __pyx_t_10 = PyObject_RichCompare(__pyx_v_s, __pyx_t_5, Py_LE); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3800, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_12 = __Pyx_PyObject_IsTrue(__pyx_t_10); if (unlikely((__pyx_t_12 < 0))) __PYX_ERR(0, 3800, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_6 = __pyx_t_12;
      __pyx_L17_bool_binop_done:;
      if (likely(__pyx_t_6)) {

        /* "gofast/tools/mathex.pyx":3802
 *             elif s % dl == 0 and s <= p.max():
 *                 # take the index
 *                 s_index = s//dl             # <<<<<<<<<<<<<<
 *                 return int(s_index), s_index * dl
 *             else :
 */
        __Pyx_TraceLine(3802,0,__PYX_ERR(0, 3802, __pyx_L1_error))
        __pyx_t_10 = PyNumber_FloorDivide(__pyx_v_s, __pyx_v_dl); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3802, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_v_s_index = __pyx_t_10;
        __pyx_t_10 = 0;

        /* "gofast/tools/mathex.pyx":3803
 *                 # take the index
 *                 s_index = s//dl
 *                 return int(s_index), s_index * dl             # <<<<<<<<<<<<<<
 *             else :
 *                 raise SiteError (
 */
        __Pyx_TraceLine(3803,0,__PYX_ERR(0, 3803, __pyx_L1_error))
        __Pyx_XDECREF(__pyx_r);
        __pyx_t_10 = __Pyx_PyNumber_Int(__pyx_v_s_index); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3803, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_5 = PyNumber_Multiply(__pyx_v_s_index, __pyx_v_dl); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3803, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3803, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        __Pyx_GIVEREF(__pyx_t_10);
        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_10)) __PYX_ERR(0, 3803, __pyx_L1_error);
        __Pyx_GIVEREF(__pyx_t_5);
        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5)) __PYX_ERR(0, 3803, __pyx_L1_error);
        __pyx_t_10 = 0;
        __pyx_t_5 = 0;
        __pyx_r = __pyx_t_2;
        __pyx_t_2 = 0;
        goto __pyx_L0;

        /* "gofast/tools/mathex.pyx":3800
 *                 raise SiteError  (
 *                     f'Unable to detect the station position {S}')
 *             elif s % dl == 0 and s <= p.max():             # <<<<<<<<<<<<<<
 *                 # take the index
 *                 s_index = s//dl
 */
      }

      /* "gofast/tools/mathex.pyx":3805
 *                 return int(s_index), s_index * dl
 *             else :
 *                 raise SiteError (             # <<<<<<<<<<<<<<
 *                     f'Station {S} is out of the range; max position = {max(p)}'
 *                 )
 */
      __Pyx_TraceLine(3805,0,__PYX_ERR(0, 3805, __pyx_L1_error))
      /*else*/ {
        __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_SiteError); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3805, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);

        /* "gofast/tools/mathex.pyx":3806
 *             else :
 *                 raise SiteError (
 *                     f'Station {S} is out of the range; max position = {max(p)}'             # <<<<<<<<<<<<<<
 *                 )
 *         else :
 */
        __Pyx_TraceLine(3806,0,__PYX_ERR(0, 3806, __pyx_L1_error))
        __pyx_t_10 = PyTuple_New(4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_11 = 0;
        __pyx_t_13 = 127;
        __Pyx_INCREF(__pyx_kp_u_Station);
        __pyx_t_11 += 8;
        __Pyx_GIVEREF(__pyx_kp_u_Station);
        PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_kp_u_Station);
        __pyx_t_3 = __Pyx_PyObject_FormatSimple(__pyx_v_S, __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_13 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) > __pyx_t_13) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) : __pyx_t_13;
        __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_3);
        __Pyx_GIVEREF(__pyx_t_3);
        PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_3);
        __pyx_t_3 = 0;
        __Pyx_INCREF(__pyx_kp_u_is_out_of_the_range_max_positio);
        __pyx_t_11 += 37;
        __Pyx_GIVEREF(__pyx_kp_u_is_out_of_the_range_max_positio);
        PyTuple_SET_ITEM(__pyx_t_10, 2, __pyx_kp_u_is_out_of_the_range_max_positio);
        __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_max, __pyx_v_p); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_3, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_13 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_13) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_13;
        __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
        __Pyx_GIVEREF(__pyx_t_1);
        PyTuple_SET_ITEM(__pyx_t_10, 3, __pyx_t_1);
        __pyx_t_1 = 0;
        __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_10, 4, __pyx_t_11, __pyx_t_13); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3806, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = NULL;
        __pyx_t_4 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_5))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_5);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_5, function);
            __pyx_t_4 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_1};
          __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3805, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        }
        __Pyx_Raise(__pyx_t_2, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        __PYX_ERR(0, 3805, __pyx_L1_error)
      }

      /* "gofast/tools/mathex.pyx":3795
 *     dl = (p.max() - p.min() ) / (len(p) -1)
 *     if isinstance(s, (int, float)):
 *         if s > len(p): # consider this as the dipole length position:             # <<<<<<<<<<<<<<
 *             # now let check whether the given value is module of the station
 *             if s % dl !=0 :
 */
    }

    /* "gofast/tools/mathex.pyx":3809
 *                 )
 *         else :
 *             if s >= len(p):             # <<<<<<<<<<<<<<
 *                 raise SiteError (
 *                     'Location index must be less than the number of'
 */
    __Pyx_TraceLine(3809,0,__PYX_ERR(0, 3809, __pyx_L1_error))
    /*else*/ {
      __pyx_t_11 = PyObject_Length(__pyx_v_p); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3809, __pyx_L1_error)
      __pyx_t_2 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3809, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_5 = PyObject_RichCompare(__pyx_v_s, __pyx_t_2, Py_GE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3809, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3809, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(__pyx_t_6)) {

        /* "gofast/tools/mathex.pyx":3810
 *         else :
 *             if s >= len(p):
 *                 raise SiteError (             # <<<<<<<<<<<<<<
 *                     'Location index must be less than the number of'
 *                     f' stations = {len(p)}. {s} is gotten.')
 */
        __Pyx_TraceLine(3810,0,__PYX_ERR(0, 3810, __pyx_L1_error))
        __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SiteError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3810, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);

        /* "gofast/tools/mathex.pyx":3811
 *             if s >= len(p):
 *                 raise SiteError (
 *                     'Location index must be less than the number of'             # <<<<<<<<<<<<<<
 *                     f' stations = {len(p)}. {s} is gotten.')
 *             # consider it as integer index
 */
        __Pyx_TraceLine(3811,0,__PYX_ERR(0, 3811, __pyx_L1_error))
        __pyx_t_1 = PyTuple_New(5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3811, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        __pyx_t_11 = 0;
        __pyx_t_13 = 127;
        __Pyx_INCREF(__pyx_kp_u_Location_index_must_be_less_than);
        __pyx_t_11 += 58;
        __Pyx_GIVEREF(__pyx_kp_u_Location_index_must_be_less_than);
        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_Location_index_must_be_less_than);

        /* "gofast/tools/mathex.pyx":3812
 *                 raise SiteError (
 *                     'Location index must be less than the number of'
 *                     f' stations = {len(p)}. {s} is gotten.')             # <<<<<<<<<<<<<<
 *             # consider it as integer index
 *             # erase the last variable
 */
        __Pyx_TraceLine(3812,0,__PYX_ERR(0, 3812, __pyx_L1_error))
        __pyx_t_14 = PyObject_Length(__pyx_v_p); if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 3812, __pyx_L1_error)
        __pyx_t_10 = __Pyx_PyUnicode_From_Py_ssize_t(__pyx_t_14, 0, ' ', 'd'); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3812, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_10);
        __pyx_t_10 = 0;
        __Pyx_INCREF(__pyx_kp_u__107);
        __pyx_t_11 += 2;
        __Pyx_GIVEREF(__pyx_kp_u__107);
        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__107);
        __pyx_t_10 = __Pyx_PyObject_FormatSimple(__pyx_v_s, __pyx_empty_unicode); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3812, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_13 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_10) > __pyx_t_13) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_10) : __pyx_t_13;
        __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_10);
        __Pyx_GIVEREF(__pyx_t_10);
        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_10);
        __pyx_t_10 = 0;
        __Pyx_INCREF(__pyx_kp_u_is_gotten);
        __pyx_t_11 += 11;
        __Pyx_GIVEREF(__pyx_kp_u_is_gotten);
        PyTuple_SET_ITEM(__pyx_t_1, 4, __pyx_kp_u_is_gotten);

        /* "gofast/tools/mathex.pyx":3811
 *             if s >= len(p):
 *                 raise SiteError (
 *                     'Location index must be less than the number of'             # <<<<<<<<<<<<<<
 *                     f' stations = {len(p)}. {s} is gotten.')
 *             # consider it as integer index
 */
        __Pyx_TraceLine(3811,0,__PYX_ERR(0, 3811, __pyx_L1_error))
        __pyx_t_10 = __Pyx_PyUnicode_Join(__pyx_t_1, 5, __pyx_t_11, __pyx_t_13); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3811, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = NULL;
        __pyx_t_4 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_2))) {
          __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
          if (likely(__pyx_t_1)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
            __Pyx_INCREF(__pyx_t_1);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_2, function);
            __pyx_t_4 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_10};
          __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3810, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_5);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
        }
        __Pyx_Raise(__pyx_t_5, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
        __PYX_ERR(0, 3810, __pyx_L1_error)

        /* "gofast/tools/mathex.pyx":3809
 *                 )
 *         else :
 *             if s >= len(p):             # <<<<<<<<<<<<<<
 *                 raise SiteError (
 *                     'Location index must be less than the number of'
 */
      }

      /* "gofast/tools/mathex.pyx":3817
 *             # s_index = s
 *             # s = S * dl   # find
 *             return s , p[s ]             # <<<<<<<<<<<<<<
 * 
 *     # check whether the s value is in the p
 */
      __Pyx_TraceLine(3817,0,__PYX_ERR(0, 3817, __pyx_L1_error))
      __Pyx_XDECREF(__pyx_r);
      __pyx_t_5 = __Pyx_PyObject_GetItem(__pyx_v_p, __pyx_v_s); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3817, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3817, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_v_s);
      __Pyx_GIVEREF(__pyx_v_s);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_s)) __PYX_ERR(0, 3817, __pyx_L1_error);
      __Pyx_GIVEREF(__pyx_t_5);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_5)) __PYX_ERR(0, 3817, __pyx_L1_error);
      __pyx_t_5 = 0;
      __pyx_r = __pyx_t_2;
      __pyx_t_2 = 0;
      goto __pyx_L0;
    }

    /* "gofast/tools/mathex.pyx":3794
 *     p = np.array(p, dtype = np.int32)
 *     dl = (p.max() - p.min() ) / (len(p) -1)
 *     if isinstance(s, (int, float)):             # <<<<<<<<<<<<<<
 *         if s > len(p): # consider this as the dipole length position:
 *             # now let check whether the given value is module of the station
 */
  }

  /* "gofast/tools/mathex.pyx":3820
 * 
 *     # check whether the s value is in the p
 *     if True in np.isin (p, s):             # <<<<<<<<<<<<<<
 *         s_index ,  = np.where (p ==s )
 *         s = p [s_index]
 */
  __Pyx_TraceLine(3820,0,__PYX_ERR(0, 3820, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_isin); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_10);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_10))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_10);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_10, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_5, __pyx_v_p, __pyx_v_s};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_4, 2+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3820, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
  }
  __pyx_t_6 = (__Pyx_PySequence_ContainsTF(Py_True, __pyx_t_2, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3820, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":3821
 *     # check whether the s value is in the p
 *     if True in np.isin (p, s):
 *         s_index ,  = np.where (p ==s )             # <<<<<<<<<<<<<<
 *         s = p [s_index]
 * 
 */
    __Pyx_TraceLine(3821,0,__PYX_ERR(0, 3821, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_10, __pyx_n_s_np); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_10, __pyx_n_s_where); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3821, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = PyObject_RichCompare(__pyx_v_p, __pyx_v_s, Py_EQ); __Pyx_XGOTREF(__pyx_t_10); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3821, __pyx_L1_error)
    __pyx_t_1 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_5))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_5);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_5, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_10};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3821, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 1)) {
        if (size > 1) __Pyx_RaiseTooManyValuesError(1);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 3821, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_5 = PyTuple_GET_ITEM(sequence, 0); 
      } else {
        __pyx_t_5 = PyList_GET_ITEM(sequence, 0); 
      }
      __Pyx_INCREF(__pyx_t_5);
      #else
      __pyx_t_5 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3821, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_10 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 3821, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_10);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_15 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_10);
      index = 0; __pyx_t_5 = __pyx_t_15(__pyx_t_10); if (unlikely(!__pyx_t_5)) goto __pyx_L21_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_5);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_15(__pyx_t_10), 1) < 0) __PYX_ERR(0, 3821, __pyx_L1_error)
      __pyx_t_15 = NULL;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      goto __pyx_L22_unpacking_done;
      __pyx_L21_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      __pyx_t_15 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 3821, __pyx_L1_error)
      __pyx_L22_unpacking_done:;
    }
    __pyx_v_s_index = __pyx_t_5;
    __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":3822
 *     if True in np.isin (p, s):
 *         s_index ,  = np.where (p ==s )
 *         s = p [s_index]             # <<<<<<<<<<<<<<
 * 
 *     return int(s_index) , s
 */
    __Pyx_TraceLine(3822,0,__PYX_ERR(0, 3822, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_v_p, __pyx_v_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3822, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF_SET(__pyx_v_s, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":3820
 * 
 *     # check whether the s value is in the p
 *     if True in np.isin (p, s):             # <<<<<<<<<<<<<<
 *         s_index ,  = np.where (p ==s )
 *         s = p [s_index]
 */
  }

  /* "gofast/tools/mathex.pyx":3824
 *         s = p [s_index]
 * 
 *     return int(s_index) , s             # <<<<<<<<<<<<<<
 * 
 * def _manage_colors (c, default = ['ok', 'ob-', 'r-']):
 */
  __Pyx_TraceLine(3824,0,__PYX_ERR(0, 3824, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_v_s_index)) { __Pyx_RaiseUnboundLocalError("s_index"); __PYX_ERR(0, 3824, __pyx_L1_error) }
  __pyx_t_2 = __Pyx_PyNumber_Int(__pyx_v_s_index); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3824, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 3824, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_2)) __PYX_ERR(0, 3824, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_s);
  __Pyx_GIVEREF(__pyx_v_s);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_s)) __PYX_ERR(0, 3824, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_5;
  __pyx_t_5 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3746
 *     return ydata_new, popt, pcov
 * 
 * def detect_station_position (             # <<<<<<<<<<<<<<
 *         s : Union[str, int] ,
 *         p: _SP,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex.detect_station_position", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_S);
  __Pyx_XDECREF(__pyx_v_dl);
  __Pyx_XDECREF(__pyx_v_s_index);
  __Pyx_XDECREF(__pyx_v_s);
  __Pyx_XDECREF(__pyx_v_p);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3826
 *     return int(s_index) , s
 * 
 * def _manage_colors (c, default = ['ok', 'ob-', 'r-']):             # <<<<<<<<<<<<<<
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_138__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__defaults__", 1);
  __Pyx_TraceCall("__defaults__", __pyx_f[0], 3826, 0, __PYX_ERR(0, 3826, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_default);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_default);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self)->__pyx_arg_default)) __PYX_ERR(0, 3826, __pyx_L1_error);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 3826, __pyx_L1_error);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, Py_None)) __PYX_ERR(0, 3826, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_r = __pyx_t_2;
  __pyx_t_2 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("gofast.tools.mathex.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_93_manage_colors(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_92_manage_colors, " Manage the ohmic-area plot colors ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_93_manage_colors = {"_manage_colors", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_93_manage_colors, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_92_manage_colors};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_93_manage_colors(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_c = 0;
  PyObject *__pyx_v_default = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_manage_colors (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_c,&__pyx_n_s_default,0};
    __pyx_defaults2 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_self);
    values[1] = __Pyx_Arg_NewRef_FASTCALL(__pyx_dynamic_args->__pyx_arg_default);
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_c)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3826, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_default);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3826, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_manage_colors") < 0)) __PYX_ERR(0, 3826, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_c = values[0];
    __pyx_v_default = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_manage_colors", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 3826, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._manage_colors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_92_manage_colors(__pyx_self, __pyx_v_c, __pyx_v_default);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_92_manage_colors(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_c, PyObject *__pyx_v_default) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__108)
  __Pyx_RefNannySetupContext("_manage_colors", 0);
  __Pyx_TraceCall("_manage_colors", __pyx_f[0], 3826, 0, __PYX_ERR(0, 3826, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_c);

  /* "gofast/tools/mathex.pyx":3828
 * def _manage_colors (c, default = ['ok', 'ob-', 'r-']):
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default             # <<<<<<<<<<<<<<
 *     if isinstance(c, str):
 *         c= [c]
 */
  __Pyx_TraceLine(3828,0,__PYX_ERR(0, 3828, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_v_c); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 3828, __pyx_L1_error)
  if (!__pyx_t_2) {
  } else {
    __Pyx_INCREF(__pyx_v_c);
    __pyx_t_1 = __pyx_v_c;
    goto __pyx_L3_bool_binop_done;
  }
  __Pyx_INCREF(__pyx_v_default);
  __pyx_t_1 = __pyx_v_default;
  __pyx_L3_bool_binop_done:;
  __Pyx_DECREF_SET(__pyx_v_c, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":3829
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default
 *     if isinstance(c, str):             # <<<<<<<<<<<<<<
 *         c= [c]
 *     c = list(c) +  default
 */
  __Pyx_TraceLine(3829,0,__PYX_ERR(0, 3829, __pyx_L1_error))
  __pyx_t_2 = PyUnicode_Check(__pyx_v_c); 
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":3830
 *     c = c or default
 *     if isinstance(c, str):
 *         c= [c]             # <<<<<<<<<<<<<<
 *     c = list(c) +  default
 * 
 */
    __Pyx_TraceLine(3830,0,__PYX_ERR(0, 3830, __pyx_L1_error))
    __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3830, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_c);
    __Pyx_GIVEREF(__pyx_v_c);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_c)) __PYX_ERR(0, 3830, __pyx_L1_error);
    __Pyx_DECREF_SET(__pyx_v_c, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":3829
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default
 *     if isinstance(c, str):             # <<<<<<<<<<<<<<
 *         c= [c]
 *     c = list(c) +  default
 */
  }

  /* "gofast/tools/mathex.pyx":3831
 *     if isinstance(c, str):
 *         c= [c]
 *     c = list(c) +  default             # <<<<<<<<<<<<<<
 * 
 *     return c [:3] # return 3colors
 */
  __Pyx_TraceLine(3831,0,__PYX_ERR(0, 3831, __pyx_L1_error))
  __pyx_t_1 = PySequence_List(__pyx_v_c); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3831, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Add(__pyx_t_1, __pyx_v_default); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3831, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_c, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3833
 *     c = list(c) +  default
 * 
 *     return c [:3] # return 3colors             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(3833,0,__PYX_ERR(0, 3833, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = __Pyx_PyObject_GetSlice(__pyx_v_c, 0, 3, NULL, NULL, &__pyx_slice__109, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3833, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3826
 *     return int(s_index) , s
 * 
 * def _manage_colors (c, default = ['ok', 'ob-', 'r-']):             # <<<<<<<<<<<<<<
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_AddTraceback("gofast.tools.mathex._manage_colors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3837
 * 
 * 
 * def convert_distance_to_m(             # <<<<<<<<<<<<<<
 *         value:_T ,
 *         converter:float =1e3,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_95convert_distance_to_m(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_94convert_distance_to_m, " Convert distance from `km` to `m` or vice versa even a string \n    value is given.\n    \n    :param value: value to convert. \n    :paramm converter: Equivalent if given in ``km`` rather than ``m``.\n    :param unit: unit to convert to.\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_95convert_distance_to_m = {"convert_distance_to_m", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_95convert_distance_to_m, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_94convert_distance_to_m};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_95convert_distance_to_m(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_value = 0;
  double __pyx_v_converter;
  PyObject *__pyx_v_unit = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("convert_distance_to_m (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_value,&__pyx_n_s_converter,&__pyx_n_s_unit,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_km)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_value)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3837, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_converter);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3837, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_unit);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3837, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "convert_distance_to_m") < 0)) __PYX_ERR(0, 3837, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_value = values[0];
    if (values[1]) {
      __pyx_v_converter = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_converter == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3839, __pyx_L3_error)
    } else {
      __pyx_v_converter = ((double)((double)1e3));
    }
    __pyx_v_unit = ((PyObject*)values[2]);
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("convert_distance_to_m", 0, 1, 3, __pyx_nargs); __PYX_ERR(0, 3837, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.convert_distance_to_m", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_unit), (&PyUnicode_Type), 0, "unit", 1))) __PYX_ERR(0, 3840, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_94convert_distance_to_m(__pyx_self, __pyx_v_value, __pyx_v_converter, __pyx_v_unit);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_94convert_distance_to_m(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_value, double __pyx_v_converter, PyObject *__pyx_v_unit) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  double __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  Py_UCS4 __pyx_t_12;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__110)
  __Pyx_RefNannySetupContext("convert_distance_to_m", 0);
  __Pyx_TraceCall("convert_distance_to_m", __pyx_f[0], 3837, 0, __PYX_ERR(0, 3837, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_value);

  /* "gofast/tools/mathex.pyx":3851
 *     """
 * 
 *     if isinstance(value, str):             # <<<<<<<<<<<<<<
 *         try:
 *             value = float(value.replace(unit, '')
 */
  __Pyx_TraceLine(3851,0,__PYX_ERR(0, 3851, __pyx_L1_error))
  __pyx_t_1 = PyUnicode_Check(__pyx_v_value); 
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":3852
 * 
 *     if isinstance(value, str):
 *         try:             # <<<<<<<<<<<<<<
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(
 */
    __Pyx_TraceLine(3852,0,__PYX_ERR(0, 3852, __pyx_L1_error))
    {
      __Pyx_PyThreadState_declare
      __Pyx_PyThreadState_assign
      __Pyx_ExceptionSave(&__pyx_t_2, &__pyx_t_3, &__pyx_t_4);
      __Pyx_XGOTREF(__pyx_t_2);
      __Pyx_XGOTREF(__pyx_t_3);
      __Pyx_XGOTREF(__pyx_t_4);
      /*try:*/ {

        /* "gofast/tools/mathex.pyx":3854
 *         try:
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(             # <<<<<<<<<<<<<<
 *                 'km')>=0 else float(value.replace('m', ''))
 *         except:
 */
        __Pyx_TraceLine(3854,0,__PYX_ERR(0, 3854, __pyx_L4_error))
        __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_find); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3854, __pyx_L4_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_8 = NULL;
        __pyx_t_9 = 0;
        #if CYTHON_UNPACK_METHODS
        if (likely(PyMethod_Check(__pyx_t_7))) {
          __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
          if (likely(__pyx_t_8)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
            __Pyx_INCREF(__pyx_t_8);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_7, function);
            __pyx_t_9 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_n_u_km};
          __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_9, 1+__pyx_t_9);
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3854, __pyx_L4_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        }
        __pyx_t_7 = PyObject_RichCompare(__pyx_t_6, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3855, __pyx_L4_error)
        __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

        /* "gofast/tools/mathex.pyx":3855
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(
 *                 'km')>=0 else float(value.replace('m', ''))             # <<<<<<<<<<<<<<
 *         except:
 *             raise TypeError(f"Expected float not {type(value)!r}."
 */
        __Pyx_TraceLine(3855,0,__PYX_ERR(0, 3855, __pyx_L4_error))
        __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 3855, __pyx_L4_error)
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (__pyx_t_1) {

          /* "gofast/tools/mathex.pyx":3853
 *     if isinstance(value, str):
 *         try:
 *             value = float(value.replace(unit, '')             # <<<<<<<<<<<<<<
 *                               )*converter if value.find(
 *                 'km')>=0 else float(value.replace('m', ''))
 */
          __Pyx_TraceLine(3853,0,__PYX_ERR(0, 3853, __pyx_L4_error))
          __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_replace); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3853, __pyx_L4_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_8 = NULL;
          __pyx_t_9 = 0;
          #if CYTHON_UNPACK_METHODS
          if (likely(PyMethod_Check(__pyx_t_6))) {
            __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
            if (likely(__pyx_t_8)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
              __Pyx_INCREF(__pyx_t_8);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_6, function);
              __pyx_t_9 = 1;
            }
          }
          #endif
          {
            PyObject *__pyx_callargs[3] = {__pyx_t_8, __pyx_v_unit, __pyx_kp_u__65};
            __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_9, 2+__pyx_t_9);
            __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
            if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3853, __pyx_L4_error)
            __Pyx_GOTREF(__pyx_t_7);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          }
          __pyx_t_10 = __Pyx_PyObject_AsDouble(__pyx_t_7); if (unlikely(__pyx_t_10 == ((double)((double)-1)) && PyErr_Occurred())) __PYX_ERR(0, 3853, __pyx_L4_error)
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

          /* "gofast/tools/mathex.pyx":3854
 *         try:
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(             # <<<<<<<<<<<<<<
 *                 'km')>=0 else float(value.replace('m', ''))
 *         except:
 */
          __Pyx_TraceLine(3854,0,__PYX_ERR(0, 3854, __pyx_L4_error))
          __pyx_t_7 = PyFloat_FromDouble((__pyx_t_10 * __pyx_v_converter)); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3854, __pyx_L4_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_5 = __pyx_t_7;
          __pyx_t_7 = 0;
        } else {

          /* "gofast/tools/mathex.pyx":3855
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(
 *                 'km')>=0 else float(value.replace('m', ''))             # <<<<<<<<<<<<<<
 *         except:
 *             raise TypeError(f"Expected float not {type(value)!r}."
 */
          __Pyx_TraceLine(3855,0,__PYX_ERR(0, 3855, __pyx_L4_error))
          __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_value, __pyx_n_s_replace); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3855, __pyx_L4_error)
          __Pyx_GOTREF(__pyx_t_7);
          __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_tuple__111, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 3855, __pyx_L4_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          __pyx_t_7 = __Pyx_PyNumber_Float(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3855, __pyx_L4_error)
          __Pyx_GOTREF(__pyx_t_7);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          __pyx_t_5 = __pyx_t_7;
          __pyx_t_7 = 0;
        }
        __Pyx_DECREF_SET(__pyx_v_value, __pyx_t_5);
        __pyx_t_5 = 0;

        /* "gofast/tools/mathex.pyx":3852
 * 
 *     if isinstance(value, str):
 *         try:             # <<<<<<<<<<<<<<
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(
 */
      }
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      goto __pyx_L9_try_end;
      __pyx_L4_error:;
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;

      /* "gofast/tools/mathex.pyx":3856
 *                               )*converter if value.find(
 *                 'km')>=0 else float(value.replace('m', ''))
 *         except:             # <<<<<<<<<<<<<<
 *             raise TypeError(f"Expected float not {type(value)!r}."
 *                )
 */
      __Pyx_TraceLine(3856,0,__PYX_ERR(0, 3856, __pyx_L6_except_error))
      /*except:*/ {
        __Pyx_AddTraceback("gofast.tools.mathex.convert_distance_to_m", __pyx_clineno, __pyx_lineno, __pyx_filename);
        if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_7, &__pyx_t_6) < 0) __PYX_ERR(0, 3856, __pyx_L6_except_error)
        __Pyx_XGOTREF(__pyx_t_5);
        __Pyx_XGOTREF(__pyx_t_7);
        __Pyx_XGOTREF(__pyx_t_6);

        /* "gofast/tools/mathex.pyx":3857
 *                 'km')>=0 else float(value.replace('m', ''))
 *         except:
 *             raise TypeError(f"Expected float not {type(value)!r}."             # <<<<<<<<<<<<<<
 *                )
 * 
 */
        __Pyx_TraceLine(3857,0,__PYX_ERR(0, 3857, __pyx_L6_except_error))
        __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3857, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_8);
        __pyx_t_11 = 0;
        __pyx_t_12 = 127;
        __Pyx_INCREF(__pyx_kp_u_Expected_float_not);
        __pyx_t_11 += 19;
        __Pyx_GIVEREF(__pyx_kp_u_Expected_float_not);
        PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_kp_u_Expected_float_not);
        __pyx_t_13 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(((PyObject *)Py_TYPE(__pyx_v_value))), __pyx_empty_unicode); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 3857, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_13);
        __pyx_t_12 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_13) > __pyx_t_12) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_13) : __pyx_t_12;
        __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_13);
        __Pyx_GIVEREF(__pyx_t_13);
        PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_13);
        __pyx_t_13 = 0;
        __Pyx_INCREF(__pyx_kp_u__39);
        __pyx_t_11 += 1;
        __Pyx_GIVEREF(__pyx_kp_u__39);
        PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_kp_u__39);
        __pyx_t_13 = __Pyx_PyUnicode_Join(__pyx_t_8, 3, __pyx_t_11, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 3857, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_13);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_13); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3857, __pyx_L6_except_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_Raise(__pyx_t_8, 0, 0, 0);
        __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        __PYX_ERR(0, 3857, __pyx_L6_except_error)
      }

      /* "gofast/tools/mathex.pyx":3852
 * 
 *     if isinstance(value, str):
 *         try:             # <<<<<<<<<<<<<<
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(
 */
      __pyx_L6_except_error:;
      __Pyx_XGIVEREF(__pyx_t_2);
      __Pyx_XGIVEREF(__pyx_t_3);
      __Pyx_XGIVEREF(__pyx_t_4);
      __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_3, __pyx_t_4);
      goto __pyx_L1_error;
      __pyx_L9_try_end:;
    }

    /* "gofast/tools/mathex.pyx":3851
 *     """
 * 
 *     if isinstance(value, str):             # <<<<<<<<<<<<<<
 *         try:
 *             value = float(value.replace(unit, '')
 */
  }

  /* "gofast/tools/mathex.pyx":3860
 *                )
 * 
 *     return value             # <<<<<<<<<<<<<<
 * 
 * def get_station_number (
 */
  __Pyx_TraceLine(3860,0,__PYX_ERR(0, 3860, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_value);
  __pyx_r = __pyx_v_value;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3837
 * 
 * 
 * def convert_distance_to_m(             # <<<<<<<<<<<<<<
 *         value:_T ,
 *         converter:float =1e3,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex.convert_distance_to_m", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_value);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3862
 *     return value
 * 
 * def get_station_number (             # <<<<<<<<<<<<<<
 *         dipole:float,
 *         distance:float ,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_97get_station_number(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_96get_station_number, " Get the station number from dipole length and \n    the distance to the station.\n    \n    :param distance: Is the distance from the first station to `s` in \n        meter (m). If value is given, please specify the dipole length in \n        the same unit as `distance`.\n    :param dipole: Is the distance of the dipole measurement. \n        By default the dipole length is in meter.\n    :param kws: :func:`convert_distance_to_m` additional arguments\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_97get_station_number = {"get_station_number", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_97get_station_number, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_96get_station_number};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_97get_station_number(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  double __pyx_v_dipole;
  double __pyx_v_distance;
  PyObject *__pyx_v_from0 = 0;
  PyObject *__pyx_v_kws = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_station_number (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  __pyx_v_kws = PyDict_New(); if (unlikely(!__pyx_v_kws)) return NULL;
  __Pyx_GOTREF(__pyx_v_kws);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_dipole,&__pyx_n_s_distance,&__pyx_n_s_from0,0};

    /* "gofast/tools/mathex.pyx":3865
 *         dipole:float,
 *         distance:float ,
 *         from0:bool = False,             # <<<<<<<<<<<<<<
 *         **kws
 * )-> float:
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_dipole)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3862, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_distance)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3862, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("get_station_number", 0, 2, 3, 1); __PYX_ERR(0, 3862, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_from0);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3862, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kws, values + 0, kwd_pos_args, "get_station_number") < 0)) __PYX_ERR(0, 3862, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_dipole = __pyx_PyFloat_AsDouble(values[0]); if (unlikely((__pyx_v_dipole == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3863, __pyx_L3_error)
    __pyx_v_distance = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_distance == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3864, __pyx_L3_error)
    __pyx_v_from0 = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_station_number", 0, 2, 3, __pyx_nargs); __PYX_ERR(0, 3862, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_DECREF(__pyx_v_kws); __pyx_v_kws = 0;
  __Pyx_AddTraceback("gofast.tools.mathex.get_station_number", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_96get_station_number(__pyx_self, __pyx_v_dipole, __pyx_v_distance, __pyx_v_from0, __pyx_v_kws);

  /* "gofast/tools/mathex.pyx":3862
 *     return value
 * 
 * def get_station_number (             # <<<<<<<<<<<<<<
 *         dipole:float,
 *         distance:float ,
 */

  /* function exit code */
  __Pyx_DECREF(__pyx_v_kws);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_96get_station_number(CYTHON_UNUSED PyObject *__pyx_self, double __pyx_v_dipole, double __pyx_v_distance, PyObject *__pyx_v_from0, PyObject *__pyx_v_kws) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  double __pyx_t_5;
  int __pyx_t_6;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__112)
  __Pyx_RefNannySetupContext("get_station_number", 1);
  __Pyx_TraceCall("get_station_number", __pyx_f[0], 3862, 0, __PYX_ERR(0, 3862, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":3879
 * 
 *     """
 *     dipole=convert_distance_to_m(dipole, **kws)             # <<<<<<<<<<<<<<
 *     distance =convert_distance_to_m(distance, **kws)
 * 
 */
  __Pyx_TraceLine(3879,0,__PYX_ERR(0, 3879, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_convert_distance_to_m); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_dipole); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 3879, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyDict_Copy(__pyx_v_kws); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3879, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_5 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3879, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_dipole = __pyx_t_5;

  /* "gofast/tools/mathex.pyx":3880
 *     """
 *     dipole=convert_distance_to_m(dipole, **kws)
 *     distance =convert_distance_to_m(distance, **kws)             # <<<<<<<<<<<<<<
 * 
 *     return  distance/dipole  if from0 else distance/dipole + 1
 */
  __Pyx_TraceLine(3880,0,__PYX_ERR(0, 3880, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_convert_distance_to_m); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 3880, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = PyDict_Copy(__pyx_v_kws); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 3880, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_PyFloat_AsDouble(__pyx_t_1); if (unlikely((__pyx_t_5 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 3880, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_distance = __pyx_t_5;

  /* "gofast/tools/mathex.pyx":3882
 *     distance =convert_distance_to_m(distance, **kws)
 * 
 *     return  distance/dipole  if from0 else distance/dipole + 1             # <<<<<<<<<<<<<<
 * 
 * #FR0: #CED9EF # (206, 217, 239)
 */
  __Pyx_TraceLine(3882,0,__PYX_ERR(0, 3882, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_from0); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 3882, __pyx_L1_error)
  if (__pyx_t_6) {
    if (unlikely(__pyx_v_dipole == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 3882, __pyx_L1_error)
    }
    __pyx_t_2 = PyFloat_FromDouble((__pyx_v_distance / __pyx_v_dipole)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3882, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    if (unlikely(__pyx_v_dipole == 0)) {
      PyErr_SetString(PyExc_ZeroDivisionError, "float division");
      __PYX_ERR(0, 3882, __pyx_L1_error)
    }
    __pyx_t_2 = PyFloat_FromDouble(((__pyx_v_distance / __pyx_v_dipole) + 1.0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3882, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3862
 *     return value
 * 
 * def get_station_number (             # <<<<<<<<<<<<<<
 *         dipole:float,
 *         distance:float ,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_AddTraceback("gofast.tools.mathex.get_station_number", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3889
 * #FR3: #0A4CEE # (10, 76, 238)
 * 
 * def get_profile_angle (             # <<<<<<<<<<<<<<
 *         easting: float =None, northing: float =None, msg:str ="ignore" ):
 *     """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_99get_profile_angle(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_98get_profile_angle, "\n    compute geoprofile angle. \n    Parameters \n    -----------\n    * easting : array_like \n            easting coordiantes values \n    * northing : array_like \n            northing coordinates values\n    * msg: output a little message if msg is set to \"raises\"\n    \n    Returns \n    ---------\n    float\n         profile_angle \n    float \n        geo_electric_strike \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_99get_profile_angle = {"get_profile_angle", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_99get_profile_angle, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_98get_profile_angle};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_99get_profile_angle(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_easting = 0;
  PyObject *__pyx_v_northing = 0;
  PyObject *__pyx_v_msg = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_profile_angle (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_easting,&__pyx_n_s_northing,&__pyx_n_s_msg,0};

    /* "gofast/tools/mathex.pyx":3890
 * 
 * def get_profile_angle (
 *         easting: float =None, northing: float =None, msg:str ="ignore" ):             # <<<<<<<<<<<<<<
 *     """
 *     compute geoprofile angle.
 */
    values[0] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)Py_None));
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)Py_None));
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_ignore)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_easting);
          if (value) { values[0] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3889, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_northing);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3889, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_msg);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3889, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_profile_angle") < 0)) __PYX_ERR(0, 3889, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_easting = ((PyObject*)values[0]);
    __pyx_v_northing = ((PyObject*)values[1]);
    __pyx_v_msg = ((PyObject*)values[2]);
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_profile_angle", 0, 0, 3, __pyx_nargs); __PYX_ERR(0, 3889, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.get_profile_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_easting), (&PyFloat_Type), 1, "easting", 1))) __PYX_ERR(0, 3890, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_northing), (&PyFloat_Type), 1, "northing", 1))) __PYX_ERR(0, 3890, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_msg), (&PyUnicode_Type), 0, "msg", 1))) __PYX_ERR(0, 3890, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_98get_profile_angle(__pyx_self, __pyx_v_easting, __pyx_v_northing, __pyx_v_msg);

  /* "gofast/tools/mathex.pyx":3889
 * #FR3: #0A4CEE # (10, 76, 238)
 * 
 * def get_profile_angle (             # <<<<<<<<<<<<<<
 *         easting: float =None, northing: float =None, msg:str ="ignore" ):
 *     """
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_98get_profile_angle(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_easting, PyObject *__pyx_v_northing, PyObject *__pyx_v_msg) {
  PyObject *__pyx_v_profile1 = NULL;
  PyObject *__pyx_v_profile2 = NULL;
  PyObject *__pyx_v_profile_line = NULL;
  PyObject *__pyx_v_profile_angle = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  PyObject *__pyx_t_11 = NULL;
  PyObject *__pyx_t_12 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__113)
  __Pyx_RefNannySetupContext("get_profile_angle", 0);
  __Pyx_TraceCall("get_profile_angle", __pyx_f[0], 3889, 0, __PYX_ERR(0, 3889, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_easting);
  __Pyx_INCREF(__pyx_v_northing);
  __Pyx_INCREF(__pyx_v_msg);

  /* "gofast/tools/mathex.pyx":3909
 *     """
 *     msg = (
 *         "Need to import scipy.stats as a single module. Sometimes import scipy "             # <<<<<<<<<<<<<<
 *         "differently  with stats may not work. Use either `import scipy.stats`"
 *         " rather than `import scipy as sp`"
 */
  __Pyx_TraceLine(3909,0,__PYX_ERR(0, 3909, __pyx_L1_error))
  __Pyx_INCREF(__pyx_kp_u_Need_to_import_scipy_stats_as_a);
  __Pyx_DECREF_SET(__pyx_v_msg, __pyx_kp_u_Need_to_import_scipy_stats_as_a);

  /* "gofast/tools/mathex.pyx":3914
 *         )
 * 
 *     if easting is None or northing is None :             # <<<<<<<<<<<<<<
 *         raise TypeError('NoneType can not be computed !')
 * 
 */
  __Pyx_TraceLine(3914,0,__PYX_ERR(0, 3914, __pyx_L1_error))
  __pyx_t_2 = (__pyx_v_easting == ((PyObject*)Py_None));
  if (!__pyx_t_2) {
  } else {
    __pyx_t_1 = __pyx_t_2;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = (__pyx_v_northing == ((PyObject*)Py_None));
  __pyx_t_1 = __pyx_t_2;
  __pyx_L4_bool_binop_done:;
  if (unlikely(__pyx_t_1)) {

    /* "gofast/tools/mathex.pyx":3915
 * 
 *     if easting is None or northing is None :
 *         raise TypeError('NoneType can not be computed !')             # <<<<<<<<<<<<<<
 * 
 *         # use the one with the lower standard deviation
 */
    __Pyx_TraceLine(3915,0,__PYX_ERR(0, 3915, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__114, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3915, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_Raise(__pyx_t_3, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __PYX_ERR(0, 3915, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":3914
 *         )
 * 
 *     if easting is None or northing is None :             # <<<<<<<<<<<<<<
 *         raise TypeError('NoneType can not be computed !')
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":3918
 * 
 *         # use the one with the lower standard deviation
 *     try :             # <<<<<<<<<<<<<<
 *         easting = easting.astype('float')
 *         northing = northing.astype('float')
 */
  __Pyx_TraceLine(3918,0,__PYX_ERR(0, 3918, __pyx_L1_error))
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_4, &__pyx_t_5, &__pyx_t_6);
    __Pyx_XGOTREF(__pyx_t_4);
    __Pyx_XGOTREF(__pyx_t_5);
    __Pyx_XGOTREF(__pyx_t_6);
    /*try:*/ {

      /* "gofast/tools/mathex.pyx":3919
 *         # use the one with the lower standard deviation
 *     try :
 *         easting = easting.astype('float')             # <<<<<<<<<<<<<<
 *         northing = northing.astype('float')
 *     except :
 */
      __Pyx_TraceLine(3919,0,__PYX_ERR(0, 3919, __pyx_L6_error))
      __pyx_t_3 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyFloat_Type_astype, __pyx_v_easting, __pyx_n_u_float); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3919, __pyx_L6_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (!(likely(PyFloat_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None) || __Pyx_RaiseUnexpectedTypeError("float", __pyx_t_3))) __PYX_ERR(0, 3919, __pyx_L6_error)
      __Pyx_DECREF_SET(__pyx_v_easting, ((PyObject*)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":3920
 *     try :
 *         easting = easting.astype('float')
 *         northing = northing.astype('float')             # <<<<<<<<<<<<<<
 *     except :
 *         raise ValueError('Could not convert input argument to float!')
 */
      __Pyx_TraceLine(3920,0,__PYX_ERR(0, 3920, __pyx_L6_error))
      __pyx_t_3 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyFloat_Type_astype, __pyx_v_northing, __pyx_n_u_float); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3920, __pyx_L6_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (!(likely(PyFloat_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None) || __Pyx_RaiseUnexpectedTypeError("float", __pyx_t_3))) __PYX_ERR(0, 3920, __pyx_L6_error)
      __Pyx_DECREF_SET(__pyx_v_northing, ((PyObject*)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":3918
 * 
 *         # use the one with the lower standard deviation
 *     try :             # <<<<<<<<<<<<<<
 *         easting = easting.astype('float')
 *         northing = northing.astype('float')
 */
    }
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    goto __pyx_L11_try_end;
    __pyx_L6_error:;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":3921
 *         easting = easting.astype('float')
 *         northing = northing.astype('float')
 *     except :             # <<<<<<<<<<<<<<
 *         raise ValueError('Could not convert input argument to float!')
 *     try :
 */
    __Pyx_TraceLine(3921,0,__PYX_ERR(0, 3921, __pyx_L8_except_error))
    /*except:*/ {
      __Pyx_AddTraceback("gofast.tools.mathex.get_profile_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_3, &__pyx_t_7, &__pyx_t_8) < 0) __PYX_ERR(0, 3921, __pyx_L8_except_error)
      __Pyx_XGOTREF(__pyx_t_3);
      __Pyx_XGOTREF(__pyx_t_7);
      __Pyx_XGOTREF(__pyx_t_8);

      /* "gofast/tools/mathex.pyx":3922
 *         northing = northing.astype('float')
 *     except :
 *         raise ValueError('Could not convert input argument to float!')             # <<<<<<<<<<<<<<
 *     try :
 *         profile1 = spstats.linregress(easting, northing)
 */
      __Pyx_TraceLine(3922,0,__PYX_ERR(0, 3922, __pyx_L8_except_error))
      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__115, NULL); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3922, __pyx_L8_except_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_Raise(__pyx_t_9, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __PYX_ERR(0, 3922, __pyx_L8_except_error)
    }

    /* "gofast/tools/mathex.pyx":3918
 * 
 *         # use the one with the lower standard deviation
 *     try :             # <<<<<<<<<<<<<<
 *         easting = easting.astype('float')
 *         northing = northing.astype('float')
 */
    __pyx_L8_except_error:;
    __Pyx_XGIVEREF(__pyx_t_4);
    __Pyx_XGIVEREF(__pyx_t_5);
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_ExceptionReset(__pyx_t_4, __pyx_t_5, __pyx_t_6);
    goto __pyx_L1_error;
    __pyx_L11_try_end:;
  }

  /* "gofast/tools/mathex.pyx":3923
 *     except :
 *         raise ValueError('Could not convert input argument to float!')
 *     try :             # <<<<<<<<<<<<<<
 *         profile1 = spstats.linregress(easting, northing)
 *         profile2 =spstats.linregress(northing, easting)
 */
  __Pyx_TraceLine(3923,0,__PYX_ERR(0, 3923, __pyx_L1_error))
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_6, &__pyx_t_5, &__pyx_t_4);
    __Pyx_XGOTREF(__pyx_t_6);
    __Pyx_XGOTREF(__pyx_t_5);
    __Pyx_XGOTREF(__pyx_t_4);
    /*try:*/ {

      /* "gofast/tools/mathex.pyx":3924
 *         raise ValueError('Could not convert input argument to float!')
 *     try :
 *         profile1 = spstats.linregress(easting, northing)             # <<<<<<<<<<<<<<
 *         profile2 =spstats.linregress(northing, easting)
 *     except:
 */
      __Pyx_TraceLine(3924,0,__PYX_ERR(0, 3924, __pyx_L14_error))
      __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_spstats); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3924, __pyx_L14_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_linregress); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3924, __pyx_L14_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = NULL;
      __pyx_t_10 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_3))) {
        __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_3);
        if (likely(__pyx_t_7)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
          __Pyx_INCREF(__pyx_t_7);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_3, function);
          __pyx_t_10 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_7, __pyx_v_easting, __pyx_v_northing};
        __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_10, 2+__pyx_t_10);
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3924, __pyx_L14_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      }
      __pyx_v_profile1 = __pyx_t_8;
      __pyx_t_8 = 0;

      /* "gofast/tools/mathex.pyx":3925
 *     try :
 *         profile1 = spstats.linregress(easting, northing)
 *         profile2 =spstats.linregress(northing, easting)             # <<<<<<<<<<<<<<
 *     except:
 *         warnings.warn(msg)
 */
      __Pyx_TraceLine(3925,0,__PYX_ERR(0, 3925, __pyx_L14_error))
      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_spstats); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3925, __pyx_L14_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_linregress); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3925, __pyx_L14_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      __pyx_t_10 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_7))) {
        __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
        if (likely(__pyx_t_3)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
          __Pyx_INCREF(__pyx_t_3);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_7, function);
          __pyx_t_10 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_northing, __pyx_v_easting};
        __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_10, 2+__pyx_t_10);
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3925, __pyx_L14_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      }
      __pyx_v_profile2 = __pyx_t_8;
      __pyx_t_8 = 0;

      /* "gofast/tools/mathex.pyx":3923
 *     except :
 *         raise ValueError('Could not convert input argument to float!')
 *     try :             # <<<<<<<<<<<<<<
 *         profile1 = spstats.linregress(easting, northing)
 *         profile2 =spstats.linregress(northing, easting)
 */
    }
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L19_try_end;
    __pyx_L14_error:;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":3926
 *         profile1 = spstats.linregress(easting, northing)
 *         profile2 =spstats.linregress(northing, easting)
 *     except:             # <<<<<<<<<<<<<<
 *         warnings.warn(msg)
 * 
 */
    __Pyx_TraceLine(3926,0,__PYX_ERR(0, 3926, __pyx_L16_except_error))
    /*except:*/ {
      __Pyx_AddTraceback("gofast.tools.mathex.get_profile_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_8, &__pyx_t_7, &__pyx_t_3) < 0) __PYX_ERR(0, 3926, __pyx_L16_except_error)
      __Pyx_XGOTREF(__pyx_t_8);
      __Pyx_XGOTREF(__pyx_t_7);
      __Pyx_XGOTREF(__pyx_t_3);

      /* "gofast/tools/mathex.pyx":3927
 *         profile2 =spstats.linregress(northing, easting)
 *     except:
 *         warnings.warn(msg)             # <<<<<<<<<<<<<<
 * 
 *     profile_line = profile1[:2]
 */
      __Pyx_TraceLine(3927,0,__PYX_ERR(0, 3927, __pyx_L16_except_error))
      __Pyx_GetModuleGlobalName(__pyx_t_11, __pyx_n_s_warnings); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 3927, __pyx_L16_except_error)
      __Pyx_GOTREF(__pyx_t_11);
      __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_11, __pyx_n_s_warn); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 3927, __pyx_L16_except_error)
      __Pyx_GOTREF(__pyx_t_12);
      __Pyx_DECREF(__pyx_t_11); __pyx_t_11 = 0;
      __pyx_t_11 = NULL;
      __pyx_t_10 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_12))) {
        __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_12);
        if (likely(__pyx_t_11)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
          __Pyx_INCREF(__pyx_t_11);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_12, function);
          __pyx_t_10 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_v_msg};
        __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_12, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
        __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
        if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3927, __pyx_L16_except_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
      }
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L15_exception_handled;
    }

    /* "gofast/tools/mathex.pyx":3923
 *     except :
 *         raise ValueError('Could not convert input argument to float!')
 *     try :             # <<<<<<<<<<<<<<
 *         profile1 = spstats.linregress(easting, northing)
 *         profile2 =spstats.linregress(northing, easting)
 */
    __pyx_L16_except_error:;
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_XGIVEREF(__pyx_t_5);
    __Pyx_XGIVEREF(__pyx_t_4);
    __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_5, __pyx_t_4);
    goto __pyx_L1_error;
    __pyx_L15_exception_handled:;
    __Pyx_XGIVEREF(__pyx_t_6);
    __Pyx_XGIVEREF(__pyx_t_5);
    __Pyx_XGIVEREF(__pyx_t_4);
    __Pyx_ExceptionReset(__pyx_t_6, __pyx_t_5, __pyx_t_4);
    __pyx_L19_try_end:;
  }

  /* "gofast/tools/mathex.pyx":3929
 *         warnings.warn(msg)
 * 
 *     profile_line = profile1[:2]             # <<<<<<<<<<<<<<
 *     # if the profile is rather E=E(N),
 *     # the parameters have to converted  into N=N(E) form:
 */
  __Pyx_TraceLine(3929,0,__PYX_ERR(0, 3929, __pyx_L1_error))
  if (unlikely(!__pyx_v_profile1)) { __Pyx_RaiseUnboundLocalError("profile1"); __PYX_ERR(0, 3929, __pyx_L1_error) }
  __pyx_t_3 = __Pyx_PyObject_GetSlice(__pyx_v_profile1, 0, 2, NULL, NULL, &__pyx_slice__116, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3929, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_v_profile_line = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3933
 *     # the parameters have to converted  into N=N(E) form:
 * 
 *     if profile2[4] < profile1[4]:             # <<<<<<<<<<<<<<
 *         profile_line = (1. / profile2[0], -profile2[1] / profile2[0])
 * 
 */
  __Pyx_TraceLine(3933,0,__PYX_ERR(0, 3933, __pyx_L1_error))
  if (unlikely(!__pyx_v_profile2)) { __Pyx_RaiseUnboundLocalError("profile2"); __PYX_ERR(0, 3933, __pyx_L1_error) }
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_profile2, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3933, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (unlikely(!__pyx_v_profile1)) { __Pyx_RaiseUnboundLocalError("profile1"); __PYX_ERR(0, 3933, __pyx_L1_error) }
  __pyx_t_7 = __Pyx_GetItemInt(__pyx_v_profile1, 4, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3933, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_8 = PyObject_RichCompare(__pyx_t_3, __pyx_t_7, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3933, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 3933, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":3934
 * 
 *     if profile2[4] < profile1[4]:
 *         profile_line = (1. / profile2[0], -profile2[1] / profile2[0])             # <<<<<<<<<<<<<<
 * 
 *     # if self.profile_angle is None:
 */
    __Pyx_TraceLine(3934,0,__PYX_ERR(0, 3934, __pyx_L1_error))
    if (unlikely(!__pyx_v_profile2)) { __Pyx_RaiseUnboundLocalError("profile2"); __PYX_ERR(0, 3934, __pyx_L1_error) }
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_profile2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_7 = __Pyx_PyFloat_TrueDivideCObj(__pyx_float_1_, __pyx_t_8, 1., 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_v_profile2)) { __Pyx_RaiseUnboundLocalError("profile2"); __PYX_ERR(0, 3934, __pyx_L1_error) }
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_profile2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_3 = PyNumber_Negative(__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_v_profile2)) { __Pyx_RaiseUnboundLocalError("profile2"); __PYX_ERR(0, 3934, __pyx_L1_error) }
    __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_profile2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_GIVEREF(__pyx_t_7);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_7)) __PYX_ERR(0, 3934, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_9);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_9)) __PYX_ERR(0, 3934, __pyx_L1_error);
    __pyx_t_7 = 0;
    __pyx_t_9 = 0;
    __Pyx_DECREF_SET(__pyx_v_profile_line, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":3933
 *     # the parameters have to converted  into N=N(E) form:
 * 
 *     if profile2[4] < profile1[4]:             # <<<<<<<<<<<<<<
 *         profile_line = (1. / profile2[0], -profile2[1] / profile2[0])
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":3937
 * 
 *     # if self.profile_angle is None:
 *     profile_angle = (90 - (np.arctan(profile_line[0]) * 180 / np.pi)) % 180             # <<<<<<<<<<<<<<
 * 
 *     # otherwise: # have 90 degree ambiguity in
 */
  __Pyx_TraceLine(3937,0,__PYX_ERR(0, 3937, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_arctan); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_profile_line, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_3 = NULL;
  __pyx_t_10 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_10 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_9};
    __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3937, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = __Pyx_PyInt_MultiplyObjC(__pyx_t_8, __pyx_int_180, 0xB4, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_pi); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = __Pyx_PyInt_SubtractCObj(__pyx_int_90, __pyx_t_8, 90, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyInt_RemainderObjC(__pyx_t_9, __pyx_int_180, 0xB4, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3937, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_v_profile_angle = __pyx_t_8;
  __pyx_t_8 = 0;

  /* "gofast/tools/mathex.pyx":3942
 *     #strike determination# choose strike which offers larger
 *     #  angle with profile if profile azimuth is in [0,90].
 *     if msg=="raises":             # <<<<<<<<<<<<<<
 *         print("+++ -> Profile angle is {0:+.2f} degrees E of N".format(
 *                 profile_angle
 */
  __Pyx_TraceLine(3942,0,__PYX_ERR(0, 3942, __pyx_L1_error))
  __pyx_t_1 = (__Pyx_PyUnicode_Equals(__pyx_v_msg, __pyx_n_u_raises, Py_EQ)); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 3942, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":3943
 *     #  angle with profile if profile azimuth is in [0,90].
 *     if msg=="raises":
 *         print("+++ -> Profile angle is {0:+.2f} degrees E of N".format(             # <<<<<<<<<<<<<<
 *                 profile_angle
 *                 ) )
 */
    __Pyx_TraceLine(3943,0,__PYX_ERR(0, 3943, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_kp_u_Profile_angle_is_0_2f_degrees_E, __pyx_n_s_format); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3943, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);

    /* "gofast/tools/mathex.pyx":3944
 *     if msg=="raises":
 *         print("+++ -> Profile angle is {0:+.2f} degrees E of N".format(
 *                 profile_angle             # <<<<<<<<<<<<<<
 *                 ) )
 *     return np.around( profile_angle,2)
 */
    __Pyx_TraceLine(3944,0,__PYX_ERR(0, 3944, __pyx_L1_error))
    __pyx_t_7 = NULL;
    __pyx_t_10 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_7)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_7);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_10 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_v_profile_angle};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3943, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }

    /* "gofast/tools/mathex.pyx":3943
 *     #  angle with profile if profile azimuth is in [0,90].
 *     if msg=="raises":
 *         print("+++ -> Profile angle is {0:+.2f} degrees E of N".format(             # <<<<<<<<<<<<<<
 *                 profile_angle
 *                 ) )
 */
    __Pyx_TraceLine(3943,0,__PYX_ERR(0, 3943, __pyx_L1_error))
    __pyx_t_9 = __Pyx_PyObject_CallOneArg(__pyx_builtin_print, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3943, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":3942
 *     #strike determination# choose strike which offers larger
 *     #  angle with profile if profile azimuth is in [0,90].
 *     if msg=="raises":             # <<<<<<<<<<<<<<
 *         print("+++ -> Profile angle is {0:+.2f} degrees E of N".format(
 *                 profile_angle
 */
  }

  /* "gofast/tools/mathex.pyx":3946
 *                 profile_angle
 *                 ) )
 *     return np.around( profile_angle,2)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(3946,0,__PYX_ERR(0, 3946, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 3946, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_around); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 3946, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_10 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_10 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_8, __pyx_v_profile_angle, __pyx_int_2};
    __pyx_t_9 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_10, 2+__pyx_t_10);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 3946, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_r = __pyx_t_9;
  __pyx_t_9 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3889
 * #FR3: #0A4CEE # (10, 76, 238)
 * 
 * def get_profile_angle (             # <<<<<<<<<<<<<<
 *         easting: float =None, northing: float =None, msg:str ="ignore" ):
 *     """
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_AddTraceback("gofast.tools.mathex.get_profile_angle", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_profile1);
  __Pyx_XDECREF(__pyx_v_profile2);
  __Pyx_XDECREF(__pyx_v_profile_line);
  __Pyx_XDECREF(__pyx_v_profile_angle);
  __Pyx_XDECREF(__pyx_v_easting);
  __Pyx_XDECREF(__pyx_v_northing);
  __Pyx_XDECREF(__pyx_v_msg);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":3949
 * 
 * 
 * def savgol_coeffs(window_length, polyorder, deriv=0, delta=1.0, pos=None,             # <<<<<<<<<<<<<<
 *                   use="conv"):
 *     """Compute the coefficients for a 1-D Savitzky-Golay FIR filter.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_101savgol_coeffs(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_100savgol_coeffs, "Compute the coefficients for a 1-D Savitzky-Golay FIR filter.\n\n    Parameters\n    ----------\n    window_length : int\n        The length of the filter window (i.e., the number of coefficients).\n        `window_length` must be an odd positive integer.\n    polyorder : int\n        The order of the polynomial used to fit the samples.\n        `polyorder` must be less than `window_length`.\n    deriv : int, optional\n        The order of the derivative to compute. This must be a\n        nonnegative integer. The default is 0, which means to filter\n        the data without differentiating.\n    delta : float, optional\n        The spacing of the samples to which the filter will be applied.\n        This is only used if deriv > 0.\n    pos : int or None, optional\n        If pos is not None, it specifies evaluation position within the\n        window. The default is the middle of the window.\n    use : str, optional\n        Either 'conv' or 'dot'. This argument chooses the order of the\n        coefficients. The default is 'conv', which means that the\n        coefficients are ordered to be used in a convolution. With\n        use='dot', the order is reversed, so the filter is applied by\n        dotting the coefficients with the data set.\n\n    Returns\n    -------\n    coeffs : 1-D ndarray\n        The filter coefficients.\n\n    References\n    ----------\n    A. Savitzky, M. J. E. Golay, Smoothing and Differentiation of Data by\n    Simplified Least Squares Procedures. Analytical Chemistry, 1964, 36 (8),\n    pp 1627-1639.\n\n    See Also\n    --------\n    savgol_filter\n\n    Examples\n    --------\n    >>> from gofast.exmath.signal import savgol_coeffs\n    >>> savgol_coeffs(5, 2)\n    array([-0.08571429,  0.34285714,  0.48571429,  0.34285714, -0.08571429])\n    >>> savgol_coeffs(5, 2, deriv=1)\n    array([ 2.00000000e-01,  1.00000000e-01,  2.07548111e-16, -1.00000000e-01,\n           -2.00000000e-01])\n\n    Note that use='dot' simply reverses the coeffic""ients.\n\n    >>> savgol_coeffs(5, 2, pos=3)\n    array([ 0.25714286,  0.37142857,  0.34285714,  0.17142857, -0.14285714])\n    >>> savgol_coeffs(5, 2, pos=3, use='dot')\n    array([-0.14285714,  0.17142857,  0.34285714,  0.37142857,  0.25714286])\n\n    `x` contains data from the parabola x = t**2, sampled at\n    t = -1, 0, 1, 2, 3.  `c` holds the coefficients that will compute the\n    derivative at the last position.  When dotted with `x` the result should\n    be 6.\n\n    >>> x = np.array([1, 0, 1, 4, 9])\n    >>> c = savgol_coeffs(5, 2, pos=4, deriv=1, use='dot')\n    >>> c.dot(x)\n    6.0\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_101savgol_coeffs = {"savgol_coeffs", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_101savgol_coeffs, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_100savgol_coeffs};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_101savgol_coeffs(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_window_length = 0;
  PyObject *__pyx_v_polyorder = 0;
  PyObject *__pyx_v_deriv = 0;
  PyObject *__pyx_v_delta = 0;
  PyObject *__pyx_v_pos = 0;
  PyObject *__pyx_v_use = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[6] = {0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("savgol_coeffs (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_window_length,&__pyx_n_s_polyorder,&__pyx_n_s_deriv,&__pyx_n_s_delta,&__pyx_n_s_pos,&__pyx_n_s_use,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_0)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1_0)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)Py_None));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_conv)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_length)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3949, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_polyorder)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3949, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("savgol_coeffs", 0, 2, 6, 1); __PYX_ERR(0, 3949, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_deriv);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3949, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_delta);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3949, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_pos);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3949, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_use);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 3949, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "savgol_coeffs") < 0)) __PYX_ERR(0, 3949, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_window_length = values[0];
    __pyx_v_polyorder = values[1];
    __pyx_v_deriv = values[2];
    __pyx_v_delta = values[3];
    __pyx_v_pos = values[4];
    __pyx_v_use = values[5];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("savgol_coeffs", 0, 2, 6, __pyx_nargs); __PYX_ERR(0, 3949, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.savgol_coeffs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_100savgol_coeffs(__pyx_self, __pyx_v_window_length, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_pos, __pyx_v_use);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_100savgol_coeffs(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_window_length, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_pos, PyObject *__pyx_v_use) {
  PyObject *__pyx_v_halflen = NULL;
  PyObject *__pyx_v_rem = NULL;
  PyObject *__pyx_v_coeffs = NULL;
  PyObject *__pyx_v_x = NULL;
  PyObject *__pyx_v_order = NULL;
  PyObject *__pyx_v_A = NULL;
  PyObject *__pyx_v_y = NULL;
  CYTHON_UNUSED PyObject *__pyx_v__ = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *(*__pyx_t_6)(PyObject *);
  int __pyx_t_7;
  int __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__117)
  __Pyx_RefNannySetupContext("savgol_coeffs", 0);
  __Pyx_TraceCall("savgol_coeffs", __pyx_f[0], 3949, 0, __PYX_ERR(0, 3949, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_pos);

  /* "gofast/tools/mathex.pyx":4032
 *     #    c = savgol_coeffs(window_length, M, pos=pos, use='dot')
 * 
 *     if polyorder >= window_length:             # <<<<<<<<<<<<<<
 *         raise ValueError("polyorder must be less than window_length.")
 * 
 */
  __Pyx_TraceLine(4032,0,__PYX_ERR(0, 4032, __pyx_L1_error))
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_polyorder, __pyx_v_window_length, Py_GE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4032, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4032, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(__pyx_t_2)) {

    /* "gofast/tools/mathex.pyx":4033
 * 
 *     if polyorder >= window_length:
 *         raise ValueError("polyorder must be less than window_length.")             # <<<<<<<<<<<<<<
 * 
 *     halflen, rem = divmod(window_length, 2)
 */
    __Pyx_TraceLine(4033,0,__PYX_ERR(0, 4033, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__118, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4033, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4033, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4032
 *     #    c = savgol_coeffs(window_length, M, pos=pos, use='dot')
 * 
 *     if polyorder >= window_length:             # <<<<<<<<<<<<<<
 *         raise ValueError("polyorder must be less than window_length.")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4035
 *         raise ValueError("polyorder must be less than window_length.")
 * 
 *     halflen, rem = divmod(window_length, 2)             # <<<<<<<<<<<<<<
 * 
 *     if rem == 0:
 */
  __Pyx_TraceLine(4035,0,__PYX_ERR(0, 4035, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Divmod(__pyx_v_window_length, __pyx_int_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4035, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 4035, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_4);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4035, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4035, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_5 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4035, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
    index = 0; __pyx_t_3 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_3)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_4 = __pyx_t_6(__pyx_t_5); if (unlikely(!__pyx_t_4)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_4);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_5), 2) < 0) __PYX_ERR(0, 4035, __pyx_L1_error)
    __pyx_t_6 = NULL;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L5_unpacking_done;
    __pyx_L4_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 4035, __pyx_L1_error)
    __pyx_L5_unpacking_done:;
  }
  __pyx_v_halflen = __pyx_t_3;
  __pyx_t_3 = 0;
  __pyx_v_rem = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4037
 *     halflen, rem = divmod(window_length, 2)
 * 
 *     if rem == 0:             # <<<<<<<<<<<<<<
 *         raise ValueError("window_length must be odd.")
 * 
 */
  __Pyx_TraceLine(4037,0,__PYX_ERR(0, 4037, __pyx_L1_error))
  __pyx_t_2 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_rem, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4037, __pyx_L1_error)
  if (unlikely(__pyx_t_2)) {

    /* "gofast/tools/mathex.pyx":4038
 * 
 *     if rem == 0:
 *         raise ValueError("window_length must be odd.")             # <<<<<<<<<<<<<<
 * 
 *     if pos is None:
 */
    __Pyx_TraceLine(4038,0,__PYX_ERR(0, 4038, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__119, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4038, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4038, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4037
 *     halflen, rem = divmod(window_length, 2)
 * 
 *     if rem == 0:             # <<<<<<<<<<<<<<
 *         raise ValueError("window_length must be odd.")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4040
 *         raise ValueError("window_length must be odd.")
 * 
 *     if pos is None:             # <<<<<<<<<<<<<<
 *         pos = halflen
 * 
 */
  __Pyx_TraceLine(4040,0,__PYX_ERR(0, 4040, __pyx_L1_error))
  __pyx_t_2 = (__pyx_v_pos == Py_None);
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":4041
 * 
 *     if pos is None:
 *         pos = halflen             # <<<<<<<<<<<<<<
 * 
 *     if not (0 <= pos < window_length):
 */
    __Pyx_TraceLine(4041,0,__PYX_ERR(0, 4041, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_halflen);
    __Pyx_DECREF_SET(__pyx_v_pos, __pyx_v_halflen);

    /* "gofast/tools/mathex.pyx":4040
 *         raise ValueError("window_length must be odd.")
 * 
 *     if pos is None:             # <<<<<<<<<<<<<<
 *         pos = halflen
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4043
 *         pos = halflen
 * 
 *     if not (0 <= pos < window_length):             # <<<<<<<<<<<<<<
 *         raise ValueError("pos must be nonnegative and less than "
 *                          "window_length.")
 */
  __Pyx_TraceLine(4043,0,__PYX_ERR(0, 4043, __pyx_L1_error))
  __pyx_t_1 = PyObject_RichCompare(__pyx_int_0, __pyx_v_pos, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4043, __pyx_L1_error)
  if (__Pyx_PyObject_IsTrue(__pyx_t_1)) {
    __Pyx_DECREF(__pyx_t_1);
    __pyx_t_1 = PyObject_RichCompare(__pyx_v_pos, __pyx_v_window_length, Py_LT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4043, __pyx_L1_error)
  }
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4043, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_7 = (!__pyx_t_2);
  if (unlikely(__pyx_t_7)) {

    /* "gofast/tools/mathex.pyx":4044
 * 
 *     if not (0 <= pos < window_length):
 *         raise ValueError("pos must be nonnegative and less than "             # <<<<<<<<<<<<<<
 *                          "window_length.")
 * 
 */
    __Pyx_TraceLine(4044,0,__PYX_ERR(0, 4044, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__120, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4044, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4044, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4043
 *         pos = halflen
 * 
 *     if not (0 <= pos < window_length):             # <<<<<<<<<<<<<<
 *         raise ValueError("pos must be nonnegative and less than "
 *                          "window_length.")
 */
  }

  /* "gofast/tools/mathex.pyx":4047
 *                          "window_length.")
 * 
 *     if use not in ['conv', 'dot']:             # <<<<<<<<<<<<<<
 *         raise ValueError("`use` must be 'conv' or 'dot'")
 * 
 */
  __Pyx_TraceLine(4047,0,__PYX_ERR(0, 4047, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_use);
  __pyx_t_1 = __pyx_v_use;
  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_conv, Py_NE)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4047, __pyx_L1_error)
  if (__pyx_t_2) {
  } else {
    __pyx_t_7 = __pyx_t_2;
    goto __pyx_L10_bool_binop_done;
  }
  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_dot, Py_NE)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4047, __pyx_L1_error)
  __pyx_t_7 = __pyx_t_2;
  __pyx_L10_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __pyx_t_7;
  if (unlikely(__pyx_t_2)) {

    /* "gofast/tools/mathex.pyx":4048
 * 
 *     if use not in ['conv', 'dot']:
 *         raise ValueError("`use` must be 'conv' or 'dot'")             # <<<<<<<<<<<<<<
 * 
 *     if deriv > polyorder:
 */
    __Pyx_TraceLine(4048,0,__PYX_ERR(0, 4048, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__121, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4048, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4048, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4047
 *                          "window_length.")
 * 
 *     if use not in ['conv', 'dot']:             # <<<<<<<<<<<<<<
 *         raise ValueError("`use` must be 'conv' or 'dot'")
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4050
 *         raise ValueError("`use` must be 'conv' or 'dot'")
 * 
 *     if deriv > polyorder:             # <<<<<<<<<<<<<<
 *         coeffs = np.zeros(window_length)
 *         return coeffs
 */
  __Pyx_TraceLine(4050,0,__PYX_ERR(0, 4050, __pyx_L1_error))
  __pyx_t_1 = PyObject_RichCompare(__pyx_v_deriv, __pyx_v_polyorder, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4050, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4050, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":4051
 * 
 *     if deriv > polyorder:
 *         coeffs = np.zeros(window_length)             # <<<<<<<<<<<<<<
 *         return coeffs
 * 
 */
    __Pyx_TraceLine(4051,0,__PYX_ERR(0, 4051, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4051, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4051, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_8 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_8 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_window_length};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4051, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_coeffs = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4052
 *     if deriv > polyorder:
 *         coeffs = np.zeros(window_length)
 *         return coeffs             # <<<<<<<<<<<<<<
 * 
 *     # Form the design matrix A. The columns of A are powers of the integers
 */
    __Pyx_TraceLine(4052,0,__PYX_ERR(0, 4052, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_coeffs);
    __pyx_r = __pyx_v_coeffs;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":4050
 *         raise ValueError("`use` must be 'conv' or 'dot'")
 * 
 *     if deriv > polyorder:             # <<<<<<<<<<<<<<
 *         coeffs = np.zeros(window_length)
 *         return coeffs
 */
  }

  /* "gofast/tools/mathex.pyx":4058
 *     # from 0 to polyorder. (That is, A is a vandermonde matrix, but not
 *     # necessarily square.)
 *     x = np.arange(-pos, window_length - pos, dtype=float)             # <<<<<<<<<<<<<<
 *     if use == "conv":
 *         # Reverse so that result can be used in a convolution.
 */
  __Pyx_TraceLine(4058,0,__PYX_ERR(0, 4058, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Negative(__pyx_v_pos); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_4 = PyNumber_Subtract(__pyx_v_window_length, __pyx_v_pos); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_1)) __PYX_ERR(0, 4058, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_4)) __PYX_ERR(0, 4058, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_dtype, ((PyObject *)(&PyFloat_Type))) < 0) __PYX_ERR(0, 4058, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4058, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_x = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4059
 *     # necessarily square.)
 *     x = np.arange(-pos, window_length - pos, dtype=float)
 *     if use == "conv":             # <<<<<<<<<<<<<<
 *         # Reverse so that result can be used in a convolution.
 *         x = x[::-1]
 */
  __Pyx_TraceLine(4059,0,__PYX_ERR(0, 4059, __pyx_L1_error))
  __pyx_t_2 = (__Pyx_PyUnicode_Equals(__pyx_v_use, __pyx_n_u_conv, Py_EQ)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4059, __pyx_L1_error)
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":4061
 *     if use == "conv":
 *         # Reverse so that result can be used in a convolution.
 *         x = x[::-1]             # <<<<<<<<<<<<<<
 * 
 *     order = np.arange(polyorder + 1).reshape(-1, 1)
 */
    __Pyx_TraceLine(4061,0,__PYX_ERR(0, 4061, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_x, __pyx_slice__69); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4061, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4059
 *     # necessarily square.)
 *     x = np.arange(-pos, window_length - pos, dtype=float)
 *     if use == "conv":             # <<<<<<<<<<<<<<
 *         # Reverse so that result can be used in a convolution.
 *         x = x[::-1]
 */
  }

  /* "gofast/tools/mathex.pyx":4063
 *         x = x[::-1]
 * 
 *     order = np.arange(polyorder + 1).reshape(-1, 1)             # <<<<<<<<<<<<<<
 *     A = x ** order
 * 
 */
  __Pyx_TraceLine(4063,0,__PYX_ERR(0, 4063, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_AddObjC(__pyx_v_polyorder, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4063, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_reshape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4063, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_order = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4064
 * 
 *     order = np.arange(polyorder + 1).reshape(-1, 1)
 *     A = x ** order             # <<<<<<<<<<<<<<
 * 
 *     # y determines which order derivative is returned.
 */
  __Pyx_TraceLine(4064,0,__PYX_ERR(0, 4064, __pyx_L1_error))
  __pyx_t_1 = PyNumber_Power(__pyx_v_x, __pyx_v_order, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4064, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_A = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4067
 * 
 *     # y determines which order derivative is returned.
 *     y = np.zeros(polyorder + 1)             # <<<<<<<<<<<<<<
 *     # The coefficient assigned to y[deriv] scales the result to take into
 *     # account the order of the derivative and the sample spacing.
 */
  __Pyx_TraceLine(4067,0,__PYX_ERR(0, 4067, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4067, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4067, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_v_polyorder, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4067, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_5};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4067, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_v_y = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4070
 *     # The coefficient assigned to y[deriv] scales the result to take into
 *     # account the order of the derivative and the sample spacing.
 *     y[deriv] = float_factorial(deriv) / (delta ** deriv)             # <<<<<<<<<<<<<<
 * 
 *     # Find the least-squares solution of A*c = y
 */
  __Pyx_TraceLine(4070,0,__PYX_ERR(0, 4070, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_float_factorial); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4070, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_deriv};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = PyNumber_Power(__pyx_v_delta, __pyx_v_deriv, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4070, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyNumber_Divide(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4070, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (unlikely((PyObject_SetItem(__pyx_v_y, __pyx_v_deriv, __pyx_t_5) < 0))) __PYX_ERR(0, 4070, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":4073
 * 
 *     # Find the least-squares solution of A*c = y
 *     coeffs, _, _, _ = lstsq(A, y)             # <<<<<<<<<<<<<<
 * 
 *     return coeffs
 */
  __Pyx_TraceLine(4073,0,__PYX_ERR(0, 4073, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_lstsq); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4073, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_1, __pyx_v_A, __pyx_v_y};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_8, 2+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4073, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  if ((likely(PyTuple_CheckExact(__pyx_t_5))) || (PyList_CheckExact(__pyx_t_5))) {
    PyObject* sequence = __pyx_t_5;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 4)) {
      if (size > 4) __Pyx_RaiseTooManyValuesError(4);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 4073, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_4 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 2); 
      __pyx_t_9 = PyTuple_GET_ITEM(sequence, 3); 
    } else {
      __pyx_t_4 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
      __pyx_t_3 = PyList_GET_ITEM(sequence, 2); 
      __pyx_t_9 = PyList_GET_ITEM(sequence, 3); 
    }
    __Pyx_INCREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_9);
    #else
    {
      Py_ssize_t i;
      PyObject** temps[4] = {&__pyx_t_4,&__pyx_t_1,&__pyx_t_3,&__pyx_t_9};
      for (i=0; i < 4; i++) {
        PyObject* item = PySequence_ITEM(sequence, i); if (unlikely(!item)) __PYX_ERR(0, 4073, __pyx_L1_error)
        __Pyx_GOTREF(item);
        *(temps[i]) = item;
      }
    }
    #endif
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  } else {
    Py_ssize_t index = -1;
    PyObject** temps[4] = {&__pyx_t_4,&__pyx_t_1,&__pyx_t_3,&__pyx_t_9};
    __pyx_t_10 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4073, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_10);
    for (index=0; index < 4; index++) {
      PyObject* item = __pyx_t_6(__pyx_t_10); if (unlikely(!item)) goto __pyx_L14_unpacking_failed;
      __Pyx_GOTREF(item);
      *(temps[index]) = item;
    }
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_6(__pyx_t_10), 4) < 0) __PYX_ERR(0, 4073, __pyx_L1_error)
    __pyx_t_6 = NULL;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    goto __pyx_L15_unpacking_done;
    __pyx_L14_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_6 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 4073, __pyx_L1_error)
    __pyx_L15_unpacking_done:;
  }
  __pyx_v_coeffs = __pyx_t_4;
  __pyx_t_4 = 0;
  __pyx_v__ = __pyx_t_1;
  __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v__, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v__, __pyx_t_9);
  __pyx_t_9 = 0;

  /* "gofast/tools/mathex.pyx":4075
 *     coeffs, _, _, _ = lstsq(A, y)
 * 
 *     return coeffs             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(4075,0,__PYX_ERR(0, 4075, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_coeffs);
  __pyx_r = __pyx_v_coeffs;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":3949
 * 
 * 
 * def savgol_coeffs(window_length, polyorder, deriv=0, delta=1.0, pos=None,             # <<<<<<<<<<<<<<
 *                   use="conv"):
 *     """Compute the coefficients for a 1-D Savitzky-Golay FIR filter.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex.savgol_coeffs", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_halflen);
  __Pyx_XDECREF(__pyx_v_rem);
  __Pyx_XDECREF(__pyx_v_coeffs);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_order);
  __Pyx_XDECREF(__pyx_v_A);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF(__pyx_v__);
  __Pyx_XDECREF(__pyx_v_pos);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4078
 * 
 * 
 * def _polyder(p, m):             # <<<<<<<<<<<<<<
 *     """Differentiate polynomials represented with coefficients.
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_103_polyder(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_102_polyder, "Differentiate polynomials represented with coefficients.\n\n    p must be a 1-D or 2-D array.  In the 2-D case, each column gives\n    the coefficients of a polynomial; the first row holds the coefficients\n    associated with the highest power. m must be a nonnegative integer.\n    (numpy.polyder doesn't handle the 2-D case.)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_103_polyder = {"_polyder", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_103_polyder, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_102_polyder};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_103_polyder(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_p = 0;
  PyObject *__pyx_v_m = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_polyder (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_p,&__pyx_n_s_m,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_p)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4078, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_m)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4078, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_polyder", 1, 2, 2, 1); __PYX_ERR(0, 4078, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_polyder") < 0)) __PYX_ERR(0, 4078, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_p = values[0];
    __pyx_v_m = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_polyder", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 4078, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._polyder", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_102_polyder(__pyx_self, __pyx_v_p, __pyx_v_m);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_102_polyder(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_p, PyObject *__pyx_v_m) {
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_v_dp = NULL;
  PyObject *__pyx_v_k = NULL;
  PyObject *__pyx_v_rng = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  int __pyx_t_1;
  Py_ssize_t __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *(*__pyx_t_8)(PyObject *);
  PyObject *__pyx_t_9 = NULL;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__122)
  __Pyx_RefNannySetupContext("_polyder", 1);
  __Pyx_TraceCall("_polyder", __pyx_f[0], 4078, 0, __PYX_ERR(0, 4078, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":4087
 *     """
 * 
 *     if m == 0:             # <<<<<<<<<<<<<<
 *         result = p
 *     else:
 */
  __Pyx_TraceLine(4087,0,__PYX_ERR(0, 4087, __pyx_L1_error))
  __pyx_t_1 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_m, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 4087, __pyx_L1_error)
  if (__pyx_t_1) {

    /* "gofast/tools/mathex.pyx":4088
 * 
 *     if m == 0:
 *         result = p             # <<<<<<<<<<<<<<
 *     else:
 *         n = len(p)
 */
    __Pyx_TraceLine(4088,0,__PYX_ERR(0, 4088, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_p);
    __pyx_v_result = __pyx_v_p;

    /* "gofast/tools/mathex.pyx":4087
 *     """
 * 
 *     if m == 0:             # <<<<<<<<<<<<<<
 *         result = p
 *     else:
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":4090
 *         result = p
 *     else:
 *         n = len(p)             # <<<<<<<<<<<<<<
 *         if n <= m:
 *             result = np.zeros_like(p[:1, ...])
 */
  __Pyx_TraceLine(4090,0,__PYX_ERR(0, 4090, __pyx_L1_error))
  /*else*/ {
    __pyx_t_2 = PyObject_Length(__pyx_v_p); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4090, __pyx_L1_error)
    __pyx_t_3 = PyInt_FromSsize_t(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4090, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_v_n = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4091
 *     else:
 *         n = len(p)
 *         if n <= m:             # <<<<<<<<<<<<<<
 *             result = np.zeros_like(p[:1, ...])
 *         else:
 */
    __Pyx_TraceLine(4091,0,__PYX_ERR(0, 4091, __pyx_L1_error))
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_n, __pyx_v_m, Py_LE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4091, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_1 < 0))) __PYX_ERR(0, 4091, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_1) {

      /* "gofast/tools/mathex.pyx":4092
 *         n = len(p)
 *         if n <= m:
 *             result = np.zeros_like(p[:1, ...])             # <<<<<<<<<<<<<<
 *         else:
 *             dp = p[:-m].copy()
 */
      __Pyx_TraceLine(4092,0,__PYX_ERR(0, 4092, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_zeros_like); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_p, __pyx_tuple__124); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4092, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_6 = NULL;
      __pyx_t_7 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_6)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_6);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_7 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_4};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4092, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __pyx_v_result = __pyx_t_3;
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":4091
 *     else:
 *         n = len(p)
 *         if n <= m:             # <<<<<<<<<<<<<<
 *             result = np.zeros_like(p[:1, ...])
 *         else:
 */
      goto __pyx_L4;
    }

    /* "gofast/tools/mathex.pyx":4094
 *             result = np.zeros_like(p[:1, ...])
 *         else:
 *             dp = p[:-m].copy()             # <<<<<<<<<<<<<<
 *             for k in range(m):
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)
 */
    __Pyx_TraceLine(4094,0,__PYX_ERR(0, 4094, __pyx_L1_error))
    /*else*/ {
      __pyx_t_5 = PyNumber_Negative(__pyx_v_m); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4094, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = __Pyx_PyObject_GetSlice(__pyx_v_p, 0, 0, NULL, &__pyx_t_5, NULL, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4094, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_copy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4094, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_7 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_7 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4094, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __pyx_v_dp = __pyx_t_3;
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":4095
 *         else:
 *             dp = p[:-m].copy()
 *             for k in range(m):             # <<<<<<<<<<<<<<
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))
 */
      __Pyx_TraceLine(4095,0,__PYX_ERR(0, 4095, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_v_m); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4095, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
        __pyx_t_5 = __pyx_t_3; __Pyx_INCREF(__pyx_t_5);
        __pyx_t_2 = 0;
        __pyx_t_8 = NULL;
      } else {
        __pyx_t_2 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4095, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_5);
        __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4095, __pyx_L1_error)
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      for (;;) {
        if (likely(!__pyx_t_8)) {
          if (likely(PyList_CheckExact(__pyx_t_5))) {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_5);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4095, __pyx_L1_error)
              #endif
              if (__pyx_t_2 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_3 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 4095, __pyx_L1_error)
            #else
            __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4095, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_3);
            #endif
          } else {
            {
              Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_5);
              #if !CYTHON_ASSUME_SAFE_MACROS
              if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4095, __pyx_L1_error)
              #endif
              if (__pyx_t_2 >= __pyx_temp) break;
            }
            #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
            __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_2); __Pyx_INCREF(__pyx_t_3); __pyx_t_2++; if (unlikely((0 < 0))) __PYX_ERR(0, 4095, __pyx_L1_error)
            #else
            __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_5, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4095, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_3);
            #endif
          }
        } else {
          __pyx_t_3 = __pyx_t_8(__pyx_t_5);
          if (unlikely(!__pyx_t_3)) {
            PyObject* exc_type = PyErr_Occurred();
            if (exc_type) {
              if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
              else __PYX_ERR(0, 4095, __pyx_L1_error)
            }
            break;
          }
          __Pyx_GOTREF(__pyx_t_3);
        }
        __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "gofast/tools/mathex.pyx":4096
 *             dp = p[:-m].copy()
 *             for k in range(m):
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)             # <<<<<<<<<<<<<<
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))
 *             result = dp
 */
        __Pyx_TraceLine(4096,0,__PYX_ERR(0, 4096, __pyx_L1_error))
        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4096, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_arange); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4096, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyNumber_Subtract(__pyx_v_n, __pyx_v_k); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4096, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_9 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4096, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyNumber_Subtract(__pyx_v_m, __pyx_v_k); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4096, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_10 = __Pyx_PyInt_SubtractObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4096, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = NULL;
        __pyx_t_7 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
            __pyx_t_7 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[4] = {__pyx_t_4, __pyx_t_9, __pyx_t_10, __pyx_int_neg_1};
          __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 3+__pyx_t_7);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
          __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
          if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4096, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
        __Pyx_XDECREF_SET(__pyx_v_rng, __pyx_t_3);
        __pyx_t_3 = 0;

        /* "gofast/tools/mathex.pyx":4097
 *             for k in range(m):
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))             # <<<<<<<<<<<<<<
 *             result = dp
 *     return result
 */
        __Pyx_TraceLine(4097,0,__PYX_ERR(0, 4097, __pyx_L1_error))
        __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_rng, __pyx_n_s_reshape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __pyx_t_10 = PyNumber_Subtract(__pyx_v_n, __pyx_v_m); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_9);
        __Pyx_GIVEREF(__pyx_t_10);
        if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_t_10)) __PYX_ERR(0, 4097, __pyx_L1_error);
        __pyx_t_10 = 0;
        __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_v_p, __pyx_n_s_ndim); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __pyx_t_4 = __Pyx_PyInt_SubtractObjC(__pyx_t_10, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = PyNumber_Multiply(__pyx_tuple__125, __pyx_t_4); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_10);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = PyNumber_Add(__pyx_t_9, __pyx_t_10); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
        __pyx_t_10 = NULL;
        __pyx_t_7 = 0;
        #if CYTHON_UNPACK_METHODS
        if (likely(PyMethod_Check(__pyx_t_6))) {
          __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_6);
          if (likely(__pyx_t_10)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
            __Pyx_INCREF(__pyx_t_10);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_6, function);
            __pyx_t_7 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_4};
          __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
          __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
          __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
          if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4097, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
        }
        __pyx_t_6 = PyNumber_InPlaceMultiply(__pyx_v_dp, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4097, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_6);
        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_DECREF_SET(__pyx_v_dp, __pyx_t_6);
        __pyx_t_6 = 0;

        /* "gofast/tools/mathex.pyx":4095
 *         else:
 *             dp = p[:-m].copy()
 *             for k in range(m):             # <<<<<<<<<<<<<<
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))
 */
        __Pyx_TraceLine(4095,0,__PYX_ERR(0, 4095, __pyx_L1_error))
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "gofast/tools/mathex.pyx":4098
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))
 *             result = dp             # <<<<<<<<<<<<<<
 *     return result
 * 
 */
      __Pyx_TraceLine(4098,0,__PYX_ERR(0, 4098, __pyx_L1_error))
      __Pyx_INCREF(__pyx_v_dp);
      __pyx_v_result = __pyx_v_dp;
    }
    __pyx_L4:;
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":4099
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))
 *             result = dp
 *     return result             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(4099,0,__PYX_ERR(0, 4099, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4078
 * 
 * 
 * def _polyder(p, m):             # <<<<<<<<<<<<<<
 *     """Differentiate polynomials represented with coefficients.
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex._polyder", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XDECREF(__pyx_v_dp);
  __Pyx_XDECREF(__pyx_v_k);
  __Pyx_XDECREF(__pyx_v_rng);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4102
 * 
 * 
 * def _fit_edge(x, window_start, window_stop, interp_start, interp_stop,             # <<<<<<<<<<<<<<
 *               axis, polyorder, deriv, delta, y):
 *     """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_105_fit_edge(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_104_fit_edge, "\n    Given an N-d array `x` and the specification of a slice of `x` from\n    `window_start` to `window_stop` along `axis`, create an interpolating\n    polynomial of each 1-D slice, and evaluate that polynomial in the slice\n    from `interp_start` to `interp_stop`. Put the result into the\n    corresponding slice of `y`.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_105_fit_edge = {"_fit_edge", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_105_fit_edge, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_104_fit_edge};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_105_fit_edge(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_window_start = 0;
  PyObject *__pyx_v_window_stop = 0;
  PyObject *__pyx_v_interp_start = 0;
  PyObject *__pyx_v_interp_stop = 0;
  PyObject *__pyx_v_axis = 0;
  PyObject *__pyx_v_polyorder = 0;
  PyObject *__pyx_v_deriv = 0;
  PyObject *__pyx_v_delta = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[10] = {0,0,0,0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_fit_edge (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_window_start,&__pyx_n_s_window_stop,&__pyx_n_s_interp_start,&__pyx_n_s_interp_stop,&__pyx_n_s_axis,&__pyx_n_s_polyorder,&__pyx_n_s_deriv,&__pyx_n_s_delta,&__pyx_n_s_y,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case 10: values[9] = __Pyx_Arg_FASTCALL(__pyx_args, 9);
        CYTHON_FALLTHROUGH;
        case  9: values[8] = __Pyx_Arg_FASTCALL(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_start)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 1); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_stop)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 2); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_interp_start)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 3); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_interp_stop)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 4); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_axis)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[5]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 5); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_polyorder)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[6]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 6); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (likely((values[7] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_deriv)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[7]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 7); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (likely((values[8] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_delta)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[8]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 8); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  9:
        if (likely((values[9] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[9]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4102, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, 9); __PYX_ERR(0, 4102, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_fit_edge") < 0)) __PYX_ERR(0, 4102, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 10)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
      values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
      values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
      values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
      values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
      values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
      values[8] = __Pyx_Arg_FASTCALL(__pyx_args, 8);
      values[9] = __Pyx_Arg_FASTCALL(__pyx_args, 9);
    }
    __pyx_v_x = values[0];
    __pyx_v_window_start = values[1];
    __pyx_v_window_stop = values[2];
    __pyx_v_interp_start = values[3];
    __pyx_v_interp_stop = values[4];
    __pyx_v_axis = values[5];
    __pyx_v_polyorder = values[6];
    __pyx_v_deriv = values[7];
    __pyx_v_delta = values[8];
    __pyx_v_y = values[9];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_fit_edge", 1, 10, 10, __pyx_nargs); __PYX_ERR(0, 4102, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._fit_edge", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_104_fit_edge(__pyx_self, __pyx_v_x, __pyx_v_window_start, __pyx_v_window_stop, __pyx_v_interp_start, __pyx_v_interp_stop, __pyx_v_axis, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_104_fit_edge(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_window_start, PyObject *__pyx_v_window_stop, PyObject *__pyx_v_interp_start, PyObject *__pyx_v_interp_stop, PyObject *__pyx_v_axis, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_y) {
  PyObject *__pyx_v_x_edge = NULL;
  PyObject *__pyx_v_xx_edge = NULL;
  int __pyx_v_swapped;
  PyObject *__pyx_v_poly_coeffs = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_values = NULL;
  PyObject *__pyx_v_shp = NULL;
  PyObject *__pyx_v_y_edge = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__126)
  __Pyx_RefNannySetupContext("_fit_edge", 1);
  __Pyx_TraceCall("_fit_edge", __pyx_f[0], 4102, 0, __PYX_ERR(0, 4102, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":4113
 * 
 *     # Get the edge into a (window_length, -1) array.
 *     x_edge = axis_slice(x, start=window_start, stop=window_stop, axis=axis)             # <<<<<<<<<<<<<<
 *     if axis == 0 or axis == -x.ndim:
 *         xx_edge = x_edge
 */
  __Pyx_TraceLine(4113,0,__PYX_ERR(0, 4113, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_axis_slice); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_x)) __PYX_ERR(0, 4113, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_start, __pyx_v_window_start) < 0) __PYX_ERR(0, 4113, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_stop, __pyx_v_window_stop) < 0) __PYX_ERR(0, 4113, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_axis, __pyx_v_axis) < 0) __PYX_ERR(0, 4113, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4113, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_x_edge = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4114
 *     # Get the edge into a (window_length, -1) array.
 *     x_edge = axis_slice(x, start=window_start, stop=window_stop, axis=axis)
 *     if axis == 0 or axis == -x.ndim:             # <<<<<<<<<<<<<<
 *         xx_edge = x_edge
 *         swapped = False
 */
  __Pyx_TraceLine(4114,0,__PYX_ERR(0, 4114, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_axis, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4114, __pyx_L1_error)
  if (!__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_ndim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4114, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyNumber_Negative(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4114, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_axis, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4114, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __pyx_t_6;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":4115
 *     x_edge = axis_slice(x, start=window_start, stop=window_stop, axis=axis)
 *     if axis == 0 or axis == -x.ndim:
 *         xx_edge = x_edge             # <<<<<<<<<<<<<<
 *         swapped = False
 *     else:
 */
    __Pyx_TraceLine(4115,0,__PYX_ERR(0, 4115, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_x_edge);
    __pyx_v_xx_edge = __pyx_v_x_edge;

    /* "gofast/tools/mathex.pyx":4116
 *     if axis == 0 or axis == -x.ndim:
 *         xx_edge = x_edge
 *         swapped = False             # <<<<<<<<<<<<<<
 *     else:
 *         xx_edge = x_edge.swapaxes(axis, 0)
 */
    __Pyx_TraceLine(4116,0,__PYX_ERR(0, 4116, __pyx_L1_error))
    __pyx_v_swapped = 0;

    /* "gofast/tools/mathex.pyx":4114
 *     # Get the edge into a (window_length, -1) array.
 *     x_edge = axis_slice(x, start=window_start, stop=window_stop, axis=axis)
 *     if axis == 0 or axis == -x.ndim:             # <<<<<<<<<<<<<<
 *         xx_edge = x_edge
 *         swapped = False
 */
    goto __pyx_L3;
  }

  /* "gofast/tools/mathex.pyx":4118
 *         swapped = False
 *     else:
 *         xx_edge = x_edge.swapaxes(axis, 0)             # <<<<<<<<<<<<<<
 *         swapped = True
 *     xx_edge = xx_edge.reshape(xx_edge.shape[0], -1)
 */
  __Pyx_TraceLine(4118,0,__PYX_ERR(0, 4118, __pyx_L1_error))
  /*else*/ {
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_x_edge, __pyx_n_s_swapaxes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4118, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_v_axis, __pyx_int_0};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4118, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_v_xx_edge = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4119
 *     else:
 *         xx_edge = x_edge.swapaxes(axis, 0)
 *         swapped = True             # <<<<<<<<<<<<<<
 *     xx_edge = xx_edge.reshape(xx_edge.shape[0], -1)
 * 
 */
    __Pyx_TraceLine(4119,0,__PYX_ERR(0, 4119, __pyx_L1_error))
    __pyx_v_swapped = 1;
  }
  __pyx_L3:;

  /* "gofast/tools/mathex.pyx":4120
 *         xx_edge = x_edge.swapaxes(axis, 0)
 *         swapped = True
 *     xx_edge = xx_edge.reshape(xx_edge.shape[0], -1)             # <<<<<<<<<<<<<<
 * 
 *     # Fit the edges.  poly_coeffs has shape (polyorder + 1, -1),
 */
  __Pyx_TraceLine(4120,0,__PYX_ERR(0, 4120, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_xx_edge, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4120, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_xx_edge, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4120, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4120, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_t_1, __pyx_int_neg_1};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4120, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_xx_edge, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4124
 *     # Fit the edges.  poly_coeffs has shape (polyorder + 1, -1),
 *     # where '-1' is the same as in xx_edge.
 *     poly_coeffs = np.polyfit(np.arange(0, window_stop - window_start),             # <<<<<<<<<<<<<<
 *                              xx_edge, polyorder)
 * 
 */
  __Pyx_TraceLine(4124,0,__PYX_ERR(0, 4124, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_polyfit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arange); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Subtract(__pyx_v_window_stop, __pyx_v_window_start); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_9 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_9, __pyx_int_0, __pyx_t_2};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }

  /* "gofast/tools/mathex.pyx":4125
 *     # where '-1' is the same as in xx_edge.
 *     poly_coeffs = np.polyfit(np.arange(0, window_stop - window_start),
 *                              xx_edge, polyorder)             # <<<<<<<<<<<<<<
 * 
 *     if deriv > 0:
 */
  __Pyx_TraceLine(4125,0,__PYX_ERR(0, 4125, __pyx_L1_error))
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[4] = {__pyx_t_8, __pyx_t_3, __pyx_v_xx_edge, __pyx_v_polyorder};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 3+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4124, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_poly_coeffs = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4127
 *                              xx_edge, polyorder)
 * 
 *     if deriv > 0:             # <<<<<<<<<<<<<<
 *         poly_coeffs = _polyder(poly_coeffs, deriv)
 * 
 */
  __Pyx_TraceLine(4127,0,__PYX_ERR(0, 4127, __pyx_L1_error))
  __pyx_t_4 = PyObject_RichCompare(__pyx_v_deriv, __pyx_int_0, Py_GT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4127, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 4127, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":4128
 * 
 *     if deriv > 0:
 *         poly_coeffs = _polyder(poly_coeffs, deriv)             # <<<<<<<<<<<<<<
 * 
 *     # Compute the interpolated values for the edge.
 */
    __Pyx_TraceLine(4128,0,__PYX_ERR(0, 4128, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_polyder); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4128, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_poly_coeffs, __pyx_v_deriv};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4128, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_poly_coeffs, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4127
 *                              xx_edge, polyorder)
 * 
 *     if deriv > 0:             # <<<<<<<<<<<<<<
 *         poly_coeffs = _polyder(poly_coeffs, deriv)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4131
 * 
 *     # Compute the interpolated values for the edge.
 *     i = np.arange(interp_start - window_start, interp_stop - window_start)             # <<<<<<<<<<<<<<
 *     values = np.polyval(poly_coeffs, i.reshape(-1, 1)) / (delta ** deriv)
 * 
 */
  __Pyx_TraceLine(4131,0,__PYX_ERR(0, 4131, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_arange); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Subtract(__pyx_v_interp_start, __pyx_v_window_start); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = PyNumber_Subtract(__pyx_v_interp_stop, __pyx_v_window_start); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_2 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_t_1, __pyx_t_8};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4131, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_i = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4132
 *     # Compute the interpolated values for the edge.
 *     i = np.arange(interp_start - window_start, interp_stop - window_start)
 *     values = np.polyval(poly_coeffs, i.reshape(-1, 1)) / (delta ** deriv)             # <<<<<<<<<<<<<<
 * 
 *     # Now put the values into the appropriate slice of y.
 */
  __Pyx_TraceLine(4132,0,__PYX_ERR(0, 4132, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_polyval); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_i, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_poly_coeffs, __pyx_t_1};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4132, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = PyNumber_Power(__pyx_v_delta, __pyx_v_deriv, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4132, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_values = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4136
 *     # Now put the values into the appropriate slice of y.
 *     # First reshape values to match y.
 *     shp = list(y.shape)             # <<<<<<<<<<<<<<
 *     shp[0], shp[axis] = shp[axis], shp[0]
 *     values = values.reshape(interp_stop - interp_start, *shp[1:])
 */
  __Pyx_TraceLine(4136,0,__PYX_ERR(0, 4136, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4136, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = __Pyx_PySequence_ListKeepNew(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4136, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_shp = ((PyObject*)__pyx_t_8);
  __pyx_t_8 = 0;

  /* "gofast/tools/mathex.pyx":4137
 *     # First reshape values to match y.
 *     shp = list(y.shape)
 *     shp[0], shp[axis] = shp[axis], shp[0]             # <<<<<<<<<<<<<<
 *     values = values.reshape(interp_stop - interp_start, *shp[1:])
 *     if swapped:
 */
  __Pyx_TraceLine(4137,0,__PYX_ERR(0, 4137, __pyx_L1_error))
  __pyx_t_8 = __Pyx_PyObject_GetItem(__pyx_v_shp, __pyx_v_axis); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4137, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_1 = __Pyx_GetItemInt_List(__pyx_v_shp, 0, long, 1, __Pyx_PyInt_From_long, 1, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4137, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (unlikely((__Pyx_SetItemInt(__pyx_v_shp, 0, __pyx_t_8, long, 1, __Pyx_PyInt_From_long, 1, 0, 1) < 0))) __PYX_ERR(0, 4137, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  if (unlikely((PyObject_SetItem(__pyx_v_shp, __pyx_v_axis, __pyx_t_1) < 0))) __PYX_ERR(0, 4137, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4138
 *     shp = list(y.shape)
 *     shp[0], shp[axis] = shp[axis], shp[0]
 *     values = values.reshape(interp_stop - interp_start, *shp[1:])             # <<<<<<<<<<<<<<
 *     if swapped:
 *         values = values.swapaxes(0, axis)
 */
  __Pyx_TraceLine(4138,0,__PYX_ERR(0, 4138, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_values, __pyx_n_s_reshape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = PyNumber_Subtract(__pyx_v_interp_stop, __pyx_v_interp_start); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_8);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_8)) __PYX_ERR(0, 4138, __pyx_L1_error);
  __pyx_t_8 = 0;
  __pyx_t_8 = __Pyx_PyList_GetSlice(__pyx_v_shp, 1, PY_SSIZE_T_MAX); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_3 = PySequence_Tuple(__pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = PyNumber_Add(__pyx_t_4, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_8, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4138, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF_SET(__pyx_v_values, __pyx_t_3);
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4139
 *     shp[0], shp[axis] = shp[axis], shp[0]
 *     values = values.reshape(interp_stop - interp_start, *shp[1:])
 *     if swapped:             # <<<<<<<<<<<<<<
 *         values = values.swapaxes(0, axis)
 *     # Get a view of the data to be replaced by values.
 */
  __Pyx_TraceLine(4139,0,__PYX_ERR(0, 4139, __pyx_L1_error))
  if (__pyx_v_swapped) {

    /* "gofast/tools/mathex.pyx":4140
 *     values = values.reshape(interp_stop - interp_start, *shp[1:])
 *     if swapped:
 *         values = values.swapaxes(0, axis)             # <<<<<<<<<<<<<<
 *     # Get a view of the data to be replaced by values.
 *     y_edge = axis_slice(y, start=interp_start, stop=interp_stop, axis=axis)
 */
    __Pyx_TraceLine(4140,0,__PYX_ERR(0, 4140, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_values, __pyx_n_s_swapaxes); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4140, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_1 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_1, __pyx_int_0, __pyx_v_axis};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 2+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4140, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_values, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4139
 *     shp[0], shp[axis] = shp[axis], shp[0]
 *     values = values.reshape(interp_stop - interp_start, *shp[1:])
 *     if swapped:             # <<<<<<<<<<<<<<
 *         values = values.swapaxes(0, axis)
 *     # Get a view of the data to be replaced by values.
 */
  }

  /* "gofast/tools/mathex.pyx":4142
 *         values = values.swapaxes(0, axis)
 *     # Get a view of the data to be replaced by values.
 *     y_edge = axis_slice(y, start=interp_start, stop=interp_stop, axis=axis)             # <<<<<<<<<<<<<<
 *     y_edge[...] = values
 * 
 */
  __Pyx_TraceLine(4142,0,__PYX_ERR(0, 4142, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_axis_slice); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_8 = PyTuple_New(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_GIVEREF(__pyx_v_y);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_v_y)) __PYX_ERR(0, 4142, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_start, __pyx_v_interp_start) < 0) __PYX_ERR(0, 4142, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_stop, __pyx_v_interp_stop) < 0) __PYX_ERR(0, 4142, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_axis, __pyx_v_axis) < 0) __PYX_ERR(0, 4142, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_8, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4142, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_y_edge = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4143
 *     # Get a view of the data to be replaced by values.
 *     y_edge = axis_slice(y, start=interp_start, stop=interp_stop, axis=axis)
 *     y_edge[...] = values             # <<<<<<<<<<<<<<
 * 
 * def _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y):
 */
  __Pyx_TraceLine(4143,0,__PYX_ERR(0, 4143, __pyx_L1_error))
  if (unlikely((PyObject_SetItem(__pyx_v_y_edge, Py_Ellipsis, __pyx_v_values) < 0))) __PYX_ERR(0, 4143, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4102
 * 
 * 
 * def _fit_edge(x, window_start, window_stop, interp_start, interp_stop,             # <<<<<<<<<<<<<<
 *               axis, polyorder, deriv, delta, y):
 *     """
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex._fit_edge", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_x_edge);
  __Pyx_XDECREF(__pyx_v_xx_edge);
  __Pyx_XDECREF(__pyx_v_poly_coeffs);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_values);
  __Pyx_XDECREF(__pyx_v_shp);
  __Pyx_XDECREF(__pyx_v_y_edge);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4145
 *     y_edge[...] = values
 * 
 * def _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y):             # <<<<<<<<<<<<<<
 *     """
 *     Use polynomial interpolation of x at the low and high ends of the axis
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_107_fit_edges_polyfit(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_106_fit_edges_polyfit, "\n    Use polynomial interpolation of x at the low and high ends of the axis\n    to fill in the halflen values in y.\n\n    This function just calls _fit_edge twice, once for each end of the axis.\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_107_fit_edges_polyfit = {"_fit_edges_polyfit", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_107_fit_edges_polyfit, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_106_fit_edges_polyfit};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_107_fit_edges_polyfit(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_window_length = 0;
  PyObject *__pyx_v_polyorder = 0;
  PyObject *__pyx_v_deriv = 0;
  PyObject *__pyx_v_delta = 0;
  PyObject *__pyx_v_axis = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_fit_edges_polyfit (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_window_length,&__pyx_n_s_polyorder,&__pyx_n_s_deriv,&__pyx_n_s_delta,&__pyx_n_s_axis,&__pyx_n_s_y,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_length)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, 1); __PYX_ERR(0, 4145, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_polyorder)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, 2); __PYX_ERR(0, 4145, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_deriv)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[3]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, 3); __PYX_ERR(0, 4145, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (likely((values[4] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_delta)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[4]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, 4); __PYX_ERR(0, 4145, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (likely((values[5] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_axis)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[5]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, 5); __PYX_ERR(0, 4145, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (likely((values[6] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[6]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4145, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, 6); __PYX_ERR(0, 4145, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_fit_edges_polyfit") < 0)) __PYX_ERR(0, 4145, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 7)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
      values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
      values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
      values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
      values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
    }
    __pyx_v_x = values[0];
    __pyx_v_window_length = values[1];
    __pyx_v_polyorder = values[2];
    __pyx_v_deriv = values[3];
    __pyx_v_delta = values[4];
    __pyx_v_axis = values[5];
    __pyx_v_y = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_fit_edges_polyfit", 1, 7, 7, __pyx_nargs); __PYX_ERR(0, 4145, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._fit_edges_polyfit", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_106_fit_edges_polyfit(__pyx_self, __pyx_v_x, __pyx_v_window_length, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_axis, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_106_fit_edges_polyfit(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_window_length, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_axis, PyObject *__pyx_v_y) {
  PyObject *__pyx_v_halflen = NULL;
  PyObject *__pyx_v_n = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__127)
  __Pyx_RefNannySetupContext("_fit_edges_polyfit", 1);
  __Pyx_TraceCall("_fit_edges_polyfit", __pyx_f[0], 4145, 0, __PYX_ERR(0, 4145, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":4152
 *     This function just calls _fit_edge twice, once for each end of the axis.
 *     """
 *     halflen = window_length // 2             # <<<<<<<<<<<<<<
 *     _fit_edge(x, 0, window_length, 0, halflen, axis,
 *               polyorder, deriv, delta, y)
 */
  __Pyx_TraceLine(4152,0,__PYX_ERR(0, 4152, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyInt_FloorDivideObjC(__pyx_v_window_length, __pyx_int_2, 2, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4152, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_halflen = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4153
 *     """
 *     halflen = window_length // 2
 *     _fit_edge(x, 0, window_length, 0, halflen, axis,             # <<<<<<<<<<<<<<
 *               polyorder, deriv, delta, y)
 *     n = x.shape[axis]
 */
  __Pyx_TraceLine(4153,0,__PYX_ERR(0, 4153, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_fit_edge); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4153, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":4154
 *     halflen = window_length // 2
 *     _fit_edge(x, 0, window_length, 0, halflen, axis,
 *               polyorder, deriv, delta, y)             # <<<<<<<<<<<<<<
 *     n = x.shape[axis]
 *     _fit_edge(x, n - window_length, n, n - halflen, n, axis,
 */
  __Pyx_TraceLine(4154,0,__PYX_ERR(0, 4154, __pyx_L1_error))
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[11] = {__pyx_t_3, __pyx_v_x, __pyx_int_0, __pyx_v_window_length, __pyx_int_0, __pyx_v_halflen, __pyx_v_axis, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_y};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 10+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4153, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4155
 *     _fit_edge(x, 0, window_length, 0, halflen, axis,
 *               polyorder, deriv, delta, y)
 *     n = x.shape[axis]             # <<<<<<<<<<<<<<
 *     _fit_edge(x, n - window_length, n, n - halflen, n, axis,
 *               polyorder, deriv, delta, y)
 */
  __Pyx_TraceLine(4155,0,__PYX_ERR(0, 4155, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4155, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_axis); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4155, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_n = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4156
 *               polyorder, deriv, delta, y)
 *     n = x.shape[axis]
 *     _fit_edge(x, n - window_length, n, n - halflen, n, axis,             # <<<<<<<<<<<<<<
 *               polyorder, deriv, delta, y)
 * 
 */
  __Pyx_TraceLine(4156,0,__PYX_ERR(0, 4156, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_fit_edge); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4156, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Subtract(__pyx_v_n, __pyx_v_window_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4156, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = PyNumber_Subtract(__pyx_v_n, __pyx_v_halflen); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4156, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);

  /* "gofast/tools/mathex.pyx":4157
 *     n = x.shape[axis]
 *     _fit_edge(x, n - window_length, n, n - halflen, n, axis,
 *               polyorder, deriv, delta, y)             # <<<<<<<<<<<<<<
 * 
 * def savgol_filter(x, window_length, polyorder, deriv=0, delta=1.0,
 */
  __Pyx_TraceLine(4157,0,__PYX_ERR(0, 4157, __pyx_L1_error))
  __pyx_t_6 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_6)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[11] = {__pyx_t_6, __pyx_v_x, __pyx_t_3, __pyx_v_n, __pyx_t_5, __pyx_v_n, __pyx_v_axis, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_y};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 10+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4156, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4145
 *     y_edge[...] = values
 * 
 * def _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y):             # <<<<<<<<<<<<<<
 *     """
 *     Use polynomial interpolation of x at the low and high ends of the axis
 */

  /* function exit code */
  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_AddTraceback("gofast.tools.mathex._fit_edges_polyfit", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_halflen);
  __Pyx_XDECREF(__pyx_v_n);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4159
 *               polyorder, deriv, delta, y)
 * 
 * def savgol_filter(x, window_length, polyorder, deriv=0, delta=1.0,             # <<<<<<<<<<<<<<
 *                   axis=-1, mode='interp', cval=0.0):
 *     """ Apply a Savitzky-Golay filter to an array.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_109savgol_filter(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_108savgol_filter, " Apply a Savitzky-Golay filter to an array.\n\n    This is a 1-D filter. If `x`  has dimension greater than 1, `axis`\n    determines the axis along which the filter is applied.\n\n    Parameters\n    ----------\n    x : array_like\n        The data to be filtered. If `x` is not a single or double precision\n        floating point array, it will be converted to type ``numpy.float64``\n        before filtering.\n    window_length : int\n        The length of the filter window (i.e., the number of coefficients).\n        `window_length` must be a positive odd integer. If `mode` is 'interp',\n        `window_length` must be less than or equal to the size of `x`.\n    polyorder : int\n        The order of the polynomial used to fit the samples.\n        `polyorder` must be less than `window_length`.\n    deriv : int, optional\n        The order of the derivative to compute. This must be a\n        nonnegative integer. The default is 0, which means to filter\n        the data without differentiating.\n    delta : float, optional\n        The spacing of the samples to which the filter will be applied.\n        This is only used if deriv > 0. Default is 1.0.\n    axis : int, optional\n        The axis of the array `x` along which the filter is to be applied.\n        Default is -1.\n    mode : str, optional\n        Must be 'mirror', 'constant', 'nearest', 'wrap' or 'interp'. This\n        determines the type of extension to use for the padded signal to\n        which the filter is applied.  When `mode` is 'constant', the padding\n        value is given by `cval`.  See the Notes for more details on 'mirror',\n        'constant', 'wrap', and 'nearest'.\n        When the 'interp' mode is selected (the default), no extension\n        is used.  Instead, a degree `polyorder` polynomial is fit to the\n        last `window_length` values of the edges, and this polynomial is\n        used to evaluate the last `window_length // 2` output values.\n    cval : scalar, optional\n      ""  Value to fill past the edges of the input if `mode` is 'constant'.\n        Default is 0.0.\n\n    Returns\n    -------\n    y : ndarray, same shape as `x`\n        The filtered data.\n\n    See Also\n    --------\n    savgol_coeffs\n\n    Notes\n    -----\n    Details on the `mode` options:\n\n        'mirror':\n            Repeats the values at the edges in reverse order. The value\n            closest to the edge is not included.\n        'nearest':\n            The extension contains the nearest input value.\n        'constant':\n            The extension contains the value given by the `cval` argument.\n        'wrap':\n            The extension contains the values from the other end of the array.\n\n    For example, if the input is [1, 2, 3, 4, 5, 6, 7, 8], and\n    `window_length` is 7, the following shows the extended data for\n    the various `mode` options (assuming `cval` is 0)::\n\n        mode       |   Ext   |         Input          |   Ext\n        -----------+---------+------------------------+---------\n        'mirror'   | 4  3  2 | 1  2  3  4  5  6  7  8 | 7  6  5\n        'nearest'  | 1  1  1 | 1  2  3  4  5  6  7  8 | 8  8  8\n        'constant' | 0  0  0 | 1  2  3  4  5  6  7  8 | 0  0  0\n        'wrap'     | 6  7  8 | 1  2  3  4  5  6  7  8 | 1  2  3\n\n    .. versionadded:: 0.14.0\n\n    Examples\n    --------\n    >>> from gofast.tools.mathex  import savgol_filter\n    >>> np.set_printoptions(precision=2)  # For compact display.\n    >>> x = np.array([2, 2, 5, 2, 1, 0, 1, 4, 9])\n\n    Filter with a window length of 5 and a degree 2 polynomial.  Use\n    the defaults for all other parameters.\n\n    >>> savgol_filter(x, 5, 2)\n    array([1.66, 3.17, 3.54, 2.86, 0.66, 0.17, 1.  , 4.  , 9.  ])\n\n    Note that the last five values in x are samples of a parabola, so\n    when mode='interp' (the default) is used with polyorder=2, the last\n    three values are unchanged. Compare that to, for example,\n    `mode='nearest'`:\n\n    >>> savgol_f""ilter(x, 5, 2, mode='nearest')\n    array([1.74, 3.03, 3.54, 2.86, 0.66, 0.17, 1.  , 4.6 , 7.97])\n\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_109savgol_filter = {"savgol_filter", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_109savgol_filter, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_108savgol_filter};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_109savgol_filter(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_window_length = 0;
  PyObject *__pyx_v_polyorder = 0;
  PyObject *__pyx_v_deriv = 0;
  PyObject *__pyx_v_delta = 0;
  PyObject *__pyx_v_axis = 0;
  PyObject *__pyx_v_mode = 0;
  PyObject *__pyx_v_cval = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[8] = {0,0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("savgol_filter (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_window_length,&__pyx_n_s_polyorder,&__pyx_n_s_deriv,&__pyx_n_s_delta,&__pyx_n_s_axis,&__pyx_n_s_mode,&__pyx_n_s_cval,0};
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_0)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_1_0)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_neg_1)));
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_interp)));
    values[7] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_0)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_length)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("savgol_filter", 0, 3, 8, 1); __PYX_ERR(0, 4159, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_polyorder)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("savgol_filter", 0, 3, 8, 2); __PYX_ERR(0, 4159, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_deriv);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_delta);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_axis);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_mode);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_cval);
          if (value) { values[7] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4159, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "savgol_filter") < 0)) __PYX_ERR(0, 4159, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  8: values[7] = __Pyx_Arg_FASTCALL(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = values[0];
    __pyx_v_window_length = values[1];
    __pyx_v_polyorder = values[2];
    __pyx_v_deriv = values[3];
    __pyx_v_delta = values[4];
    __pyx_v_axis = values[5];
    __pyx_v_mode = values[6];
    __pyx_v_cval = values[7];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("savgol_filter", 0, 3, 8, __pyx_nargs); __PYX_ERR(0, 4159, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.savgol_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_108savgol_filter(__pyx_self, __pyx_v_x, __pyx_v_window_length, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_axis, __pyx_v_mode, __pyx_v_cval);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_108savgol_filter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_window_length, PyObject *__pyx_v_polyorder, PyObject *__pyx_v_deriv, PyObject *__pyx_v_delta, PyObject *__pyx_v_axis, PyObject *__pyx_v_mode, PyObject *__pyx_v_cval) {
  PyObject *__pyx_v_coeffs = NULL;
  PyObject *__pyx_v_y = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  int __pyx_t_2;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__128)
  __Pyx_RefNannySetupContext("savgol_filter", 0);
  __Pyx_TraceCall("savgol_filter", __pyx_f[0], 4159, 0, __PYX_ERR(0, 4159, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_x);

  /* "gofast/tools/mathex.pyx":4260
 * 
 *     """
 *     if mode not in ["mirror", "constant", "nearest", "interp", "wrap"]:             # <<<<<<<<<<<<<<
 *         raise ValueError("mode must be 'mirror', 'constant', 'nearest' "
 *                          "'wrap' or 'interp'.")
 */
  __Pyx_TraceLine(4260,0,__PYX_ERR(0, 4260, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_mode);
  __pyx_t_1 = __pyx_v_mode;
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_mirror, Py_NE)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4260, __pyx_L1_error)
  if (__pyx_t_3) {
  } else {
    __pyx_t_2 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_constant, Py_NE)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4260, __pyx_L1_error)
  if (__pyx_t_3) {
  } else {
    __pyx_t_2 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_nearest, Py_NE)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4260, __pyx_L1_error)
  if (__pyx_t_3) {
  } else {
    __pyx_t_2 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_interp, Py_NE)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4260, __pyx_L1_error)
  if (__pyx_t_3) {
  } else {
    __pyx_t_2 = __pyx_t_3;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_t_1, __pyx_n_u_wrap, Py_NE)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4260, __pyx_L1_error)
  __pyx_t_2 = __pyx_t_3;
  __pyx_L4_bool_binop_done:;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __pyx_t_2;
  if (unlikely(__pyx_t_3)) {

    /* "gofast/tools/mathex.pyx":4261
 *     """
 *     if mode not in ["mirror", "constant", "nearest", "interp", "wrap"]:
 *         raise ValueError("mode must be 'mirror', 'constant', 'nearest' "             # <<<<<<<<<<<<<<
 *                          "'wrap' or 'interp'.")
 * 
 */
    __Pyx_TraceLine(4261,0,__PYX_ERR(0, 4261, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__129, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4261, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4261, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4260
 * 
 *     """
 *     if mode not in ["mirror", "constant", "nearest", "interp", "wrap"]:             # <<<<<<<<<<<<<<
 *         raise ValueError("mode must be 'mirror', 'constant', 'nearest' "
 *                          "'wrap' or 'interp'.")
 */
  }

  /* "gofast/tools/mathex.pyx":4264
 *                          "'wrap' or 'interp'.")
 * 
 *     x = np.asarray(x)             # <<<<<<<<<<<<<<
 *     # Ensure that x is either single or double precision floating point.
 *     if x.dtype != np.float64 and x.dtype != np.float32:
 */
  __Pyx_TraceLine(4264,0,__PYX_ERR(0, 4264, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4264, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_asarray); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4264, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_x};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4264, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4266
 *     x = np.asarray(x)
 *     # Ensure that x is either single or double precision floating point.
 *     if x.dtype != np.float64 and x.dtype != np.float32:             # <<<<<<<<<<<<<<
 *         x = x.astype(np.float64)
 * 
 */
  __Pyx_TraceLine(4266,0,__PYX_ERR(0, 4266, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_dtype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyObject_RichCompare(__pyx_t_1, __pyx_t_4, Py_NE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_2) {
  } else {
    __pyx_t_3 = __pyx_t_2;
    goto __pyx_L10_bool_binop_done;
  }
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_dtype); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float32); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = PyObject_RichCompare(__pyx_t_5, __pyx_t_1, Py_NE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 4266, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_3 = __pyx_t_2;
  __pyx_L10_bool_binop_done:;
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4267
 *     # Ensure that x is either single or double precision floating point.
 *     if x.dtype != np.float64 and x.dtype != np.float32:
 *         x = x.astype(np.float64)             # <<<<<<<<<<<<<<
 * 
 *     coeffs = savgol_coeffs(window_length, polyorder, deriv=deriv, delta=delta)
 */
    __Pyx_TraceLine(4267,0,__PYX_ERR(0, 4267, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_astype); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4267, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4267, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_float64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4267, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_7};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4267, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4266
 *     x = np.asarray(x)
 *     # Ensure that x is either single or double precision floating point.
 *     if x.dtype != np.float64 and x.dtype != np.float32:             # <<<<<<<<<<<<<<
 *         x = x.astype(np.float64)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4269
 *         x = x.astype(np.float64)
 * 
 *     coeffs = savgol_coeffs(window_length, polyorder, deriv=deriv, delta=delta)             # <<<<<<<<<<<<<<
 * 
 *     if mode == "interp":
 */
  __Pyx_TraceLine(4269,0,__PYX_ERR(0, 4269, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_savgol_coeffs); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4269, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4269, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_window_length);
  __Pyx_GIVEREF(__pyx_v_window_length);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_window_length)) __PYX_ERR(0, 4269, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_polyorder);
  __Pyx_GIVEREF(__pyx_v_polyorder);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_polyorder)) __PYX_ERR(0, 4269, __pyx_L1_error);
  __pyx_t_7 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4269, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_deriv, __pyx_v_deriv) < 0) __PYX_ERR(0, 4269, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_7, __pyx_n_s_delta, __pyx_v_delta) < 0) __PYX_ERR(0, 4269, __pyx_L1_error)
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4269, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_v_coeffs = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":4271
 *     coeffs = savgol_coeffs(window_length, polyorder, deriv=deriv, delta=delta)
 * 
 *     if mode == "interp":             # <<<<<<<<<<<<<<
 *         if window_length > x.size:
 *             raise ValueError("If mode is 'interp', window_length must be less "
 */
  __Pyx_TraceLine(4271,0,__PYX_ERR(0, 4271, __pyx_L1_error))
  __pyx_t_3 = (__Pyx_PyUnicode_Equals(__pyx_v_mode, __pyx_n_u_interp, Py_EQ)); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4271, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4272
 * 
 *     if mode == "interp":
 *         if window_length > x.size:             # <<<<<<<<<<<<<<
 *             raise ValueError("If mode is 'interp', window_length must be less "
 *                              "than or equal to the size of x.")
 */
    __Pyx_TraceLine(4272,0,__PYX_ERR(0, 4272, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_size); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4272, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_7 = PyObject_RichCompare(__pyx_v_window_length, __pyx_t_5, Py_GT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4272, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4272, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(__pyx_t_3)) {

      /* "gofast/tools/mathex.pyx":4273
 *     if mode == "interp":
 *         if window_length > x.size:
 *             raise ValueError("If mode is 'interp', window_length must be less "             # <<<<<<<<<<<<<<
 *                              "than or equal to the size of x.")
 * 
 */
      __Pyx_TraceLine(4273,0,__PYX_ERR(0, 4273, __pyx_L1_error))
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__130, NULL); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4273, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_Raise(__pyx_t_7, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __PYX_ERR(0, 4273, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":4272
 * 
 *     if mode == "interp":
 *         if window_length > x.size:             # <<<<<<<<<<<<<<
 *             raise ValueError("If mode is 'interp', window_length must be less "
 *                              "than or equal to the size of x.")
 */
    }

    /* "gofast/tools/mathex.pyx":4279
 *         # of the ends of the sequence, use the polynomial that is fitted to
 *         # the last `window_length` elements.
 *         y = convolve1d(x, coeffs, axis=axis, mode="constant")             # <<<<<<<<<<<<<<
 *         _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y)
 *     else:
 */
    __Pyx_TraceLine(4279,0,__PYX_ERR(0, 4279, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_convolve1d); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4279, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4279, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_v_x)) __PYX_ERR(0, 4279, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_coeffs);
    __Pyx_GIVEREF(__pyx_v_coeffs);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_v_coeffs)) __PYX_ERR(0, 4279, __pyx_L1_error);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4279, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_axis, __pyx_v_axis) < 0) __PYX_ERR(0, 4279, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_mode, __pyx_n_u_constant) < 0) __PYX_ERR(0, 4279, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_5, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4279, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_y = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4280
 *         # the last `window_length` elements.
 *         y = convolve1d(x, coeffs, axis=axis, mode="constant")
 *         _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y)             # <<<<<<<<<<<<<<
 *     else:
 *         # Any mode other than 'interp' is passed on to ndimage.convolve1d.
 */
    __Pyx_TraceLine(4280,0,__PYX_ERR(0, 4280, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_fit_edges_polyfit); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4280, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[8] = {__pyx_t_5, __pyx_v_x, __pyx_v_window_length, __pyx_v_polyorder, __pyx_v_deriv, __pyx_v_delta, __pyx_v_axis, __pyx_v_y};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 7+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4280, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4271
 *     coeffs = savgol_coeffs(window_length, polyorder, deriv=deriv, delta=delta)
 * 
 *     if mode == "interp":             # <<<<<<<<<<<<<<
 *         if window_length > x.size:
 *             raise ValueError("If mode is 'interp', window_length must be less "
 */
    goto __pyx_L12;
  }

  /* "gofast/tools/mathex.pyx":4283
 *     else:
 *         # Any mode other than 'interp' is passed on to ndimage.convolve1d.
 *         y = convolve1d(x, coeffs, axis=axis, mode=mode, cval=cval)             # <<<<<<<<<<<<<<
 * 
 *     return y
 */
  __Pyx_TraceLine(4283,0,__PYX_ERR(0, 4283, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_convolve1d); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4283, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4283, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_x)) __PYX_ERR(0, 4283, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_coeffs);
    __Pyx_GIVEREF(__pyx_v_coeffs);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_coeffs)) __PYX_ERR(0, 4283, __pyx_L1_error);
    __pyx_t_5 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4283, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_axis, __pyx_v_axis) < 0) __PYX_ERR(0, 4283, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_mode, __pyx_v_mode) < 0) __PYX_ERR(0, 4283, __pyx_L1_error)
    if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_cval, __pyx_v_cval) < 0) __PYX_ERR(0, 4283, __pyx_L1_error)
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_1, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4283, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_v_y = __pyx_t_7;
    __pyx_t_7 = 0;
  }
  __pyx_L12:;

  /* "gofast/tools/mathex.pyx":4285
 *         y = convolve1d(x, coeffs, axis=axis, mode=mode, cval=cval)
 * 
 *     return y             # <<<<<<<<<<<<<<
 * 
 * def compute_errors (
 */
  __Pyx_TraceLine(4285,0,__PYX_ERR(0, 4285, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_y);
  __pyx_r = __pyx_v_y;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4159
 *               polyorder, deriv, delta, y)
 * 
 * def savgol_filter(x, window_length, polyorder, deriv=0, delta=1.0,             # <<<<<<<<<<<<<<
 *                   axis=-1, mode='interp', cval=0.0):
 *     """ Apply a Savitzky-Golay filter to an array.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_AddTraceback("gofast.tools.mathex.savgol_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_coeffs);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4287
 *     return y
 * 
 * def compute_errors (             # <<<<<<<<<<<<<<
 *     arr,
 *     error ='std',
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_111compute_errors(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_110compute_errors, " Compute Errors ( Standard Deviation ) and standard errors. \n    \n    Standard error and standard deviation are both measures of variability:\n    - The standard deviation describes variability within a single sample. Its\n      formula is given as: \n          \n      .. math:: \n          \n          SD = \\sqrt{ \\sum |x -\\mu|^2}{N}\n          \n      where :math:`\\sum` means the \"sum of\", :math:`x` is the value in the data \n      set,:math:`\\mu` is the mean of the data set and :math:`N` is the number \n      of the data points in the population. :math:`SD` is the quantity \n      expressing by how much the members of a group differ from the mean \n      value for the group.\n      \n    - The standard error estimates the variability across multiple \n      samples of a population. Different formulas are used depending on \n      whether the population standard deviation is known.\n      \n      - when the population standard deviation is known: \n      \n        .. math:: \n          \n            SE = \014rac{SD}{\\sqrt{N}} \n            \n      - When the population parameter is unknwon \n      \n        .. math:: \n            \n            SE = \014rac{s}{\\sqrt{N}} \n            \n       where :math:`SE` is the standard error, : math:`s` is the sample\n       standard deviation. When the population standard is knwon the \n       :math:`SE` is more accurate. \n    \n    Note that the :math:`SD` is  a descriptive statistic that can be \n    calculated from sample data. In contrast, the standard error is an \n    inferential statistic that can only be estimated \n    (unless the real population parameter is known). \n    \n    Parameters\n    ----------\n    arr : array_like , 1D or 2D \n      Array for computing the standard deviation \n      \n    error: str, default='std'\n      Name of error to compute. By default compute the standard deviation. \n      Can also compute the the standard error estimation if the  argument \n      is passed to ``ste``"". \n    return_confidence: bool, default=False, \n      If ``True``, returns the confidence interval with 95% of sample means \n      \n    Returns \n    --------\n    err: arraylike 1D or 2D \n       Error array. \n       \n    Examples\n    ---------\n    >>> from gofast.tools.mathex  import compute_errors\n    >>> from gofast.datasets import make_mining_ops \n    >>> mdata = make_mining_ops ( samples =20, as_frame=True, noises=\"20%\", return_X_y=False)\n    >>> compute_errors (mdata)\n    Easting_m                    301.216454\n    Northing_m                   301.284073\n    Depth_m                      145.343063\n    OreConcentration_Percent       5.908375\n    DrillDiameter_mm              50.019249\n    BlastHoleDepth_m               3.568771\n    ExplosiveAmount_kg           142.908481\n    EquipmentAge_years             4.537603\n    DailyProduction_tonnes      2464.819019\n    dtype: float64\n    >>> compute_errors ( mdata, return_confidence= True)\n    (Easting_m                   -100.015509\n     Northing_m                  -181.088446\n     Depth_m                      -67.948155\n     OreConcentration_Percent      -3.316211\n     DrillDiameter_mm              25.820805\n     BlastHoleDepth_m               1.733541\n     ExplosiveAmount_kg             3.505198\n     EquipmentAge_years            -1.581202\n     DailyProduction_tonnes      1058.839261\n     dtype: float64,\n     Easting_m                    1080.752992\n     Northing_m                    999.945119\n     Depth_m                       501.796651\n     OreConcentration_Percent       19.844618\n     DrillDiameter_mm              221.896260\n     BlastHoleDepth_m               15.723123\n     ExplosiveAmount_kg            563.706443\n     EquipmentAge_years             16.206202\n     DailyProduction_tonnes      10720.929814\n     dtype: float64)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_111compute_errors = {"compute_errors", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_111compute_errors, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_110compute_errors};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_111compute_errors(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_arr = 0;
  PyObject *__pyx_v_error = 0;
  PyObject *__pyx_v_axis = 0;
  PyObject *__pyx_v_return_confidence = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("compute_errors (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arr,&__pyx_n_s_error,&__pyx_n_s_axis,&__pyx_n_s_return_confidence,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_n_u_std)));
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_0)));

    /* "gofast/tools/mathex.pyx":4291
 *     error ='std',
 *     axis = 0,
 *     return_confidence=False             # <<<<<<<<<<<<<<
 *     ):
 *     """ Compute Errors ( Standard Deviation ) and standard errors.
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_arr)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4287, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_error);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4287, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_axis);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4287, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_return_confidence);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4287, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "compute_errors") < 0)) __PYX_ERR(0, 4287, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arr = values[0];
    __pyx_v_error = values[1];
    __pyx_v_axis = values[2];
    __pyx_v_return_confidence = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("compute_errors", 0, 1, 4, __pyx_nargs); __PYX_ERR(0, 4287, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.compute_errors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_110compute_errors(__pyx_self, __pyx_v_arr, __pyx_v_error, __pyx_v_axis, __pyx_v_return_confidence);

  /* "gofast/tools/mathex.pyx":4287
 *     return y
 * 
 * def compute_errors (             # <<<<<<<<<<<<<<
 *     arr,
 *     error ='std',
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_110compute_errors(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, PyObject *__pyx_v_error, PyObject *__pyx_v_axis, PyObject *__pyx_v_return_confidence) {
  PyObject *__pyx_v_err = NULL;
  PyObject *__pyx_v_err_lower = NULL;
  PyObject *__pyx_v_err_upper = NULL;
  PyObject *__pyx_v_N = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  Py_ssize_t __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__131)
  __Pyx_RefNannySetupContext("compute_errors", 0);
  __Pyx_TraceCall("compute_errors", __pyx_f[0], 4287, 0, __PYX_ERR(0, 4287, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_INCREF(__pyx_v_error);

  /* "gofast/tools/mathex.pyx":4389
 *      dtype: float64)
 *     """
 *     error = _validate_name_in(error , defaults =('error', 'se'),             # <<<<<<<<<<<<<<
 *                               deep =True, expect_name ='se')
 *     # keep only the numeric values.
 */
  __Pyx_TraceLine(4389,0,__PYX_ERR(0, 4389, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_validate_name_in); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_error);
  __Pyx_GIVEREF(__pyx_v_error);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_error)) __PYX_ERR(0, 4389, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_defaults, __pyx_tuple__132) < 0) __PYX_ERR(0, 4389, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4390
 *     """
 *     error = _validate_name_in(error , defaults =('error', 'se'),
 *                               deep =True, expect_name ='se')             # <<<<<<<<<<<<<<
 *     # keep only the numeric values.
 *     if hasattr (arr, '__array__') and hasattr(arr, 'columns'):
 */
  __Pyx_TraceLine(4390,0,__PYX_ERR(0, 4390, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_deep, Py_True) < 0) __PYX_ERR(0, 4389, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_expect_name, __pyx_n_u_se) < 0) __PYX_ERR(0, 4389, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4389
 *      dtype: float64)
 *     """
 *     error = _validate_name_in(error , defaults =('error', 'se'),             # <<<<<<<<<<<<<<
 *                               deep =True, expect_name ='se')
 *     # keep only the numeric values.
 */
  __Pyx_TraceLine(4389,0,__PYX_ERR(0, 4389, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_error, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4392
 *                               deep =True, expect_name ='se')
 *     # keep only the numeric values.
 *     if hasattr (arr, '__array__') and hasattr(arr, 'columns'):             # <<<<<<<<<<<<<<
 *         arr = to_numeric_dtypes ( arr, pop_cat_features =True )
 * 
 */
  __Pyx_TraceLine(4392,0,__PYX_ERR(0, 4392, __pyx_L1_error))
  __pyx_t_6 = __Pyx_HasAttr(__pyx_v_arr, __pyx_n_u_array); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 4392, __pyx_L1_error)
  if (__pyx_t_6) {
  } else {
    __pyx_t_5 = __pyx_t_6;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_6 = __Pyx_HasAttr(__pyx_v_arr, __pyx_n_u_columns); if (unlikely(__pyx_t_6 == ((int)-1))) __PYX_ERR(0, 4392, __pyx_L1_error)
  __pyx_t_5 = __pyx_t_6;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":4393
 *     # keep only the numeric values.
 *     if hasattr (arr, '__array__') and hasattr(arr, 'columns'):
 *         arr = to_numeric_dtypes ( arr, pop_cat_features =True )             # <<<<<<<<<<<<<<
 * 
 *     if not _is_numeric_dtype(arr):
 */
    __Pyx_TraceLine(4393,0,__PYX_ERR(0, 4393, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_to_numeric_dtypes); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4393, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4393, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_arr);
    __Pyx_GIVEREF(__pyx_v_arr);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_arr)) __PYX_ERR(0, 4393, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4393, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_pop_cat_features, Py_True) < 0) __PYX_ERR(0, 4393, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4393, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4392
 *                               deep =True, expect_name ='se')
 *     # keep only the numeric values.
 *     if hasattr (arr, '__array__') and hasattr(arr, 'columns'):             # <<<<<<<<<<<<<<
 *         arr = to_numeric_dtypes ( arr, pop_cat_features =True )
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4395
 *         arr = to_numeric_dtypes ( arr, pop_cat_features =True )
 * 
 *     if not _is_numeric_dtype(arr):             # <<<<<<<<<<<<<<
 *         raise TypeError("Numeric array is expected for operations.")
 *     err= np.std (arr) if arr.ndim ==1 else np.std (arr, axis= axis )
 */
  __Pyx_TraceLine(4395,0,__PYX_ERR(0, 4395, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_is_numeric_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_arr};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4395, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 4395, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_6 = (!__pyx_t_5);
  if (unlikely(__pyx_t_6)) {

    /* "gofast/tools/mathex.pyx":4396
 * 
 *     if not _is_numeric_dtype(arr):
 *         raise TypeError("Numeric array is expected for operations.")             # <<<<<<<<<<<<<<
 *     err= np.std (arr) if arr.ndim ==1 else np.std (arr, axis= axis )
 * 
 */
    __Pyx_TraceLine(4396,0,__PYX_ERR(0, 4396, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__133, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4396, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4396, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4395
 *         arr = to_numeric_dtypes ( arr, pop_cat_features =True )
 * 
 *     if not _is_numeric_dtype(arr):             # <<<<<<<<<<<<<<
 *         raise TypeError("Numeric array is expected for operations.")
 *     err= np.std (arr) if arr.ndim ==1 else np.std (arr, axis= axis )
 */
  }

  /* "gofast/tools/mathex.pyx":4397
 *     if not _is_numeric_dtype(arr):
 *         raise TypeError("Numeric array is expected for operations.")
 *     err= np.std (arr) if arr.ndim ==1 else np.std (arr, axis= axis )             # <<<<<<<<<<<<<<
 * 
 *     err_lower =  err_upper = None
 */
  __Pyx_TraceLine(4397,0,__PYX_ERR(0, 4397, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_ndim); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4397, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_2, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4397, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_6) {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_std); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_arr};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4397, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __pyx_t_1 = __pyx_t_2;
    __pyx_t_2 = 0;
  } else {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_std); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_INCREF(__pyx_v_arr);
    __Pyx_GIVEREF(__pyx_v_arr);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_arr)) __PYX_ERR(0, 4397, __pyx_L1_error);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_axis, __pyx_v_axis) < 0) __PYX_ERR(0, 4397, __pyx_L1_error)
    __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4397, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_1 = __pyx_t_8;
    __pyx_t_8 = 0;
  }
  __pyx_v_err = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4399
 *     err= np.std (arr) if arr.ndim ==1 else np.std (arr, axis= axis )
 * 
 *     err_lower =  err_upper = None             # <<<<<<<<<<<<<<
 *     if error =='se':
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]
 */
  __Pyx_TraceLine(4399,0,__PYX_ERR(0, 4399, __pyx_L1_error))
  __Pyx_INCREF(Py_None);
  __pyx_v_err_lower = Py_None;
  __Pyx_INCREF(Py_None);
  __pyx_v_err_upper = Py_None;

  /* "gofast/tools/mathex.pyx":4400
 * 
 *     err_lower =  err_upper = None
 *     if error =='se':             # <<<<<<<<<<<<<<
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]
 *         err =  err / np.sqrt(N)
 */
  __Pyx_TraceLine(4400,0,__PYX_ERR(0, 4400, __pyx_L1_error))
  __pyx_t_6 = (__Pyx_PyUnicode_Equals(__pyx_v_error, __pyx_n_u_se, Py_EQ)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4400, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":4401
 *     err_lower =  err_upper = None
 *     if error =='se':
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]             # <<<<<<<<<<<<<<
 *         err =  err / np.sqrt(N)
 *     if return_confidence:
 */
    __Pyx_TraceLine(4401,0,__PYX_ERR(0, 4401, __pyx_L1_error))
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_ndim); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4401, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_6 = (__Pyx_PyInt_BoolEqObjC(__pyx_t_8, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4401, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_6) {
      __pyx_t_9 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_9 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4401, __pyx_L1_error)
      __pyx_t_8 = PyInt_FromSsize_t(__pyx_t_9); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4401, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_1 = __pyx_t_8;
      __pyx_t_8 = 0;
    } else {
      __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_shape); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4401, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_8, __pyx_v_axis); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4401, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_1 = __pyx_t_3;
      __pyx_t_3 = 0;
    }
    __pyx_v_N = __pyx_t_1;
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4402
 *     if error =='se':
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]
 *         err =  err / np.sqrt(N)             # <<<<<<<<<<<<<<
 *     if return_confidence:
 *         err_lower = arr.mean() - ( 1.96 * err )
 */
    __Pyx_TraceLine(4402,0,__PYX_ERR(0, 4402, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4402, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4402, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_N};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4402, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_t_8 = __Pyx_PyNumber_Divide(__pyx_v_err, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4402, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_err, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":4400
 * 
 *     err_lower =  err_upper = None
 *     if error =='se':             # <<<<<<<<<<<<<<
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]
 *         err =  err / np.sqrt(N)
 */
  }

  /* "gofast/tools/mathex.pyx":4403
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]
 *         err =  err / np.sqrt(N)
 *     if return_confidence:             # <<<<<<<<<<<<<<
 *         err_lower = arr.mean() - ( 1.96 * err )
 *         err_upper = arr.mean() + ( 1.96 * err )
 */
  __Pyx_TraceLine(4403,0,__PYX_ERR(0, 4403, __pyx_L1_error))
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_return_confidence); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4403, __pyx_L1_error)
  if (__pyx_t_6) {

    /* "gofast/tools/mathex.pyx":4404
 *         err =  err / np.sqrt(N)
 *     if return_confidence:
 *         err_lower = arr.mean() - ( 1.96 * err )             # <<<<<<<<<<<<<<
 *         err_upper = arr.mean() + ( 1.96 * err )
 *     return err if not return_confidence else ( err_lower, err_upper)
 */
    __Pyx_TraceLine(4404,0,__PYX_ERR(0, 4404, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4404, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, NULL};
      __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4404, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_1_96, __pyx_v_err); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4404, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = PyNumber_Subtract(__pyx_t_8, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4404, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_err_lower, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4405
 *     if return_confidence:
 *         err_lower = arr.mean() - ( 1.96 * err )
 *         err_upper = arr.mean() + ( 1.96 * err )             # <<<<<<<<<<<<<<
 *     return err if not return_confidence else ( err_lower, err_upper)
 * 
 */
    __Pyx_TraceLine(4405,0,__PYX_ERR(0, 4405, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_8, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4405, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = PyNumber_Multiply(__pyx_float_1_96, __pyx_v_err); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = PyNumber_Add(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4405, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_err_upper, __pyx_t_8);
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":4403
 *         N = len(arr) if arr.ndim ==1 else arr.shape [axis ]
 *         err =  err / np.sqrt(N)
 *     if return_confidence:             # <<<<<<<<<<<<<<
 *         err_lower = arr.mean() - ( 1.96 * err )
 *         err_upper = arr.mean() + ( 1.96 * err )
 */
  }

  /* "gofast/tools/mathex.pyx":4406
 *         err_lower = arr.mean() - ( 1.96 * err )
 *         err_upper = arr.mean() + ( 1.96 * err )
 *     return err if not return_confidence else ( err_lower, err_upper)             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(4406,0,__PYX_ERR(0, 4406, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_v_return_confidence); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 4406, __pyx_L1_error)
  __pyx_t_5 = (!__pyx_t_6);
  if (__pyx_t_5) {
    __Pyx_INCREF(__pyx_v_err);
    __pyx_t_8 = __pyx_v_err;
  } else {
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4406, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_err_lower);
    __Pyx_GIVEREF(__pyx_v_err_lower);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_err_lower)) __PYX_ERR(0, 4406, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_err_upper);
    __Pyx_GIVEREF(__pyx_v_err_upper);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_err_upper)) __PYX_ERR(0, 4406, __pyx_L1_error);
    __pyx_t_8 = __pyx_t_1;
    __pyx_t_1 = 0;
  }
  __pyx_r = __pyx_t_8;
  __pyx_t_8 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4287
 *     return y
 * 
 * def compute_errors (             # <<<<<<<<<<<<<<
 *     arr,
 *     error ='std',
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex.compute_errors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_err);
  __Pyx_XDECREF(__pyx_v_err_lower);
  __Pyx_XDECREF(__pyx_v_err_upper);
  __Pyx_XDECREF(__pyx_v_N);
  __Pyx_XDECREF(__pyx_v_arr);
  __Pyx_XDECREF(__pyx_v_error);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4409
 * 
 * 
 * def quality_control2(             # <<<<<<<<<<<<<<
 *     ar,
 *     tol: float= .5 ,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_113quality_control2(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_112quality_control2, "\n    Check the quality control in the collection of Z or EDI objects. \n    \n    Analyse the data in the EDI collection and return the quality control value.\n    It indicates how percentage are the data to be representative.\n   \n    Parameters \n    ----------\n    \n    ar: Arraylike of (m_samples, n_features)\n       Arraylike  two dimensional data.\n        \n    tol: float, default=.5 \n        the tolerance parameter. The value indicates the rate from which the \n        data can be consider as meaningful. Preferably it should be less than\n        1 and greater than 0.  Default is ``.5`` means 50 %. Analysis becomes \n        soft with higher `tol` values and severe otherwise. \n        \n    return_data: bool, default= False, \n        returns the valid data from up to ``1-tol%`` goodness. \n        \n    return qco: bool, default=False, \n       retuns quality control object that wraps all usefull informations after \n       control. The following attributes can be fetched as: \n           \n       - rate_: the rate of the quality of the data  \n       - component_: The selected component where data is selected for analysis \n         By default used either ``xy`` or ``yx``. \n       - mode_: The :term:`EM` mode. Either the ['TE'|'TM'] modes \n       - freqs_: The valid frequency in the data selected according to the \n         `tol` parameters. Note that if ``interpolate_freq`` is ``True``, it \n         is used instead. \n       - invalid_freqs_: Useless frequency dropped in the data during control \n       - data_: Valid tensor data either in TE or TM mode. \n       \n    Returns \n    -------\n    Tuple (float  )  or (float, array-like, shape (N, )) or QCo\n        - return the quality control value and interpolated frequency if  \n         `return_freq`  is set to ``True`` otherwise return the\n         only the quality control ratio.\n        - return the the quality control object. \n        \n    Examples \n    -----------\n    >>> import gofast"" as gf \n    >>> data = gf.fetch_data ('huayuan', samples =20, return_data =True ,\n                              key='raw')\n    >>> r,= gf.qc (data)\n    r\n    Out[61]: 0.75\n    >>> r, = gf.qc (data, tol=.2 )\n    0.75\n    >>> r, = gf.qc (data, tol=.1 )\n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_113quality_control2 = {"quality_control2", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_113quality_control2, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_112quality_control2};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_113quality_control2(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ar = 0;
  double __pyx_v_tol;
  PyObject *__pyx_v_return_data = 0;
  CYTHON_UNUSED PyObject *__pyx_v_to_log10 = 0;
  PyObject *__pyx_v_return_qco = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("quality_control2 (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ar,&__pyx_n_s_tol,&__pyx_n_s_return_data,&__pyx_n_s_to_log10,&__pyx_n_s_return_qco,0};

    /* "gofast/tools/mathex.pyx":4412
 *     ar,
 *     tol: float= .5 ,
 *     return_data=False,             # <<<<<<<<<<<<<<
 *     to_log10: bool =False,
 *     return_qco:bool=False
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":4413
 *     tol: float= .5 ,
 *     return_data=False,
 *     to_log10: bool =False,             # <<<<<<<<<<<<<<
 *     return_qco:bool=False
 *     )->Tuple[float, ArrayLike]:
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":4414
 *     return_data=False,
 *     to_log10: bool =False,
 *     return_qco:bool=False             # <<<<<<<<<<<<<<
 *     )->Tuple[float, ArrayLike]:
 *     """
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ar)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4409, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_tol);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4409, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_return_data);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4409, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_to_log10);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4409, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_return_qco);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4409, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "quality_control2") < 0)) __PYX_ERR(0, 4409, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_ar = values[0];
    if (values[1]) {
      __pyx_v_tol = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_tol == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 4411, __pyx_L3_error)
    } else {
      __pyx_v_tol = ((double)((double).5));
    }
    __pyx_v_return_data = values[2];
    __pyx_v_to_log10 = values[3];
    __pyx_v_return_qco = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("quality_control2", 0, 1, 5, __pyx_nargs); __PYX_ERR(0, 4409, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.quality_control2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_112quality_control2(__pyx_self, __pyx_v_ar, __pyx_v_tol, __pyx_v_return_data, __pyx_v_to_log10, __pyx_v_return_qco);

  /* "gofast/tools/mathex.pyx":4409
 * 
 * 
 * def quality_control2(             # <<<<<<<<<<<<<<
 *     ar,
 *     tol: float= .5 ,
 */

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_112quality_control2(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ar, double __pyx_v_tol, PyObject *__pyx_v_return_data, CYTHON_UNUSED PyObject *__pyx_v_to_log10, PyObject *__pyx_v_return_qco) {
  PyObject *__pyx_v_nan_sum = NULL;
  PyObject *__pyx_v_rr = NULL;
  PyObject *__pyx_v_ck = NULL;
  PyObject *__pyx_v_index = NULL;
  PyObject *__pyx_v_data = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  double __pyx_t_5;
  int __pyx_t_6;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__134)
  __Pyx_RefNannySetupContext("quality_control2", 0);
  __Pyx_TraceCall("quality_control2", __pyx_f[0], 4409, 0, __PYX_ERR(0, 4409, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_return_data);

  /* "gofast/tools/mathex.pyx":4472
 * 
 *     """
 *     tol = assert_ratio(tol , bounds =(0, 1), exclude_value ='use lower bound',             # <<<<<<<<<<<<<<
 *                          name ='tolerance', in_percent =True )
 *     # by default , we used the resistivity tensor and error at TE mode.
 */
  __Pyx_TraceLine(4472,0,__PYX_ERR(0, 4472, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_assert_ratio); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4472, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyFloat_FromDouble(__pyx_v_tol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4472, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4472, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 4472, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4472, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_bounds, __pyx_tuple__13) < 0) __PYX_ERR(0, 4472, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_exclude_value, __pyx_kp_u_use_lower_bound) < 0) __PYX_ERR(0, 4472, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_name_2, __pyx_n_u_tolerance) < 0) __PYX_ERR(0, 4472, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4473
 *     """
 *     tol = assert_ratio(tol , bounds =(0, 1), exclude_value ='use lower bound',
 *                          name ='tolerance', in_percent =True )             # <<<<<<<<<<<<<<
 *     # by default , we used the resistivity tensor and error at TE mode.
 *     # force using the error when resistivity or phase tensors are supplied
 */
  __Pyx_TraceLine(4473,0,__PYX_ERR(0, 4473, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_in_percent, Py_True) < 0) __PYX_ERR(0, 4472, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4472
 * 
 *     """
 *     tol = assert_ratio(tol , bounds =(0, 1), exclude_value ='use lower bound',             # <<<<<<<<<<<<<<
 *                          name ='tolerance', in_percent =True )
 *     # by default , we used the resistivity tensor and error at TE mode.
 */
  __Pyx_TraceLine(4472,0,__PYX_ERR(0, 4472, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4472, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = __pyx_PyFloat_AsDouble(__pyx_t_4); if (unlikely((__pyx_t_5 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 4472, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_tol = __pyx_t_5;

  /* "gofast/tools/mathex.pyx":4477
 *     # force using the error when resistivity or phase tensors are supplied
 *     # compute the ratio of NaN in axis =0
 *     nan_sum  =np.nansum(np.isnan(ar), axis =1)             # <<<<<<<<<<<<<<
 * 
 *     rr= np.around ( nan_sum / ar.shape[1] , 2)
 */
  __Pyx_TraceLine(4477,0,__PYX_ERR(0, 4477, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_nansum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_isnan); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_ar};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4477, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 4477, __pyx_L1_error);
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_axis, __pyx_int_1) < 0) __PYX_ERR(0, 4477, __pyx_L1_error)
  __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4477, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_nan_sum = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4479
 *     nan_sum  =np.nansum(np.isnan(ar), axis =1)
 * 
 *     rr= np.around ( nan_sum / ar.shape[1] , 2)             # <<<<<<<<<<<<<<
 *     # print(rr); print(nan_sum)
 *     # print(rr[0])
 */
  __Pyx_TraceLine(4479,0,__PYX_ERR(0, 4479, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4479, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_around); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4479, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_ar, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4479, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_4, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4479, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_v_nan_sum, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4479, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_1))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_1);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_1, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_2, __pyx_t_4, __pyx_int_2};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4479, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  }
  __pyx_v_rr = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4489
 * 
 *     # using np.nonzero(rr) seems deprecated
 *     ck = 1 - nan_sum[np.nonzero(rr)[0]].sum() / (             # <<<<<<<<<<<<<<
 *         ar.shape [0] * ar.shape [1])
 *     # ck = 1 - nan_sum[rr[0]].sum() / (
 */
  __Pyx_TraceLine(4489,0,__PYX_ERR(0, 4489, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_nonzero); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_rr};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4489, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_v_nan_sum, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_sum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4489, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }

  /* "gofast/tools/mathex.pyx":4490
 *     # using np.nonzero(rr) seems deprecated
 *     ck = 1 - nan_sum[np.nonzero(rr)[0]].sum() / (
 *         ar.shape [0] * ar.shape [1])             # <<<<<<<<<<<<<<
 *     # ck = 1 - nan_sum[rr[0]].sum() / (
 *     #     ar.shape [0] * ar.shape [1])
 */
  __Pyx_TraceLine(4490,0,__PYX_ERR(0, 4490, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ar, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_ar, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4490, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4489
 * 
 *     # using np.nonzero(rr) seems deprecated
 *     ck = 1 - nan_sum[np.nonzero(rr)[0]].sum() / (             # <<<<<<<<<<<<<<
 *         ar.shape [0] * ar.shape [1])
 *     # ck = 1 - nan_sum[rr[0]].sum() / (
 */
  __Pyx_TraceLine(4489,0,__PYX_ERR(0, 4489, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyNumber_Divide(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_t_4, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4489, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_ck = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4495
 *     # now consider dirty data where the value is higher
 *     # than the tol parameter and safe otherwise.
 *     index = reshape (np.argwhere (rr > tol))             # <<<<<<<<<<<<<<
 *     # ar_new = np.delete (rr , index , axis = 0 )
 *     # if return QCobj then block all returns  to True
 */
  __Pyx_TraceLine(4495,0,__PYX_ERR(0, 4495, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_reshape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4495, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4495, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_argwhere); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4495, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyFloat_FromDouble(__pyx_v_tol); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4495, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = PyObject_RichCompare(__pyx_v_rr, __pyx_t_1, Py_GT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4495, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_8};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4495, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_3};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4495, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_v_index = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4498
 *     # ar_new = np.delete (rr , index , axis = 0 )
 *     # if return QCobj then block all returns  to True
 *     if return_qco:             # <<<<<<<<<<<<<<
 *         return_data = True
 * 
 */
  __Pyx_TraceLine(4498,0,__PYX_ERR(0, 4498, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_return_qco); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4498, __pyx_L1_error)
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4499
 *     # if return QCobj then block all returns  to True
 *     if return_qco:
 *         return_data = True             # <<<<<<<<<<<<<<
 * 
 *     data =[ np.around (ck, 2) ]
 */
    __Pyx_TraceLine(4499,0,__PYX_ERR(0, 4499, __pyx_L1_error))
    __Pyx_INCREF(Py_True);
    __Pyx_DECREF_SET(__pyx_v_return_data, Py_True);

    /* "gofast/tools/mathex.pyx":4498
 *     # ar_new = np.delete (rr , index , axis = 0 )
 *     # if return QCobj then block all returns  to True
 *     if return_qco:             # <<<<<<<<<<<<<<
 *         return_data = True
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4501
 *         return_data = True
 * 
 *     data =[ np.around (ck, 2) ]             # <<<<<<<<<<<<<<
 * 
 *     if return_data :
 */
  __Pyx_TraceLine(4501,0,__PYX_ERR(0, 4501, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4501, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_around); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4501, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_ck, __pyx_int_2};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4501, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4501, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 4501, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_v_data = __pyx_t_3;
  __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4503
 *     data =[ np.around (ck, 2) ]
 * 
 *     if return_data :             # <<<<<<<<<<<<<<
 *         data += [ np.delete ( ar, index , axis =0 )]
 * 
 */
  __Pyx_TraceLine(4503,0,__PYX_ERR(0, 4503, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_return_data); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4503, __pyx_L1_error)
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4504
 * 
 *     if return_data :
 *         data += [ np.delete ( ar, index , axis =0 )]             # <<<<<<<<<<<<<<
 * 
 *     data = tuple (data )
 */
    __Pyx_TraceLine(4504,0,__PYX_ERR(0, 4504, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_delete); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_ar);
    __Pyx_GIVEREF(__pyx_v_ar);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_ar)) __PYX_ERR(0, 4504, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_index);
    __Pyx_GIVEREF(__pyx_v_index);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_index)) __PYX_ERR(0, 4504, __pyx_L1_error);
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 4504, __pyx_L1_error)
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_GIVEREF(__pyx_t_7);
    if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_7)) __PYX_ERR(0, 4504, __pyx_L1_error);
    __pyx_t_7 = 0;
    __pyx_t_7 = PyNumber_InPlaceAdd(__pyx_v_data, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4504, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "gofast/tools/mathex.pyx":4503
 *     data =[ np.around (ck, 2) ]
 * 
 *     if return_data :             # <<<<<<<<<<<<<<
 *         data += [ np.delete ( ar, index , axis =0 )]
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4506
 *         data += [ np.delete ( ar, index , axis =0 )]
 * 
 *     data = tuple (data )             # <<<<<<<<<<<<<<
 *     # make QCO object
 *     if return_qco:
 */
  __Pyx_TraceLine(4506,0,__PYX_ERR(0, 4506, __pyx_L1_error))
  __pyx_t_7 = __Pyx_PySequence_Tuple(__pyx_v_data); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4506, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_7);
  __pyx_t_7 = 0;

  /* "gofast/tools/mathex.pyx":4508
 *     data = tuple (data )
 *     # make QCO object
 *     if return_qco:             # <<<<<<<<<<<<<<
 *         data = KeyBox( **dict (
 *             tol=tol,
 */
  __Pyx_TraceLine(4508,0,__PYX_ERR(0, 4508, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_return_qco); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4508, __pyx_L1_error)
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4509
 *     # make QCO object
 *     if return_qco:
 *         data = KeyBox( **dict (             # <<<<<<<<<<<<<<
 *             tol=tol,
 *             rate_= float(np.around (ck, 2)),
 */
    __Pyx_TraceLine(4509,0,__PYX_ERR(0, 4509, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_KeyBox); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4509, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);

    /* "gofast/tools/mathex.pyx":4510
 *     if return_qco:
 *         data = KeyBox( **dict (
 *             tol=tol,             # <<<<<<<<<<<<<<
 *             rate_= float(np.around (ck, 2)),
 *             data_=  np.delete ( ar, index , axis =0 )
 */
    __Pyx_TraceLine(4510,0,__PYX_ERR(0, 4510, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4510, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_tol); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4510, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tol, __pyx_t_2) < 0) __PYX_ERR(0, 4510, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":4511
 *         data = KeyBox( **dict (
 *             tol=tol,
 *             rate_= float(np.around (ck, 2)),             # <<<<<<<<<<<<<<
 *             data_=  np.delete ( ar, index , axis =0 )
 *             )
 */
    __Pyx_TraceLine(4511,0,__PYX_ERR(0, 4511, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4511, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_around); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4511, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_8 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_1))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_1, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_8, __pyx_v_ck, __pyx_int_2};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4511, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    }
    __pyx_t_1 = __Pyx_PyNumber_Float(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4511, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_rate, __pyx_t_1) < 0) __PYX_ERR(0, 4510, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4512
 *             tol=tol,
 *             rate_= float(np.around (ck, 2)),
 *             data_=  np.delete ( ar, index , axis =0 )             # <<<<<<<<<<<<<<
 *             )
 *         )
 */
    __Pyx_TraceLine(4512,0,__PYX_ERR(0, 4512, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_delete); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_ar);
    __Pyx_GIVEREF(__pyx_v_ar);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_ar)) __PYX_ERR(0, 4512, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_index);
    __Pyx_GIVEREF(__pyx_v_index);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_index)) __PYX_ERR(0, 4512, __pyx_L1_error);
    __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_axis, __pyx_int_0) < 0) __PYX_ERR(0, 4512, __pyx_L1_error)
    __pyx_t_10 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_1, __pyx_t_8); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4512, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_data_2, __pyx_t_10) < 0) __PYX_ERR(0, 4510, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_4 = __pyx_t_3;
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4509
 *     # make QCO object
 *     if return_qco:
 *         data = KeyBox( **dict (             # <<<<<<<<<<<<<<
 *             tol=tol,
 *             rate_= float(np.around (ck, 2)),
 */
    __Pyx_TraceLine(4509,0,__PYX_ERR(0, 4509, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_empty_tuple, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4509, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_data, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4508
 *     data = tuple (data )
 *     # make QCO object
 *     if return_qco:             # <<<<<<<<<<<<<<
 *         data = KeyBox( **dict (
 *             tol=tol,
 */
  }

  /* "gofast/tools/mathex.pyx":4515
 *             )
 *         )
 *     return data             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(4515,0,__PYX_ERR(0, 4515, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_data);
  __pyx_r = __pyx_v_data;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4409
 * 
 * 
 * def quality_control2(             # <<<<<<<<<<<<<<
 *     ar,
 *     tol: float= .5 ,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_AddTraceback("gofast.tools.mathex.quality_control2", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_nan_sum);
  __Pyx_XDECREF(__pyx_v_rr);
  __Pyx_XDECREF(__pyx_v_ck);
  __Pyx_XDECREF(__pyx_v_index);
  __Pyx_XDECREF(__pyx_v_data);
  __Pyx_XDECREF(__pyx_v_return_data);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4518
 * 
 * 
 * def get_distance(             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike , *,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_115get_distance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_114get_distance, "\n    Compute distance between points.\n    \n    Parameters\n    ------------\n    x, y: ArrayLike 1d, \n       One dimensional arrays. `x` can be consider as the abscissa of the  \n       landmark and `y` as ordinates array. \n       \n    return_mean_dist: bool, default =False, \n       Returns the average value of the distance between different points. \n       \n    is_latlon: bool, default=False, \n        Convert `x` and `y` latitude  and longitude coordinates values \n        into UTM before computing the distance. `x`, `y` should be considered \n        as ``easting`` and ``northing`` respectively. \n        \n    kws: dict, \n       Keyword arguments passed to :meth:`gofast.site.Location.to_utm_in`\n       \n    Returns \n    ---------\n    d: Arraylike of shape (N-1) \n      Is the distance between points. \n      \n    Examples \n    --------- \n    >>> import numpy as np \n    >>> from gofast.tools.mathex  import get_distance \n    >>> x = np.random.rand (7) *10 \n    >>> y = np.abs ( np.random.randn (7) * 12 ) \n    >>> get_distance (x, y) \n    array([ 8.7665511 , 12.47545656,  8.53730212, 13.54998351, 14.0419387 ,\n           20.12086781])\n    >>> get_distance (x, y, return_mean_dist= True) \n    12.91534996818084\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_115get_distance = {"get_distance", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_115get_distance, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_114get_distance};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_115get_distance(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_return_mean_dist = 0;
  PyObject *__pyx_v_is_latlon = 0;
  PyObject *__pyx_v_kws = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_distance (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  __pyx_v_kws = PyDict_New(); if (unlikely(!__pyx_v_kws)) return NULL;
  __Pyx_GOTREF(__pyx_v_kws);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_y,&__pyx_n_s_return_mean_dist,&__pyx_n_s_is_latlon,0};

    /* "gofast/tools/mathex.pyx":4521
 *     x: ArrayLike,
 *     y:ArrayLike , *,
 *     return_mean_dist:bool =False,             # <<<<<<<<<<<<<<
 *     is_latlon= False ,
 *     **kws
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":4522
 *     y:ArrayLike , *,
 *     return_mean_dist:bool =False,
 *     is_latlon= False ,             # <<<<<<<<<<<<<<
 *     **kws
 *     ):
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4518, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4518, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("get_distance", 1, 2, 2, 1); __PYX_ERR(0, 4518, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && (kw_args <= 2)) {
        Py_ssize_t index;
        for (index = 2; index < 4 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4518, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kws, values + 0, kwd_pos_args, "get_distance") < 0)) __PYX_ERR(0, 4518, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_x = values[0];
    __pyx_v_y = values[1];
    __pyx_v_return_mean_dist = values[2];
    __pyx_v_is_latlon = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_distance", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 4518, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_DECREF(__pyx_v_kws); __pyx_v_kws = 0;
  __Pyx_AddTraceback("gofast.tools.mathex.get_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_114get_distance(__pyx_self, __pyx_v_x, __pyx_v_y, __pyx_v_return_mean_dist, __pyx_v_is_latlon, __pyx_v_kws);

  /* "gofast/tools/mathex.pyx":4518
 * 
 * 
 * def get_distance(             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike , *,
 */

  /* function exit code */
  __Pyx_DECREF(__pyx_v_kws);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_114get_distance(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y, PyObject *__pyx_v_return_mean_dist, PyObject *__pyx_v_is_latlon, PyObject *__pyx_v_kws) {
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__135)
  __Pyx_RefNannySetupContext("get_distance", 0);
  __Pyx_TraceCall("get_distance", __pyx_f[0], 4518, 0, __PYX_ERR(0, 4518, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_INCREF(__pyx_v_y);

  /* "gofast/tools/mathex.pyx":4562
 *     12.91534996818084
 *     """
 *     x, y = _assert_x_y_positions (x, y, is_latlon , **kws  )             # <<<<<<<<<<<<<<
 *     d = np.sqrt( np.diff (x) **2 + np.diff (y)**2 )
 * 
 */
  __Pyx_TraceLine(4562,0,__PYX_ERR(0, 4562, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_assert_x_y_positions); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_x)) __PYX_ERR(0, 4562, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_GIVEREF(__pyx_v_y);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y)) __PYX_ERR(0, 4562, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_is_latlon);
  __Pyx_GIVEREF(__pyx_v_is_latlon);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_v_is_latlon)) __PYX_ERR(0, 4562, __pyx_L1_error);
  __pyx_t_3 = PyDict_Copy(__pyx_v_kws); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4562, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_4))) || (PyList_CheckExact(__pyx_t_4))) {
    PyObject* sequence = __pyx_t_4;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 4562, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_3 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_3 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_3 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4562, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4562, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_1 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4562, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_1); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_5(__pyx_t_1), 2) < 0) __PYX_ERR(0, 4562, __pyx_L1_error)
    __pyx_t_5 = NULL;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 4562, __pyx_L1_error)
    __pyx_L4_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_3);
  __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4563
 *     """
 *     x, y = _assert_x_y_positions (x, y, is_latlon , **kws  )
 *     d = np.sqrt( np.diff (x) **2 + np.diff (y)**2 )             # <<<<<<<<<<<<<<
 * 
 *     return d.mean()  if return_mean_dist else d
 */
  __Pyx_TraceLine(4563,0,__PYX_ERR(0, 4563, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sqrt); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_diff); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_x};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4563, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_t_6 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_diff); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_v_y};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4563, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = PyNumber_Power(__pyx_t_2, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Add(__pyx_t_6, __pyx_t_8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4563, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_2};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4563, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_d = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4565
 *     d = np.sqrt( np.diff (x) **2 + np.diff (y)**2 )
 * 
 *     return d.mean()  if return_mean_dist else d             # <<<<<<<<<<<<<<
 * 
 * def scale_positions (
 */
  __Pyx_TraceLine(4565,0,__PYX_ERR(0, 4565, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_return_mean_dist); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4565, __pyx_L1_error)
  if (__pyx_t_9) {
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_d, __pyx_n_s_mean); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4565, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_8, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4565, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_4 = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __Pyx_INCREF(__pyx_v_d);
    __pyx_t_4 = __pyx_v_d;
  }
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4518
 * 
 * 
 * def get_distance(             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike , *,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex.get_distance", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4567
 *     return d.mean()  if return_mean_dist else d
 * 
 * def scale_positions (             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_117scale_positions(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_116scale_positions, "\n    Correct the position coordinates. \n     \n    By default, it consider `x` and `y` as easting/latitude and \n    northing/longitude coordinates respectively. It latitude and longitude \n    are given, specify the parameter `is_latlon` to ``True``. \n    \n    Parameters\n    ----------\n    x, y: ArrayLike 1d, \n       One dimensional arrays. `x` can be consider as the abscissa of the  \n       landmark and `y` as ordinates array. \n       \n    is_latlon: bool, default=False, \n       Convert `x` and `y` latitude  and longitude coordinates values \n       into UTM before computing the distance. `x`, `y` should be considered \n       as ``easting`` and ``northing`` respectively. \n           \n    step: float, Optional \n       The positions separation. If not given, the average distance between \n       all positions should be used instead. \n    use_average_dist: bool, default=False, \n       Use the distance computed between positions for the correction. \n    utm_zone: str,  Optional (##N or ##S)\n       UTM zone in the form of number and North or South hemisphere. For\n       instance '10S' or '03N'. Note that if `x` and `y` are UTM coordinates,\n       the `utm_zone` must be provide to accurately correct the positions, \n       otherwise the default value ``49R`` should be used which may lead to \n       less accuracy. \n       \n    shift: bool, default=True,\n       Shift the coordinates from the units of `step`. This is the default \n       behavor. If ``False``, the positions are just scaled. \n    \n    view: bool, default=True \n       Visualize the scaled positions \n       \n    kws: dict, \n       Keyword arguments passed to :func:`~.get_distance` \n    Returns \n    --------\n    xx, yy: Arraylike 1d, \n       The arrays of position correction from `x` and `y` using the \n       bearing. \n       \n    See Also \n    ---------\n    gofast.tools.mathex .get_bearing: \n        Compute the  direction of one point relative to another point. \n     "" \n    Examples\n    ---------\n    >>> from gofast.tools.mathex  import scale_positions \n    >>> east = [336698.731, 336714.574, 336730.305] \n    >>> north = [3143970.128, 3143957.934, 3143945.76]\n    >>> east_c , north_c= scale_positions (east, north, step =20, view =True  ) \n    >>> east_c , north_c\n    (array([336686.69198337, 336702.53498337, 336718.26598337]),\n     array([3143986.09866306, 3143973.90466306, 3143961.73066306]))\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_117scale_positions = {"scale_positions", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_117scale_positions, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_116scale_positions};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_117scale_positions(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_is_latlon = 0;
  PyObject *__pyx_v_step = 0;
  PyObject *__pyx_v_use_average_dist = 0;
  PyObject *__pyx_v_utm_zone = 0;
  PyObject *__pyx_v_shift = 0;
  PyObject *__pyx_v_view = 0;
  PyObject *__pyx_v_kws = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[8] = {0,0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("scale_positions (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  __pyx_v_kws = PyDict_New(); if (unlikely(!__pyx_v_kws)) return NULL;
  __Pyx_GOTREF(__pyx_v_kws);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_y,&__pyx_n_s_is_latlon,&__pyx_n_s_step,&__pyx_n_s_use_average_dist,&__pyx_n_s_utm_zone,&__pyx_n_s_shift,&__pyx_n_s_view,0};

    /* "gofast/tools/mathex.pyx":4571
 *     y:ArrayLike,
 *     *,
 *     is_latlon:bool=False,             # <<<<<<<<<<<<<<
 *     step:float= None,
 *     use_average_dist:bool=False,
 */
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":4572
 *     *,
 *     is_latlon:bool=False,
 *     step:float= None,             # <<<<<<<<<<<<<<
 *     use_average_dist:bool=False,
 *     utm_zone:str= None,
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)Py_None));

    /* "gofast/tools/mathex.pyx":4573
 *     is_latlon:bool=False,
 *     step:float= None,
 *     use_average_dist:bool=False,             # <<<<<<<<<<<<<<
 *     utm_zone:str= None,
 *     shift: bool=True,
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":4574
 *     step:float= None,
 *     use_average_dist:bool=False,
 *     utm_zone:str= None,             # <<<<<<<<<<<<<<
 *     shift: bool=True,
 *     view:bool = False,
 */
    values[5] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)Py_None));

    /* "gofast/tools/mathex.pyx":4575
 *     use_average_dist:bool=False,
 *     utm_zone:str= None,
 *     shift: bool=True,             # <<<<<<<<<<<<<<
 *     view:bool = False,
 *     **kws
 */
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));

    /* "gofast/tools/mathex.pyx":4576
 *     utm_zone:str= None,
 *     shift: bool=True,
 *     view:bool = False,             # <<<<<<<<<<<<<<
 *     **kws
 *     ):
 */
    values[7] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4567, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4567, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("scale_positions", 1, 2, 2, 1); __PYX_ERR(0, 4567, __pyx_L3_error)
        }
      }
      if (kw_args > 0 && (kw_args <= 6)) {
        Py_ssize_t index;
        for (index = 2; index < 8 && kw_args > 0; index++) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, *__pyx_pyargnames[index]);
          if (value) { values[index] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4567, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kws, values + 0, kwd_pos_args, "scale_positions") < 0)) __PYX_ERR(0, 4567, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_x = values[0];
    __pyx_v_y = values[1];
    __pyx_v_is_latlon = values[2];
    __pyx_v_step = ((PyObject*)values[3]);
    __pyx_v_use_average_dist = values[4];
    __pyx_v_utm_zone = ((PyObject*)values[5]);
    __pyx_v_shift = values[6];
    __pyx_v_view = values[7];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("scale_positions", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 4567, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_DECREF(__pyx_v_kws); __pyx_v_kws = 0;
  __Pyx_AddTraceback("gofast.tools.mathex.scale_positions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_step), (&PyFloat_Type), 1, "step", 1))) __PYX_ERR(0, 4572, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_utm_zone), (&PyUnicode_Type), 1, "utm_zone", 1))) __PYX_ERR(0, 4574, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_116scale_positions(__pyx_self, __pyx_v_x, __pyx_v_y, __pyx_v_is_latlon, __pyx_v_step, __pyx_v_use_average_dist, __pyx_v_utm_zone, __pyx_v_shift, __pyx_v_view, __pyx_v_kws);

  /* "gofast/tools/mathex.pyx":4567
 *     return d.mean()  if return_mean_dist else d
 * 
 * def scale_positions (             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike,
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_DECREF(__pyx_v_kws);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_116scale_positions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y, PyObject *__pyx_v_is_latlon, PyObject *__pyx_v_step, PyObject *__pyx_v_use_average_dist, PyObject *__pyx_v_utm_zone, PyObject *__pyx_v_shift, PyObject *__pyx_v_view, PyObject *__pyx_v_kws) {
  PyObject *__pyx_v_Location = NULL;
  PyObject *__pyx_v_msg = NULL;
  PyObject *__pyx_v_xs = NULL;
  PyObject *__pyx_v_ys = NULL;
  PyObject *__pyx_v_d = NULL;
  PyObject *__pyx_v_b = NULL;
  PyObject *__pyx_v_xx = NULL;
  PyObject *__pyx_v_yy = NULL;
  CYTHON_UNUSED PyObject *__pyx_v__ = NULL;
  PyObject *__pyx_v_state = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_t_3;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  int __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *(*__pyx_t_9)(PyObject *);
  int __pyx_t_10;
  int __pyx_t_11;
  Py_ssize_t __pyx_t_12;
  Py_UCS4 __pyx_t_13;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__136)
  __Pyx_RefNannySetupContext("scale_positions", 0);
  __Pyx_TraceCall("scale_positions", __pyx_f[0], 4567, 0, __PYX_ERR(0, 4567, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_INCREF(__pyx_v_use_average_dist);
  __Pyx_INCREF(__pyx_v_utm_zone);

  /* "gofast/tools/mathex.pyx":4639
 *      array([3143986.09866306, 3143973.90466306, 3143961.73066306]))
 *     """
 *     from ..site import Location             # <<<<<<<<<<<<<<
 * 
 *     msg =("x, y are not in longitude/latitude format  while 'utm_zone' is not"
 */
  __Pyx_TraceLine(4639,0,__PYX_ERR(0, 4639, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4639, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_Location);
  __Pyx_GIVEREF(__pyx_n_s_Location);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_Location)) __PYX_ERR(0, 4639, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_site, __pyx_t_1, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4639, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Location); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4639, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_Location = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4641
 *     from ..site import Location
 * 
 *     msg =("x, y are not in longitude/latitude format  while 'utm_zone' is not"             # <<<<<<<<<<<<<<
 *           " supplied. Correction should be less accurate. Provide the UTM"
 *           " zone to improve the accuracy.")
 */
  __Pyx_TraceLine(4641,0,__PYX_ERR(0, 4641, __pyx_L1_error))
  __Pyx_INCREF(__pyx_kp_u_x_y_are_not_in_longitude_latitud);
  __pyx_v_msg = __pyx_kp_u_x_y_are_not_in_longitude_latitud;

  /* "gofast/tools/mathex.pyx":4645
 *           " zone to improve the accuracy.")
 * 
 *     if is_latlon:             # <<<<<<<<<<<<<<
 *         xs , ys = np.array(copy.deepcopy(x)) , np.array(copy.deepcopy(y))
 * 
 */
  __Pyx_TraceLine(4645,0,__PYX_ERR(0, 4645, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_is_latlon); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4645, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4646
 * 
 *     if is_latlon:
 *         xs , ys = np.array(copy.deepcopy(x)) , np.array(copy.deepcopy(y))             # <<<<<<<<<<<<<<
 * 
 *     x, y = _assert_x_y_positions( x, y, islatlon = is_latlon , **kws )
 */
    __Pyx_TraceLine(4646,0,__PYX_ERR(0, 4646, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_copy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_x};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_t_1};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_array_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_copy); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_deepcopy); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4646, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_5 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_y};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    __pyx_t_8 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_1};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4646, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __pyx_v_xs = __pyx_t_2;
    __pyx_t_2 = 0;
    __pyx_v_ys = __pyx_t_4;
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4645
 *           " zone to improve the accuracy.")
 * 
 *     if is_latlon:             # <<<<<<<<<<<<<<
 *         xs , ys = np.array(copy.deepcopy(x)) , np.array(copy.deepcopy(y))
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4648
 *         xs , ys = np.array(copy.deepcopy(x)) , np.array(copy.deepcopy(y))
 * 
 *     x, y = _assert_x_y_positions( x, y, islatlon = is_latlon , **kws )             # <<<<<<<<<<<<<<
 * 
 *     if step is None:
 */
  __Pyx_TraceLine(4648,0,__PYX_ERR(0, 4648, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_assert_x_y_positions); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4648, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4648, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_x)) __PYX_ERR(0, 4648, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_GIVEREF(__pyx_v_y);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_v_y)) __PYX_ERR(0, 4648, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4648, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_islatlon, __pyx_v_is_latlon) < 0) __PYX_ERR(0, 4648, __pyx_L1_error)
  __pyx_t_6 = __pyx_t_1;
  __pyx_t_1 = 0;
  if (__Pyx_MergeKeywords(__pyx_t_6, __pyx_v_kws) < 0) __PYX_ERR(0, 4648, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4648, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_1))) || (PyList_CheckExact(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 4648, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_2 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_2);
    #else
    __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4648, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4648, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4648, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
    index = 0; __pyx_t_6 = __pyx_t_9(__pyx_t_4); if (unlikely(!__pyx_t_6)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_6);
    index = 1; __pyx_t_2 = __pyx_t_9(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L4_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_2);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_4), 2) < 0) __PYX_ERR(0, 4648, __pyx_L1_error)
    __pyx_t_9 = NULL;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L5_unpacking_done;
    __pyx_L4_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_9 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 4648, __pyx_L1_error)
    __pyx_L5_unpacking_done:;
  }
  __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_6);
  __pyx_t_6 = 0;
  __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4650
 *     x, y = _assert_x_y_positions( x, y, islatlon = is_latlon , **kws )
 * 
 *     if step is None:             # <<<<<<<<<<<<<<
 *         warnings.warn("Step is not given. Average distance between points"
 *                       " should be used instead.")
 */
  __Pyx_TraceLine(4650,0,__PYX_ERR(0, 4650, __pyx_L1_error))
  __pyx_t_3 = (__pyx_v_step == ((PyObject*)Py_None));
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4651
 * 
 *     if step is None:
 *         warnings.warn("Step is not given. Average distance between points"             # <<<<<<<<<<<<<<
 *                       " should be used instead.")
 *         use_average_dist =True
 */
    __Pyx_TraceLine(4651,0,__PYX_ERR(0, 4651, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_warnings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4651, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_warn); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4651, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_kp_u_Step_is_not_given_Average_distan};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4651, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4653
 *         warnings.warn("Step is not given. Average distance between points"
 *                       " should be used instead.")
 *         use_average_dist =True             # <<<<<<<<<<<<<<
 *     else:
 *         d = float (_assert_all_types(step, float, int , objname ='Step (m)'))
 */
    __Pyx_TraceLine(4653,0,__PYX_ERR(0, 4653, __pyx_L1_error))
    __Pyx_INCREF(Py_True);
    __Pyx_DECREF_SET(__pyx_v_use_average_dist, Py_True);

    /* "gofast/tools/mathex.pyx":4650
 *     x, y = _assert_x_y_positions( x, y, islatlon = is_latlon , **kws )
 * 
 *     if step is None:             # <<<<<<<<<<<<<<
 *         warnings.warn("Step is not given. Average distance between points"
 *                       " should be used instead.")
 */
    goto __pyx_L6;
  }

  /* "gofast/tools/mathex.pyx":4655
 *         use_average_dist =True
 *     else:
 *         d = float (_assert_all_types(step, float, int , objname ='Step (m)'))             # <<<<<<<<<<<<<<
 *     if use_average_dist:
 *         d = get_distance(x, y, return_mean_dist=use_average_dist,  **kws)
 */
  __Pyx_TraceLine(4655,0,__PYX_ERR(0, 4655, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_v_step);
    __Pyx_GIVEREF(__pyx_v_step);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_step)) __PYX_ERR(0, 4655, __pyx_L1_error);
    __Pyx_INCREF((PyObject *)(&PyFloat_Type));
    __Pyx_GIVEREF((PyObject *)(&PyFloat_Type));
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, ((PyObject *)(&PyFloat_Type)))) __PYX_ERR(0, 4655, __pyx_L1_error);
    __Pyx_INCREF((PyObject *)(&PyInt_Type));
    __Pyx_GIVEREF((PyObject *)(&PyInt_Type));
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, ((PyObject *)(&PyInt_Type)))) __PYX_ERR(0, 4655, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_objname, __pyx_kp_u_Step_m) < 0) __PYX_ERR(0, 4655, __pyx_L1_error)
    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_6, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyNumber_Float(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4655, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_v_d = __pyx_t_2;
    __pyx_t_2 = 0;
  }
  __pyx_L6:;

  /* "gofast/tools/mathex.pyx":4656
 *     else:
 *         d = float (_assert_all_types(step, float, int , objname ='Step (m)'))
 *     if use_average_dist:             # <<<<<<<<<<<<<<
 *         d = get_distance(x, y, return_mean_dist=use_average_dist,  **kws)
 * 
 */
  __Pyx_TraceLine(4656,0,__PYX_ERR(0, 4656, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_use_average_dist); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4656, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4657
 *         d = float (_assert_all_types(step, float, int , objname ='Step (m)'))
 *     if use_average_dist:
 *         d = get_distance(x, y, return_mean_dist=use_average_dist,  **kws)             # <<<<<<<<<<<<<<
 * 
 *     # compute bearing.
 */
    __Pyx_TraceLine(4657,0,__PYX_ERR(0, 4657, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_distance); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4657, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4657, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_x)) __PYX_ERR(0, 4657, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y);
    __Pyx_GIVEREF(__pyx_v_y);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_y)) __PYX_ERR(0, 4657, __pyx_L1_error);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4657, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_return_mean_dist, __pyx_v_use_average_dist) < 0) __PYX_ERR(0, 4657, __pyx_L1_error)
    __pyx_t_6 = __pyx_t_1;
    __pyx_t_1 = 0;
    if (__Pyx_MergeKeywords(__pyx_t_6, __pyx_v_kws) < 0) __PYX_ERR(0, 4657, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4657, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF_SET(__pyx_v_d, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4656
 *     else:
 *         d = float (_assert_all_types(step, float, int , objname ='Step (m)'))
 *     if use_average_dist:             # <<<<<<<<<<<<<<
 *         d = get_distance(x, y, return_mean_dist=use_average_dist,  **kws)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4660
 * 
 *     # compute bearing.
 *     utm_zone = utm_zone or '49R'             # <<<<<<<<<<<<<<
 *     if not is_latlon and utm_zone is None:
 *         warnings.warn(msg )
 */
  __Pyx_TraceLine(4660,0,__PYX_ERR(0, 4660, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_utm_zone); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4660, __pyx_L1_error)
  if (!__pyx_t_3) {
  } else {
    __Pyx_INCREF(__pyx_v_utm_zone);
    __pyx_t_1 = __pyx_v_utm_zone;
    goto __pyx_L8_bool_binop_done;
  }
  __Pyx_INCREF(__pyx_kp_u_49R);
  __pyx_t_1 = __pyx_kp_u_49R;
  __pyx_L8_bool_binop_done:;
  __Pyx_DECREF_SET(__pyx_v_utm_zone, ((PyObject*)__pyx_t_1));
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4661
 *     # compute bearing.
 *     utm_zone = utm_zone or '49R'
 *     if not is_latlon and utm_zone is None:             # <<<<<<<<<<<<<<
 *         warnings.warn(msg )
 *     if not is_latlon:
 */
  __Pyx_TraceLine(4661,0,__PYX_ERR(0, 4661, __pyx_L1_error))
  __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_v_is_latlon); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 4661, __pyx_L1_error)
  __pyx_t_11 = (!__pyx_t_10);
  if (__pyx_t_11) {
  } else {
    __pyx_t_3 = __pyx_t_11;
    goto __pyx_L11_bool_binop_done;
  }
  __pyx_t_11 = (__pyx_v_utm_zone == ((PyObject*)Py_None));
  __pyx_t_3 = __pyx_t_11;
  __pyx_L11_bool_binop_done:;
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4662
 *     utm_zone = utm_zone or '49R'
 *     if not is_latlon and utm_zone is None:
 *         warnings.warn(msg )             # <<<<<<<<<<<<<<
 *     if not is_latlon:
 *         xs , ys = Location.to_latlon_in(x, y, utm_zone= utm_zone)
 */
    __Pyx_TraceLine(4662,0,__PYX_ERR(0, 4662, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_warnings); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4662, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_warn); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4662, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_v_msg};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4662, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4661
 *     # compute bearing.
 *     utm_zone = utm_zone or '49R'
 *     if not is_latlon and utm_zone is None:             # <<<<<<<<<<<<<<
 *         warnings.warn(msg )
 *     if not is_latlon:
 */
  }

  /* "gofast/tools/mathex.pyx":4663
 *     if not is_latlon and utm_zone is None:
 *         warnings.warn(msg )
 *     if not is_latlon:             # <<<<<<<<<<<<<<
 *         xs , ys = Location.to_latlon_in(x, y, utm_zone= utm_zone)
 * 
 */
  __Pyx_TraceLine(4663,0,__PYX_ERR(0, 4663, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_is_latlon); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4663, __pyx_L1_error)
  __pyx_t_11 = (!__pyx_t_3);
  if (__pyx_t_11) {

    /* "gofast/tools/mathex.pyx":4664
 *         warnings.warn(msg )
 *     if not is_latlon:
 *         xs , ys = Location.to_latlon_in(x, y, utm_zone= utm_zone)             # <<<<<<<<<<<<<<
 * 
 *     b = get_bearing((xs[0] , ys[0]) , (xs[-1], ys[-1]),
 */
    __Pyx_TraceLine(4664,0,__PYX_ERR(0, 4664, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_Location, __pyx_n_s_to_latlon_in); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4664, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4664, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_x)) __PYX_ERR(0, 4664, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y);
    __Pyx_GIVEREF(__pyx_v_y);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_y)) __PYX_ERR(0, 4664, __pyx_L1_error);
    __pyx_t_6 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4664, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_utm_zone, __pyx_v_utm_zone) < 0) __PYX_ERR(0, 4664, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4664, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 4664, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4664, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_6);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4664, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_1 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4664, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1);
      index = 0; __pyx_t_6 = __pyx_t_9(__pyx_t_1); if (unlikely(!__pyx_t_6)) goto __pyx_L14_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_6);
      index = 1; __pyx_t_4 = __pyx_t_9(__pyx_t_1); if (unlikely(!__pyx_t_4)) goto __pyx_L14_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_9(__pyx_t_1), 2) < 0) __PYX_ERR(0, 4664, __pyx_L1_error)
      __pyx_t_9 = NULL;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      goto __pyx_L15_unpacking_done;
      __pyx_L14_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 4664, __pyx_L1_error)
      __pyx_L15_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_xs, __pyx_t_6);
    __pyx_t_6 = 0;
    __Pyx_XDECREF_SET(__pyx_v_ys, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4663
 *     if not is_latlon and utm_zone is None:
 *         warnings.warn(msg )
 *     if not is_latlon:             # <<<<<<<<<<<<<<
 *         xs , ys = Location.to_latlon_in(x, y, utm_zone= utm_zone)
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4666
 *         xs , ys = Location.to_latlon_in(x, y, utm_zone= utm_zone)
 * 
 *     b = get_bearing((xs[0] , ys[0]) , (xs[-1], ys[-1]),             # <<<<<<<<<<<<<<
 *                     to_deg =False ) # return bearing in rad.
 * 
 */
  __Pyx_TraceLine(4666,0,__PYX_ERR(0, 4666, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_get_bearing); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (unlikely(!__pyx_v_xs)) { __Pyx_RaiseUnboundLocalError("xs"); __PYX_ERR(0, 4666, __pyx_L1_error) }
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_xs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (unlikely(!__pyx_v_ys)) { __Pyx_RaiseUnboundLocalError("ys"); __PYX_ERR(0, 4666, __pyx_L1_error) }
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_ys, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_4)) __PYX_ERR(0, 4666, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_6);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6)) __PYX_ERR(0, 4666, __pyx_L1_error);
  __pyx_t_4 = 0;
  __pyx_t_6 = 0;
  if (unlikely(!__pyx_v_xs)) { __Pyx_RaiseUnboundLocalError("xs"); __PYX_ERR(0, 4666, __pyx_L1_error) }
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_xs, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (unlikely(!__pyx_v_ys)) { __Pyx_RaiseUnboundLocalError("ys"); __PYX_ERR(0, 4666, __pyx_L1_error) }
  __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_ys, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_GIVEREF(__pyx_t_6);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_6)) __PYX_ERR(0, 4666, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4)) __PYX_ERR(0, 4666, __pyx_L1_error);
  __pyx_t_6 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_1)) __PYX_ERR(0, 4666, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_8);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_8)) __PYX_ERR(0, 4666, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_t_8 = 0;

  /* "gofast/tools/mathex.pyx":4667
 * 
 *     b = get_bearing((xs[0] , ys[0]) , (xs[-1], ys[-1]),
 *                     to_deg =False ) # return bearing in rad.             # <<<<<<<<<<<<<<
 * 
 *     xx = x + ( d * np.cos (b))
 */
  __Pyx_TraceLine(4667,0,__PYX_ERR(0, 4667, __pyx_L1_error))
  __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4667, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_to_deg, Py_False) < 0) __PYX_ERR(0, 4667, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4666
 *         xs , ys = Location.to_latlon_in(x, y, utm_zone= utm_zone)
 * 
 *     b = get_bearing((xs[0] , ys[0]) , (xs[-1], ys[-1]),             # <<<<<<<<<<<<<<
 *                     to_deg =False ) # return bearing in rad.
 * 
 */
  __Pyx_TraceLine(4666,0,__PYX_ERR(0, 4666, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4666, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_b = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4669
 *                     to_deg =False ) # return bearing in rad.
 * 
 *     xx = x + ( d * np.cos (b))             # <<<<<<<<<<<<<<
 *     yy = y +  (d * np.sin(b))
 *     if not shift:
 */
  __Pyx_TraceLine(4669,0,__PYX_ERR(0, 4669, __pyx_L1_error))
  if (unlikely(!__pyx_v_d)) { __Pyx_RaiseUnboundLocalError("d"); __PYX_ERR(0, 4669, __pyx_L1_error) }
  __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_cos); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_t_8 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_8)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_8);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_b};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4669, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = PyNumber_Multiply(__pyx_v_d, __pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_v_x, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4669, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_xx = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4670
 * 
 *     xx = x + ( d * np.cos (b))
 *     yy = y +  (d * np.sin(b))             # <<<<<<<<<<<<<<
 *     if not shift:
 *         xx, *_ = scalePosition(x )
 */
  __Pyx_TraceLine(4670,0,__PYX_ERR(0, 4670, __pyx_L1_error))
  if (unlikely(!__pyx_v_d)) { __Pyx_RaiseUnboundLocalError("d"); __PYX_ERR(0, 4670, __pyx_L1_error) }
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sin); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_7 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_8))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_8, function);
      __pyx_t_7 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_b};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4670, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  }
  __pyx_t_8 = PyNumber_Multiply(__pyx_v_d, __pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = PyNumber_Add(__pyx_v_y, __pyx_t_8); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4670, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  __pyx_v_yy = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4671
 *     xx = x + ( d * np.cos (b))
 *     yy = y +  (d * np.sin(b))
 *     if not shift:             # <<<<<<<<<<<<<<
 *         xx, *_ = scalePosition(x )
 *         yy, *_ = scalePosition(y)
 */
  __Pyx_TraceLine(4671,0,__PYX_ERR(0, 4671, __pyx_L1_error))
  __pyx_t_11 = __Pyx_PyObject_IsTrue(__pyx_v_shift); if (unlikely((__pyx_t_11 < 0))) __PYX_ERR(0, 4671, __pyx_L1_error)
  __pyx_t_3 = (!__pyx_t_11);
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4672
 *     yy = y +  (d * np.sin(b))
 *     if not shift:
 *         xx, *_ = scalePosition(x )             # <<<<<<<<<<<<<<
 *         yy, *_ = scalePosition(y)
 * 
 */
    __Pyx_TraceLine(4672,0,__PYX_ERR(0, 4672, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_scalePosition); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4672, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_x};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4672, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    {
      Py_ssize_t index = -1;
      PyObject** temps[2] = {&__pyx_t_8};
      __pyx_t_4 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4672, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_4);
      for (index=0; index < 1; index++) {
        PyObject* item = __pyx_t_9(__pyx_t_4); if (unlikely(!item)) goto __pyx_L17_unpacking_failed;
        __Pyx_GOTREF(item);
        *(temps[index]) = item;
      }
      goto __pyx_L18_unpacking_done;
      __pyx_L17_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_9 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 4672, __pyx_L1_error)
      __pyx_L18_unpacking_done:;
    }
    __pyx_t_2 = PySequence_List(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4672, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_xx, __pyx_t_8);
    __pyx_t_8 = 0;
    __pyx_v__ = ((PyObject*)__pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":4673
 *     if not shift:
 *         xx, *_ = scalePosition(x )
 *         yy, *_ = scalePosition(y)             # <<<<<<<<<<<<<<
 * 
 *     if view:
 */
    __Pyx_TraceLine(4673,0,__PYX_ERR(0, 4673, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_scalePosition); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_8)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_8);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_v_y};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4673, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    {
      Py_ssize_t index = -1;
      PyObject** temps[2] = {&__pyx_t_2};
      __pyx_t_8 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4673, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_9 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_8);
      for (index=0; index < 1; index++) {
        PyObject* item = __pyx_t_9(__pyx_t_8); if (unlikely(!item)) goto __pyx_L19_unpacking_failed;
        __Pyx_GOTREF(item);
        *(temps[index]) = item;
      }
      goto __pyx_L20_unpacking_done;
      __pyx_L19_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_9 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 4673, __pyx_L1_error)
      __pyx_L20_unpacking_done:;
    }
    __pyx_t_4 = PySequence_List(__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4673, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __Pyx_DECREF_SET(__pyx_v_yy, __pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v__, ((PyObject*)__pyx_t_4));
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4671
 *     xx = x + ( d * np.cos (b))
 *     yy = y +  (d * np.sin(b))
 *     if not shift:             # <<<<<<<<<<<<<<
 *         xx, *_ = scalePosition(x )
 *         yy, *_ = scalePosition(y)
 */
  }

  /* "gofast/tools/mathex.pyx":4675
 *         yy, *_ = scalePosition(y)
 * 
 *     if view:             # <<<<<<<<<<<<<<
 *         state = f"{'scaled' if not shift else 'shifted'}"
 *         plt.plot (x, y , 'ok-', label =f"Un{state} positions")
 */
  __Pyx_TraceLine(4675,0,__PYX_ERR(0, 4675, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_view); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4675, __pyx_L1_error)
  if (__pyx_t_3) {

    /* "gofast/tools/mathex.pyx":4676
 * 
 *     if view:
 *         state = f"{'scaled' if not shift else 'shifted'}"             # <<<<<<<<<<<<<<
 *         plt.plot (x, y , 'ok-', label =f"Un{state} positions")
 *         plt.plot (xx , yy , 'or:', label =f"{state.title()} positions")
 */
    __Pyx_TraceLine(4676,0,__PYX_ERR(0, 4676, __pyx_L1_error))
    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_shift); if (unlikely((__pyx_t_3 < 0))) __PYX_ERR(0, 4676, __pyx_L1_error)
    __pyx_t_11 = (!__pyx_t_3);
    if (__pyx_t_11) {
      __Pyx_INCREF(__pyx_n_u_scaled);
      __pyx_t_1 = __pyx_n_u_scaled;
    } else {
      __Pyx_INCREF(__pyx_n_u_shifted);
      __pyx_t_1 = __pyx_n_u_shifted;
    }
    __pyx_t_4 = __Pyx_PyUnicode_Unicode(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4676, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_state = ((PyObject*)__pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4677
 *     if view:
 *         state = f"{'scaled' if not shift else 'shifted'}"
 *         plt.plot (x, y , 'ok-', label =f"Un{state} positions")             # <<<<<<<<<<<<<<
 *         plt.plot (xx , yy , 'or:', label =f"{state.title()} positions")
 *         plt.xlabel ('x') ; plt.ylabel ('y')
 */
    __Pyx_TraceLine(4677,0,__PYX_ERR(0, 4677, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_plt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_plot); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_x)) __PYX_ERR(0, 4677, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y);
    __Pyx_GIVEREF(__pyx_v_y);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_y)) __PYX_ERR(0, 4677, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_ok);
    __Pyx_GIVEREF(__pyx_kp_u_ok);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u_ok)) __PYX_ERR(0, 4677, __pyx_L1_error);
    __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_8 = PyTuple_New(3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_12 = 0;
    __pyx_t_13 = 127;
    __Pyx_INCREF(__pyx_n_u_Un);
    __pyx_t_12 += 2;
    __Pyx_GIVEREF(__pyx_n_u_Un);
    PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_n_u_Un);
    __Pyx_INCREF(__pyx_v_state);
    __pyx_t_13 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_v_state) > __pyx_t_13) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_v_state) : __pyx_t_13;
    __pyx_t_12 += __Pyx_PyUnicode_GET_LENGTH(__pyx_v_state);
    __Pyx_GIVEREF(__pyx_v_state);
    PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_v_state);
    __Pyx_INCREF(__pyx_kp_u_positions);
    __pyx_t_12 += 10;
    __Pyx_GIVEREF(__pyx_kp_u_positions);
    PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_kp_u_positions);
    __pyx_t_6 = __Pyx_PyUnicode_Join(__pyx_t_8, 3, __pyx_t_12, __pyx_t_13); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_label, __pyx_t_6) < 0) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_4, __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4677, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":4678
 *         state = f"{'scaled' if not shift else 'shifted'}"
 *         plt.plot (x, y , 'ok-', label =f"Un{state} positions")
 *         plt.plot (xx , yy , 'or:', label =f"{state.title()} positions")             # <<<<<<<<<<<<<<
 *         plt.xlabel ('x') ; plt.ylabel ('y')
 *         plt.legend()
 */
    __Pyx_TraceLine(4678,0,__PYX_ERR(0, 4678, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_plt); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_plot); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_v_xx);
    __Pyx_GIVEREF(__pyx_v_xx);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v_xx)) __PYX_ERR(0, 4678, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_yy);
    __Pyx_GIVEREF(__pyx_v_yy);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_yy)) __PYX_ERR(0, 4678, __pyx_L1_error);
    __Pyx_INCREF(__pyx_kp_u_or_2);
    __Pyx_GIVEREF(__pyx_kp_u_or_2);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_kp_u_or_2)) __PYX_ERR(0, 4678, __pyx_L1_error);
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_1 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyUnicode_Type_title, __pyx_v_state); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_1, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyUnicode_ConcatInPlace(__pyx_t_8, __pyx_kp_u_positions); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_label, __pyx_t_1) < 0) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, __pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4678, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4679
 *         plt.plot (x, y , 'ok-', label =f"Un{state} positions")
 *         plt.plot (xx , yy , 'or:', label =f"{state.title()} positions")
 *         plt.xlabel ('x') ; plt.ylabel ('y')             # <<<<<<<<<<<<<<
 *         plt.legend()
 *         plt.show ()
 */
    __Pyx_TraceLine(4679,0,__PYX_ERR(0, 4679, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_plt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4679, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_xlabel); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4679, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_n_u_x};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4679, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_plt); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4679, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_ylabel); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4679, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_n_u_y};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 1+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4679, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4680
 *         plt.plot (xx , yy , 'or:', label =f"{state.title()} positions")
 *         plt.xlabel ('x') ; plt.ylabel ('y')
 *         plt.legend()             # <<<<<<<<<<<<<<
 *         plt.show ()
 * 
 */
    __Pyx_TraceLine(4680,0,__PYX_ERR(0, 4680, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_plt); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4680, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_legend); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4680, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_6))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_6);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_6, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4680, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4681
 *         plt.xlabel ('x') ; plt.ylabel ('y')
 *         plt.legend()
 *         plt.show ()             # <<<<<<<<<<<<<<
 * 
 *     return xx, yy
 */
    __Pyx_TraceLine(4681,0,__PYX_ERR(0, 4681, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_plt); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4681, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_show); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4681, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_7 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_4))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_4, function);
        __pyx_t_7 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_7, 0+__pyx_t_7);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4681, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4675
 *         yy, *_ = scalePosition(y)
 * 
 *     if view:             # <<<<<<<<<<<<<<
 *         state = f"{'scaled' if not shift else 'shifted'}"
 *         plt.plot (x, y , 'ok-', label =f"Un{state} positions")
 */
  }

  /* "gofast/tools/mathex.pyx":4683
 *         plt.show ()
 * 
 *     return xx, yy             # <<<<<<<<<<<<<<
 * 
 * def _assert_x_y_positions (x, y , islatlon = False, is_utm=True,  **kws):
 */
  __Pyx_TraceLine(4683,0,__PYX_ERR(0, 4683, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_xx);
  __Pyx_GIVEREF(__pyx_v_xx);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_xx)) __PYX_ERR(0, 4683, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_yy);
  __Pyx_GIVEREF(__pyx_v_yy);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_yy)) __PYX_ERR(0, 4683, __pyx_L1_error);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4567
 *     return d.mean()  if return_mean_dist else d
 * 
 * def scale_positions (             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_AddTraceback("gofast.tools.mathex.scale_positions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_Location);
  __Pyx_XDECREF(__pyx_v_msg);
  __Pyx_XDECREF(__pyx_v_xs);
  __Pyx_XDECREF(__pyx_v_ys);
  __Pyx_XDECREF(__pyx_v_d);
  __Pyx_XDECREF(__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_xx);
  __Pyx_XDECREF(__pyx_v_yy);
  __Pyx_XDECREF(__pyx_v__);
  __Pyx_XDECREF(__pyx_v_state);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XDECREF(__pyx_v_use_average_dist);
  __Pyx_XDECREF(__pyx_v_utm_zone);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4685
 *     return xx, yy
 * 
 * def _assert_x_y_positions (x, y , islatlon = False, is_utm=True,  **kws):             # <<<<<<<<<<<<<<
 *     """ Assert the position x and y and return array of x and y  """
 *     from ..site import Location
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_119_assert_x_y_positions(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_118_assert_x_y_positions, " Assert the position x and y and return array of x and y  ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_119_assert_x_y_positions = {"_assert_x_y_positions", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_119_assert_x_y_positions, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_118_assert_x_y_positions};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_119_assert_x_y_positions(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_islatlon = 0;
  CYTHON_UNUSED PyObject *__pyx_v_is_utm = 0;
  PyObject *__pyx_v_kws = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[4] = {0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_assert_x_y_positions (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  __pyx_v_kws = PyDict_New(); if (unlikely(!__pyx_v_kws)) return NULL;
  __Pyx_GOTREF(__pyx_v_kws);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_y,&__pyx_n_s_islatlon,&__pyx_n_s_is_utm,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4685, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4685, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_assert_x_y_positions", 0, 2, 4, 1); __PYX_ERR(0, 4685, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_islatlon);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4685, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_is_utm);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4685, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, __pyx_v_kws, values + 0, kwd_pos_args, "_assert_x_y_positions") < 0)) __PYX_ERR(0, 4685, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_x = values[0];
    __pyx_v_y = values[1];
    __pyx_v_islatlon = values[2];
    __pyx_v_is_utm = values[3];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_assert_x_y_positions", 0, 2, 4, __pyx_nargs); __PYX_ERR(0, 4685, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_DECREF(__pyx_v_kws); __pyx_v_kws = 0;
  __Pyx_AddTraceback("gofast.tools.mathex._assert_x_y_positions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_118_assert_x_y_positions(__pyx_self, __pyx_v_x, __pyx_v_y, __pyx_v_islatlon, __pyx_v_is_utm, __pyx_v_kws);

  /* function exit code */
  __Pyx_DECREF(__pyx_v_kws);
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_118_assert_x_y_positions(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y, PyObject *__pyx_v_islatlon, CYTHON_UNUSED PyObject *__pyx_v_is_utm, PyObject *__pyx_v_kws) {
  PyObject *__pyx_v_Location = NULL;
  PyObject *__pyx_v_ii = NULL;
  PyObject *__pyx_v_ar = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  int __pyx_t_8;
  int __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  Py_UCS4 __pyx_t_11;
  PyObject *(*__pyx_t_12)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__137)
  __Pyx_RefNannySetupContext("_assert_x_y_positions", 0);
  __Pyx_TraceCall("_assert_x_y_positions", __pyx_f[0], 4685, 0, __PYX_ERR(0, 4685, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_INCREF(__pyx_v_y);

  /* "gofast/tools/mathex.pyx":4687
 * def _assert_x_y_positions (x, y , islatlon = False, is_utm=True,  **kws):
 *     """ Assert the position x and y and return array of x and y  """
 *     from ..site import Location             # <<<<<<<<<<<<<<
 *     x = np.array(x, dtype = np.float64)
 *     y = np.array(y, np.float64)
 */
  __Pyx_TraceLine(4687,0,__PYX_ERR(0, 4687, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_Location);
  __Pyx_GIVEREF(__pyx_n_s_Location);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_Location)) __PYX_ERR(0, 4687, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_site, __pyx_t_1, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Location); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4687, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_Location = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4688
 *     """ Assert the position x and y and return array of x and y  """
 *     from ..site import Location
 *     x = np.array(x, dtype = np.float64)             # <<<<<<<<<<<<<<
 *     y = np.array(y, np.float64)
 *     for ii, ar in enumerate ([x, y]):
 */
  __Pyx_TraceLine(4688,0,__PYX_ERR(0, 4688, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_x)) __PYX_ERR(0, 4688, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_5) < 0) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4688, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":4689
 *     from ..site import Location
 *     x = np.array(x, dtype = np.float64)
 *     y = np.array(y, np.float64)             # <<<<<<<<<<<<<<
 *     for ii, ar in enumerate ([x, y]):
 *         if not _is_arraylike_1d(ar):
 */
  __Pyx_TraceLine(4689,0,__PYX_ERR(0, 4689, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_float64); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4689, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_v_y, __pyx_t_1};
    __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4689, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_5);
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":4690
 *     x = np.array(x, dtype = np.float64)
 *     y = np.array(y, np.float64)
 *     for ii, ar in enumerate ([x, y]):             # <<<<<<<<<<<<<<
 *         if not _is_arraylike_1d(ar):
 *             raise TypeError (
 */
  __Pyx_TraceLine(4690,0,__PYX_ERR(0, 4690, __pyx_L1_error))
  __Pyx_INCREF(__pyx_int_0);
  __pyx_t_5 = __pyx_int_0;
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4690, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_v_x)) __PYX_ERR(0, 4690, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_GIVEREF(__pyx_v_y);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_v_y)) __PYX_ERR(0, 4690, __pyx_L1_error);
  __pyx_t_1 = __pyx_t_2; __Pyx_INCREF(__pyx_t_1);
  __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (__pyx_t_7 >= 2) break;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_2 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_7); __Pyx_INCREF(__pyx_t_2); __pyx_t_7++; if (unlikely((0 < 0))) __PYX_ERR(0, 4690, __pyx_L1_error)
    #else
    __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_7); __pyx_t_7++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4690, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    #endif
    __Pyx_XDECREF_SET(__pyx_v_ar, __pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_INCREF(__pyx_t_5);
    __Pyx_XDECREF_SET(__pyx_v_ii, __pyx_t_5);
    __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_5, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4690, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_5);
    __pyx_t_5 = __pyx_t_2;
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":4691
 *     y = np.array(y, np.float64)
 *     for ii, ar in enumerate ([x, y]):
 *         if not _is_arraylike_1d(ar):             # <<<<<<<<<<<<<<
 *             raise TypeError (
 *                 f"Expect one-dimensional array for {'x' if ii==0 else 'y'!r}."
 */
    __Pyx_TraceLine(4691,0,__PYX_ERR(0, 4691, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_is_arraylike_1d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4691, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_4 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_4)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_4);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_ar};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4691, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_8 < 0))) __PYX_ERR(0, 4691, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_9 = (!__pyx_t_8);
    if (unlikely(__pyx_t_9)) {

      /* "gofast/tools/mathex.pyx":4693
 *         if not _is_arraylike_1d(ar):
 *             raise TypeError (
 *                 f"Expect one-dimensional array for {'x' if ii==0 else 'y'!r}."             # <<<<<<<<<<<<<<
 *                 " Got {x.ndim}d.")
 *         if len(ar) <= 1:
 */
      __Pyx_TraceLine(4693,0,__PYX_ERR(0, 4693, __pyx_L1_error))
      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4693, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = 0;
      __pyx_t_11 = 127;
      __Pyx_INCREF(__pyx_kp_u_Expect_one_dimensional_array_for);
      __pyx_t_10 += 33;
      __Pyx_GIVEREF(__pyx_kp_u_Expect_one_dimensional_array_for);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_Expect_one_dimensional_array_for);
      __pyx_t_9 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_ii, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4693, __pyx_L1_error)
      if (__pyx_t_9) {
        __Pyx_INCREF(__pyx_n_u_x);
        __pyx_t_3 = __pyx_n_u_x;
      } else {
        __Pyx_INCREF(__pyx_n_u_y);
        __pyx_t_3 = __pyx_n_u_y;
      }
      __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_3), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4693, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_11 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_11) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_11;
      __pyx_t_10 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
      __Pyx_GIVEREF(__pyx_t_4);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_4);
      __pyx_t_4 = 0;
      __Pyx_INCREF(__pyx_kp_u_Got_x_ndim_d);
      __pyx_t_10 += 16;
      __Pyx_GIVEREF(__pyx_kp_u_Got_x_ndim_d);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_Got_x_ndim_d);
      __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_2, 3, __pyx_t_10, __pyx_t_11); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4693, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

      /* "gofast/tools/mathex.pyx":4692
 *     for ii, ar in enumerate ([x, y]):
 *         if not _is_arraylike_1d(ar):
 *             raise TypeError (             # <<<<<<<<<<<<<<
 *                 f"Expect one-dimensional array for {'x' if ii==0 else 'y'!r}."
 *                 " Got {x.ndim}d.")
 */
      __Pyx_TraceLine(4692,0,__PYX_ERR(0, 4692, __pyx_L1_error))
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4692, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_ERR(0, 4692, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":4691
 *     y = np.array(y, np.float64)
 *     for ii, ar in enumerate ([x, y]):
 *         if not _is_arraylike_1d(ar):             # <<<<<<<<<<<<<<
 *             raise TypeError (
 *                 f"Expect one-dimensional array for {'x' if ii==0 else 'y'!r}."
 */
    }

    /* "gofast/tools/mathex.pyx":4695
 *                 f"Expect one-dimensional array for {'x' if ii==0 else 'y'!r}."
 *                 " Got {x.ndim}d.")
 *         if len(ar) <= 1:             # <<<<<<<<<<<<<<
 *             raise ValueError (f"A singleton array {'x' if ii==0 else 'y'!r} is"
 *                               " not admitted. Expect at least two points"
 */
    __Pyx_TraceLine(4695,0,__PYX_ERR(0, 4695, __pyx_L1_error))
    __pyx_t_10 = PyObject_Length(__pyx_v_ar); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4695, __pyx_L1_error)
    __pyx_t_9 = (__pyx_t_10 <= 1);
    if (unlikely(__pyx_t_9)) {

      /* "gofast/tools/mathex.pyx":4696
 *                 " Got {x.ndim}d.")
 *         if len(ar) <= 1:
 *             raise ValueError (f"A singleton array {'x' if ii==0 else 'y'!r} is"             # <<<<<<<<<<<<<<
 *                               " not admitted. Expect at least two points"
 *                               " A(x1, y1) and B(x2, y2)")
 */
      __Pyx_TraceLine(4696,0,__PYX_ERR(0, 4696, __pyx_L1_error))
      __pyx_t_2 = PyTuple_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4696, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_10 = 0;
      __pyx_t_11 = 127;
      __Pyx_INCREF(__pyx_kp_u_A_singleton_array);
      __pyx_t_10 += 18;
      __Pyx_GIVEREF(__pyx_kp_u_A_singleton_array);
      PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_kp_u_A_singleton_array);
      __pyx_t_9 = (__Pyx_PyInt_BoolEqObjC(__pyx_v_ii, __pyx_int_0, 0, 0)); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4696, __pyx_L1_error)
      if (__pyx_t_9) {
        __Pyx_INCREF(__pyx_n_u_x);
        __pyx_t_4 = __pyx_n_u_x;
      } else {
        __Pyx_INCREF(__pyx_n_u_y);
        __pyx_t_4 = __pyx_n_u_y;
      }
      __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_4), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4696, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_11 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) > __pyx_t_11) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) : __pyx_t_11;
      __pyx_t_10 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_3);
      __Pyx_GIVEREF(__pyx_t_3);
      PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_t_3);
      __pyx_t_3 = 0;
      __Pyx_INCREF(__pyx_kp_u_is_not_admitted_Expect_at_least);
      __pyx_t_10 += 68;
      __Pyx_GIVEREF(__pyx_kp_u_is_not_admitted_Expect_at_least);
      PyTuple_SET_ITEM(__pyx_t_2, 2, __pyx_kp_u_is_not_admitted_Expect_at_least);
      __pyx_t_3 = __Pyx_PyUnicode_Join(__pyx_t_2, 3, __pyx_t_10, __pyx_t_11); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4696, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4696, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_ERR(0, 4696, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":4695
 *                 f"Expect one-dimensional array for {'x' if ii==0 else 'y'!r}."
 *                 " Got {x.ndim}d.")
 *         if len(ar) <= 1:             # <<<<<<<<<<<<<<
 *             raise ValueError (f"A singleton array {'x' if ii==0 else 'y'!r} is"
 *                               " not admitted. Expect at least two points"
 */
    }

    /* "gofast/tools/mathex.pyx":4690
 *     x = np.array(x, dtype = np.float64)
 *     y = np.array(y, np.float64)
 *     for ii, ar in enumerate ([x, y]):             # <<<<<<<<<<<<<<
 *         if not _is_arraylike_1d(ar):
 *             raise TypeError (
 */
    __Pyx_TraceLine(4690,0,__PYX_ERR(0, 4690, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":4699
 *                               " not admitted. Expect at least two points"
 *                               " A(x1, y1) and B(x2, y2)")
 *     if islatlon:             # <<<<<<<<<<<<<<
 *         x , y = Location.to_utm_in(x, y, **kws)
 *     return x, y
 */
  __Pyx_TraceLine(4699,0,__PYX_ERR(0, 4699, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_islatlon); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4699, __pyx_L1_error)
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4700
 *                               " A(x1, y1) and B(x2, y2)")
 *     if islatlon:
 *         x , y = Location.to_utm_in(x, y, **kws)             # <<<<<<<<<<<<<<
 *     return x, y
 * 
 */
    __Pyx_TraceLine(4700,0,__PYX_ERR(0, 4700, __pyx_L1_error))
    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_Location, __pyx_n_s_to_utm_in); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4700, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4700, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_x)) __PYX_ERR(0, 4700, __pyx_L1_error);
    __Pyx_INCREF(__pyx_v_y);
    __Pyx_GIVEREF(__pyx_v_y);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_y)) __PYX_ERR(0, 4700, __pyx_L1_error);
    __pyx_t_2 = PyDict_Copy(__pyx_v_kws); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4700, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_1, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4700, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if ((likely(PyTuple_CheckExact(__pyx_t_3))) || (PyList_CheckExact(__pyx_t_3))) {
      PyObject* sequence = __pyx_t_3;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 4700, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_2 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_2 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_1 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      #else
      __pyx_t_2 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4700, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __pyx_t_1 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4700, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      #endif
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_5 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4700, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_12 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_5);
      index = 0; __pyx_t_2 = __pyx_t_12(__pyx_t_5); if (unlikely(!__pyx_t_2)) goto __pyx_L9_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_2);
      index = 1; __pyx_t_1 = __pyx_t_12(__pyx_t_5); if (unlikely(!__pyx_t_1)) goto __pyx_L9_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_12(__pyx_t_5), 2) < 0) __PYX_ERR(0, 4700, __pyx_L1_error)
      __pyx_t_12 = NULL;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      goto __pyx_L10_unpacking_done;
      __pyx_L9_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_12 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 4700, __pyx_L1_error)
      __pyx_L10_unpacking_done:;
    }
    __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_2);
    __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_y, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4699
 *                               " not admitted. Expect at least two points"
 *                               " A(x1, y1) and B(x2, y2)")
 *     if islatlon:             # <<<<<<<<<<<<<<
 *         x , y = Location.to_utm_in(x, y, **kws)
 *     return x, y
 */
  }

  /* "gofast/tools/mathex.pyx":4701
 *     if islatlon:
 *         x , y = Location.to_utm_in(x, y, **kws)
 *     return x, y             # <<<<<<<<<<<<<<
 * 
 * def get_bearing (latlon1, latlon2,  to_deg = True ):
 */
  __Pyx_TraceLine(4701,0,__PYX_ERR(0, 4701, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4701, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_x)) __PYX_ERR(0, 4701, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_y);
  __Pyx_GIVEREF(__pyx_v_y);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_v_y)) __PYX_ERR(0, 4701, __pyx_L1_error);
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4685
 *     return xx, yy
 * 
 * def _assert_x_y_positions (x, y , islatlon = False, is_utm=True,  **kws):             # <<<<<<<<<<<<<<
 *     """ Assert the position x and y and return array of x and y  """
 *     from ..site import Location
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex._assert_x_y_positions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_Location);
  __Pyx_XDECREF(__pyx_v_ii);
  __Pyx_XDECREF(__pyx_v_ar);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_XDECREF(__pyx_v_y);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4703
 *     return x, y
 * 
 * def get_bearing (latlon1, latlon2,  to_deg = True ):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the bearing between two points.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_121get_bearing(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_120get_bearing, "\n    Calculate the bearing between two points. \n     \n    A bearing can be defined as  a direction of one point relative \n    to another point, usually given as an angle measured clockwise \n    from north.\n    The formula of the bearing :math:`\010eta` between two points 1(lat1 , lon1)\n    and 2(lat2, lon2) is expressed as below: \n        \n    .. math:: \n        \010eta = atan2(sin(y_2-y_1)*cos(x_2), cos(x_1)*sin(x_2) \342\200\223                       sin(x_1)*cos(x_2)*cos(y_2-y_1))\n     \n    where: \n       \n       - :math:`x_1`(lat1): the latitude of the first coordinate\n       - :math:`y_1`(lon1): the longitude of the first coordinate\n       - :math:`x_2`(lat2) : the latitude of the second coordinate\n       - :math:`y_2`(lon2): the longitude of the second coordinate\n    \n    Parameters \n    ----------- \n    latlon: Tuple ( latitude, longitude) \n       A latitude and longitude coordinates of the first point in degree. \n    latlon2: Tuple ( latitude, longitude) \n       A latitude and longitude of coordinates of the second point in degree.  \n       \n    to_deg: bool, default=True \n       Convert the bearing from radians to degree. \n      \n    Returns \n    ---------\n    b: Value of bearing in degree ( default). \n    \n    See More \n    ----------\n    See more details by clicking in the link below: \n        https://mapscaping.com/how-to-calculate-bearing-between-two-coordinates/\n        \n    Examples \n    ---------\n    >>> from gofast.tools import get_bearing \n    >>> latlon1 = (28.41196763902007, 109.3328724432221) # (lat, lon) point 1\n    >>> latlon2= (28.38756530909265, 109.36931920880758) # (lat, lon) point 2\n    >>> get_bearing (latlon1, latlon2 )\n    127.26739270447973 # in degree \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_121get_bearing = {"get_bearing", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_121get_bearing, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_120get_bearing};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_121get_bearing(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_latlon1 = 0;
  PyObject *__pyx_v_latlon2 = 0;
  PyObject *__pyx_v_to_deg = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("get_bearing (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_latlon1,&__pyx_n_s_latlon2,&__pyx_n_s_to_deg,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_True)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_latlon1)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4703, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_latlon2)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4703, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("get_bearing", 0, 2, 3, 1); __PYX_ERR(0, 4703, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_to_deg);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4703, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "get_bearing") < 0)) __PYX_ERR(0, 4703, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_latlon1 = values[0];
    __pyx_v_latlon2 = values[1];
    __pyx_v_to_deg = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("get_bearing", 0, 2, 3, __pyx_nargs); __PYX_ERR(0, 4703, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.get_bearing", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_120get_bearing(__pyx_self, __pyx_v_latlon1, __pyx_v_latlon2, __pyx_v_to_deg);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_120get_bearing(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_latlon1, PyObject *__pyx_v_latlon2, PyObject *__pyx_v_to_deg) {
  PyObject *__pyx_v_lat1 = NULL;
  PyObject *__pyx_v_lon1 = NULL;
  PyObject *__pyx_v_lat2 = NULL;
  PyObject *__pyx_v_lon2 = NULL;
  PyObject *__pyx_v_b = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  int __pyx_t_8;
  int __pyx_t_9;
  Py_ssize_t __pyx_t_10;
  int __pyx_t_11;
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__138)
  __Pyx_RefNannySetupContext("get_bearing", 0);
  __Pyx_TraceCall("get_bearing", __pyx_f[0], 4703, 0, __PYX_ERR(0, 4703, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_latlon1);
  __Pyx_INCREF(__pyx_v_latlon2);

  /* "gofast/tools/mathex.pyx":4751
 *     127.26739270447973 # in degree
 *     """
 *     latlon1 = reshape ( np.array ( latlon1, dtype = np.float64))             # <<<<<<<<<<<<<<
 *     latlon2 = reshape ( np.array ( latlon2, dtype = np.float64))
 * 
 */
  __Pyx_TraceLine(4751,0,__PYX_ERR(0, 4751, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_latlon1);
  __Pyx_GIVEREF(__pyx_v_latlon1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_latlon1)) __PYX_ERR(0, 4751, __pyx_L1_error);
  __pyx_t_5 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_float64); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (PyDict_SetItem(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_7) < 0) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4751, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_7};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4751, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_latlon1, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4752
 *     """
 *     latlon1 = reshape ( np.array ( latlon1, dtype = np.float64))
 *     latlon2 = reshape ( np.array ( latlon2, dtype = np.float64))             # <<<<<<<<<<<<<<
 * 
 *     if len(latlon1) <2 or len(latlon2) <2 :
 */
  __Pyx_TraceLine(4752,0,__PYX_ERR(0, 4752, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_reshape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_array_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = PyTuple_New(1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_INCREF(__pyx_v_latlon2);
  __Pyx_GIVEREF(__pyx_v_latlon2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_v_latlon2)) __PYX_ERR(0, 4752, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_6) < 0) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4752, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4752, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_latlon2, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4754
 *     latlon2 = reshape ( np.array ( latlon2, dtype = np.float64))
 * 
 *     if len(latlon1) <2 or len(latlon2) <2 :             # <<<<<<<<<<<<<<
 *         raise ValueError("Wrong coordinates values. Need two coordinates"
 *                          " (latitude and longitude) of points 1 and 2.")
 */
  __Pyx_TraceLine(4754,0,__PYX_ERR(0, 4754, __pyx_L1_error))
  __pyx_t_10 = PyObject_Length(__pyx_v_latlon1); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4754, __pyx_L1_error)
  __pyx_t_11 = (__pyx_t_10 < 2);
  if (!__pyx_t_11) {
  } else {
    __pyx_t_9 = __pyx_t_11;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_10 = PyObject_Length(__pyx_v_latlon2); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4754, __pyx_L1_error)
  __pyx_t_11 = (__pyx_t_10 < 2);
  __pyx_t_9 = __pyx_t_11;
  __pyx_L4_bool_binop_done:;
  if (unlikely(__pyx_t_9)) {

    /* "gofast/tools/mathex.pyx":4755
 * 
 *     if len(latlon1) <2 or len(latlon2) <2 :
 *         raise ValueError("Wrong coordinates values. Need two coordinates"             # <<<<<<<<<<<<<<
 *                          " (latitude and longitude) of points 1 and 2.")
 *     lat1 = np.deg2rad (latlon1[0]) ; lon1 = np.deg2rad(latlon1[1])
 */
    __Pyx_TraceLine(4755,0,__PYX_ERR(0, 4755, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__139, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4755, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __PYX_ERR(0, 4755, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":4754
 *     latlon2 = reshape ( np.array ( latlon2, dtype = np.float64))
 * 
 *     if len(latlon1) <2 or len(latlon2) <2 :             # <<<<<<<<<<<<<<
 *         raise ValueError("Wrong coordinates values. Need two coordinates"
 *                          " (latitude and longitude) of points 1 and 2.")
 */
  }

  /* "gofast/tools/mathex.pyx":4757
 *         raise ValueError("Wrong coordinates values. Need two coordinates"
 *                          " (latitude and longitude) of points 1 and 2.")
 *     lat1 = np.deg2rad (latlon1[0]) ; lon1 = np.deg2rad(latlon1[1])             # <<<<<<<<<<<<<<
 *     lat2 = np.deg2rad (latlon2[0]) ; lon2 = np.deg2rad(latlon2[1])
 * 
 */
  __Pyx_TraceLine(4757,0,__PYX_ERR(0, 4757, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_deg2rad); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_latlon1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4757, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_v_lat1 = __pyx_t_1;
  __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_deg2rad); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_latlon1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4757, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4757, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_lon1 = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4758
 *                          " (latitude and longitude) of points 1 and 2.")
 *     lat1 = np.deg2rad (latlon1[0]) ; lon1 = np.deg2rad(latlon1[1])
 *     lat2 = np.deg2rad (latlon2[0]) ; lon2 = np.deg2rad(latlon2[1])             # <<<<<<<<<<<<<<
 * 
 *     b = np.arctan2 (
 */
  __Pyx_TraceLine(4758,0,__PYX_ERR(0, 4758, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_deg2rad); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_GetItemInt(__pyx_v_latlon2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4758, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_v_lat2 = __pyx_t_1;
  __pyx_t_1 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_deg2rad); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = __Pyx_GetItemInt(__pyx_v_latlon2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4758, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_6};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4758, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_v_lon2 = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4760
 *     lat2 = np.deg2rad (latlon2[0]) ; lon2 = np.deg2rad(latlon2[1])
 * 
 *     b = np.arctan2 (             # <<<<<<<<<<<<<<
 *         np.sin(lon2 - lon1 )* np.cos (lat2),
 *         np.cos (lat1) * np.sin(lat2) - np.sin (lat1) * np.cos (lat2) * np.cos (lon2 - lon1)
 */
  __Pyx_TraceLine(4760,0,__PYX_ERR(0, 4760, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_arctan2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4760, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4761
 * 
 *     b = np.arctan2 (
 *         np.sin(lon2 - lon1 )* np.cos (lat2),             # <<<<<<<<<<<<<<
 *         np.cos (lat1) * np.sin(lat2) - np.sin (lat1) * np.cos (lat2) * np.cos (lon2 - lon1)
 *                     )
 */
  __Pyx_TraceLine(4761,0,__PYX_ERR(0, 4761, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_sin); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Subtract(__pyx_v_lon2, __pyx_v_lon1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_3};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4761, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cos); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_lat2};
    __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4761, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  __pyx_t_5 = PyNumber_Multiply(__pyx_t_2, __pyx_t_7); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4761, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;

  /* "gofast/tools/mathex.pyx":4762
 *     b = np.arctan2 (
 *         np.sin(lon2 - lon1 )* np.cos (lat2),
 *         np.cos (lat1) * np.sin(lat2) - np.sin (lat1) * np.cos (lat2) * np.cos (lon2 - lon1)             # <<<<<<<<<<<<<<
 *                     )
 *     if to_deg:
 */
  __Pyx_TraceLine(4762,0,__PYX_ERR(0, 4762, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_cos); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_lat1};
    __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_sin); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_lat2};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_t_4 = PyNumber_Multiply(__pyx_t_7, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_sin); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_v_lat1};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_cos); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_12))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_12);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_12, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_v_lat2};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_12, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  }
  __pyx_t_12 = PyNumber_Multiply(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_12);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_cos); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyNumber_Subtract(__pyx_v_lon2, __pyx_v_lon1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_13 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_13)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_13);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_13, __pyx_t_3};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4762, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_t_7 = PyNumber_Multiply(__pyx_t_12, __pyx_t_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Subtract(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4762, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_8 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[3] = {__pyx_t_7, __pyx_t_5, __pyx_t_2};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_8, 2+__pyx_t_8);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4760, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_v_b = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4764
 *         np.cos (lat1) * np.sin(lat2) - np.sin (lat1) * np.cos (lat2) * np.cos (lon2 - lon1)
 *                     )
 *     if to_deg:             # <<<<<<<<<<<<<<
 *         # convert bearing to degree and make sure it
 *         # is positive between 360 degree
 */
  __Pyx_TraceLine(4764,0,__PYX_ERR(0, 4764, __pyx_L1_error))
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_to_deg); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4764, __pyx_L1_error)
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4767
 *         # convert bearing to degree and make sure it
 *         # is positive between 360 degree
 *         b = ( np.rad2deg ( b) + 360 )% 360             # <<<<<<<<<<<<<<
 * 
 *     return b
 */
    __Pyx_TraceLine(4767,0,__PYX_ERR(0, 4767, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_6, __pyx_n_s_np); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_6, __pyx_n_s_rad2deg); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = NULL;
    __pyx_t_8 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_8 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_v_b};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_8, 1+__pyx_t_8);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4767, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_1, __pyx_int_360, 0x168, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyInt_RemainderObjC(__pyx_t_2, __pyx_int_360, 0x168, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4767, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_b, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4764
 *         np.cos (lat1) * np.sin(lat2) - np.sin (lat1) * np.cos (lat2) * np.cos (lon2 - lon1)
 *                     )
 *     if to_deg:             # <<<<<<<<<<<<<<
 *         # convert bearing to degree and make sure it
 *         # is positive between 360 degree
 */
  }

  /* "gofast/tools/mathex.pyx":4769
 *         b = ( np.rad2deg ( b) + 360 )% 360
 * 
 *     return b             # <<<<<<<<<<<<<<
 * 
 * def find_closest( arr, values ):
 */
  __Pyx_TraceLine(4769,0,__PYX_ERR(0, 4769, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_b);
  __pyx_r = __pyx_v_b;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4703
 *     return x, y
 * 
 * def get_bearing (latlon1, latlon2,  to_deg = True ):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the bearing between two points.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex.get_bearing", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_lat1);
  __Pyx_XDECREF(__pyx_v_lon1);
  __Pyx_XDECREF(__pyx_v_lat2);
  __Pyx_XDECREF(__pyx_v_lon2);
  __Pyx_XDECREF(__pyx_v_b);
  __Pyx_XDECREF(__pyx_v_latlon1);
  __Pyx_XDECREF(__pyx_v_latlon2);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4771
 *     return b
 * 
 * def find_closest( arr, values ):             # <<<<<<<<<<<<<<
 *     """Get the closest value in array  from given values.
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_123find_closest(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_122find_closest, "Get the closest value in array  from given values.\n    \n    Parameters \n    -----------\n    arr : Arraylike  \n       Array to find the values \n       \n    values: float, arraylike \n    \n    Returns\n    --------\n    closest values in float or array containing in the given array.\n    \n    Examples\n    -----------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex  import find_closest\n    >>> find_closest (  [ 2 , 3, 4, 5] , ( 2.6 , 5.6 )  )\n    array([3., 5.])\n    >>> find_closest (  np.array ([[2 , 3], [ 4, 5]]), ( 2.6 , 5.6 ) )\n    array([3., 5.])\n    array([3., 5.])\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_123find_closest = {"find_closest", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_123find_closest, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_122find_closest};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_123find_closest(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_arr = 0;
  PyObject *__pyx_v_values = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("find_closest (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arr,&__pyx_n_s_values,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_arr)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4771, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_values)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4771, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("find_closest", 1, 2, 2, 1); __PYX_ERR(0, 4771, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "find_closest") < 0)) __PYX_ERR(0, 4771, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_arr = values[0];
    __pyx_v_values = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("find_closest", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 4771, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.find_closest", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_122find_closest(__pyx_self, __pyx_v_arr, __pyx_v_values);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_122find_closest(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, PyObject *__pyx_v_values) {
  CYTHON_UNUSED PyObject *__pyx_v_ar = NULL;
  PyObject *__pyx_v_v = NULL;
  PyObject *__pyx_9genexpr13__pyx_v_v = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  PyObject *__pyx_t_7 = NULL;
  PyObject *(*__pyx_t_8)(PyObject *);
  int __pyx_t_9;
  int __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  Py_UCS4 __pyx_t_12;
  int __pyx_t_13;
  PyObject *__pyx_t_14 = NULL;
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__140)
  __Pyx_RefNannySetupContext("find_closest", 0);
  __Pyx_TraceCall("find_closest", __pyx_f[0], 4771, 0, __PYX_ERR(0, 4771, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_INCREF(__pyx_v_values);

  /* "gofast/tools/mathex.pyx":4796
 *     """
 * 
 *     arr = is_iterable(arr, exclude_string=True , transform =True  )             # <<<<<<<<<<<<<<
 *     values = is_iterable(values , exclude_string=True  , transform =True )
 * 
 */
  __Pyx_TraceLine(4796,0,__PYX_ERR(0, 4796, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_is_iterable); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_GIVEREF(__pyx_v_arr);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_arr)) __PYX_ERR(0, 4796, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_exclude_string, Py_True) < 0) __PYX_ERR(0, 4796, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_transform, Py_True) < 0) __PYX_ERR(0, 4796, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4797
 * 
 *     arr = is_iterable(arr, exclude_string=True , transform =True  )
 *     values = is_iterable(values , exclude_string=True  , transform =True )             # <<<<<<<<<<<<<<
 * 
 *     for ar, v in zip ( [ arr, values ], ['array', 'values']):
 */
  __Pyx_TraceLine(4797,0,__PYX_ERR(0, 4797, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_is_iterable); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_values);
  __Pyx_GIVEREF(__pyx_v_values);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_values)) __PYX_ERR(0, 4797, __pyx_L1_error);
  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_exclude_string, Py_True) < 0) __PYX_ERR(0, 4797, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_transform, Py_True) < 0) __PYX_ERR(0, 4797, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4797, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF_SET(__pyx_v_values, __pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4799
 *     values = is_iterable(values , exclude_string=True  , transform =True )
 * 
 *     for ar, v in zip ( [ arr, values ], ['array', 'values']):             # <<<<<<<<<<<<<<
 *         if not _is_numeric_dtype(arr, to_array= True ) :
 *             raise TypeError(f"Non-numerical {v} are not allowed.")
 */
  __Pyx_TraceLine(4799,0,__PYX_ERR(0, 4799, __pyx_L1_error))
  __pyx_t_1 = PyList_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4799, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_GIVEREF(__pyx_v_arr);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_v_arr)) __PYX_ERR(0, 4799, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_values);
  __Pyx_GIVEREF(__pyx_v_values);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 1, __pyx_v_values)) __PYX_ERR(0, 4799, __pyx_L1_error);
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4799, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_u_array_2);
  __Pyx_GIVEREF(__pyx_n_u_array_2);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_u_array_2)) __PYX_ERR(0, 4799, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_values);
  __Pyx_GIVEREF(__pyx_n_u_values);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_u_values)) __PYX_ERR(0, 4799, __pyx_L1_error);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4799, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_1)) __PYX_ERR(0, 4799, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2)) __PYX_ERR(0, 4799, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_zip, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4799, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4799, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4799, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4799, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 4799, __pyx_L1_error)
        #else
        __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4799, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4799, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_5); __Pyx_INCREF(__pyx_t_2); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 4799, __pyx_L1_error)
        #else
        __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4799, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_6(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 4799, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    if ((likely(PyTuple_CheckExact(__pyx_t_2))) || (PyList_CheckExact(__pyx_t_2))) {
      PyObject* sequence = __pyx_t_2;
      Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
      if (unlikely(size != 2)) {
        if (size > 2) __Pyx_RaiseTooManyValuesError(2);
        else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
        __PYX_ERR(0, 4799, __pyx_L1_error)
      }
      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
      if (likely(PyTuple_CheckExact(sequence))) {
        __pyx_t_1 = PyTuple_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyTuple_GET_ITEM(sequence, 1); 
      } else {
        __pyx_t_1 = PyList_GET_ITEM(sequence, 0); 
        __pyx_t_4 = PyList_GET_ITEM(sequence, 1); 
      }
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(__pyx_t_4);
      #else
      __pyx_t_1 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4799, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_4 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4799, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      #endif
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    } else {
      Py_ssize_t index = -1;
      __pyx_t_7 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4799, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_8 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
      index = 0; __pyx_t_1 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_1)) goto __pyx_L5_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_1);
      index = 1; __pyx_t_4 = __pyx_t_8(__pyx_t_7); if (unlikely(!__pyx_t_4)) goto __pyx_L5_unpacking_failed;
      __Pyx_GOTREF(__pyx_t_4);
      if (__Pyx_IternextUnpackEndCheck(__pyx_t_8(__pyx_t_7), 2) < 0) __PYX_ERR(0, 4799, __pyx_L1_error)
      __pyx_t_8 = NULL;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      goto __pyx_L6_unpacking_done;
      __pyx_L5_unpacking_failed:;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_8 = NULL;
      if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
      __PYX_ERR(0, 4799, __pyx_L1_error)
      __pyx_L6_unpacking_done:;
    }
    __Pyx_XDECREF_SET(__pyx_v_ar, __pyx_t_1);
    __pyx_t_1 = 0;
    __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":4800
 * 
 *     for ar, v in zip ( [ arr, values ], ['array', 'values']):
 *         if not _is_numeric_dtype(arr, to_array= True ) :             # <<<<<<<<<<<<<<
 *             raise TypeError(f"Non-numerical {v} are not allowed.")
 * 
 */
    __Pyx_TraceLine(4800,0,__PYX_ERR(0, 4800, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_is_numeric_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4800, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4800, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_INCREF(__pyx_v_arr);
    __Pyx_GIVEREF(__pyx_v_arr);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_arr)) __PYX_ERR(0, 4800, __pyx_L1_error);
    __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4800, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_to_array, Py_True) < 0) __PYX_ERR(0, 4800, __pyx_L1_error)
    __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_4, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4800, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4800, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_10 = (!__pyx_t_9);
    if (unlikely(__pyx_t_10)) {

      /* "gofast/tools/mathex.pyx":4801
 *     for ar, v in zip ( [ arr, values ], ['array', 'values']):
 *         if not _is_numeric_dtype(arr, to_array= True ) :
 *             raise TypeError(f"Non-numerical {v} are not allowed.")             # <<<<<<<<<<<<<<
 * 
 *     arr = np.array (arr, dtype = np.float64 )
 */
      __Pyx_TraceLine(4801,0,__PYX_ERR(0, 4801, __pyx_L1_error))
      __pyx_t_7 = PyTuple_New(3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4801, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_11 = 0;
      __pyx_t_12 = 127;
      __Pyx_INCREF(__pyx_kp_u_Non_numerical);
      __pyx_t_11 += 14;
      __Pyx_GIVEREF(__pyx_kp_u_Non_numerical);
      PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_kp_u_Non_numerical);
      __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_v_v, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4801, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_12 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_12) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_12;
      __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
      __Pyx_GIVEREF(__pyx_t_1);
      PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_1);
      __pyx_t_1 = 0;
      __Pyx_INCREF(__pyx_kp_u_are_not_allowed);
      __pyx_t_11 += 17;
      __Pyx_GIVEREF(__pyx_kp_u_are_not_allowed);
      PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_kp_u_are_not_allowed);
      __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_7, 3, __pyx_t_11, __pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4801, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4801, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __Pyx_Raise(__pyx_t_7, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __PYX_ERR(0, 4801, __pyx_L1_error)

      /* "gofast/tools/mathex.pyx":4800
 * 
 *     for ar, v in zip ( [ arr, values ], ['array', 'values']):
 *         if not _is_numeric_dtype(arr, to_array= True ) :             # <<<<<<<<<<<<<<
 *             raise TypeError(f"Non-numerical {v} are not allowed.")
 * 
 */
    }

    /* "gofast/tools/mathex.pyx":4799
 *     values = is_iterable(values , exclude_string=True  , transform =True )
 * 
 *     for ar, v in zip ( [ arr, values ], ['array', 'values']):             # <<<<<<<<<<<<<<
 *         if not _is_numeric_dtype(arr, to_array= True ) :
 *             raise TypeError(f"Non-numerical {v} are not allowed.")
 */
    __Pyx_TraceLine(4799,0,__PYX_ERR(0, 4799, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4803
 *             raise TypeError(f"Non-numerical {v} are not allowed.")
 * 
 *     arr = np.array (arr, dtype = np.float64 )             # <<<<<<<<<<<<<<
 *     values = np.array (values, dtype = np.float64 )
 * 
 */
  __Pyx_TraceLine(4803,0,__PYX_ERR(0, 4803, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_GIVEREF(__pyx_v_arr);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_arr)) __PYX_ERR(0, 4803, __pyx_L1_error);
  __pyx_t_1 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_float64); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4803, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_2);
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4804
 * 
 *     arr = np.array (arr, dtype = np.float64 )
 *     values = np.array (values, dtype = np.float64 )             # <<<<<<<<<<<<<<
 * 
 *     # ravel arr if ndim is not one-dimensional
 */
  __Pyx_TraceLine(4804,0,__PYX_ERR(0, 4804, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_array_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_values);
  __Pyx_GIVEREF(__pyx_v_values);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_values)) __PYX_ERR(0, 4804, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_float64); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_4) < 0) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4804, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_values, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4807
 * 
 *     # ravel arr if ndim is not one-dimensional
 *     arr  = arr.ravel() if arr.ndim !=1 else arr             # <<<<<<<<<<<<<<
 *     # Could Find the absolute difference with each value
 *     # Get the index of the smallest absolute difference.
 */
  __Pyx_TraceLine(4807,0,__PYX_ERR(0, 4807, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_ndim); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4807, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_10 = (__Pyx_PyInt_BoolNeObjC(__pyx_t_3, __pyx_int_1, 1, 0)); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 4807, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_10) {
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_ravel); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4807, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = NULL;
    __pyx_t_13 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_1)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_1);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_13 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_1, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_13, 0+__pyx_t_13);
      __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4807, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_4 = __pyx_t_3;
    __pyx_t_3 = 0;
  } else {
    __Pyx_INCREF(__pyx_v_arr);
    __pyx_t_4 = __pyx_v_arr;
  }
  __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4816
 *     #                   ), dtype = np.float64
 *     #     )
 *     return np.array ( [             # <<<<<<<<<<<<<<
 *         arr [ np.abs ( arr - v).argmin()] for v in values ]
 *         )
 */
  __Pyx_TraceLine(4816,0,__PYX_ERR(0, 4816, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4816, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4816, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  { /* enter inner scope */
    __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4816, __pyx_L11_error)
    __Pyx_GOTREF(__pyx_t_3);

    /* "gofast/tools/mathex.pyx":4817
 *     #     )
 *     return np.array ( [
 *         arr [ np.abs ( arr - v).argmin()] for v in values ]             # <<<<<<<<<<<<<<
 *         )
 * 
 */
    __Pyx_TraceLine(4817,0,__PYX_ERR(0, 4817, __pyx_L11_error))
    if (likely(PyList_CheckExact(__pyx_v_values)) || PyTuple_CheckExact(__pyx_v_values)) {
      __pyx_t_1 = __pyx_v_values; __Pyx_INCREF(__pyx_t_1);
      __pyx_t_5 = 0;
      __pyx_t_6 = NULL;
    } else {
      __pyx_t_5 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_values); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4817, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4817, __pyx_L11_error)
    }
    for (;;) {
      if (likely(!__pyx_t_6)) {
        if (likely(PyList_CheckExact(__pyx_t_1))) {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4817, __pyx_L11_error)
            #endif
            if (__pyx_t_5 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_7 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 4817, __pyx_L11_error)
          #else
          __pyx_t_7 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4817, __pyx_L11_error)
          __Pyx_GOTREF(__pyx_t_7);
          #endif
        } else {
          {
            Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
            #if !CYTHON_ASSUME_SAFE_MACROS
            if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4817, __pyx_L11_error)
            #endif
            if (__pyx_t_5 >= __pyx_temp) break;
          }
          #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
          __pyx_t_7 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_7); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 4817, __pyx_L11_error)
          #else
          __pyx_t_7 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4817, __pyx_L11_error)
          __Pyx_GOTREF(__pyx_t_7);
          #endif
        }
      } else {
        __pyx_t_7 = __pyx_t_6(__pyx_t_1);
        if (unlikely(!__pyx_t_7)) {
          PyObject* exc_type = PyErr_Occurred();
          if (exc_type) {
            if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
            else __PYX_ERR(0, 4817, __pyx_L11_error)
          }
          break;
        }
        __Pyx_GOTREF(__pyx_t_7);
      }
      __Pyx_XDECREF_SET(__pyx_9genexpr13__pyx_v_v, __pyx_t_7);
      __pyx_t_7 = 0;
      __Pyx_GetModuleGlobalName(__pyx_t_15, __pyx_n_s_np); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 4817, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_15);
      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_15, __pyx_n_s_abs); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 4817, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_16);
      __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
      __pyx_t_15 = PyNumber_Subtract(__pyx_v_arr, __pyx_9genexpr13__pyx_v_v); if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 4817, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_15);
      __pyx_t_17 = NULL;
      __pyx_t_13 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_16))) {
        __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
        if (likely(__pyx_t_17)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_16);
          __Pyx_INCREF(__pyx_t_17);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_16, function);
          __pyx_t_13 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_t_15};
        __pyx_t_14 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_13, 1+__pyx_t_13);
        __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
        __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
        if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 4817, __pyx_L11_error)
        __Pyx_GOTREF(__pyx_t_14);
        __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
      }
      __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_t_14, __pyx_n_s_argmin); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 4817, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_16);
      __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
      __pyx_t_14 = NULL;
      __pyx_t_13 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_16))) {
        __pyx_t_14 = PyMethod_GET_SELF(__pyx_t_16);
        if (likely(__pyx_t_14)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_16);
          __Pyx_INCREF(__pyx_t_14);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_16, function);
          __pyx_t_13 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_14, NULL};
        __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_13, 0+__pyx_t_13);
        __Pyx_XDECREF(__pyx_t_14); __pyx_t_14 = 0;
        if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4817, __pyx_L11_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
      }
      __pyx_t_16 = __Pyx_PyObject_GetItem(__pyx_v_arr, __pyx_t_7); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 4817, __pyx_L11_error)
      __Pyx_GOTREF(__pyx_t_16);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      if (unlikely(__Pyx_ListComp_Append(__pyx_t_3, (PyObject*)__pyx_t_16))) __PYX_ERR(0, 4816, __pyx_L11_error)
      __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_9genexpr13__pyx_v_v); __pyx_9genexpr13__pyx_v_v = 0;
    goto __pyx_L15_exit_scope;
    __pyx_L11_error:;
    __Pyx_XDECREF(__pyx_9genexpr13__pyx_v_v); __pyx_9genexpr13__pyx_v_v = 0;
    goto __pyx_L1_error;
    __pyx_L15_exit_scope:;
  } /* exit inner scope */
  __pyx_t_1 = NULL;
  __pyx_t_13 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_1 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_1)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_1);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_13 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_1, __pyx_t_3};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_13, 1+__pyx_t_13);
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4816, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __pyx_r = __pyx_t_4;
  __pyx_t_4 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4771
 *     return b
 * 
 * def find_closest( arr, values ):             # <<<<<<<<<<<<<<
 *     """Get the closest value in array  from given values.
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_14);
  __Pyx_XDECREF(__pyx_t_15);
  __Pyx_XDECREF(__pyx_t_16);
  __Pyx_XDECREF(__pyx_t_17);
  __Pyx_AddTraceback("gofast.tools.mathex.find_closest", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ar);
  __Pyx_XDECREF(__pyx_v_v);
  __Pyx_XDECREF(__pyx_9genexpr13__pyx_v_v);
  __Pyx_XDECREF(__pyx_v_arr);
  __Pyx_XDECREF(__pyx_v_values);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4820
 *         )
 * 
 * def gradient_descent(             # <<<<<<<<<<<<<<
 *     z: ArrayLike,
 *     s:ArrayLike,
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_140__defaults__(CYTHON_UNUSED PyObject *__pyx_self) {
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__defaults__", 1);
  __Pyx_TraceCall("__defaults__", __pyx_f[0], 4820, 0, __PYX_ERR(0, 4820, __pyx_L1_error));
  __Pyx_XDECREF(__pyx_r);

  /* "gofast/tools/mathex.pyx":4823
 *     z: ArrayLike,
 *     s:ArrayLike,
 *     alpha:float=.01,             # <<<<<<<<<<<<<<
 *     n_epochs:int= 100,
 *     kind:str="linear",
 */
  __Pyx_TraceLine(4823,0,__PYX_ERR(0, 4823, __pyx_L1_error))
  __pyx_t_1 = PyFloat_FromDouble(((double).01)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4823, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);

  /* "gofast/tools/mathex.pyx":4820
 *         )
 * 
 * def gradient_descent(             # <<<<<<<<<<<<<<
 *     z: ArrayLike,
 *     s:ArrayLike,
 */
  __Pyx_TraceLine(4820,0,__PYX_ERR(0, 4820, __pyx_L1_error))
  __pyx_t_2 = PyTuple_New(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_GIVEREF(__pyx_t_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1)) __PYX_ERR(0, 4820, __pyx_L1_error);
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_n_epochs);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_n_epochs);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 1, __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_n_epochs)) __PYX_ERR(0, 4820, __pyx_L1_error);
  __Pyx_INCREF(((PyObject*)__pyx_n_u_linear));
  __Pyx_GIVEREF(((PyObject*)__pyx_n_u_linear));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 2, ((PyObject*)__pyx_n_u_linear))) __PYX_ERR(0, 4820, __pyx_L1_error);
  __Pyx_INCREF(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_degree);
  __Pyx_GIVEREF(__Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_degree);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 3, __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self)->__pyx_arg_degree)) __PYX_ERR(0, 4820, __pyx_L1_error);
  __Pyx_INCREF(((PyObject *)Py_False));
  __Pyx_GIVEREF(((PyObject *)Py_False));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 4, ((PyObject *)Py_False))) __PYX_ERR(0, 4820, __pyx_L1_error);
  __pyx_t_1 = 0;
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_2)) __PYX_ERR(0, 4820, __pyx_L1_error);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, Py_None)) __PYX_ERR(0, 4820, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_AddTraceback("gofast.tools.mathex.__defaults__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_125gradient_descent(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_124gradient_descent, " Gradient descent algorithm to  fit the best model parameter.\n    \n    Model can be changed to polynomial if degree is greater than 1. \n    \n    Parameters \n    -----------\n    z: arraylike, \n       vertical nodes containing the values of depth V\n    s: Arraylike, \n       vertical vector containin the resistivity values \n    alpha: float,\n       step descent parameter or learning rate. *Default* is ``0.01`\n    n_epochs: int, \n       number of iterations. *Default* is ``100``. Can be changed to other values\n    kind: str, {\"linear\", \"poly\"}, default= 'linear'\n      Type of model to fit. Linear model is selected as the default. \n    degree: int, default=1 \n       As the linear model is selected as the default since the degree is set \n       to ``1``\n    Returns \n    ---------\n    - `_F`: New model values with the best `W` parameters found.\n    - `W`: vector containing the parameters fits \n    - `cost_history`: Containing the error at each Itiretaions. \n        \n    Examples \n    -----------\n    >>> import numpy as np \n    >>> from gofast.tools.mathex  import gradient_descent\n    >>> z= np.array([0, 6, 13, 20, 29 ,39, 49, 59, 69, 89, 109, 129, \n                     149, 179])\n    >>> res= np.array( [1.59268,1.59268,2.64917,3.30592,3.76168,\n                        4.09031,4.33606, 4.53951,4.71819,4.90838,\n          5.01096,5.0536,5.0655,5.06767])\n    >>> fz, weights, cost_history = gradient_descent(\n        z=z, s=res,n_epochs=10,alpha=1e-8,degree=2)\n    >>> import matplotlib.pyplot as plt \n    >>> plt.scatter (z, res)\n    >>> plt.plot(z, fz)\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_125gradient_descent = {"gradient_descent", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_125gradient_descent, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_124gradient_descent};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_125gradient_descent(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_z = 0;
  PyObject *__pyx_v_s = 0;
  double __pyx_v_alpha;
  PyObject *__pyx_v_n_epochs = 0;
  PyObject *__pyx_v_kind = 0;
  PyObject *__pyx_v_degree = 0;
  PyObject *__pyx_v_raise_warn = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[7] = {0,0,0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gradient_descent (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_z,&__pyx_n_s_s,&__pyx_n_s_alpha,&__pyx_n_s_n_epochs,&__pyx_n_s_kind,&__pyx_n_s_degree,&__pyx_n_s_raise_warn,0};
    __pyx_defaults3 *__pyx_dynamic_args = __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_self);
    values[3] = __Pyx_Arg_NewRef_FASTCALL(__pyx_dynamic_args->__pyx_arg_n_epochs);
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)((PyObject*)__pyx_n_u_linear)));
    values[5] = __Pyx_Arg_NewRef_FASTCALL(__pyx_dynamic_args->__pyx_arg_degree);
    values[6] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_z)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_s)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("gradient_descent", 0, 2, 7, 1); __PYX_ERR(0, 4820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_alpha);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_n_epochs);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_kind);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_degree);
          if (value) { values[5] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_raise_warn);
          if (value) { values[6] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4820, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "gradient_descent") < 0)) __PYX_ERR(0, 4820, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  7: values[6] = __Pyx_Arg_FASTCALL(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = __Pyx_Arg_FASTCALL(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_z = values[0];
    __pyx_v_s = values[1];
    if (values[2]) {
      __pyx_v_alpha = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_alpha == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 4823, __pyx_L3_error)
    } else {
      __pyx_v_alpha = ((double)((double).01));
    }
    __pyx_v_n_epochs = ((PyObject*)values[3]);
    __pyx_v_kind = ((PyObject*)values[4]);
    __pyx_v_degree = ((PyObject*)values[5]);
    __pyx_v_raise_warn = values[6];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gradient_descent", 0, 2, 7, __pyx_nargs); __PYX_ERR(0, 4820, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.gradient_descent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_n_epochs), (&PyInt_Type), 0, "n_epochs", 1))) __PYX_ERR(0, 4824, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_kind), (&PyUnicode_Type), 0, "kind", 1))) __PYX_ERR(0, 4825, __pyx_L1_error)
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_degree), (&PyInt_Type), 0, "degree", 1))) __PYX_ERR(0, 4826, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_124gradient_descent(__pyx_self, __pyx_v_z, __pyx_v_s, __pyx_v_alpha, __pyx_v_n_epochs, __pyx_v_kind, __pyx_v_degree, __pyx_v_raise_warn);

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_124gradient_descent(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_z, PyObject *__pyx_v_s, double __pyx_v_alpha, PyObject *__pyx_v_n_epochs, PyObject *__pyx_v_kind, PyObject *__pyx_v_degree, PyObject *__pyx_v_raise_warn) {
  PyObject *__pyx_v_Z = NULL;
  PyObject *__pyx_v_W = NULL;
  PyObject *__pyx_v_cost_history = NULL;
  PyObject *__pyx_v_ii = NULL;
  PyObject *__pyx_v__F = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  int __pyx_t_9;
  int __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  Py_UCS4 __pyx_t_12;
  PyObject *(*__pyx_t_13)(PyObject *);
  PyObject *(*__pyx_t_14)(PyObject *);
  PyObject *__pyx_t_15 = NULL;
  PyObject *__pyx_t_16 = NULL;
  PyObject *__pyx_t_17 = NULL;
  PyObject *__pyx_t_18 = NULL;
  int __pyx_t_19;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__141)
  __Pyx_RefNannySetupContext("gradient_descent", 0);
  __Pyx_TraceCall("gradient_descent", __pyx_f[0], 4820, 0, __PYX_ERR(0, 4820, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_s);
  __Pyx_INCREF(__pyx_v_kind);
  __Pyx_INCREF(__pyx_v_degree);

  /* "gofast/tools/mathex.pyx":4871
 * 
 *     #Assert degree
 *     try :degree= abs(int(degree))             # <<<<<<<<<<<<<<
 *     except:raise TypeError(f"Degree is integer. Got {type(degree).__name__!r}")
 * 
 */
  __Pyx_TraceLine(4871,0,__PYX_ERR(0, 4871, __pyx_L1_error))
  {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
    __Pyx_XGOTREF(__pyx_t_1);
    __Pyx_XGOTREF(__pyx_t_2);
    __Pyx_XGOTREF(__pyx_t_3);
    /*try:*/ {
      __pyx_t_4 = __Pyx_PyNumber_Int(__pyx_v_degree); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4871, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_5 = __Pyx_PyNumber_Absolute(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4871, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_t_5))||((__pyx_t_5) == Py_None) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_t_5))) __PYX_ERR(0, 4871, __pyx_L3_error)
      __Pyx_DECREF_SET(__pyx_v_degree, ((PyObject*)__pyx_t_5));
      __pyx_t_5 = 0;
    }
    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    goto __pyx_L8_try_end;
    __pyx_L3_error:;
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;

    /* "gofast/tools/mathex.pyx":4872
 *     #Assert degree
 *     try :degree= abs(int(degree))
 *     except:raise TypeError(f"Degree is integer. Got {type(degree).__name__!r}")             # <<<<<<<<<<<<<<
 * 
 *     if degree >1 :
 */
    __Pyx_TraceLine(4872,0,__PYX_ERR(0, 4872, __pyx_L5_except_error))
    /*except:*/ {
      __Pyx_AddTraceback("gofast.tools.mathex.gradient_descent", __pyx_clineno, __pyx_lineno, __pyx_filename);
      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_4, &__pyx_t_6) < 0) __PYX_ERR(0, 4872, __pyx_L5_except_error)
      __Pyx_XGOTREF(__pyx_t_5);
      __Pyx_XGOTREF(__pyx_t_4);
      __Pyx_XGOTREF(__pyx_t_6);
      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(((PyObject *)Py_TYPE(__pyx_v_degree)), __pyx_n_s_name); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4872, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_7);
      __pyx_t_8 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_t_7), __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4872, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_7 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Degree_is_integer_Got, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4872, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4872, __pyx_L5_except_error)
      __Pyx_GOTREF(__pyx_t_8);
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __PYX_ERR(0, 4872, __pyx_L5_except_error)
    }

    /* "gofast/tools/mathex.pyx":4871
 * 
 *     #Assert degree
 *     try :degree= abs(int(degree))             # <<<<<<<<<<<<<<
 *     except:raise TypeError(f"Degree is integer. Got {type(degree).__name__!r}")
 * 
 */
    __pyx_L5_except_error:;
    __Pyx_XGIVEREF(__pyx_t_1);
    __Pyx_XGIVEREF(__pyx_t_2);
    __Pyx_XGIVEREF(__pyx_t_3);
    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
    goto __pyx_L1_error;
    __pyx_L8_try_end:;
  }

  /* "gofast/tools/mathex.pyx":4874
 *     except:raise TypeError(f"Degree is integer. Got {type(degree).__name__!r}")
 * 
 *     if degree >1 :             # <<<<<<<<<<<<<<
 *         kind='poly'
 * 
 */
  __Pyx_TraceLine(4874,0,__PYX_ERR(0, 4874, __pyx_L1_error))
  __pyx_t_6 = PyObject_RichCompare(__pyx_v_degree, __pyx_int_1, Py_GT); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4874, __pyx_L1_error)
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4874, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4875
 * 
 *     if degree >1 :
 *         kind='poly'             # <<<<<<<<<<<<<<
 * 
 *     kind = str(kind).lower()
 */
    __Pyx_TraceLine(4875,0,__PYX_ERR(0, 4875, __pyx_L1_error))
    __Pyx_INCREF(__pyx_n_u_poly);
    __Pyx_DECREF_SET(__pyx_v_kind, __pyx_n_u_poly);

    /* "gofast/tools/mathex.pyx":4874
 *     except:raise TypeError(f"Degree is integer. Got {type(degree).__name__!r}")
 * 
 *     if degree >1 :             # <<<<<<<<<<<<<<
 *         kind='poly'
 * 
 */
  }

  /* "gofast/tools/mathex.pyx":4877
 *         kind='poly'
 * 
 *     kind = str(kind).lower()             # <<<<<<<<<<<<<<
 *     if kind.lower() =='linear':
 *         # block degree to one.
 */
  __Pyx_TraceLine(4877,0,__PYX_ERR(0, 4877, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_Str(__pyx_v_kind); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4877, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_lower); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4877, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_10 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_5))) {
    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
      __Pyx_INCREF(__pyx_t_4);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_5, function);
      __pyx_t_10 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
    __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_10, 0+__pyx_t_10);
    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4877, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  }
  if (!(likely(PyUnicode_CheckExact(__pyx_t_6))||((__pyx_t_6) == Py_None) || __Pyx_RaiseUnexpectedTypeError("unicode", __pyx_t_6))) __PYX_ERR(0, 4877, __pyx_L1_error)
  __Pyx_DECREF_SET(__pyx_v_kind, ((PyObject*)__pyx_t_6));
  __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":4878
 * 
 *     kind = str(kind).lower()
 *     if kind.lower() =='linear':             # <<<<<<<<<<<<<<
 *         # block degree to one.
 *         degree = 1
 */
  __Pyx_TraceLine(4878,0,__PYX_ERR(0, 4878, __pyx_L1_error))
  __pyx_t_6 = __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyUnicode_Type_lower, __pyx_v_kind); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4878, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_9 = (__Pyx_PyUnicode_Equals(__pyx_t_6, __pyx_n_u_linear, Py_EQ)); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4878, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4880
 *     if kind.lower() =='linear':
 *         # block degree to one.
 *         degree = 1             # <<<<<<<<<<<<<<
 *     elif kind.find('poly')>=0 :
 *         if degree <=1 :
 */
    __Pyx_TraceLine(4880,0,__PYX_ERR(0, 4880, __pyx_L1_error))
    if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_1)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_1))) __PYX_ERR(0, 4880, __pyx_L1_error)
    __pyx_t_6 = __pyx_int_1;
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_DECREF_SET(__pyx_v_degree, ((PyObject*)__pyx_t_6));
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":4878
 * 
 *     kind = str(kind).lower()
 *     if kind.lower() =='linear':             # <<<<<<<<<<<<<<
 *         # block degree to one.
 *         degree = 1
 */
    goto __pyx_L12;
  }

  /* "gofast/tools/mathex.pyx":4881
 *         # block degree to one.
 *         degree = 1
 *     elif kind.find('poly')>=0 :             # <<<<<<<<<<<<<<
 *         if degree <=1 :
 *             warnings.warn(
 */
  __Pyx_TraceLine(4881,0,__PYX_ERR(0, 4881, __pyx_L1_error))
  if (unlikely(__pyx_v_kind == Py_None)) {
    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "find");
    __PYX_ERR(0, 4881, __pyx_L1_error)
  }
  __pyx_t_11 = PyUnicode_Find(__pyx_v_kind, __pyx_n_u_poly, 0, PY_SSIZE_T_MAX, 1); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-2))) __PYX_ERR(0, 4881, __pyx_L1_error)
  __pyx_t_6 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4881, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_5 = PyObject_RichCompare(__pyx_t_6, __pyx_int_0, Py_GE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4881, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4881, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4882
 *         degree = 1
 *     elif kind.find('poly')>=0 :
 *         if degree <=1 :             # <<<<<<<<<<<<<<
 *             warnings.warn(
 *                 "Polynomial function expects degree greater than 1."
 */
    __Pyx_TraceLine(4882,0,__PYX_ERR(0, 4882, __pyx_L1_error))
    __pyx_t_5 = PyObject_RichCompare(__pyx_v_degree, __pyx_int_1, Py_LE); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4882, __pyx_L1_error)
    __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4882, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (__pyx_t_9) {

      /* "gofast/tools/mathex.pyx":4886
 *                 "Polynomial function expects degree greater than 1."
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."
 *                       ) if raise_warn else None             # <<<<<<<<<<<<<<
 *             degree = 2
 *     # generate function with degree
 */
      __Pyx_TraceLine(4886,0,__PYX_ERR(0, 4886, __pyx_L1_error))
      __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_v_raise_warn); if (unlikely((__pyx_t_9 < 0))) __PYX_ERR(0, 4886, __pyx_L1_error)
      if (__pyx_t_9) {

        /* "gofast/tools/mathex.pyx":4883
 *     elif kind.find('poly')>=0 :
 *         if degree <=1 :
 *             warnings.warn(             # <<<<<<<<<<<<<<
 *                 "Polynomial function expects degree greater than 1."
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."
 */
        __Pyx_TraceLine(4883,0,__PYX_ERR(0, 4883, __pyx_L1_error))
        __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_warnings); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4883, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_warn); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4883, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

        /* "gofast/tools/mathex.pyx":4884
 *         if degree <=1 :
 *             warnings.warn(
 *                 "Polynomial function expects degree greater than 1."             # <<<<<<<<<<<<<<
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."
 *                       ) if raise_warn else None
 */
        __Pyx_TraceLine(4884,0,__PYX_ERR(0, 4884, __pyx_L1_error))
        __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4884, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        __pyx_t_11 = 0;
        __pyx_t_12 = 127;
        __Pyx_INCREF(__pyx_kp_u_Polynomial_function_expects_degr);
        __pyx_t_11 += 55;
        __Pyx_GIVEREF(__pyx_kp_u_Polynomial_function_expects_degr);
        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Polynomial_function_expects_degr);

        /* "gofast/tools/mathex.pyx":4885
 *             warnings.warn(
 *                 "Polynomial function expects degree greater than 1."
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."             # <<<<<<<<<<<<<<
 *                       ) if raise_warn else None
 *             degree = 2
 */
        __Pyx_TraceLine(4885,0,__PYX_ERR(0, 4885, __pyx_L1_error))
        __pyx_t_7 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Repr(__pyx_v_degree), __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4885, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __pyx_t_12 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) > __pyx_t_12) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) : __pyx_t_12;
        __pyx_t_11 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_7);
        __Pyx_GIVEREF(__pyx_t_7);
        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_7);
        __pyx_t_7 = 0;
        __Pyx_INCREF(__pyx_kp_u_Value_is_resetting_to_minimum_e);
        __pyx_t_11 += 40;
        __Pyx_GIVEREF(__pyx_kp_u_Value_is_resetting_to_minimum_e);
        PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u_Value_is_resetting_to_minimum_e);

        /* "gofast/tools/mathex.pyx":4884
 *         if degree <=1 :
 *             warnings.warn(
 *                 "Polynomial function expects degree greater than 1."             # <<<<<<<<<<<<<<
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."
 *                       ) if raise_warn else None
 */
        __Pyx_TraceLine(4884,0,__PYX_ERR(0, 4884, __pyx_L1_error))
        __pyx_t_7 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_11, __pyx_t_12); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4884, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_7);
        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
        __pyx_t_4 = NULL;
        __pyx_t_10 = 0;
        #if CYTHON_UNPACK_METHODS
        if (unlikely(PyMethod_Check(__pyx_t_8))) {
          __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_8);
          if (likely(__pyx_t_4)) {
            PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
            __Pyx_INCREF(__pyx_t_4);
            __Pyx_INCREF(function);
            __Pyx_DECREF_SET(__pyx_t_8, function);
            __pyx_t_10 = 1;
          }
        }
        #endif
        {
          PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_7};
          __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
          if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4883, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_6);
          __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
        }
        __pyx_t_5 = __pyx_t_6;
        __pyx_t_6 = 0;
      } else {

        /* "gofast/tools/mathex.pyx":4886
 *                 "Polynomial function expects degree greater than 1."
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."
 *                       ) if raise_warn else None             # <<<<<<<<<<<<<<
 *             degree = 2
 *     # generate function with degree
 */
        __Pyx_TraceLine(4886,0,__PYX_ERR(0, 4886, __pyx_L1_error))
        __Pyx_INCREF(Py_None);
        __pyx_t_5 = Py_None;
      }
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;

      /* "gofast/tools/mathex.pyx":4887
 *                 f" Got {degree!r}. Value is resetting to minimum equal 2."
 *                       ) if raise_warn else None
 *             degree = 2             # <<<<<<<<<<<<<<
 *     # generate function with degree
 *     Z, W = _kind_of_model(degree=degree,  x=z, y=s)
 */
      __Pyx_TraceLine(4887,0,__PYX_ERR(0, 4887, __pyx_L1_error))
      if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_2)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_2))) __PYX_ERR(0, 4887, __pyx_L1_error)
      __pyx_t_5 = __pyx_int_2;
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_DECREF_SET(__pyx_v_degree, ((PyObject*)__pyx_t_5));
      __pyx_t_5 = 0;

      /* "gofast/tools/mathex.pyx":4882
 *         degree = 1
 *     elif kind.find('poly')>=0 :
 *         if degree <=1 :             # <<<<<<<<<<<<<<
 *             warnings.warn(
 *                 "Polynomial function expects degree greater than 1."
 */
    }

    /* "gofast/tools/mathex.pyx":4881
 *         # block degree to one.
 *         degree = 1
 *     elif kind.find('poly')>=0 :             # <<<<<<<<<<<<<<
 *         if degree <=1 :
 *             warnings.warn(
 */
  }
  __pyx_L12:;

  /* "gofast/tools/mathex.pyx":4889
 *             degree = 2
 *     # generate function with degree
 *     Z, W = _kind_of_model(degree=degree,  x=z, y=s)             # <<<<<<<<<<<<<<
 * 
 *     # Compute the gradient descent
 */
  __Pyx_TraceLine(4889,0,__PYX_ERR(0, 4889, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_kind_of_model); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_degree, __pyx_v_degree) < 0) __PYX_ERR(0, 4889, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_x, __pyx_v_z) < 0) __PYX_ERR(0, 4889, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_6, __pyx_n_s_y, __pyx_v_s) < 0) __PYX_ERR(0, 4889, __pyx_L1_error)
  __pyx_t_8 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_empty_tuple, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  if ((likely(PyTuple_CheckExact(__pyx_t_8))) || (PyList_CheckExact(__pyx_t_8))) {
    PyObject* sequence = __pyx_t_8;
    Py_ssize_t size = __Pyx_PySequence_SIZE(sequence);
    if (unlikely(size != 2)) {
      if (size > 2) __Pyx_RaiseTooManyValuesError(2);
      else if (size >= 0) __Pyx_RaiseNeedMoreValuesError(size);
      __PYX_ERR(0, 4889, __pyx_L1_error)
    }
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    if (likely(PyTuple_CheckExact(sequence))) {
      __pyx_t_6 = PyTuple_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyTuple_GET_ITEM(sequence, 1); 
    } else {
      __pyx_t_6 = PyList_GET_ITEM(sequence, 0); 
      __pyx_t_5 = PyList_GET_ITEM(sequence, 1); 
    }
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_INCREF(__pyx_t_5);
    #else
    __pyx_t_6 = PySequence_ITEM(sequence, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4889, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_5 = PySequence_ITEM(sequence, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4889, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    #endif
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_7 = PyObject_GetIter(__pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4889, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_13 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_7);
    index = 0; __pyx_t_6 = __pyx_t_13(__pyx_t_7); if (unlikely(!__pyx_t_6)) goto __pyx_L14_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_6);
    index = 1; __pyx_t_5 = __pyx_t_13(__pyx_t_7); if (unlikely(!__pyx_t_5)) goto __pyx_L14_unpacking_failed;
    __Pyx_GOTREF(__pyx_t_5);
    if (__Pyx_IternextUnpackEndCheck(__pyx_t_13(__pyx_t_7), 2) < 0) __PYX_ERR(0, 4889, __pyx_L1_error)
    __pyx_t_13 = NULL;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    goto __pyx_L15_unpacking_done;
    __pyx_L14_unpacking_failed:;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_13 = NULL;
    if (__Pyx_IterFinish() == 0) __Pyx_RaiseNeedMoreValuesError(index);
    __PYX_ERR(0, 4889, __pyx_L1_error)
    __pyx_L15_unpacking_done:;
  }
  __pyx_v_Z = __pyx_t_6;
  __pyx_t_6 = 0;
  __pyx_v_W = __pyx_t_5;
  __pyx_t_5 = 0;

  /* "gofast/tools/mathex.pyx":4892
 * 
 *     # Compute the gradient descent
 *     cost_history = np.zeros(n_epochs)             # <<<<<<<<<<<<<<
 *     s=s.reshape((s.shape[0], 1))
 * 
 */
  __Pyx_TraceLine(4892,0,__PYX_ERR(0, 4892, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_np); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_zeros); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4892, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  __pyx_t_10 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_10 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_n_epochs};
    __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4892, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __pyx_v_cost_history = __pyx_t_8;
  __pyx_t_8 = 0;

  /* "gofast/tools/mathex.pyx":4893
 *     # Compute the gradient descent
 *     cost_history = np.zeros(n_epochs)
 *     s=s.reshape((s.shape[0], 1))             # <<<<<<<<<<<<<<
 * 
 *     for ii in range(n_epochs):
 */
  __Pyx_TraceLine(4893,0,__PYX_ERR(0, 4893, __pyx_L1_error))
  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_s, __pyx_n_s_reshape); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_s, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __pyx_t_7 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4893, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_5);
  __Pyx_GIVEREF(__pyx_t_7);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_7)) __PYX_ERR(0, 4893, __pyx_L1_error);
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_int_1)) __PYX_ERR(0, 4893, __pyx_L1_error);
  __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  __pyx_t_10 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_6))) {
    __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
      __Pyx_INCREF(__pyx_t_7);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_6, function);
      __pyx_t_10 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_7, __pyx_t_5};
    __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4893, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_s, __pyx_t_8);
  __pyx_t_8 = 0;

  /* "gofast/tools/mathex.pyx":4895
 *     s=s.reshape((s.shape[0], 1))
 * 
 *     for ii in range(n_epochs):             # <<<<<<<<<<<<<<
 *         with np.errstate(all='ignore'): # rather than divide='warn'
 *             #https://numpy.org/devdocs/reference/generated/numpy.errstate.html
 */
  __Pyx_TraceLine(4895,0,__PYX_ERR(0, 4895, __pyx_L1_error))
  __pyx_t_8 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_v_n_epochs); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4895, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_8);
  if (likely(PyList_CheckExact(__pyx_t_8)) || PyTuple_CheckExact(__pyx_t_8)) {
    __pyx_t_6 = __pyx_t_8; __Pyx_INCREF(__pyx_t_6);
    __pyx_t_11 = 0;
    __pyx_t_14 = NULL;
  } else {
    __pyx_t_11 = -1; __pyx_t_6 = PyObject_GetIter(__pyx_t_8); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4895, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_14 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_6); if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 4895, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
  for (;;) {
    if (likely(!__pyx_t_14)) {
      if (likely(PyList_CheckExact(__pyx_t_6))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_6);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4895, __pyx_L1_error)
          #endif
          if (__pyx_t_11 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = PyList_GET_ITEM(__pyx_t_6, __pyx_t_11); __Pyx_INCREF(__pyx_t_8); __pyx_t_11++; if (unlikely((0 < 0))) __PYX_ERR(0, 4895, __pyx_L1_error)
        #else
        __pyx_t_8 = __Pyx_PySequence_ITEM(__pyx_t_6, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4895, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_6);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4895, __pyx_L1_error)
          #endif
          if (__pyx_t_11 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_8 = PyTuple_GET_ITEM(__pyx_t_6, __pyx_t_11); __Pyx_INCREF(__pyx_t_8); __pyx_t_11++; if (unlikely((0 < 0))) __PYX_ERR(0, 4895, __pyx_L1_error)
        #else
        __pyx_t_8 = __Pyx_PySequence_ITEM(__pyx_t_6, __pyx_t_11); __pyx_t_11++; if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4895, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_8);
        #endif
      }
    } else {
      __pyx_t_8 = __pyx_t_14(__pyx_t_6);
      if (unlikely(!__pyx_t_8)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 4895, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_8);
    }
    if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_t_8))) __PYX_ERR(0, 4895, __pyx_L1_error)
    __Pyx_XDECREF_SET(__pyx_v_ii, ((PyObject*)__pyx_t_8));
    __pyx_t_8 = 0;

    /* "gofast/tools/mathex.pyx":4896
 * 
 *     for ii in range(n_epochs):
 *         with np.errstate(all='ignore'): # rather than divide='warn'             # <<<<<<<<<<<<<<
 *             #https://numpy.org/devdocs/reference/generated/numpy.errstate.html
 *             W= W - (Z._T.dot(Z.dot(W)-s)/ Z.shape[0]) * alpha
 */
    __Pyx_TraceLine(4896,0,__PYX_ERR(0, 4896, __pyx_L1_error))
    /*with:*/ {
      __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_np); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_errstate); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_5);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_8 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      if (PyDict_SetItem(__pyx_t_8, __pyx_n_s_all, __pyx_n_u_ignore) < 0) __PYX_ERR(0, 4896, __pyx_L1_error)
      __pyx_t_7 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_empty_tuple, __pyx_t_8); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_7);
      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_3 = __Pyx_PyObject_LookupSpecial(__pyx_t_7, __pyx_n_s_exit); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4896, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_5 = __Pyx_PyObject_LookupSpecial(__pyx_t_7, __pyx_n_s_enter); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4896, __pyx_L18_error)
      __Pyx_GOTREF(__pyx_t_5);
      __pyx_t_4 = NULL;
      __pyx_t_10 = 0;
      #if CYTHON_UNPACK_METHODS
      if (likely(PyMethod_Check(__pyx_t_5))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_5);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_5, function);
          __pyx_t_10 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, NULL};
        __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_10, 0+__pyx_t_10);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4896, __pyx_L18_error)
        __Pyx_GOTREF(__pyx_t_8);
        __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
      }
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
      /*try:*/ {
        {
          __Pyx_PyThreadState_declare
          __Pyx_PyThreadState_assign
          __Pyx_ExceptionSave(&__pyx_t_2, &__pyx_t_1, &__pyx_t_15);
          __Pyx_XGOTREF(__pyx_t_2);
          __Pyx_XGOTREF(__pyx_t_1);
          __Pyx_XGOTREF(__pyx_t_15);
          /*try:*/ {

            /* "gofast/tools/mathex.pyx":4898
 *         with np.errstate(all='ignore'): # rather than divide='warn'
 *             #https://numpy.org/devdocs/reference/generated/numpy.errstate.html
 *             W= W - (Z._T.dot(Z.dot(W)-s)/ Z.shape[0]) * alpha             # <<<<<<<<<<<<<<
 *             cost_history[ii]= (1/ 2* Z.shape[0]) * np.sum((Z.dot(W) -s)**2)
 * 
 */
            __Pyx_TraceLine(4898,0,__PYX_ERR(0, 4898, __pyx_L24_error))
            __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_v_Z, __pyx_n_s_T); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_8);
            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_dot); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_Z, __pyx_n_s_dot); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_16 = NULL;
            __pyx_t_10 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_4))) {
              __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_4);
              if (likely(__pyx_t_16)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
                __Pyx_INCREF(__pyx_t_16);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_4, function);
                __pyx_t_10 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_16, __pyx_v_W};
              __pyx_t_8 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
              __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
              if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4898, __pyx_L24_error)
              __Pyx_GOTREF(__pyx_t_8);
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            }
            __pyx_t_4 = PyNumber_Subtract(__pyx_t_8, __pyx_v_s); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            __pyx_t_8 = NULL;
            __pyx_t_10 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_5))) {
              __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_5);
              if (likely(__pyx_t_8)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_5);
                __Pyx_INCREF(__pyx_t_8);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_5, function);
                __pyx_t_10 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_8, __pyx_t_4};
              __pyx_t_7 = __Pyx_PyObject_FastCall(__pyx_t_5, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
              __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4898, __pyx_L24_error)
              __Pyx_GOTREF(__pyx_t_7);
              __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            }
            __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_Z, __pyx_n_s_shape); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_5);
            __pyx_t_4 = __Pyx_GetItemInt(__pyx_t_5, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __pyx_t_5 = __Pyx_PyNumber_Divide(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = PyFloat_FromDouble(__pyx_v_alpha); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_7 = PyNumber_Multiply(__pyx_t_5, __pyx_t_4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_7);
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = PyNumber_Subtract(__pyx_v_W, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4898, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_DECREF_SET(__pyx_v_W, __pyx_t_4);
            __pyx_t_4 = 0;

            /* "gofast/tools/mathex.pyx":4899
 *             #https://numpy.org/devdocs/reference/generated/numpy.errstate.html
 *             W= W - (Z._T.dot(Z.dot(W)-s)/ Z.shape[0]) * alpha
 *             cost_history[ii]= (1/ 2* Z.shape[0]) * np.sum((Z.dot(W) -s)**2)             # <<<<<<<<<<<<<<
 * 
 *     # Model function _F= Z.W where `Z` id composed of vertical nodes
 */
            __Pyx_TraceLine(4899,0,__PYX_ERR(0, 4899, __pyx_L24_error))
            __pyx_t_4 = PyFloat_FromDouble((1.0 / 2.0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_Z, __pyx_n_s_shape); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_7);
            __pyx_t_5 = __Pyx_GetItemInt(__pyx_t_7, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_5);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __pyx_t_7 = PyNumber_Multiply(__pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_7);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_sum); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_16 = __Pyx_PyObject_GetAttrStr(__pyx_v_Z, __pyx_n_s_dot); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_16);
            __pyx_t_17 = NULL;
            __pyx_t_10 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_16))) {
              __pyx_t_17 = PyMethod_GET_SELF(__pyx_t_16);
              if (likely(__pyx_t_17)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_16);
                __Pyx_INCREF(__pyx_t_17);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_16, function);
                __pyx_t_10 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_17, __pyx_v_W};
              __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_16, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
              __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
              if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4899, __pyx_L24_error)
              __Pyx_GOTREF(__pyx_t_4);
              __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
            }
            __pyx_t_16 = PyNumber_Subtract(__pyx_t_4, __pyx_v_s); if (unlikely(!__pyx_t_16)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_16);
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            __pyx_t_4 = PyNumber_Power(__pyx_t_16, __pyx_int_2, Py_None); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_4);
            __Pyx_DECREF(__pyx_t_16); __pyx_t_16 = 0;
            __pyx_t_16 = NULL;
            __pyx_t_10 = 0;
            #if CYTHON_UNPACK_METHODS
            if (unlikely(PyMethod_Check(__pyx_t_8))) {
              __pyx_t_16 = PyMethod_GET_SELF(__pyx_t_8);
              if (likely(__pyx_t_16)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
                __Pyx_INCREF(__pyx_t_16);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_8, function);
                __pyx_t_10 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_16, __pyx_t_4};
              __pyx_t_5 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
              __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
              __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
              if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4899, __pyx_L24_error)
              __Pyx_GOTREF(__pyx_t_5);
              __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
            }
            __pyx_t_8 = PyNumber_Multiply(__pyx_t_7, __pyx_t_5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_GOTREF(__pyx_t_8);
            __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
            __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
            if (unlikely((PyObject_SetItem(__pyx_v_cost_history, __pyx_v_ii, __pyx_t_8) < 0))) __PYX_ERR(0, 4899, __pyx_L24_error)
            __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;

            /* "gofast/tools/mathex.pyx":4896
 * 
 *     for ii in range(n_epochs):
 *         with np.errstate(all='ignore'): # rather than divide='warn'             # <<<<<<<<<<<<<<
 *             #https://numpy.org/devdocs/reference/generated/numpy.errstate.html
 *             W= W - (Z._T.dot(Z.dot(W)-s)/ Z.shape[0]) * alpha
 */
          }
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_XDECREF(__pyx_t_15); __pyx_t_15 = 0;
          goto __pyx_L31_try_end;
          __pyx_L24_error:;
          __Pyx_XDECREF(__pyx_t_16); __pyx_t_16 = 0;
          __Pyx_XDECREF(__pyx_t_17); __pyx_t_17 = 0;
          __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
          __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
          __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
          /*except:*/ {
            __Pyx_AddTraceback("gofast.tools.mathex.gradient_descent", __pyx_clineno, __pyx_lineno, __pyx_filename);
            if (__Pyx_GetException(&__pyx_t_8, &__pyx_t_5, &__pyx_t_7) < 0) __PYX_ERR(0, 4896, __pyx_L26_except_error)
            __Pyx_XGOTREF(__pyx_t_8);
            __Pyx_XGOTREF(__pyx_t_5);
            __Pyx_XGOTREF(__pyx_t_7);
            __pyx_t_4 = PyTuple_Pack(3, __pyx_t_8, __pyx_t_5, __pyx_t_7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4896, __pyx_L26_except_error)
            __Pyx_GOTREF(__pyx_t_4);
            __pyx_t_18 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_4, NULL);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
            if (unlikely(!__pyx_t_18)) __PYX_ERR(0, 4896, __pyx_L26_except_error)
            __Pyx_GOTREF(__pyx_t_18);
            __pyx_t_9 = __Pyx_PyObject_IsTrue(__pyx_t_18);
            __Pyx_DECREF(__pyx_t_18); __pyx_t_18 = 0;
            if (__pyx_t_9 < 0) __PYX_ERR(0, 4896, __pyx_L26_except_error)
            __pyx_t_19 = (!__pyx_t_9);
            if (unlikely(__pyx_t_19)) {
              __Pyx_GIVEREF(__pyx_t_8);
              __Pyx_GIVEREF(__pyx_t_5);
              __Pyx_XGIVEREF(__pyx_t_7);
              __Pyx_ErrRestoreWithState(__pyx_t_8, __pyx_t_5, __pyx_t_7);
              __pyx_t_8 = 0; __pyx_t_5 = 0; __pyx_t_7 = 0; 
              __PYX_ERR(0, 4896, __pyx_L26_except_error)
            }
            __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
            __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
            __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
            goto __pyx_L25_exception_handled;
          }
          __pyx_L26_except_error:;
          __Pyx_XGIVEREF(__pyx_t_2);
          __Pyx_XGIVEREF(__pyx_t_1);
          __Pyx_XGIVEREF(__pyx_t_15);
          __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_1, __pyx_t_15);
          goto __pyx_L1_error;
          __pyx_L25_exception_handled:;
          __Pyx_XGIVEREF(__pyx_t_2);
          __Pyx_XGIVEREF(__pyx_t_1);
          __Pyx_XGIVEREF(__pyx_t_15);
          __Pyx_ExceptionReset(__pyx_t_2, __pyx_t_1, __pyx_t_15);
          __pyx_L31_try_end:;
        }
      }
      /*finally:*/ {
        /*normal exit:*/{
          if (__pyx_t_3) {
            __pyx_t_15 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_tuple__95, NULL);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            if (unlikely(!__pyx_t_15)) __PYX_ERR(0, 4896, __pyx_L1_error)
            __Pyx_GOTREF(__pyx_t_15);
            __Pyx_DECREF(__pyx_t_15); __pyx_t_15 = 0;
          }
          goto __pyx_L23;
        }
        __pyx_L23:;
      }
      goto __pyx_L35;
      __pyx_L18_error:;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      goto __pyx_L1_error;
      __pyx_L35:;
    }

    /* "gofast/tools/mathex.pyx":4895
 *     s=s.reshape((s.shape[0], 1))
 * 
 *     for ii in range(n_epochs):             # <<<<<<<<<<<<<<
 *         with np.errstate(all='ignore'): # rather than divide='warn'
 *             #https://numpy.org/devdocs/reference/generated/numpy.errstate.html
 */
    __Pyx_TraceLine(4895,0,__PYX_ERR(0, 4895, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":4903
 *     # Model function _F= Z.W where `Z` id composed of vertical nodes
 *     # values and `bias` columns and `W` is weights numbers.
 *     _F= Z.dot(W) # model(Z=Z, W=W)     # generate the new model with the best weights             # <<<<<<<<<<<<<<
 * 
 *     return _F,W, cost_history
 */
  __Pyx_TraceLine(4903,0,__PYX_ERR(0, 4903, __pyx_L1_error))
  __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_v_Z, __pyx_n_s_dot); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4903, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_7);
  __pyx_t_5 = NULL;
  __pyx_t_10 = 0;
  #if CYTHON_UNPACK_METHODS
  if (likely(PyMethod_Check(__pyx_t_7))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_7);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_7, function);
      __pyx_t_10 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_W};
    __pyx_t_6 = __Pyx_PyObject_FastCall(__pyx_t_7, __pyx_callargs+1-__pyx_t_10, 1+__pyx_t_10);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4903, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
  }
  __pyx_v__F = __pyx_t_6;
  __pyx_t_6 = 0;

  /* "gofast/tools/mathex.pyx":4905
 *     _F= Z.dot(W) # model(Z=Z, W=W)     # generate the new model with the best weights
 * 
 *     return _F,W, cost_history             # <<<<<<<<<<<<<<
 * 
 * def _kind_of_model(degree, x, y) :
 */
  __Pyx_TraceLine(4905,0,__PYX_ERR(0, 4905, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4905, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_6);
  __Pyx_INCREF(__pyx_v__F);
  __Pyx_GIVEREF(__pyx_v__F);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_v__F)) __PYX_ERR(0, 4905, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_W);
  __Pyx_GIVEREF(__pyx_v_W);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_v_W)) __PYX_ERR(0, 4905, __pyx_L1_error);
  __Pyx_INCREF(__pyx_v_cost_history);
  __Pyx_GIVEREF(__pyx_v_cost_history);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_v_cost_history)) __PYX_ERR(0, 4905, __pyx_L1_error);
  __pyx_r = __pyx_t_6;
  __pyx_t_6 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4820
 *         )
 * 
 * def gradient_descent(             # <<<<<<<<<<<<<<
 *     z: ArrayLike,
 *     s:ArrayLike,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_16);
  __Pyx_XDECREF(__pyx_t_17);
  __Pyx_AddTraceback("gofast.tools.mathex.gradient_descent", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_Z);
  __Pyx_XDECREF(__pyx_v_W);
  __Pyx_XDECREF(__pyx_v_cost_history);
  __Pyx_XDECREF(__pyx_v_ii);
  __Pyx_XDECREF(__pyx_v__F);
  __Pyx_XDECREF(__pyx_v_s);
  __Pyx_XDECREF(__pyx_v_kind);
  __Pyx_XDECREF(__pyx_v_degree);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4907
 *     return _F,W, cost_history
 * 
 * def _kind_of_model(degree, x, y) :             # <<<<<<<<<<<<<<
 *     """
 *     An isolated part of gradient descent computing.
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_127_kind_of_model(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_126_kind_of_model, " \n    An isolated part of gradient descent computing. \n    Generate kind of model. If degree is``1`` The linear subset \n    function will use. If `degree` is greater than 2,  Matrix will \n    generate using the polynomail function.\n     \n    :param x: X values must be the vertical nodes values \n    :param y: S values must be the resistivity of subblocks at node x \n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_127_kind_of_model = {"_kind_of_model", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_127_kind_of_model, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_126_kind_of_model};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_127_kind_of_model(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_degree = 0;
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_kind_of_model (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_degree,&__pyx_n_s_x,&__pyx_n_s_y,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_degree)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4907, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4907, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_kind_of_model", 1, 3, 3, 1); __PYX_ERR(0, 4907, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4907, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_kind_of_model", 1, 3, 3, 2); __PYX_ERR(0, 4907, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_kind_of_model") < 0)) __PYX_ERR(0, 4907, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_degree = values[0];
    __pyx_v_x = values[1];
    __pyx_v_y = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_kind_of_model", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 4907, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._kind_of_model", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_126_kind_of_model(__pyx_self, __pyx_v_degree, __pyx_v_x, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4922
 *     w = np.zeros((degree+1, 1)) # initialize weights
 * 
 *     def init_weights (x, y):             # <<<<<<<<<<<<<<
 *         """ Init weights by calculating the scope of the function along
 *          the vertical nodes axis for each columns. """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_14_kind_of_model_1init_weights(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_14_kind_of_model_init_weights, " Init weights by calculating the scope of the function along \n         the vertical nodes axis for each columns. ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_14_kind_of_model_1init_weights = {"init_weights", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_14_kind_of_model_1init_weights, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_14_kind_of_model_init_weights};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_14_kind_of_model_1init_weights(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_x = 0;
  PyObject *__pyx_v_y = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("init_weights (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_x,&__pyx_n_s_y,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_x)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4922, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4922, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("init_weights", 1, 2, 2, 1); __PYX_ERR(0, 4922, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "init_weights") < 0)) __PYX_ERR(0, 4922, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 2)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
    }
    __pyx_v_x = values[0];
    __pyx_v_y = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("init_weights", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 4922, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex._kind_of_model.init_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_14_kind_of_model_init_weights(__pyx_self, __pyx_v_x, __pyx_v_y);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_14_kind_of_model_init_weights(PyObject *__pyx_self, PyObject *__pyx_v_x, PyObject *__pyx_v_y) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *__pyx_cur_scope;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *__pyx_outer_scope;
  PyObject *__pyx_v_j = NULL;
  PyObject *__pyx_v_a = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  PyObject *(*__pyx_t_11)(PyObject *);
  PyObject *__pyx_t_12 = NULL;
  PyObject *__pyx_t_13 = NULL;
  PyObject *__pyx_t_14 = NULL;
  int __pyx_t_15;
  int __pyx_t_16;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("init_weights", 1);
  __pyx_outer_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;
  __Pyx_TraceCall("init_weights", __pyx_f[0], 4922, 0, __PYX_ERR(0, 4922, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":4925
 *         """ Init weights by calculating the scope of the function along
 *          the vertical nodes axis for each columns. """
 *         with warnings.catch_warnings():             # <<<<<<<<<<<<<<
 *             warnings.filterwarnings(action='ignore',
 *                                     category=RuntimeWarning)
 */
  __Pyx_TraceLine(4925,0,__PYX_ERR(0, 4925, __pyx_L1_error))
  /*with:*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_warnings); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4925, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_catch_warnings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4925, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4925, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_5 = __Pyx_PyObject_LookupSpecial(__pyx_t_1, __pyx_n_s_exit); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 4925, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_5);
    __pyx_t_2 = __Pyx_PyObject_LookupSpecial(__pyx_t_1, __pyx_n_s_enter); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4925, __pyx_L3_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_6 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_6)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_6);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4925, __pyx_L3_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    /*try:*/ {
      {
        __Pyx_PyThreadState_declare
        __Pyx_PyThreadState_assign
        __Pyx_ExceptionSave(&__pyx_t_7, &__pyx_t_8, &__pyx_t_9);
        __Pyx_XGOTREF(__pyx_t_7);
        __Pyx_XGOTREF(__pyx_t_8);
        __Pyx_XGOTREF(__pyx_t_9);
        /*try:*/ {

          /* "gofast/tools/mathex.pyx":4926
 *          the vertical nodes axis for each columns. """
 *         with warnings.catch_warnings():
 *             warnings.filterwarnings(action='ignore',             # <<<<<<<<<<<<<<
 *                                     category=RuntimeWarning)
 *             for j in range(x.shape[1]-1):
 */
          __Pyx_TraceLine(4926,0,__PYX_ERR(0, 4926, __pyx_L7_error))
          __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_warnings); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4926, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_filterwarnings); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4926, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_3);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4926, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_1);
          if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_action, __pyx_n_u_ignore) < 0) __PYX_ERR(0, 4926, __pyx_L7_error)

          /* "gofast/tools/mathex.pyx":4927
 *         with warnings.catch_warnings():
 *             warnings.filterwarnings(action='ignore',
 *                                     category=RuntimeWarning)             # <<<<<<<<<<<<<<
 *             for j in range(x.shape[1]-1):
 *                 a= (y.max()-y.min())/(x[:, j].max()-x[:, j].min())
 */
          __Pyx_TraceLine(4927,0,__PYX_ERR(0, 4927, __pyx_L7_error))
          if (PyDict_SetItem(__pyx_t_1, __pyx_n_s_category, __pyx_builtin_RuntimeWarning) < 0) __PYX_ERR(0, 4926, __pyx_L7_error)

          /* "gofast/tools/mathex.pyx":4926
 *          the vertical nodes axis for each columns. """
 *         with warnings.catch_warnings():
 *             warnings.filterwarnings(action='ignore',             # <<<<<<<<<<<<<<
 *                                     category=RuntimeWarning)
 *             for j in range(x.shape[1]-1):
 */
          __Pyx_TraceLine(4926,0,__PYX_ERR(0, 4926, __pyx_L7_error))
          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_empty_tuple, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4926, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

          /* "gofast/tools/mathex.pyx":4928
 *             warnings.filterwarnings(action='ignore',
 *                                     category=RuntimeWarning)
 *             for j in range(x.shape[1]-1):             # <<<<<<<<<<<<<<
 *                 a= (y.max()-y.min())/(x[:, j].max()-x[:, j].min())
 *                 w[j]=a
 */
          __Pyx_TraceLine(4928,0,__PYX_ERR(0, 4928, __pyx_L7_error))
          __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_shape); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4928, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_2);
          __pyx_t_1 = __Pyx_GetItemInt(__pyx_t_2, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4928, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          __pyx_t_2 = __Pyx_PyInt_SubtractObjC(__pyx_t_1, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4928, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_2);
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4928, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_1);
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
          if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
            __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2);
            __pyx_t_10 = 0;
            __pyx_t_11 = NULL;
          } else {
            __pyx_t_10 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4928, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_2);
            __pyx_t_11 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_2); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 4928, __pyx_L7_error)
          }
          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          for (;;) {
            if (likely(!__pyx_t_11)) {
              if (likely(PyList_CheckExact(__pyx_t_2))) {
                {
                  Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_2);
                  #if !CYTHON_ASSUME_SAFE_MACROS
                  if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4928, __pyx_L7_error)
                  #endif
                  if (__pyx_t_10 >= __pyx_temp) break;
                }
                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_10); __Pyx_INCREF(__pyx_t_1); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 4928, __pyx_L7_error)
                #else
                __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4928, __pyx_L7_error)
                __Pyx_GOTREF(__pyx_t_1);
                #endif
              } else {
                {
                  Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_2);
                  #if !CYTHON_ASSUME_SAFE_MACROS
                  if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4928, __pyx_L7_error)
                  #endif
                  if (__pyx_t_10 >= __pyx_temp) break;
                }
                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_10); __Pyx_INCREF(__pyx_t_1); __pyx_t_10++; if (unlikely((0 < 0))) __PYX_ERR(0, 4928, __pyx_L7_error)
                #else
                __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_2, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4928, __pyx_L7_error)
                __Pyx_GOTREF(__pyx_t_1);
                #endif
              }
            } else {
              __pyx_t_1 = __pyx_t_11(__pyx_t_2);
              if (unlikely(!__pyx_t_1)) {
                PyObject* exc_type = PyErr_Occurred();
                if (exc_type) {
                  if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
                  else __PYX_ERR(0, 4928, __pyx_L7_error)
                }
                break;
              }
              __Pyx_GOTREF(__pyx_t_1);
            }
            __Pyx_XDECREF_SET(__pyx_v_j, __pyx_t_1);
            __pyx_t_1 = 0;

            /* "gofast/tools/mathex.pyx":4929
 *                                     category=RuntimeWarning)
 *             for j in range(x.shape[1]-1):
 *                 a= (y.max()-y.min())/(x[:, j].max()-x[:, j].min())             # <<<<<<<<<<<<<<
 *                 w[j]=a
 *             w[-1] = y.mean()
 */
            __Pyx_TraceLine(4929,0,__PYX_ERR(0, 4929, __pyx_L7_error))
            __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_max); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_3);
            __pyx_t_6 = NULL;
            __pyx_t_4 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_3))) {
              __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_3);
              if (likely(__pyx_t_6)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
                __Pyx_INCREF(__pyx_t_6);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_3, function);
                __pyx_t_4 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_6, NULL};
              __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
              __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
              if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4929, __pyx_L7_error)
              __Pyx_GOTREF(__pyx_t_1);
              __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            }
            __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_min); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_6);
            __pyx_t_12 = NULL;
            __pyx_t_4 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_6))) {
              __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_6);
              if (likely(__pyx_t_12)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
                __Pyx_INCREF(__pyx_t_12);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_6, function);
                __pyx_t_4 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_12, NULL};
              __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_6, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
              __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
              if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4929, __pyx_L7_error)
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            }
            __pyx_t_6 = PyNumber_Subtract(__pyx_t_1, __pyx_t_3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_6);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_INCREF(__pyx_slice__9);
            __Pyx_GIVEREF(__pyx_slice__9);
            if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_slice__9)) __PYX_ERR(0, 4929, __pyx_L7_error);
            __Pyx_INCREF(__pyx_v_j);
            __Pyx_GIVEREF(__pyx_v_j);
            if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_v_j)) __PYX_ERR(0, 4929, __pyx_L7_error);
            __pyx_t_12 = __Pyx_PyObject_GetItem(__pyx_v_x, __pyx_t_1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_12, __pyx_n_s_max); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
            __pyx_t_12 = NULL;
            __pyx_t_4 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_1))) {
              __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_1);
              if (likely(__pyx_t_12)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
                __Pyx_INCREF(__pyx_t_12);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_1, function);
                __pyx_t_4 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_12, NULL};
              __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
              __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
              if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4929, __pyx_L7_error)
              __Pyx_GOTREF(__pyx_t_3);
              __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            }
            __pyx_t_12 = PyTuple_New(2); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_INCREF(__pyx_slice__9);
            __Pyx_GIVEREF(__pyx_slice__9);
            if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 0, __pyx_slice__9)) __PYX_ERR(0, 4929, __pyx_L7_error);
            __Pyx_INCREF(__pyx_v_j);
            __Pyx_GIVEREF(__pyx_v_j);
            if (__Pyx_PyTuple_SET_ITEM(__pyx_t_12, 1, __pyx_v_j)) __PYX_ERR(0, 4929, __pyx_L7_error);
            __pyx_t_13 = __Pyx_PyObject_GetItem(__pyx_v_x, __pyx_t_12); if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_13);
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
            __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_13, __pyx_n_s_min); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_DECREF(__pyx_t_13); __pyx_t_13 = 0;
            __pyx_t_13 = NULL;
            __pyx_t_4 = 0;
            #if CYTHON_UNPACK_METHODS
            if (likely(PyMethod_Check(__pyx_t_12))) {
              __pyx_t_13 = PyMethod_GET_SELF(__pyx_t_12);
              if (likely(__pyx_t_13)) {
                PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_12);
                __Pyx_INCREF(__pyx_t_13);
                __Pyx_INCREF(function);
                __Pyx_DECREF_SET(__pyx_t_12, function);
                __pyx_t_4 = 1;
              }
            }
            #endif
            {
              PyObject *__pyx_callargs[2] = {__pyx_t_13, NULL};
              __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_12, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
              __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
              if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4929, __pyx_L7_error)
              __Pyx_GOTREF(__pyx_t_1);
              __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
            }
            __pyx_t_12 = PyNumber_Subtract(__pyx_t_3, __pyx_t_1); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_12);
            __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
            __pyx_t_1 = __Pyx_PyNumber_Divide(__pyx_t_6, __pyx_t_12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4929, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_1);
            __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
            __Pyx_DECREF(__pyx_t_12); __pyx_t_12 = 0;
            __Pyx_XDECREF_SET(__pyx_v_a, __pyx_t_1);
            __pyx_t_1 = 0;

            /* "gofast/tools/mathex.pyx":4930
 *             for j in range(x.shape[1]-1):
 *                 a= (y.max()-y.min())/(x[:, j].max()-x[:, j].min())
 *                 w[j]=a             # <<<<<<<<<<<<<<
 *             w[-1] = y.mean()
 *         return w   # return weights
 */
            __Pyx_TraceLine(4930,0,__PYX_ERR(0, 4930, __pyx_L7_error))
            if (unlikely(!__pyx_cur_scope->__pyx_v_w)) { __Pyx_RaiseClosureNameError("w"); __PYX_ERR(0, 4930, __pyx_L7_error) }
            if (unlikely((PyObject_SetItem(__pyx_cur_scope->__pyx_v_w, __pyx_v_j, __pyx_v_a) < 0))) __PYX_ERR(0, 4930, __pyx_L7_error)

            /* "gofast/tools/mathex.pyx":4928
 *             warnings.filterwarnings(action='ignore',
 *                                     category=RuntimeWarning)
 *             for j in range(x.shape[1]-1):             # <<<<<<<<<<<<<<
 *                 a= (y.max()-y.min())/(x[:, j].max()-x[:, j].min())
 *                 w[j]=a
 */
            __Pyx_TraceLine(4928,0,__PYX_ERR(0, 4928, __pyx_L7_error))
          }
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

          /* "gofast/tools/mathex.pyx":4931
 *                 a= (y.max()-y.min())/(x[:, j].max()-x[:, j].min())
 *                 w[j]=a
 *             w[-1] = y.mean()             # <<<<<<<<<<<<<<
 *         return w   # return weights
 * 
 */
          __Pyx_TraceLine(4931,0,__PYX_ERR(0, 4931, __pyx_L7_error))
          __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_y, __pyx_n_s_mean); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4931, __pyx_L7_error)
          __Pyx_GOTREF(__pyx_t_1);
          __pyx_t_12 = NULL;
          __pyx_t_4 = 0;
          #if CYTHON_UNPACK_METHODS
          if (likely(PyMethod_Check(__pyx_t_1))) {
            __pyx_t_12 = PyMethod_GET_SELF(__pyx_t_1);
            if (likely(__pyx_t_12)) {
              PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
              __Pyx_INCREF(__pyx_t_12);
              __Pyx_INCREF(function);
              __Pyx_DECREF_SET(__pyx_t_1, function);
              __pyx_t_4 = 1;
            }
          }
          #endif
          {
            PyObject *__pyx_callargs[2] = {__pyx_t_12, NULL};
            __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_4, 0+__pyx_t_4);
            __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
            if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4931, __pyx_L7_error)
            __Pyx_GOTREF(__pyx_t_2);
            __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
          }
          if (unlikely(!__pyx_cur_scope->__pyx_v_w)) { __Pyx_RaiseClosureNameError("w"); __PYX_ERR(0, 4931, __pyx_L7_error) }
          if (unlikely((__Pyx_SetItemInt(__pyx_cur_scope->__pyx_v_w, -1L, __pyx_t_2, long, 1, __Pyx_PyInt_From_long, 0, 1, 1) < 0))) __PYX_ERR(0, 4931, __pyx_L7_error)
          __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

          /* "gofast/tools/mathex.pyx":4925
 *         """ Init weights by calculating the scope of the function along
 *          the vertical nodes axis for each columns. """
 *         with warnings.catch_warnings():             # <<<<<<<<<<<<<<
 *             warnings.filterwarnings(action='ignore',
 *                                     category=RuntimeWarning)
 */
        }
        __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
        __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
        __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
        goto __pyx_L12_try_end;
        __pyx_L7_error:;
        __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
        __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
        __Pyx_XDECREF(__pyx_t_13); __pyx_t_13 = 0;
        __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
        __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
        __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
        /*except:*/ {
          __Pyx_AddTraceback("gofast.tools.mathex._kind_of_model.init_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
          if (__Pyx_GetException(&__pyx_t_2, &__pyx_t_1, &__pyx_t_12) < 0) __PYX_ERR(0, 4925, __pyx_L9_except_error)
          __Pyx_XGOTREF(__pyx_t_2);
          __Pyx_XGOTREF(__pyx_t_1);
          __Pyx_XGOTREF(__pyx_t_12);
          __pyx_t_6 = PyTuple_Pack(3, __pyx_t_2, __pyx_t_1, __pyx_t_12); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4925, __pyx_L9_except_error)
          __Pyx_GOTREF(__pyx_t_6);
          __pyx_t_14 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_t_6, NULL);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
          if (unlikely(!__pyx_t_14)) __PYX_ERR(0, 4925, __pyx_L9_except_error)
          __Pyx_GOTREF(__pyx_t_14);
          __pyx_t_15 = __Pyx_PyObject_IsTrue(__pyx_t_14);
          __Pyx_DECREF(__pyx_t_14); __pyx_t_14 = 0;
          if (__pyx_t_15 < 0) __PYX_ERR(0, 4925, __pyx_L9_except_error)
          __pyx_t_16 = (!__pyx_t_15);
          if (unlikely(__pyx_t_16)) {
            __Pyx_GIVEREF(__pyx_t_2);
            __Pyx_GIVEREF(__pyx_t_1);
            __Pyx_XGIVEREF(__pyx_t_12);
            __Pyx_ErrRestoreWithState(__pyx_t_2, __pyx_t_1, __pyx_t_12);
            __pyx_t_2 = 0; __pyx_t_1 = 0; __pyx_t_12 = 0; 
            __PYX_ERR(0, 4925, __pyx_L9_except_error)
          }
          __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
          __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
          __Pyx_XDECREF(__pyx_t_12); __pyx_t_12 = 0;
          goto __pyx_L8_exception_handled;
        }
        __pyx_L9_except_error:;
        __Pyx_XGIVEREF(__pyx_t_7);
        __Pyx_XGIVEREF(__pyx_t_8);
        __Pyx_XGIVEREF(__pyx_t_9);
        __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
        goto __pyx_L1_error;
        __pyx_L8_exception_handled:;
        __Pyx_XGIVEREF(__pyx_t_7);
        __Pyx_XGIVEREF(__pyx_t_8);
        __Pyx_XGIVEREF(__pyx_t_9);
        __Pyx_ExceptionReset(__pyx_t_7, __pyx_t_8, __pyx_t_9);
        __pyx_L12_try_end:;
      }
    }
    /*finally:*/ {
      /*normal exit:*/{
        if (__pyx_t_5) {
          __pyx_t_9 = __Pyx_PyObject_Call(__pyx_t_5, __pyx_tuple__95, NULL);
          __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
          if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4925, __pyx_L1_error)
          __Pyx_GOTREF(__pyx_t_9);
          __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        }
        goto __pyx_L6;
      }
      __pyx_L6:;
    }
    goto __pyx_L19;
    __pyx_L3_error:;
    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
    goto __pyx_L1_error;
    __pyx_L19:;
  }

  /* "gofast/tools/mathex.pyx":4932
 *                 w[j]=a
 *             w[-1] = y.mean()
 *         return w   # return weights             # <<<<<<<<<<<<<<
 * 
 *     for i in range(degree):
 */
  __Pyx_TraceLine(4932,0,__PYX_ERR(0, 4932, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  if (unlikely(!__pyx_cur_scope->__pyx_v_w)) { __Pyx_RaiseClosureNameError("w"); __PYX_ERR(0, 4932, __pyx_L1_error) }
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_w);
  __pyx_r = __pyx_cur_scope->__pyx_v_w;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4922
 *     w = np.zeros((degree+1, 1)) # initialize weights
 * 
 *     def init_weights (x, y):             # <<<<<<<<<<<<<<
 *         """ Init weights by calculating the scope of the function along
 *          the vertical nodes axis for each columns. """
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_12);
  __Pyx_XDECREF(__pyx_t_13);
  __Pyx_AddTraceback("gofast.tools.mathex._kind_of_model.init_weights", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_j);
  __Pyx_XDECREF(__pyx_v_a);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4907
 *     return _F,W, cost_history
 * 
 * def _kind_of_model(degree, x, y) :             # <<<<<<<<<<<<<<
 *     """
 *     An isolated part of gradient descent computing.
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_126_kind_of_model(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_degree, PyObject *__pyx_v_x, PyObject *__pyx_v_y) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *__pyx_cur_scope;
  PyObject *__pyx_v_c = NULL;
  PyObject *__pyx_v_deg = NULL;
  PyObject *__pyx_v_init_weights = 0;
  CYTHON_UNUSED PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  Py_ssize_t __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  int __pyx_t_8;
  int __pyx_t_9;
  PyObject *__pyx_t_10 = NULL;
  PyObject *__pyx_t_11 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__142)
  __Pyx_RefNannySetupContext("_kind_of_model", 0);
  __pyx_cur_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 4907, __pyx_L1_error)
  } else {
    __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
  }
  __Pyx_TraceCall("_kind_of_model", __pyx_f[0], 4907, 0, __PYX_ERR(0, 4907, __pyx_L1_error));
  __Pyx_INCREF(__pyx_v_x);

  /* "gofast/tools/mathex.pyx":4918
 * 
 *     """
 *     c= []             # <<<<<<<<<<<<<<
 *     deg = degree
 *     w = np.zeros((degree+1, 1)) # initialize weights
 */
  __Pyx_TraceLine(4918,0,__PYX_ERR(0, 4918, __pyx_L1_error))
  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4918, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_c = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4919
 *     """
 *     c= []
 *     deg = degree             # <<<<<<<<<<<<<<
 *     w = np.zeros((degree+1, 1)) # initialize weights
 * 
 */
  __Pyx_TraceLine(4919,0,__PYX_ERR(0, 4919, __pyx_L1_error))
  __Pyx_INCREF(__pyx_v_degree);
  __pyx_v_deg = __pyx_v_degree;

  /* "gofast/tools/mathex.pyx":4920
 *     c= []
 *     deg = degree
 *     w = np.zeros((degree+1, 1)) # initialize weights             # <<<<<<<<<<<<<<
 * 
 *     def init_weights (x, y):
 */
  __Pyx_TraceLine(4920,0,__PYX_ERR(0, 4920, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_v_degree, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_2)) __PYX_ERR(0, 4920, __pyx_L1_error);
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_int_1)) __PYX_ERR(0, 4920, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_5 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_t_4};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4920, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_cur_scope->__pyx_v_w = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4922
 *     w = np.zeros((degree+1, 1)) # initialize weights
 * 
 *     def init_weights (x, y):             # <<<<<<<<<<<<<<
 *         """ Init weights by calculating the scope of the function along
 *          the vertical nodes axis for each columns. """
 */
  __Pyx_TraceLine(4922,0,__PYX_ERR(0, 4922, __pyx_L1_error))
  __pyx_t_1 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_14_kind_of_model_1init_weights, 0, __pyx_n_s_kind_of_model_locals_init_weigh, ((PyObject*)__pyx_cur_scope), __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__144)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4922, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_v_init_weights = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4934
 *         return w   # return weights
 * 
 *     for i in range(degree):             # <<<<<<<<<<<<<<
 *         c.append(x ** deg)
 *         deg= deg -1
 */
  __Pyx_TraceLine(4934,0,__PYX_ERR(0, 4934, __pyx_L1_error))
  __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_v_degree); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4934, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
    __pyx_t_3 = __pyx_t_1; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_6 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_6 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4934, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 4934, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4934, __pyx_L1_error)
          #endif
          if (__pyx_t_6 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 4934, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4934, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4934, __pyx_L1_error)
          #endif
          if (__pyx_t_6 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_6); __Pyx_INCREF(__pyx_t_1); __pyx_t_6++; if (unlikely((0 < 0))) __PYX_ERR(0, 4934, __pyx_L1_error)
        #else
        __pyx_t_1 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4934, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_1);
        #endif
      }
    } else {
      __pyx_t_1 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_1)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 4934, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_1);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4935
 * 
 *     for i in range(degree):
 *         c.append(x ** deg)             # <<<<<<<<<<<<<<
 *         deg= deg -1
 * 
 */
    __Pyx_TraceLine(4935,0,__PYX_ERR(0, 4935, __pyx_L1_error))
    __pyx_t_1 = PyNumber_Power(__pyx_v_x, __pyx_v_deg, Py_None); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4935, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_8 = __Pyx_PyList_Append(__pyx_v_c, __pyx_t_1); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 4935, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4936
 *     for i in range(degree):
 *         c.append(x ** deg)
 *         deg= deg -1             # <<<<<<<<<<<<<<
 * 
 *     if len(c)> 1:
 */
    __Pyx_TraceLine(4936,0,__PYX_ERR(0, 4936, __pyx_L1_error))
    __pyx_t_1 = __Pyx_PyInt_SubtractObjC(__pyx_v_deg, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4936, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF_SET(__pyx_v_deg, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4934
 *         return w   # return weights
 * 
 *     for i in range(degree):             # <<<<<<<<<<<<<<
 *         c.append(x ** deg)
 *         deg= deg -1
 */
    __Pyx_TraceLine(4934,0,__PYX_ERR(0, 4934, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4938
 *         deg= deg -1
 * 
 *     if len(c)> 1:             # <<<<<<<<<<<<<<
 *         x= concat_array_from_list(c, concat_axis=1)
 *         x= np.concatenate((x, np.ones((x.shape[0], 1))), axis =1)
 */
  __Pyx_TraceLine(4938,0,__PYX_ERR(0, 4938, __pyx_L1_error))
  __pyx_t_6 = __Pyx_PyList_GET_SIZE(__pyx_v_c); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4938, __pyx_L1_error)
  __pyx_t_9 = (__pyx_t_6 > 1);
  if (__pyx_t_9) {

    /* "gofast/tools/mathex.pyx":4939
 * 
 *     if len(c)> 1:
 *         x= concat_array_from_list(c, concat_axis=1)             # <<<<<<<<<<<<<<
 *         x= np.concatenate((x, np.ones((x.shape[0], 1))), axis =1)
 * 
 */
    __Pyx_TraceLine(4939,0,__PYX_ERR(0, 4939, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_concat_array_from_list); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4939, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_1 = PyTuple_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4939, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(__pyx_v_c);
    __Pyx_GIVEREF(__pyx_v_c);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_c)) __PYX_ERR(0, 4939, __pyx_L1_error);
    __pyx_t_4 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4939, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_concat_axis, __pyx_int_1) < 0) __PYX_ERR(0, 4939, __pyx_L1_error)
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_1, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4939, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":4940
 *     if len(c)> 1:
 *         x= concat_array_from_list(c, concat_axis=1)
 *         x= np.concatenate((x, np.ones((x.shape[0], 1))), axis =1)             # <<<<<<<<<<<<<<
 * 
 *     else: x= np.vstack((x, np.ones(x.shape)))._T # initialize z to V*2
 */
    __Pyx_TraceLine(4940,0,__PYX_ERR(0, 4940, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_concatenate); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_ones); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_shape); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_10 = __Pyx_GetItemInt(__pyx_t_1, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_GIVEREF(__pyx_t_10);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_10)) __PYX_ERR(0, 4940, __pyx_L1_error);
    __Pyx_INCREF(__pyx_int_1);
    __Pyx_GIVEREF(__pyx_int_1);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_int_1)) __PYX_ERR(0, 4940, __pyx_L1_error);
    __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_10 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_10)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_10);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_10, __pyx_t_1};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_10); __pyx_t_10 = 0;
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4940, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_v_x)) __PYX_ERR(0, 4940, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_2);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_2)) __PYX_ERR(0, 4940, __pyx_L1_error);
    __pyx_t_2 = 0;
    __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_GIVEREF(__pyx_t_3);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3)) __PYX_ERR(0, 4940, __pyx_L1_error);
    __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_axis, __pyx_int_1) < 0) __PYX_ERR(0, 4940, __pyx_L1_error)
    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4940, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":4938
 *         deg= deg -1
 * 
 *     if len(c)> 1:             # <<<<<<<<<<<<<<
 *         x= concat_array_from_list(c, concat_axis=1)
 *         x= np.concatenate((x, np.ones((x.shape[0], 1))), axis =1)
 */
    goto __pyx_L6;
  }

  /* "gofast/tools/mathex.pyx":4942
 *         x= np.concatenate((x, np.ones((x.shape[0], 1))), axis =1)
 * 
 *     else: x= np.vstack((x, np.ones(x.shape)))._T # initialize z to V*2             # <<<<<<<<<<<<<<
 * 
 *     w= init_weights(x=x, y=y)
 */
  __Pyx_TraceLine(4942,0,__PYX_ERR(0, 4942, __pyx_L1_error))
  /*else*/ {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_vstack); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_ones); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_x, __pyx_n_s_shape); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_11 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_10))) {
      __pyx_t_11 = PyMethod_GET_SELF(__pyx_t_10);
      if (likely(__pyx_t_11)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
        __Pyx_INCREF(__pyx_t_11);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_10, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_11, __pyx_t_4};
      __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_10, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_11); __pyx_t_11 = 0;
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4942, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
    }
    __pyx_t_10 = PyTuple_New(2); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_10);
    __Pyx_INCREF(__pyx_v_x);
    __Pyx_GIVEREF(__pyx_v_x);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_v_x)) __PYX_ERR(0, 4942, __pyx_L1_error);
    __Pyx_GIVEREF(__pyx_t_3);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_10, 1, __pyx_t_3)) __PYX_ERR(0, 4942, __pyx_L1_error);
    __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_5 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_5 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_t_10};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4942, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_T); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4942, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __Pyx_DECREF_SET(__pyx_v_x, __pyx_t_2);
    __pyx_t_2 = 0;
  }
  __pyx_L6:;

  /* "gofast/tools/mathex.pyx":4944
 *     else: x= np.vstack((x, np.ones(x.shape)))._T # initialize z to V*2
 * 
 *     w= init_weights(x=x, y=y)             # <<<<<<<<<<<<<<
 *     return x, w  # Return the matrix x and the weights vector w
 * 
 */
  __Pyx_TraceLine(4944,0,__PYX_ERR(0, 4944, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4944, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_x, __pyx_v_x) < 0) __PYX_ERR(0, 4944, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_y, __pyx_v_y) < 0) __PYX_ERR(0, 4944, __pyx_L1_error)
  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_v_init_weights, __pyx_empty_tuple, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4944, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GOTREF(__pyx_cur_scope->__pyx_v_w);
  __Pyx_DECREF_SET(__pyx_cur_scope->__pyx_v_w, __pyx_t_1);
  __Pyx_GIVEREF(__pyx_t_1);
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4945
 * 
 *     w= init_weights(x=x, y=y)
 *     return x, w  # Return the matrix x and the weights vector w             # <<<<<<<<<<<<<<
 * 
 * def adaptive_moving_average(data,  window_size_factor=0.1):
 */
  __Pyx_TraceLine(4945,0,__PYX_ERR(0, 4945, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __pyx_t_1 = PyTuple_New(2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4945, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_v_x);
  __Pyx_GIVEREF(__pyx_v_x);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_v_x)) __PYX_ERR(0, 4945, __pyx_L1_error);
  __Pyx_INCREF(__pyx_cur_scope->__pyx_v_w);
  __Pyx_GIVEREF(__pyx_cur_scope->__pyx_v_w);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_cur_scope->__pyx_v_w)) __PYX_ERR(0, 4945, __pyx_L1_error);
  __pyx_r = __pyx_t_1;
  __pyx_t_1 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4907
 *     return _F,W, cost_history
 * 
 * def _kind_of_model(degree, x, y) :             # <<<<<<<<<<<<<<
 *     """
 *     An isolated part of gradient descent computing.
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_10);
  __Pyx_XDECREF(__pyx_t_11);
  __Pyx_AddTraceback("gofast.tools.mathex._kind_of_model", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_c);
  __Pyx_XDECREF(__pyx_v_deg);
  __Pyx_XDECREF(__pyx_v_init_weights);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_x);
  __Pyx_DECREF((PyObject *)__pyx_cur_scope);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4947
 *     return x, w  # Return the matrix x and the weights vector w
 * 
 * def adaptive_moving_average(data,  window_size_factor=0.1):             # <<<<<<<<<<<<<<
 *     """ Adaptative moving average as  smoothing technique.
 * 
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_129adaptive_moving_average(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_128adaptive_moving_average, " Adaptative moving average as  smoothing technique. \n \n    Parameters \n    -----------\n    data: Arraylike \n       Noise data for smoothing \n       \n    window_size_factor: float, default=0.1 \n      Parameter to control the adaptiveness of the moving average.\n       \n    Return \n    --------\n    result: Arraylike \n       Smoothed data \n    \n    Example \n    ---------\n    >>> import matplotlib.pyplot as plt\n    >>> from gofast.tools.mathex  import adaptive_moving_average \n    >>> # Sample magnetotelluric data (replace this with your own data)\n    >>> # Example data: a sine wave with noise\n    >>> time = np.linspace(0, 10, 1000)  # Replace with your actual time values\n    >>> mt_data = np.sin(2 * np.pi * 1 * time) + 0.2 * np.random.randn(1000)  # Example data\n    >>> # Function to calculate the adaptive moving average\n    >>> # Define the window size factor (adjust as needed)\n    >>> window_size_factor = 0.1  # Adjust this value based on your data characteristics\n    >>> # Apply adaptive moving average to the magnetotelluric data\n    >>> smoothed_data = adaptive_moving_average(mt_data, window_size_factor)\n    >>> # Plot the original and smoothed data\n    >>> plt.figure(figsize=(10, 6))\n    >>> plt.plot(time, mt_data, 'b-', label='Original Data')\n    >>> plt.plot(time, smoothed_data, 'r-', label='Smoothed Data (AMA)')\n    >>> plt.xlabel('Time')\n    >>> plt.ylabel('Amplitude')\n    >>> plt.title('Adaptive Moving Average (AMA) Smoothing')\n    >>> plt.legend()\n    >>> plt.grid(True)\n    >>> plt.show()\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_129adaptive_moving_average = {"adaptive_moving_average", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_129adaptive_moving_average, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_128adaptive_moving_average};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_129adaptive_moving_average(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_data = 0;
  PyObject *__pyx_v_window_size_factor = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[2] = {0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("adaptive_moving_average (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_data,&__pyx_n_s_window_size_factor,0};
    values[1] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_1)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_data)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4947, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_window_size_factor);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4947, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "adaptive_moving_average") < 0)) __PYX_ERR(0, 4947, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_data = values[0];
    __pyx_v_window_size_factor = values[1];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("adaptive_moving_average", 0, 1, 2, __pyx_nargs); __PYX_ERR(0, 4947, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.adaptive_moving_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_128adaptive_moving_average(__pyx_self, __pyx_v_data, __pyx_v_window_size_factor);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_128adaptive_moving_average(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_data, PyObject *__pyx_v_window_size_factor) {
  PyObject *__pyx_v_result = NULL;
  PyObject *__pyx_v_window_size = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_start = NULL;
  PyObject *__pyx_v_end = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  int __pyx_t_4;
  Py_ssize_t __pyx_t_5;
  PyObject *(*__pyx_t_6)(PyObject *);
  long __pyx_t_7;
  PyObject *__pyx_t_8 = NULL;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__145)
  __Pyx_RefNannySetupContext("adaptive_moving_average", 1);
  __Pyx_TraceCall("adaptive_moving_average", __pyx_f[0], 4947, 0, __PYX_ERR(0, 4947, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":4987
 *     >>> plt.show()
 *     """
 *     result = np.zeros_like(data)             # <<<<<<<<<<<<<<
 *     window_size = int(window_size_factor * len(data))
 * 
 */
  __Pyx_TraceLine(4987,0,__PYX_ERR(0, 4987, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_zeros_like); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4987, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  __pyx_t_4 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_2);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_4 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_data};
    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4987, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_result = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4988
 *     """
 *     result = np.zeros_like(data)
 *     window_size = int(window_size_factor * len(data))             # <<<<<<<<<<<<<<
 * 
 *     for i in range(len(data)):
 */
  __Pyx_TraceLine(4988,0,__PYX_ERR(0, 4988, __pyx_L1_error))
  __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4988, __pyx_L1_error)
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = PyNumber_Multiply(__pyx_v_window_size_factor, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_PyNumber_Int(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4988, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_window_size = __pyx_t_1;
  __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4990
 *     window_size = int(window_size_factor * len(data))
 * 
 *     for i in range(len(data)):             # <<<<<<<<<<<<<<
 *         start = max(0, i - window_size)
 *         end = min(len(data), i + window_size + 1)
 */
  __Pyx_TraceLine(4990,0,__PYX_ERR(0, 4990, __pyx_L1_error))
  __pyx_t_5 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4990, __pyx_L1_error)
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4990, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
    __pyx_t_1 = __pyx_t_3; __Pyx_INCREF(__pyx_t_1);
    __pyx_t_5 = 0;
    __pyx_t_6 = NULL;
  } else {
    __pyx_t_5 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4990, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __pyx_t_6 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_1); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 4990, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  for (;;) {
    if (likely(!__pyx_t_6)) {
      if (likely(PyList_CheckExact(__pyx_t_1))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4990, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 4990, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4990, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_1);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 4990, __pyx_L1_error)
          #endif
          if (__pyx_t_5 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely((0 < 0))) __PYX_ERR(0, 4990, __pyx_L1_error)
        #else
        __pyx_t_3 = __Pyx_PySequence_ITEM(__pyx_t_1, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4990, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        #endif
      }
    } else {
      __pyx_t_3 = __pyx_t_6(__pyx_t_1);
      if (unlikely(!__pyx_t_3)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 4990, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_3);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4991
 * 
 *     for i in range(len(data)):
 *         start = max(0, i - window_size)             # <<<<<<<<<<<<<<
 *         end = min(len(data), i + window_size + 1)
 *         result[i] = np.mean(data[start:end])
 */
    __Pyx_TraceLine(4991,0,__PYX_ERR(0, 4991, __pyx_L1_error))
    __pyx_t_3 = PyNumber_Subtract(__pyx_v_i, __pyx_v_window_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4991, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = 0;
    __pyx_t_8 = __Pyx_PyInt_From_long(__pyx_t_7); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4991, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __pyx_t_9 = PyObject_RichCompare(__pyx_t_3, __pyx_t_8, Py_GT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4991, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 4991, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_10) {
      __Pyx_INCREF(__pyx_t_3);
      __pyx_t_2 = __pyx_t_3;
    } else {
      __pyx_t_9 = __Pyx_PyInt_From_long(__pyx_t_7); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4991, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_2 = __pyx_t_9;
      __pyx_t_9 = 0;
    }
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_t_2;
    __Pyx_INCREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_start, __pyx_t_3);
    __pyx_t_3 = 0;

    /* "gofast/tools/mathex.pyx":4992
 *     for i in range(len(data)):
 *         start = max(0, i - window_size)
 *         end = min(len(data), i + window_size + 1)             # <<<<<<<<<<<<<<
 *         result[i] = np.mean(data[start:end])
 * 
 */
    __Pyx_TraceLine(4992,0,__PYX_ERR(0, 4992, __pyx_L1_error))
    __pyx_t_3 = PyNumber_Add(__pyx_v_i, __pyx_v_window_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = __Pyx_PyInt_AddObjC(__pyx_t_3, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_11 = PyObject_Length(__pyx_v_data); if (unlikely(__pyx_t_11 == ((Py_ssize_t)-1))) __PYX_ERR(0, 4992, __pyx_L1_error)
    __pyx_t_9 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 4992, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_8 = PyObject_RichCompare(__pyx_t_2, __pyx_t_9, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4992, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_10 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely((__pyx_t_10 < 0))) __PYX_ERR(0, 4992, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    if (__pyx_t_10) {
      __Pyx_INCREF(__pyx_t_2);
      __pyx_t_3 = __pyx_t_2;
    } else {
      __pyx_t_8 = PyInt_FromSsize_t(__pyx_t_11); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4992, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_8);
      __pyx_t_3 = __pyx_t_8;
      __pyx_t_8 = 0;
    }
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_t_3;
    __Pyx_INCREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_XDECREF_SET(__pyx_v_end, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":4993
 *         start = max(0, i - window_size)
 *         end = min(len(data), i + window_size + 1)
 *         result[i] = np.mean(data[start:end])             # <<<<<<<<<<<<<<
 * 
 *     return result
 */
    __Pyx_TraceLine(4993,0,__PYX_ERR(0, 4993, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4993, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_mean); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 4993, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_8);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __Pyx_PyObject_GetSlice(__pyx_v_data, 0, 0, &__pyx_v_start, &__pyx_v_end, NULL, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4993, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = NULL;
    __pyx_t_4 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_8))) {
      __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_8);
      if (likely(__pyx_t_9)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_8);
        __Pyx_INCREF(__pyx_t_9);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_8, function);
        __pyx_t_4 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_t_3};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_8, __pyx_callargs+1-__pyx_t_4, 1+__pyx_t_4);
      __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4993, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
    }
    if (unlikely((PyObject_SetItem(__pyx_v_result, __pyx_v_i, __pyx_t_2) < 0))) __PYX_ERR(0, 4993, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":4990
 *     window_size = int(window_size_factor * len(data))
 * 
 *     for i in range(len(data)):             # <<<<<<<<<<<<<<
 *         start = max(0, i - window_size)
 *         end = min(len(data), i + window_size + 1)
 */
    __Pyx_TraceLine(4990,0,__PYX_ERR(0, 4990, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

  /* "gofast/tools/mathex.pyx":4995
 *         result[i] = np.mean(data[start:end])
 * 
 *     return result             # <<<<<<<<<<<<<<
 * 
 * def torres_verdin_filter(
 */
  __Pyx_TraceLine(4995,0,__PYX_ERR(0, 4995, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_result);
  __pyx_r = __pyx_v_result;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4947
 *     return x, w  # Return the matrix x and the weights vector w
 * 
 * def adaptive_moving_average(data,  window_size_factor=0.1):             # <<<<<<<<<<<<<<
 *     """ Adaptative moving average as  smoothing technique.
 * 
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_8);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.adaptive_moving_average", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_result);
  __Pyx_XDECREF(__pyx_v_window_size);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_start);
  __Pyx_XDECREF(__pyx_v_end);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_131torres_verdin_filter(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_130torres_verdin_filter, "\n    Calculates the adaptive moving average of a given data array from \n    Torres and Verdin algorithm [1]_. \n    \n    Parameters \n    -----------\n    arr: Arraylike 1d \n      List or array-like of data points.  If two-dimensional array \n      is passed, `axis` must be specified to apply the filter onto. \n       \n    weight_factor: float, default=.1\n      Base smoothing factor for window size which gets adjusted by a factor \n      dependent on the rate of change in the data. \n        \n    beta: float, default =1. \n       Scaling factor to adjust `weight_factor` during high volatility. \n       It controls how much the `weight_factor` is adjusted during \n       periods of high volatility.\n       \n    logify: bool, default=False, \n      By default , Torres uses exponential moving average. So if the \n      values can be logarithmized to ensure the weight be ranged between \n      0 and 1. This is important when data are resistivity or phase. \n      \n    axis: int, default=0 \n      Axis along which to apply the AMA filter.\n    Return \n    -------\n    ama: Adaptive moving average\n    \n    References \n    ------------\n    .. [1] Torres-Verdin and Bostick, 1992,  Principles of spatial surface \n        electric field filtering in magnetotellurics: electromagnetic array profiling\n        (EMAP), Geophysics, v57, p603-622.https://doi.org/10.1190/1.2400625\n\n    Example\n    --------\n    >>> import matplotlib.pyplot as plt \n    >>> from gofast.tools.mathex  import torres_verdin_filter \n    >>> data = np.random.randn(100)  \n    >>> ama = torres_verdin_filter(data)\n    >>> plt.plot (range (len(data)), data, 'k', range(len(data)), ama, '-or')\n    >>> # apply on two dimensional array \n    >>> data2d = np.random.randn(7, 10) \n    >>> ama2d = torres_verdin_filter ( data2d, axis =0)\n    >>> fig, ax  = plt.subplots (nrows = 1, ncols = 2 , sharey= True,\n                             figsize = (7,7) )\n    >>> ax[0].imshow(data2d , label ='Raw ""data', cmap = 'binary' )\n    >>> ax[1].imshow (ama2d,  label = 'AMA data', cmap ='binary' )\n    >>> ax[0].set_title ('Raw data') \n    >>> ax[1].set_title ('AMA data') \n    >>> plt.legend\n    >>> plt.show () \n    \n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_131torres_verdin_filter = {"torres_verdin_filter", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_131torres_verdin_filter, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_130torres_verdin_filter};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_131torres_verdin_filter(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_arr = 0;
  double __pyx_v_weight_factor;
  double __pyx_v_beta;
  PyObject *__pyx_v_logify = 0;
  PyObject *__pyx_v_axis = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("torres_verdin_filter (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_arr,&__pyx_n_s_weight_factor,&__pyx_n_s_beta,&__pyx_n_s_logify,&__pyx_n_s_axis,0};

    /* "gofast/tools/mathex.pyx":5001
 *     weight_factor: float = 0.1,
 *     beta: float = 1.0,
 *     logify: bool = False,             # <<<<<<<<<<<<<<
 *     axis: int = None,
 *     ):
 */
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)Py_False)));

    /* "gofast/tools/mathex.pyx":5002
 *     beta: float = 1.0,
 *     logify: bool = False,
 *     axis: int = None,             # <<<<<<<<<<<<<<
 *     ):
 *     """
 */
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject*)Py_None));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_arr)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4997, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_weight_factor);
          if (value) { values[1] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4997, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_beta);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4997, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_logify);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4997, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_axis);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 4997, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "torres_verdin_filter") < 0)) __PYX_ERR(0, 4997, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_arr = values[0];
    if (values[1]) {
      __pyx_v_weight_factor = __pyx_PyFloat_AsDouble(values[1]); if (unlikely((__pyx_v_weight_factor == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 4999, __pyx_L3_error)
    } else {
      __pyx_v_weight_factor = ((double)((double)0.1));
    }
    if (values[2]) {
      __pyx_v_beta = __pyx_PyFloat_AsDouble(values[2]); if (unlikely((__pyx_v_beta == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 5000, __pyx_L3_error)
    } else {
      __pyx_v_beta = ((double)((double)1.0));
    }
    __pyx_v_logify = values[3];
    __pyx_v_axis = ((PyObject*)values[4]);
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("torres_verdin_filter", 0, 1, 5, __pyx_nargs); __PYX_ERR(0, 4997, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.torres_verdin_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_axis), (&PyInt_Type), 1, "axis", 1))) __PYX_ERR(0, 5002, __pyx_L1_error)
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_130torres_verdin_filter(__pyx_self, __pyx_v_arr, __pyx_v_weight_factor, __pyx_v_beta, __pyx_v_logify, __pyx_v_axis);

  /* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */

  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  __pyx_r = NULL;
  __pyx_L0:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":5064
 *     logify = bool(logify)
 * 
 *     def _filtering_1d_array( ar, wf, b ):             # <<<<<<<<<<<<<<
 *         if len(ar) < 2:
 *             return ar
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_20torres_verdin_filter_1_filtering_1d_array(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_20torres_verdin_filter_1_filtering_1d_array = {"_filtering_1d_array", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_20torres_verdin_filter_1_filtering_1d_array, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_20torres_verdin_filter_1_filtering_1d_array(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_ar = 0;
  PyObject *__pyx_v_wf = 0;
  CYTHON_UNUSED PyObject *__pyx_v_b = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[3] = {0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("_filtering_1d_array (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ar,&__pyx_n_s_wf,&__pyx_n_s_b,0};
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ar)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5064, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_wf)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5064, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_filtering_1d_array", 1, 3, 3, 1); __PYX_ERR(0, 5064, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_b)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[2]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5064, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("_filtering_1d_array", 1, 3, 3, 2); __PYX_ERR(0, 5064, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "_filtering_1d_array") < 0)) __PYX_ERR(0, 5064, __pyx_L3_error)
      }
    } else if (unlikely(__pyx_nargs != 3)) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
    }
    __pyx_v_ar = values[0];
    __pyx_v_wf = values[1];
    __pyx_v_b = values[2];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("_filtering_1d_array", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 5064, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.torres_verdin_filter._filtering_1d_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_20torres_verdin_filter__filtering_1d_array(__pyx_self, __pyx_v_ar, __pyx_v_wf, __pyx_v_b);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_20torres_verdin_filter__filtering_1d_array(PyObject *__pyx_self, PyObject *__pyx_v_ar, PyObject *__pyx_v_wf, CYTHON_UNUSED PyObject *__pyx_v_b) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *__pyx_cur_scope;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *__pyx_outer_scope;
  PyObject *__pyx_v_ama = NULL;
  PyObject *__pyx_v_i = NULL;
  PyObject *__pyx_v_change = NULL;
  PyObject *__pyx_v_w = NULL;
  PyObject *__pyx_v_ama_value = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  Py_ssize_t __pyx_t_1;
  int __pyx_t_2;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  PyObject *(*__pyx_t_5)(PyObject *);
  PyObject *__pyx_t_6 = NULL;
  PyObject *__pyx_t_7 = NULL;
  long __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  int __pyx_t_10;
  int __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("_filtering_1d_array", 1);
  __pyx_outer_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *) __Pyx_CyFunction_GetClosure(__pyx_self);
  __pyx_cur_scope = __pyx_outer_scope;
  __Pyx_TraceCall("_filtering_1d_array", __pyx_f[0], 5064, 0, __PYX_ERR(0, 5064, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":5065
 * 
 *     def _filtering_1d_array( ar, wf, b ):
 *         if len(ar) < 2:             # <<<<<<<<<<<<<<
 *             return ar
 *         ama = [ar[0]]  # Initialize the adaptive moving average array
 */
  __Pyx_TraceLine(5065,0,__PYX_ERR(0, 5065, __pyx_L1_error))
  __pyx_t_1 = PyObject_Length(__pyx_v_ar); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 5065, __pyx_L1_error)
  __pyx_t_2 = (__pyx_t_1 < 2);
  if (__pyx_t_2) {

    /* "gofast/tools/mathex.pyx":5066
 *     def _filtering_1d_array( ar, wf, b ):
 *         if len(ar) < 2:
 *             return ar             # <<<<<<<<<<<<<<
 *         ama = [ar[0]]  # Initialize the adaptive moving average array
 *         for i in range(1, len(ar)):
 */
    __Pyx_TraceLine(5066,0,__PYX_ERR(0, 5066, __pyx_L1_error))
    __Pyx_XDECREF(__pyx_r);
    __Pyx_INCREF(__pyx_v_ar);
    __pyx_r = __pyx_v_ar;
    goto __pyx_L0;

    /* "gofast/tools/mathex.pyx":5065
 * 
 *     def _filtering_1d_array( ar, wf, b ):
 *         if len(ar) < 2:             # <<<<<<<<<<<<<<
 *             return ar
 *         ama = [ar[0]]  # Initialize the adaptive moving average array
 */
  }

  /* "gofast/tools/mathex.pyx":5067
 *         if len(ar) < 2:
 *             return ar
 *         ama = [ar[0]]  # Initialize the adaptive moving average array             # <<<<<<<<<<<<<<
 *         for i in range(1, len(ar)):
 *             change = abs(ar[i] - ar[i-1])
 */
  __Pyx_TraceLine(5067,0,__PYX_ERR(0, 5067, __pyx_L1_error))
  __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_ar, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5067, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_4 = PyList_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5067, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_3);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 0, __pyx_t_3)) __PYX_ERR(0, 5067, __pyx_L1_error);
  __pyx_t_3 = 0;
  __pyx_v_ama = ((PyObject*)__pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":5068
 *             return ar
 *         ama = [ar[0]]  # Initialize the adaptive moving average array
 *         for i in range(1, len(ar)):             # <<<<<<<<<<<<<<
 *             change = abs(ar[i] - ar[i-1])
 *             w = wf * (1 + beta * change)
 */
  __Pyx_TraceLine(5068,0,__PYX_ERR(0, 5068, __pyx_L1_error))
  __pyx_t_1 = PyObject_Length(__pyx_v_ar); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 5068, __pyx_L1_error)
  __pyx_t_4 = PyInt_FromSsize_t(__pyx_t_1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5068, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyTuple_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5068, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_int_1)) __PYX_ERR(0, 5068, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4)) __PYX_ERR(0, 5068, __pyx_L1_error);
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_3, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5068, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (likely(PyList_CheckExact(__pyx_t_4)) || PyTuple_CheckExact(__pyx_t_4)) {
    __pyx_t_3 = __pyx_t_4; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_1 = 0;
    __pyx_t_5 = NULL;
  } else {
    __pyx_t_1 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5068, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_5 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 5068, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  for (;;) {
    if (likely(!__pyx_t_5)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 5068, __pyx_L1_error)
          #endif
          if (__pyx_t_1 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_4); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 5068, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5068, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 5068, __pyx_L1_error)
          #endif
          if (__pyx_t_1 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_4); __pyx_t_1++; if (unlikely((0 < 0))) __PYX_ERR(0, 5068, __pyx_L1_error)
        #else
        __pyx_t_4 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5068, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_4);
        #endif
      }
    } else {
      __pyx_t_4 = __pyx_t_5(__pyx_t_3);
      if (unlikely(!__pyx_t_4)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 5068, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_4);
    }
    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":5069
 *         ama = [ar[0]]  # Initialize the adaptive moving average array
 *         for i in range(1, len(ar)):
 *             change = abs(ar[i] - ar[i-1])             # <<<<<<<<<<<<<<
 *             w = wf * (1 + beta * change)
 *             w = min(w, 1)  # Ensure weight stays between 0 and 1
 */
    __Pyx_TraceLine(5069,0,__PYX_ERR(0, 5069, __pyx_L1_error))
    __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_v_ar, __pyx_v_i); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5069, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_6 = __Pyx_PyInt_SubtractObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5069, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = __Pyx_PyObject_GetItem(__pyx_v_ar, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5069, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_Subtract(__pyx_t_4, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5069, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyNumber_Absolute(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5069, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_XDECREF_SET(__pyx_v_change, __pyx_t_7);
    __pyx_t_7 = 0;

    /* "gofast/tools/mathex.pyx":5070
 *         for i in range(1, len(ar)):
 *             change = abs(ar[i] - ar[i-1])
 *             w = wf * (1 + beta * change)             # <<<<<<<<<<<<<<
 *             w = min(w, 1)  # Ensure weight stays between 0 and 1
 *             ama_value = w * ar[i] + (1 - w) * ama[-1]
 */
    __Pyx_TraceLine(5070,0,__PYX_ERR(0, 5070, __pyx_L1_error))
    __pyx_t_7 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_beta); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __pyx_t_6 = PyNumber_Multiply(__pyx_t_7, __pyx_v_change); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = __Pyx_PyInt_AddCObj(__pyx_int_1, __pyx_t_6, 1, 0, 0); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = PyNumber_Multiply(__pyx_v_wf, __pyx_t_7); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5070, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_XDECREF_SET(__pyx_v_w, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":5071
 *             change = abs(ar[i] - ar[i-1])
 *             w = wf * (1 + beta * change)
 *             w = min(w, 1)  # Ensure weight stays between 0 and 1             # <<<<<<<<<<<<<<
 *             ama_value = w * ar[i] + (1 - w) * ama[-1]
 *             ama.append(ama_value)
 */
    __Pyx_TraceLine(5071,0,__PYX_ERR(0, 5071, __pyx_L1_error))
    __pyx_t_8 = 1;
    __Pyx_INCREF(__pyx_v_w);
    __pyx_t_6 = __pyx_v_w;
    __pyx_t_4 = __Pyx_PyInt_From_long(__pyx_t_8); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5071, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __pyx_t_9 = PyObject_RichCompare(__pyx_t_4, __pyx_t_6, Py_LT); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5071, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 5071, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_2) {
      __pyx_t_9 = __Pyx_PyInt_From_long(__pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5071, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __pyx_t_7 = __pyx_t_9;
      __pyx_t_9 = 0;
    } else {
      __Pyx_INCREF(__pyx_t_6);
      __pyx_t_7 = __pyx_t_6;
    }
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __pyx_t_7;
    __Pyx_INCREF(__pyx_t_6);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF_SET(__pyx_v_w, __pyx_t_6);
    __pyx_t_6 = 0;

    /* "gofast/tools/mathex.pyx":5072
 *             w = wf * (1 + beta * change)
 *             w = min(w, 1)  # Ensure weight stays between 0 and 1
 *             ama_value = w * ar[i] + (1 - w) * ama[-1]             # <<<<<<<<<<<<<<
 *             ama.append(ama_value)
 * 
 */
    __Pyx_TraceLine(5072,0,__PYX_ERR(0, 5072, __pyx_L1_error))
    __pyx_t_6 = __Pyx_PyObject_GetItem(__pyx_v_ar, __pyx_v_i); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_7 = PyNumber_Multiply(__pyx_v_w, __pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_7);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __pyx_t_6 = __Pyx_PyInt_SubtractCObj(__pyx_int_1, __pyx_v_w, 1, 0, 0); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 5072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_6);
    __pyx_t_9 = __Pyx_GetItemInt_List(__pyx_v_ama, -1L, long, 1, __Pyx_PyInt_From_long, 1, 1, 1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __pyx_t_4 = PyNumber_Multiply(__pyx_t_6, __pyx_t_9); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __pyx_t_9 = PyNumber_Add(__pyx_t_7, __pyx_t_4); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5072, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
    __Pyx_XDECREF_SET(__pyx_v_ama_value, __pyx_t_9);
    __pyx_t_9 = 0;

    /* "gofast/tools/mathex.pyx":5073
 *             w = min(w, 1)  # Ensure weight stays between 0 and 1
 *             ama_value = w * ar[i] + (1 - w) * ama[-1]
 *             ama.append(ama_value)             # <<<<<<<<<<<<<<
 * 
 *         return np.array(ama)
 */
    __Pyx_TraceLine(5073,0,__PYX_ERR(0, 5073, __pyx_L1_error))
    __pyx_t_10 = __Pyx_PyList_Append(__pyx_v_ama, __pyx_v_ama_value); if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 5073, __pyx_L1_error)

    /* "gofast/tools/mathex.pyx":5068
 *             return ar
 *         ama = [ar[0]]  # Initialize the adaptive moving average array
 *         for i in range(1, len(ar)):             # <<<<<<<<<<<<<<
 *             change = abs(ar[i] - ar[i-1])
 *             w = wf * (1 + beta * change)
 */
    __Pyx_TraceLine(5068,0,__PYX_ERR(0, 5068, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":5075
 *             ama.append(ama_value)
 * 
 *         return np.array(ama)             # <<<<<<<<<<<<<<
 * 
 *     arr =np.array (arr )
 */
  __Pyx_TraceLine(5075,0,__PYX_ERR(0, 5075, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_GetModuleGlobalName(__pyx_t_9, __pyx_n_s_np); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5075, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_9);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_9, __pyx_n_s_array_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5075, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
  __pyx_t_9 = NULL;
  __pyx_t_11 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_4))) {
    __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
    if (likely(__pyx_t_9)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
      __Pyx_INCREF(__pyx_t_9);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_4, function);
      __pyx_t_11 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_9, __pyx_v_ama};
    __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_11, 1+__pyx_t_11);
    __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5075, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  }
  __pyx_r = __pyx_t_3;
  __pyx_t_3 = 0;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":5064
 *     logify = bool(logify)
 * 
 *     def _filtering_1d_array( ar, wf, b ):             # <<<<<<<<<<<<<<
 *         if len(ar) < 2:
 *             return ar
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_6);
  __Pyx_XDECREF(__pyx_t_7);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.torres_verdin_filter._filtering_1d_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_ama);
  __Pyx_XDECREF(__pyx_v_i);
  __Pyx_XDECREF(__pyx_v_change);
  __Pyx_XDECREF(__pyx_v_w);
  __Pyx_XDECREF(__pyx_v_ama_value);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */

static PyObject *__pyx_pf_6gofast_5tools_6mathex_130torres_verdin_filter(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_arr, double __pyx_v_weight_factor, double __pyx_v_beta, PyObject *__pyx_v_logify, PyObject *__pyx_v_axis) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *__pyx_cur_scope;
  PyObject *__pyx_v__filtering_1d_array = 0;
  Py_ssize_t __pyx_v_ii;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_t_5;
  int __pyx_t_6;
  Py_ssize_t __pyx_t_7;
  Py_UCS4 __pyx_t_8;
  PyObject *__pyx_t_9 = NULL;
  Py_ssize_t __pyx_t_10;
  Py_ssize_t __pyx_t_11;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__146)
  __Pyx_RefNannySetupContext("torres_verdin_filter", 0);
  __pyx_cur_scope = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *)Py_None);
    __Pyx_INCREF(Py_None);
    __PYX_ERR(0, 4997, __pyx_L1_error)
  } else {
    __Pyx_GOTREF((PyObject *)__pyx_cur_scope);
  }
  __Pyx_TraceCall("torres_verdin_filter", __pyx_f[0], 4997, 0, __PYX_ERR(0, 4997, __pyx_L1_error));
  __pyx_cur_scope->__pyx_v_beta = __pyx_v_beta;
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_INCREF(__pyx_v_logify);
  __Pyx_INCREF(__pyx_v_axis);

  /* "gofast/tools/mathex.pyx":5060
 * 
 *     """
 *     arr = is_iterable(arr, exclude_string=True, transform=True)             # <<<<<<<<<<<<<<
 *     axis = 0 if axis is None else axis  # Set default axis to 0 if not specified
 *     logify = bool(logify)
 */
  __Pyx_TraceLine(5060,0,__PYX_ERR(0, 5060, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_is_iterable); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5060, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5060, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_v_arr);
  __Pyx_GIVEREF(__pyx_v_arr);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_v_arr)) __PYX_ERR(0, 5060, __pyx_L1_error);
  __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5060, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_exclude_string, Py_True) < 0) __PYX_ERR(0, 5060, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_transform, Py_True) < 0) __PYX_ERR(0, 5060, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyObject_Call(__pyx_t_1, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5060, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":5061
 *     """
 *     arr = is_iterable(arr, exclude_string=True, transform=True)
 *     axis = 0 if axis is None else axis  # Set default axis to 0 if not specified             # <<<<<<<<<<<<<<
 *     logify = bool(logify)
 * 
 */
  __Pyx_TraceLine(5061,0,__PYX_ERR(0, 5061, __pyx_L1_error))
  __pyx_t_5 = (__pyx_v_axis == ((PyObject*)Py_None));
  if (__pyx_t_5) {
    if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_0)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_0))) __PYX_ERR(0, 5061, __pyx_L1_error)
    __Pyx_INCREF(__pyx_int_0);
    __pyx_t_4 = __pyx_int_0;
  } else {
    __Pyx_INCREF(__pyx_v_axis);
    __pyx_t_4 = __pyx_v_axis;
  }
  __Pyx_DECREF_SET(__pyx_v_axis, ((PyObject*)__pyx_t_4));
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":5062
 *     arr = is_iterable(arr, exclude_string=True, transform=True)
 *     axis = 0 if axis is None else axis  # Set default axis to 0 if not specified
 *     logify = bool(logify)             # <<<<<<<<<<<<<<
 * 
 *     def _filtering_1d_array( ar, wf, b ):
 */
  __Pyx_TraceLine(5062,0,__PYX_ERR(0, 5062, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_logify); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 5062, __pyx_L1_error)
  __pyx_t_4 = __Pyx_PyBool_FromLong((!(!__pyx_t_5))); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5062, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF_SET(__pyx_v_logify, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":5064
 *     logify = bool(logify)
 * 
 *     def _filtering_1d_array( ar, wf, b ):             # <<<<<<<<<<<<<<
 *         if len(ar) < 2:
 *             return ar
 */
  __Pyx_TraceLine(5064,0,__PYX_ERR(0, 5064, __pyx_L1_error))
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_20torres_verdin_filter_1_filtering_1d_array, 0, __pyx_n_s_torres_verdin_filter_locals__fil, ((PyObject*)__pyx_cur_scope), __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__148)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5064, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_v__filtering_1d_array = __pyx_t_4;
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":5077
 *         return np.array(ama)
 * 
 *     arr =np.array (arr )             # <<<<<<<<<<<<<<
 *     #+++++++++++++++++++
 *     if logify:
 */
  __Pyx_TraceLine(5077,0,__PYX_ERR(0, 5077, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5077, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_array_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5077, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_2))) {
    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_3, __pyx_v_arr};
    __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5077, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_4);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  }
  __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_4);
  __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":5079
 *     arr =np.array (arr )
 *     #+++++++++++++++++++
 *     if logify:             # <<<<<<<<<<<<<<
 *         arr = np.log10 ( arr )
 *     if arr.ndim >=2:
 */
  __Pyx_TraceLine(5079,0,__PYX_ERR(0, 5079, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_logify); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 5079, __pyx_L1_error)
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":5080
 *     #+++++++++++++++++++
 *     if logify:
 *         arr = np.log10 ( arr )             # <<<<<<<<<<<<<<
 *     if arr.ndim >=2:
 *         if axis is None:
 */
    __Pyx_TraceLine(5080,0,__PYX_ERR(0, 5080, __pyx_L1_error))
    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5080, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_log10); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5080, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_3))) {
      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
      if (likely(__pyx_t_2)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
        __Pyx_INCREF(__pyx_t_2);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_3, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_2, __pyx_v_arr};
      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5080, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_4);
    __pyx_t_4 = 0;

    /* "gofast/tools/mathex.pyx":5079
 *     arr =np.array (arr )
 *     #+++++++++++++++++++
 *     if logify:             # <<<<<<<<<<<<<<
 *         arr = np.log10 ( arr )
 *     if arr.ndim >=2:
 */
  }

  /* "gofast/tools/mathex.pyx":5081
 *     if logify:
 *         arr = np.log10 ( arr )
 *     if arr.ndim >=2:             # <<<<<<<<<<<<<<
 *         if axis is None:
 *             warnings.warn (f"Array dimension is {arr.ndim}. Axis must be"
 */
  __Pyx_TraceLine(5081,0,__PYX_ERR(0, 5081, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_ndim); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5081, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_3 = PyObject_RichCompare(__pyx_t_4, __pyx_int_2, Py_GE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5081, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 5081, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (__pyx_t_5) {

    /* "gofast/tools/mathex.pyx":5082
 *         arr = np.log10 ( arr )
 *     if arr.ndim >=2:
 *         if axis is None:             # <<<<<<<<<<<<<<
 *             warnings.warn (f"Array dimension is {arr.ndim}. Axis must be"
 *                            " specified. Otherwise axis=0 is used .")
 */
    __Pyx_TraceLine(5082,0,__PYX_ERR(0, 5082, __pyx_L1_error))
    __pyx_t_5 = (__pyx_v_axis == ((PyObject*)Py_None));
    if (__pyx_t_5) {

      /* "gofast/tools/mathex.pyx":5083
 *     if arr.ndim >=2:
 *         if axis is None:
 *             warnings.warn (f"Array dimension is {arr.ndim}. Axis must be"             # <<<<<<<<<<<<<<
 *                            " specified. Otherwise axis=0 is used .")
 *             axis =0
 */
      __Pyx_TraceLine(5083,0,__PYX_ERR(0, 5083, __pyx_L1_error))
      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_warnings); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5083, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_warn); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5083, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5083, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_4);
      __pyx_t_7 = 0;
      __pyx_t_8 = 127;
      __Pyx_INCREF(__pyx_kp_u_Array_dimension_is);
      __pyx_t_7 += 19;
      __Pyx_GIVEREF(__pyx_kp_u_Array_dimension_is);
      PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_Array_dimension_is);
      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_ndim); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5083, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __pyx_t_9 = __Pyx_PyObject_FormatSimple(__pyx_t_1, __pyx_empty_unicode); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5083, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_8 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_9) > __pyx_t_8) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_9) : __pyx_t_8;
      __pyx_t_7 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_9);
      __Pyx_GIVEREF(__pyx_t_9);
      PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_9);
      __pyx_t_9 = 0;
      __Pyx_INCREF(__pyx_kp_u_Axis_must_be_specified_Otherwis);
      __pyx_t_7 += 52;
      __Pyx_GIVEREF(__pyx_kp_u_Axis_must_be_specified_Otherwis);
      PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u_Axis_must_be_specified_Otherwis);
      __pyx_t_9 = __Pyx_PyUnicode_Join(__pyx_t_4, 3, __pyx_t_7, __pyx_t_8); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5083, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = NULL;
      __pyx_t_6 = 0;
      #if CYTHON_UNPACK_METHODS
      if (unlikely(PyMethod_Check(__pyx_t_2))) {
        __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
        if (likely(__pyx_t_4)) {
          PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
          __Pyx_INCREF(__pyx_t_4);
          __Pyx_INCREF(function);
          __Pyx_DECREF_SET(__pyx_t_2, function);
          __pyx_t_6 = 1;
        }
      }
      #endif
      {
        PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_t_9};
        __pyx_t_3 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
        __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
        __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
        if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5083, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_3);
        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      }
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":5085
 *             warnings.warn (f"Array dimension is {arr.ndim}. Axis must be"
 *                            " specified. Otherwise axis=0 is used .")
 *             axis =0             # <<<<<<<<<<<<<<
 *         if axis ==0:
 *             arr = arr._T
 */
      __Pyx_TraceLine(5085,0,__PYX_ERR(0, 5085, __pyx_L1_error))
      if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_0)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_0))) __PYX_ERR(0, 5085, __pyx_L1_error)
      __pyx_t_3 = __pyx_int_0;
      __Pyx_INCREF(__pyx_t_3);
      __Pyx_DECREF_SET(__pyx_v_axis, ((PyObject*)__pyx_t_3));
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":5082
 *         arr = np.log10 ( arr )
 *     if arr.ndim >=2:
 *         if axis is None:             # <<<<<<<<<<<<<<
 *             warnings.warn (f"Array dimension is {arr.ndim}. Axis must be"
 *                            " specified. Otherwise axis=0 is used .")
 */
    }

    /* "gofast/tools/mathex.pyx":5086
 *                            " specified. Otherwise axis=0 is used .")
 *             axis =0
 *         if axis ==0:             # <<<<<<<<<<<<<<
 *             arr = arr._T
 *         for ii in range( len(arr )) :
 */
    __Pyx_TraceLine(5086,0,__PYX_ERR(0, 5086, __pyx_L1_error))
    __pyx_t_3 = PyObject_RichCompare(__pyx_v_axis, __pyx_int_0, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5086, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 5086, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    if (__pyx_t_5) {

      /* "gofast/tools/mathex.pyx":5087
 *             axis =0
 *         if axis ==0:
 *             arr = arr._T             # <<<<<<<<<<<<<<
 *         for ii in range( len(arr )) :
 *             arr [ii] = _filtering_1d_array (
 */
      __Pyx_TraceLine(5087,0,__PYX_ERR(0, 5087, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_T); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5087, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_3);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":5086
 *                            " specified. Otherwise axis=0 is used .")
 *             axis =0
 *         if axis ==0:             # <<<<<<<<<<<<<<
 *             arr = arr._T
 *         for ii in range( len(arr )) :
 */
    }

    /* "gofast/tools/mathex.pyx":5088
 *         if axis ==0:
 *             arr = arr._T
 *         for ii in range( len(arr )) :             # <<<<<<<<<<<<<<
 *             arr [ii] = _filtering_1d_array (
 *                 arr [ii ], wf = weight_factor, b = beta )
 */
    __Pyx_TraceLine(5088,0,__PYX_ERR(0, 5088, __pyx_L1_error))
    __pyx_t_7 = PyObject_Length(__pyx_v_arr); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 5088, __pyx_L1_error)
    __pyx_t_10 = __pyx_t_7;
    for (__pyx_t_11 = 0; __pyx_t_11 < __pyx_t_10; __pyx_t_11+=1) {
      __pyx_v_ii = __pyx_t_11;

      /* "gofast/tools/mathex.pyx":5090
 *         for ii in range( len(arr )) :
 *             arr [ii] = _filtering_1d_array (
 *                 arr [ii ], wf = weight_factor, b = beta )             # <<<<<<<<<<<<<<
 *         # then transpose again
 *         if axis ==0:
 */
      __Pyx_TraceLine(5090,0,__PYX_ERR(0, 5090, __pyx_L1_error))
      __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_arr, __pyx_v_ii, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5090, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);

      /* "gofast/tools/mathex.pyx":5089
 *             arr = arr._T
 *         for ii in range( len(arr )) :
 *             arr [ii] = _filtering_1d_array (             # <<<<<<<<<<<<<<
 *                 arr [ii ], wf = weight_factor, b = beta )
 *         # then transpose again
 */
      __Pyx_TraceLine(5089,0,__PYX_ERR(0, 5089, __pyx_L1_error))
      __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5089, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_GIVEREF(__pyx_t_3);
      if (__Pyx_PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_3)) __PYX_ERR(0, 5089, __pyx_L1_error);
      __pyx_t_3 = 0;

      /* "gofast/tools/mathex.pyx":5090
 *         for ii in range( len(arr )) :
 *             arr [ii] = _filtering_1d_array (
 *                 arr [ii ], wf = weight_factor, b = beta )             # <<<<<<<<<<<<<<
 *         # then transpose again
 *         if axis ==0:
 */
      __Pyx_TraceLine(5090,0,__PYX_ERR(0, 5090, __pyx_L1_error))
      __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5090, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_3);
      __pyx_t_9 = PyFloat_FromDouble(__pyx_v_weight_factor); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5090, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_wf, __pyx_t_9) < 0) __PYX_ERR(0, 5090, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
      __pyx_t_9 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_beta); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5090, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_b, __pyx_t_9) < 0) __PYX_ERR(0, 5090, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":5089
 *             arr = arr._T
 *         for ii in range( len(arr )) :
 *             arr [ii] = _filtering_1d_array (             # <<<<<<<<<<<<<<
 *                 arr [ii ], wf = weight_factor, b = beta )
 *         # then transpose again
 */
      __Pyx_TraceLine(5089,0,__PYX_ERR(0, 5089, __pyx_L1_error))
      __pyx_t_9 = __Pyx_PyObject_Call(__pyx_v__filtering_1d_array, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5089, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely((__Pyx_SetItemInt(__pyx_v_arr, __pyx_v_ii, __pyx_t_9, Py_ssize_t, 1, PyInt_FromSsize_t, 0, 1, 1) < 0))) __PYX_ERR(0, 5089, __pyx_L1_error)
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }

    /* "gofast/tools/mathex.pyx":5092
 *                 arr [ii ], wf = weight_factor, b = beta )
 *         # then transpose again
 *         if axis ==0:             # <<<<<<<<<<<<<<
 *             arr = arr._T
 *     else:
 */
    __Pyx_TraceLine(5092,0,__PYX_ERR(0, 5092, __pyx_L1_error))
    __pyx_t_9 = PyObject_RichCompare(__pyx_v_axis, __pyx_int_0, Py_EQ); __Pyx_XGOTREF(__pyx_t_9); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5092, __pyx_L1_error)
    __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 5092, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    if (__pyx_t_5) {

      /* "gofast/tools/mathex.pyx":5093
 *         # then transpose again
 *         if axis ==0:
 *             arr = arr._T             # <<<<<<<<<<<<<<
 *     else:
 *         arr = _filtering_1d_array ( arr, wf = weight_factor, b=beta  )
 */
      __Pyx_TraceLine(5093,0,__PYX_ERR(0, 5093, __pyx_L1_error))
      __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_v_arr, __pyx_n_s_T); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5093, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_9);
      __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_9);
      __pyx_t_9 = 0;

      /* "gofast/tools/mathex.pyx":5092
 *                 arr [ii ], wf = weight_factor, b = beta )
 *         # then transpose again
 *         if axis ==0:             # <<<<<<<<<<<<<<
 *             arr = arr._T
 *     else:
 */
    }

    /* "gofast/tools/mathex.pyx":5081
 *     if logify:
 *         arr = np.log10 ( arr )
 *     if arr.ndim >=2:             # <<<<<<<<<<<<<<
 *         if axis is None:
 *             warnings.warn (f"Array dimension is {arr.ndim}. Axis must be"
 */
    goto __pyx_L4;
  }

  /* "gofast/tools/mathex.pyx":5095
 *             arr = arr._T
 *     else:
 *         arr = _filtering_1d_array ( arr, wf = weight_factor, b=beta  )             # <<<<<<<<<<<<<<
 * 
 *     if logify: arr = np.power (10, arr )
 */
  __Pyx_TraceLine(5095,0,__PYX_ERR(0, 5095, __pyx_L1_error))
  /*else*/ {
    __pyx_t_9 = PyTuple_New(1); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_INCREF(__pyx_v_arr);
    __Pyx_GIVEREF(__pyx_v_arr);
    if (__Pyx_PyTuple_SET_ITEM(__pyx_t_9, 0, __pyx_v_arr)) __PYX_ERR(0, 5095, __pyx_L1_error);
    __pyx_t_3 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_2 = PyFloat_FromDouble(__pyx_v_weight_factor); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_wf, __pyx_t_2) < 0) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = PyFloat_FromDouble(__pyx_cur_scope->__pyx_v_beta); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_b, __pyx_t_2) < 0) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_v__filtering_1d_array, __pyx_t_9, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5095, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_2);
    __pyx_t_2 = 0;
  }
  __pyx_L4:;

  /* "gofast/tools/mathex.pyx":5097
 *         arr = _filtering_1d_array ( arr, wf = weight_factor, b=beta  )
 * 
 *     if logify: arr = np.power (10, arr )             # <<<<<<<<<<<<<<
 * 
 *     return arr
 */
  __Pyx_TraceLine(5097,0,__PYX_ERR(0, 5097, __pyx_L1_error))
  __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_v_logify); if (unlikely((__pyx_t_5 < 0))) __PYX_ERR(0, 5097, __pyx_L1_error)
  if (__pyx_t_5) {
    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_np); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_power); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 5097, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_9);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_9))) {
      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_9);
      if (likely(__pyx_t_3)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_9);
        __Pyx_INCREF(__pyx_t_3);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_9, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_3, __pyx_int_10, __pyx_v_arr};
      __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_9, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5097, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_2);
      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
    }
    __Pyx_DECREF_SET(__pyx_v_arr, __pyx_t_2);
    __pyx_t_2 = 0;
  }

  /* "gofast/tools/mathex.pyx":5099
 *     if logify: arr = np.power (10, arr )
 * 
 *     return arr             # <<<<<<<<<<<<<<
 * 
 * def gradient_boosting_regressor(
 */
  __Pyx_TraceLine(5099,0,__PYX_ERR(0, 5099, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_arr);
  __pyx_r = __pyx_v_arr;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  __Pyx_XDECREF(__pyx_t_9);
  __Pyx_AddTraceback("gofast.tools.mathex.torres_verdin_filter", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v__filtering_1d_array);
  __Pyx_XDECREF(__pyx_v_arr);
  __Pyx_XDECREF(__pyx_v_logify);
  __Pyx_XDECREF(__pyx_v_axis);
  __Pyx_DECREF((PyObject *)__pyx_cur_scope);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

/* "gofast/tools/mathex.pyx":5101
 *     return arr
 * 
 * def gradient_boosting_regressor(             # <<<<<<<<<<<<<<
 *         X, y, n_estimators=100, learning_rate=0.1, max_depth=1):
 *     """
 */

/* Python wrapper */
static PyObject *__pyx_pw_6gofast_5tools_6mathex_133gradient_boosting_regressor(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
); /*proto*/
PyDoc_STRVAR(__pyx_doc_6gofast_5tools_6mathex_132gradient_boosting_regressor, "\n    Implement a simple version of Gradient Boosting Regressor.\n\n    Gradient Boosting builds an additive model in a forward stage-wise fashion. \n    At each stage, regression trees are fit on the negative gradient of the loss function.\n\n    Parameters\n    ----------\n    X : ndarray of shape (n_samples, n_features)\n        The input samples.\n    y : ndarray of shape (n_samples,)\n        The target values (real numbers).\n    n_estimators : int, default=100\n        The number of boosting stages to be run.\n    learning_rate : float, default=0.1\n        Learning rate shrinks the contribution of each tree by `learning_rate`.\n    max_depth : int, default=1\n        The maximum depth of the individual regression estimators.\n\n    Returns\n    -------\n    y_pred : ndarray of shape (n_samples,)\n        The predicted values.\n\n    Mathematical Formula\n    --------------------\n    Given a differentiable loss function L(y, F(x)), the general idea is \n    to iteratively construct additive models as follows:\n    \n    .. math:: \n        F_{m}(x) = F_{m-1}(x) + \\gamma_{m} h_{m}(x)\n\n    where F_{m} is the model at iteration m, \\gamma_{m} is the step size,\n    and h_{m} is the weak learner.\n\n    Notes\n    -----\n    Gradient Boosting is widely used in machine learning for regression and \n    classification problems. It's effective in scenarios where data is not \n    linearly separable.\n\n    References\n    ----------\n    - J. H. Friedman, \"Greedy Function Approximation: A Gradient Boosting Machine,\" 1999.\n    - T. Hastie, R. Tibshirani, and J. Friedman, \"The Elements of Statistical Learning,\" Springer, 2009.\n\n    Examples\n    --------\n    >>> from sklearn.datasets import make_regression\n    >>> X, y = make_regression(n_samples=100, n_features=1, noise=10)\n    >>> y_pred = gradient_boosting_regressor(X, y, n_estimators=100,\n                                             learning_rate=0.1)\n    >>> print(y_pred[:5])\n    ");
static PyMethodDef __pyx_mdef_6gofast_5tools_6mathex_133gradient_boosting_regressor = {"gradient_boosting_regressor", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_6gofast_5tools_6mathex_133gradient_boosting_regressor, __Pyx_METH_FASTCALL|METH_KEYWORDS, __pyx_doc_6gofast_5tools_6mathex_132gradient_boosting_regressor};
static PyObject *__pyx_pw_6gofast_5tools_6mathex_133gradient_boosting_regressor(PyObject *__pyx_self, 
#if CYTHON_METH_FASTCALL
PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
#else
PyObject *__pyx_args, PyObject *__pyx_kwds
#endif
) {
  PyObject *__pyx_v_X = 0;
  PyObject *__pyx_v_y = 0;
  PyObject *__pyx_v_n_estimators = 0;
  PyObject *__pyx_v_learning_rate = 0;
  CYTHON_UNUSED PyObject *__pyx_v_max_depth = 0;
  #if !CYTHON_METH_FASTCALL
  CYTHON_UNUSED Py_ssize_t __pyx_nargs;
  #endif
  CYTHON_UNUSED PyObject *const *__pyx_kwvalues;
  PyObject* values[5] = {0,0,0,0,0};
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  PyObject *__pyx_r = 0;
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("gradient_boosting_regressor (wrapper)", 0);
  #if !CYTHON_METH_FASTCALL
  #if CYTHON_ASSUME_SAFE_MACROS
  __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
  #else
  __pyx_nargs = PyTuple_Size(__pyx_args); if (unlikely(__pyx_nargs < 0)) return NULL;
  #endif
  #endif
  __pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
  {
    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_X,&__pyx_n_s_y,&__pyx_n_s_n_estimators,&__pyx_n_s_learning_rate,&__pyx_n_s_max_depth,0};
    values[2] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_100)));
    values[3] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject*)__pyx_float_0_1)));
    values[4] = __Pyx_Arg_NewRef_FASTCALL(((PyObject *)((PyObject *)__pyx_int_1)));
    if (__pyx_kwds) {
      Py_ssize_t kw_args;
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
      switch (__pyx_nargs) {
        case  0:
        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_X)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[0]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5101, __pyx_L3_error)
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_y)) != 0)) {
          (void)__Pyx_Arg_NewRef_FASTCALL(values[1]);
          kw_args--;
        }
        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5101, __pyx_L3_error)
        else {
          __Pyx_RaiseArgtupleInvalid("gradient_boosting_regressor", 0, 2, 5, 1); __PYX_ERR(0, 5101, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_n_estimators);
          if (value) { values[2] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5101, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_learning_rate);
          if (value) { values[3] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5101, __pyx_L3_error)
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args > 0) {
          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_max_depth);
          if (value) { values[4] = __Pyx_Arg_NewRef_FASTCALL(value); kw_args--; }
          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 5101, __pyx_L3_error)
        }
      }
      if (unlikely(kw_args > 0)) {
        const Py_ssize_t kwd_pos_args = __pyx_nargs;
        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "gradient_boosting_regressor") < 0)) __PYX_ERR(0, 5101, __pyx_L3_error)
      }
    } else {
      switch (__pyx_nargs) {
        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_X = values[0];
    __pyx_v_y = values[1];
    __pyx_v_n_estimators = values[2];
    __pyx_v_learning_rate = values[3];
    __pyx_v_max_depth = values[4];
  }
  goto __pyx_L6_skip;
  __pyx_L5_argtuple_error:;
  __Pyx_RaiseArgtupleInvalid("gradient_boosting_regressor", 0, 2, 5, __pyx_nargs); __PYX_ERR(0, 5101, __pyx_L3_error)
  __pyx_L6_skip:;
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L3_error:;
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_AddTraceback("gofast.tools.mathex.gradient_boosting_regressor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __Pyx_RefNannyFinishContext();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6gofast_5tools_6mathex_132gradient_boosting_regressor(__pyx_self, __pyx_v_X, __pyx_v_y, __pyx_v_n_estimators, __pyx_v_learning_rate, __pyx_v_max_depth);

  /* function exit code */
  {
    Py_ssize_t __pyx_temp;
    for (__pyx_temp=0; __pyx_temp < (Py_ssize_t)(sizeof(values)/sizeof(values[0])); ++__pyx_temp) {
      __Pyx_Arg_XDECREF_FASTCALL(values[__pyx_temp]);
    }
  }
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static PyObject *__pyx_pf_6gofast_5tools_6mathex_132gradient_boosting_regressor(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_X, PyObject *__pyx_v_y, PyObject *__pyx_v_n_estimators, PyObject *__pyx_v_learning_rate, CYTHON_UNUSED PyObject *__pyx_v_max_depth) {
  PyObject *__pyx_v_DecisionStumpRegressor = NULL;
  PyObject *__pyx_v_F_m = NULL;
  CYTHON_UNUSED PyObject *__pyx_v_m = NULL;
  PyObject *__pyx_v_residual = NULL;
  PyObject *__pyx_v_stump = NULL;
  PyObject *__pyx_r = NULL;
  __Pyx_TraceDeclarations
  __Pyx_RefNannyDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  Py_ssize_t __pyx_t_4;
  PyObject *__pyx_t_5 = NULL;
  int __pyx_t_6;
  PyObject *(*__pyx_t_7)(PyObject *);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_TraceFrameInit(__pyx_codeobj__149)
  __Pyx_RefNannySetupContext("gradient_boosting_regressor", 1);
  __Pyx_TraceCall("gradient_boosting_regressor", __pyx_f[0], 5101, 0, __PYX_ERR(0, 5101, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":5157
 *     >>> print(y_pred[:5])
 *     """
 *     from ..estimators import DecisionStumpRegressor             # <<<<<<<<<<<<<<
 *     # Initialize model
 *     F_m = np.zeros(len(y))
 */
  __Pyx_TraceLine(5157,0,__PYX_ERR(0, 5157, __pyx_L1_error))
  __pyx_t_1 = PyList_New(1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5157, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_n_s_DecisionStumpRegressor);
  __Pyx_GIVEREF(__pyx_n_s_DecisionStumpRegressor);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_1, 0, __pyx_n_s_DecisionStumpRegressor)) __PYX_ERR(0, 5157, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_estimators, __pyx_t_1, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5157, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_DecisionStumpRegressor); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5157, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __Pyx_INCREF(__pyx_t_1);
  __pyx_v_DecisionStumpRegressor = __pyx_t_1;
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":5159
 *     from ..estimators import DecisionStumpRegressor
 *     # Initialize model
 *     F_m = np.zeros(len(y))             # <<<<<<<<<<<<<<
 *     # for m in range(n_estimators):
 *         # Compute negative gradient
 */
  __Pyx_TraceLine(5159,0,__PYX_ERR(0, 5159, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_np); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_zeros); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = PyObject_Length(__pyx_v_y); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 5159, __pyx_L1_error)
  __pyx_t_1 = PyInt_FromSsize_t(__pyx_t_4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_1);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  #if CYTHON_UNPACK_METHODS
  if (unlikely(PyMethod_Check(__pyx_t_3))) {
    __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_3);
    if (likely(__pyx_t_5)) {
      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
      __Pyx_INCREF(__pyx_t_5);
      __Pyx_INCREF(function);
      __Pyx_DECREF_SET(__pyx_t_3, function);
      __pyx_t_6 = 1;
    }
  }
  #endif
  {
    PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_t_1};
    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
    __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5159, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_v_F_m = __pyx_t_2;
  __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":5171
 *         # F_m += learning_rate * tree.predict(X)
 * 
 *     for m in range(n_estimators):             # <<<<<<<<<<<<<<
 *         # Compute negative gradient
 *         residual = -(y - F_m)
 */
  __Pyx_TraceLine(5171,0,__PYX_ERR(0, 5171, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_builtin_range, __pyx_v_n_estimators); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5171, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
    __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3);
    __pyx_t_4 = 0;
    __pyx_t_7 = NULL;
  } else {
    __pyx_t_4 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 5171, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_3);
    __pyx_t_7 = __Pyx_PyObject_GetIterNextFunc(__pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 5171, __pyx_L1_error)
  }
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  for (;;) {
    if (likely(!__pyx_t_7)) {
      if (likely(PyList_CheckExact(__pyx_t_3))) {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyList_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 5171, __pyx_L1_error)
          #endif
          if (__pyx_t_4 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 5171, __pyx_L1_error)
        #else
        __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5171, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      } else {
        {
          Py_ssize_t __pyx_temp = __Pyx_PyTuple_GET_SIZE(__pyx_t_3);
          #if !CYTHON_ASSUME_SAFE_MACROS
          if (unlikely((__pyx_temp < 0))) __PYX_ERR(0, 5171, __pyx_L1_error)
          #endif
          if (__pyx_t_4 >= __pyx_temp) break;
        }
        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_4); __Pyx_INCREF(__pyx_t_2); __pyx_t_4++; if (unlikely((0 < 0))) __PYX_ERR(0, 5171, __pyx_L1_error)
        #else
        __pyx_t_2 = __Pyx_PySequence_ITEM(__pyx_t_3, __pyx_t_4); __pyx_t_4++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5171, __pyx_L1_error)
        __Pyx_GOTREF(__pyx_t_2);
        #endif
      }
    } else {
      __pyx_t_2 = __pyx_t_7(__pyx_t_3);
      if (unlikely(!__pyx_t_2)) {
        PyObject* exc_type = PyErr_Occurred();
        if (exc_type) {
          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
          else __PYX_ERR(0, 5171, __pyx_L1_error)
        }
        break;
      }
      __Pyx_GOTREF(__pyx_t_2);
    }
    __Pyx_XDECREF_SET(__pyx_v_m, __pyx_t_2);
    __pyx_t_2 = 0;

    /* "gofast/tools/mathex.pyx":5173
 *     for m in range(n_estimators):
 *         # Compute negative gradient
 *         residual = -(y - F_m)             # <<<<<<<<<<<<<<
 * 
 *         # Fit a decision stump to the negative gradient
 */
    __Pyx_TraceLine(5173,0,__PYX_ERR(0, 5173, __pyx_L1_error))
    __pyx_t_2 = PyNumber_Subtract(__pyx_v_y, __pyx_v_F_m); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_1 = PyNumber_Negative(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5173, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_XDECREF_SET(__pyx_v_residual, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":5176
 * 
 *         # Fit a decision stump to the negative gradient
 *         stump = DecisionStumpRegressor()             # <<<<<<<<<<<<<<
 *         stump.fit(X, residual)
 * 
 */
    __Pyx_TraceLine(5176,0,__PYX_ERR(0, 5176, __pyx_L1_error))
    __Pyx_INCREF(__pyx_v_DecisionStumpRegressor);
    __pyx_t_2 = __pyx_v_DecisionStumpRegressor; __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (unlikely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, NULL};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 0+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5176, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_XDECREF_SET(__pyx_v_stump, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":5177
 *         # Fit a decision stump to the negative gradient
 *         stump = DecisionStumpRegressor()
 *         stump.fit(X, residual)             # <<<<<<<<<<<<<<
 * 
 *         # Update the model
 */
    __Pyx_TraceLine(5177,0,__PYX_ERR(0, 5177, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_stump, __pyx_n_s_fit); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5177, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[3] = {__pyx_t_5, __pyx_v_X, __pyx_v_residual};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 2+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5177, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":5180
 * 
 *         # Update the model
 *         F_m += learning_rate * stump.predict(X)             # <<<<<<<<<<<<<<
 * 
 * 
 */
    __Pyx_TraceLine(5180,0,__PYX_ERR(0, 5180, __pyx_L1_error))
    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_stump, __pyx_n_s_predict); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5180, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __pyx_t_5 = NULL;
    __pyx_t_6 = 0;
    #if CYTHON_UNPACK_METHODS
    if (likely(PyMethod_Check(__pyx_t_2))) {
      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
      if (likely(__pyx_t_5)) {
        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
        __Pyx_INCREF(__pyx_t_5);
        __Pyx_INCREF(function);
        __Pyx_DECREF_SET(__pyx_t_2, function);
        __pyx_t_6 = 1;
      }
    }
    #endif
    {
      PyObject *__pyx_callargs[2] = {__pyx_t_5, __pyx_v_X};
      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_6, 1+__pyx_t_6);
      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5180, __pyx_L1_error)
      __Pyx_GOTREF(__pyx_t_1);
      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    }
    __pyx_t_2 = PyNumber_Multiply(__pyx_v_learning_rate, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5180, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_2);
    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = PyNumber_InPlaceAdd(__pyx_v_F_m, __pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 5180, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
    __Pyx_DECREF_SET(__pyx_v_F_m, __pyx_t_1);
    __pyx_t_1 = 0;

    /* "gofast/tools/mathex.pyx":5171
 *         # F_m += learning_rate * tree.predict(X)
 * 
 *     for m in range(n_estimators):             # <<<<<<<<<<<<<<
 *         # Compute negative gradient
 *         residual = -(y - F_m)
 */
    __Pyx_TraceLine(5171,0,__PYX_ERR(0, 5171, __pyx_L1_error))
  }
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":5183
 * 
 * 
 *     return F_m             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __Pyx_TraceLine(5183,0,__PYX_ERR(0, 5183, __pyx_L1_error))
  __Pyx_XDECREF(__pyx_r);
  __Pyx_INCREF(__pyx_v_F_m);
  __pyx_r = __pyx_v_F_m;
  goto __pyx_L0;

  /* "gofast/tools/mathex.pyx":5101
 *     return arr
 * 
 * def gradient_boosting_regressor(             # <<<<<<<<<<<<<<
 *         X, y, n_estimators=100, learning_rate=0.1, max_depth=1):
 *     """
 */

  /* function exit code */
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_1);
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_5);
  __Pyx_AddTraceback("gofast.tools.mathex.gradient_boosting_regressor", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  __pyx_L0:;
  __Pyx_XDECREF(__pyx_v_DecisionStumpRegressor);
  __Pyx_XDECREF(__pyx_v_F_m);
  __Pyx_XDECREF(__pyx_v_m);
  __Pyx_XDECREF(__pyx_v_residual);
  __Pyx_XDECREF(__pyx_v_stump);
  __Pyx_XGIVEREF(__pyx_r);
  __Pyx_TraceReturn(__pyx_r, 0);
  __Pyx_RefNannyFinishContext();
  return __pyx_r;
}

static struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct__genexpr[8];
static int __pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct__genexpr = 0;

static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct__genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  #if CYTHON_COMPILING_IN_LIMITED_API
  allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
  o = alloc_func(t, 0);
  #else
  #if CYTHON_COMPILING_IN_CPYTHON
  if (likely((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct__genexpr > 0) & (int)(t->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr)))) {
    o = (PyObject*)__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct__genexpr[--__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct__genexpr];
    memset(o, 0, sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else
  #endif
  {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  #endif
  return o;
}

static void __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct__genexpr(PyObject *o) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *)o;
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely((PY_VERSION_HEX >= 0x03080000 || __Pyx_PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE)) && __Pyx_PyObject_GetSlot(o, tp_finalize, destructor)) && !__Pyx_PyObject_GC_IsFinalized(o)) {
    if (__Pyx_PyObject_GetSlot(o, tp_dealloc, destructor) == __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct__genexpr) {
      if (PyObject_CallFinalizerFromDealloc(o)) return;
    }
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_genexpr_arg_0);
  Py_CLEAR(p->__pyx_v_v);
  #if CYTHON_COMPILING_IN_CPYTHON
  if (((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct__genexpr < 8) & (int)(Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr)))) {
    __pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct__genexpr[__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct__genexpr++] = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *)o);
  } else
  #endif
  {
    #if CYTHON_USE_TYPE_SLOTS || CYTHON_COMPILING_IN_PYPY
    (*Py_TYPE(o)->tp_free)(o);
    #else
    {
      freefunc tp_free = (freefunc)PyType_GetSlot(Py_TYPE(o), Py_tp_free);
      if (tp_free) tp_free(o);
    }
    #endif
  }
}

static int __pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct__genexpr(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr *)o;
  if (p->__pyx_genexpr_arg_0) {
    e = (*v)(p->__pyx_genexpr_arg_0, a); if (e) return e;
  }
  if (p->__pyx_v_v) {
    e = (*v)(p->__pyx_v_v, a); if (e) return e;
  }
  return 0;
}
#if CYTHON_USE_TYPE_SPECS
static PyType_Slot __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr_slots[] = {
  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct__genexpr},
  {Py_tp_traverse, (void *)__pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct__genexpr},
  {Py_tp_new, (void *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct__genexpr},
  {0, 0},
};
static PyType_Spec __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr_spec = {
  "gofast.tools.mathex.__pyx_scope_struct__genexpr",
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr),
  0,
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC|Py_TPFLAGS_HAVE_FINALIZE,
  __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr_slots,
};
#else

static PyTypeObject __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr = {
  PyVarObject_HEAD_INIT(0, 0)
  "gofast.tools.mathex.""__pyx_scope_struct__genexpr", /*tp_name*/
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct__genexpr), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct__genexpr, /*tp_dealloc*/
  #if PY_VERSION_HEX < 0x030800b4
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b4
  0, /*tp_vectorcall_offset*/
  #endif
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC|Py_TPFLAGS_HAVE_FINALIZE, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct__genexpr, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  #if !CYTHON_USE_TYPE_SPECS
  0, /*tp_dictoffset*/
  #endif
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct__genexpr, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  #if CYTHON_USE_TP_FINALIZE
  0, /*tp_finalize*/
  #else
  NULL, /*tp_finalize*/
  #endif
  #endif
  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
  0, /*tp_vectorcall*/
  #endif
  #if __PYX_NEED_TP_PRINT_SLOT == 1
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030C0000
  0, /*tp_watched*/
  #endif
  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
  0, /*tp_pypy_flags*/
  #endif
};
#endif

static struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth[8];
static int __pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth = 0;

static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  #if CYTHON_COMPILING_IN_LIMITED_API
  allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
  o = alloc_func(t, 0);
  #else
  #if CYTHON_COMPILING_IN_CPYTHON
  if (likely((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth > 0) & (int)(t->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth)))) {
    o = (PyObject*)__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth[--__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth];
    memset(o, 0, sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else
  #endif
  {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  #endif
  return o;
}

static void __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth(PyObject *o) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *)o;
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely((PY_VERSION_HEX >= 0x03080000 || __Pyx_PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE)) && __Pyx_PyObject_GetSlot(o, tp_finalize, destructor)) && !__Pyx_PyObject_GC_IsFinalized(o)) {
    if (__Pyx_PyObject_GetSlot(o, tp_dealloc, destructor) == __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth) {
      if (PyObject_CallFinalizerFromDealloc(o)) return;
    }
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_xlon);
  Py_CLEAR(p->__pyx_v_ylat);
  #if CYTHON_COMPILING_IN_CPYTHON
  if (((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth < 8) & (int)(Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth)))) {
    __pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth[__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth++] = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *)o);
  } else
  #endif
  {
    #if CYTHON_USE_TYPE_SLOTS || CYTHON_COMPILING_IN_PYPY
    (*Py_TYPE(o)->tp_free)(o);
    #else
    {
      freefunc tp_free = (freefunc)PyType_GetSlot(Py_TYPE(o), Py_tp_free);
      if (tp_free) tp_free(o);
    }
    #endif
  }
}

static int __pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *)o;
  if (p->__pyx_v_xlon) {
    e = (*v)(p->__pyx_v_xlon, a); if (e) return e;
  }
  if (p->__pyx_v_ylat) {
    e = (*v)(p->__pyx_v_ylat, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth *)o;
  tmp = ((PyObject*)p->__pyx_v_xlon);
  p->__pyx_v_xlon = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  tmp = ((PyObject*)p->__pyx_v_ylat);
  p->__pyx_v_ylat = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}
#if CYTHON_USE_TYPE_SPECS
static PyType_Slot __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth_slots[] = {
  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth},
  {Py_tp_traverse, (void *)__pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth},
  {Py_tp_clear, (void *)__pyx_tp_clear_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth},
  {Py_tp_new, (void *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth},
  {0, 0},
};
static PyType_Spec __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth_spec = {
  "gofast.tools.mathex.__pyx_scope_struct_1_get_azimuth",
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth),
  0,
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC|Py_TPFLAGS_HAVE_FINALIZE,
  __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth_slots,
};
#else

static PyTypeObject __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth = {
  PyVarObject_HEAD_INIT(0, 0)
  "gofast.tools.mathex.""__pyx_scope_struct_1_get_azimuth", /*tp_name*/
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth, /*tp_dealloc*/
  #if PY_VERSION_HEX < 0x030800b4
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b4
  0, /*tp_vectorcall_offset*/
  #endif
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC|Py_TPFLAGS_HAVE_FINALIZE, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth, /*tp_traverse*/
  __pyx_tp_clear_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  #if !CYTHON_USE_TYPE_SPECS
  0, /*tp_dictoffset*/
  #endif
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  #if CYTHON_USE_TP_FINALIZE
  0, /*tp_finalize*/
  #else
  NULL, /*tp_finalize*/
  #endif
  #endif
  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
  0, /*tp_vectorcall*/
  #endif
  #if __PYX_NEED_TP_PRINT_SLOT == 1
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030C0000
  0, /*tp_watched*/
  #endif
  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
  0, /*tp_pypy_flags*/
  #endif
};
#endif

static struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model[8];
static int __pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model = 0;

static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  #if CYTHON_COMPILING_IN_LIMITED_API
  allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
  o = alloc_func(t, 0);
  #else
  #if CYTHON_COMPILING_IN_CPYTHON
  if (likely((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model > 0) & (int)(t->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model)))) {
    o = (PyObject*)__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model[--__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model];
    memset(o, 0, sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model));
    (void) PyObject_INIT(o, t);
    PyObject_GC_Track(o);
  } else
  #endif
  {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  #endif
  return o;
}

static void __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model(PyObject *o) {
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *)o;
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely((PY_VERSION_HEX >= 0x03080000 || __Pyx_PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE)) && __Pyx_PyObject_GetSlot(o, tp_finalize, destructor)) && !__Pyx_PyObject_GC_IsFinalized(o)) {
    if (__Pyx_PyObject_GetSlot(o, tp_dealloc, destructor) == __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model) {
      if (PyObject_CallFinalizerFromDealloc(o)) return;
    }
  }
  #endif
  PyObject_GC_UnTrack(o);
  Py_CLEAR(p->__pyx_v_w);
  #if CYTHON_COMPILING_IN_CPYTHON
  if (((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model < 8) & (int)(Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model)))) {
    __pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model[__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model++] = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *)o);
  } else
  #endif
  {
    #if CYTHON_USE_TYPE_SLOTS || CYTHON_COMPILING_IN_PYPY
    (*Py_TYPE(o)->tp_free)(o);
    #else
    {
      freefunc tp_free = (freefunc)PyType_GetSlot(Py_TYPE(o), Py_tp_free);
      if (tp_free) tp_free(o);
    }
    #endif
  }
}

static int __pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model(PyObject *o, visitproc v, void *a) {
  int e;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *)o;
  if (p->__pyx_v_w) {
    e = (*v)(p->__pyx_v_w, a); if (e) return e;
  }
  return 0;
}

static int __pyx_tp_clear_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model(PyObject *o) {
  PyObject* tmp;
  struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *p = (struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model *)o;
  tmp = ((PyObject*)p->__pyx_v_w);
  p->__pyx_v_w = Py_None; Py_INCREF(Py_None);
  Py_XDECREF(tmp);
  return 0;
}
#if CYTHON_USE_TYPE_SPECS
static PyType_Slot __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model_slots[] = {
  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model},
  {Py_tp_traverse, (void *)__pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model},
  {Py_tp_clear, (void *)__pyx_tp_clear_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model},
  {Py_tp_new, (void *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model},
  {0, 0},
};
static PyType_Spec __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model_spec = {
  "gofast.tools.mathex.__pyx_scope_struct_2__kind_of_model",
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model),
  0,
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC|Py_TPFLAGS_HAVE_FINALIZE,
  __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model_slots,
};
#else

static PyTypeObject __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model = {
  PyVarObject_HEAD_INIT(0, 0)
  "gofast.tools.mathex.""__pyx_scope_struct_2__kind_of_model", /*tp_name*/
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model, /*tp_dealloc*/
  #if PY_VERSION_HEX < 0x030800b4
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b4
  0, /*tp_vectorcall_offset*/
  #endif
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_GC|Py_TPFLAGS_HAVE_FINALIZE, /*tp_flags*/
  0, /*tp_doc*/
  __pyx_tp_traverse_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model, /*tp_traverse*/
  __pyx_tp_clear_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  #if !CYTHON_USE_TYPE_SPECS
  0, /*tp_dictoffset*/
  #endif
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  #if CYTHON_USE_TP_FINALIZE
  0, /*tp_finalize*/
  #else
  NULL, /*tp_finalize*/
  #endif
  #endif
  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
  0, /*tp_vectorcall*/
  #endif
  #if __PYX_NEED_TP_PRINT_SLOT == 1
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030C0000
  0, /*tp_watched*/
  #endif
  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
  0, /*tp_pypy_flags*/
  #endif
};
#endif

static struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter[8];
static int __pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter = 0;

static PyObject *__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
  PyObject *o;
  #if CYTHON_COMPILING_IN_LIMITED_API
  allocfunc alloc_func = (allocfunc)PyType_GetSlot(t, Py_tp_alloc);
  o = alloc_func(t, 0);
  #else
  #if CYTHON_COMPILING_IN_CPYTHON
  if (likely((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter > 0) & (int)(t->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter)))) {
    o = (PyObject*)__pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter[--__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter];
    memset(o, 0, sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter));
    (void) PyObject_INIT(o, t);
  } else
  #endif
  {
    o = (*t->tp_alloc)(t, 0);
    if (unlikely(!o)) return 0;
  }
  #endif
  return o;
}

static void __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter(PyObject *o) {
  #if CYTHON_USE_TP_FINALIZE
  if (unlikely((PY_VERSION_HEX >= 0x03080000 || __Pyx_PyType_HasFeature(Py_TYPE(o), Py_TPFLAGS_HAVE_FINALIZE)) && __Pyx_PyObject_GetSlot(o, tp_finalize, destructor)) && (!PyType_IS_GC(Py_TYPE(o)) || !__Pyx_PyObject_GC_IsFinalized(o))) {
    if (__Pyx_PyObject_GetSlot(o, tp_dealloc, destructor) == __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter) {
      if (PyObject_CallFinalizerFromDealloc(o)) return;
    }
  }
  #endif
  #if CYTHON_COMPILING_IN_CPYTHON
  if (((int)(__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter < 8) & (int)(Py_TYPE(o)->tp_basicsize == sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter)))) {
    __pyx_freelist_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter[__pyx_freecount_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter++] = ((struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter *)o);
  } else
  #endif
  {
    #if CYTHON_USE_TYPE_SLOTS || CYTHON_COMPILING_IN_PYPY
    (*Py_TYPE(o)->tp_free)(o);
    #else
    {
      freefunc tp_free = (freefunc)PyType_GetSlot(Py_TYPE(o), Py_tp_free);
      if (tp_free) tp_free(o);
    }
    #endif
  }
}
#if CYTHON_USE_TYPE_SPECS
static PyType_Slot __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter_slots[] = {
  {Py_tp_dealloc, (void *)__pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter},
  {Py_tp_new, (void *)__pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter},
  {0, 0},
};
static PyType_Spec __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter_spec = {
  "gofast.tools.mathex.__pyx_scope_struct_3_torres_verdin_filter",
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter),
  0,
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_FINALIZE,
  __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter_slots,
};
#else

static PyTypeObject __pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter = {
  PyVarObject_HEAD_INIT(0, 0)
  "gofast.tools.mathex.""__pyx_scope_struct_3_torres_verdin_filter", /*tp_name*/
  sizeof(struct __pyx_obj_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter), /*tp_basicsize*/
  0, /*tp_itemsize*/
  __pyx_tp_dealloc_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter, /*tp_dealloc*/
  #if PY_VERSION_HEX < 0x030800b4
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030800b4
  0, /*tp_vectorcall_offset*/
  #endif
  0, /*tp_getattr*/
  0, /*tp_setattr*/
  #if PY_MAJOR_VERSION < 3
  0, /*tp_compare*/
  #endif
  #if PY_MAJOR_VERSION >= 3
  0, /*tp_as_async*/
  #endif
  0, /*tp_repr*/
  0, /*tp_as_number*/
  0, /*tp_as_sequence*/
  0, /*tp_as_mapping*/
  0, /*tp_hash*/
  0, /*tp_call*/
  0, /*tp_str*/
  0, /*tp_getattro*/
  0, /*tp_setattro*/
  0, /*tp_as_buffer*/
  Py_TPFLAGS_DEFAULT|Py_TPFLAGS_HAVE_VERSION_TAG|Py_TPFLAGS_CHECKTYPES|Py_TPFLAGS_HAVE_NEWBUFFER|Py_TPFLAGS_HAVE_FINALIZE, /*tp_flags*/
  0, /*tp_doc*/
  0, /*tp_traverse*/
  0, /*tp_clear*/
  0, /*tp_richcompare*/
  0, /*tp_weaklistoffset*/
  0, /*tp_iter*/
  0, /*tp_iternext*/
  0, /*tp_methods*/
  0, /*tp_members*/
  0, /*tp_getset*/
  0, /*tp_base*/
  0, /*tp_dict*/
  0, /*tp_descr_get*/
  0, /*tp_descr_set*/
  #if !CYTHON_USE_TYPE_SPECS
  0, /*tp_dictoffset*/
  #endif
  0, /*tp_init*/
  0, /*tp_alloc*/
  __pyx_tp_new_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter, /*tp_new*/
  0, /*tp_free*/
  0, /*tp_is_gc*/
  0, /*tp_bases*/
  0, /*tp_mro*/
  0, /*tp_cache*/
  0, /*tp_subclasses*/
  0, /*tp_weaklist*/
  0, /*tp_del*/
  0, /*tp_version_tag*/
  #if PY_VERSION_HEX >= 0x030400a1
  #if CYTHON_USE_TP_FINALIZE
  0, /*tp_finalize*/
  #else
  NULL, /*tp_finalize*/
  #endif
  #endif
  #if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
  0, /*tp_vectorcall*/
  #endif
  #if __PYX_NEED_TP_PRINT_SLOT == 1
  0, /*tp_print*/
  #endif
  #if PY_VERSION_HEX >= 0x030C0000
  0, /*tp_watched*/
  #endif
  #if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
  0, /*tp_pypy_flags*/
  #endif
};
#endif

static PyMethodDef __pyx_methods[] = {
  {0, 0, 0, 0}
};
#ifndef CYTHON_SMALL_CODE
#if defined(__clang__)
    #define CYTHON_SMALL_CODE
#elif defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))
    #define CYTHON_SMALL_CODE __attribute__((cold))
#else
    #define CYTHON_SMALL_CODE
#endif
#endif
/* #### Code section: pystring_table ### */

static int __Pyx_CreateStringTabAndInitStrings(void) {
  __Pyx_StringTabEntry __pyx_string_tab[] = {
    {&__pyx_kp_u_0A4CEE, __pyx_k_0A4CEE, sizeof(__pyx_k_0A4CEE), 0, 1, 0, 0},
    {&__pyx_kp_u_49R, __pyx_k_49R, sizeof(__pyx_k_49R), 0, 1, 0, 0},
    {&__pyx_n_s_A, __pyx_k_A, sizeof(__pyx_k_A), 0, 0, 1, 1},
    {&__pyx_kp_u_A_moving_average_is_used_with_t, __pyx_k_A_moving_average_is_used_with_t, sizeof(__pyx_k_A_moving_average_is_used_with_t), 0, 1, 0, 0},
    {&__pyx_kp_u_A_singleton_array, __pyx_k_A_singleton_array, sizeof(__pyx_k_A_singleton_array), 0, 1, 0, 0},
    {&__pyx_kp_u_Adaptative_moving_average_as_sm, __pyx_k_Adaptative_moving_average_as_sm, sizeof(__pyx_k_Adaptative_moving_average_as_sm), 0, 1, 0, 0},
    {&__pyx_kp_u_Adjust_y_true_and_y_pred_for_re, __pyx_k_Adjust_y_true_and_y_pred_for_re, sizeof(__pyx_k_Adjust_y_true_and_y_pred_for_re), 0, 1, 0, 0},
    {&__pyx_kp_u_Adjusts_y_true_and_y_pred_for_e, __pyx_k_Adjusts_y_true_and_y_pred_for_e, sizeof(__pyx_k_Adjusts_y_true_and_y_pred_for_e), 0, 1, 0, 0},
    {&__pyx_kp_u_Adjusts_y_true_and_y_pred_in_a, __pyx_k_Adjusts_y_true_and_y_pred_in_a, sizeof(__pyx_k_Adjusts_y_true_and_y_pred_in_a), 0, 1, 0, 0},
    {&__pyx_n_s_AppendDocReferences, __pyx_k_AppendDocReferences, sizeof(__pyx_k_AppendDocReferences), 0, 0, 1, 1},
    {&__pyx_kp_u_Apply_a_Savitzky_Golay_filter_t, __pyx_k_Apply_a_Savitzky_Golay_filter_t, sizeof(__pyx_k_Apply_a_Savitzky_Golay_filter_t), 0, 1, 0, 0},
    {&__pyx_n_u_Array, __pyx_k_Array, sizeof(__pyx_k_Array), 0, 1, 0, 1},
    {&__pyx_n_s_ArrayLike, __pyx_k_ArrayLike, sizeof(__pyx_k_ArrayLike), 0, 0, 1, 1},
    {&__pyx_kp_u_Array_dimension_is, __pyx_k_Array_dimension_is, sizeof(__pyx_k_Array_dimension_is), 0, 1, 0, 0},
    {&__pyx_kp_u_Assigns_ranks_to_data_handling, __pyx_k_Assigns_ranks_to_data_handling, sizeof(__pyx_k_Assigns_ranks_to_data_handling), 0, 1, 0, 0},
    {&__pyx_kp_u_Axis_must_be_specified_Otherwis, __pyx_k_Axis_must_be_specified_Otherwis, sizeof(__pyx_k_Axis_must_be_specified_Otherwis), 0, 1, 0, 0},
    {&__pyx_kp_u_Azimuth_computation_expects_at_l, __pyx_k_Azimuth_computation_expects_at_l, sizeof(__pyx_k_Azimuth_computation_expects_at_l), 0, 1, 0, 0},
    {&__pyx_kp_u_Bins_must_be_auto_or_a_positive, __pyx_k_Bins_must_be_auto_or_a_positive, sizeof(__pyx_k_Bins_must_be_auto_or_a_positive), 0, 1, 0, 0},
    {&__pyx_n_s_C_FN, __pyx_k_C_FN, sizeof(__pyx_k_C_FN), 0, 0, 1, 1},
    {&__pyx_n_s_C_FP, __pyx_k_C_FP, sizeof(__pyx_k_C_FP), 0, 0, 1, 1},
    {&__pyx_kp_u_Calculate_sensitivity_and_speci, __pyx_k_Calculate_sensitivity_and_speci, sizeof(__pyx_k_Calculate_sensitivity_and_speci), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_sensitivity_and_speci_2, __pyx_k_Calculate_sensitivity_and_speci_2, sizeof(__pyx_k_Calculate_sensitivity_and_speci_2), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_Information_Value, __pyx_k_Calculate_the_Information_Value, sizeof(__pyx_k_Calculate_the_Information_Value), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_average_likelihoo, __pyx_k_Calculate_the_average_likelihoo, sizeof(__pyx_k_Calculate_the_average_likelihoo), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_bearing_between_t, __pyx_k_Calculate_the_bearing_between_t, sizeof(__pyx_k_Calculate_the_bearing_between_t), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_likelihood_ratio, __pyx_k_Calculate_the_likelihood_ratio, sizeof(__pyx_k_Calculate_the_likelihood_ratio), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_multiclass_likeli, __pyx_k_Calculate_the_multiclass_likeli, sizeof(__pyx_k_Calculate_the_multiclass_likeli), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_optimal_number_of, __pyx_k_Calculate_the_optimal_number_of, sizeof(__pyx_k_Calculate_the_optimal_number_of), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculate_the_residuals_for_reg, __pyx_k_Calculate_the_residuals_for_reg, sizeof(__pyx_k_Calculate_the_residuals_for_reg), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculates_histogram_bin_edges, __pyx_k_Calculates_histogram_bin_edges, sizeof(__pyx_k_Calculates_histogram_bin_edges), 0, 1, 0, 0},
    {&__pyx_kp_u_Calculates_the_adaptive_moving, __pyx_k_Calculates_the_adaptive_moving, sizeof(__pyx_k_Calculates_the_adaptive_moving), 0, 1, 0, 0},
    {&__pyx_kp_u_Check_the_quality_control_in_th, __pyx_k_Check_the_quality_control_in_th, sizeof(__pyx_k_Check_the_quality_control_in_th), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_Errors_Standard_Deviati, __pyx_k_Compute_Errors_Standard_Deviati, sizeof(__pyx_k_Compute_Errors_Standard_Deviati), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_Spearman_s_rank_correla, __pyx_k_Compute_Spearman_s_rank_correla, sizeof(__pyx_k_Compute_Spearman_s_rank_correla), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_Spearman_s_rank_correla_2, __pyx_k_Compute_Spearman_s_rank_correla_2, sizeof(__pyx_k_Compute_Spearman_s_rank_correla_2), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_Youden_s_Index_and_opti, __pyx_k_Compute_Youden_s_Index_and_opti, sizeof(__pyx_k_Compute_Youden_s_Index_and_opti), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_azimuth_from_coordinate, __pyx_k_Compute_azimuth_from_coordinate, sizeof(__pyx_k_Compute_azimuth_from_coordinate), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_distance_between_points, __pyx_k_Compute_distance_between_points, sizeof(__pyx_k_Compute_distance_between_points), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_effort_and_yield_values, __pyx_k_Compute_effort_and_yield_values, sizeof(__pyx_k_Compute_effort_and_yield_values), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_p_values_for_the_correl, __pyx_k_Compute_p_values_for_the_correl, sizeof(__pyx_k_Compute_p_values_for_the_correl), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_sensitivity_and_specifi, __pyx_k_Compute_sensitivity_and_specifi, sizeof(__pyx_k_Compute_sensitivity_and_specifi), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_the_balanced_accuracy_f, __pyx_k_Compute_the_balanced_accuracy_f, sizeof(__pyx_k_Compute_the_balanced_accuracy_f), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_the_coefficients_for_a_1, __pyx_k_Compute_the_coefficients_for_a_1, sizeof(__pyx_k_Compute_the_coefficients_for_a_1), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_the_importance_of_each, __pyx_k_Compute_the_importance_of_each, sizeof(__pyx_k_Compute_the_importance_of_each), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_the_similarity_between, __pyx_k_Compute_the_similarity_between, sizeof(__pyx_k_Compute_the_similarity_between), 0, 1, 0, 0},
    {&__pyx_kp_u_Compute_threshold_using_a_cost, __pyx_k_Compute_threshold_using_a_cost, sizeof(__pyx_k_Compute_threshold_using_a_cost), 0, 1, 0, 0},
    {&__pyx_kp_u_Computes_the_data_structure_req, __pyx_k_Computes_the_data_structure_req, sizeof(__pyx_k_Computes_the_data_structure_req), 0, 1, 0, 0},
    {&__pyx_kp_u_Consensus_must_be_either_positiv, __pyx_k_Consensus_must_be_either_positiv, sizeof(__pyx_k_Consensus_must_be_either_positiv), 0, 1, 0, 0},
    {&__pyx_kp_u_Correct_data_location_or_positi, __pyx_k_Correct_data_location_or_positi, sizeof(__pyx_k_Correct_data_location_or_positi), 0, 1, 0, 0},
    {&__pyx_kp_u_Correct_the_position_coordinate, __pyx_k_Correct_the_position_coordinate, sizeof(__pyx_k_Correct_the_position_coordinate), 0, 1, 0, 0},
    {&__pyx_kp_u_Could_not_convert_input_argument, __pyx_k_Could_not_convert_input_argument, sizeof(__pyx_k_Could_not_convert_input_argument), 0, 1, 0, 0},
    {&__pyx_n_s_Count, __pyx_k_Count, sizeof(__pyx_k_Count), 0, 0, 1, 1},
    {&__pyx_n_u_Count, __pyx_k_Count, sizeof(__pyx_k_Count), 0, 1, 0, 1},
    {&__pyx_kp_u_Count_the_number_of_local_minim, __pyx_k_Count_the_number_of_local_minim, sizeof(__pyx_k_Count_the_number_of_local_minim), 0, 1, 0, 0},
    {&__pyx_n_s_DataFrame, __pyx_k_DataFrame, sizeof(__pyx_k_DataFrame), 0, 0, 1, 1},
    {&__pyx_kp_u_DataFrame_does_not_contain_any_n, __pyx_k_DataFrame_does_not_contain_any_n, sizeof(__pyx_k_DataFrame_does_not_contain_any_n), 0, 1, 0, 0},
    {&__pyx_kp_u_DataFrame_must_have_at_least_thr, __pyx_k_DataFrame_must_have_at_least_thr, sizeof(__pyx_k_DataFrame_must_have_at_least_thr), 0, 1, 0, 0},
    {&__pyx_kp_u_Dataframe_is_given_The_c_order_a, __pyx_k_Dataframe_is_given_The_c_order_a, sizeof(__pyx_k_Dataframe_is_given_The_c_order_a), 0, 1, 0, 0},
    {&__pyx_n_s_DecisionStumpRegressor, __pyx_k_DecisionStumpRegressor, sizeof(__pyx_k_DecisionStumpRegressor), 0, 0, 1, 1},
    {&__pyx_kp_u_Degree_is_integer_Got, __pyx_k_Degree_is_integer_Got, sizeof(__pyx_k_Degree_is_integer_Got), 0, 1, 0, 0},
    {&__pyx_kp_u_Dependent_variable_depvar_should, __pyx_k_Dependent_variable_depvar_should, sizeof(__pyx_k_Dependent_variable_depvar_should), 0, 1, 0, 0},
    {&__pyx_kp_u_Detect_station_position_and_ret, __pyx_k_Detect_station_position_and_ret, sizeof(__pyx_k_Detect_station_position_and_ret), 0, 1, 0, 0},
    {&__pyx_n_s_Dict, __pyx_k_Dict, sizeof(__pyx_k_Dict), 0, 0, 1, 1},
    {&__pyx_kp_u_Either_predicted_class_labels_or, __pyx_k_Either_predicted_class_labels_or, sizeof(__pyx_k_Either_predicted_class_labels_or), 0, 1, 0, 0},
    {&__pyx_kp_u_Epsilon_must_be_a_numeric_value, __pyx_k_Epsilon_must_be_a_numeric_value, sizeof(__pyx_k_Epsilon_must_be_a_numeric_value), 0, 1, 0, 0},
    {&__pyx_kp_u_Epsilon_value_auto_is_acceptable, __pyx_k_Epsilon_value_auto_is_acceptable, sizeof(__pyx_k_Epsilon_value_auto_is_acceptable), 0, 1, 0, 0},
    {&__pyx_kp_u_Expect, __pyx_k_Expect, sizeof(__pyx_k_Expect), 0, 1, 0, 0},
    {&__pyx_kp_u_Expect_one_dimensional_array_for, __pyx_k_Expect_one_dimensional_array_for, sizeof(__pyx_k_Expect_one_dimensional_array_for), 0, 1, 0, 0},
    {&__pyx_kp_u_Expect_squareform_condense_or_d, __pyx_k_Expect_squareform_condense_or_d, sizeof(__pyx_k_Expect_squareform_condense_or_d), 0, 1, 0, 0},
    {&__pyx_kp_u_Expected_float_not, __pyx_k_Expected_float_not, sizeof(__pyx_k_Expected_float_not), 0, 1, 0, 0},
    {&__pyx_n_s_F, __pyx_k_F, sizeof(__pyx_k_F), 0, 0, 1, 1},
    {&__pyx_n_s_FN, __pyx_k_FN, sizeof(__pyx_k_FN), 0, 0, 1, 1},
    {&__pyx_n_s_FP, __pyx_k_FP, sizeof(__pyx_k_FP), 0, 0, 1, 1},
    {&__pyx_n_s_F_m, __pyx_k_F_m, sizeof(__pyx_k_F_m), 0, 0, 1, 1},
    {&__pyx_kp_u_Get_the_closest_value_in_array_f, __pyx_k_Get_the_closest_value_in_array_f, sizeof(__pyx_k_Get_the_closest_value_in_array_f), 0, 1, 0, 0},
    {&__pyx_kp_u_Got_x_ndim_d, __pyx_k_Got_x_ndim_d, sizeof(__pyx_k_Got_x_ndim_d), 0, 1, 0, 0},
    {&__pyx_kp_u_Gradient_descent_algorithm_to_f, __pyx_k_Gradient_descent_algorithm_to_f, sizeof(__pyx_k_Gradient_descent_algorithm_to_f), 0, 1, 0, 0},
    {&__pyx_n_u_ID, __pyx_k_ID, sizeof(__pyx_k_ID), 0, 1, 0, 1},
    {&__pyx_kp_u_If_mode_is_interp_window_length, __pyx_k_If_mode_is_interp_window_length, sizeof(__pyx_k_If_mode_is_interp_window_length), 0, 1, 0, 0},
    {&__pyx_kp_u_Implement_a_simple_version_of_G, __pyx_k_Implement_a_simple_version_of_G, sizeof(__pyx_k_Implement_a_simple_version_of_G), 0, 1, 0, 0},
    {&__pyx_kp_u_Infers_source_target_and_value, __pyx_k_Infers_source_target_and_value, sizeof(__pyx_k_Infers_source_target_and_value), 0, 1, 0, 0},
    {&__pyx_kp_u_Input_data_must_be_a_numpy_array, __pyx_k_Input_data_must_be_a_numpy_array, sizeof(__pyx_k_Input_data_must_be_a_numpy_array), 0, 1, 0, 0},
    {&__pyx_kp_u_Input_data_must_be_a_one_dimensi, __pyx_k_Input_data_must_be_a_one_dimensi, sizeof(__pyx_k_Input_data_must_be_a_one_dimensi), 0, 1, 0, 0},
    {&__pyx_kp_u_Input_values_contain_NaNs, __pyx_k_Input_values_contain_NaNs, sizeof(__pyx_k_Input_values_contain_NaNs), 0, 1, 0, 0},
    {&__pyx_kp_u_Invalid_correlation_method_Suppo, __pyx_k_Invalid_correlation_method_Suppo, sizeof(__pyx_k_Invalid_correlation_method_Suppo), 0, 1, 0, 0},
    {&__pyx_kp_u_Invalid_method, __pyx_k_Invalid_method, sizeof(__pyx_k_Invalid_method), 0, 1, 0, 0},
    {&__pyx_kp_u_Invalid_method_specified_Choose, __pyx_k_Invalid_method_specified_Choose, sizeof(__pyx_k_Invalid_method_specified_Choose), 0, 1, 0, 0},
    {&__pyx_kp_u_Invalid_nan_policy, __pyx_k_Invalid_nan_policy, sizeof(__pyx_k_Invalid_nan_policy), 0, 1, 0, 0},
    {&__pyx_n_s_KeyBox, __pyx_k_KeyBox, sizeof(__pyx_k_KeyBox), 0, 0, 1, 1},
    {&__pyx_n_s_LabelEncoder, __pyx_k_LabelEncoder, sizeof(__pyx_k_LabelEncoder), 0, 0, 1, 1},
    {&__pyx_n_s_LinearRegression, __pyx_k_LinearRegression, sizeof(__pyx_k_LinearRegression), 0, 0, 1, 1},
    {&__pyx_n_s_List, __pyx_k_List, sizeof(__pyx_k_List), 0, 0, 1, 1},
    {&__pyx_kp_s_List_Dict_str_str, __pyx_k_List_Dict_str_str, sizeof(__pyx_k_List_Dict_str_str), 0, 0, 1, 0},
    {&__pyx_kp_s_List_str, __pyx_k_List_str, sizeof(__pyx_k_List_str), 0, 0, 1, 0},
    {&__pyx_n_s_Location, __pyx_k_Location, sizeof(__pyx_k_Location), 0, 0, 1, 1},
    {&__pyx_kp_u_Location_index_must_be_less_than, __pyx_k_Location_index_must_be_less_than, sizeof(__pyx_k_Location_index_must_be_less_than), 0, 1, 0, 0},
    {&__pyx_n_s_LogisticRegression, __pyx_k_LogisticRegression, sizeof(__pyx_k_LogisticRegression), 0, 0, 1, 1},
    {&__pyx_n_s_N, __pyx_k_N, sizeof(__pyx_k_N), 0, 0, 1, 1},
    {&__pyx_n_s_NDArray, __pyx_k_NDArray, sizeof(__pyx_k_NDArray), 0, 0, 1, 1},
    {&__pyx_kp_u_Need_to_import_scipy_stats_as_a, __pyx_k_Need_to_import_scipy_stats_as_a, sizeof(__pyx_k_Need_to_import_scipy_stats_as_a), 0, 1, 0, 0},
    {&__pyx_kp_u_Non_numerical, __pyx_k_Non_numerical, sizeof(__pyx_k_Non_numerical), 0, 1, 0, 0},
    {&__pyx_kp_u_None, __pyx_k_None, sizeof(__pyx_k_None), 0, 1, 0, 0},
    {&__pyx_kp_u_NoneType_can_not_be_computed, __pyx_k_NoneType_can_not_be_computed, sizeof(__pyx_k_NoneType_can_not_be_computed), 0, 1, 0, 0},
    {&__pyx_kp_u_Number_of_columns_must_fit_the_s, __pyx_k_Number_of_columns_must_fit_the_s, sizeof(__pyx_k_Number_of_columns_must_fit_the_s), 0, 1, 0, 0},
    {&__pyx_kp_u_Numeric_array_is_expected_for_op, __pyx_k_Numeric_array_is_expected_for_op, sizeof(__pyx_k_Numeric_array_is_expected_for_op), 0, 1, 0, 0},
    {&__pyx_n_s_Optional, __pyx_k_Optional, sizeof(__pyx_k_Optional), 0, 0, 1, 1},
    {&__pyx_kp_s_Optional_ArrayLike, __pyx_k_Optional_ArrayLike, sizeof(__pyx_k_Optional_ArrayLike), 0, 0, 1, 0},
    {&__pyx_kp_s_Optional_List_str, __pyx_k_Optional_List_str, sizeof(__pyx_k_Optional_List_str), 0, 0, 1, 0},
    {&__pyx_kp_s_Optional_Union_ArrayLike_List_Ar, __pyx_k_Optional_Union_ArrayLike_List_Ar, sizeof(__pyx_k_Optional_Union_ArrayLike_List_Ar), 0, 0, 1, 0},
    {&__pyx_kp_s_Optional_Union_int_str, __pyx_k_Optional_Union_int_str, sizeof(__pyx_k_Optional_Union_int_str), 0, 0, 1, 0},
    {&__pyx_kp_s_Optional_Union_str_list, __pyx_k_Optional_Union_str_list, sizeof(__pyx_k_Optional_Union_str_list), 0, 0, 1, 0},
    {&__pyx_kp_s_Optional__F, __pyx_k_Optional__F, sizeof(__pyx_k_Optional__F), 0, 0, 1, 0},
    {&__pyx_kp_s_Optional_str, __pyx_k_Optional_str, sizeof(__pyx_k_Optional_str), 0, 0, 1, 0},
    {&__pyx_kp_u_P_value_calculations_expect_nume, __pyx_k_P_value_calculations_expect_nume, sizeof(__pyx_k_P_value_calculations_expect_nume), 0, 1, 0, 0},
    {&__pyx_kp_u_P_values, __pyx_k_P_values, sizeof(__pyx_k_P_values), 0, 1, 0, 0},
    {&__pyx_kp_u_Polynomial_function_expects_degr, __pyx_k_Polynomial_function_expects_degr, sizeof(__pyx_k_Polynomial_function_expects_degr), 0, 1, 0, 0},
    {&__pyx_kp_u_Position_array_p, __pyx_k_Position_array_p, sizeof(__pyx_k_Position_array_p), 0, 1, 0, 0},
    {&__pyx_kp_u_Predicted_values_must_be_provide, __pyx_k_Predicted_values_must_be_provide, sizeof(__pyx_k_Predicted_values_must_be_provide), 0, 1, 0, 0},
    {&__pyx_kp_u_Profile_angle_is_0_2f_degrees_E, __pyx_k_Profile_angle_is_0_2f_degrees_E, sizeof(__pyx_k_Profile_angle_is_0_2f_degrees_E), 0, 1, 0, 0},
    {&__pyx_n_s_ResultSummary, __pyx_k_ResultSummary, sizeof(__pyx_k_ResultSummary), 0, 0, 1, 1},
    {&__pyx_n_s_RuntimeWarning, __pyx_k_RuntimeWarning, sizeof(__pyx_k_RuntimeWarning), 0, 0, 1, 1},
    {&__pyx_n_s_S, __pyx_k_S, sizeof(__pyx_k_S), 0, 0, 1, 1},
    {&__pyx_n_s_SP, __pyx_k_SP, sizeof(__pyx_k_SP), 0, 0, 1, 1},
    {&__pyx_kp_u_Scales_each_feature_to_a_given, __pyx_k_Scales_each_feature_to_a_given, sizeof(__pyx_k_Scales_each_feature_to_a_given), 0, 1, 0, 0},
    {&__pyx_kp_u_Scales_features_to_have_zero_me, __pyx_k_Scales_features_to_have_zero_me, sizeof(__pyx_k_Scales_features_to_have_zero_me), 0, 1, 0, 0},
    {&__pyx_kp_u_Scales_individual_samples_to_ha, __pyx_k_Scales_individual_samples_to_ha, sizeof(__pyx_k_Scales_individual_samples_to_ha), 0, 1, 0, 0},
    {&__pyx_n_s_Series, __pyx_k_Series, sizeof(__pyx_k_Series), 0, 0, 1, 1},
    {&__pyx_n_s_SiteError, __pyx_k_SiteError, sizeof(__pyx_k_SiteError), 0, 0, 1, 1},
    {&__pyx_kp_u_Source_and_Target_columns_must_n, __pyx_k_Source_and_Target_columns_must_n, sizeof(__pyx_k_Source_and_Target_columns_must_n), 0, 1, 0, 0},
    {&__pyx_kp_u_Station, __pyx_k_Station, sizeof(__pyx_k_Station), 0, 1, 0, 0},
    {&__pyx_kp_u_Step_is_not_given_Average_distan, __pyx_k_Step_is_not_given_Average_distan, sizeof(__pyx_k_Step_is_not_given_Average_distan), 0, 1, 0, 0},
    {&__pyx_kp_u_Step_m, __pyx_k_Step_m, sizeof(__pyx_k_Step_m), 0, 1, 0, 0},
    {&__pyx_n_s_T, __pyx_k_T, sizeof(__pyx_k_T), 0, 0, 1, 1},
    {&__pyx_n_s_TN, __pyx_k_TN, sizeof(__pyx_k_TN), 0, 0, 1, 1},
    {&__pyx_n_s_TP, __pyx_k_TP, sizeof(__pyx_k_TP), 0, 0, 1, 1},
    {&__pyx_kp_u_The_bins_parameter_is_set_to_aut, __pyx_k_The_bins_parameter_is_set_to_aut, sizeof(__pyx_k_The_bins_parameter_is_set_to_aut), 0, 1, 0, 0},
    {&__pyx_kp_u_The_first_column_of_the_data_sho, __pyx_k_The_first_column_of_the_data_sho, sizeof(__pyx_k_The_first_column_of_the_data_sho), 0, 1, 0, 0},
    {&__pyx_kp_u_The_length_of_predict_proba_does, __pyx_k_The_length_of_predict_proba_does, sizeof(__pyx_k_The_length_of_predict_proba_does), 0, 1, 0, 0},
    {&__pyx_kp_u_The_task_type_must_be_regression, __pyx_k_The_task_type_must_be_regression, sizeof(__pyx_k_The_task_type_must_be_regression), 0, 1, 0, 0},
    {&__pyx_n_s_Tuple, __pyx_k_Tuple, sizeof(__pyx_k_Tuple), 0, 0, 1, 1},
    {&__pyx_kp_s_Tuple_ArrayLike_np_ndarray, __pyx_k_Tuple_ArrayLike_np_ndarray, sizeof(__pyx_k_Tuple_ArrayLike_np_ndarray), 0, 0, 1, 0},
    {&__pyx_kp_s_Tuple_List_str_List_str_List_int, __pyx_k_Tuple_List_str_List_str_List_int, sizeof(__pyx_k_Tuple_List_str_List_str_List_int), 0, 0, 1, 0},
    {&__pyx_kp_s_Tuple_float_ArrayLike, __pyx_k_Tuple_float_ArrayLike, sizeof(__pyx_k_Tuple_float_ArrayLike), 0, 0, 1, 0},
    {&__pyx_kp_s_Tuple_float_float, __pyx_k_Tuple_float_float, sizeof(__pyx_k_Tuple_float_float), 0, 0, 1, 0},
    {&__pyx_kp_s_Tuple_int_float, __pyx_k_Tuple_int_float, sizeof(__pyx_k_Tuple_int_float), 0, 0, 1, 0},
    {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
    {&__pyx_n_u_Un, __pyx_k_Un, sizeof(__pyx_k_Un), 0, 1, 0, 1},
    {&__pyx_kp_u_Unable_to_detect_the_station_pos, __pyx_k_Unable_to_detect_the_station_pos, sizeof(__pyx_k_Unable_to_detect_the_station_pos), 0, 1, 0, 0},
    {&__pyx_n_s_Union, __pyx_k_Union, sizeof(__pyx_k_Union), 0, 0, 1, 1},
    {&__pyx_kp_s_Union_ArrayLike_List_ArrayLike, __pyx_k_Union_ArrayLike_List_ArrayLike, sizeof(__pyx_k_Union_ArrayLike_List_ArrayLike), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_ArrayLike_Series, __pyx_k_Union_ArrayLike_Series, sizeof(__pyx_k_Union_ArrayLike_Series), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_ArrayLike__SP_Series_DataF, __pyx_k_Union_ArrayLike__SP_Series_DataF, sizeof(__pyx_k_Union_ArrayLike__SP_Series_DataF), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_int_float, __pyx_k_Union_int_float, sizeof(__pyx_k_Union_int_float), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_int_str_list, __pyx_k_Union_int_str_list, sizeof(__pyx_k_Union_int_str_list), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_np_ndarray_List_ArrayLike, __pyx_k_Union_np_ndarray_List_ArrayLike, sizeof(__pyx_k_Union_np_ndarray_List_ArrayLike), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_str_ArrayLike, __pyx_k_Union_str_ArrayLike, sizeof(__pyx_k_Union_str_ArrayLike), 0, 0, 1, 0},
    {&__pyx_kp_s_Union_str_int, __pyx_k_Union_str_int, sizeof(__pyx_k_Union_str_int), 0, 0, 1, 0},
    {&__pyx_kp_u_Unknown_method, __pyx_k_Unknown_method, sizeof(__pyx_k_Unknown_method), 0, 1, 0, 0},
    {&__pyx_kp_u_Use_base_or_binning, __pyx_k_Use_base_or_binning, sizeof(__pyx_k_Use_base_or_binning), 0, 1, 0, 0},
    {&__pyx_kp_u_Use_column_name_instead, __pyx_k_Use_column_name_instead, sizeof(__pyx_k_Use_column_name_instead), 0, 1, 0, 0},
    {&__pyx_kp_u_Use_the_index_instead, __pyx_k_Use_the_index_instead, sizeof(__pyx_k_Use_the_index_instead), 0, 1, 0, 0},
    {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
    {&__pyx_kp_u_Value_column_must_not_contain_nu, __pyx_k_Value_column_must_not_contain_nu, sizeof(__pyx_k_Value_column_must_not_contain_nu), 0, 1, 0, 0},
    {&__pyx_kp_u_Value_is_resetting_to_minimum_e, __pyx_k_Value_is_resetting_to_minimum_e, sizeof(__pyx_k_Value_is_resetting_to_minimum_e), 0, 1, 0, 0},
    {&__pyx_kp_u_Variant_average_methods_only_inc, __pyx_k_Variant_average_methods_only_inc, sizeof(__pyx_k_Variant_average_methods_only_inc), 0, 1, 0, 0},
    {&__pyx_n_s_W, __pyx_k_W, sizeof(__pyx_k_W), 0, 0, 1, 1},
    {&__pyx_kp_u_Wrong_coordinates_values_Need_tw, __pyx_k_Wrong_coordinates_values_Need_tw, sizeof(__pyx_k_Wrong_coordinates_values_Need_tw), 0, 1, 0, 0},
    {&__pyx_n_s_X, __pyx_k_X, sizeof(__pyx_k_X), 0, 0, 1, 1},
    {&__pyx_n_s_X_max, __pyx_k_X_max, sizeof(__pyx_k_X_max), 0, 0, 1, 1},
    {&__pyx_n_s_X_mean, __pyx_k_X_mean, sizeof(__pyx_k_X_mean), 0, 0, 1, 1},
    {&__pyx_n_s_X_min, __pyx_k_X_min, sizeof(__pyx_k_X_min), 0, 0, 1, 1},
    {&__pyx_n_s_X_norm, __pyx_k_X_norm, sizeof(__pyx_k_X_norm), 0, 0, 1, 1},
    {&__pyx_n_s_X_normalized, __pyx_k_X_normalized, sizeof(__pyx_k_X_normalized), 0, 0, 1, 1},
    {&__pyx_n_s_X_scaled, __pyx_k_X_scaled, sizeof(__pyx_k_X_scaled), 0, 0, 1, 1},
    {&__pyx_n_s_X_std, __pyx_k_X_std, sizeof(__pyx_k_X_std), 0, 0, 1, 1},
    {&__pyx_n_u_Xdata, __pyx_k_Xdata, sizeof(__pyx_k_Xdata), 0, 1, 0, 1},
    {&__pyx_kp_u_Youden_s_index_calculation_requi, __pyx_k_Youden_s_index_calculation_requi, sizeof(__pyx_k_Youden_s_index_calculation_requi), 0, 1, 0, 0},
    {&__pyx_n_s_Z, __pyx_k_Z, sizeof(__pyx_k_Z), 0, 0, 1, 1},
    {&__pyx_kp_u__107, __pyx_k__107, sizeof(__pyx_k__107), 0, 1, 0, 0},
    {&__pyx_n_s__177, __pyx_k__177, sizeof(__pyx_k__177), 0, 0, 1, 1},
    {&__pyx_kp_u__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 1, 0, 0},
    {&__pyx_n_s__240, __pyx_k__240, sizeof(__pyx_k__240), 0, 0, 1, 1},
    {&__pyx_kp_u__31, __pyx_k__31, sizeof(__pyx_k__31), 0, 1, 0, 0},
    {&__pyx_kp_u__39, __pyx_k__39, sizeof(__pyx_k__39), 0, 1, 0, 0},
    {&__pyx_kp_u__65, __pyx_k__65, sizeof(__pyx_k__65), 0, 1, 0, 0},
    {&__pyx_n_s__70, __pyx_k__70, sizeof(__pyx_k__70), 0, 0, 1, 1},
    {&__pyx_kp_u__70, __pyx_k__70, sizeof(__pyx_k__70), 0, 1, 0, 0},
    {&__pyx_kp_u__88, __pyx_k__88, sizeof(__pyx_k__88), 0, 1, 0, 0},
    {&__pyx_n_s_a, __pyx_k_a, sizeof(__pyx_k_a), 0, 0, 1, 1},
    {&__pyx_n_s_abs, __pyx_k_abs, sizeof(__pyx_k_abs), 0, 0, 1, 1},
    {&__pyx_n_s_accept_multioutput, __pyx_k_accept_multioutput, sizeof(__pyx_k_accept_multioutput), 0, 0, 1, 1},
    {&__pyx_n_s_action, __pyx_k_action, sizeof(__pyx_k_action), 0, 0, 1, 1},
    {&__pyx_n_s_actual, __pyx_k_actual, sizeof(__pyx_k_actual), 0, 0, 1, 1},
    {&__pyx_n_s_adaptive_moving_average, __pyx_k_adaptive_moving_average, sizeof(__pyx_k_adaptive_moving_average), 0, 0, 1, 1},
    {&__pyx_n_u_adaptive_moving_average, __pyx_k_adaptive_moving_average, sizeof(__pyx_k_adaptive_moving_average), 0, 1, 0, 1},
    {&__pyx_kp_u_adaptive_moving_average_line_494, __pyx_k_adaptive_moving_average_line_494, sizeof(__pyx_k_adaptive_moving_average_line_494), 0, 1, 0, 0},
    {&__pyx_n_s_add_results, __pyx_k_add_results, sizeof(__pyx_k_add_results), 0, 0, 1, 1},
    {&__pyx_n_s_adjust_for_control_vars, __pyx_k_adjust_for_control_vars, sizeof(__pyx_k_adjust_for_control_vars), 0, 0, 1, 1},
    {&__pyx_n_u_adjust_for_control_vars, __pyx_k_adjust_for_control_vars, sizeof(__pyx_k_adjust_for_control_vars), 0, 1, 0, 1},
    {&__pyx_n_s_adjust_for_control_vars_classifi, __pyx_k_adjust_for_control_vars_classifi, sizeof(__pyx_k_adjust_for_control_vars_classifi), 0, 0, 1, 1},
    {&__pyx_kp_u_adjust_for_control_vars_classifi_2, __pyx_k_adjust_for_control_vars_classifi_2, sizeof(__pyx_k_adjust_for_control_vars_classifi_2), 0, 1, 0, 0},
    {&__pyx_kp_u_adjust_for_control_vars_line_150, __pyx_k_adjust_for_control_vars_line_150, sizeof(__pyx_k_adjust_for_control_vars_line_150), 0, 1, 0, 0},
    {&__pyx_n_s_adjust_for_control_vars_regressi, __pyx_k_adjust_for_control_vars_regressi, sizeof(__pyx_k_adjust_for_control_vars_regressi), 0, 0, 1, 1},
    {&__pyx_kp_u_adjust_for_control_vars_regressi_2, __pyx_k_adjust_for_control_vars_regressi_2, sizeof(__pyx_k_adjust_for_control_vars_regressi_2), 0, 1, 0, 0},
    {&__pyx_n_s_adjusted_pred, __pyx_k_adjusted_pred, sizeof(__pyx_k_adjusted_pred), 0, 0, 1, 1},
    {&__pyx_n_s_adjusted_preds, __pyx_k_adjusted_preds, sizeof(__pyx_k_adjusted_preds), 0, 0, 1, 1},
    {&__pyx_n_s_adjusted_y_pred, __pyx_k_adjusted_y_pred, sizeof(__pyx_k_adjusted_y_pred), 0, 0, 1, 1},
    {&__pyx_n_s_adjusted_y_true, __pyx_k_adjusted_y_true, sizeof(__pyx_k_adjusted_y_true), 0, 0, 1, 1},
    {&__pyx_n_s_all, __pyx_k_all, sizeof(__pyx_k_all), 0, 0, 1, 1},
    {&__pyx_n_s_all_2, __pyx_k_all_2, sizeof(__pyx_k_all_2), 0, 0, 1, 1},
    {&__pyx_n_s_alpha, __pyx_k_alpha, sizeof(__pyx_k_alpha), 0, 0, 1, 1},
    {&__pyx_kp_u_alpha_should_be_less_than_1_and, __pyx_k_alpha_should_be_less_than_1_and, sizeof(__pyx_k_alpha_should_be_less_than_1_and), 0, 1, 0, 0},
    {&__pyx_n_s_ama, __pyx_k_ama, sizeof(__pyx_k_ama), 0, 0, 1, 1},
    {&__pyx_n_s_ama_value, __pyx_k_ama_value, sizeof(__pyx_k_ama_value), 0, 0, 1, 1},
    {&__pyx_n_u_amount, __pyx_k_amount, sizeof(__pyx_k_amount), 0, 1, 0, 1},
    {&__pyx_n_s_any, __pyx_k_any, sizeof(__pyx_k_any), 0, 0, 1, 1},
    {&__pyx_n_s_api_box, __pyx_k_api_box, sizeof(__pyx_k_api_box), 0, 0, 1, 1},
    {&__pyx_n_s_api_docstring, __pyx_k_api_docstring, sizeof(__pyx_k_api_docstring), 0, 0, 1, 1},
    {&__pyx_n_s_api_summary, __pyx_k_api_summary, sizeof(__pyx_k_api_summary), 0, 0, 1, 1},
    {&__pyx_n_s_api_types, __pyx_k_api_types, sizeof(__pyx_k_api_types), 0, 0, 1, 1},
    {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
    {&__pyx_n_s_apply_log_scale, __pyx_k_apply_log_scale, sizeof(__pyx_k_apply_log_scale), 0, 0, 1, 1},
    {&__pyx_n_s_ar, __pyx_k_ar, sizeof(__pyx_k_ar), 0, 0, 1, 1},
    {&__pyx_n_s_arange, __pyx_k_arange, sizeof(__pyx_k_arange), 0, 0, 1, 1},
    {&__pyx_n_s_arctan, __pyx_k_arctan, sizeof(__pyx_k_arctan), 0, 0, 1, 1},
    {&__pyx_n_s_arctan2, __pyx_k_arctan2, sizeof(__pyx_k_arctan2), 0, 0, 1, 1},
    {&__pyx_kp_u_are_not_allowed, __pyx_k_are_not_allowed, sizeof(__pyx_k_are_not_allowed), 0, 1, 0, 0},
    {&__pyx_n_s_argmax, __pyx_k_argmax, sizeof(__pyx_k_argmax), 0, 0, 1, 1},
    {&__pyx_n_s_argmin, __pyx_k_argmin, sizeof(__pyx_k_argmin), 0, 0, 1, 1},
    {&__pyx_n_s_argrelextrema, __pyx_k_argrelextrema, sizeof(__pyx_k_argrelextrema), 0, 0, 1, 1},
    {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
    {&__pyx_n_s_argsort, __pyx_k_argsort, sizeof(__pyx_k_argsort), 0, 0, 1, 1},
    {&__pyx_n_s_argwhere, __pyx_k_argwhere, sizeof(__pyx_k_argwhere), 0, 0, 1, 1},
    {&__pyx_n_s_around, __pyx_k_around, sizeof(__pyx_k_around), 0, 0, 1, 1},
    {&__pyx_n_s_arr, __pyx_k_arr, sizeof(__pyx_k_arr), 0, 0, 1, 1},
    {&__pyx_n_u_array, __pyx_k_array, sizeof(__pyx_k_array), 0, 1, 0, 1},
    {&__pyx_n_s_array_2, __pyx_k_array_2, sizeof(__pyx_k_array_2), 0, 0, 1, 1},
    {&__pyx_n_u_array_2, __pyx_k_array_2, sizeof(__pyx_k_array_2), 0, 1, 0, 1},
    {&__pyx_n_s_arraytools, __pyx_k_arraytools, sizeof(__pyx_k_arraytools), 0, 0, 1, 1},
    {&__pyx_n_s_as_frame, __pyx_k_as_frame, sizeof(__pyx_k_as_frame), 0, 0, 1, 1},
    {&__pyx_n_s_asarray, __pyx_k_asarray, sizeof(__pyx_k_asarray), 0, 0, 1, 1},
    {&__pyx_n_s_assert_all_types, __pyx_k_assert_all_types, sizeof(__pyx_k_assert_all_types), 0, 0, 1, 1},
    {&__pyx_n_s_assert_ratio, __pyx_k_assert_ratio, sizeof(__pyx_k_assert_ratio), 0, 0, 1, 1},
    {&__pyx_n_s_assert_x_y_positions, __pyx_k_assert_x_y_positions, sizeof(__pyx_k_assert_x_y_positions), 0, 0, 1, 1},
    {&__pyx_n_s_assert_xy_in, __pyx_k_assert_xy_in, sizeof(__pyx_k_assert_xy_in), 0, 0, 1, 1},
    {&__pyx_n_s_assign, __pyx_k_assign, sizeof(__pyx_k_assign), 0, 0, 1, 1},
    {&__pyx_n_s_astype, __pyx_k_astype, sizeof(__pyx_k_astype), 0, 0, 1, 1},
    {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
    {&__pyx_n_s_auc_score, __pyx_k_auc_score, sizeof(__pyx_k_auc_score), 0, 0, 1, 1},
    {&__pyx_n_u_auto, __pyx_k_auto, sizeof(__pyx_k_auto), 0, 1, 0, 1},
    {&__pyx_n_s_average, __pyx_k_average, sizeof(__pyx_k_average), 0, 0, 1, 1},
    {&__pyx_n_u_average, __pyx_k_average, sizeof(__pyx_k_average), 0, 1, 0, 1},
    {&__pyx_n_s_avg_sensitivity, __pyx_k_avg_sensitivity, sizeof(__pyx_k_avg_sensitivity), 0, 0, 1, 1},
    {&__pyx_n_s_avg_specificity, __pyx_k_avg_specificity, sizeof(__pyx_k_avg_specificity), 0, 0, 1, 1},
    {&__pyx_n_s_aweights, __pyx_k_aweights, sizeof(__pyx_k_aweights), 0, 0, 1, 1},
    {&__pyx_n_s_ax, __pyx_k_ax, sizeof(__pyx_k_ax), 0, 0, 1, 1},
    {&__pyx_n_s_axis, __pyx_k_axis, sizeof(__pyx_k_axis), 0, 0, 1, 1},
    {&__pyx_n_s_axis_slice, __pyx_k_axis_slice, sizeof(__pyx_k_axis_slice), 0, 0, 1, 1},
    {&__pyx_n_s_azim, __pyx_k_azim, sizeof(__pyx_k_azim), 0, 0, 1, 1},
    {&__pyx_n_s_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 0, 1, 1},
    {&__pyx_kp_u_b_2, __pyx_k_b_2, sizeof(__pyx_k_b_2), 0, 1, 0, 0},
    {&__pyx_n_s_bal_acc_scores, __pyx_k_bal_acc_scores, sizeof(__pyx_k_bal_acc_scores), 0, 0, 1, 1},
    {&__pyx_n_s_balanced_accuracy_ovo, __pyx_k_balanced_accuracy_ovo, sizeof(__pyx_k_balanced_accuracy_ovo), 0, 0, 1, 1},
    {&__pyx_n_s_balanced_accuracy_ovr, __pyx_k_balanced_accuracy_ovr, sizeof(__pyx_k_balanced_accuracy_ovr), 0, 0, 1, 1},
    {&__pyx_n_u_base, __pyx_k_base, sizeof(__pyx_k_base), 0, 1, 0, 1},
    {&__pyx_n_s_base_epsilon, __pyx_k_base_epsilon, sizeof(__pyx_k_base_epsilon), 0, 0, 1, 1},
    {&__pyx_n_s_best_threshold, __pyx_k_best_threshold, sizeof(__pyx_k_best_threshold), 0, 0, 1, 1},
    {&__pyx_n_s_beta, __pyx_k_beta, sizeof(__pyx_k_beta), 0, 0, 1, 1},
    {&__pyx_n_s_bias, __pyx_k_bias, sizeof(__pyx_k_bias), 0, 0, 1, 1},
    {&__pyx_n_s_bin_contribution, __pyx_k_bin_contribution, sizeof(__pyx_k_bin_contribution), 0, 0, 1, 1},
    {&__pyx_n_s_bin_edges, __pyx_k_bin_edges, sizeof(__pyx_k_bin_edges), 0, 0, 1, 1},
    {&__pyx_n_s_bin_index, __pyx_k_bin_index, sizeof(__pyx_k_bin_index), 0, 0, 1, 1},
    {&__pyx_n_s_bin_true, __pyx_k_bin_true, sizeof(__pyx_k_bin_true), 0, 0, 1, 1},
    {&__pyx_n_s_bin_width, __pyx_k_bin_width, sizeof(__pyx_k_bin_width), 0, 0, 1, 1},
    {&__pyx_n_u_binary, __pyx_k_binary, sizeof(__pyx_k_binary), 0, 1, 0, 1},
    {&__pyx_n_s_binary_y_pred, __pyx_k_binary_y_pred, sizeof(__pyx_k_binary_y_pred), 0, 0, 1, 1},
    {&__pyx_n_s_binary_y_true, __pyx_k_binary_y_true, sizeof(__pyx_k_binary_y_true), 0, 0, 1, 1},
    {&__pyx_n_u_binning, __pyx_k_binning, sizeof(__pyx_k_binning), 0, 1, 0, 1},
    {&__pyx_n_s_bins, __pyx_k_bins, sizeof(__pyx_k_bins), 0, 0, 1, 1},
    {&__pyx_n_s_bins_array, __pyx_k_bins_array, sizeof(__pyx_k_bins_array), 0, 0, 1, 1},
    {&__pyx_n_s_bins_method, __pyx_k_bins_method, sizeof(__pyx_k_bins_method), 0, 0, 1, 1},
    {&__pyx_n_s_bool, __pyx_k_bool, sizeof(__pyx_k_bool), 0, 0, 1, 1},
    {&__pyx_n_s_bounds, __pyx_k_bounds, sizeof(__pyx_k_bounds), 0, 0, 1, 1},
    {&__pyx_n_s_buffer, __pyx_k_buffer, sizeof(__pyx_k_buffer), 0, 0, 1, 1},
    {&__pyx_n_s_c, __pyx_k_c, sizeof(__pyx_k_c), 0, 0, 1, 1},
    {&__pyx_n_s_c_order, __pyx_k_c_order, sizeof(__pyx_k_c_order), 0, 0, 1, 1},
    {&__pyx_kp_u_c_order_2, __pyx_k_c_order_2, sizeof(__pyx_k_c_order_2), 0, 1, 0, 0},
    {&__pyx_kp_u_c_order_3, __pyx_k_c_order_3, sizeof(__pyx_k_c_order_3), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_adjusted_lr, __pyx_k_calculate_adjusted_lr, sizeof(__pyx_k_calculate_adjusted_lr), 0, 0, 1, 1},
    {&__pyx_n_u_calculate_adjusted_lr, __pyx_k_calculate_adjusted_lr, sizeof(__pyx_k_calculate_adjusted_lr), 0, 1, 0, 1},
    {&__pyx_kp_u_calculate_adjusted_lr_line_809, __pyx_k_calculate_adjusted_lr_line_809, sizeof(__pyx_k_calculate_adjusted_lr_line_809), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_binary_iv, __pyx_k_calculate_binary_iv, sizeof(__pyx_k_calculate_binary_iv), 0, 0, 1, 1},
    {&__pyx_n_u_calculate_binary_iv, __pyx_k_calculate_binary_iv, sizeof(__pyx_k_calculate_binary_iv), 0, 1, 0, 1},
    {&__pyx_kp_u_calculate_binary_iv_line_1993, __pyx_k_calculate_binary_iv_line_1993, sizeof(__pyx_k_calculate_binary_iv_line_1993), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_histogram_bins, __pyx_k_calculate_histogram_bins, sizeof(__pyx_k_calculate_histogram_bins), 0, 0, 1, 1},
    {&__pyx_kp_u_calculate_histogram_bins_line_12, __pyx_k_calculate_histogram_bins_line_12, sizeof(__pyx_k_calculate_histogram_bins_line_12), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_multiclass_avg_lr, __pyx_k_calculate_multiclass_avg_lr, sizeof(__pyx_k_calculate_multiclass_avg_lr), 0, 0, 1, 1},
    {&__pyx_kp_u_calculate_multiclass_avg_lr_line, __pyx_k_calculate_multiclass_avg_lr_line, sizeof(__pyx_k_calculate_multiclass_avg_lr_line), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_multiclass_lr, __pyx_k_calculate_multiclass_lr, sizeof(__pyx_k_calculate_multiclass_lr), 0, 0, 1, 1},
    {&__pyx_kp_u_calculate_multiclass_lr_line_662, __pyx_k_calculate_multiclass_lr_line_662, sizeof(__pyx_k_calculate_multiclass_lr_line_662), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_optimal_bins, __pyx_k_calculate_optimal_bins, sizeof(__pyx_k_calculate_optimal_bins), 0, 0, 1, 1},
    {&__pyx_n_u_calculate_optimal_bins, __pyx_k_calculate_optimal_bins, sizeof(__pyx_k_calculate_optimal_bins), 0, 1, 0, 1},
    {&__pyx_kp_u_calculate_optimal_bins_line_1895, __pyx_k_calculate_optimal_bins_line_1895, sizeof(__pyx_k_calculate_optimal_bins_line_1895), 0, 1, 0, 0},
    {&__pyx_n_s_calculate_optimal_bins_locals_ge, __pyx_k_calculate_optimal_bins_locals_ge, sizeof(__pyx_k_calculate_optimal_bins_locals_ge), 0, 0, 1, 1},
    {&__pyx_n_s_calculate_residuals, __pyx_k_calculate_residuals, sizeof(__pyx_k_calculate_residuals), 0, 0, 1, 1},
    {&__pyx_n_u_calculate_residuals, __pyx_k_calculate_residuals, sizeof(__pyx_k_calculate_residuals), 0, 1, 0, 1},
    {&__pyx_kp_u_calculate_residuals_line_2195, __pyx_k_calculate_residuals_line_2195, sizeof(__pyx_k_calculate_residuals_line_2195), 0, 1, 0, 0},
    {&__pyx_n_u_call, __pyx_k_call, sizeof(__pyx_k_call), 0, 1, 0, 1},
    {&__pyx_n_s_catch_warnings, __pyx_k_catch_warnings, sizeof(__pyx_k_catch_warnings), 0, 0, 1, 1},
    {&__pyx_n_s_category, __pyx_k_category, sizeof(__pyx_k_category), 0, 0, 1, 1},
    {&__pyx_n_s_ceil, __pyx_k_ceil, sizeof(__pyx_k_ceil), 0, 0, 1, 1},
    {&__pyx_n_s_change, __pyx_k_change, sizeof(__pyx_k_change), 0, 0, 1, 1},
    {&__pyx_n_s_check_classification_targets, __pyx_k_check_classification_targets, sizeof(__pyx_k_check_classification_targets), 0, 0, 1, 1},
    {&__pyx_n_s_check_consistent_length, __pyx_k_check_consistent_length, sizeof(__pyx_k_check_consistent_length), 0, 0, 1, 1},
    {&__pyx_n_s_check_epsilon, __pyx_k_check_epsilon, sizeof(__pyx_k_check_epsilon), 0, 0, 1, 1},
    {&__pyx_n_s_check_y, __pyx_k_check_y, sizeof(__pyx_k_check_y), 0, 0, 1, 1},
    {&__pyx_n_s_ck, __pyx_k_ck, sizeof(__pyx_k_ck), 0, 0, 1, 1},
    {&__pyx_n_s_class_getitem, __pyx_k_class_getitem, sizeof(__pyx_k_class_getitem), 0, 0, 1, 1},
    {&__pyx_n_s_classes, __pyx_k_classes, sizeof(__pyx_k_classes), 0, 0, 1, 1},
    {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
    {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
    {&__pyx_n_s_cls, __pyx_k_cls, sizeof(__pyx_k_cls), 0, 0, 1, 1},
    {&__pyx_n_s_cls1, __pyx_k_cls1, sizeof(__pyx_k_cls1), 0, 0, 1, 1},
    {&__pyx_n_s_cls2, __pyx_k_cls2, sizeof(__pyx_k_cls2), 0, 0, 1, 1},
    {&__pyx_kp_u_cluster_d, __pyx_k_cluster_d, sizeof(__pyx_k_cluster_d), 0, 1, 0, 0},
    {&__pyx_n_s_cm, __pyx_k_cm, sizeof(__pyx_k_cm), 0, 0, 1, 1},
    {&__pyx_n_u_cma, __pyx_k_cma, sizeof(__pyx_k_cma), 0, 1, 0, 1},
    {&__pyx_n_s_coef, __pyx_k_coef, sizeof(__pyx_k_coef), 0, 0, 1, 1},
    {&__pyx_n_s_coeffs, __pyx_k_coeffs, sizeof(__pyx_k_coeffs), 0, 0, 1, 1},
    {&__pyx_n_s_col, __pyx_k_col, sizeof(__pyx_k_col), 0, 0, 1, 1},
    {&__pyx_n_s_column, __pyx_k_column, sizeof(__pyx_k_column), 0, 0, 1, 1},
    {&__pyx_n_s_column2ignore, __pyx_k_column2ignore, sizeof(__pyx_k_column2ignore), 0, 0, 1, 1},
    {&__pyx_n_s_columns, __pyx_k_columns, sizeof(__pyx_k_columns), 0, 0, 1, 1},
    {&__pyx_n_u_columns, __pyx_k_columns, sizeof(__pyx_k_columns), 0, 1, 0, 1},
    {&__pyx_n_s_combinations, __pyx_k_combinations, sizeof(__pyx_k_combinations), 0, 0, 1, 1},
    {&__pyx_n_u_complete, __pyx_k_complete, sizeof(__pyx_k_complete), 0, 1, 0, 1},
    {&__pyx_n_s_compute_balance_accuracy, __pyx_k_compute_balance_accuracy, sizeof(__pyx_k_compute_balance_accuracy), 0, 0, 1, 1},
    {&__pyx_n_u_compute_balance_accuracy, __pyx_k_compute_balance_accuracy, sizeof(__pyx_k_compute_balance_accuracy), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_balance_accuracy_line_24, __pyx_k_compute_balance_accuracy_line_24, sizeof(__pyx_k_compute_balance_accuracy_line_24), 0, 1, 0, 0},
    {&__pyx_n_s_compute_balanced_accuracy_binar, __pyx_k_compute_balanced_accuracy_binar, sizeof(__pyx_k_compute_balanced_accuracy_binar), 0, 0, 1, 1},
    {&__pyx_n_s_compute_cost_based_threshold, __pyx_k_compute_cost_based_threshold, sizeof(__pyx_k_compute_cost_based_threshold), 0, 0, 1, 1},
    {&__pyx_n_u_compute_cost_based_threshold, __pyx_k_compute_cost_based_threshold, sizeof(__pyx_k_compute_cost_based_threshold), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_cost_based_threshold_lin, __pyx_k_compute_cost_based_threshold_lin, sizeof(__pyx_k_compute_cost_based_threshold_lin), 0, 1, 0, 0},
    {&__pyx_n_s_compute_effort_yield, __pyx_k_compute_effort_yield, sizeof(__pyx_k_compute_effort_yield), 0, 0, 1, 1},
    {&__pyx_n_u_compute_effort_yield, __pyx_k_compute_effort_yield, sizeof(__pyx_k_compute_effort_yield), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_effort_yield_line_2440, __pyx_k_compute_effort_yield_line_2440, sizeof(__pyx_k_compute_effort_yield_line_2440), 0, 1, 0, 0},
    {&__pyx_n_s_compute_errors, __pyx_k_compute_errors, sizeof(__pyx_k_compute_errors), 0, 0, 1, 1},
    {&__pyx_n_u_compute_errors, __pyx_k_compute_errors, sizeof(__pyx_k_compute_errors), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_errors_line_4287, __pyx_k_compute_errors_line_4287, sizeof(__pyx_k_compute_errors_line_4287), 0, 1, 0, 0},
    {&__pyx_n_s_compute_ovo_sens_spec, __pyx_k_compute_ovo_sens_spec, sizeof(__pyx_k_compute_ovo_sens_spec), 0, 0, 1, 1},
    {&__pyx_kp_u_compute_ovo_sens_spec_line_1140, __pyx_k_compute_ovo_sens_spec_line_1140, sizeof(__pyx_k_compute_ovo_sens_spec_line_1140), 0, 1, 0, 0},
    {&__pyx_n_s_compute_p_values, __pyx_k_compute_p_values, sizeof(__pyx_k_compute_p_values), 0, 0, 1, 1},
    {&__pyx_n_u_compute_p_values, __pyx_k_compute_p_values, sizeof(__pyx_k_compute_p_values), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_p_values_line_97, __pyx_k_compute_p_values_line_97, sizeof(__pyx_k_compute_p_values_line_97), 0, 1, 0, 0},
    {&__pyx_n_s_compute_sensitivity_specificity, __pyx_k_compute_sensitivity_specificity, sizeof(__pyx_k_compute_sensitivity_specificity), 0, 0, 1, 1},
    {&__pyx_n_s_compute_sensitivity_specificity_2, __pyx_k_compute_sensitivity_specificity_2, sizeof(__pyx_k_compute_sensitivity_specificity_2), 0, 0, 1, 1},
    {&__pyx_n_u_compute_sensitivity_specificity_2, __pyx_k_compute_sensitivity_specificity_2, sizeof(__pyx_k_compute_sensitivity_specificity_2), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_sensitivity_specificity_3, __pyx_k_compute_sensitivity_specificity_3, sizeof(__pyx_k_compute_sensitivity_specificity_3), 0, 1, 0, 0},
    {&__pyx_kp_u_compute_sensitivity_specificity_4, __pyx_k_compute_sensitivity_specificity_4, sizeof(__pyx_k_compute_sensitivity_specificity_4), 0, 1, 0, 0},
    {&__pyx_n_s_compute_spearmanr, __pyx_k_compute_spearmanr, sizeof(__pyx_k_compute_spearmanr), 0, 0, 1, 1},
    {&__pyx_n_s_compute_spearmanr_locals__weigh, __pyx_k_compute_spearmanr_locals__weigh, sizeof(__pyx_k_compute_spearmanr_locals__weigh), 0, 0, 1, 1},
    {&__pyx_n_s_compute_sunburst_data, __pyx_k_compute_sunburst_data, sizeof(__pyx_k_compute_sunburst_data), 0, 0, 1, 1},
    {&__pyx_n_u_compute_sunburst_data, __pyx_k_compute_sunburst_data, sizeof(__pyx_k_compute_sunburst_data), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_sunburst_data_line_2348, __pyx_k_compute_sunburst_data_line_2348, sizeof(__pyx_k_compute_sunburst_data_line_2348), 0, 1, 0, 0},
    {&__pyx_n_s_compute_youdens_index, __pyx_k_compute_youdens_index, sizeof(__pyx_k_compute_youdens_index), 0, 0, 1, 1},
    {&__pyx_n_u_compute_youdens_index, __pyx_k_compute_youdens_index, sizeof(__pyx_k_compute_youdens_index), 0, 1, 0, 1},
    {&__pyx_kp_u_compute_youdens_index_line_466, __pyx_k_compute_youdens_index_line_466, sizeof(__pyx_k_compute_youdens_index_line_466), 0, 1, 0, 0},
    {&__pyx_n_s_concat, __pyx_k_concat, sizeof(__pyx_k_concat), 0, 0, 1, 1},
    {&__pyx_n_s_concat_array_from_list, __pyx_k_concat_array_from_list, sizeof(__pyx_k_concat_array_from_list), 0, 0, 1, 1},
    {&__pyx_n_s_concat_axis, __pyx_k_concat_axis, sizeof(__pyx_k_concat_axis), 0, 0, 1, 1},
    {&__pyx_n_s_concatenate, __pyx_k_concatenate, sizeof(__pyx_k_concatenate), 0, 0, 1, 1},
    {&__pyx_n_u_condens, __pyx_k_condens, sizeof(__pyx_k_condens), 0, 1, 0, 1},
    {&__pyx_n_u_condense, __pyx_k_condense, sizeof(__pyx_k_condense), 0, 1, 0, 1},
    {&__pyx_n_s_confusion_matrix, __pyx_k_confusion_matrix, sizeof(__pyx_k_confusion_matrix), 0, 0, 1, 1},
    {&__pyx_n_s_consensus, __pyx_k_consensus, sizeof(__pyx_k_consensus), 0, 0, 1, 1},
    {&__pyx_n_u_consensus, __pyx_k_consensus, sizeof(__pyx_k_consensus), 0, 1, 0, 1},
    {&__pyx_n_u_constant, __pyx_k_constant, sizeof(__pyx_k_constant), 0, 1, 0, 1},
    {&__pyx_n_u_contains, __pyx_k_contains, sizeof(__pyx_k_contains), 0, 1, 0, 1},
    {&__pyx_n_u_continuous, __pyx_k_continuous, sizeof(__pyx_k_continuous), 0, 1, 0, 1},
    {&__pyx_n_s_control_vars, __pyx_k_control_vars, sizeof(__pyx_k_control_vars), 0, 0, 1, 1},
    {&__pyx_n_u_conv, __pyx_k_conv, sizeof(__pyx_k_conv), 0, 1, 0, 1},
    {&__pyx_n_s_convert_distance_to_m, __pyx_k_convert_distance_to_m, sizeof(__pyx_k_convert_distance_to_m), 0, 0, 1, 1},
    {&__pyx_n_s_converter, __pyx_k_converter, sizeof(__pyx_k_converter), 0, 0, 1, 1},
    {&__pyx_n_s_convolve, __pyx_k_convolve, sizeof(__pyx_k_convolve), 0, 0, 1, 1},
    {&__pyx_n_s_convolve1d, __pyx_k_convolve1d, sizeof(__pyx_k_convolve1d), 0, 0, 1, 1},
    {&__pyx_n_s_copy, __pyx_k_copy, sizeof(__pyx_k_copy), 0, 0, 1, 1},
    {&__pyx_n_s_coreutils, __pyx_k_coreutils, sizeof(__pyx_k_coreutils), 0, 0, 1, 1},
    {&__pyx_n_s_corr, __pyx_k_corr, sizeof(__pyx_k_corr), 0, 0, 1, 1},
    {&__pyx_n_s_corr_func, __pyx_k_corr_func, sizeof(__pyx_k_corr_func), 0, 0, 1, 1},
    {&__pyx_n_s_corr_methods, __pyx_k_corr_methods, sizeof(__pyx_k_corr_methods), 0, 0, 1, 1},
    {&__pyx_n_s_corrcoef, __pyx_k_corrcoef, sizeof(__pyx_k_corrcoef), 0, 0, 1, 1},
    {&__pyx_n_s_cos, __pyx_k_cos, sizeof(__pyx_k_cos), 0, 0, 1, 1},
    {&__pyx_n_s_cost_history, __pyx_k_cost_history, sizeof(__pyx_k_cost_history), 0, 0, 1, 1},
    {&__pyx_n_s_costs, __pyx_k_costs, sizeof(__pyx_k_costs), 0, 0, 1, 1},
    {&__pyx_n_u_costs, __pyx_k_costs, sizeof(__pyx_k_costs), 0, 1, 0, 1},
    {&__pyx_kp_u_could_not_convert_string_to_floa, __pyx_k_could_not_convert_string_to_floa, sizeof(__pyx_k_could_not_convert_string_to_floa), 0, 1, 0, 0},
    {&__pyx_n_s_count, __pyx_k_count, sizeof(__pyx_k_count), 0, 0, 1, 1},
    {&__pyx_n_u_count, __pyx_k_count, sizeof(__pyx_k_count), 0, 1, 0, 1},
    {&__pyx_n_s_count_local_minima, __pyx_k_count_local_minima, sizeof(__pyx_k_count_local_minima), 0, 0, 1, 1},
    {&__pyx_kp_u_count_local_minima_line_3171, __pyx_k_count_local_minima_line_3171, sizeof(__pyx_k_count_local_minima_line_3171), 0, 1, 0, 0},
    {&__pyx_n_s_counts, __pyx_k_counts, sizeof(__pyx_k_counts), 0, 0, 1, 1},
    {&__pyx_n_s_cov, __pyx_k_cov, sizeof(__pyx_k_cov), 0, 0, 1, 1},
    {&__pyx_n_s_cubic_regression, __pyx_k_cubic_regression, sizeof(__pyx_k_cubic_regression), 0, 0, 1, 1},
    {&__pyx_n_u_cubic_regression, __pyx_k_cubic_regression, sizeof(__pyx_k_cubic_regression), 0, 1, 0, 1},
    {&__pyx_n_s_cum_weights, __pyx_k_cum_weights, sizeof(__pyx_k_cum_weights), 0, 0, 1, 1},
    {&__pyx_n_s_cumsum, __pyx_k_cumsum, sizeof(__pyx_k_cumsum), 0, 0, 1, 1},
    {&__pyx_n_u_cumulative, __pyx_k_cumulative, sizeof(__pyx_k_cumulative), 0, 1, 0, 1},
    {&__pyx_kp_u_cumulative_average, __pyx_k_cumulative_average, sizeof(__pyx_k_cumulative_average), 0, 1, 0, 0},
    {&__pyx_n_s_cumulative_data, __pyx_k_cumulative_data, sizeof(__pyx_k_cumulative_data), 0, 0, 1, 1},
    {&__pyx_n_s_curve_fit, __pyx_k_curve_fit, sizeof(__pyx_k_curve_fit), 0, 0, 1, 1},
    {&__pyx_kp_u_custom_logic, __pyx_k_custom_logic, sizeof(__pyx_k_custom_logic), 0, 1, 0, 0},
    {&__pyx_n_s_cval, __pyx_k_cval, sizeof(__pyx_k_cval), 0, 0, 1, 1},
    {&__pyx_n_s_d, __pyx_k_d, sizeof(__pyx_k_d), 0, 0, 1, 1},
    {&__pyx_n_s_data, __pyx_k_data, sizeof(__pyx_k_data), 0, 0, 1, 1},
    {&__pyx_n_u_data, __pyx_k_data, sizeof(__pyx_k_data), 0, 1, 0, 1},
    {&__pyx_n_s_data_2, __pyx_k_data_2, sizeof(__pyx_k_data_2), 0, 0, 1, 1},
    {&__pyx_n_s_data_max, __pyx_k_data_max, sizeof(__pyx_k_data_max), 0, 0, 1, 1},
    {&__pyx_n_s_data_min, __pyx_k_data_min, sizeof(__pyx_k_data_min), 0, 0, 1, 1},
    {&__pyx_n_s_data_range, __pyx_k_data_range, sizeof(__pyx_k_data_range), 0, 0, 1, 1},
    {&__pyx_kp_u_data_range_must_be_a_tuple_of_tw, __pyx_k_data_range_must_be_a_tuple_of_tw, sizeof(__pyx_k_data_range_must_be_a_tuple_of_tw), 0, 1, 0, 0},
    {&__pyx_kp_u_data_range_must_contain_numeric, __pyx_k_data_range_must_contain_numeric, sizeof(__pyx_k_data_range_must_contain_numeric), 0, 1, 0, 0},
    {&__pyx_kp_u_data_should_be_a_frame_not, __pyx_k_data_should_be_a_frame_not, sizeof(__pyx_k_data_should_be_a_frame_not), 0, 1, 0, 0},
    {&__pyx_n_s_ddof, __pyx_k_ddof, sizeof(__pyx_k_ddof), 0, 0, 1, 1},
    {&__pyx_n_s_decorators, __pyx_k_decorators, sizeof(__pyx_k_decorators), 0, 0, 1, 1},
    {&__pyx_n_s_deep, __pyx_k_deep, sizeof(__pyx_k_deep), 0, 0, 1, 1},
    {&__pyx_n_s_deepcopy, __pyx_k_deepcopy, sizeof(__pyx_k_deepcopy), 0, 0, 1, 1},
    {&__pyx_n_s_default, __pyx_k_default, sizeof(__pyx_k_default), 0, 0, 1, 1},
    {&__pyx_n_s_defaults, __pyx_k_defaults, sizeof(__pyx_k_defaults), 0, 0, 1, 1},
    {&__pyx_n_s_deg, __pyx_k_deg, sizeof(__pyx_k_deg), 0, 0, 1, 1},
    {&__pyx_n_s_deg2rad, __pyx_k_deg2rad, sizeof(__pyx_k_deg2rad), 0, 0, 1, 1},
    {&__pyx_n_s_degree, __pyx_k_degree, sizeof(__pyx_k_degree), 0, 0, 1, 1},
    {&__pyx_n_s_delete, __pyx_k_delete, sizeof(__pyx_k_delete), 0, 0, 1, 1},
    {&__pyx_n_s_delta, __pyx_k_delta, sizeof(__pyx_k_delta), 0, 0, 1, 1},
    {&__pyx_n_u_dense, __pyx_k_dense, sizeof(__pyx_k_dense), 0, 1, 0, 1},
    {&__pyx_n_s_dense_rank, __pyx_k_dense_rank, sizeof(__pyx_k_dense_rank), 0, 0, 1, 1},
    {&__pyx_n_s_depvar, __pyx_k_depvar, sizeof(__pyx_k_depvar), 0, 0, 1, 1},
    {&__pyx_n_u_depvar, __pyx_k_depvar, sizeof(__pyx_k_depvar), 0, 1, 0, 1},
    {&__pyx_n_s_deriv, __pyx_k_deriv, sizeof(__pyx_k_deriv), 0, 0, 1, 1},
    {&__pyx_n_u_design, __pyx_k_design, sizeof(__pyx_k_design), 0, 1, 0, 1},
    {&__pyx_n_s_detect_station_position, __pyx_k_detect_station_position, sizeof(__pyx_k_detect_station_position), 0, 0, 1, 1},
    {&__pyx_kp_u_detect_station_position_line_374, __pyx_k_detect_station_position_line_374, sizeof(__pyx_k_detect_station_position_line_374), 0, 1, 0, 0},
    {&__pyx_n_s_determine_epsilon, __pyx_k_determine_epsilon, sizeof(__pyx_k_determine_epsilon), 0, 0, 1, 1},
    {&__pyx_n_s_df, __pyx_k_df, sizeof(__pyx_k_df), 0, 0, 1, 1},
    {&__pyx_n_s_df_full, __pyx_k_df_full, sizeof(__pyx_k_df_full), 0, 0, 1, 1},
    {&__pyx_n_s_df_level, __pyx_k_df_level, sizeof(__pyx_k_df_level), 0, 0, 1, 1},
    {&__pyx_n_s_df_only, __pyx_k_df_only, sizeof(__pyx_k_df_only), 0, 0, 1, 1},
    {&__pyx_n_s_diag, __pyx_k_diag, sizeof(__pyx_k_diag), 0, 0, 1, 1},
    {&__pyx_n_s_diff, __pyx_k_diff, sizeof(__pyx_k_diff), 0, 0, 1, 1},
    {&__pyx_n_s_digitize, __pyx_k_digitize, sizeof(__pyx_k_digitize), 0, 0, 1, 1},
    {&__pyx_n_s_digitized, __pyx_k_digitized, sizeof(__pyx_k_digitized), 0, 0, 1, 1},
    {&__pyx_n_s_dipole, __pyx_k_dipole, sizeof(__pyx_k_dipole), 0, 0, 1, 1},
    {&__pyx_kp_u_disable, __pyx_k_disable, sizeof(__pyx_k_disable), 0, 1, 0, 0},
    {&__pyx_n_s_distance, __pyx_k_distance, sizeof(__pyx_k_distance), 0, 0, 1, 1},
    {&__pyx_n_u_distance, __pyx_k_distance, sizeof(__pyx_k_distance), 0, 1, 0, 1},
    {&__pyx_n_s_dl, __pyx_k_dl, sizeof(__pyx_k_dl), 0, 0, 1, 1},
    {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
    {&__pyx_n_s_dot, __pyx_k_dot, sizeof(__pyx_k_dot), 0, 0, 1, 1},
    {&__pyx_n_u_dot, __pyx_k_dot, sizeof(__pyx_k_dot), 0, 1, 0, 1},
    {&__pyx_n_s_dp, __pyx_k_dp, sizeof(__pyx_k_dp), 0, 0, 1, 1},
    {&__pyx_n_s_drop, __pyx_k_drop, sizeof(__pyx_k_drop), 0, 0, 1, 1},
    {&__pyx_n_s_drop_duplicates, __pyx_k_drop_duplicates, sizeof(__pyx_k_drop_duplicates), 0, 0, 1, 1},
    {&__pyx_n_s_drop_intermediate, __pyx_k_drop_intermediate, sizeof(__pyx_k_drop_intermediate), 0, 0, 1, 1},
    {&__pyx_n_s_dtype, __pyx_k_dtype, sizeof(__pyx_k_dtype), 0, 0, 1, 1},
    {&__pyx_n_s_dx, __pyx_k_dx, sizeof(__pyx_k_dx), 0, 0, 1, 1},
    {&__pyx_n_s_dy, __pyx_k_dy, sizeof(__pyx_k_dy), 0, 0, 1, 1},
    {&__pyx_n_s_easting, __pyx_k_easting, sizeof(__pyx_k_easting), 0, 0, 1, 1},
    {&__pyx_n_s_effort, __pyx_k_effort, sizeof(__pyx_k_effort), 0, 0, 1, 1},
    {&__pyx_n_s_ellipsis2false, __pyx_k_ellipsis2false, sizeof(__pyx_k_ellipsis2false), 0, 0, 1, 1},
    {&__pyx_n_u_ema, __pyx_k_ema, sizeof(__pyx_k_ema), 0, 1, 0, 1},
    {&__pyx_n_s_empty, __pyx_k_empty, sizeof(__pyx_k_empty), 0, 0, 1, 1},
    {&__pyx_n_s_empty_like, __pyx_k_empty_like, sizeof(__pyx_k_empty_like), 0, 0, 1, 1},
    {&__pyx_kp_u_enable, __pyx_k_enable, sizeof(__pyx_k_enable), 0, 1, 0, 0},
    {&__pyx_n_s_end, __pyx_k_end, sizeof(__pyx_k_end), 0, 0, 1, 1},
    {&__pyx_n_s_ensure_2d, __pyx_k_ensure_2d, sizeof(__pyx_k_ensure_2d), 0, 0, 1, 1},
    {&__pyx_n_s_ensure_non_negative, __pyx_k_ensure_non_negative, sizeof(__pyx_k_ensure_non_negative), 0, 0, 1, 1},
    {&__pyx_n_s_ensure_y_is_valid, __pyx_k_ensure_y_is_valid, sizeof(__pyx_k_ensure_y_is_valid), 0, 0, 1, 1},
    {&__pyx_n_s_enter, __pyx_k_enter, sizeof(__pyx_k_enter), 0, 0, 1, 1},
    {&__pyx_n_s_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 0, 0, 1, 1},
    {&__pyx_n_s_epsilon, __pyx_k_epsilon, sizeof(__pyx_k_epsilon), 0, 0, 1, 1},
    {&__pyx_n_s_err, __pyx_k_err, sizeof(__pyx_k_err), 0, 0, 1, 1},
    {&__pyx_n_s_err_lower, __pyx_k_err_lower, sizeof(__pyx_k_err_lower), 0, 0, 1, 1},
    {&__pyx_n_s_err_msg, __pyx_k_err_msg, sizeof(__pyx_k_err_msg), 0, 0, 1, 1},
    {&__pyx_n_s_err_upper, __pyx_k_err_upper, sizeof(__pyx_k_err_upper), 0, 0, 1, 1},
    {&__pyx_n_s_error, __pyx_k_error, sizeof(__pyx_k_error), 0, 0, 1, 1},
    {&__pyx_n_u_error, __pyx_k_error, sizeof(__pyx_k_error), 0, 1, 0, 1},
    {&__pyx_n_s_error_msg, __pyx_k_error_msg, sizeof(__pyx_k_error_msg), 0, 0, 1, 1},
    {&__pyx_n_s_errstate, __pyx_k_errstate, sizeof(__pyx_k_errstate), 0, 0, 1, 1},
    {&__pyx_n_s_estimator, __pyx_k_estimator, sizeof(__pyx_k_estimator), 0, 0, 1, 1},
    {&__pyx_n_s_estimators, __pyx_k_estimators, sizeof(__pyx_k_estimators), 0, 0, 1, 1},
    {&__pyx_n_u_euclidean, __pyx_k_euclidean, sizeof(__pyx_k_euclidean), 0, 1, 0, 1},
    {&__pyx_n_s_exceptions, __pyx_k_exceptions, sizeof(__pyx_k_exceptions), 0, 0, 1, 1},
    {&__pyx_n_s_exclude_string, __pyx_k_exclude_string, sizeof(__pyx_k_exclude_string), 0, 0, 1, 1},
    {&__pyx_n_s_exclude_value, __pyx_k_exclude_value, sizeof(__pyx_k_exclude_value), 0, 0, 1, 1},
    {&__pyx_n_s_exit, __pyx_k_exit, sizeof(__pyx_k_exit), 0, 0, 1, 1},
    {&__pyx_n_s_exp, __pyx_k_exp, sizeof(__pyx_k_exp), 0, 0, 1, 1},
    {&__pyx_n_s_expect_name, __pyx_k_expect_name, sizeof(__pyx_k_expect_name), 0, 0, 1, 1},
    {&__pyx_n_u_exponential, __pyx_k_exponential, sizeof(__pyx_k_exponential), 0, 1, 0, 1},
    {&__pyx_kp_u_exponential_moving_average, __pyx_k_exponential_moving_average, sizeof(__pyx_k_exponential_moving_average), 0, 1, 0, 0},
    {&__pyx_n_s_exponential_regression, __pyx_k_exponential_regression, sizeof(__pyx_k_exponential_regression), 0, 0, 1, 1},
    {&__pyx_n_u_exponential_regression, __pyx_k_exponential_regression, sizeof(__pyx_k_exponential_regression), 0, 1, 0, 1},
    {&__pyx_kp_u_extra_azimuth, __pyx_k_extra_azimuth, sizeof(__pyx_k_extra_azimuth), 0, 1, 0, 0},
    {&__pyx_n_s_extrapolate, __pyx_k_extrapolate, sizeof(__pyx_k_extrapolate), 0, 0, 1, 1},
    {&__pyx_n_s_false_negatives, __pyx_k_false_negatives, sizeof(__pyx_k_false_negatives), 0, 0, 1, 1},
    {&__pyx_n_s_false_positives, __pyx_k_false_positives, sizeof(__pyx_k_false_positives), 0, 0, 1, 1},
    {&__pyx_n_s_fig, __pyx_k_fig, sizeof(__pyx_k_fig), 0, 0, 1, 1},
    {&__pyx_n_s_figsize, __pyx_k_figsize, sizeof(__pyx_k_figsize), 0, 0, 1, 1},
    {&__pyx_n_s_filtering_1d_array, __pyx_k_filtering_1d_array, sizeof(__pyx_k_filtering_1d_array), 0, 0, 1, 1},
    {&__pyx_n_s_filterwarnings, __pyx_k_filterwarnings, sizeof(__pyx_k_filterwarnings), 0, 0, 1, 1},
    {&__pyx_n_s_find, __pyx_k_find, sizeof(__pyx_k_find), 0, 0, 1, 1},
    {&__pyx_n_s_find_close_position, __pyx_k_find_close_position, sizeof(__pyx_k_find_close_position), 0, 0, 1, 1},
    {&__pyx_n_s_find_closest, __pyx_k_find_closest, sizeof(__pyx_k_find_closest), 0, 0, 1, 1},
    {&__pyx_kp_u_find_closest_line_4771, __pyx_k_find_closest_line_4771, sizeof(__pyx_k_find_closest_line_4771), 0, 1, 0, 0},
    {&__pyx_n_s_fit, __pyx_k_fit, sizeof(__pyx_k_fit), 0, 0, 1, 1},
    {&__pyx_kp_u_fit_a_5_3f_b_5_3f, __pyx_k_fit_a_5_3f_b_5_3f, sizeof(__pyx_k_fit_a_5_3f_b_5_3f), 0, 1, 0, 0},
    {&__pyx_n_s_fit_edge, __pyx_k_fit_edge, sizeof(__pyx_k_fit_edge), 0, 0, 1, 1},
    {&__pyx_n_s_fit_edges_polyfit, __pyx_k_fit_edges_polyfit, sizeof(__pyx_k_fit_edges_polyfit), 0, 0, 1, 1},
    {&__pyx_n_s_fit_transform, __pyx_k_fit_transform, sizeof(__pyx_k_fit_transform), 0, 0, 1, 1},
    {&__pyx_n_s_float, __pyx_k_float, sizeof(__pyx_k_float), 0, 0, 1, 1},
    {&__pyx_n_u_float, __pyx_k_float, sizeof(__pyx_k_float), 0, 1, 0, 1},
    {&__pyx_n_s_float32, __pyx_k_float32, sizeof(__pyx_k_float32), 0, 0, 1, 1},
    {&__pyx_n_s_float64, __pyx_k_float64, sizeof(__pyx_k_float64), 0, 0, 1, 1},
    {&__pyx_n_s_float_factorial, __pyx_k_float_factorial, sizeof(__pyx_k_float_factorial), 0, 0, 1, 1},
    {&__pyx_n_s_format, __pyx_k_format, sizeof(__pyx_k_format), 0, 0, 1, 1},
    {&__pyx_n_s_fpr, __pyx_k_fpr, sizeof(__pyx_k_fpr), 0, 0, 1, 1},
    {&__pyx_n_u_freedman_diaconis, __pyx_k_freedman_diaconis, sizeof(__pyx_k_freedman_diaconis), 0, 1, 0, 1},
    {&__pyx_n_s_from0, __pyx_k_from0, sizeof(__pyx_k_from0), 0, 0, 1, 1},
    {&__pyx_n_s_func, __pyx_k_func, sizeof(__pyx_k_func), 0, 0, 1, 1},
    {&__pyx_kp_u_func_argument_is_a_callable_not, __pyx_k_func_argument_is_a_callable_not, sizeof(__pyx_k_func_argument_is_a_callable_not), 0, 1, 0, 0},
    {&__pyx_kp_u_gc, __pyx_k_gc, sizeof(__pyx_k_gc), 0, 1, 0, 0},
    {&__pyx_n_s_genexpr, __pyx_k_genexpr, sizeof(__pyx_k_genexpr), 0, 0, 1, 1},
    {&__pyx_n_s_get, __pyx_k_get, sizeof(__pyx_k_get), 0, 0, 1, 1},
    {&__pyx_n_s_get_azimuth, __pyx_k_get_azimuth, sizeof(__pyx_k_get_azimuth), 0, 0, 1, 1},
    {&__pyx_kp_u_get_azimuth_line_3229, __pyx_k_get_azimuth_line_3229, sizeof(__pyx_k_get_azimuth_line_3229), 0, 1, 0, 0},
    {&__pyx_n_s_get_azimuth_locals_lambda, __pyx_k_get_azimuth_locals_lambda, sizeof(__pyx_k_get_azimuth_locals_lambda), 0, 0, 1, 1},
    {&__pyx_n_s_get_bearing, __pyx_k_get_bearing, sizeof(__pyx_k_get_bearing), 0, 0, 1, 1},
    {&__pyx_n_u_get_bearing, __pyx_k_get_bearing, sizeof(__pyx_k_get_bearing), 0, 1, 0, 1},
    {&__pyx_kp_u_get_bearing_line_4703, __pyx_k_get_bearing_line_4703, sizeof(__pyx_k_get_bearing_line_4703), 0, 1, 0, 0},
    {&__pyx_n_s_get_distance, __pyx_k_get_distance, sizeof(__pyx_k_get_distance), 0, 0, 1, 1},
    {&__pyx_n_u_get_distance, __pyx_k_get_distance, sizeof(__pyx_k_get_distance), 0, 1, 0, 1},
    {&__pyx_kp_u_get_distance_line_4518, __pyx_k_get_distance_line_4518, sizeof(__pyx_k_get_distance_line_4518), 0, 1, 0, 0},
    {&__pyx_n_s_get_gofast_logger, __pyx_k_get_gofast_logger, sizeof(__pyx_k_get_gofast_logger), 0, 0, 1, 1},
    {&__pyx_n_s_get_profile_angle, __pyx_k_get_profile_angle, sizeof(__pyx_k_get_profile_angle), 0, 0, 1, 1},
    {&__pyx_n_s_get_station_number, __pyx_k_get_station_number, sizeof(__pyx_k_get_station_number), 0, 0, 1, 1},
    {&__pyx_n_s_gofast_tools_mathex, __pyx_k_gofast_tools_mathex, sizeof(__pyx_k_gofast_tools_mathex), 0, 0, 1, 1},
    {&__pyx_kp_s_gofast_tools_mathex_pyx, __pyx_k_gofast_tools_mathex_pyx, sizeof(__pyx_k_gofast_tools_mathex_pyx), 0, 0, 1, 0},
    {&__pyx_n_s_gofastlog, __pyx_k_gofastlog, sizeof(__pyx_k_gofastlog), 0, 0, 1, 1},
    {&__pyx_n_s_gofastlog_2, __pyx_k_gofastlog_2, sizeof(__pyx_k_gofastlog_2), 0, 0, 1, 1},
    {&__pyx_n_s_gradient_boosting_regressor, __pyx_k_gradient_boosting_regressor, sizeof(__pyx_k_gradient_boosting_regressor), 0, 0, 1, 1},
    {&__pyx_kp_u_gradient_boosting_regressor_line, __pyx_k_gradient_boosting_regressor_line, sizeof(__pyx_k_gradient_boosting_regressor_line), 0, 1, 0, 0},
    {&__pyx_n_s_gradient_descent, __pyx_k_gradient_descent, sizeof(__pyx_k_gradient_descent), 0, 0, 1, 1},
    {&__pyx_kp_u_gradient_descent_line_4820, __pyx_k_gradient_descent_line_4820, sizeof(__pyx_k_gradient_descent_line_4820), 0, 1, 0, 0},
    {&__pyx_n_s_group, __pyx_k_group, sizeof(__pyx_k_group), 0, 0, 1, 1},
    {&__pyx_n_s_groupby, __pyx_k_groupby, sizeof(__pyx_k_groupby), 0, 0, 1, 1},
    {&__pyx_n_s_halflen, __pyx_k_halflen, sizeof(__pyx_k_halflen), 0, 0, 1, 1},
    {&__pyx_n_s_hierarchy, __pyx_k_hierarchy, sizeof(__pyx_k_hierarchy), 0, 0, 1, 1},
    {&__pyx_n_s_histogram_bin_edges, __pyx_k_histogram_bin_edges, sizeof(__pyx_k_histogram_bin_edges), 0, 0, 1, 1},
    {&__pyx_n_s_hstack, __pyx_k_hstack, sizeof(__pyx_k_hstack), 0, 0, 1, 1},
    {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
    {&__pyx_n_s_idx, __pyx_k_idx, sizeof(__pyx_k_idx), 0, 0, 1, 1},
    {&__pyx_n_s_ignore, __pyx_k_ignore, sizeof(__pyx_k_ignore), 0, 0, 1, 1},
    {&__pyx_n_u_ignore, __pyx_k_ignore, sizeof(__pyx_k_ignore), 0, 1, 0, 1},
    {&__pyx_n_s_ignore_index, __pyx_k_ignore_index, sizeof(__pyx_k_ignore_index), 0, 0, 1, 1},
    {&__pyx_n_s_ii, __pyx_k_ii, sizeof(__pyx_k_ii), 0, 0, 1, 1},
    {&__pyx_n_s_iloc, __pyx_k_iloc, sizeof(__pyx_k_iloc), 0, 0, 1, 1},
    {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
    {&__pyx_n_s_in_bin, __pyx_k_in_bin, sizeof(__pyx_k_in_bin), 0, 0, 1, 1},
    {&__pyx_n_s_in_percent, __pyx_k_in_percent, sizeof(__pyx_k_in_percent), 0, 0, 1, 1},
    {&__pyx_n_s_include_label, __pyx_k_include_label, sizeof(__pyx_k_include_label), 0, 0, 1, 1},
    {&__pyx_n_s_include_metrics, __pyx_k_include_metrics, sizeof(__pyx_k_include_metrics), 0, 0, 1, 1},
    {&__pyx_n_s_include_nan, __pyx_k_include_nan, sizeof(__pyx_k_include_nan), 0, 0, 1, 1},
    {&__pyx_n_s_index, __pyx_k_index, sizeof(__pyx_k_index), 0, 0, 1, 1},
    {&__pyx_n_u_inf, __pyx_k_inf, sizeof(__pyx_k_inf), 0, 1, 0, 1},
    {&__pyx_n_s_infer_sankey_columns, __pyx_k_infer_sankey_columns, sizeof(__pyx_k_infer_sankey_columns), 0, 0, 1, 1},
    {&__pyx_n_u_infer_sankey_columns, __pyx_k_infer_sankey_columns, sizeof(__pyx_k_infer_sankey_columns), 0, 1, 0, 1},
    {&__pyx_kp_u_infer_sankey_columns_line_2272, __pyx_k_infer_sankey_columns_line_2272, sizeof(__pyx_k_infer_sankey_columns_line_2272), 0, 1, 0, 0},
    {&__pyx_n_s_init_weights, __pyx_k_init_weights, sizeof(__pyx_k_init_weights), 0, 0, 1, 1},
    {&__pyx_n_s_initializing, __pyx_k_initializing, sizeof(__pyx_k_initializing), 0, 0, 1, 1},
    {&__pyx_n_s_input_name, __pyx_k_input_name, sizeof(__pyx_k_input_name), 0, 0, 1, 1},
    {&__pyx_n_s_inspect, __pyx_k_inspect, sizeof(__pyx_k_inspect), 0, 0, 1, 1},
    {&__pyx_kp_u_instead_of, __pyx_k_instead_of, sizeof(__pyx_k_instead_of), 0, 1, 0, 0},
    {&__pyx_n_s_int, __pyx_k_int, sizeof(__pyx_k_int), 0, 0, 1, 1},
    {&__pyx_n_s_int32, __pyx_k_int32, sizeof(__pyx_k_int32), 0, 0, 1, 1},
    {&__pyx_n_u_interp, __pyx_k_interp, sizeof(__pyx_k_interp), 0, 1, 0, 1},
    {&__pyx_n_s_interp_start, __pyx_k_interp_start, sizeof(__pyx_k_interp_start), 0, 0, 1, 1},
    {&__pyx_n_s_interp_stop, __pyx_k_interp_stop, sizeof(__pyx_k_interp_stop), 0, 0, 1, 1},
    {&__pyx_n_s_inv, __pyx_k_inv, sizeof(__pyx_k_inv), 0, 0, 1, 1},
    {&__pyx_n_s_inverse_transform, __pyx_k_inverse_transform, sizeof(__pyx_k_inverse_transform), 0, 0, 1, 1},
    {&__pyx_n_s_involved_pairs, __pyx_k_involved_pairs, sizeof(__pyx_k_involved_pairs), 0, 0, 1, 1},
    {&__pyx_n_s_iqr, __pyx_k_iqr, sizeof(__pyx_k_iqr), 0, 0, 1, 1},
    {&__pyx_n_s_is_arraylike_1d, __pyx_k_is_arraylike_1d, sizeof(__pyx_k_is_arraylike_1d), 0, 0, 1, 1},
    {&__pyx_n_s_is_binary_class, __pyx_k_is_binary_class, sizeof(__pyx_k_is_binary_class), 0, 0, 1, 1},
    {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
    {&__pyx_n_s_is_frame, __pyx_k_is_frame, sizeof(__pyx_k_is_frame), 0, 0, 1, 1},
    {&__pyx_kp_u_is_gotten, __pyx_k_is_gotten, sizeof(__pyx_k_is_gotten), 0, 1, 0, 0},
    {&__pyx_n_s_is_iterable, __pyx_k_is_iterable, sizeof(__pyx_k_is_iterable), 0, 0, 1, 1},
    {&__pyx_n_s_is_latlon, __pyx_k_is_latlon, sizeof(__pyx_k_is_latlon), 0, 0, 1, 1},
    {&__pyx_kp_u_is_not_admitted_Expect_at_least, __pyx_k_is_not_admitted_Expect_at_least, sizeof(__pyx_k_is_not_admitted_Expect_at_least), 0, 1, 0, 0},
    {&__pyx_n_s_is_numeric_dtype, __pyx_k_is_numeric_dtype, sizeof(__pyx_k_is_numeric_dtype), 0, 0, 1, 1},
    {&__pyx_kp_u_is_out_of_the_range_max_positio, __pyx_k_is_out_of_the_range_max_positio, sizeof(__pyx_k_is_out_of_the_range_max_positio), 0, 1, 0, 0},
    {&__pyx_n_s_is_utm, __pyx_k_is_utm, sizeof(__pyx_k_is_utm), 0, 0, 1, 1},
    {&__pyx_n_s_isdeg, __pyx_k_isdeg, sizeof(__pyx_k_isdeg), 0, 0, 1, 1},
    {&__pyx_n_s_isdigit, __pyx_k_isdigit, sizeof(__pyx_k_isdigit), 0, 0, 1, 1},
    {&__pyx_kp_u_isenabled, __pyx_k_isenabled, sizeof(__pyx_k_isenabled), 0, 1, 0, 0},
    {&__pyx_n_s_isfunction, __pyx_k_isfunction, sizeof(__pyx_k_isfunction), 0, 0, 1, 1},
    {&__pyx_n_s_isin, __pyx_k_isin, sizeof(__pyx_k_isin), 0, 0, 1, 1},
    {&__pyx_n_s_islatlon, __pyx_k_islatlon, sizeof(__pyx_k_islatlon), 0, 0, 1, 1},
    {&__pyx_n_s_isnan, __pyx_k_isnan, sizeof(__pyx_k_isnan), 0, 0, 1, 1},
    {&__pyx_n_s_isnull, __pyx_k_isnull, sizeof(__pyx_k_isnull), 0, 0, 1, 1},
    {&__pyx_n_s_isreal, __pyx_k_isreal, sizeof(__pyx_k_isreal), 0, 0, 1, 1},
    {&__pyx_n_s_isscalar, __pyx_k_isscalar, sizeof(__pyx_k_isscalar), 0, 0, 1, 1},
    {&__pyx_n_s_issubdtype, __pyx_k_issubdtype, sizeof(__pyx_k_issubdtype), 0, 0, 1, 1},
    {&__pyx_n_s_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
    {&__pyx_n_s_iterrows, __pyx_k_iterrows, sizeof(__pyx_k_iterrows), 0, 0, 1, 1},
    {&__pyx_n_s_itertools, __pyx_k_itertools, sizeof(__pyx_k_itertools), 0, 0, 1, 1},
    {&__pyx_n_s_iv, __pyx_k_iv, sizeof(__pyx_k_iv), 0, 0, 1, 1},
    {&__pyx_n_s_ix_c, __pyx_k_ix_c, sizeof(__pyx_k_ix_c), 0, 0, 1, 1},
    {&__pyx_n_s_j, __pyx_k_j, sizeof(__pyx_k_j), 0, 0, 1, 1},
    {&__pyx_n_s_k, __pyx_k_k, sizeof(__pyx_k_k), 0, 0, 1, 1},
    {&__pyx_n_s_keepdims, __pyx_k_keepdims, sizeof(__pyx_k_keepdims), 0, 0, 1, 1},
    {&__pyx_n_u_kendall, __pyx_k_kendall, sizeof(__pyx_k_kendall), 0, 1, 0, 1},
    {&__pyx_n_s_kendalltau, __pyx_k_kendalltau, sizeof(__pyx_k_kendalltau), 0, 0, 1, 1},
    {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
    {&__pyx_n_s_kind, __pyx_k_kind, sizeof(__pyx_k_kind), 0, 0, 1, 1},
    {&__pyx_n_s_kind_of_model, __pyx_k_kind_of_model, sizeof(__pyx_k_kind_of_model), 0, 0, 1, 1},
    {&__pyx_n_s_kind_of_model_locals_init_weigh, __pyx_k_kind_of_model_locals_init_weigh, sizeof(__pyx_k_kind_of_model_locals_init_weigh), 0, 0, 1, 1},
    {&__pyx_n_u_km, __pyx_k_km, sizeof(__pyx_k_km), 0, 1, 0, 1},
    {&__pyx_n_s_kws, __pyx_k_kws, sizeof(__pyx_k_kws), 0, 0, 1, 1},
    {&__pyx_n_s_label, __pyx_k_label, sizeof(__pyx_k_label), 0, 0, 1, 1},
    {&__pyx_n_s_label_binarize, __pyx_k_label_binarize, sizeof(__pyx_k_label_binarize), 0, 0, 1, 1},
    {&__pyx_n_s_label_i, __pyx_k_label_i, sizeof(__pyx_k_label_i), 0, 0, 1, 1},
    {&__pyx_n_s_label_importance, __pyx_k_label_importance, sizeof(__pyx_k_label_importance), 0, 0, 1, 1},
    {&__pyx_n_u_label_importance, __pyx_k_label_importance, sizeof(__pyx_k_label_importance), 0, 1, 0, 1},
    {&__pyx_kp_u_label_importance_line_2612, __pyx_k_label_importance_line_2612, sizeof(__pyx_k_label_importance_line_2612), 0, 1, 0, 0},
    {&__pyx_n_s_label_j, __pyx_k_label_j, sizeof(__pyx_k_label_j), 0, 0, 1, 1},
    {&__pyx_n_s_label_to_index, __pyx_k_label_to_index, sizeof(__pyx_k_label_to_index), 0, 0, 1, 1},
    {&__pyx_n_s_label_y, __pyx_k_label_y, sizeof(__pyx_k_label_y), 0, 0, 1, 1},
    {&__pyx_n_s_label_yt_trailer, __pyx_k_label_yt_trailer, sizeof(__pyx_k_label_yt_trailer), 0, 0, 1, 1},
    {&__pyx_n_s_labels, __pyx_k_labels, sizeof(__pyx_k_labels), 0, 0, 1, 1},
    {&__pyx_n_s_lat1, __pyx_k_lat1, sizeof(__pyx_k_lat1), 0, 0, 1, 1},
    {&__pyx_n_s_lat2, __pyx_k_lat2, sizeof(__pyx_k_lat2), 0, 0, 1, 1},
    {&__pyx_n_s_latlon1, __pyx_k_latlon1, sizeof(__pyx_k_latlon1), 0, 0, 1, 1},
    {&__pyx_n_s_latlon2, __pyx_k_latlon2, sizeof(__pyx_k_latlon2), 0, 0, 1, 1},
    {&__pyx_n_s_le, __pyx_k_le, sizeof(__pyx_k_le), 0, 0, 1, 1},
    {&__pyx_n_s_le_pred, __pyx_k_le_pred, sizeof(__pyx_k_le_pred), 0, 0, 1, 1},
    {&__pyx_n_s_le_true, __pyx_k_le_true, sizeof(__pyx_k_le_true), 0, 0, 1, 1},
    {&__pyx_n_s_learning_rate, __pyx_k_learning_rate, sizeof(__pyx_k_learning_rate), 0, 0, 1, 1},
    {&__pyx_n_s_legend, __pyx_k_legend, sizeof(__pyx_k_legend), 0, 0, 1, 1},
    {&__pyx_n_s_less, __pyx_k_less, sizeof(__pyx_k_less), 0, 0, 1, 1},
    {&__pyx_n_s_linalg, __pyx_k_linalg, sizeof(__pyx_k_linalg), 0, 0, 1, 1},
    {&__pyx_n_u_linear, __pyx_k_linear, sizeof(__pyx_k_linear), 0, 1, 0, 1},
    {&__pyx_n_s_linear_regression, __pyx_k_linear_regression, sizeof(__pyx_k_linear_regression), 0, 0, 1, 1},
    {&__pyx_n_u_linear_regression, __pyx_k_linear_regression, sizeof(__pyx_k_linear_regression), 0, 1, 0, 1},
    {&__pyx_n_s_linfunc, __pyx_k_linfunc, sizeof(__pyx_k_linfunc), 0, 0, 1, 1},
    {&__pyx_n_s_linkage, __pyx_k_linkage, sizeof(__pyx_k_linkage), 0, 0, 1, 1},
    {&__pyx_n_s_linkage_matrix, __pyx_k_linkage_matrix, sizeof(__pyx_k_linkage_matrix), 0, 0, 1, 1},
    {&__pyx_n_u_linkage_matrix, __pyx_k_linkage_matrix, sizeof(__pyx_k_linkage_matrix), 0, 1, 0, 1},
    {&__pyx_n_s_linregress, __pyx_k_linregress, sizeof(__pyx_k_linregress), 0, 0, 1, 1},
    {&__pyx_n_s_linspace, __pyx_k_linspace, sizeof(__pyx_k_linspace), 0, 0, 1, 1},
    {&__pyx_n_u_ll, __pyx_k_ll, sizeof(__pyx_k_ll), 0, 1, 0, 1},
    {&__pyx_n_s_local_minima_count, __pyx_k_local_minima_count, sizeof(__pyx_k_local_minima_count), 0, 0, 1, 1},
    {&__pyx_n_s_local_minima_indices, __pyx_k_local_minima_indices, sizeof(__pyx_k_local_minima_indices), 0, 0, 1, 1},
    {&__pyx_n_s_log, __pyx_k_log, sizeof(__pyx_k_log), 0, 0, 1, 1},
    {&__pyx_n_s_log10, __pyx_k_log10, sizeof(__pyx_k_log10), 0, 0, 1, 1},
    {&__pyx_n_s_log2, __pyx_k_log2, sizeof(__pyx_k_log2), 0, 0, 1, 1},
    {&__pyx_n_s_logarithmic_regression, __pyx_k_logarithmic_regression, sizeof(__pyx_k_logarithmic_regression), 0, 0, 1, 1},
    {&__pyx_n_u_logarithmic_regression, __pyx_k_logarithmic_regression, sizeof(__pyx_k_logarithmic_regression), 0, 1, 0, 1},
    {&__pyx_n_s_logger, __pyx_k_logger, sizeof(__pyx_k_logger), 0, 0, 1, 1},
    {&__pyx_n_s_logify, __pyx_k_logify, sizeof(__pyx_k_logify), 0, 0, 1, 1},
    {&__pyx_n_s_lon1, __pyx_k_lon1, sizeof(__pyx_k_lon1), 0, 0, 1, 1},
    {&__pyx_n_s_lon2, __pyx_k_lon2, sizeof(__pyx_k_lon2), 0, 0, 1, 1},
    {&__pyx_n_s_lower, __pyx_k_lower, sizeof(__pyx_k_lower), 0, 0, 1, 1},
    {&__pyx_n_s_lr, __pyx_k_lr, sizeof(__pyx_k_lr), 0, 0, 1, 1},
    {&__pyx_n_s_lstsq, __pyx_k_lstsq, sizeof(__pyx_k_lstsq), 0, 0, 1, 1},
    {&__pyx_n_s_m, __pyx_k_m, sizeof(__pyx_k_m), 0, 0, 1, 1},
    {&__pyx_n_u_m, __pyx_k_m, sizeof(__pyx_k_m), 0, 1, 0, 1},
    {&__pyx_n_u_macro, __pyx_k_macro, sizeof(__pyx_k_macro), 0, 1, 0, 1},
    {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
    {&__pyx_n_s_make_mxs, __pyx_k_make_mxs, sizeof(__pyx_k_make_mxs), 0, 0, 1, 1},
    {&__pyx_n_u_make_mxs, __pyx_k_make_mxs, sizeof(__pyx_k_make_mxs), 0, 1, 0, 1},
    {&__pyx_kp_u_make_mxs_line_2514, __pyx_k_make_mxs_line_2514, sizeof(__pyx_k_make_mxs_line_2514), 0, 1, 0, 0},
    {&__pyx_n_s_manage_colors, __pyx_k_manage_colors, sizeof(__pyx_k_manage_colors), 0, 0, 1, 1},
    {&__pyx_n_s_map, __pyx_k_map, sizeof(__pyx_k_map), 0, 0, 1, 1},
    {&__pyx_n_s_marker, __pyx_k_marker, sizeof(__pyx_k_marker), 0, 0, 1, 1},
    {&__pyx_n_s_match_method, __pyx_k_match_method, sizeof(__pyx_k_match_method), 0, 0, 1, 1},
    {&__pyx_n_s_matplotlib, __pyx_k_matplotlib, sizeof(__pyx_k_matplotlib), 0, 0, 1, 1},
    {&__pyx_n_s_matplotlib_pyplot, __pyx_k_matplotlib_pyplot, sizeof(__pyx_k_matplotlib_pyplot), 0, 0, 1, 1},
    {&__pyx_n_s_max, __pyx_k_max, sizeof(__pyx_k_max), 0, 0, 1, 1},
    {&__pyx_n_u_max, __pyx_k_max, sizeof(__pyx_k_max), 0, 1, 0, 1},
    {&__pyx_n_s_max_depth, __pyx_k_max_depth, sizeof(__pyx_k_max_depth), 0, 0, 1, 1},
    {&__pyx_n_s_max_lr, __pyx_k_max_lr, sizeof(__pyx_k_max_lr), 0, 0, 1, 1},
    {&__pyx_n_s_maximum, __pyx_k_maximum, sizeof(__pyx_k_maximum), 0, 0, 1, 1},
    {&__pyx_n_s_mean, __pyx_k_mean, sizeof(__pyx_k_mean), 0, 0, 1, 1},
    {&__pyx_n_s_mean_rank_pred, __pyx_k_mean_rank_pred, sizeof(__pyx_k_mean_rank_pred), 0, 0, 1, 1},
    {&__pyx_n_s_mean_rank_true, __pyx_k_mean_rank_true, sizeof(__pyx_k_mean_rank_true), 0, 0, 1, 1},
    {&__pyx_n_s_method, __pyx_k_method, sizeof(__pyx_k_method), 0, 0, 1, 1},
    {&__pyx_n_u_method, __pyx_k_method, sizeof(__pyx_k_method), 0, 1, 0, 1},
    {&__pyx_n_s_metric, __pyx_k_metric, sizeof(__pyx_k_metric), 0, 0, 1, 1},
    {&__pyx_n_u_micro, __pyx_k_micro, sizeof(__pyx_k_micro), 0, 1, 0, 1},
    {&__pyx_n_s_micro_sensitivity, __pyx_k_micro_sensitivity, sizeof(__pyx_k_micro_sensitivity), 0, 0, 1, 1},
    {&__pyx_n_s_micro_specificity, __pyx_k_micro_specificity, sizeof(__pyx_k_micro_specificity), 0, 0, 1, 1},
    {&__pyx_n_s_min, __pyx_k_min, sizeof(__pyx_k_min), 0, 0, 1, 1},
    {&__pyx_n_u_min, __pyx_k_min, sizeof(__pyx_k_min), 0, 1, 0, 1},
    {&__pyx_n_s_min_cost, __pyx_k_min_cost, sizeof(__pyx_k_min_cost), 0, 0, 1, 1},
    {&__pyx_n_s_min_non_zero_pred, __pyx_k_min_non_zero_pred, sizeof(__pyx_k_min_non_zero_pred), 0, 0, 1, 1},
    {&__pyx_n_s_minimum, __pyx_k_minimum, sizeof(__pyx_k_minimum), 0, 0, 1, 1},
    {&__pyx_n_s_minmax_scaler, __pyx_k_minmax_scaler, sizeof(__pyx_k_minmax_scaler), 0, 0, 1, 1},
    {&__pyx_n_u_minmax_scaler, __pyx_k_minmax_scaler, sizeof(__pyx_k_minmax_scaler), 0, 1, 0, 1},
    {&__pyx_kp_u_minmax_scaler_line_2947, __pyx_k_minmax_scaler_line_2947, sizeof(__pyx_k_minmax_scaler_line_2947), 0, 1, 0, 0},
    {&__pyx_n_u_mirror, __pyx_k_mirror, sizeof(__pyx_k_mirror), 0, 1, 0, 1},
    {&__pyx_n_s_mode, __pyx_k_mode, sizeof(__pyx_k_mode), 0, 0, 1, 1},
    {&__pyx_kp_u_mode_must_be_mirror_constant_nea, __pyx_k_mode_must_be_mirror_constant_nea, sizeof(__pyx_k_mode_must_be_mirror_constant_nea), 0, 1, 0, 0},
    {&__pyx_n_s_model_pred, __pyx_k_model_pred, sizeof(__pyx_k_model_pred), 0, 0, 1, 1},
    {&__pyx_n_s_model_true, __pyx_k_model_true, sizeof(__pyx_k_model_true), 0, 0, 1, 1},
    {&__pyx_n_s_moving_average, __pyx_k_moving_average, sizeof(__pyx_k_moving_average), 0, 0, 1, 1},
    {&__pyx_kp_u_moving_average_line_3046, __pyx_k_moving_average_line_3046, sizeof(__pyx_k_moving_average_line_3046), 0, 1, 0, 0},
    {&__pyx_n_s_msg, __pyx_k_msg, sizeof(__pyx_k_msg), 0, 0, 1, 1},
    {&__pyx_n_s_msg_meth, __pyx_k_msg_meth, sizeof(__pyx_k_msg_meth), 0, 0, 1, 1},
    {&__pyx_n_s_mu0, __pyx_k_mu0, sizeof(__pyx_k_mu0), 0, 0, 1, 1},
    {&__pyx_n_s_multi_output, __pyx_k_multi_output, sizeof(__pyx_k_multi_output), 0, 0, 1, 1},
    {&__pyx_n_u_multiclass, __pyx_k_multiclass, sizeof(__pyx_k_multiclass), 0, 1, 0, 1},
    {&__pyx_n_s_multioutput, __pyx_k_multioutput, sizeof(__pyx_k_multioutput), 0, 0, 1, 1},
    {&__pyx_n_s_n, __pyx_k_n, sizeof(__pyx_k_n), 0, 0, 1, 1},
    {&__pyx_n_s_n_epochs, __pyx_k_n_epochs, sizeof(__pyx_k_n_epochs), 0, 0, 1, 1},
    {&__pyx_n_s_n_estimators, __pyx_k_n_estimators, sizeof(__pyx_k_n_estimators), 0, 0, 1, 1},
    {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
    {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
    {&__pyx_n_u_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 1, 0, 1},
    {&__pyx_n_s_nan, __pyx_k_nan, sizeof(__pyx_k_nan), 0, 0, 1, 1},
    {&__pyx_n_s_nan_policy, __pyx_k_nan_policy, sizeof(__pyx_k_nan_policy), 0, 0, 1, 1},
    {&__pyx_n_s_nan_sum, __pyx_k_nan_sum, sizeof(__pyx_k_nan_sum), 0, 0, 1, 1},
    {&__pyx_n_s_nansum, __pyx_k_nansum, sizeof(__pyx_k_nansum), 0, 0, 1, 1},
    {&__pyx_n_s_ndarray, __pyx_k_ndarray, sizeof(__pyx_k_ndarray), 0, 0, 1, 1},
    {&__pyx_n_s_ndim, __pyx_k_ndim, sizeof(__pyx_k_ndim), 0, 0, 1, 1},
    {&__pyx_n_u_nearest, __pyx_k_nearest, sizeof(__pyx_k_nearest), 0, 1, 0, 1},
    {&__pyx_n_u_negative, __pyx_k_negative, sizeof(__pyx_k_negative), 0, 1, 0, 1},
    {&__pyx_n_s_newaxis, __pyx_k_newaxis, sizeof(__pyx_k_newaxis), 0, 0, 1, 1},
    {&__pyx_kp_u_no_of_items_in_clust, __pyx_k_no_of_items_in_clust, sizeof(__pyx_k_no_of_items_in_clust), 0, 1, 0, 0},
    {&__pyx_n_s_noise, __pyx_k_noise, sizeof(__pyx_k_noise), 0, 0, 1, 1},
    {&__pyx_n_u_none, __pyx_k_none, sizeof(__pyx_k_none), 0, 1, 0, 1},
    {&__pyx_n_s_nonzero, __pyx_k_nonzero, sizeof(__pyx_k_nonzero), 0, 0, 1, 1},
    {&__pyx_n_s_norm, __pyx_k_norm, sizeof(__pyx_k_norm), 0, 0, 1, 1},
    {&__pyx_n_s_normalize, __pyx_k_normalize, sizeof(__pyx_k_normalize), 0, 0, 1, 1},
    {&__pyx_n_u_normalize, __pyx_k_normalize, sizeof(__pyx_k_normalize), 0, 1, 0, 1},
    {&__pyx_kp_u_normalize_line_2997, __pyx_k_normalize_line_2997, sizeof(__pyx_k_normalize_line_2997), 0, 1, 0, 0},
    {&__pyx_n_s_normalize_string, __pyx_k_normalize_string, sizeof(__pyx_k_normalize_string), 0, 0, 1, 1},
    {&__pyx_n_s_northing, __pyx_k_northing, sizeof(__pyx_k_northing), 0, 0, 1, 1},
    {&__pyx_kp_u_not_found_in, __pyx_k_not_found_in, sizeof(__pyx_k_not_found_in), 0, 1, 0, 0},
    {&__pyx_kp_u_not_found_in_DataFrame_columns, __pyx_k_not_found_in_DataFrame_columns, sizeof(__pyx_k_not_found_in_DataFrame_columns), 0, 1, 0, 0},
    {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
    {&__pyx_n_s_number, __pyx_k_number, sizeof(__pyx_k_number), 0, 0, 1, 1},
    {&__pyx_n_s_numeric_cols, __pyx_k_numeric_cols, sizeof(__pyx_k_numeric_cols), 0, 0, 1, 1},
    {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
    {&__pyx_n_u_o, __pyx_k_o, sizeof(__pyx_k_o), 0, 1, 0, 1},
    {&__pyx_kp_u_ob, __pyx_k_ob, sizeof(__pyx_k_ob), 0, 1, 0, 0},
    {&__pyx_n_s_objname, __pyx_k_objname, sizeof(__pyx_k_objname), 0, 0, 1, 1},
    {&__pyx_kp_u_ok, __pyx_k_ok, sizeof(__pyx_k_ok), 0, 1, 0, 0},
    {&__pyx_n_u_ok_2, __pyx_k_ok_2, sizeof(__pyx_k_ok_2), 0, 1, 0, 1},
    {&__pyx_n_u_omit, __pyx_k_omit, sizeof(__pyx_k_omit), 0, 1, 0, 1},
    {&__pyx_n_s_ones, __pyx_k_ones, sizeof(__pyx_k_ones), 0, 0, 1, 1},
    {&__pyx_n_s_ones_like, __pyx_k_ones_like, sizeof(__pyx_k_ones_like), 0, 0, 1, 1},
    {&__pyx_n_s_optimal_bins, __pyx_k_optimal_bins, sizeof(__pyx_k_optimal_bins), 0, 0, 1, 1},
    {&__pyx_n_s_optimal_idx, __pyx_k_optimal_idx, sizeof(__pyx_k_optimal_idx), 0, 0, 1, 1},
    {&__pyx_n_s_optimal_ordering, __pyx_k_optimal_ordering, sizeof(__pyx_k_optimal_ordering), 0, 0, 1, 1},
    {&__pyx_n_s_optimal_threshold, __pyx_k_optimal_threshold, sizeof(__pyx_k_optimal_threshold), 0, 0, 1, 1},
    {&__pyx_n_s_optimal_youden, __pyx_k_optimal_youden, sizeof(__pyx_k_optimal_youden), 0, 0, 1, 1},
    {&__pyx_n_s_optimized_spearmanr, __pyx_k_optimized_spearmanr, sizeof(__pyx_k_optimized_spearmanr), 0, 0, 1, 1},
    {&__pyx_n_u_optimized_spearmanr, __pyx_k_optimized_spearmanr, sizeof(__pyx_k_optimized_spearmanr), 0, 1, 0, 1},
    {&__pyx_kp_u_optimized_spearmanr_line_1351, __pyx_k_optimized_spearmanr_line_1351, sizeof(__pyx_k_optimized_spearmanr_line_1351), 0, 1, 0, 0},
    {&__pyx_n_u_or, __pyx_k_or, sizeof(__pyx_k_or), 0, 1, 0, 1},
    {&__pyx_kp_u_or_2, __pyx_k_or_2, sizeof(__pyx_k_or_2), 0, 1, 0, 0},
    {&__pyx_n_s_order, __pyx_k_order, sizeof(__pyx_k_order), 0, 0, 1, 1},
    {&__pyx_n_u_ordinal, __pyx_k_ordinal, sizeof(__pyx_k_ordinal), 0, 1, 0, 1},
    {&__pyx_n_u_ovo, __pyx_k_ovo, sizeof(__pyx_k_ovo), 0, 1, 0, 1},
    {&__pyx_n_u_ovr, __pyx_k_ovr, sizeof(__pyx_k_ovr), 0, 1, 0, 1},
    {&__pyx_n_s_p, __pyx_k_p, sizeof(__pyx_k_p), 0, 0, 1, 1},
    {&__pyx_n_s_p_value, __pyx_k_p_value, sizeof(__pyx_k_p_value), 0, 0, 1, 1},
    {&__pyx_n_s_p_values, __pyx_k_p_values, sizeof(__pyx_k_p_values), 0, 0, 1, 1},
    {&__pyx_n_s_pair, __pyx_k_pair, sizeof(__pyx_k_pair), 0, 0, 1, 1},
    {&__pyx_n_s_pair_indices, __pyx_k_pair_indices, sizeof(__pyx_k_pair_indices), 0, 0, 1, 1},
    {&__pyx_n_s_pairwise_distances, __pyx_k_pairwise_distances, sizeof(__pyx_k_pairwise_distances), 0, 0, 1, 1},
    {&__pyx_n_s_pandas, __pyx_k_pandas, sizeof(__pyx_k_pandas), 0, 0, 1, 1},
    {&__pyx_n_s_param_name, __pyx_k_param_name, sizeof(__pyx_k_param_name), 0, 0, 1, 1},
    {&__pyx_n_s_parameter_validator, __pyx_k_parameter_validator, sizeof(__pyx_k_parameter_validator), 0, 0, 1, 1},
    {&__pyx_n_u_parent, __pyx_k_parent, sizeof(__pyx_k_parent), 0, 1, 0, 1},
    {&__pyx_n_u_passthrough, __pyx_k_passthrough, sizeof(__pyx_k_passthrough), 0, 1, 0, 1},
    {&__pyx_n_s_pcov, __pyx_k_pcov, sizeof(__pyx_k_pcov), 0, 0, 1, 1},
    {&__pyx_n_s_pd, __pyx_k_pd, sizeof(__pyx_k_pd), 0, 0, 1, 1},
    {&__pyx_n_s_pdist, __pyx_k_pdist, sizeof(__pyx_k_pdist), 0, 0, 1, 1},
    {&__pyx_n_u_pearson, __pyx_k_pearson, sizeof(__pyx_k_pearson), 0, 1, 0, 1},
    {&__pyx_n_s_pearsonr, __pyx_k_pearsonr, sizeof(__pyx_k_pearsonr), 0, 0, 1, 1},
    {&__pyx_n_s_percent_events, __pyx_k_percent_events, sizeof(__pyx_k_percent_events), 0, 0, 1, 1},
    {&__pyx_n_s_percent_events_bin, __pyx_k_percent_events_bin, sizeof(__pyx_k_percent_events_bin), 0, 0, 1, 1},
    {&__pyx_n_s_percent_non_events, __pyx_k_percent_non_events, sizeof(__pyx_k_percent_non_events), 0, 0, 1, 1},
    {&__pyx_n_s_percent_non_events_bin, __pyx_k_percent_non_events_bin, sizeof(__pyx_k_percent_non_events_bin), 0, 0, 1, 1},
    {&__pyx_n_s_percentile, __pyx_k_percentile, sizeof(__pyx_k_percentile), 0, 0, 1, 1},
    {&__pyx_n_s_pi, __pyx_k_pi, sizeof(__pyx_k_pi), 0, 0, 1, 1},
    {&__pyx_n_u_pk, __pyx_k_pk, sizeof(__pyx_k_pk), 0, 1, 0, 1},
    {&__pyx_n_s_plot, __pyx_k_plot, sizeof(__pyx_k_plot), 0, 0, 1, 1},
    {&__pyx_n_s_plt, __pyx_k_plt, sizeof(__pyx_k_plt), 0, 0, 1, 1},
    {&__pyx_n_u_poly, __pyx_k_poly, sizeof(__pyx_k_poly), 0, 1, 0, 1},
    {&__pyx_n_s_poly_coeffs, __pyx_k_poly_coeffs, sizeof(__pyx_k_poly_coeffs), 0, 0, 1, 1},
    {&__pyx_n_s_polyder, __pyx_k_polyder, sizeof(__pyx_k_polyder), 0, 0, 1, 1},
    {&__pyx_n_s_polyfit, __pyx_k_polyfit, sizeof(__pyx_k_polyfit), 0, 0, 1, 1},
    {&__pyx_n_s_polyorder, __pyx_k_polyorder, sizeof(__pyx_k_polyorder), 0, 0, 1, 1},
    {&__pyx_kp_u_polyorder_must_be_less_than_wind, __pyx_k_polyorder_must_be_less_than_wind, sizeof(__pyx_k_polyorder_must_be_less_than_wind), 0, 1, 0, 0},
    {&__pyx_n_s_polyval, __pyx_k_polyval, sizeof(__pyx_k_polyval), 0, 0, 1, 1},
    {&__pyx_n_s_pop_cat_features, __pyx_k_pop_cat_features, sizeof(__pyx_k_pop_cat_features), 0, 0, 1, 1},
    {&__pyx_n_s_popt, __pyx_k_popt, sizeof(__pyx_k_popt), 0, 0, 1, 1},
    {&__pyx_n_s_pos, __pyx_k_pos, sizeof(__pyx_k_pos), 0, 0, 1, 1},
    {&__pyx_n_s_pos_label, __pyx_k_pos_label, sizeof(__pyx_k_pos_label), 0, 0, 1, 1},
    {&__pyx_kp_u_pos_must_be_nonnegative_and_less, __pyx_k_pos_must_be_nonnegative_and_less, sizeof(__pyx_k_pos_must_be_nonnegative_and_less), 0, 1, 0, 0},
    {&__pyx_kp_u_positions, __pyx_k_positions, sizeof(__pyx_k_positions), 0, 1, 0, 0},
    {&__pyx_n_u_positive, __pyx_k_positive, sizeof(__pyx_k_positive), 0, 1, 0, 1},
    {&__pyx_n_s_positive_preds, __pyx_k_positive_preds, sizeof(__pyx_k_positive_preds), 0, 0, 1, 1},
    {&__pyx_n_s_power, __pyx_k_power, sizeof(__pyx_k_power), 0, 0, 1, 1},
    {&__pyx_n_s_predict, __pyx_k_predict, sizeof(__pyx_k_predict), 0, 0, 1, 1},
    {&__pyx_n_s_predict_proba, __pyx_k_predict_proba, sizeof(__pyx_k_predict_proba), 0, 0, 1, 1},
    {&__pyx_n_s_predicted, __pyx_k_predicted, sizeof(__pyx_k_predicted), 0, 0, 1, 1},
    {&__pyx_n_s_predicted_labels, __pyx_k_predicted_labels, sizeof(__pyx_k_predicted_labels), 0, 0, 1, 1},
    {&__pyx_n_s_prev_val, __pyx_k_prev_val, sizeof(__pyx_k_prev_val), 0, 0, 1, 1},
    {&__pyx_n_s_print, __pyx_k_print, sizeof(__pyx_k_print), 0, 0, 1, 1},
    {&__pyx_n_s_prob_true_class, __pyx_k_prob_true_class, sizeof(__pyx_k_prob_true_class), 0, 0, 1, 1},
    {&__pyx_n_s_profile1, __pyx_k_profile1, sizeof(__pyx_k_profile1), 0, 0, 1, 1},
    {&__pyx_n_s_profile2, __pyx_k_profile2, sizeof(__pyx_k_profile2), 0, 0, 1, 1},
    {&__pyx_n_s_profile_angle, __pyx_k_profile_angle, sizeof(__pyx_k_profile_angle), 0, 0, 1, 1},
    {&__pyx_n_s_profile_line, __pyx_k_profile_line, sizeof(__pyx_k_profile_line), 0, 0, 1, 1},
    {&__pyx_n_s_projection, __pyx_k_projection, sizeof(__pyx_k_projection), 0, 0, 1, 1},
    {&__pyx_n_u_propagate, __pyx_k_propagate, sizeof(__pyx_k_propagate), 0, 1, 0, 1},
    {&__pyx_n_s_pyplot, __pyx_k_pyplot, sizeof(__pyx_k_pyplot), 0, 0, 1, 1},
    {&__pyx_n_s_quadratic_regression, __pyx_k_quadratic_regression, sizeof(__pyx_k_quadratic_regression), 0, 0, 1, 1},
    {&__pyx_n_u_quadratic_regression, __pyx_k_quadratic_regression, sizeof(__pyx_k_quadratic_regression), 0, 1, 0, 1},
    {&__pyx_n_s_quality_control2, __pyx_k_quality_control2, sizeof(__pyx_k_quality_control2), 0, 0, 1, 1},
    {&__pyx_kp_u_quality_control2_line_4409, __pyx_k_quality_control2_line_4409, sizeof(__pyx_k_quality_control2_line_4409), 0, 1, 0, 0},
    {&__pyx_kp_u_r, __pyx_k_r, sizeof(__pyx_k_r), 0, 1, 0, 0},
    {&__pyx_n_s_rad2deg, __pyx_k_rad2deg, sizeof(__pyx_k_rad2deg), 0, 0, 1, 1},
    {&__pyx_n_u_raise, __pyx_k_raise, sizeof(__pyx_k_raise), 0, 1, 0, 1},
    {&__pyx_n_s_raise_exception, __pyx_k_raise_exception, sizeof(__pyx_k_raise_exception), 0, 0, 1, 1},
    {&__pyx_n_s_raise_warn, __pyx_k_raise_warn, sizeof(__pyx_k_raise_warn), 0, 0, 1, 1},
    {&__pyx_n_u_raises, __pyx_k_raises, sizeof(__pyx_k_raises), 0, 1, 0, 1},
    {&__pyx_n_s_randn, __pyx_k_randn, sizeof(__pyx_k_randn), 0, 0, 1, 1},
    {&__pyx_n_s_random, __pyx_k_random, sizeof(__pyx_k_random), 0, 0, 1, 1},
    {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
    {&__pyx_n_s_rank_data, __pyx_k_rank_data, sizeof(__pyx_k_rank_data), 0, 0, 1, 1},
    {&__pyx_n_u_rank_data, __pyx_k_rank_data, sizeof(__pyx_k_rank_data), 0, 1, 0, 1},
    {&__pyx_kp_u_rank_data_line_1263, __pyx_k_rank_data_line_1263, sizeof(__pyx_k_rank_data_line_1263), 0, 1, 0, 0},
    {&__pyx_n_s_rankdata, __pyx_k_rankdata, sizeof(__pyx_k_rankdata), 0, 0, 1, 1},
    {&__pyx_n_s_ranks, __pyx_k_ranks, sizeof(__pyx_k_ranks), 0, 0, 1, 1},
    {&__pyx_n_s_ranks_pred, __pyx_k_ranks_pred, sizeof(__pyx_k_ranks_pred), 0, 0, 1, 1},
    {&__pyx_n_s_ranks_true, __pyx_k_ranks_true, sizeof(__pyx_k_ranks_true), 0, 0, 1, 1},
    {&__pyx_n_s_rate, __pyx_k_rate, sizeof(__pyx_k_rate), 0, 0, 1, 1},
    {&__pyx_n_s_ravel, __pyx_k_ravel, sizeof(__pyx_k_ravel), 0, 0, 1, 1},
    {&__pyx_kp_u_raw_azimuth, __pyx_k_raw_azimuth, sizeof(__pyx_k_raw_azimuth), 0, 1, 0, 0},
    {&__pyx_n_u_raw_values, __pyx_k_raw_values, sizeof(__pyx_k_raw_values), 0, 1, 0, 1},
    {&__pyx_n_s_refglossary, __pyx_k_refglossary, sizeof(__pyx_k_refglossary), 0, 0, 1, 1},
    {&__pyx_n_u_regression, __pyx_k_regression, sizeof(__pyx_k_regression), 0, 1, 0, 1},
    {&__pyx_n_u_reject, __pyx_k_reject, sizeof(__pyx_k_reject), 0, 1, 0, 1},
    {&__pyx_n_s_relevant_mask, __pyx_k_relevant_mask, sizeof(__pyx_k_relevant_mask), 0, 0, 1, 1},
    {&__pyx_n_s_rem, __pyx_k_rem, sizeof(__pyx_k_rem), 0, 0, 1, 1},
    {&__pyx_n_s_replace, __pyx_k_replace, sizeof(__pyx_k_replace), 0, 0, 1, 1},
    {&__pyx_n_s_reset_index, __pyx_k_reset_index, sizeof(__pyx_k_reset_index), 0, 0, 1, 1},
    {&__pyx_n_s_reshape, __pyx_k_reshape, sizeof(__pyx_k_reshape), 0, 0, 1, 1},
    {&__pyx_n_s_residual, __pyx_k_residual, sizeof(__pyx_k_residual), 0, 0, 1, 1},
    {&__pyx_n_s_residuals, __pyx_k_residuals, sizeof(__pyx_k_residuals), 0, 0, 1, 1},
    {&__pyx_n_s_residuals_pred, __pyx_k_residuals_pred, sizeof(__pyx_k_residuals_pred), 0, 0, 1, 1},
    {&__pyx_n_s_residuals_true, __pyx_k_residuals_true, sizeof(__pyx_k_residuals_true), 0, 0, 1, 1},
    {&__pyx_n_s_result, __pyx_k_result, sizeof(__pyx_k_result), 0, 0, 1, 1},
    {&__pyx_n_s_results, __pyx_k_results, sizeof(__pyx_k_results), 0, 0, 1, 1},
    {&__pyx_n_s_return, __pyx_k_return, sizeof(__pyx_k_return), 0, 0, 1, 1},
    {&__pyx_n_s_return_array, __pyx_k_return_array, sizeof(__pyx_k_return_array), 0, 0, 1, 1},
    {&__pyx_n_s_return_confidence, __pyx_k_return_confidence, sizeof(__pyx_k_return_confidence), 0, 0, 1, 1},
    {&__pyx_n_s_return_counts, __pyx_k_return_counts, sizeof(__pyx_k_return_counts), 0, 0, 1, 1},
    {&__pyx_n_s_return_data, __pyx_k_return_data, sizeof(__pyx_k_return_data), 0, 0, 1, 1},
    {&__pyx_n_s_return_mean_dist, __pyx_k_return_mean_dist, sizeof(__pyx_k_return_mean_dist), 0, 0, 1, 1},
    {&__pyx_n_s_return_qco, __pyx_k_return_qco, sizeof(__pyx_k_return_qco), 0, 0, 1, 1},
    {&__pyx_n_s_return_target_only, __pyx_k_return_target_only, sizeof(__pyx_k_return_target_only), 0, 0, 1, 1},
    {&__pyx_n_s_return_weighted_rank, __pyx_k_return_weighted_rank, sizeof(__pyx_k_return_weighted_rank), 0, 0, 1, 1},
    {&__pyx_n_s_return_ymxs, __pyx_k_return_ymxs, sizeof(__pyx_k_return_ymxs), 0, 0, 1, 1},
    {&__pyx_n_s_reverse, __pyx_k_reverse, sizeof(__pyx_k_reverse), 0, 0, 1, 1},
    {&__pyx_n_s_rho, __pyx_k_rho, sizeof(__pyx_k_rho), 0, 0, 1, 1},
    {&__pyx_n_s_rng, __pyx_k_rng, sizeof(__pyx_k_rng), 0, 0, 1, 1},
    {&__pyx_n_u_robust, __pyx_k_robust, sizeof(__pyx_k_robust), 0, 1, 0, 1},
    {&__pyx_n_s_roc_auc_score, __pyx_k_roc_auc_score, sizeof(__pyx_k_roc_auc_score), 0, 0, 1, 1},
    {&__pyx_n_s_roc_curve, __pyx_k_roc_curve, sizeof(__pyx_k_roc_curve), 0, 0, 1, 1},
    {&__pyx_n_s_row, __pyx_k_row, sizeof(__pyx_k_row), 0, 0, 1, 1},
    {&__pyx_n_s_row_clusters, __pyx_k_row_clusters, sizeof(__pyx_k_row_clusters), 0, 0, 1, 1},
    {&__pyx_n_s_row_dist, __pyx_k_row_dist, sizeof(__pyx_k_row_dist), 0, 0, 1, 1},
    {&__pyx_kp_u_row_label_1, __pyx_k_row_label_1, sizeof(__pyx_k_row_label_1), 0, 1, 0, 0},
    {&__pyx_kp_u_row_lable_2, __pyx_k_row_lable_2, sizeof(__pyx_k_row_lable_2), 0, 1, 0, 0},
    {&__pyx_n_s_rr, __pyx_k_rr, sizeof(__pyx_k_rr), 0, 0, 1, 1},
    {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
    {&__pyx_n_u_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 1, 0, 1},
    {&__pyx_n_s_s_index, __pyx_k_s_index, sizeof(__pyx_k_s_index), 0, 0, 1, 1},
    {&__pyx_n_u_same, __pyx_k_same, sizeof(__pyx_k_same), 0, 1, 0, 1},
    {&__pyx_n_s_sample_weight, __pyx_k_sample_weight, sizeof(__pyx_k_sample_weight), 0, 0, 1, 1},
    {&__pyx_n_s_savgol_coeffs, __pyx_k_savgol_coeffs, sizeof(__pyx_k_savgol_coeffs), 0, 0, 1, 1},
    {&__pyx_kp_u_savgol_coeffs_line_3949, __pyx_k_savgol_coeffs_line_3949, sizeof(__pyx_k_savgol_coeffs_line_3949), 0, 1, 0, 0},
    {&__pyx_n_s_savgol_filter, __pyx_k_savgol_filter, sizeof(__pyx_k_savgol_filter), 0, 0, 1, 1},
    {&__pyx_n_u_savgol_filter, __pyx_k_savgol_filter, sizeof(__pyx_k_savgol_filter), 0, 1, 0, 1},
    {&__pyx_kp_u_savgol_filter_line_4159, __pyx_k_savgol_filter_line_4159, sizeof(__pyx_k_savgol_filter_line_4159), 0, 1, 0, 0},
    {&__pyx_n_s_scalePosition, __pyx_k_scalePosition, sizeof(__pyx_k_scalePosition), 0, 0, 1, 1},
    {&__pyx_kp_u_scalePosition_line_3596, __pyx_k_scalePosition_line_3596, sizeof(__pyx_k_scalePosition_line_3596), 0, 1, 0, 0},
    {&__pyx_n_s_scalePosition_locals_lambda, __pyx_k_scalePosition_locals_lambda, sizeof(__pyx_k_scalePosition_locals_lambda), 0, 0, 1, 1},
    {&__pyx_n_s_scalePosition_locals_linfunc, __pyx_k_scalePosition_locals_linfunc, sizeof(__pyx_k_scalePosition_locals_linfunc), 0, 0, 1, 1},
    {&__pyx_n_s_scale_factor, __pyx_k_scale_factor, sizeof(__pyx_k_scale_factor), 0, 0, 1, 1},
    {&__pyx_n_s_scale_positions, __pyx_k_scale_positions, sizeof(__pyx_k_scale_positions), 0, 0, 1, 1},
    {&__pyx_kp_u_scale_positions_line_4567, __pyx_k_scale_positions_line_4567, sizeof(__pyx_k_scale_positions_line_4567), 0, 1, 0, 0},
    {&__pyx_n_u_scaled, __pyx_k_scaled, sizeof(__pyx_k_scaled), 0, 1, 0, 1},
    {&__pyx_n_s_scipy, __pyx_k_scipy, sizeof(__pyx_k_scipy), 0, 0, 1, 1},
    {&__pyx_n_s_scipy__lib__util, __pyx_k_scipy__lib__util, sizeof(__pyx_k_scipy__lib__util), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_cluster_hierarchy, __pyx_k_scipy_cluster_hierarchy, sizeof(__pyx_k_scipy_cluster_hierarchy), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_linalg, __pyx_k_scipy_linalg, sizeof(__pyx_k_scipy_linalg), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_ndimage, __pyx_k_scipy_ndimage, sizeof(__pyx_k_scipy_ndimage), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_optimize, __pyx_k_scipy_optimize, sizeof(__pyx_k_scipy_optimize), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_signal, __pyx_k_scipy_signal, sizeof(__pyx_k_scipy_signal), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_spatial_distance, __pyx_k_scipy_spatial_distance, sizeof(__pyx_k_scipy_spatial_distance), 0, 0, 1, 1},
    {&__pyx_n_s_scipy_stats, __pyx_k_scipy_stats, sizeof(__pyx_k_scipy_stats), 0, 0, 1, 1},
    {&__pyx_n_s_score, __pyx_k_score, sizeof(__pyx_k_score), 0, 0, 1, 1},
    {&__pyx_n_s_scores, __pyx_k_scores, sizeof(__pyx_k_scores), 0, 0, 1, 1},
    {&__pyx_n_u_se, __pyx_k_se, sizeof(__pyx_k_se), 0, 1, 0, 1},
    {&__pyx_n_s_seen, __pyx_k_seen, sizeof(__pyx_k_seen), 0, 0, 1, 1},
    {&__pyx_n_s_select_dtypes, __pyx_k_select_dtypes, sizeof(__pyx_k_select_dtypes), 0, 0, 1, 1},
    {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
    {&__pyx_n_s_sens_array, __pyx_k_sens_array, sizeof(__pyx_k_sens_array), 0, 0, 1, 1},
    {&__pyx_n_s_sensitivities, __pyx_k_sensitivities, sizeof(__pyx_k_sensitivities), 0, 0, 1, 1},
    {&__pyx_n_s_sensitivity, __pyx_k_sensitivity, sizeof(__pyx_k_sensitivity), 0, 0, 1, 1},
    {&__pyx_n_s_set_xlabel, __pyx_k_set_xlabel, sizeof(__pyx_k_set_xlabel), 0, 0, 1, 1},
    {&__pyx_n_s_set_ylabel, __pyx_k_set_ylabel, sizeof(__pyx_k_set_ylabel), 0, 0, 1, 1},
    {&__pyx_n_s_shape, __pyx_k_shape, sizeof(__pyx_k_shape), 0, 0, 1, 1},
    {&__pyx_n_s_shift, __pyx_k_shift, sizeof(__pyx_k_shift), 0, 0, 1, 1},
    {&__pyx_n_u_shifted, __pyx_k_shifted, sizeof(__pyx_k_shifted), 0, 1, 0, 1},
    {&__pyx_kp_u_should_be_less_than_the_number, __pyx_k_should_be_less_than_the_number, sizeof(__pyx_k_should_be_less_than_the_number), 0, 1, 0, 0},
    {&__pyx_n_s_show, __pyx_k_show, sizeof(__pyx_k_show), 0, 0, 1, 1},
    {&__pyx_n_s_shp, __pyx_k_shp, sizeof(__pyx_k_shp), 0, 0, 1, 1},
    {&__pyx_n_s_significance_threshold, __pyx_k_significance_threshold, sizeof(__pyx_k_significance_threshold), 0, 0, 1, 1},
    {&__pyx_n_s_similarities, __pyx_k_similarities, sizeof(__pyx_k_similarities), 0, 0, 1, 1},
    {&__pyx_n_s_similarity, __pyx_k_similarity, sizeof(__pyx_k_similarity), 0, 0, 1, 1},
    {&__pyx_n_u_simple, __pyx_k_simple, sizeof(__pyx_k_simple), 0, 1, 0, 1},
    {&__pyx_kp_u_simple_moving_average, __pyx_k_simple_moving_average, sizeof(__pyx_k_simple_moving_average), 0, 1, 0, 0},
    {&__pyx_n_s_simplefilter, __pyx_k_simplefilter, sizeof(__pyx_k_simplefilter), 0, 0, 1, 1},
    {&__pyx_n_s_sin, __pyx_k_sin, sizeof(__pyx_k_sin), 0, 0, 1, 1},
    {&__pyx_n_s_sinusoidal_regression, __pyx_k_sinusoidal_regression, sizeof(__pyx_k_sinusoidal_regression), 0, 0, 1, 1},
    {&__pyx_n_u_sinusoidal_regression, __pyx_k_sinusoidal_regression, sizeof(__pyx_k_sinusoidal_regression), 0, 1, 0, 1},
    {&__pyx_n_s_site, __pyx_k_site, sizeof(__pyx_k_site), 0, 0, 1, 1},
    {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
    {&__pyx_n_s_sklearn_linear_model, __pyx_k_sklearn_linear_model, sizeof(__pyx_k_sklearn_linear_model), 0, 0, 1, 1},
    {&__pyx_n_s_sklearn_metrics, __pyx_k_sklearn_metrics, sizeof(__pyx_k_sklearn_metrics), 0, 0, 1, 1},
    {&__pyx_n_s_sklearn_preprocessing, __pyx_k_sklearn_preprocessing, sizeof(__pyx_k_sklearn_preprocessing), 0, 0, 1, 1},
    {&__pyx_n_s_sklearn_utils_multiclass, __pyx_k_sklearn_utils_multiclass, sizeof(__pyx_k_sklearn_utils_multiclass), 0, 0, 1, 1},
    {&__pyx_n_u_sma, __pyx_k_sma, sizeof(__pyx_k_sma), 0, 1, 0, 1},
    {&__pyx_n_s_smart_format, __pyx_k_smart_format, sizeof(__pyx_k_smart_format), 0, 0, 1, 1},
    {&__pyx_n_u_soft, __pyx_k_soft, sizeof(__pyx_k_soft), 0, 1, 0, 1},
    {&__pyx_n_s_sorted_data, __pyx_k_sorted_data, sizeof(__pyx_k_sorted_data), 0, 0, 1, 1},
    {&__pyx_n_s_sorted_indices, __pyx_k_sorted_indices, sizeof(__pyx_k_sorted_indices), 0, 0, 1, 1},
    {&__pyx_n_s_sorter, __pyx_k_sorter, sizeof(__pyx_k_sorter), 0, 0, 1, 1},
    {&__pyx_n_u_source, __pyx_k_source, sizeof(__pyx_k_source), 0, 1, 0, 1},
    {&__pyx_n_s_source_col, __pyx_k_source_col, sizeof(__pyx_k_source_col), 0, 0, 1, 1},
    {&__pyx_n_s_sources, __pyx_k_sources, sizeof(__pyx_k_sources), 0, 0, 1, 1},
    {&__pyx_n_u_spearman, __pyx_k_spearman, sizeof(__pyx_k_spearman), 0, 1, 0, 1},
    {&__pyx_n_s_spearman_corr, __pyx_k_spearman_corr, sizeof(__pyx_k_spearman_corr), 0, 0, 1, 1},
    {&__pyx_n_s_spearmanr, __pyx_k_spearmanr, sizeof(__pyx_k_spearmanr), 0, 0, 1, 1},
    {&__pyx_n_s_spec, __pyx_k_spec, sizeof(__pyx_k_spec), 0, 0, 1, 1},
    {&__pyx_n_s_spec_array, __pyx_k_spec_array, sizeof(__pyx_k_spec_array), 0, 0, 1, 1},
    {&__pyx_n_s_specific_y_pred, __pyx_k_specific_y_pred, sizeof(__pyx_k_specific_y_pred), 0, 0, 1, 1},
    {&__pyx_n_s_specific_y_true, __pyx_k_specific_y_true, sizeof(__pyx_k_specific_y_true), 0, 0, 1, 1},
    {&__pyx_n_s_specificities, __pyx_k_specificities, sizeof(__pyx_k_specificities), 0, 0, 1, 1},
    {&__pyx_n_s_specificity, __pyx_k_specificity, sizeof(__pyx_k_specificity), 0, 0, 1, 1},
    {&__pyx_n_s_spstats, __pyx_k_spstats, sizeof(__pyx_k_spstats), 0, 0, 1, 1},
    {&__pyx_n_s_sqrt, __pyx_k_sqrt, sizeof(__pyx_k_sqrt), 0, 0, 1, 1},
    {&__pyx_n_u_sqrt, __pyx_k_sqrt, sizeof(__pyx_k_sqrt), 0, 1, 0, 1},
    {&__pyx_n_s_squareform, __pyx_k_squareform, sizeof(__pyx_k_squareform), 0, 0, 1, 1},
    {&__pyx_n_u_squareform, __pyx_k_squareform, sizeof(__pyx_k_squareform), 0, 1, 0, 1},
    {&__pyx_n_s_squeeze, __pyx_k_squeeze, sizeof(__pyx_k_squeeze), 0, 0, 1, 1},
    {&__pyx_n_s_standard_scaler, __pyx_k_standard_scaler, sizeof(__pyx_k_standard_scaler), 0, 0, 1, 1},
    {&__pyx_n_u_standard_scaler, __pyx_k_standard_scaler, sizeof(__pyx_k_standard_scaler), 0, 1, 0, 1},
    {&__pyx_kp_u_standard_scaler_line_2896, __pyx_k_standard_scaler_line_2896, sizeof(__pyx_k_standard_scaler_line_2896), 0, 1, 0, 0},
    {&__pyx_n_s_star_mxs, __pyx_k_star_mxs, sizeof(__pyx_k_star_mxs), 0, 0, 1, 1},
    {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
    {&__pyx_n_s_state, __pyx_k_state, sizeof(__pyx_k_state), 0, 0, 1, 1},
    {&__pyx_n_s_stats, __pyx_k_stats, sizeof(__pyx_k_stats), 0, 0, 1, 1},
    {&__pyx_n_s_std, __pyx_k_std, sizeof(__pyx_k_std), 0, 0, 1, 1},
    {&__pyx_n_u_std, __pyx_k_std, sizeof(__pyx_k_std), 0, 1, 0, 1},
    {&__pyx_n_s_std_pred, __pyx_k_std_pred, sizeof(__pyx_k_std_pred), 0, 0, 1, 1},
    {&__pyx_n_s_std_true, __pyx_k_std_true, sizeof(__pyx_k_std_true), 0, 0, 1, 1},
    {&__pyx_n_s_step, __pyx_k_step, sizeof(__pyx_k_step), 0, 0, 1, 1},
    {&__pyx_n_s_step_function, __pyx_k_step_function, sizeof(__pyx_k_step_function), 0, 0, 1, 1},
    {&__pyx_n_s_step_regression, __pyx_k_step_regression, sizeof(__pyx_k_step_regression), 0, 0, 1, 1},
    {&__pyx_n_u_step_regression, __pyx_k_step_regression, sizeof(__pyx_k_step_regression), 0, 1, 0, 1},
    {&__pyx_n_s_step_regression_locals_lambda, __pyx_k_step_regression_locals_lambda, sizeof(__pyx_k_step_regression_locals_lambda), 0, 0, 1, 1},
    {&__pyx_n_s_stop, __pyx_k_stop, sizeof(__pyx_k_stop), 0, 0, 1, 1},
    {&__pyx_n_s_str, __pyx_k_str, sizeof(__pyx_k_str), 0, 0, 1, 1},
    {&__pyx_n_s_strategy, __pyx_k_strategy, sizeof(__pyx_k_strategy), 0, 0, 1, 1},
    {&__pyx_n_u_strategy, __pyx_k_strategy, sizeof(__pyx_k_strategy), 0, 1, 0, 1},
    {&__pyx_n_u_strict, __pyx_k_strict, sizeof(__pyx_k_strict), 0, 1, 0, 1},
    {&__pyx_n_s_strip, __pyx_k_strip, sizeof(__pyx_k_strip), 0, 0, 1, 1},
    {&__pyx_n_s_stump, __pyx_k_stump, sizeof(__pyx_k_stump), 0, 0, 1, 1},
    {&__pyx_n_u_sturges, __pyx_k_sturges, sizeof(__pyx_k_sturges), 0, 1, 0, 1},
    {&__pyx_n_s_subplots, __pyx_k_subplots, sizeof(__pyx_k_subplots), 0, 0, 1, 1},
    {&__pyx_n_s_subset, __pyx_k_subset, sizeof(__pyx_k_subset), 0, 0, 1, 1},
    {&__pyx_n_s_subtract, __pyx_k_subtract, sizeof(__pyx_k_subtract), 0, 0, 1, 1},
    {&__pyx_n_s_sum, __pyx_k_sum, sizeof(__pyx_k_sum), 0, 0, 1, 1},
    {&__pyx_n_s_sunburst_data, __pyx_k_sunburst_data, sizeof(__pyx_k_sunburst_data), 0, 0, 1, 1},
    {&__pyx_n_s_support, __pyx_k_support, sizeof(__pyx_k_support), 0, 0, 1, 1},
    {&__pyx_n_s_swapaxes, __pyx_k_swapaxes, sizeof(__pyx_k_swapaxes), 0, 0, 1, 1},
    {&__pyx_n_s_swapped, __pyx_k_swapped, sizeof(__pyx_k_swapped), 0, 0, 1, 1},
    {&__pyx_n_u_ta, __pyx_k_ta, sizeof(__pyx_k_ta), 0, 1, 0, 1},
    {&__pyx_n_u_target, __pyx_k_target, sizeof(__pyx_k_target), 0, 1, 0, 1},
    {&__pyx_n_s_target_col, __pyx_k_target_col, sizeof(__pyx_k_target_col), 0, 0, 1, 1},
    {&__pyx_n_s_target_strs, __pyx_k_target_strs, sizeof(__pyx_k_target_strs), 0, 0, 1, 1},
    {&__pyx_n_s_targets, __pyx_k_targets, sizeof(__pyx_k_targets), 0, 0, 1, 1},
    {&__pyx_n_s_task_type, __pyx_k_task_type, sizeof(__pyx_k_task_type), 0, 0, 1, 1},
    {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
    {&__pyx_n_s_threshold, __pyx_k_threshold, sizeof(__pyx_k_threshold), 0, 0, 1, 1},
    {&__pyx_n_s_thresholds, __pyx_k_thresholds, sizeof(__pyx_k_thresholds), 0, 0, 1, 1},
    {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
    {&__pyx_n_s_tie_method, __pyx_k_tie_method, sizeof(__pyx_k_tie_method), 0, 0, 1, 1},
    {&__pyx_n_s_title, __pyx_k_title, sizeof(__pyx_k_title), 0, 0, 1, 1},
    {&__pyx_n_s_to_array, __pyx_k_to_array, sizeof(__pyx_k_to_array), 0, 0, 1, 1},
    {&__pyx_n_s_to_deg, __pyx_k_to_deg, sizeof(__pyx_k_to_deg), 0, 0, 1, 1},
    {&__pyx_n_s_to_frame, __pyx_k_to_frame, sizeof(__pyx_k_to_frame), 0, 0, 1, 1},
    {&__pyx_n_s_to_latlon_in, __pyx_k_to_latlon_in, sizeof(__pyx_k_to_latlon_in), 0, 0, 1, 1},
    {&__pyx_n_s_to_log10, __pyx_k_to_log10, sizeof(__pyx_k_to_log10), 0, 0, 1, 1},
    {&__pyx_n_s_to_numeric_dtypes, __pyx_k_to_numeric_dtypes, sizeof(__pyx_k_to_numeric_dtypes), 0, 0, 1, 1},
    {&__pyx_n_s_to_utm_in, __pyx_k_to_utm_in, sizeof(__pyx_k_to_utm_in), 0, 0, 1, 1},
    {&__pyx_n_s_tol, __pyx_k_tol, sizeof(__pyx_k_tol), 0, 0, 1, 1},
    {&__pyx_n_u_tolerance, __pyx_k_tolerance, sizeof(__pyx_k_tolerance), 0, 1, 0, 1},
    {&__pyx_n_s_tolist, __pyx_k_tolist, sizeof(__pyx_k_tolist), 0, 0, 1, 1},
    {&__pyx_n_s_torres_verdin_filter, __pyx_k_torres_verdin_filter, sizeof(__pyx_k_torres_verdin_filter), 0, 0, 1, 1},
    {&__pyx_kp_u_torres_verdin_filter_line_4997, __pyx_k_torres_verdin_filter_line_4997, sizeof(__pyx_k_torres_verdin_filter_line_4997), 0, 1, 0, 0},
    {&__pyx_n_s_torres_verdin_filter_locals__fil, __pyx_k_torres_verdin_filter_locals__fil, sizeof(__pyx_k_torres_verdin_filter_locals__fil), 0, 0, 1, 1},
    {&__pyx_n_s_total, __pyx_k_total, sizeof(__pyx_k_total), 0, 0, 1, 1},
    {&__pyx_n_s_total_FN, __pyx_k_total_FN, sizeof(__pyx_k_total_FN), 0, 0, 1, 1},
    {&__pyx_n_s_total_FP, __pyx_k_total_FP, sizeof(__pyx_k_total_FP), 0, 0, 1, 1},
    {&__pyx_n_s_total_TN, __pyx_k_total_TN, sizeof(__pyx_k_total_TN), 0, 0, 1, 1},
    {&__pyx_n_s_total_TP, __pyx_k_total_TP, sizeof(__pyx_k_total_TP), 0, 0, 1, 1},
    {&__pyx_n_s_total_cost, __pyx_k_total_cost, sizeof(__pyx_k_total_cost), 0, 0, 1, 1},
    {&__pyx_n_s_total_weight, __pyx_k_total_weight, sizeof(__pyx_k_total_weight), 0, 0, 1, 1},
    {&__pyx_n_s_tpr, __pyx_k_tpr, sizeof(__pyx_k_tpr), 0, 0, 1, 1},
    {&__pyx_n_s_trailer, __pyx_k_trailer, sizeof(__pyx_k_trailer), 0, 0, 1, 1},
    {&__pyx_kp_u_trailer_must_be_a_non_numeric_st, __pyx_k_trailer_must_be_a_non_numeric_st, sizeof(__pyx_k_trailer_must_be_a_non_numeric_st), 0, 1, 0, 0},
    {&__pyx_n_s_transform, __pyx_k_transform, sizeof(__pyx_k_transform), 0, 0, 1, 1},
    {&__pyx_n_s_true_negatives, __pyx_k_true_negatives, sizeof(__pyx_k_true_negatives), 0, 0, 1, 1},
    {&__pyx_n_s_true_positives, __pyx_k_true_positives, sizeof(__pyx_k_true_positives), 0, 0, 1, 1},
    {&__pyx_n_s_type_of_target, __pyx_k_type_of_target, sizeof(__pyx_k_type_of_target), 0, 0, 1, 1},
    {&__pyx_n_u_uniform_average, __pyx_k_uniform_average, sizeof(__pyx_k_uniform_average), 0, 1, 0, 1},
    {&__pyx_n_s_unique, __pyx_k_unique, sizeof(__pyx_k_unique), 0, 0, 1, 1},
    {&__pyx_n_s_unique_labels, __pyx_k_unique_labels, sizeof(__pyx_k_unique_labels), 0, 0, 1, 1},
    {&__pyx_n_s_unit, __pyx_k_unit, sizeof(__pyx_k_unit), 0, 0, 1, 1},
    {&__pyx_n_s_use, __pyx_k_use, sizeof(__pyx_k_use), 0, 0, 1, 1},
    {&__pyx_n_s_use_average_dist, __pyx_k_use_average_dist, sizeof(__pyx_k_use_average_dist), 0, 0, 1, 1},
    {&__pyx_kp_u_use_lower_bound, __pyx_k_use_lower_bound, sizeof(__pyx_k_use_lower_bound), 0, 1, 0, 0},
    {&__pyx_kp_u_use_must_be_conv_or_dot, __pyx_k_use_must_be_conv_or_dot, sizeof(__pyx_k_use_must_be_conv_or_dot), 0, 1, 0, 0},
    {&__pyx_n_u_utm, __pyx_k_utm, sizeof(__pyx_k_utm), 0, 1, 0, 1},
    {&__pyx_n_s_utm_zone, __pyx_k_utm_zone, sizeof(__pyx_k_utm_zone), 0, 0, 1, 1},
    {&__pyx_kp_u_utm_zone_cannot_be_None_when_pro, __pyx_k_utm_zone_cannot_be_None_when_pro, sizeof(__pyx_k_utm_zone_cannot_be_None_when_pro), 0, 1, 0, 0},
    {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
    {&__pyx_n_s_valid_mask, __pyx_k_valid_mask, sizeof(__pyx_k_valid_mask), 0, 0, 1, 1},
    {&__pyx_n_s_valid_methods, __pyx_k_valid_methods, sizeof(__pyx_k_valid_methods), 0, 0, 1, 1},
    {&__pyx_n_s_valid_policies, __pyx_k_valid_policies, sizeof(__pyx_k_valid_policies), 0, 0, 1, 1},
    {&__pyx_n_s_validate_length_range, __pyx_k_validate_length_range, sizeof(__pyx_k_validate_length_range), 0, 0, 1, 1},
    {&__pyx_n_s_validate_multiclass_target, __pyx_k_validate_multiclass_target, sizeof(__pyx_k_validate_multiclass_target), 0, 0, 1, 1},
    {&__pyx_n_s_validate_multioutput, __pyx_k_validate_multioutput, sizeof(__pyx_k_validate_multioutput), 0, 0, 1, 1},
    {&__pyx_n_s_validate_name_in, __pyx_k_validate_name_in, sizeof(__pyx_k_validate_name_in), 0, 0, 1, 1},
    {&__pyx_n_s_validate_sample_weights, __pyx_k_validate_sample_weights, sizeof(__pyx_k_validate_sample_weights), 0, 0, 1, 1},
    {&__pyx_n_s_validate_scores, __pyx_k_validate_scores, sizeof(__pyx_k_validate_scores), 0, 0, 1, 1},
    {&__pyx_n_s_validator, __pyx_k_validator, sizeof(__pyx_k_validator), 0, 0, 1, 1},
    {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
    {&__pyx_n_u_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 1, 0, 1},
    {&__pyx_n_s_value_col, __pyx_k_value_col, sizeof(__pyx_k_value_col), 0, 0, 1, 1},
    {&__pyx_n_s_value_column, __pyx_k_value_column, sizeof(__pyx_k_value_column), 0, 0, 1, 1},
    {&__pyx_n_s_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
    {&__pyx_n_u_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 1, 0, 1},
    {&__pyx_n_s_var, __pyx_k_var, sizeof(__pyx_k_var), 0, 0, 1, 1},
    {&__pyx_n_s_var_pred, __pyx_k_var_pred, sizeof(__pyx_k_var_pred), 0, 0, 1, 1},
    {&__pyx_n_s_var_true, __pyx_k_var_true, sizeof(__pyx_k_var_true), 0, 0, 1, 1},
    {&__pyx_n_s_vectorize, __pyx_k_vectorize, sizeof(__pyx_k_vectorize), 0, 0, 1, 1},
    {&__pyx_n_s_view, __pyx_k_view, sizeof(__pyx_k_view), 0, 0, 1, 1},
    {&__pyx_n_s_vstack, __pyx_k_vstack, sizeof(__pyx_k_vstack), 0, 0, 1, 1},
    {&__pyx_n_s_w, __pyx_k_w, sizeof(__pyx_k_w), 0, 0, 1, 1},
    {&__pyx_n_s_warn, __pyx_k_warn, sizeof(__pyx_k_warn), 0, 0, 1, 1},
    {&__pyx_n_s_warnings, __pyx_k_warnings, sizeof(__pyx_k_warnings), 0, 0, 1, 1},
    {&__pyx_n_u_weight, __pyx_k_weight, sizeof(__pyx_k_weight), 0, 1, 0, 1},
    {&__pyx_n_s_weight_factor, __pyx_k_weight_factor, sizeof(__pyx_k_weight_factor), 0, 0, 1, 1},
    {&__pyx_n_u_weighted, __pyx_k_weighted, sizeof(__pyx_k_weighted), 0, 1, 0, 1},
    {&__pyx_kp_u_weighted_moving_average, __pyx_k_weighted_moving_average, sizeof(__pyx_k_weighted_moving_average), 0, 1, 0, 0},
    {&__pyx_n_s_weighted_rank, __pyx_k_weighted_rank, sizeof(__pyx_k_weighted_rank), 0, 0, 1, 1},
    {&__pyx_n_s_weighted_spearman_corr, __pyx_k_weighted_spearman_corr, sizeof(__pyx_k_weighted_spearman_corr), 0, 0, 1, 1},
    {&__pyx_n_s_weighted_spearman_rank, __pyx_k_weighted_spearman_rank, sizeof(__pyx_k_weighted_spearman_rank), 0, 0, 1, 1},
    {&__pyx_n_u_weighted_spearman_rank, __pyx_k_weighted_spearman_rank, sizeof(__pyx_k_weighted_spearman_rank), 0, 1, 0, 1},
    {&__pyx_kp_u_weighted_spearman_rank_line_1795, __pyx_k_weighted_spearman_rank_line_1795, sizeof(__pyx_k_weighted_spearman_rank_line_1795), 0, 1, 0, 0},
    {&__pyx_n_s_weighted_spearman_rank_locals_we, __pyx_k_weighted_spearman_rank_locals_we, sizeof(__pyx_k_weighted_spearman_rank_locals_we), 0, 0, 1, 1},
    {&__pyx_n_s_weights, __pyx_k_weights, sizeof(__pyx_k_weights), 0, 0, 1, 1},
    {&__pyx_n_s_wf, __pyx_k_wf, sizeof(__pyx_k_wf), 0, 0, 1, 1},
    {&__pyx_n_s_where, __pyx_k_where, sizeof(__pyx_k_where), 0, 0, 1, 1},
    {&__pyx_n_s_window_length, __pyx_k_window_length, sizeof(__pyx_k_window_length), 0, 0, 1, 1},
    {&__pyx_kp_u_window_length_must_be_odd, __pyx_k_window_length_must_be_odd, sizeof(__pyx_k_window_length_must_be_odd), 0, 1, 0, 0},
    {&__pyx_n_s_window_size, __pyx_k_window_size, sizeof(__pyx_k_window_size), 0, 0, 1, 1},
    {&__pyx_n_s_window_size_factor, __pyx_k_window_size_factor, sizeof(__pyx_k_window_size_factor), 0, 0, 1, 1},
    {&__pyx_kp_u_window_size_has_to_be_of_type_in, __pyx_k_window_size_has_to_be_of_type_in, sizeof(__pyx_k_window_size_has_to_be_of_type_in), 0, 1, 0, 0},
    {&__pyx_kp_u_window_size_is_too_large_for_ave, __pyx_k_window_size_is_too_large_for_ave, sizeof(__pyx_k_window_size_is_too_large_for_ave), 0, 1, 0, 0},
    {&__pyx_kp_u_window_size_size_must_be_a_posit, __pyx_k_window_size_size_must_be_a_posit, sizeof(__pyx_k_window_size_size_must_be_a_posit), 0, 1, 0, 0},
    {&__pyx_n_s_window_start, __pyx_k_window_start, sizeof(__pyx_k_window_start), 0, 0, 1, 1},
    {&__pyx_n_s_window_stop, __pyx_k_window_stop, sizeof(__pyx_k_window_stop), 0, 0, 1, 1},
    {&__pyx_n_u_wma, __pyx_k_wma, sizeof(__pyx_k_wma), 0, 1, 0, 1},
    {&__pyx_n_u_wrap, __pyx_k_wrap, sizeof(__pyx_k_wrap), 0, 1, 0, 1},
    {&__pyx_n_s_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 0, 1, 1},
    {&__pyx_n_u_x, __pyx_k_x, sizeof(__pyx_k_x), 0, 1, 0, 1},
    {&__pyx_kp_u_x_and_y_arrays_must_have_the_sa, __pyx_k_x_and_y_arrays_must_have_the_sa, sizeof(__pyx_k_x_and_y_arrays_must_have_the_sa), 0, 1, 0, 0},
    {&__pyx_n_s_x_edge, __pyx_k_x_edge, sizeof(__pyx_k_x_edge), 0, 0, 1, 1},
    {&__pyx_kp_u_x_y_are_not_in_longitude_latitud, __pyx_k_x_y_are_not_in_longitude_latitud, sizeof(__pyx_k_x_y_are_not_in_longitude_latitud), 0, 1, 0, 0},
    {&__pyx_n_s_xdata, __pyx_k_xdata, sizeof(__pyx_k_xdata), 0, 0, 1, 1},
    {&__pyx_n_s_xlabel, __pyx_k_xlabel, sizeof(__pyx_k_xlabel), 0, 0, 1, 1},
    {&__pyx_n_s_xlon, __pyx_k_xlon, sizeof(__pyx_k_xlon), 0, 0, 1, 1},
    {&__pyx_kp_u_xlon_and_ylat_arguments_are_grea, __pyx_k_xlon_and_ylat_arguments_are_grea, sizeof(__pyx_k_xlon_and_ylat_arguments_are_grea), 0, 1, 0, 0},
    {&__pyx_n_s_xs, __pyx_k_xs, sizeof(__pyx_k_xs), 0, 0, 1, 1},
    {&__pyx_n_s_xx, __pyx_k_xx, sizeof(__pyx_k_xx), 0, 0, 1, 1},
    {&__pyx_n_s_xx_edge, __pyx_k_xx_edge, sizeof(__pyx_k_xx_edge), 0, 0, 1, 1},
    {&__pyx_n_s_y, __pyx_k_y, sizeof(__pyx_k_y), 0, 0, 1, 1},
    {&__pyx_n_u_y, __pyx_k_y, sizeof(__pyx_k_y), 0, 1, 0, 1},
    {&__pyx_n_s_y_bin, __pyx_k_y_bin, sizeof(__pyx_k_y_bin), 0, 0, 1, 1},
    {&__pyx_n_s_y_edge, __pyx_k_y_edge, sizeof(__pyx_k_y_edge), 0, 0, 1, 1},
    {&__pyx_n_s_y_max, __pyx_k_y_max, sizeof(__pyx_k_y_max), 0, 0, 1, 1},
    {&__pyx_n_s_y_mean, __pyx_k_y_mean, sizeof(__pyx_k_y_mean), 0, 0, 1, 1},
    {&__pyx_n_s_y_min, __pyx_k_y_min, sizeof(__pyx_k_y_min), 0, 0, 1, 1},
    {&__pyx_n_s_y_norm, __pyx_k_y_norm, sizeof(__pyx_k_y_norm), 0, 0, 1, 1},
    {&__pyx_n_s_y_normalized, __pyx_k_y_normalized, sizeof(__pyx_k_y_normalized), 0, 0, 1, 1},
    {&__pyx_n_s_y_numeric, __pyx_k_y_numeric, sizeof(__pyx_k_y_numeric), 0, 0, 1, 1},
    {&__pyx_n_s_y_pred, __pyx_k_y_pred, sizeof(__pyx_k_y_pred), 0, 0, 1, 1},
    {&__pyx_n_u_y_pred, __pyx_k_y_pred, sizeof(__pyx_k_y_pred), 0, 1, 0, 1},
    {&__pyx_n_s_y_pred_binary, __pyx_k_y_pred_binary, sizeof(__pyx_k_y_pred_binary), 0, 0, 1, 1},
    {&__pyx_n_s_y_pred_indices, __pyx_k_y_pred_indices, sizeof(__pyx_k_y_pred_indices), 0, 0, 1, 1},
    {&__pyx_n_s_y_pred_pair, __pyx_k_y_pred_pair, sizeof(__pyx_k_y_pred_pair), 0, 0, 1, 1},
    {&__pyx_n_s_y_scaled, __pyx_k_y_scaled, sizeof(__pyx_k_y_scaled), 0, 0, 1, 1},
    {&__pyx_n_s_y_scores, __pyx_k_y_scores, sizeof(__pyx_k_y_scores), 0, 0, 1, 1},
    {&__pyx_n_s_y_std, __pyx_k_y_std, sizeof(__pyx_k_y_std), 0, 0, 1, 1},
    {&__pyx_n_s_y_true, __pyx_k_y_true, sizeof(__pyx_k_y_true), 0, 0, 1, 1},
    {&__pyx_n_u_y_true, __pyx_k_y_true, sizeof(__pyx_k_y_true), 0, 1, 0, 1},
    {&__pyx_kp_u_y_true_and_y_pred_must_contain_n, __pyx_k_y_true_and_y_pred_must_contain_n, sizeof(__pyx_k_y_true_and_y_pred_must_contain_n), 0, 1, 0, 0},
    {&__pyx_kp_u_y_true_and_y_pred_should_be_1_di, __pyx_k_y_true_and_y_pred_should_be_1_di, sizeof(__pyx_k_y_true_and_y_pred_should_be_1_di), 0, 1, 0, 0},
    {&__pyx_n_s_y_true_binarized, __pyx_k_y_true_binarized, sizeof(__pyx_k_y_true_binarized), 0, 0, 1, 1},
    {&__pyx_n_s_y_true_binary, __pyx_k_y_true_binary, sizeof(__pyx_k_y_true_binary), 0, 0, 1, 1},
    {&__pyx_n_s_y_true_encoded, __pyx_k_y_true_encoded, sizeof(__pyx_k_y_true_encoded), 0, 0, 1, 1},
    {&__pyx_n_s_y_true_indices, __pyx_k_y_true_indices, sizeof(__pyx_k_y_true_indices), 0, 0, 1, 1},
    {&__pyx_n_s_y_true_pair, __pyx_k_y_true_pair, sizeof(__pyx_k_y_true_pair), 0, 0, 1, 1},
    {&__pyx_n_s_ya, __pyx_k_ya, sizeof(__pyx_k_ya), 0, 0, 1, 1},
    {&__pyx_n_s_ydata, __pyx_k_ydata, sizeof(__pyx_k_ydata), 0, 0, 1, 1},
    {&__pyx_n_u_ydata, __pyx_k_ydata, sizeof(__pyx_k_ydata), 0, 1, 0, 1},
    {&__pyx_n_s_ydata_new, __pyx_k_ydata_new, sizeof(__pyx_k_ydata_new), 0, 0, 1, 1},
    {&__pyx_n_s_yield, __pyx_k_yield, sizeof(__pyx_k_yield), 0, 0, 1, 1},
    {&__pyx_n_s_ylabel, __pyx_k_ylabel, sizeof(__pyx_k_ylabel), 0, 0, 1, 1},
    {&__pyx_n_s_ylat, __pyx_k_ylat, sizeof(__pyx_k_ylat), 0, 0, 1, 1},
    {&__pyx_n_s_ymxs, __pyx_k_ymxs, sizeof(__pyx_k_ymxs), 0, 0, 1, 1},
    {&__pyx_n_s_youdens_index, __pyx_k_youdens_index, sizeof(__pyx_k_youdens_index), 0, 0, 1, 1},
    {&__pyx_n_s_ys, __pyx_k_ys, sizeof(__pyx_k_ys), 0, 0, 1, 1},
    {&__pyx_n_s_yt, __pyx_k_yt, sizeof(__pyx_k_yt), 0, 0, 1, 1},
    {&__pyx_kp_u_yt_should_not_contain_NaN_values, __pyx_k_yt_should_not_contain_NaN_values, sizeof(__pyx_k_yt_should_not_contain_NaN_values), 0, 1, 0, 0},
    {&__pyx_n_s_yt_transformed, __pyx_k_yt_transformed, sizeof(__pyx_k_yt_transformed), 0, 0, 1, 1},
    {&__pyx_n_s_yy, __pyx_k_yy, sizeof(__pyx_k_yy), 0, 0, 1, 1},
    {&__pyx_n_s_z, __pyx_k_z, sizeof(__pyx_k_z), 0, 0, 1, 1},
    {&__pyx_n_s_zero_division, __pyx_k_zero_division, sizeof(__pyx_k_zero_division), 0, 0, 1, 1},
    {&__pyx_n_s_zeros, __pyx_k_zeros, sizeof(__pyx_k_zeros), 0, 0, 1, 1},
    {&__pyx_n_s_zeros_like, __pyx_k_zeros_like, sizeof(__pyx_k_zeros_like), 0, 0, 1, 1},
    {&__pyx_n_s_zip, __pyx_k_zip, sizeof(__pyx_k_zip), 0, 0, 1, 1},
    {0, 0, 0, 0, 0, 0, 0}
  };
  return __Pyx_InitStrings(__pyx_string_tab);
}
/* #### Code section: cached_builtins ### */
static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
  __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(0, 185, __pyx_L1_error)
  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 189, __pyx_L1_error)
  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 375, __pyx_L1_error)
  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 378, __pyx_L1_error)
  __pyx_builtin_map = __Pyx_GetBuiltinName(__pyx_n_s_map); if (!__pyx_builtin_map) __PYX_ERR(0, 1865, __pyx_L1_error)
  __pyx_builtin_zip = __Pyx_GetBuiltinName(__pyx_n_s_zip); if (!__pyx_builtin_zip) __PYX_ERR(0, 2657, __pyx_L1_error)
  __pyx_builtin_max = __Pyx_GetBuiltinName(__pyx_n_s_max); if (!__pyx_builtin_max) __PYX_ERR(0, 3806, __pyx_L1_error)
  __pyx_builtin_print = __Pyx_GetBuiltinName(__pyx_n_s_print); if (!__pyx_builtin_print) __PYX_ERR(0, 3943, __pyx_L1_error)
  __pyx_builtin_RuntimeWarning = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeWarning); if (!__pyx_builtin_RuntimeWarning) __PYX_ERR(0, 4927, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}
/* #### Code section: cached_constants ### */

static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);

  /* "gofast/tools/mathex.pyx":196
 *         depvar = depvar.squeeze ()
 *         if depvar.ndim ==2:
 *             raise TypeError ("Dependent variable 'depvar' should be Series or"             # <<<<<<<<<<<<<<
 *                              " one-dimensional array, not a two-dimensional.")
 *         if not isinstance (depvar, pd.Series):
 */
  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_Dependent_variable_depvar_should); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 196, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__3);
  __Pyx_GIVEREF(__pyx_tuple__3);

  /* "gofast/tools/mathex.pyx":219
 *     data = data.select_dtypes([np.number])
 *     if data.empty:
 *         raise ValueError("P-value calculations expect numeric data, but"             # <<<<<<<<<<<<<<
 *                          " the DataFrame contains no numeric data.")
 * 
 */
  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u_P_value_calculations_expect_nume); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 219, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__4);
  __Pyx_GIVEREF(__pyx_tuple__4);

  /* "gofast/tools/mathex.pyx":223
 * 
 *     if method not in corr_methods:
 *         raise ValueError("Invalid correlation method. Supported methods:"             # <<<<<<<<<<<<<<
 *                          " 'pearson', 'spearman', 'kendall'.")
 * 
 */
  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_Invalid_correlation_method_Suppo); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 223, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__5);
  __Pyx_GIVEREF(__pyx_tuple__5);

  /* "gofast/tools/mathex.pyx":321
 * 
 *     # Validate the strategy parameter
 *     strategy = parameter_validator(             # <<<<<<<<<<<<<<
 *         "strategy", target_strs={"ovr", "ovo"})(strategy)
 * 
 */
  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_n_u_strategy); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 321, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__7);
  __Pyx_GIVEREF(__pyx_tuple__7);

  /* "gofast/tools/mathex.pyx":351
 *     cm = confusion_matrix(y_true, y_pred, sample_weight=sample_weight )
 *     if normalize:
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]             # <<<<<<<<<<<<<<
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 */
  __pyx_slice__9 = PySlice_New(Py_None, Py_None, Py_None); if (unlikely(!__pyx_slice__9)) __PYX_ERR(0, 351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__9);
  __Pyx_GIVEREF(__pyx_slice__9);

  /* "gofast/tools/mathex.pyx":352
 *     if normalize:
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)             # <<<<<<<<<<<<<<
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)
 *     return (sensitivity + specificity) / 2  if not np.isnan(
 */
  __pyx_tuple__10 = PyTuple_Pack(2, __pyx_int_1, __pyx_int_1); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__10);
  __Pyx_GIVEREF(__pyx_tuple__10);
  __pyx_tuple__11 = PyTuple_Pack(2, __pyx_int_1, __pyx_int_0); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 352, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__11);
  __Pyx_GIVEREF(__pyx_tuple__11);

  /* "gofast/tools/mathex.pyx":353
 *         cm = cm.astype('float') / cm.sum(axis=1)[:, np.newaxis]
 *     sensitivity = cm[1, 1] / (cm[1, 1] + cm[1, 0] + epsilon)
 *     specificity = cm[0, 0] / (cm[0, 0] + cm[0, 1] + epsilon)             # <<<<<<<<<<<<<<
 *     return (sensitivity + specificity) / 2  if not np.isnan(
 *         sensitivity + specificity) else zero_division
 */
  __pyx_tuple__12 = PyTuple_Pack(2, __pyx_int_0, __pyx_int_0); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__12);
  __Pyx_GIVEREF(__pyx_tuple__12);
  __pyx_tuple__13 = PyTuple_Pack(2, __pyx_int_0, __pyx_int_1); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 353, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__13);
  __Pyx_GIVEREF(__pyx_tuple__13);

  /* "gofast/tools/mathex.pyx":378
 * 
 *     bal_acc_scores = []
 *     for i, label_i in enumerate(labels[:-1]):             # <<<<<<<<<<<<<<
 *         for j, label_j in enumerate(labels[i+1:]):
 *             specific_y_true = y_bin[:, i]
 */
  __pyx_slice__16 = PySlice_New(Py_None, __pyx_int_neg_1, Py_None); if (unlikely(!__pyx_slice__16)) __PYX_ERR(0, 378, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__16);
  __Pyx_GIVEREF(__pyx_slice__16);

  /* "gofast/tools/mathex.pyx":524
 *     # Check if the class labels are binary
 *     if not is_binary_class(y_true):
 *         raise ValueError("Youden's index calculation requires binary class"             # <<<<<<<<<<<<<<
 *                          "labels. Provided labels are not binary.")
 * 
 */
  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_kp_u_Youden_s_index_calculation_requi); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 524, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__19);
  __Pyx_GIVEREF(__pyx_tuple__19);

  /* "gofast/tools/mathex.pyx":610
 *     epsilon = check_epsilon(epsilon, y_true, y_pred )
 * 
 *     consensus = parameter_validator(             # <<<<<<<<<<<<<<
 *         "consensus", target_strs={'negative', 'positive'})(consensus)
 *     strategy = parameter_validator(
 */
  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_n_u_consensus); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 610, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__21);
  __Pyx_GIVEREF(__pyx_tuple__21);

  /* "gofast/tools/mathex.pyx":913
 *         lr = (1 - sensitivity) / np.maximum(specificity, buffer)
 *     else:
 *         raise ValueError("Consensus must be either 'positive' or 'negative'")             # <<<<<<<<<<<<<<
 * 
 *     # Cap the likelihood ratios at the maximum allowed value
 */
  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_u_Consensus_must_be_either_positiv); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(0, 913, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__24);
  __Pyx_GIVEREF(__pyx_tuple__24);

  /* "gofast/tools/mathex.pyx":1089
 *     strategy = parameter_validator(
 *         "strategy", target_strs={'ovr', 'ovo'})(strategy)
 *     average = parameter_validator(             # <<<<<<<<<<<<<<
 *         "average", target_strs={'macro', 'micro', 'weighted'})(average)
 * 
 */
  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_n_u_average); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 1089, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__27);
  __Pyx_GIVEREF(__pyx_tuple__27);

  /* "gofast/tools/mathex.pyx":1447
 *     # correlation for each, aggregating the results according to the
 *     # multioutput strategy.
 *     def _weighted_spearman_corr(ranks_true, ranks_pred, weights):             # <<<<<<<<<<<<<<
 *         """
 *         Computes Spearman's rank correlation with support for sample weights.
 */
  __pyx_tuple__34 = PyTuple_Pack(9, __pyx_n_s_ranks_true, __pyx_n_s_ranks_pred, __pyx_n_s_weights, __pyx_n_s_mean_rank_true, __pyx_n_s_mean_rank_pred, __pyx_n_s_cov, __pyx_n_s_var_true, __pyx_n_s_var_pred, __pyx_n_s_spearman_corr); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 1447, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__34);
  __Pyx_GIVEREF(__pyx_tuple__34);
  __pyx_codeobj__35 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__34, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_weighted_spearman_corr, 1447, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__35)) __PYX_ERR(0, 1447, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1480
 *     elif nan_policy == 'raise':
 *         if np.isnan(y_true).any() or np.isnan(y_pred).any():
 *             raise ValueError("Input values contain NaNs.")             # <<<<<<<<<<<<<<
 * 
 *     # Implement tie handling
 */
  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_u_Input_values_contain_NaNs); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 1480, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__36);
  __Pyx_GIVEREF(__pyx_tuple__36);

  /* "gofast/tools/mathex.pyx":1661
 *     # Ensure the task is appropriate for the data
 *     if y_true.ndim > 1 or y_pred.ndim > 1:
 *         raise ValueError(             # <<<<<<<<<<<<<<
 *             "y_true and y_pred should be 1-dimensional arrays for regression tasks.")
 * 
 */
  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_u_y_true_and_y_pred_should_be_1_di); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 1661, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__40);
  __Pyx_GIVEREF(__pyx_tuple__40);

  /* "gofast/tools/mathex.pyx":1671
 *     # reshape for sklearn compatibility
 *     if control_vars.ndim == 1:
 *         control_vars = control_vars.reshape(-1, 1)             # <<<<<<<<<<<<<<
 * 
 *     # Adjust y_true based on control variables
 */
  __pyx_tuple__41 = PyTuple_Pack(2, __pyx_int_neg_1, __pyx_int_1); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(0, 1671, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__41);
  __Pyx_GIVEREF(__pyx_tuple__41);

  /* "gofast/tools/mathex.pyx":1871
 * 
 *     # Compute weighted ranks
 *     def weighted_rank(data, weights):             # <<<<<<<<<<<<<<
 *         order = np.argsort(data)
 *         ranks = np.empty_like(order, dtype=float)
 */
  __pyx_tuple__44 = PyTuple_Pack(6, __pyx_n_s_data, __pyx_n_s_weights, __pyx_n_s_order, __pyx_n_s_ranks, __pyx_n_s_cum_weights, __pyx_n_s_total_weight); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(0, 1871, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__44);
  __Pyx_GIVEREF(__pyx_tuple__44);
  __pyx_codeobj__45 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_weighted_rank, 1871, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__45)) __PYX_ERR(0, 1871, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1960
 *     if data_range is not None:
 *         if not isinstance(data_range, tuple) or len(data_range) != 2:
 *             raise ValueError(             # <<<<<<<<<<<<<<
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):
 */
  __pyx_tuple__47 = PyTuple_Pack(1, __pyx_kp_u_data_range_must_be_a_tuple_of_tw); if (unlikely(!__pyx_tuple__47)) __PYX_ERR(0, 1960, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__47);
  __Pyx_GIVEREF(__pyx_tuple__47);

  /* "gofast/tools/mathex.pyx":1963
 *                 "data_range must be a tuple of two numeric values (min, max).")
 *         if any(not np.isscalar(v) or not np.isreal(v) for v in data_range):
 *             raise ValueError("data_range must contain numeric values.")             # <<<<<<<<<<<<<<
 *         data_min, data_max = data_range
 *     else:
 */
  __pyx_tuple__48 = PyTuple_Pack(1, __pyx_kp_u_data_range_must_contain_numeric); if (unlikely(!__pyx_tuple__48)) __PYX_ERR(0, 1963, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__48);
  __Pyx_GIVEREF(__pyx_tuple__48);

  /* "gofast/tools/mathex.pyx":2090
 *             epsilon = determine_epsilon(y_pred)
 *         else:
 *             raise ValueError(             # <<<<<<<<<<<<<<
 *                 "Epsilon value 'auto' is acceptable or should be a numeric value.")
 * 
 */
  __pyx_tuple__50 = PyTuple_Pack(1, __pyx_kp_u_Epsilon_value_auto_is_acceptable); if (unlikely(!__pyx_tuple__50)) __PYX_ERR(0, 2090, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__50);
  __Pyx_GIVEREF(__pyx_tuple__50);

  /* "gofast/tools/mathex.pyx":2094
 * 
 *     elif not isinstance(epsilon, (int, float)):
 *         raise ValueError("Epsilon must be a numeric value or 'auto'.")             # <<<<<<<<<<<<<<
 *     else:
 *         epsilon = float(epsilon)
 */
  __pyx_tuple__51 = PyTuple_Pack(1, __pyx_kp_u_Epsilon_must_be_a_numeric_value); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(0, 2094, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__51);
  __Pyx_GIVEREF(__pyx_tuple__51);

  /* "gofast/tools/mathex.pyx":2125
 * 
 *         elif not isinstance(bins, (int, float)) or bins < 1:
 *             raise ValueError("Bins must be 'auto' or a positive integer.")             # <<<<<<<<<<<<<<
 * 
 *         if isinstance ( bins, float):
 */
  __pyx_tuple__52 = PyTuple_Pack(1, __pyx_kp_u_Bins_must_be_auto_or_a_positive); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(0, 2125, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__52);
  __Pyx_GIVEREF(__pyx_tuple__52);

  /* "gofast/tools/mathex.pyx":2249
 *     if task_type == 'regression':
 *         if predicted is None:
 *             raise ValueError("Predicted values must be provided for regression tasks.")             # <<<<<<<<<<<<<<
 *         return actual - predicted
 *     elif task_type in ['binary', 'multiclass']:
 */
  __pyx_tuple__55 = PyTuple_Pack(1, __pyx_kp_u_Predicted_values_must_be_provide); if (unlikely(!__pyx_tuple__55)) __PYX_ERR(0, 2249, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__55);
  __Pyx_GIVEREF(__pyx_tuple__55);

  /* "gofast/tools/mathex.pyx":2254
 *         if predict_proba is not None:
 *             if predict_proba.shape[0] != actual.shape[0]:
 *                 raise ValueError("The length of predict_proba does not match "             # <<<<<<<<<<<<<<
 *                                  "the number of actual values.")
 *             # For each sample, find the predicted probability of the true class
 */
  __pyx_tuple__56 = PyTuple_Pack(1, __pyx_kp_u_The_length_of_predict_proba_does); if (unlikely(!__pyx_tuple__56)) __PYX_ERR(0, 2254, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__56);
  __Pyx_GIVEREF(__pyx_tuple__56);

  /* "gofast/tools/mathex.pyx":2264
 *             residuals = np.where(actual == predicted, 0, 1)
 *         else:
 *             raise ValueError("Either predicted class labels or predict_proba "             # <<<<<<<<<<<<<<
 *                              "must be provided for classification tasks.")
 *     else:
 */
  __pyx_tuple__57 = PyTuple_Pack(1, __pyx_kp_u_Either_predicted_class_labels_or); if (unlikely(!__pyx_tuple__57)) __PYX_ERR(0, 2264, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__57);
  __Pyx_GIVEREF(__pyx_tuple__57);

  /* "gofast/tools/mathex.pyx":2267
 *                              "must be provided for classification tasks.")
 *     else:
 *         raise ValueError("The task_type must be 'regression', 'binary', or"             # <<<<<<<<<<<<<<
 *                          " 'multiclass'.")
 * 
 */
  __pyx_tuple__58 = PyTuple_Pack(1, __pyx_kp_u_The_task_type_must_be_regression); if (unlikely(!__pyx_tuple__58)) __PYX_ERR(0, 2267, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__58);
  __Pyx_GIVEREF(__pyx_tuple__58);

  /* "gofast/tools/mathex.pyx":2309
 *     """
 *     if len(data.columns) < 3:
 *         raise ValueError("DataFrame must have at least three columns:"             # <<<<<<<<<<<<<<
 *                          " source, target, and value")
 * 
 */
  __pyx_tuple__60 = PyTuple_Pack(1, __pyx_kp_u_DataFrame_must_have_at_least_thr); if (unlikely(!__pyx_tuple__60)) __PYX_ERR(0, 2309, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__60);
  __Pyx_GIVEREF(__pyx_tuple__60);

  /* "gofast/tools/mathex.pyx":2317
 * 
 *     if len(numeric_cols) == 0:
 *         raise ValueError(             # <<<<<<<<<<<<<<
 *             "DataFrame does not contain any numeric columns for values")
 * 
 */
  __pyx_tuple__61 = PyTuple_Pack(1, __pyx_kp_u_DataFrame_does_not_contain_any_n); if (unlikely(!__pyx_tuple__61)) __PYX_ERR(0, 2317, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__61);
  __Pyx_GIVEREF(__pyx_tuple__61);

  /* "gofast/tools/mathex.pyx":2336
 *     # Check for consistency in data
 *     if data[source_col].isnull().any() or data[target_col].isnull().any():
 *         raise ValueError("Source and Target columns must not contain null values")             # <<<<<<<<<<<<<<
 * 
 *     if data[value_col].isnull().any():
 */
  __pyx_tuple__62 = PyTuple_Pack(1, __pyx_kp_u_Source_and_Target_columns_must_n); if (unlikely(!__pyx_tuple__62)) __PYX_ERR(0, 2336, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__62);
  __Pyx_GIVEREF(__pyx_tuple__62);

  /* "gofast/tools/mathex.pyx":2339
 * 
 *     if data[value_col].isnull().any():
 *         raise ValueError("Value column must not contain null values")             # <<<<<<<<<<<<<<
 * 
 *     # Extract the columns and return
 */
  __pyx_tuple__63 = PyTuple_Pack(1, __pyx_kp_u_Value_column_must_not_contain_nu); if (unlikely(!__pyx_tuple__63)) __PYX_ERR(0, 2339, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__63);
  __Pyx_GIVEREF(__pyx_tuple__63);

  /* "gofast/tools/mathex.pyx":2492
 *     # Validate input data
 *     if not isinstance(d, np.ndarray) or d.ndim != 1:
 *         raise ValueError("Input data must be a one-dimensional numpy array.")             # <<<<<<<<<<<<<<
 * 
 *     if not np.issubdtype(d.dtype, np.number):
 */
  __pyx_tuple__67 = PyTuple_Pack(1, __pyx_kp_u_Input_data_must_be_a_one_dimensi); if (unlikely(!__pyx_tuple__67)) __PYX_ERR(0, 2492, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__67);
  __Pyx_GIVEREF(__pyx_tuple__67);

  /* "gofast/tools/mathex.pyx":2495
 * 
 *     if not np.issubdtype(d.dtype, np.number):
 *         raise ValueError("Input data must be a numpy array of numerical type.")             # <<<<<<<<<<<<<<
 * 
 *     # Sort the data by importance
 */
  __pyx_tuple__68 = PyTuple_Pack(1, __pyx_kp_u_Input_data_must_be_a_numpy_array); if (unlikely(!__pyx_tuple__68)) __PYX_ERR(0, 2495, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__68);
  __Pyx_GIVEREF(__pyx_tuple__68);

  /* "gofast/tools/mathex.pyx":2501
 *     sorted_data = d[sorted_indices]
 *     if reverse:
 *         sorted_data = sorted_data[::-1]             # <<<<<<<<<<<<<<
 * 
 *     # Calculate cumulative sum of the sorted data
 */
  __pyx_slice__69 = PySlice_New(Py_None, Py_None, __pyx_int_neg_1); if (unlikely(!__pyx_slice__69)) __PYX_ERR(0, 2501, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__69);
  __Pyx_GIVEREF(__pyx_slice__69);

  /* "gofast/tools/mathex.pyx":2586
 * 
 *     if not isinstance(trailer, str) or trailer.isdigit():
 *         raise ValueError("trailer must be a non-numeric string.")             # <<<<<<<<<<<<<<
 * 
 *     if mode == "strict" and np.isnan(yt).any():
 */
  __pyx_tuple__72 = PyTuple_Pack(1, __pyx_kp_u_trailer_must_be_a_non_numeric_st); if (unlikely(!__pyx_tuple__72)) __PYX_ERR(0, 2586, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__72);
  __Pyx_GIVEREF(__pyx_tuple__72);

  /* "gofast/tools/mathex.pyx":2589
 * 
 *     if mode == "strict" and np.isnan(yt).any():
 *         raise ValueError("yt should not contain NaN values in 'strict' mode.")             # <<<<<<<<<<<<<<
 * 
 *     # Appending trailer to yt if star_mxs is True
 */
  __pyx_tuple__73 = PyTuple_Pack(1, __pyx_kp_u_yt_should_not_contain_NaN_values); if (unlikely(!__pyx_tuple__73)) __PYX_ERR(0, 2589, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__73);
  __Pyx_GIVEREF(__pyx_tuple__73);

  /* "gofast/tools/mathex.pyx":3124
 *         window_size = np.abs(_assert_all_types(int(window_size), int))
 *     except ValueError:
 *         raise ValueError("window_size has to be of type int")             # <<<<<<<<<<<<<<
 *     if window_size < 1:
 *         raise TypeError("window_size size must be a positive odd number")
 */
  __pyx_tuple__86 = PyTuple_Pack(1, __pyx_kp_u_window_size_has_to_be_of_type_in); if (unlikely(!__pyx_tuple__86)) __PYX_ERR(0, 3124, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__86);
  __Pyx_GIVEREF(__pyx_tuple__86);

  /* "gofast/tools/mathex.pyx":3126
 *         raise ValueError("window_size has to be of type int")
 *     if window_size < 1:
 *         raise TypeError("window_size size must be a positive odd number")             # <<<<<<<<<<<<<<
 *     if  window_size > len(y):
 *         raise TypeError("window_size is too large for averaging. Window"
 */
  __pyx_tuple__87 = PyTuple_Pack(1, __pyx_kp_u_window_size_size_must_be_a_posit); if (unlikely(!__pyx_tuple__87)) __PYX_ERR(0, 3126, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__87);
  __Pyx_GIVEREF(__pyx_tuple__87);

  /* "gofast/tools/mathex.pyx":3131
 *                         f" must be greater than 0 and less than {len(y)}")
 * 
 *     method =str(method).lower().strip().replace ('-', ' ')             # <<<<<<<<<<<<<<
 * 
 *     if method in ('simple moving average',
 */
  __pyx_tuple__89 = PyTuple_Pack(2, __pyx_kp_u__88, __pyx_kp_u__31); if (unlikely(!__pyx_tuple__89)) __PYX_ERR(0, 3131, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__89);
  __Pyx_GIVEREF(__pyx_tuple__89);

  /* "gofast/tools/mathex.pyx":3149
 *                           f" {smart_format(['sma', 'cma', 'wma', 'ema'], 'or')}")
 *     if  1. <= alpha <= 0 :
 *         raise ValueError ('alpha should be less than 1. and greater than 0. ')             # <<<<<<<<<<<<<<
 * 
 *     if method =='cma':
 */
  __pyx_tuple__90 = PyTuple_Pack(1, __pyx_kp_u_alpha_should_be_less_than_1_and); if (unlikely(!__pyx_tuple__90)) __PYX_ERR(0, 3149, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__90);
  __Pyx_GIVEREF(__pyx_tuple__90);

  /* "gofast/tools/mathex.pyx":3211
 *     """
 *     arr= check_y (arr , y_numeric =True, estimator="Array" )
 *     method= parameter_validator(             # <<<<<<<<<<<<<<
 *         "method", target_strs= {"base", "robust"})(method)
 *     if method == 'base':
 */
  __pyx_tuple__92 = PyTuple_Pack(1, __pyx_n_u_method); if (unlikely(!__pyx_tuple__92)) __PYX_ERR(0, 3211, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__92);
  __Pyx_GIVEREF(__pyx_tuple__92);

  /* "gofast/tools/mathex.pyx":3335
 *     if projection=='utm':
 *         if utm_zone is None:
 *             raise TypeError ("utm_zone cannot be None when projection is UTM.")             # <<<<<<<<<<<<<<
 * 
 *         ylat , xlon = Location.to_latlon_in(
 */
  __pyx_tuple__94 = PyTuple_Pack(1, __pyx_kp_u_utm_zone_cannot_be_None_when_pro); if (unlikely(!__pyx_tuple__94)) __PYX_ERR(0, 3335, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__94);
  __Pyx_GIVEREF(__pyx_tuple__94);

  /* "gofast/tools/mathex.pyx":3366
 *         azim = np.hstack ( ( [z.mean(), z ]))
 *         # reset the interpolare value at the first position
 *         with warnings.catch_warnings():             # <<<<<<<<<<<<<<
 *             #warnings.filterwarnings(action='ignore', category=OptimizeWarning)
 *             warnings.simplefilter("ignore")
 */
  __pyx_tuple__95 = PyTuple_Pack(3, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple__95)) __PYX_ERR(0, 3366, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__95);
  __Pyx_GIVEREF(__pyx_tuple__95);

  /* "gofast/tools/mathex.pyx":3373
 *     if view:
 *         x = np.arange ( len(azim ))
 *         fig,  ax = plt.subplots (1, 1, figsize = (10, 4))             # <<<<<<<<<<<<<<
 *         # add Nan to the first position of z
 *         z = np.hstack (([np.nan], z )) if extrapolate else z
 */
  __pyx_tuple__96 = PyTuple_Pack(2, __pyx_int_10, __pyx_int_4); if (unlikely(!__pyx_tuple__96)) __PYX_ERR(0, 3373, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__96);
  __Pyx_GIVEREF(__pyx_tuple__96);

  /* "gofast/tools/mathex.pyx":3677
 * 
 *     """
 *     def linfunc (x, a, b):             # <<<<<<<<<<<<<<
 *         """ Set the simple linear function"""
 *         return a * x + b
 */
  __pyx_tuple__99 = PyTuple_Pack(3, __pyx_n_s_x, __pyx_n_s_a, __pyx_n_s_b); if (unlikely(!__pyx_tuple__99)) __PYX_ERR(0, 3677, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__99);
  __Pyx_GIVEREF(__pyx_tuple__99);
  __pyx_codeobj__100 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__99, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_linfunc, 3677, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__100)) __PYX_ERR(0, 3677, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3698
 *                           " as the `y` target.")
 *         if c_order is None:
 *             raise TypeError('Dataframe is given. The `c_order` argument should '             # <<<<<<<<<<<<<<
 *                             'be defined for column selection. Use column name'
 *                             ' instead')
 */
  __pyx_tuple__101 = PyTuple_Pack(1, __pyx_kp_u_Dataframe_is_given_The_c_order_a); if (unlikely(!__pyx_tuple__101)) __PYX_ERR(0, 3698, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__101);
  __Pyx_GIVEREF(__pyx_tuple__101);

  /* "gofast/tools/mathex.pyx":3729
 * 
 *     if len(xdata) != len(ydata):
 *         raise ValueError(" `x` and `y` arrays must have the same length."             # <<<<<<<<<<<<<<
 *                         "'{len(xdata)}' and '{len(ydata)}' are given.")
 * 
 */
  __pyx_tuple__102 = PyTuple_Pack(1, __pyx_kp_u_x_and_y_arrays_must_have_the_sa); if (unlikely(!__pyx_tuple__102)) __PYX_ERR(0, 3729, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__102);
  __Pyx_GIVEREF(__pyx_tuple__102);

  /* "gofast/tools/mathex.pyx":3786
 *     S=copy.deepcopy(s)
 *     if isinstance(s, str):
 *         s =s.lower().replace('s', '').replace('pk', '').replace('ta', '')             # <<<<<<<<<<<<<<
 *         try :
 *             s=int(s)
 */
  __pyx_tuple__104 = PyTuple_Pack(2, __pyx_n_u_s, __pyx_kp_u__65); if (unlikely(!__pyx_tuple__104)) __PYX_ERR(0, 3786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__104);
  __Pyx_GIVEREF(__pyx_tuple__104);
  __pyx_tuple__105 = PyTuple_Pack(2, __pyx_n_u_pk, __pyx_kp_u__65); if (unlikely(!__pyx_tuple__105)) __PYX_ERR(0, 3786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__105);
  __Pyx_GIVEREF(__pyx_tuple__105);
  __pyx_tuple__106 = PyTuple_Pack(2, __pyx_n_u_ta, __pyx_kp_u__65); if (unlikely(!__pyx_tuple__106)) __PYX_ERR(0, 3786, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__106);
  __Pyx_GIVEREF(__pyx_tuple__106);

  /* "gofast/tools/mathex.pyx":3833
 *     c = list(c) +  default
 * 
 *     return c [:3] # return 3colors             # <<<<<<<<<<<<<<
 * 
 * 
 */
  __pyx_slice__109 = PySlice_New(Py_None, __pyx_int_3, Py_None); if (unlikely(!__pyx_slice__109)) __PYX_ERR(0, 3833, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__109);
  __Pyx_GIVEREF(__pyx_slice__109);

  /* "gofast/tools/mathex.pyx":3855
 *             value = float(value.replace(unit, '')
 *                               )*converter if value.find(
 *                 'km')>=0 else float(value.replace('m', ''))             # <<<<<<<<<<<<<<
 *         except:
 *             raise TypeError(f"Expected float not {type(value)!r}."
 */
  __pyx_tuple__111 = PyTuple_Pack(2, __pyx_n_u_m, __pyx_kp_u__65); if (unlikely(!__pyx_tuple__111)) __PYX_ERR(0, 3855, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__111);
  __Pyx_GIVEREF(__pyx_tuple__111);

  /* "gofast/tools/mathex.pyx":3915
 * 
 *     if easting is None or northing is None :
 *         raise TypeError('NoneType can not be computed !')             # <<<<<<<<<<<<<<
 * 
 *         # use the one with the lower standard deviation
 */
  __pyx_tuple__114 = PyTuple_Pack(1, __pyx_kp_u_NoneType_can_not_be_computed); if (unlikely(!__pyx_tuple__114)) __PYX_ERR(0, 3915, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__114);
  __Pyx_GIVEREF(__pyx_tuple__114);

  /* "gofast/tools/mathex.pyx":3922
 *         northing = northing.astype('float')
 *     except :
 *         raise ValueError('Could not convert input argument to float!')             # <<<<<<<<<<<<<<
 *     try :
 *         profile1 = spstats.linregress(easting, northing)
 */
  __pyx_tuple__115 = PyTuple_Pack(1, __pyx_kp_u_Could_not_convert_input_argument); if (unlikely(!__pyx_tuple__115)) __PYX_ERR(0, 3922, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__115);
  __Pyx_GIVEREF(__pyx_tuple__115);

  /* "gofast/tools/mathex.pyx":3929
 *         warnings.warn(msg)
 * 
 *     profile_line = profile1[:2]             # <<<<<<<<<<<<<<
 *     # if the profile is rather E=E(N),
 *     # the parameters have to converted  into N=N(E) form:
 */
  __pyx_slice__116 = PySlice_New(Py_None, __pyx_int_2, Py_None); if (unlikely(!__pyx_slice__116)) __PYX_ERR(0, 3929, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__116);
  __Pyx_GIVEREF(__pyx_slice__116);

  /* "gofast/tools/mathex.pyx":4033
 * 
 *     if polyorder >= window_length:
 *         raise ValueError("polyorder must be less than window_length.")             # <<<<<<<<<<<<<<
 * 
 *     halflen, rem = divmod(window_length, 2)
 */
  __pyx_tuple__118 = PyTuple_Pack(1, __pyx_kp_u_polyorder_must_be_less_than_wind); if (unlikely(!__pyx_tuple__118)) __PYX_ERR(0, 4033, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__118);
  __Pyx_GIVEREF(__pyx_tuple__118);

  /* "gofast/tools/mathex.pyx":4038
 * 
 *     if rem == 0:
 *         raise ValueError("window_length must be odd.")             # <<<<<<<<<<<<<<
 * 
 *     if pos is None:
 */
  __pyx_tuple__119 = PyTuple_Pack(1, __pyx_kp_u_window_length_must_be_odd); if (unlikely(!__pyx_tuple__119)) __PYX_ERR(0, 4038, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__119);
  __Pyx_GIVEREF(__pyx_tuple__119);

  /* "gofast/tools/mathex.pyx":4044
 * 
 *     if not (0 <= pos < window_length):
 *         raise ValueError("pos must be nonnegative and less than "             # <<<<<<<<<<<<<<
 *                          "window_length.")
 * 
 */
  __pyx_tuple__120 = PyTuple_Pack(1, __pyx_kp_u_pos_must_be_nonnegative_and_less); if (unlikely(!__pyx_tuple__120)) __PYX_ERR(0, 4044, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__120);
  __Pyx_GIVEREF(__pyx_tuple__120);

  /* "gofast/tools/mathex.pyx":4048
 * 
 *     if use not in ['conv', 'dot']:
 *         raise ValueError("`use` must be 'conv' or 'dot'")             # <<<<<<<<<<<<<<
 * 
 *     if deriv > polyorder:
 */
  __pyx_tuple__121 = PyTuple_Pack(1, __pyx_kp_u_use_must_be_conv_or_dot); if (unlikely(!__pyx_tuple__121)) __PYX_ERR(0, 4048, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__121);
  __Pyx_GIVEREF(__pyx_tuple__121);

  /* "gofast/tools/mathex.pyx":4092
 *         n = len(p)
 *         if n <= m:
 *             result = np.zeros_like(p[:1, ...])             # <<<<<<<<<<<<<<
 *         else:
 *             dp = p[:-m].copy()
 */
  __pyx_slice__123 = PySlice_New(Py_None, __pyx_int_1, Py_None); if (unlikely(!__pyx_slice__123)) __PYX_ERR(0, 4092, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_slice__123);
  __Pyx_GIVEREF(__pyx_slice__123);
  __pyx_tuple__124 = PyTuple_Pack(2, __pyx_slice__123, Py_Ellipsis); if (unlikely(!__pyx_tuple__124)) __PYX_ERR(0, 4092, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__124);
  __Pyx_GIVEREF(__pyx_tuple__124);

  /* "gofast/tools/mathex.pyx":4097
 *             for k in range(m):
 *                 rng = np.arange(n - k - 1, m - k - 1, -1)
 *                 dp *= rng.reshape((n - m,) + (1,) * (p.ndim - 1))             # <<<<<<<<<<<<<<
 *             result = dp
 *     return result
 */
  __pyx_tuple__125 = PyTuple_New(1); if (unlikely(!__pyx_tuple__125)) __PYX_ERR(0, 4097, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__125);
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_tuple__125, 0, __pyx_int_1)) __PYX_ERR(0, 4097, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_tuple__125);

  /* "gofast/tools/mathex.pyx":4261
 *     """
 *     if mode not in ["mirror", "constant", "nearest", "interp", "wrap"]:
 *         raise ValueError("mode must be 'mirror', 'constant', 'nearest' "             # <<<<<<<<<<<<<<
 *                          "'wrap' or 'interp'.")
 * 
 */
  __pyx_tuple__129 = PyTuple_Pack(1, __pyx_kp_u_mode_must_be_mirror_constant_nea); if (unlikely(!__pyx_tuple__129)) __PYX_ERR(0, 4261, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__129);
  __Pyx_GIVEREF(__pyx_tuple__129);

  /* "gofast/tools/mathex.pyx":4273
 *     if mode == "interp":
 *         if window_length > x.size:
 *             raise ValueError("If mode is 'interp', window_length must be less "             # <<<<<<<<<<<<<<
 *                              "than or equal to the size of x.")
 * 
 */
  __pyx_tuple__130 = PyTuple_Pack(1, __pyx_kp_u_If_mode_is_interp_window_length); if (unlikely(!__pyx_tuple__130)) __PYX_ERR(0, 4273, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__130);
  __Pyx_GIVEREF(__pyx_tuple__130);

  /* "gofast/tools/mathex.pyx":4389
 *      dtype: float64)
 *     """
 *     error = _validate_name_in(error , defaults =('error', 'se'),             # <<<<<<<<<<<<<<
 *                               deep =True, expect_name ='se')
 *     # keep only the numeric values.
 */
  __pyx_tuple__132 = PyTuple_Pack(2, __pyx_n_u_error, __pyx_n_u_se); if (unlikely(!__pyx_tuple__132)) __PYX_ERR(0, 4389, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__132);
  __Pyx_GIVEREF(__pyx_tuple__132);

  /* "gofast/tools/mathex.pyx":4396
 * 
 *     if not _is_numeric_dtype(arr):
 *         raise TypeError("Numeric array is expected for operations.")             # <<<<<<<<<<<<<<
 *     err= np.std (arr) if arr.ndim ==1 else np.std (arr, axis= axis )
 * 
 */
  __pyx_tuple__133 = PyTuple_Pack(1, __pyx_kp_u_Numeric_array_is_expected_for_op); if (unlikely(!__pyx_tuple__133)) __PYX_ERR(0, 4396, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__133);
  __Pyx_GIVEREF(__pyx_tuple__133);

  /* "gofast/tools/mathex.pyx":4755
 * 
 *     if len(latlon1) <2 or len(latlon2) <2 :
 *         raise ValueError("Wrong coordinates values. Need two coordinates"             # <<<<<<<<<<<<<<
 *                          " (latitude and longitude) of points 1 and 2.")
 *     lat1 = np.deg2rad (latlon1[0]) ; lon1 = np.deg2rad(latlon1[1])
 */
  __pyx_tuple__139 = PyTuple_Pack(1, __pyx_kp_u_Wrong_coordinates_values_Need_tw); if (unlikely(!__pyx_tuple__139)) __PYX_ERR(0, 4755, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__139);
  __Pyx_GIVEREF(__pyx_tuple__139);

  /* "gofast/tools/mathex.pyx":4922
 *     w = np.zeros((degree+1, 1)) # initialize weights
 * 
 *     def init_weights (x, y):             # <<<<<<<<<<<<<<
 *         """ Init weights by calculating the scope of the function along
 *          the vertical nodes axis for each columns. """
 */
  __pyx_tuple__143 = PyTuple_Pack(4, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_j, __pyx_n_s_a); if (unlikely(!__pyx_tuple__143)) __PYX_ERR(0, 4922, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__143);
  __Pyx_GIVEREF(__pyx_tuple__143);
  __pyx_codeobj__144 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__143, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_init_weights, 4922, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__144)) __PYX_ERR(0, 4922, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":5064
 *     logify = bool(logify)
 * 
 *     def _filtering_1d_array( ar, wf, b ):             # <<<<<<<<<<<<<<
 *         if len(ar) < 2:
 *             return ar
 */
  __pyx_tuple__147 = PyTuple_Pack(8, __pyx_n_s_ar, __pyx_n_s_wf, __pyx_n_s_b, __pyx_n_s_ama, __pyx_n_s_i, __pyx_n_s_change, __pyx_n_s_w, __pyx_n_s_ama_value); if (unlikely(!__pyx_tuple__147)) __PYX_ERR(0, 5064, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__147);
  __Pyx_GIVEREF(__pyx_tuple__147);
  __pyx_codeobj__148 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__147, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_filtering_1d_array, 5064, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__148)) __PYX_ERR(0, 5064, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":13
 * import numpy as np
 * import pandas as pd
 * import matplotlib.pyplot as plt             # <<<<<<<<<<<<<<
 * 
 * import scipy.stats as spstats
 */
  __pyx_tuple__150 = PyTuple_Pack(2, __pyx_n_s_matplotlib, __pyx_n_s_pyplot); if (unlikely(!__pyx_tuple__150)) __PYX_ERR(0, 13, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__150);
  __Pyx_GIVEREF(__pyx_tuple__150);

  /* "gofast/tools/mathex.pyx":15
 * import matplotlib.pyplot as plt
 * 
 * import scipy.stats as spstats             # <<<<<<<<<<<<<<
 * from scipy._lib._util import float_factorial
 * from scipy.cluster.hierarchy import linkage
 */
  __pyx_tuple__151 = PyTuple_Pack(2, __pyx_n_s_scipy, __pyx_n_s_stats); if (unlikely(!__pyx_tuple__151)) __PYX_ERR(0, 15, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__151);
  __Pyx_GIVEREF(__pyx_tuple__151);

  /* "gofast/tools/mathex.pyx":97
 *     ]
 * 
 * def compute_p_values(             # <<<<<<<<<<<<<<
 *     data, depvar,
 *     method: str='pearson',
 */
  __pyx_tuple__152 = PyTuple_Pack(13, __pyx_n_s_data, __pyx_n_s_depvar, __pyx_n_s_method, __pyx_n_s_significance_threshold, __pyx_n_s_ignore, __pyx_n_s_column2ignore, __pyx_n_s_corr_methods, __pyx_n_s_p_values, __pyx_n_s_column, __pyx_n_s_corr_func, __pyx_n_s_corr, __pyx_n_s_p_value, __pyx_n_s_col); if (unlikely(!__pyx_tuple__152)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__152);
  __Pyx_GIVEREF(__pyx_tuple__152);
  __pyx_codeobj_ = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__152, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_p_values, 97, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj_)) __PYX_ERR(0, 97, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":242
 *     return p_values
 * 
 * def compute_balance_accuracy(             # <<<<<<<<<<<<<<
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 */
  __pyx_tuple__153 = PyTuple_Pack(9, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_epsilon, __pyx_n_s_zero_division, __pyx_n_s_strategy, __pyx_n_s_normalize, __pyx_n_s_sample_weight, __pyx_n_s_labels, __pyx_n_s_scores); if (unlikely(!__pyx_tuple__153)) __PYX_ERR(0, 242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__153);
  __Pyx_GIVEREF(__pyx_tuple__153);
  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__153, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_balance_accuracy, 242, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 242, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":344
 *     return scores
 * 
 * def _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,
 */
  __pyx_tuple__154 = PyTuple_Pack(9, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_epsilon, __pyx_n_s_zero_division, __pyx_n_s_normalize, __pyx_n_s_sample_weight, __pyx_n_s_cm, __pyx_n_s_sensitivity, __pyx_n_s_specificity); if (unlikely(!__pyx_tuple__154)) __PYX_ERR(0, 344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__154);
  __Pyx_GIVEREF(__pyx_tuple__154);
  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(6, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__154, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_balanced_accuracy_binar, 344, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 344, __pyx_L1_error)
  __pyx_tuple__155 = PyTuple_Pack(4, ((PyObject*)__pyx_float_1eneg_15), ((PyObject *)__pyx_int_0), ((PyObject *)Py_False), Py_None); if (unlikely(!__pyx_tuple__155)) __PYX_ERR(0, 344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__155);
  __Pyx_GIVEREF(__pyx_tuple__155);

  /* "gofast/tools/mathex.pyx":357
 *         sensitivity + specificity) else zero_division
 * 
 * def _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,
 */
  __pyx_tuple__156 = PyTuple_Pack(12, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_labels, __pyx_n_s_epsilon, __pyx_n_s_zero_division, __pyx_n_s_normalize, __pyx_n_s_sample_weight, __pyx_n_s_bal_acc_scores, __pyx_n_s_label, __pyx_n_s_binary_y_true, __pyx_n_s_binary_y_pred, __pyx_n_s_score); if (unlikely(!__pyx_tuple__156)) __PYX_ERR(0, 357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__156);
  __Pyx_GIVEREF(__pyx_tuple__156);
  __pyx_codeobj__14 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__156, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_balanced_accuracy_ovr, 357, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__14)) __PYX_ERR(0, 357, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":372
 *     return np.array(bal_acc_scores)
 * 
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):             # <<<<<<<<<<<<<<
 *     le = LabelEncoder()
 *     y_true_encoded = le.fit_transform(y_true)
 */
  __pyx_tuple__157 = PyTuple_Pack(15, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_labels, __pyx_n_s_sample_weight, __pyx_n_s_le, __pyx_n_s_y_true_encoded, __pyx_n_s_y_bin, __pyx_n_s_bal_acc_scores, __pyx_n_s_i, __pyx_n_s_label_i, __pyx_n_s_j, __pyx_n_s_label_j, __pyx_n_s_specific_y_true, __pyx_n_s_specific_y_pred, __pyx_n_s_auc_score); if (unlikely(!__pyx_tuple__157)) __PYX_ERR(0, 372, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__157);
  __Pyx_GIVEREF(__pyx_tuple__157);
  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__157, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_balanced_accuracy_ovo, 372, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 372, __pyx_L1_error)
  __pyx_tuple__158 = PyTuple_Pack(1, Py_None); if (unlikely(!__pyx_tuple__158)) __PYX_ERR(0, 372, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__158);
  __Pyx_GIVEREF(__pyx_tuple__158);

  /* "gofast/tools/mathex.pyx":388
 *     return np.array(bal_acc_scores)
 * 
 * def compute_cost_based_threshold(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, costs, *,
 *     sample_weight=None
 */
  __pyx_tuple__159 = PyTuple_Pack(14, __pyx_n_s_y_true, __pyx_n_s_y_scores, __pyx_n_s_costs, __pyx_n_s_sample_weight, __pyx_n_s_thresholds, __pyx_n_s_best_threshold, __pyx_n_s_C_FP, __pyx_n_s_C_FN, __pyx_n_s_min_cost, __pyx_n_s_threshold, __pyx_n_s_predicted_labels, __pyx_n_s_FP, __pyx_n_s_FN, __pyx_n_s_total_cost); if (unlikely(!__pyx_tuple__159)) __PYX_ERR(0, 388, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__159);
  __Pyx_GIVEREF(__pyx_tuple__159);
  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(3, 0, 1, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__159, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_cost_based_threshold, 388, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 388, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":466
 *     return best_threshold, min_cost
 * 
 * def compute_youdens_index(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, *,
 *     sample_weight=None,
 */
  __pyx_tuple__160 = PyTuple_Pack(12, __pyx_n_s_y_true, __pyx_n_s_y_scores, __pyx_n_s_sample_weight, __pyx_n_s_pos_label, __pyx_n_s_drop_intermediate, __pyx_n_s_fpr, __pyx_n_s_tpr, __pyx_n_s_thresholds, __pyx_n_s_youdens_index, __pyx_n_s_optimal_idx, __pyx_n_s_optimal_threshold, __pyx_n_s_optimal_youden); if (unlikely(!__pyx_tuple__160)) __PYX_ERR(0, 466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__160);
  __Pyx_GIVEREF(__pyx_tuple__160);
  __pyx_codeobj__18 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__160, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_youdens_index, 466, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__18)) __PYX_ERR(0, 466, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":547
 *     return optimal_threshold, optimal_youden
 * 
 * def calculate_multiclass_avg_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     strategy='ovr',
 */
  __pyx_tuple__161 = PyTuple_Pack(23, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_strategy, __pyx_n_s_consensus, __pyx_n_s_sample_weight, __pyx_n_s_multi_output, __pyx_n_s_epsilon, __pyx_n_s_classes, __pyx_n_s_sensitivities, __pyx_n_s_specificities, __pyx_n_s_y_true_binarized, __pyx_n_s_i, __pyx_n_s_cls, __pyx_n_s_sensitivity, __pyx_n_s_specificity, __pyx_n_s_cls1, __pyx_n_s_cls2, __pyx_n_s_relevant_mask, __pyx_n_s_y_true_binary, __pyx_n_s_y_pred_binary, __pyx_n_s_avg_sensitivity, __pyx_n_s_avg_specificity, __pyx_n_s_lr); if (unlikely(!__pyx_tuple__161)) __PYX_ERR(0, 547, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__161);
  __Pyx_GIVEREF(__pyx_tuple__161);
  __pyx_codeobj__20 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 23, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__161, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_multiclass_avg_lr, 547, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 547, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":662
 *     return lr, avg_sensitivity, avg_specificity
 * 
 * def calculate_multiclass_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     consensus='positive',
 */
  __pyx_tuple__162 = PyTuple_Pack(24, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_consensus, __pyx_n_s_sample_weight, __pyx_n_s_strategy, __pyx_n_s_epsilon, __pyx_n_s_multi_output, __pyx_n_s_apply_log_scale, __pyx_n_s_include_metrics, __pyx_n_s_classes, __pyx_n_s_results, __pyx_n_s_sensitivities, __pyx_n_s_specificities, __pyx_n_s_y_true_binarized, __pyx_n_s_i, __pyx_n_s_label, __pyx_n_s_sensitivity, __pyx_n_s_specificity, __pyx_n_s_lr, __pyx_n_s_cls1, __pyx_n_s_cls2, __pyx_n_s_relevant_mask, __pyx_n_s_y_true_binary, __pyx_n_s_y_pred_binary); if (unlikely(!__pyx_tuple__162)) __PYX_ERR(0, 662, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__162);
  __Pyx_GIVEREF(__pyx_tuple__162);
  __pyx_codeobj__22 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 24, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__162, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_multiclass_lr, 662, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__22)) __PYX_ERR(0, 662, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":809
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 * def calculate_adjusted_lr(             # <<<<<<<<<<<<<<
 *     sensitivity,
 *     specificity,
 */
  __pyx_tuple__163 = PyTuple_Pack(6, __pyx_n_s_sensitivity, __pyx_n_s_specificity, __pyx_n_s_consensus, __pyx_n_s_max_lr, __pyx_n_s_buffer, __pyx_n_s_lr); if (unlikely(!__pyx_tuple__163)) __PYX_ERR(0, 809, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__163);
  __Pyx_GIVEREF(__pyx_tuple__163);
  __pyx_codeobj__23 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__163, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_adjusted_lr, 809, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__23)) __PYX_ERR(0, 809, __pyx_L1_error)
  __pyx_tuple__164 = PyTuple_Pack(3, ((PyObject*)__pyx_n_u_positive), ((PyObject *)__pyx_int_100), ((PyObject*)__pyx_float_1eneg_2)); if (unlikely(!__pyx_tuple__164)) __PYX_ERR(0, 809, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__164);
  __Pyx_GIVEREF(__pyx_tuple__164);

  /* "gofast/tools/mathex.pyx":920
 *     return lr
 * 
 * def _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight=None, epsilon=1e-10):
 *     """
 */
  __pyx_tuple__165 = PyTuple_Pack(10, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_sample_weight, __pyx_n_s_epsilon, __pyx_n_s_true_positives, __pyx_n_s_false_positives, __pyx_n_s_false_negatives, __pyx_n_s_true_negatives, __pyx_n_s_sensitivity, __pyx_n_s_specificity); if (unlikely(!__pyx_tuple__165)) __PYX_ERR(0, 920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__165);
  __Pyx_GIVEREF(__pyx_tuple__165);
  __pyx_codeobj__25 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__165, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_sensitivity_specificity, 920, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__25)) __PYX_ERR(0, 920, __pyx_L1_error)
  __pyx_tuple__166 = PyTuple_Pack(2, Py_None, ((PyObject*)__pyx_float_1eneg_10)); if (unlikely(!__pyx_tuple__166)) __PYX_ERR(0, 920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__166);
  __Pyx_GIVEREF(__pyx_tuple__166);

  /* "gofast/tools/mathex.pyx":1001
 *     return sensitivity, specificity
 * 
 * def compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight=None,
 */
  __pyx_tuple__167 = PyTuple_Pack(27, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_sample_weight, __pyx_n_s_strategy, __pyx_n_s_average, __pyx_n_s_epsilon, __pyx_n_s_labels, __pyx_n_s_label_to_index, __pyx_n_s_y_true_indices, __pyx_n_s_y_pred_indices, __pyx_n_s_cm, __pyx_n_s_sensitivity, __pyx_n_s_specificity, __pyx_n_s_i, __pyx_n_s_TP, __pyx_n_s_FN, __pyx_n_s_FP, __pyx_n_s_TN, __pyx_n_s_support, __pyx_n_s_total_TP, __pyx_n_s_total_FN, __pyx_n_s_total_FP, __pyx_n_s_total_TN, __pyx_n_s_micro_sensitivity, __pyx_n_s_micro_specificity, __pyx_n_s_index, __pyx_n_s_label); if (unlikely(!__pyx_tuple__167)) __PYX_ERR(0, 1001, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__167);
  __Pyx_GIVEREF(__pyx_tuple__167);
  __pyx_codeobj__26 = (PyObject*)__Pyx_PyCode_New(2, 0, 4, 27, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__167, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_sensitivity_specificity_2, 1001, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__26)) __PYX_ERR(0, 1001, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1140
 *     return sensitivity, specificity
 * 
 * def _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True):             # <<<<<<<<<<<<<<
 *     """
 *     Compute sensitivity and specificity for each pair of classes
 */
  __pyx_tuple__168 = PyTuple_Pack(26, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_labels, __pyx_n_s_return_array, __pyx_n_s_sensitivity, __pyx_n_s_specificity, __pyx_n_s_i, __pyx_n_s_j, __pyx_n_s_pair_indices, __pyx_n_s_y_true_pair, __pyx_n_s_y_pred_pair, __pyx_n_s_y_true_binary, __pyx_n_s_y_pred_binary, __pyx_n_s_cm, __pyx_n_s_TP, __pyx_n_s_FN, __pyx_n_s_FP, __pyx_n_s_TN, __pyx_n_s_sens_array, __pyx_n_s_spec_array, __pyx_n_s_idx, __pyx_n_s_label, __pyx_n_s_involved_pairs, __pyx_n_s_key, __pyx_n_s_pair, __pyx_n_s_pair); if (unlikely(!__pyx_tuple__168)) __PYX_ERR(0, 1140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__168);
  __Pyx_GIVEREF(__pyx_tuple__168);
  __pyx_codeobj__28 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 26, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__168, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_ovo_sens_spec, 1140, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__28)) __PYX_ERR(0, 1140, __pyx_L1_error)
  __pyx_tuple__169 = PyTuple_Pack(1, ((PyObject *)Py_True)); if (unlikely(!__pyx_tuple__169)) __PYX_ERR(0, 1140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__169);
  __Pyx_GIVEREF(__pyx_tuple__169);

  /* "gofast/tools/mathex.pyx":1217
 *     return sensitivity, specificity
 * 
 * def calculate_histogram_bins(             # <<<<<<<<<<<<<<
 *         data:ArrayLike,  bins:Union [int, str, list]='auto', range:Tuple[float, float]=None, normalize: bool=False):
 *     """
 */
  __pyx_tuple__170 = PyTuple_Pack(5, __pyx_n_s_data, __pyx_n_s_bins, __pyx_n_s_range, __pyx_n_s_normalize, __pyx_n_s_bin_edges); if (unlikely(!__pyx_tuple__170)) __PYX_ERR(0, 1217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__170);
  __Pyx_GIVEREF(__pyx_tuple__170);
  __pyx_codeobj__29 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__170, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_histogram_bins, 1217, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__29)) __PYX_ERR(0, 1217, __pyx_L1_error)
  __pyx_tuple__171 = PyTuple_Pack(3, ((PyObject*)__pyx_n_u_auto), Py_None, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__171)) __PYX_ERR(0, 1217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__171);
  __Pyx_GIVEREF(__pyx_tuple__171);

  /* "gofast/tools/mathex.pyx":1263
 *     return bin_edges
 * 
 * def rank_data(data, method='average'):             # <<<<<<<<<<<<<<
 *     """
 *     Assigns ranks to data, handling ties according to the specified method.
 */
  __pyx_tuple__172 = PyTuple_Pack(9, __pyx_n_s_data, __pyx_n_s_method, __pyx_n_s_sorter, __pyx_n_s_inv, __pyx_n_s_ranks, __pyx_n_s_valid_methods, __pyx_n_s_dense_rank, __pyx_n_s_prev_val, __pyx_n_s_i); if (unlikely(!__pyx_tuple__172)) __PYX_ERR(0, 1263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__172);
  __Pyx_GIVEREF(__pyx_tuple__172);
  __pyx_codeobj__30 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__172, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_rank_data, 1263, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__30)) __PYX_ERR(0, 1263, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1351
 *     return ranks
 * 
 * def optimized_spearmanr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,
 */
  __pyx_tuple__173 = PyTuple_Pack(10, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_sample_weight, __pyx_n_s_tie_method, __pyx_n_s_nan_policy, __pyx_n_s_control_vars, __pyx_n_s_multioutput, __pyx_n_s_results, __pyx_n_s_i, __pyx_n_s_corr); if (unlikely(!__pyx_tuple__173)) __PYX_ERR(0, 1351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__173);
  __Pyx_GIVEREF(__pyx_tuple__173);
  __pyx_codeobj__32 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__173, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_optimized_spearmanr, 1351, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__32)) __PYX_ERR(0, 1351, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1441
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)
 * 
 * def _compute_spearmanr(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight, tie_method, nan_policy, control_vars):
 *     # The key addition is the handling of multioutput by reshaping inputs if
 */
  __pyx_tuple__174 = PyTuple_Pack(14, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_sample_weight, __pyx_n_s_tie_method, __pyx_n_s_nan_policy, __pyx_n_s_control_vars, __pyx_n_s_weighted_spearman_corr, __pyx_n_s_weighted_spearman_corr, __pyx_n_s_valid_policies, __pyx_n_s_valid_mask, __pyx_n_s_valid_methods, __pyx_n_s_ranks_true, __pyx_n_s_ranks_pred, __pyx_n_s_corr); if (unlikely(!__pyx_tuple__174)) __PYX_ERR(0, 1441, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__174);
  __Pyx_GIVEREF(__pyx_tuple__174);
  __pyx_codeobj__33 = (PyObject*)__Pyx_PyCode_New(6, 0, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__174, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_spearmanr, 1441, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__33)) __PYX_ERR(0, 1441, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1505
 *     return corr
 * 
 * def adjust_for_control_vars(y_true:ArrayLike, y_pred:ArrayLike, control_vars:Optional[Union[ArrayLike, List[ArrayLike]]]=None):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts y_true and y_pred for either regression or classification tasks by
 */
  __pyx_tuple__175 = PyTuple_Pack(4, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_control_vars, __pyx_n_s_adjusted_y_true); if (unlikely(!__pyx_tuple__175)) __PYX_ERR(0, 1505, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__175);
  __Pyx_GIVEREF(__pyx_tuple__175);
  __pyx_codeobj__37 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__175, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_adjust_for_control_vars, 1505, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__37)) __PYX_ERR(0, 1505, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1587
 *     return adjusted_y_true, adjusted_y_true
 * 
 * def adjust_for_control_vars_regression(y_true:ArrayLike, y_pred: ArrayLike, control_vars: Union[ArrayLike, List[ArrayLike]]):             # <<<<<<<<<<<<<<
 *     """
 *     Adjust y_true and y_pred for regression tasks by accounting for the influence
 */
  __pyx_tuple__176 = PyTuple_Pack(8, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_control_vars, __pyx_n_s_LinearRegression, __pyx_n_s_model_true, __pyx_n_s_residuals_true, __pyx_n_s_model_pred, __pyx_n_s_residuals_pred); if (unlikely(!__pyx_tuple__176)) __PYX_ERR(0, 1587, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__176);
  __Pyx_GIVEREF(__pyx_tuple__176);
  __pyx_codeobj__38 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__176, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_adjust_for_control_vars_regressi, 1587, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__38)) __PYX_ERR(0, 1587, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1683
 *     return residuals_true, residuals_pred
 * 
 * def adjust_for_control_vars_classification(y_true:ArrayLike, y_pred:ArrayLike, control_vars:DataFrame):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts `y_true` and `y_pred` in a classification task by stratifying the
 */
  __pyx_tuple__178 = PyTuple_Pack(15, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_control_vars, __pyx_n_s_LogisticRegression, __pyx_n_s_LabelEncoder, __pyx_n_s_data, __pyx_n_s_col, __pyx_n_s_le_true, __pyx_n_s_le_pred, __pyx_n_s_adjusted_preds, __pyx_n_s__177, __pyx_n_s_group, __pyx_n_s_lr, __pyx_n_s_adjusted_pred, __pyx_n_s_adjusted_y_pred); if (unlikely(!__pyx_tuple__178)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__178);
  __Pyx_GIVEREF(__pyx_tuple__178);
  __pyx_codeobj__42 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 15, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__178, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_adjust_for_control_vars_classifi, 1683, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__42)) __PYX_ERR(0, 1683, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1795
 *     return np.array(y_true), adjusted_y_pred
 * 
 * def weighted_spearman_rank(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,
 */
  __pyx_tuple__179 = PyTuple_Pack(13, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_sample_weight, __pyx_n_s_return_weighted_rank, __pyx_n_s_epsilon, __pyx_n_s_weighted_rank, __pyx_n_s_weighted_rank, __pyx_n_s_ranks_true, __pyx_n_s_ranks_pred, __pyx_n_s_cov, __pyx_n_s_std_true, __pyx_n_s_std_pred, __pyx_n_s_rho); if (unlikely(!__pyx_tuple__179)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__179);
  __Pyx_GIVEREF(__pyx_tuple__179);
  __pyx_codeobj__43 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 13, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__179, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_weighted_spearman_rank, 1795, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__43)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __pyx_tuple__180 = PyTuple_Pack(2, ((PyObject *)Py_False), ((PyObject*)__pyx_float_1eneg_10)); if (unlikely(!__pyx_tuple__180)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__180);
  __Pyx_GIVEREF(__pyx_tuple__180);

  /* "gofast/tools/mathex.pyx":1895
 *     return rho
 * 
 * def calculate_optimal_bins(y_pred, method='freedman_diaconis', data_range=None):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the optimal number of bins for histogramming a given set of
 */
  __pyx_tuple__181 = PyTuple_Pack(11, __pyx_n_s_y_pred, __pyx_n_s_method, __pyx_n_s_data_range, __pyx_n_s_data_min, __pyx_n_s_data_max, __pyx_n_s_n, __pyx_n_s_iqr, __pyx_n_s_bin_width, __pyx_n_s_optimal_bins, __pyx_n_s_genexpr, __pyx_n_s_genexpr); if (unlikely(!__pyx_tuple__181)) __PYX_ERR(0, 1895, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__181);
  __Pyx_GIVEREF(__pyx_tuple__181);
  __pyx_codeobj__46 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 11, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__181, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_optimal_bins, 1895, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__46)) __PYX_ERR(0, 1895, __pyx_L1_error)
  __pyx_tuple__182 = PyTuple_Pack(2, ((PyObject*)__pyx_n_u_freedman_diaconis), Py_None); if (unlikely(!__pyx_tuple__182)) __PYX_ERR(0, 1895, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__182);
  __Pyx_GIVEREF(__pyx_tuple__182);

  /* "gofast/tools/mathex.pyx":1993
 *     return max(1, optimal_bins)  # Ensure at least one bin
 * 
 * def calculate_binary_iv(             # <<<<<<<<<<<<<<
 *     y_true,
 *     y_pred,
 */
  __pyx_tuple__183 = PyTuple_Pack(19, __pyx_n_s_y_true, __pyx_n_s_y_pred, __pyx_n_s_epsilon, __pyx_n_s_method, __pyx_n_s_bins, __pyx_n_s_bins_method, __pyx_n_s_data_range, __pyx_n_s_msg_meth, __pyx_n_s_percent_events, __pyx_n_s_percent_non_events, __pyx_n_s_bins_array, __pyx_n_s_digitized, __pyx_n_s_iv, __pyx_n_s_bin_index, __pyx_n_s_in_bin, __pyx_n_s_bin_true, __pyx_n_s_percent_events_bin, __pyx_n_s_percent_non_events_bin, __pyx_n_s_bin_contribution); if (unlikely(!__pyx_tuple__183)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__183);
  __Pyx_GIVEREF(__pyx_tuple__183);
  __pyx_codeobj__49 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__183, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_binary_iv, 1993, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__49)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __pyx_tuple__184 = PyTuple_Pack(5, ((PyObject*)__pyx_float_1eneg_15), ((PyObject*)__pyx_n_u_base), ((PyObject*)__pyx_n_u_auto), ((PyObject*)__pyx_n_u_freedman_diaconis), Py_None); if (unlikely(!__pyx_tuple__184)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__184);
  __Pyx_GIVEREF(__pyx_tuple__184);

  /* "gofast/tools/mathex.pyx":2148
 *         return iv
 * 
 * def determine_epsilon(y_pred, base_epsilon=1e-15, scale_factor=1e-5):             # <<<<<<<<<<<<<<
 *     """
 *     Determine an appropriate epsilon value based on the predictions.
 */
  __pyx_tuple__185 = PyTuple_Pack(6, __pyx_n_s_y_pred, __pyx_n_s_base_epsilon, __pyx_n_s_scale_factor, __pyx_n_s_positive_preds, __pyx_n_s_min_non_zero_pred, __pyx_n_s_epsilon); if (unlikely(!__pyx_tuple__185)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__185);
  __Pyx_GIVEREF(__pyx_tuple__185);
  __pyx_codeobj__53 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__185, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_determine_epsilon, 2148, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__53)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __pyx_tuple__186 = PyTuple_Pack(2, ((PyObject*)__pyx_float_1eneg_15), ((PyObject*)__pyx_float_1eneg_5)); if (unlikely(!__pyx_tuple__186)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__186);
  __Pyx_GIVEREF(__pyx_tuple__186);

  /* "gofast/tools/mathex.pyx":2195
 *     return epsilon
 * 
 * def calculate_residuals(             # <<<<<<<<<<<<<<
 *     actual: ArrayLike,
 *     predicted: Union[np.ndarray, List[ArrayLike]],
 */
  __pyx_tuple__187 = PyTuple_Pack(6, __pyx_n_s_actual, __pyx_n_s_predicted, __pyx_n_s_task_type, __pyx_n_s_predict_proba, __pyx_n_s_prob_true_class, __pyx_n_s_residuals); if (unlikely(!__pyx_tuple__187)) __PYX_ERR(0, 2195, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__187);
  __Pyx_GIVEREF(__pyx_tuple__187);
  __pyx_codeobj__54 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__187, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_calculate_residuals, 2195, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__54)) __PYX_ERR(0, 2195, __pyx_L1_error)
  __pyx_tuple__188 = PyTuple_Pack(2, ((PyObject*)__pyx_n_u_regression), Py_None); if (unlikely(!__pyx_tuple__188)) __PYX_ERR(0, 2195, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__188);
  __Pyx_GIVEREF(__pyx_tuple__188);

  /* "gofast/tools/mathex.pyx":2272
 *     return residuals
 * 
 * def infer_sankey_columns(data: DataFrame,             # <<<<<<<<<<<<<<
 *   ) -> Tuple[List[str], List[str], List[int]]:
 *     """
 */
  __pyx_tuple__189 = PyTuple_Pack(9, __pyx_n_s_data, __pyx_n_s_numeric_cols, __pyx_n_s_value_col, __pyx_n_s_source_col, __pyx_n_s_target_col, __pyx_n_s_col, __pyx_n_s_sources, __pyx_n_s_targets, __pyx_n_s_values); if (unlikely(!__pyx_tuple__189)) __PYX_ERR(0, 2272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__189);
  __Pyx_GIVEREF(__pyx_tuple__189);
  __pyx_codeobj__59 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__189, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_infer_sankey_columns, 2272, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__59)) __PYX_ERR(0, 2272, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2348
 *     return sources, targets, values
 * 
 * def compute_sunburst_data(             # <<<<<<<<<<<<<<
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,
 */
  __pyx_tuple__190 = PyTuple_Pack(12, __pyx_n_s_data, __pyx_n_s_hierarchy, __pyx_n_s_value_column, __pyx_n_s_df_full, __pyx_n_s_i, __pyx_n_s_df_level, __pyx_n_s_sunburst_data, __pyx_n_s_seen, __pyx_n_s_i, __pyx_n_s__177, __pyx_n_s_row, __pyx_n_s_x); if (unlikely(!__pyx_tuple__190)) __PYX_ERR(0, 2348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__190);
  __Pyx_GIVEREF(__pyx_tuple__190);
  __pyx_codeobj__64 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__190, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_sunburst_data, 2348, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__64)) __PYX_ERR(0, 2348, __pyx_L1_error)
  __pyx_tuple__191 = PyTuple_Pack(2, Py_None, Py_None); if (unlikely(!__pyx_tuple__191)) __PYX_ERR(0, 2348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__191);
  __Pyx_GIVEREF(__pyx_tuple__191);

  /* "gofast/tools/mathex.pyx":2440
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 * def compute_effort_yield(             # <<<<<<<<<<<<<<
 *         d: ArrayLike,  reverse: bool = True
 *         ) -> Tuple[ArrayLike, np.ndarray]:
 */
  __pyx_tuple__192 = PyTuple_Pack(7, __pyx_n_s_d, __pyx_n_s_reverse, __pyx_n_s_sorted_indices, __pyx_n_s_sorted_data, __pyx_n_s_cumulative_data, __pyx_n_s_yield, __pyx_n_s_effort); if (unlikely(!__pyx_tuple__192)) __PYX_ERR(0, 2440, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__192);
  __Pyx_GIVEREF(__pyx_tuple__192);
  __pyx_codeobj__66 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__192, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_effort_yield, 2440, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__66)) __PYX_ERR(0, 2440, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2514
 *     return effort, yield_
 * 
 * def make_mxs(             # <<<<<<<<<<<<<<
 *     y,
 *     yt,
 */
  __pyx_tuple__193 = PyTuple_Pack(18, __pyx_n_s_y, __pyx_n_s_yt, __pyx_n_s_threshold, __pyx_n_s_star_mxs, __pyx_n_s_return_ymxs, __pyx_n_s_mode, __pyx_n_s_include_nan, __pyx_n_s_trailer, __pyx_n_s_pairwise_distances, __pyx_n_s_yt_transformed, __pyx_n_s_similarities, __pyx_n_s_i, __pyx_n_s_label_y, __pyx_n_s_include_label, __pyx_n_s_similarity, __pyx_n_s_label_yt_trailer, __pyx_n_s_ymxs, __pyx_n_s_label); if (unlikely(!__pyx_tuple__193)) __PYX_ERR(0, 2514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__193);
  __Pyx_GIVEREF(__pyx_tuple__193);
  __pyx_codeobj__71 = (PyObject*)__Pyx_PyCode_New(8, 0, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__193, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_make_mxs, 2514, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__71)) __PYX_ERR(0, 2514, __pyx_L1_error)
  __pyx_tuple__194 = PyTuple_Pack(6, ((PyObject*)__pyx_float_0_5), ((PyObject *)Py_True), ((PyObject *)Py_False), ((PyObject*)__pyx_n_u_strict), ((PyObject *)Py_False), ((PyObject*)__pyx_kp_u__70)); if (unlikely(!__pyx_tuple__194)) __PYX_ERR(0, 2514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__194);
  __Pyx_GIVEREF(__pyx_tuple__194);

  /* "gofast/tools/mathex.pyx":2612
 *     return ymxs if return_ymxs else similarities
 * 
 * def label_importance(y, include_nan=False):             # <<<<<<<<<<<<<<
 *     """
 *     Compute the importance of each label in a target array.
 */
  __pyx_tuple__195 = PyTuple_Pack(7, __pyx_n_s_y, __pyx_n_s_include_nan, __pyx_n_s_labels, __pyx_n_s_counts, __pyx_n_s_total, __pyx_n_s_label, __pyx_n_s_count); if (unlikely(!__pyx_tuple__195)) __PYX_ERR(0, 2612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__195);
  __Pyx_GIVEREF(__pyx_tuple__195);
  __pyx_codeobj__74 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__195, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_label_importance, 2612, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__74)) __PYX_ERR(0, 2612, __pyx_L1_error)
  __pyx_tuple__196 = PyTuple_Pack(1, ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__196)) __PYX_ERR(0, 2612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__196);
  __Pyx_GIVEREF(__pyx_tuple__196);

  /* "gofast/tools/mathex.pyx":2659
 *     return {label: count / total for label, count in zip(labels, counts)}
 * 
 * def linear_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     linear regression.
 */
  __pyx_tuple__197 = PyTuple_Pack(4, __pyx_n_s_X, __pyx_n_s_coef, __pyx_n_s_bias, __pyx_n_s_noise); if (unlikely(!__pyx_tuple__197)) __PYX_ERR(0, 2659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__197);
  __Pyx_GIVEREF(__pyx_tuple__197);
  __pyx_codeobj__75 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_linear_regression, 2659, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__75)) __PYX_ERR(0, 2659, __pyx_L1_error)
  __pyx_tuple__198 = PyTuple_Pack(2, ((PyObject*)__pyx_float_0_), ((PyObject*)__pyx_float_0_)); if (unlikely(!__pyx_tuple__198)) __PYX_ERR(0, 2659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__198);
  __Pyx_GIVEREF(__pyx_tuple__198);

  /* "gofast/tools/mathex.pyx":2698
 *     return np.dot(X, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def quadratic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Quadratic regression.
 */
  __pyx_codeobj__76 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_quadratic_regression, 2698, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__76)) __PYX_ERR(0, 2698, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2731
 *     return np.dot(X**2, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def cubic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Cubic regression.
 */
  __pyx_codeobj__77 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_cubic_regression, 2731, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__77)) __PYX_ERR(0, 2731, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2764
 *     return np.dot(X**3, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def exponential_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Exponential regression.
 */
  __pyx_codeobj__78 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_exponential_regression, 2764, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__78)) __PYX_ERR(0, 2764, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2796
 *     return np.exp(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def logarithmic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Logarithmic regression.
 */
  __pyx_codeobj__79 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_logarithmic_regression, 2796, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__79)) __PYX_ERR(0, 2796, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2829
 *     return np.dot(np.log(X), coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def sinusoidal_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Sinusoidal regression.
 */
  __pyx_codeobj__80 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__197, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_sinusoidal_regression, 2829, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__80)) __PYX_ERR(0, 2829, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2861
 *     return np.sin(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def step_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Step regression.
 */
  __pyx_tuple__199 = PyTuple_Pack(5, __pyx_n_s_X, __pyx_n_s_coef, __pyx_n_s_bias, __pyx_n_s_noise, __pyx_n_s_step_function); if (unlikely(!__pyx_tuple__199)) __PYX_ERR(0, 2861, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__199);
  __Pyx_GIVEREF(__pyx_tuple__199);
  __pyx_codeobj__81 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__199, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_step_regression, 2861, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__81)) __PYX_ERR(0, 2861, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2896
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def standard_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales features to have zero mean and unit variance.
 */
  __pyx_tuple__200 = PyTuple_Pack(8, __pyx_n_s_X, __pyx_n_s_y, __pyx_n_s_X_mean, __pyx_n_s_X_std, __pyx_n_s_X_scaled, __pyx_n_s_y_mean, __pyx_n_s_y_std, __pyx_n_s_y_scaled); if (unlikely(!__pyx_tuple__200)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__200);
  __Pyx_GIVEREF(__pyx_tuple__200);
  __pyx_codeobj__82 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__200, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_standard_scaler, 2896, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__82)) __PYX_ERR(0, 2896, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2947
 *     return X_scaled
 * 
 * def minmax_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales each feature to a given range, typically [0, 1].
 */
  __pyx_tuple__201 = PyTuple_Pack(8, __pyx_n_s_X, __pyx_n_s_y, __pyx_n_s_X_min, __pyx_n_s_X_max, __pyx_n_s_X_scaled, __pyx_n_s_y_min, __pyx_n_s_y_max, __pyx_n_s_y_scaled); if (unlikely(!__pyx_tuple__201)) __PYX_ERR(0, 2947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__201);
  __Pyx_GIVEREF(__pyx_tuple__201);
  __pyx_codeobj__83 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__201, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_minmax_scaler, 2947, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__83)) __PYX_ERR(0, 2947, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":2997
 *     return X_scaled
 * 
 * def normalize(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales individual samples to have unit norm.
 */
  __pyx_tuple__202 = PyTuple_Pack(6, __pyx_n_s_X, __pyx_n_s_y, __pyx_n_s_X_norm, __pyx_n_s_X_normalized, __pyx_n_s_y_norm, __pyx_n_s_y_normalized); if (unlikely(!__pyx_tuple__202)) __PYX_ERR(0, 2997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__202);
  __Pyx_GIVEREF(__pyx_tuple__202);
  __pyx_codeobj__84 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__202, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_normalize, 2997, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__84)) __PYX_ERR(0, 2997, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3046
 * 
 *     return X_normalized
 * def moving_average (             # <<<<<<<<<<<<<<
 *     y:ArrayLike,
 *     *,
 */
  __pyx_tuple__203 = PyTuple_Pack(10, __pyx_n_s_y, __pyx_n_s_window_size, __pyx_n_s_method, __pyx_n_s_mode, __pyx_n_s_alpha, __pyx_n_s_ya, __pyx_n_s_w, __pyx_n_s_ii, __pyx_n_s_v, __pyx_n_s_ii); if (unlikely(!__pyx_tuple__203)) __PYX_ERR(0, 3046, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__203);
  __Pyx_GIVEREF(__pyx_tuple__203);
  __pyx_codeobj__85 = (PyObject*)__Pyx_PyCode_New(1, 0, 4, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__203, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_moving_average, 3046, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__85)) __PYX_ERR(0, 3046, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3171
 * 
 * 
 * def count_local_minima(arr,  method='robust', order=1):             # <<<<<<<<<<<<<<
 *     """
 *     Count the number of local minima in a 1D array.
 */
  __pyx_tuple__204 = PyTuple_Pack(6, __pyx_n_s_arr, __pyx_n_s_method, __pyx_n_s_order, __pyx_n_s_local_minima_count, __pyx_n_s_i, __pyx_n_s_local_minima_indices); if (unlikely(!__pyx_tuple__204)) __PYX_ERR(0, 3171, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__204);
  __Pyx_GIVEREF(__pyx_tuple__204);
  __pyx_codeobj__91 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__204, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_count_local_minima, 3171, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__91)) __PYX_ERR(0, 3171, __pyx_L1_error)
  __pyx_tuple__205 = PyTuple_Pack(2, ((PyObject*)__pyx_n_u_robust), ((PyObject *)__pyx_int_1)); if (unlikely(!__pyx_tuple__205)) __PYX_ERR(0, 3171, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__205);
  __Pyx_GIVEREF(__pyx_tuple__205);

  /* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */
  __pyx_tuple__206 = PyTuple_Pack(18, __pyx_n_s_xlon, __pyx_n_s_ylat, __pyx_n_s_data, __pyx_n_s_utm_zone, __pyx_n_s_projection, __pyx_n_s_isdeg, __pyx_n_s_mode, __pyx_n_s_extrapolate, __pyx_n_s_view, __pyx_n_s_Location, __pyx_n_s_msg, __pyx_n_s_dx, __pyx_n_s_dy, __pyx_n_s_z, __pyx_n_s_azim, __pyx_n_s_x, __pyx_n_s_fig, __pyx_n_s_ax); if (unlikely(!__pyx_tuple__206)) __PYX_ERR(0, 3229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__206);
  __Pyx_GIVEREF(__pyx_tuple__206);
  __pyx_codeobj__93 = (PyObject*)__Pyx_PyCode_New(2, 0, 7, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__206, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_get_azimuth, 3229, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__93)) __PYX_ERR(0, 3229, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3395
 *     return azim
 * 
 * def linkage_matrix(             # <<<<<<<<<<<<<<
 *     df: DataFrame ,
 *     columns:List[str] =None,
 */
  __pyx_tuple__207 = PyTuple_Pack(12, __pyx_n_s_df, __pyx_n_s_columns, __pyx_n_s_kind, __pyx_n_s_metric, __pyx_n_s_method, __pyx_n_s_as_frame, __pyx_n_s_optimal_ordering, __pyx_n_s_labels, __pyx_n_s_row_dist, __pyx_n_s_row_clusters, __pyx_n_s_i, __pyx_n_s_i); if (unlikely(!__pyx_tuple__207)) __PYX_ERR(0, 3395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__207);
  __Pyx_GIVEREF(__pyx_tuple__207);
  __pyx_codeobj__97 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__207, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_linkage_matrix, 3395, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__97)) __PYX_ERR(0, 3395, __pyx_L1_error)
  __pyx_tuple__208 = PyTuple_Pack(6, Py_None, ((PyObject*)__pyx_n_u_design), ((PyObject*)__pyx_n_u_euclidean), ((PyObject*)__pyx_n_u_complete), ((PyObject *)Py_False), ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__208)) __PYX_ERR(0, 3395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__208);
  __Pyx_GIVEREF(__pyx_tuple__208);

  /* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */
  __pyx_tuple__209 = PyTuple_Pack(12, __pyx_n_s_ydata, __pyx_n_s_xdata, __pyx_n_s_func, __pyx_n_s_c_order, __pyx_n_s_show, __pyx_n_s_kws, __pyx_n_s_linfunc, __pyx_n_s_linfunc, __pyx_n_s_ix_c, __pyx_n_s_popt, __pyx_n_s_pcov, __pyx_n_s_ydata_new); if (unlikely(!__pyx_tuple__209)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__209);
  __Pyx_GIVEREF(__pyx_tuple__209);
  __pyx_codeobj__98 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__209, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_scalePosition, 3596, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__98)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __pyx_tuple__210 = PyTuple_Pack(4, Py_None, Py_None, ((PyObject *)__pyx_int_0), ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__210)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__210);
  __Pyx_GIVEREF(__pyx_tuple__210);

  /* "gofast/tools/mathex.pyx":3746
 *     return ydata_new, popt, pcov
 * 
 * def detect_station_position (             # <<<<<<<<<<<<<<
 *         s : Union[str, int] ,
 *         p: _SP,
 */
  __pyx_tuple__211 = PyTuple_Pack(5, __pyx_n_s_s, __pyx_n_s_p, __pyx_n_s_S, __pyx_n_s_dl, __pyx_n_s_s_index); if (unlikely(!__pyx_tuple__211)) __PYX_ERR(0, 3746, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__211);
  __Pyx_GIVEREF(__pyx_tuple__211);
  __pyx_codeobj__103 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__211, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_detect_station_position, 3746, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__103)) __PYX_ERR(0, 3746, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3826
 *     return int(s_index) , s
 * 
 * def _manage_colors (c, default = ['ok', 'ob-', 'r-']):             # <<<<<<<<<<<<<<
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default
 */
  __pyx_tuple__212 = PyTuple_Pack(2, __pyx_n_s_c, __pyx_n_s_default); if (unlikely(!__pyx_tuple__212)) __PYX_ERR(0, 3826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__212);
  __Pyx_GIVEREF(__pyx_tuple__212);
  __pyx_codeobj__108 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__212, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_manage_colors, 3826, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__108)) __PYX_ERR(0, 3826, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3837
 * 
 * 
 * def convert_distance_to_m(             # <<<<<<<<<<<<<<
 *         value:_T ,
 *         converter:float =1e3,
 */
  __pyx_tuple__213 = PyTuple_Pack(3, __pyx_n_s_value, __pyx_n_s_converter, __pyx_n_s_unit); if (unlikely(!__pyx_tuple__213)) __PYX_ERR(0, 3837, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__213);
  __Pyx_GIVEREF(__pyx_tuple__213);
  __pyx_codeobj__110 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__213, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_convert_distance_to_m, 3837, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__110)) __PYX_ERR(0, 3837, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3862
 *     return value
 * 
 * def get_station_number (             # <<<<<<<<<<<<<<
 *         dipole:float,
 *         distance:float ,
 */
  __pyx_tuple__214 = PyTuple_Pack(4, __pyx_n_s_dipole, __pyx_n_s_distance, __pyx_n_s_from0, __pyx_n_s_kws); if (unlikely(!__pyx_tuple__214)) __PYX_ERR(0, 3862, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__214);
  __Pyx_GIVEREF(__pyx_tuple__214);
  __pyx_codeobj__112 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 4, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__214, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_get_station_number, 3862, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__112)) __PYX_ERR(0, 3862, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3889
 * #FR3: #0A4CEE # (10, 76, 238)
 * 
 * def get_profile_angle (             # <<<<<<<<<<<<<<
 *         easting: float =None, northing: float =None, msg:str ="ignore" ):
 *     """
 */
  __pyx_tuple__215 = PyTuple_Pack(7, __pyx_n_s_easting, __pyx_n_s_northing, __pyx_n_s_msg, __pyx_n_s_profile1, __pyx_n_s_profile2, __pyx_n_s_profile_line, __pyx_n_s_profile_angle); if (unlikely(!__pyx_tuple__215)) __PYX_ERR(0, 3889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__215);
  __Pyx_GIVEREF(__pyx_tuple__215);
  __pyx_codeobj__113 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__215, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_get_profile_angle, 3889, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__113)) __PYX_ERR(0, 3889, __pyx_L1_error)
  __pyx_tuple__216 = PyTuple_Pack(3, Py_None, Py_None, ((PyObject*)__pyx_n_u_ignore)); if (unlikely(!__pyx_tuple__216)) __PYX_ERR(0, 3889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__216);
  __Pyx_GIVEREF(__pyx_tuple__216);

  /* "gofast/tools/mathex.pyx":3949
 * 
 * 
 * def savgol_coeffs(window_length, polyorder, deriv=0, delta=1.0, pos=None,             # <<<<<<<<<<<<<<
 *                   use="conv"):
 *     """Compute the coefficients for a 1-D Savitzky-Golay FIR filter.
 */
  __pyx_tuple__217 = PyTuple_Pack(14, __pyx_n_s_window_length, __pyx_n_s_polyorder, __pyx_n_s_deriv, __pyx_n_s_delta, __pyx_n_s_pos, __pyx_n_s_use, __pyx_n_s_halflen, __pyx_n_s_rem, __pyx_n_s_coeffs, __pyx_n_s_x, __pyx_n_s_order, __pyx_n_s_A, __pyx_n_s_y, __pyx_n_s__177); if (unlikely(!__pyx_tuple__217)) __PYX_ERR(0, 3949, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__217);
  __Pyx_GIVEREF(__pyx_tuple__217);
  __pyx_codeobj__117 = (PyObject*)__Pyx_PyCode_New(6, 0, 0, 14, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__217, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_savgol_coeffs, 3949, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__117)) __PYX_ERR(0, 3949, __pyx_L1_error)
  __pyx_tuple__218 = PyTuple_Pack(4, ((PyObject *)__pyx_int_0), ((PyObject*)__pyx_float_1_0), Py_None, ((PyObject*)__pyx_n_u_conv)); if (unlikely(!__pyx_tuple__218)) __PYX_ERR(0, 3949, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__218);
  __Pyx_GIVEREF(__pyx_tuple__218);

  /* "gofast/tools/mathex.pyx":4078
 * 
 * 
 * def _polyder(p, m):             # <<<<<<<<<<<<<<
 *     """Differentiate polynomials represented with coefficients.
 * 
 */
  __pyx_tuple__219 = PyTuple_Pack(7, __pyx_n_s_p, __pyx_n_s_m, __pyx_n_s_result, __pyx_n_s_n, __pyx_n_s_dp, __pyx_n_s_k, __pyx_n_s_rng); if (unlikely(!__pyx_tuple__219)) __PYX_ERR(0, 4078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__219);
  __Pyx_GIVEREF(__pyx_tuple__219);
  __pyx_codeobj__122 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__219, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_polyder, 4078, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__122)) __PYX_ERR(0, 4078, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4102
 * 
 * 
 * def _fit_edge(x, window_start, window_stop, interp_start, interp_stop,             # <<<<<<<<<<<<<<
 *               axis, polyorder, deriv, delta, y):
 *     """
 */
  __pyx_tuple__220 = PyTuple_Pack(18, __pyx_n_s_x, __pyx_n_s_window_start, __pyx_n_s_window_stop, __pyx_n_s_interp_start, __pyx_n_s_interp_stop, __pyx_n_s_axis, __pyx_n_s_polyorder, __pyx_n_s_deriv, __pyx_n_s_delta, __pyx_n_s_y, __pyx_n_s_x_edge, __pyx_n_s_xx_edge, __pyx_n_s_swapped, __pyx_n_s_poly_coeffs, __pyx_n_s_i, __pyx_n_s_values, __pyx_n_s_shp, __pyx_n_s_y_edge); if (unlikely(!__pyx_tuple__220)) __PYX_ERR(0, 4102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__220);
  __Pyx_GIVEREF(__pyx_tuple__220);
  __pyx_codeobj__126 = (PyObject*)__Pyx_PyCode_New(10, 0, 0, 18, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__220, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_fit_edge, 4102, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__126)) __PYX_ERR(0, 4102, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4145
 *     y_edge[...] = values
 * 
 * def _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y):             # <<<<<<<<<<<<<<
 *     """
 *     Use polynomial interpolation of x at the low and high ends of the axis
 */
  __pyx_tuple__221 = PyTuple_Pack(9, __pyx_n_s_x, __pyx_n_s_window_length, __pyx_n_s_polyorder, __pyx_n_s_deriv, __pyx_n_s_delta, __pyx_n_s_axis, __pyx_n_s_y, __pyx_n_s_halflen, __pyx_n_s_n); if (unlikely(!__pyx_tuple__221)) __PYX_ERR(0, 4145, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__221);
  __Pyx_GIVEREF(__pyx_tuple__221);
  __pyx_codeobj__127 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__221, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_fit_edges_polyfit, 4145, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__127)) __PYX_ERR(0, 4145, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4159
 *               polyorder, deriv, delta, y)
 * 
 * def savgol_filter(x, window_length, polyorder, deriv=0, delta=1.0,             # <<<<<<<<<<<<<<
 *                   axis=-1, mode='interp', cval=0.0):
 *     """ Apply a Savitzky-Golay filter to an array.
 */
  __pyx_tuple__222 = PyTuple_Pack(10, __pyx_n_s_x, __pyx_n_s_window_length, __pyx_n_s_polyorder, __pyx_n_s_deriv, __pyx_n_s_delta, __pyx_n_s_axis, __pyx_n_s_mode, __pyx_n_s_cval, __pyx_n_s_coeffs, __pyx_n_s_y); if (unlikely(!__pyx_tuple__222)) __PYX_ERR(0, 4159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__222);
  __Pyx_GIVEREF(__pyx_tuple__222);
  __pyx_codeobj__128 = (PyObject*)__Pyx_PyCode_New(8, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__222, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_savgol_filter, 4159, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__128)) __PYX_ERR(0, 4159, __pyx_L1_error)
  __pyx_tuple__223 = PyTuple_Pack(5, ((PyObject *)__pyx_int_0), ((PyObject*)__pyx_float_1_0), ((PyObject *)__pyx_int_neg_1), ((PyObject*)__pyx_n_u_interp), ((PyObject*)__pyx_float_0_0)); if (unlikely(!__pyx_tuple__223)) __PYX_ERR(0, 4159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__223);
  __Pyx_GIVEREF(__pyx_tuple__223);

  /* "gofast/tools/mathex.pyx":4287
 *     return y
 * 
 * def compute_errors (             # <<<<<<<<<<<<<<
 *     arr,
 *     error ='std',
 */
  __pyx_tuple__224 = PyTuple_Pack(8, __pyx_n_s_arr, __pyx_n_s_error, __pyx_n_s_axis, __pyx_n_s_return_confidence, __pyx_n_s_err, __pyx_n_s_err_lower, __pyx_n_s_err_upper, __pyx_n_s_N); if (unlikely(!__pyx_tuple__224)) __PYX_ERR(0, 4287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__224);
  __Pyx_GIVEREF(__pyx_tuple__224);
  __pyx_codeobj__131 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__224, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_compute_errors, 4287, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__131)) __PYX_ERR(0, 4287, __pyx_L1_error)
  __pyx_tuple__225 = PyTuple_Pack(3, ((PyObject*)__pyx_n_u_std), ((PyObject *)__pyx_int_0), ((PyObject *)Py_False)); if (unlikely(!__pyx_tuple__225)) __PYX_ERR(0, 4287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__225);
  __Pyx_GIVEREF(__pyx_tuple__225);

  /* "gofast/tools/mathex.pyx":4409
 * 
 * 
 * def quality_control2(             # <<<<<<<<<<<<<<
 *     ar,
 *     tol: float= .5 ,
 */
  __pyx_tuple__226 = PyTuple_Pack(10, __pyx_n_s_ar, __pyx_n_s_tol, __pyx_n_s_return_data, __pyx_n_s_to_log10, __pyx_n_s_return_qco, __pyx_n_s_nan_sum, __pyx_n_s_rr, __pyx_n_s_ck, __pyx_n_s_index, __pyx_n_s_data); if (unlikely(!__pyx_tuple__226)) __PYX_ERR(0, 4409, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__226);
  __Pyx_GIVEREF(__pyx_tuple__226);
  __pyx_codeobj__134 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__226, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_quality_control2, 4409, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__134)) __PYX_ERR(0, 4409, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4518
 * 
 * 
 * def get_distance(             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike , *,
 */
  __pyx_tuple__227 = PyTuple_Pack(6, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_return_mean_dist, __pyx_n_s_is_latlon, __pyx_n_s_kws, __pyx_n_s_d); if (unlikely(!__pyx_tuple__227)) __PYX_ERR(0, 4518, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__227);
  __Pyx_GIVEREF(__pyx_tuple__227);
  __pyx_codeobj__135 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__227, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_get_distance, 4518, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__135)) __PYX_ERR(0, 4518, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4567
 *     return d.mean()  if return_mean_dist else d
 * 
 * def scale_positions (             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike,
 */
  __pyx_tuple__228 = PyTuple_Pack(19, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_is_latlon, __pyx_n_s_step, __pyx_n_s_use_average_dist, __pyx_n_s_utm_zone, __pyx_n_s_shift, __pyx_n_s_view, __pyx_n_s_kws, __pyx_n_s_Location, __pyx_n_s_msg, __pyx_n_s_xs, __pyx_n_s_ys, __pyx_n_s_d, __pyx_n_s_b, __pyx_n_s_xx, __pyx_n_s_yy, __pyx_n_s__177, __pyx_n_s_state); if (unlikely(!__pyx_tuple__228)) __PYX_ERR(0, 4567, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__228);
  __Pyx_GIVEREF(__pyx_tuple__228);
  __pyx_codeobj__136 = (PyObject*)__Pyx_PyCode_New(2, 0, 6, 19, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__228, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_scale_positions, 4567, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__136)) __PYX_ERR(0, 4567, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4685
 *     return xx, yy
 * 
 * def _assert_x_y_positions (x, y , islatlon = False, is_utm=True,  **kws):             # <<<<<<<<<<<<<<
 *     """ Assert the position x and y and return array of x and y  """
 *     from ..site import Location
 */
  __pyx_tuple__229 = PyTuple_Pack(8, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_islatlon, __pyx_n_s_is_utm, __pyx_n_s_kws, __pyx_n_s_Location, __pyx_n_s_ii, __pyx_n_s_ar); if (unlikely(!__pyx_tuple__229)) __PYX_ERR(0, 4685, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__229);
  __Pyx_GIVEREF(__pyx_tuple__229);
  __pyx_codeobj__137 = (PyObject*)__Pyx_PyCode_New(4, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARKEYWORDS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__229, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_assert_x_y_positions, 4685, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__137)) __PYX_ERR(0, 4685, __pyx_L1_error)
  __pyx_tuple__230 = PyTuple_Pack(2, ((PyObject *)Py_False), ((PyObject *)Py_True)); if (unlikely(!__pyx_tuple__230)) __PYX_ERR(0, 4685, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__230);
  __Pyx_GIVEREF(__pyx_tuple__230);

  /* "gofast/tools/mathex.pyx":4703
 *     return x, y
 * 
 * def get_bearing (latlon1, latlon2,  to_deg = True ):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the bearing between two points.
 */
  __pyx_tuple__231 = PyTuple_Pack(8, __pyx_n_s_latlon1, __pyx_n_s_latlon2, __pyx_n_s_to_deg, __pyx_n_s_lat1, __pyx_n_s_lon1, __pyx_n_s_lat2, __pyx_n_s_lon2, __pyx_n_s_b); if (unlikely(!__pyx_tuple__231)) __PYX_ERR(0, 4703, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__231);
  __Pyx_GIVEREF(__pyx_tuple__231);
  __pyx_codeobj__138 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__231, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_get_bearing, 4703, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__138)) __PYX_ERR(0, 4703, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4771
 *     return b
 * 
 * def find_closest( arr, values ):             # <<<<<<<<<<<<<<
 *     """Get the closest value in array  from given values.
 * 
 */
  __pyx_tuple__232 = PyTuple_Pack(5, __pyx_n_s_arr, __pyx_n_s_values, __pyx_n_s_ar, __pyx_n_s_v, __pyx_n_s_v); if (unlikely(!__pyx_tuple__232)) __PYX_ERR(0, 4771, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__232);
  __Pyx_GIVEREF(__pyx_tuple__232);
  __pyx_codeobj__140 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__232, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_find_closest, 4771, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__140)) __PYX_ERR(0, 4771, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4820
 *         )
 * 
 * def gradient_descent(             # <<<<<<<<<<<<<<
 *     z: ArrayLike,
 *     s:ArrayLike,
 */
  __pyx_tuple__233 = PyTuple_Pack(12, __pyx_n_s_z, __pyx_n_s_s, __pyx_n_s_alpha, __pyx_n_s_n_epochs, __pyx_n_s_kind, __pyx_n_s_degree, __pyx_n_s_raise_warn, __pyx_n_s_Z, __pyx_n_s_W, __pyx_n_s_cost_history, __pyx_n_s_ii, __pyx_n_s_F); if (unlikely(!__pyx_tuple__233)) __PYX_ERR(0, 4820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__233);
  __Pyx_GIVEREF(__pyx_tuple__233);
  __pyx_codeobj__141 = (PyObject*)__Pyx_PyCode_New(7, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__233, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_gradient_descent, 4820, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__141)) __PYX_ERR(0, 4820, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4907
 *     return _F,W, cost_history
 * 
 * def _kind_of_model(degree, x, y) :             # <<<<<<<<<<<<<<
 *     """
 *     An isolated part of gradient descent computing.
 */
  __pyx_tuple__234 = PyTuple_Pack(9, __pyx_n_s_degree, __pyx_n_s_x, __pyx_n_s_y, __pyx_n_s_c, __pyx_n_s_deg, __pyx_n_s_w, __pyx_n_s_init_weights, __pyx_n_s_init_weights, __pyx_n_s_i); if (unlikely(!__pyx_tuple__234)) __PYX_ERR(0, 4907, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__234);
  __Pyx_GIVEREF(__pyx_tuple__234);
  __pyx_codeobj__142 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__234, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_kind_of_model, 4907, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__142)) __PYX_ERR(0, 4907, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4947
 *     return x, w  # Return the matrix x and the weights vector w
 * 
 * def adaptive_moving_average(data,  window_size_factor=0.1):             # <<<<<<<<<<<<<<
 *     """ Adaptative moving average as  smoothing technique.
 * 
 */
  __pyx_tuple__235 = PyTuple_Pack(7, __pyx_n_s_data, __pyx_n_s_window_size_factor, __pyx_n_s_result, __pyx_n_s_window_size, __pyx_n_s_i, __pyx_n_s_start, __pyx_n_s_end); if (unlikely(!__pyx_tuple__235)) __PYX_ERR(0, 4947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__235);
  __Pyx_GIVEREF(__pyx_tuple__235);
  __pyx_codeobj__145 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 7, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__235, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_adaptive_moving_average, 4947, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__145)) __PYX_ERR(0, 4947, __pyx_L1_error)
  __pyx_tuple__236 = PyTuple_Pack(1, ((PyObject*)__pyx_float_0_1)); if (unlikely(!__pyx_tuple__236)) __PYX_ERR(0, 4947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__236);
  __Pyx_GIVEREF(__pyx_tuple__236);

  /* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */
  __pyx_tuple__237 = PyTuple_Pack(8, __pyx_n_s_arr, __pyx_n_s_weight_factor, __pyx_n_s_beta, __pyx_n_s_logify, __pyx_n_s_axis, __pyx_n_s_filtering_1d_array, __pyx_n_s_filtering_1d_array, __pyx_n_s_ii); if (unlikely(!__pyx_tuple__237)) __PYX_ERR(0, 4997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__237);
  __Pyx_GIVEREF(__pyx_tuple__237);
  __pyx_codeobj__146 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 8, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__237, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_torres_verdin_filter, 4997, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__146)) __PYX_ERR(0, 4997, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":5101
 *     return arr
 * 
 * def gradient_boosting_regressor(             # <<<<<<<<<<<<<<
 *         X, y, n_estimators=100, learning_rate=0.1, max_depth=1):
 *     """
 */
  __pyx_tuple__238 = PyTuple_Pack(10, __pyx_n_s_X, __pyx_n_s_y, __pyx_n_s_n_estimators, __pyx_n_s_learning_rate, __pyx_n_s_max_depth, __pyx_n_s_DecisionStumpRegressor, __pyx_n_s_F_m, __pyx_n_s_m, __pyx_n_s_residual, __pyx_n_s_stump); if (unlikely(!__pyx_tuple__238)) __PYX_ERR(0, 5101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__238);
  __Pyx_GIVEREF(__pyx_tuple__238);
  __pyx_codeobj__149 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 10, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__238, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_gofast_tools_mathex_pyx, __pyx_n_s_gradient_boosting_regressor, 5101, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__149)) __PYX_ERR(0, 5101, __pyx_L1_error)
  __pyx_tuple__239 = PyTuple_Pack(3, ((PyObject *)__pyx_int_100), ((PyObject*)__pyx_float_0_1), ((PyObject *)__pyx_int_1)); if (unlikely(!__pyx_tuple__239)) __PYX_ERR(0, 5101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_tuple__239);
  __Pyx_GIVEREF(__pyx_tuple__239);
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}
/* #### Code section: init_constants ### */

static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
  __pyx_umethod_PyFloat_Type_astype.type = (PyObject*)&PyFloat_Type;
  __pyx_umethod_PyFloat_Type_astype.method_name = &__pyx_n_s_astype;
  __pyx_umethod_PyUnicode_Type_lower.type = (PyObject*)&PyUnicode_Type;
  __pyx_umethod_PyUnicode_Type_lower.method_name = &__pyx_n_s_lower;
  __pyx_umethod_PyUnicode_Type_title.type = (PyObject*)&PyUnicode_Type;
  __pyx_umethod_PyUnicode_Type_title.method_name = &__pyx_n_s_title;
  if (__Pyx_CreateStringTabAndInitStrings() < 0) __PYX_ERR(0, 1, __pyx_L1_error);
  __pyx_float__5 = PyFloat_FromDouble(.5); if (unlikely(!__pyx_float__5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_ = PyFloat_FromDouble(0.); if (unlikely(!__pyx_float_0_)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1_ = PyFloat_FromDouble(1.); if (unlikely(!__pyx_float_1_)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_0 = PyFloat_FromDouble(0.0); if (unlikely(!__pyx_float_0_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_1 = PyFloat_FromDouble(0.1); if (unlikely(!__pyx_float_0_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_0_5 = PyFloat_FromDouble(0.5); if (unlikely(!__pyx_float_0_5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1_0 = PyFloat_FromDouble(1.0); if (unlikely(!__pyx_float_1_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1e1 = PyFloat_FromDouble(1e1); if (unlikely(!__pyx_float_1e1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_90_ = PyFloat_FromDouble(90.); if (unlikely(!__pyx_float_90_)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1_96 = PyFloat_FromDouble(1.96); if (unlikely(!__pyx_float_1_96)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_100_ = PyFloat_FromDouble(100.); if (unlikely(!__pyx_float_100_)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_180_ = PyFloat_FromDouble(180.); if (unlikely(!__pyx_float_180_)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_2 = PyFloat_FromDouble(1e-2); if (unlikely(!__pyx_float_1eneg_2)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_5 = PyFloat_FromDouble(1e-5); if (unlikely(!__pyx_float_1eneg_5)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_7 = PyFloat_FromDouble(1e-7); if (unlikely(!__pyx_float_1eneg_7)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_10 = PyFloat_FromDouble(1e-10); if (unlikely(!__pyx_float_1eneg_10)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_float_1eneg_15 = PyFloat_FromDouble(1e-15); if (unlikely(!__pyx_float_1eneg_15)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_2 = PyInt_FromLong(2); if (unlikely(!__pyx_int_2)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_3 = PyInt_FromLong(3); if (unlikely(!__pyx_int_3)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_4 = PyInt_FromLong(4); if (unlikely(!__pyx_int_4)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_10 = PyInt_FromLong(10); if (unlikely(!__pyx_int_10)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_25 = PyInt_FromLong(25); if (unlikely(!__pyx_int_25)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_75 = PyInt_FromLong(75); if (unlikely(!__pyx_int_75)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_90 = PyInt_FromLong(90); if (unlikely(!__pyx_int_90)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_100 = PyInt_FromLong(100); if (unlikely(!__pyx_int_100)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_180 = PyInt_FromLong(180); if (unlikely(!__pyx_int_180)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_360 = PyInt_FromLong(360); if (unlikely(!__pyx_int_360)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_int_neg_1 = PyInt_FromLong(-1); if (unlikely(!__pyx_int_neg_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  return 0;
  __pyx_L1_error:;
  return -1;
}
/* #### Code section: init_globals ### */

static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
  return 0;
}
/* #### Code section: init_module ### */

static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_variable_export_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_function_export_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_type_init_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_type_import_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
static CYTHON_SMALL_CODE int __Pyx_modinit_function_import_code(void); /*proto*/

static int __Pyx_modinit_global_init_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_global_init_code", 0);
  /*--- Global init code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_variable_export_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_variable_export_code", 0);
  /*--- Variable export code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_function_export_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_function_export_code", 0);
  /*--- Function export code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_type_init_code(void) {
  __Pyx_RefNannyDeclarations
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
  /*--- Type init code ---*/
  #if CYTHON_USE_TYPE_SPECS
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr_spec, NULL); if (unlikely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr)) __PYX_ERR(0, 1962, __pyx_L1_error)
  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr_spec, __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr) < 0) __PYX_ERR(0, 1962, __pyx_L1_error)
  #else
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr = &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct__genexpr;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  #endif
  #if !CYTHON_USE_TYPE_SPECS
  if (__Pyx_PyType_Ready(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr) < 0) __PYX_ERR(0, 1962, __pyx_L1_error)
  #endif
  #if PY_MAJOR_VERSION < 3
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr->tp_print = 0;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr->tp_dictoffset && __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr->tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct__genexpr->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  #endif
  #if CYTHON_USE_TYPE_SPECS
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth_spec, NULL); if (unlikely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth)) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth_spec, __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  #else
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth = &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  #endif
  #if !CYTHON_USE_TYPE_SPECS
  if (__Pyx_PyType_Ready(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  #endif
  #if PY_MAJOR_VERSION < 3
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth->tp_print = 0;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth->tp_dictoffset && __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth->tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_1_get_azimuth->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  #endif
  #if CYTHON_USE_TYPE_SPECS
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model_spec, NULL); if (unlikely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model)) __PYX_ERR(0, 4907, __pyx_L1_error)
  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model_spec, __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model) < 0) __PYX_ERR(0, 4907, __pyx_L1_error)
  #else
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model = &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  #endif
  #if !CYTHON_USE_TYPE_SPECS
  if (__Pyx_PyType_Ready(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model) < 0) __PYX_ERR(0, 4907, __pyx_L1_error)
  #endif
  #if PY_MAJOR_VERSION < 3
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model->tp_print = 0;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model->tp_dictoffset && __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model->tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_2__kind_of_model->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  #endif
  #if CYTHON_USE_TYPE_SPECS
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter = (PyTypeObject *) __Pyx_PyType_FromModuleAndSpec(__pyx_m, &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter_spec, NULL); if (unlikely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter)) __PYX_ERR(0, 4997, __pyx_L1_error)
  if (__Pyx_fix_up_extension_type_from_spec(&__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter_spec, __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  #else
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter = &__pyx_type_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  #endif
  #if !CYTHON_USE_TYPE_SPECS
  if (__Pyx_PyType_Ready(__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  #endif
  #if PY_MAJOR_VERSION < 3
  __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter->tp_print = 0;
  #endif
  #if !CYTHON_COMPILING_IN_LIMITED_API
  if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter->tp_dictoffset && __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter->tp_getattro == PyObject_GenericGetAttr)) {
    __pyx_ptype_6gofast_5tools_6mathex___pyx_scope_struct_3_torres_verdin_filter->tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
  }
  #endif
  __Pyx_RefNannyFinishContext();
  return 0;
  __pyx_L1_error:;
  __Pyx_RefNannyFinishContext();
  return -1;
}

static int __Pyx_modinit_type_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
  /*--- Type import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_variable_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_variable_import_code", 0);
  /*--- Variable import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}

static int __Pyx_modinit_function_import_code(void) {
  __Pyx_RefNannyDeclarations
  __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
  /*--- Function import code ---*/
  __Pyx_RefNannyFinishContext();
  return 0;
}


#if PY_MAJOR_VERSION >= 3
#if CYTHON_PEP489_MULTI_PHASE_INIT
static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
static int __pyx_pymod_exec_mathex(PyObject* module); /*proto*/
static PyModuleDef_Slot __pyx_moduledef_slots[] = {
  {Py_mod_create, (void*)__pyx_pymod_create},
  {Py_mod_exec, (void*)__pyx_pymod_exec_mathex},
  {0, NULL}
};
#endif

#ifdef __cplusplus
namespace {
  struct PyModuleDef __pyx_moduledef =
  #else
  static struct PyModuleDef __pyx_moduledef =
  #endif
  {
      PyModuleDef_HEAD_INIT,
      "mathex",
      __pyx_k_Utilities_to_process_and_comput, /* m_doc */
    #if CYTHON_PEP489_MULTI_PHASE_INIT
      0, /* m_size */
    #elif CYTHON_USE_MODULE_STATE
      sizeof(__pyx_mstate), /* m_size */
    #else
      -1, /* m_size */
    #endif
      __pyx_methods /* m_methods */,
    #if CYTHON_PEP489_MULTI_PHASE_INIT
      __pyx_moduledef_slots, /* m_slots */
    #else
      NULL, /* m_reload */
    #endif
    #if CYTHON_USE_MODULE_STATE
      __pyx_m_traverse, /* m_traverse */
      __pyx_m_clear, /* m_clear */
      NULL /* m_free */
    #else
      NULL, /* m_traverse */
      NULL, /* m_clear */
      NULL /* m_free */
    #endif
  };
  #ifdef __cplusplus
} /* anonymous namespace */
#endif
#endif

#ifndef CYTHON_NO_PYINIT_EXPORT
#define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
#elif PY_MAJOR_VERSION < 3
#ifdef __cplusplus
#define __Pyx_PyMODINIT_FUNC extern "C" void
#else
#define __Pyx_PyMODINIT_FUNC void
#endif
#else
#ifdef __cplusplus
#define __Pyx_PyMODINIT_FUNC extern "C" PyObject *
#else
#define __Pyx_PyMODINIT_FUNC PyObject *
#endif
#endif


#if PY_MAJOR_VERSION < 3
__Pyx_PyMODINIT_FUNC initmathex(void) CYTHON_SMALL_CODE; /*proto*/
__Pyx_PyMODINIT_FUNC initmathex(void)
#else
__Pyx_PyMODINIT_FUNC PyInit_mathex(void) CYTHON_SMALL_CODE; /*proto*/
__Pyx_PyMODINIT_FUNC PyInit_mathex(void)
#if CYTHON_PEP489_MULTI_PHASE_INIT
{
  return PyModuleDef_Init(&__pyx_moduledef);
}
static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
    #if PY_VERSION_HEX >= 0x030700A1
    static PY_INT64_T main_interpreter_id = -1;
    PY_INT64_T current_id = PyInterpreterState_GetID(PyThreadState_Get()->interp);
    if (main_interpreter_id == -1) {
        main_interpreter_id = current_id;
        return (unlikely(current_id == -1)) ? -1 : 0;
    } else if (unlikely(main_interpreter_id != current_id))
    #else
    static PyInterpreterState *main_interpreter = NULL;
    PyInterpreterState *current_interpreter = PyThreadState_Get()->interp;
    if (!main_interpreter) {
        main_interpreter = current_interpreter;
    } else if (unlikely(main_interpreter != current_interpreter))
    #endif
    {
        PyErr_SetString(
            PyExc_ImportError,
            "Interpreter change detected - this module can only be loaded into one interpreter per process.");
        return -1;
    }
    return 0;
}
#if CYTHON_COMPILING_IN_LIMITED_API
static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *module, const char* from_name, const char* to_name, int allow_none)
#else
static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none)
#endif
{
    PyObject *value = PyObject_GetAttrString(spec, from_name);
    int result = 0;
    if (likely(value)) {
        if (allow_none || value != Py_None) {
#if CYTHON_COMPILING_IN_LIMITED_API
            result = PyModule_AddObject(module, to_name, value);
#else
            result = PyDict_SetItemString(moddict, to_name, value);
#endif
        }
        Py_DECREF(value);
    } else if (PyErr_ExceptionMatches(PyExc_AttributeError)) {
        PyErr_Clear();
    } else {
        result = -1;
    }
    return result;
}
static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def) {
    PyObject *module = NULL, *moddict, *modname;
    CYTHON_UNUSED_VAR(def);
    if (__Pyx_check_single_interpreter())
        return NULL;
    if (__pyx_m)
        return __Pyx_NewRef(__pyx_m);
    modname = PyObject_GetAttrString(spec, "name");
    if (unlikely(!modname)) goto bad;
    module = PyModule_NewObject(modname);
    Py_DECREF(modname);
    if (unlikely(!module)) goto bad;
#if CYTHON_COMPILING_IN_LIMITED_API
    moddict = module;
#else
    moddict = PyModule_GetDict(module);
    if (unlikely(!moddict)) goto bad;
#endif
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "loader", "__loader__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "origin", "__file__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "parent", "__package__", 1) < 0)) goto bad;
    if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "submodule_search_locations", "__path__", 0) < 0)) goto bad;
    return module;
bad:
    Py_XDECREF(module);
    return NULL;
}


static CYTHON_SMALL_CODE int __pyx_pymod_exec_mathex(PyObject *__pyx_pyinit_module)
#endif
#endif
{
  int stringtab_initialized = 0;
  #if CYTHON_USE_MODULE_STATE
  int pystate_addmodule_run = 0;
  #endif
  __Pyx_TraceDeclarations
  PyObject *__pyx_t_1 = NULL;
  PyObject *__pyx_t_2 = NULL;
  PyObject *__pyx_t_3 = NULL;
  PyObject *__pyx_t_4 = NULL;
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;
  __Pyx_RefNannyDeclarations
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  if (__pyx_m) {
    if (__pyx_m == __pyx_pyinit_module) return 0;
    PyErr_SetString(PyExc_RuntimeError, "Module 'mathex' has already been imported. Re-initialisation is not supported.");
    return -1;
  }
  #elif PY_MAJOR_VERSION >= 3
  if (__pyx_m) return __Pyx_NewRef(__pyx_m);
  #endif
  /*--- Module creation code ---*/
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  __pyx_m = __pyx_pyinit_module;
  Py_INCREF(__pyx_m);
  #else
  #if PY_MAJOR_VERSION < 3
  __pyx_m = Py_InitModule4("mathex", __pyx_methods, __pyx_k_Utilities_to_process_and_comput, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
  #elif CYTHON_USE_MODULE_STATE
  __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
  {
    int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
    __pyx_t_1 = 0; /* transfer ownership from __pyx_t_1 to "mathex" pseudovariable */
    if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
    pystate_addmodule_run = 1;
  }
  #else
  __pyx_m = PyModule_Create(&__pyx_moduledef);
  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #endif
  CYTHON_UNUSED_VAR(__pyx_t_1);
  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
  Py_INCREF(__pyx_d);
  __pyx_b = __Pyx_PyImport_AddModuleRef(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_cython_runtime = __Pyx_PyImport_AddModuleRef((const char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #if CYTHON_REFNANNY
__Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
if (!__Pyx_RefNanny) {
  PyErr_Clear();
  __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
  if (!__Pyx_RefNanny)
      Py_FatalError("failed to import 'refnanny' module");
}
#endif
  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_mathex(void)", 0);
  if (__Pyx_check_binary_version(__PYX_LIMITED_VERSION_HEX, __Pyx_get_runtime_version(), CYTHON_COMPILING_IN_LIMITED_API) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pxy_PyFrame_Initialize_Offsets
  __Pxy_PyFrame_Initialize_Offsets();
  #endif
  __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
  __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
  #ifdef __Pyx_CyFunction_USED
  if (__pyx_CyFunction_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_FusedFunction_USED
  if (__pyx_FusedFunction_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Coroutine_USED
  if (__pyx_Coroutine_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_Generator_USED
  if (__pyx_Generator_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_AsyncGen_USED
  if (__pyx_AsyncGen_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  #ifdef __Pyx_StopAsyncIteration_USED
  if (__pyx_StopAsyncIteration_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  /*--- Library function declarations ---*/
  /*--- Threads initialization code ---*/
  #if defined(WITH_THREAD) && PY_VERSION_HEX < 0x030700F0 && defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
  PyEval_InitThreads();
  #endif
  /*--- Initialize various global constants etc. ---*/
  if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  stringtab_initialized = 1;
  if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
  if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  if (__pyx_module_is_main_gofast__tools__mathex) {
    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  }
  #if PY_MAJOR_VERSION >= 3
  {
    PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
    if (!PyDict_GetItemString(modules, "gofast.tools.mathex")) {
      if (unlikely((PyDict_SetItemString(modules, "gofast.tools.mathex", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
    }
  }
  #endif
  /*--- Builtin init code ---*/
  if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Constants init code ---*/
  if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  /*--- Global type/function init code ---*/
  (void)__Pyx_modinit_global_init_code();
  (void)__Pyx_modinit_variable_export_code();
  (void)__Pyx_modinit_function_export_code();
  if (unlikely((__Pyx_modinit_type_init_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
  (void)__Pyx_modinit_type_import_code();
  (void)__Pyx_modinit_variable_import_code();
  (void)__Pyx_modinit_function_import_code();
  /*--- Execution code ---*/
  #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
  if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  #endif
  __Pyx_TraceCall("__Pyx_PyMODINIT_FUNC PyInit_mathex(void)", __pyx_f[0], 1, 0, __PYX_ERR(0, 1, __pyx_L1_error));

  /* "gofast/tools/mathex.pyx":7
 * Utilities to process and compute parameters. Module for Algebra calculus.
 * """
 * import copy             # <<<<<<<<<<<<<<
 * import inspect
 * import warnings
 */
  __Pyx_TraceLine(7,0,__PYX_ERR(0, 7, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_copy, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 7, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_copy, __pyx_t_2) < 0) __PYX_ERR(0, 7, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":8
 * """
 * import copy
 * import inspect             # <<<<<<<<<<<<<<
 * import warnings
 * import itertools
 */
  __Pyx_TraceLine(8,0,__PYX_ERR(0, 8, __pyx_L1_error))
  __pyx_t_2 = __Pyx_patch_inspect(__Pyx_ImportDottedModule(__pyx_n_s_inspect, NULL)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 8, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_inspect, __pyx_t_2) < 0) __PYX_ERR(0, 8, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":9
 * import copy
 * import inspect
 * import warnings             # <<<<<<<<<<<<<<
 * import itertools
 * import numpy as np
 */
  __Pyx_TraceLine(9,0,__PYX_ERR(0, 9, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_warnings, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 9, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_warnings, __pyx_t_2) < 0) __PYX_ERR(0, 9, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":10
 * import inspect
 * import warnings
 * import itertools             # <<<<<<<<<<<<<<
 * import numpy as np
 * import pandas as pd
 */
  __Pyx_TraceLine(10,0,__PYX_ERR(0, 10, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_itertools, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_itertools, __pyx_t_2) < 0) __PYX_ERR(0, 10, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":11
 * import warnings
 * import itertools
 * import numpy as np             # <<<<<<<<<<<<<<
 * import pandas as pd
 * import matplotlib.pyplot as plt
 */
  __Pyx_TraceLine(11,0,__PYX_ERR(0, 11, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_numpy, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 11, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_2) < 0) __PYX_ERR(0, 11, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":12
 * import itertools
 * import numpy as np
 * import pandas as pd             # <<<<<<<<<<<<<<
 * import matplotlib.pyplot as plt
 * 
 */
  __Pyx_TraceLine(12,0,__PYX_ERR(0, 12, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_pandas, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 12, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pd, __pyx_t_2) < 0) __PYX_ERR(0, 12, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":13
 * import numpy as np
 * import pandas as pd
 * import matplotlib.pyplot as plt             # <<<<<<<<<<<<<<
 * 
 * import scipy.stats as spstats
 */
  __Pyx_TraceLine(13,0,__PYX_ERR(0, 13, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_matplotlib_pyplot, __pyx_tuple__150); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 13, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_plt, __pyx_t_2) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":15
 * import matplotlib.pyplot as plt
 * 
 * import scipy.stats as spstats             # <<<<<<<<<<<<<<
 * from scipy._lib._util import float_factorial
 * from scipy.cluster.hierarchy import linkage
 */
  __Pyx_TraceLine(15,0,__PYX_ERR(0, 15, __pyx_L1_error))
  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_scipy_stats, __pyx_tuple__151); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 15, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_spstats, __pyx_t_2) < 0) __PYX_ERR(0, 15, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":16
 * 
 * import scipy.stats as spstats
 * from scipy._lib._util import float_factorial             # <<<<<<<<<<<<<<
 * from scipy.cluster.hierarchy import linkage
 * from scipy.linalg import lstsq
 */
  __Pyx_TraceLine(16,0,__PYX_ERR(0, 16, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_float_factorial);
  __Pyx_GIVEREF(__pyx_n_s_float_factorial);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_float_factorial)) __PYX_ERR(0, 16, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_scipy__lib__util, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 16, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_float_factorial); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 16, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_float_factorial, __pyx_t_2) < 0) __PYX_ERR(0, 16, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":17
 * import scipy.stats as spstats
 * from scipy._lib._util import float_factorial
 * from scipy.cluster.hierarchy import linkage             # <<<<<<<<<<<<<<
 * from scipy.linalg import lstsq
 * from scipy.ndimage import convolve1d
 */
  __Pyx_TraceLine(17,0,__PYX_ERR(0, 17, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_linkage);
  __Pyx_GIVEREF(__pyx_n_s_linkage);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_linkage)) __PYX_ERR(0, 17, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_scipy_cluster_hierarchy, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_linkage); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 17, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_linkage, __pyx_t_3) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":18
 * from scipy._lib._util import float_factorial
 * from scipy.cluster.hierarchy import linkage
 * from scipy.linalg import lstsq             # <<<<<<<<<<<<<<
 * from scipy.ndimage import convolve1d
 * from scipy.stats import rankdata
 */
  __Pyx_TraceLine(18,0,__PYX_ERR(0, 18, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_lstsq);
  __Pyx_GIVEREF(__pyx_n_s_lstsq);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_lstsq)) __PYX_ERR(0, 18, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_scipy_linalg, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 18, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_lstsq); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_lstsq, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":19
 * from scipy.cluster.hierarchy import linkage
 * from scipy.linalg import lstsq
 * from scipy.ndimage import convolve1d             # <<<<<<<<<<<<<<
 * from scipy.stats import rankdata
 * from scipy.signal import argrelextrema
 */
  __Pyx_TraceLine(19,0,__PYX_ERR(0, 19, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_convolve1d);
  __Pyx_GIVEREF(__pyx_n_s_convolve1d);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_convolve1d)) __PYX_ERR(0, 19, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_scipy_ndimage, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 19, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_convolve1d); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 19, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_convolve1d, __pyx_t_3) < 0) __PYX_ERR(0, 19, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":20
 * from scipy.linalg import lstsq
 * from scipy.ndimage import convolve1d
 * from scipy.stats import rankdata             # <<<<<<<<<<<<<<
 * from scipy.signal import argrelextrema
 * from scipy.optimize import curve_fit
 */
  __Pyx_TraceLine(20,0,__PYX_ERR(0, 20, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 20, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_rankdata);
  __Pyx_GIVEREF(__pyx_n_s_rankdata);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_rankdata)) __PYX_ERR(0, 20, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_scipy_stats, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 20, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_rankdata); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 20, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_rankdata, __pyx_t_2) < 0) __PYX_ERR(0, 20, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":21
 * from scipy.ndimage import convolve1d
 * from scipy.stats import rankdata
 * from scipy.signal import argrelextrema             # <<<<<<<<<<<<<<
 * from scipy.optimize import curve_fit
 * from scipy.spatial.distance import pdist, squareform
 */
  __Pyx_TraceLine(21,0,__PYX_ERR(0, 21, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 21, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_argrelextrema);
  __Pyx_GIVEREF(__pyx_n_s_argrelextrema);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_argrelextrema)) __PYX_ERR(0, 21, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_scipy_signal, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 21, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_argrelextrema); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 21, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_argrelextrema, __pyx_t_3) < 0) __PYX_ERR(0, 21, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":22
 * from scipy.stats import rankdata
 * from scipy.signal import argrelextrema
 * from scipy.optimize import curve_fit             # <<<<<<<<<<<<<<
 * from scipy.spatial.distance import pdist, squareform
 * from scipy.stats import pearsonr, spearmanr, kendalltau
 */
  __Pyx_TraceLine(22,0,__PYX_ERR(0, 22, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_curve_fit);
  __Pyx_GIVEREF(__pyx_n_s_curve_fit);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_curve_fit)) __PYX_ERR(0, 22, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_scipy_optimize, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 22, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_curve_fit); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 22, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_curve_fit, __pyx_t_2) < 0) __PYX_ERR(0, 22, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":23
 * from scipy.signal import argrelextrema
 * from scipy.optimize import curve_fit
 * from scipy.spatial.distance import pdist, squareform             # <<<<<<<<<<<<<<
 * from scipy.stats import pearsonr, spearmanr, kendalltau
 * 
 */
  __Pyx_TraceLine(23,0,__PYX_ERR(0, 23, __pyx_L1_error))
  __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_pdist);
  __Pyx_GIVEREF(__pyx_n_s_pdist);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_pdist)) __PYX_ERR(0, 23, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_squareform);
  __Pyx_GIVEREF(__pyx_n_s_squareform);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_squareform)) __PYX_ERR(0, 23, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_scipy_spatial_distance, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_pdist); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pdist, __pyx_t_3) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_squareform); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 23, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_squareform, __pyx_t_3) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":24
 * from scipy.optimize import curve_fit
 * from scipy.spatial.distance import pdist, squareform
 * from scipy.stats import pearsonr, spearmanr, kendalltau             # <<<<<<<<<<<<<<
 * 
 * from sklearn.metrics import confusion_matrix, roc_curve, roc_auc_score
 */
  __Pyx_TraceLine(24,0,__PYX_ERR(0, 24, __pyx_L1_error))
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_pearsonr);
  __Pyx_GIVEREF(__pyx_n_s_pearsonr);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_pearsonr)) __PYX_ERR(0, 24, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_spearmanr);
  __Pyx_GIVEREF(__pyx_n_s_spearmanr);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_spearmanr)) __PYX_ERR(0, 24, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_kendalltau);
  __Pyx_GIVEREF(__pyx_n_s_kendalltau);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_s_kendalltau)) __PYX_ERR(0, 24, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_scipy_stats, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_pearsonr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pearsonr, __pyx_t_2) < 0) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_spearmanr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_spearmanr, __pyx_t_2) < 0) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_kendalltau); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_kendalltau, __pyx_t_2) < 0) __PYX_ERR(0, 24, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":26
 * from scipy.stats import pearsonr, spearmanr, kendalltau
 * 
 * from sklearn.metrics import confusion_matrix, roc_curve, roc_auc_score             # <<<<<<<<<<<<<<
 * from sklearn.utils.multiclass import unique_labels
 * from sklearn.preprocessing import label_binarize, LabelEncoder
 */
  __Pyx_TraceLine(26,0,__PYX_ERR(0, 26, __pyx_L1_error))
  __pyx_t_3 = PyList_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_confusion_matrix);
  __Pyx_GIVEREF(__pyx_n_s_confusion_matrix);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_confusion_matrix)) __PYX_ERR(0, 26, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_roc_curve);
  __Pyx_GIVEREF(__pyx_n_s_roc_curve);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_roc_curve)) __PYX_ERR(0, 26, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_roc_auc_score);
  __Pyx_GIVEREF(__pyx_n_s_roc_auc_score);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 2, __pyx_n_s_roc_auc_score)) __PYX_ERR(0, 26, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_sklearn_metrics, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_confusion_matrix); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_confusion_matrix, __pyx_t_3) < 0) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_roc_curve); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roc_curve, __pyx_t_3) < 0) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_roc_auc_score); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_roc_auc_score, __pyx_t_3) < 0) __PYX_ERR(0, 26, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":27
 * 
 * from sklearn.metrics import confusion_matrix, roc_curve, roc_auc_score
 * from sklearn.utils.multiclass import unique_labels             # <<<<<<<<<<<<<<
 * from sklearn.preprocessing import label_binarize, LabelEncoder
 * 
 */
  __Pyx_TraceLine(27,0,__PYX_ERR(0, 27, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 27, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_unique_labels);
  __Pyx_GIVEREF(__pyx_n_s_unique_labels);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_unique_labels)) __PYX_ERR(0, 27, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_sklearn_utils_multiclass, __pyx_t_2, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 27, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_unique_labels); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 27, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_unique_labels, __pyx_t_2) < 0) __PYX_ERR(0, 27, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":28
 * from sklearn.metrics import confusion_matrix, roc_curve, roc_auc_score
 * from sklearn.utils.multiclass import unique_labels
 * from sklearn.preprocessing import label_binarize, LabelEncoder             # <<<<<<<<<<<<<<
 * 
 * from .._gofastlog import gofastlog
 */
  __Pyx_TraceLine(28,0,__PYX_ERR(0, 28, __pyx_L1_error))
  __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_label_binarize);
  __Pyx_GIVEREF(__pyx_n_s_label_binarize);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_label_binarize)) __PYX_ERR(0, 28, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_LabelEncoder);
  __Pyx_GIVEREF(__pyx_n_s_LabelEncoder);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_LabelEncoder)) __PYX_ERR(0, 28, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_sklearn_preprocessing, __pyx_t_3, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 28, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_label_binarize); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_label_binarize, __pyx_t_3) < 0) __PYX_ERR(0, 28, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_LabelEncoder); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_LabelEncoder, __pyx_t_3) < 0) __PYX_ERR(0, 28, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":30
 * from sklearn.preprocessing import label_binarize, LabelEncoder
 * 
 * from .._gofastlog import gofastlog             # <<<<<<<<<<<<<<
 * from ..api.box import KeyBox
 * from ..api.docstring import refglossary
 */
  __Pyx_TraceLine(30,0,__PYX_ERR(0, 30, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_gofastlog_2);
  __Pyx_GIVEREF(__pyx_n_s_gofastlog_2);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_gofastlog_2)) __PYX_ERR(0, 30, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_gofastlog, __pyx_t_2, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 30, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_gofastlog_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 30, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gofastlog_2, __pyx_t_2) < 0) __PYX_ERR(0, 30, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":31
 * 
 * from .._gofastlog import gofastlog
 * from ..api.box import KeyBox             # <<<<<<<<<<<<<<
 * from ..api.docstring import refglossary
 * from ..api.types import _T, _F,_SP, List, Tuple, Union
 */
  __Pyx_TraceLine(31,0,__PYX_ERR(0, 31, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 31, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_KeyBox);
  __Pyx_GIVEREF(__pyx_n_s_KeyBox);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_KeyBox)) __PYX_ERR(0, 31, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_api_box, __pyx_t_3, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 31, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_KeyBox); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 31, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_KeyBox, __pyx_t_3) < 0) __PYX_ERR(0, 31, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":32
 * from .._gofastlog import gofastlog
 * from ..api.box import KeyBox
 * from ..api.docstring import refglossary             # <<<<<<<<<<<<<<
 * from ..api.types import _T, _F,_SP, List, Tuple, Union
 * from ..api.types import ArrayLike, NDArray, Optional
 */
  __Pyx_TraceLine(32,0,__PYX_ERR(0, 32, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 32, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_refglossary);
  __Pyx_GIVEREF(__pyx_n_s_refglossary);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_refglossary)) __PYX_ERR(0, 32, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_api_docstring, __pyx_t_2, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 32, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_refglossary); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 32, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_refglossary, __pyx_t_2) < 0) __PYX_ERR(0, 32, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":33
 * from ..api.box import KeyBox
 * from ..api.docstring import refglossary
 * from ..api.types import _T, _F,_SP, List, Tuple, Union             # <<<<<<<<<<<<<<
 * from ..api.types import ArrayLike, NDArray, Optional
 * from ..api.types import Series, DataFrame,  Dict
 */
  __Pyx_TraceLine(33,0,__PYX_ERR(0, 33, __pyx_L1_error))
  __pyx_t_3 = PyList_New(6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_T);
  __Pyx_GIVEREF(__pyx_n_s_T);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_T)) __PYX_ERR(0, 33, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_F);
  __Pyx_GIVEREF(__pyx_n_s_F);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_F)) __PYX_ERR(0, 33, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_SP);
  __Pyx_GIVEREF(__pyx_n_s_SP);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 2, __pyx_n_s_SP)) __PYX_ERR(0, 33, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_List);
  __Pyx_GIVEREF(__pyx_n_s_List);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 3, __pyx_n_s_List)) __PYX_ERR(0, 33, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_Tuple);
  __Pyx_GIVEREF(__pyx_n_s_Tuple);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 4, __pyx_n_s_Tuple)) __PYX_ERR(0, 33, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_Union);
  __Pyx_GIVEREF(__pyx_n_s_Union);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 5, __pyx_n_s_Union)) __PYX_ERR(0, 33, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_api_types, __pyx_t_3, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_T); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_T, __pyx_t_3) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_F); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_F, __pyx_t_3) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_SP); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SP, __pyx_t_3) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_List); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_List, __pyx_t_3) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Tuple); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Tuple, __pyx_t_3) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Union); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Union, __pyx_t_3) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":34
 * from ..api.docstring import refglossary
 * from ..api.types import _T, _F,_SP, List, Tuple, Union
 * from ..api.types import ArrayLike, NDArray, Optional             # <<<<<<<<<<<<<<
 * from ..api.types import Series, DataFrame,  Dict
 * from ..api.summary import ResultSummary
 */
  __Pyx_TraceLine(34,0,__PYX_ERR(0, 34, __pyx_L1_error))
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_ArrayLike);
  __Pyx_GIVEREF(__pyx_n_s_ArrayLike);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_ArrayLike)) __PYX_ERR(0, 34, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_NDArray);
  __Pyx_GIVEREF(__pyx_n_s_NDArray);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_NDArray)) __PYX_ERR(0, 34, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_Optional);
  __Pyx_GIVEREF(__pyx_n_s_Optional);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_s_Optional)) __PYX_ERR(0, 34, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_api_types, __pyx_t_2, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_ArrayLike); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ArrayLike, __pyx_t_2) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_NDArray); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_NDArray, __pyx_t_2) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_Optional); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Optional, __pyx_t_2) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":35
 * from ..api.types import _T, _F,_SP, List, Tuple, Union
 * from ..api.types import ArrayLike, NDArray, Optional
 * from ..api.types import Series, DataFrame,  Dict             # <<<<<<<<<<<<<<
 * from ..api.summary import ResultSummary
 * from ..decorators import AppendDocReferences
 */
  __Pyx_TraceLine(35,0,__PYX_ERR(0, 35, __pyx_L1_error))
  __pyx_t_3 = PyList_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_Series);
  __Pyx_GIVEREF(__pyx_n_s_Series);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_Series)) __PYX_ERR(0, 35, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_DataFrame);
  __Pyx_GIVEREF(__pyx_n_s_DataFrame);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_DataFrame)) __PYX_ERR(0, 35, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_Dict);
  __Pyx_GIVEREF(__pyx_n_s_Dict);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 2, __pyx_n_s_Dict)) __PYX_ERR(0, 35, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_api_types, __pyx_t_3, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Series); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Series, __pyx_t_3) < 0) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_DataFrame); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DataFrame, __pyx_t_3) < 0) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_Dict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_Dict, __pyx_t_3) < 0) __PYX_ERR(0, 35, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":36
 * from ..api.types import ArrayLike, NDArray, Optional
 * from ..api.types import Series, DataFrame,  Dict
 * from ..api.summary import ResultSummary             # <<<<<<<<<<<<<<
 * from ..decorators import AppendDocReferences
 * from ..exceptions import SiteError
 */
  __Pyx_TraceLine(36,0,__PYX_ERR(0, 36, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 36, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_ResultSummary);
  __Pyx_GIVEREF(__pyx_n_s_ResultSummary);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_ResultSummary)) __PYX_ERR(0, 36, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_api_summary, __pyx_t_2, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 36, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_ResultSummary); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 36, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ResultSummary, __pyx_t_2) < 0) __PYX_ERR(0, 36, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":37
 * from ..api.types import Series, DataFrame,  Dict
 * from ..api.summary import ResultSummary
 * from ..decorators import AppendDocReferences             # <<<<<<<<<<<<<<
 * from ..exceptions import SiteError
 * 
 */
  __Pyx_TraceLine(37,0,__PYX_ERR(0, 37, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 37, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_AppendDocReferences);
  __Pyx_GIVEREF(__pyx_n_s_AppendDocReferences);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_AppendDocReferences)) __PYX_ERR(0, 37, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_decorators, __pyx_t_3, 2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 37, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_AppendDocReferences); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 37, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_AppendDocReferences, __pyx_t_3) < 0) __PYX_ERR(0, 37, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":38
 * from ..api.summary import ResultSummary
 * from ..decorators import AppendDocReferences
 * from ..exceptions import SiteError             # <<<<<<<<<<<<<<
 * 
 * from ._arraytools import axis_slice
 */
  __Pyx_TraceLine(38,0,__PYX_ERR(0, 38, __pyx_L1_error))
  __pyx_t_2 = PyList_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 38, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_SiteError);
  __Pyx_GIVEREF(__pyx_n_s_SiteError);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_SiteError)) __PYX_ERR(0, 38, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_exceptions, __pyx_t_2, 2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 38, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_SiteError); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 38, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SiteError, __pyx_t_2) < 0) __PYX_ERR(0, 38, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":40
 * from ..exceptions import SiteError
 * 
 * from ._arraytools import axis_slice             # <<<<<<<<<<<<<<
 * from .coreutils import _assert_all_types, _validate_name_in
 * from .coreutils import concat_array_from_list
 */
  __Pyx_TraceLine(40,0,__PYX_ERR(0, 40, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 40, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_axis_slice);
  __Pyx_GIVEREF(__pyx_n_s_axis_slice);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_axis_slice)) __PYX_ERR(0, 40, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_arraytools, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 40, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_axis_slice); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 40, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_axis_slice, __pyx_t_3) < 0) __PYX_ERR(0, 40, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":41
 * 
 * from ._arraytools import axis_slice
 * from .coreutils import _assert_all_types, _validate_name_in             # <<<<<<<<<<<<<<
 * from .coreutils import concat_array_from_list
 * from .coreutils import find_close_position, normalize_string
 */
  __Pyx_TraceLine(41,0,__PYX_ERR(0, 41, __pyx_L1_error))
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_assert_all_types);
  __Pyx_GIVEREF(__pyx_n_s_assert_all_types);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_assert_all_types)) __PYX_ERR(0, 41, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_validate_name_in);
  __Pyx_GIVEREF(__pyx_n_s_validate_name_in);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_validate_name_in)) __PYX_ERR(0, 41, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_coreutils, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 41, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_assert_all_types); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_assert_all_types, __pyx_t_2) < 0) __PYX_ERR(0, 41, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_validate_name_in); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 41, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_validate_name_in, __pyx_t_2) < 0) __PYX_ERR(0, 41, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":42
 * from ._arraytools import axis_slice
 * from .coreutils import _assert_all_types, _validate_name_in
 * from .coreutils import concat_array_from_list             # <<<<<<<<<<<<<<
 * from .coreutils import find_close_position, normalize_string
 * from .coreutils import to_numeric_dtypes, ellipsis2false
 */
  __Pyx_TraceLine(42,0,__PYX_ERR(0, 42, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_concat_array_from_list);
  __Pyx_GIVEREF(__pyx_n_s_concat_array_from_list);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_concat_array_from_list)) __PYX_ERR(0, 42, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_coreutils, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 42, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_concat_array_from_list); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_concat_array_from_list, __pyx_t_3) < 0) __PYX_ERR(0, 42, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":43
 * from .coreutils import _assert_all_types, _validate_name_in
 * from .coreutils import concat_array_from_list
 * from .coreutils import find_close_position, normalize_string             # <<<<<<<<<<<<<<
 * from .coreutils import to_numeric_dtypes, ellipsis2false
 * from .coreutils import smart_format, type_of_target, is_iterable
 */
  __Pyx_TraceLine(43,0,__PYX_ERR(0, 43, __pyx_L1_error))
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_find_close_position);
  __Pyx_GIVEREF(__pyx_n_s_find_close_position);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_find_close_position)) __PYX_ERR(0, 43, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_normalize_string);
  __Pyx_GIVEREF(__pyx_n_s_normalize_string);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_normalize_string)) __PYX_ERR(0, 43, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_coreutils, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_find_close_position); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_close_position, __pyx_t_2) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_normalize_string); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 43, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_normalize_string, __pyx_t_2) < 0) __PYX_ERR(0, 43, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":44
 * from .coreutils import concat_array_from_list
 * from .coreutils import find_close_position, normalize_string
 * from .coreutils import to_numeric_dtypes, ellipsis2false             # <<<<<<<<<<<<<<
 * from .coreutils import smart_format, type_of_target, is_iterable
 * from .coreutils import reshape, assert_ratio
 */
  __Pyx_TraceLine(44,0,__PYX_ERR(0, 44, __pyx_L1_error))
  __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 44, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_to_numeric_dtypes);
  __Pyx_GIVEREF(__pyx_n_s_to_numeric_dtypes);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_to_numeric_dtypes)) __PYX_ERR(0, 44, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_ellipsis2false);
  __Pyx_GIVEREF(__pyx_n_s_ellipsis2false);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_ellipsis2false)) __PYX_ERR(0, 44, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_coreutils, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 44, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_to_numeric_dtypes); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 44, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_to_numeric_dtypes, __pyx_t_3) < 0) __PYX_ERR(0, 44, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_ellipsis2false); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 44, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ellipsis2false, __pyx_t_3) < 0) __PYX_ERR(0, 44, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":45
 * from .coreutils import find_close_position, normalize_string
 * from .coreutils import to_numeric_dtypes, ellipsis2false
 * from .coreutils import smart_format, type_of_target, is_iterable             # <<<<<<<<<<<<<<
 * from .coreutils import reshape, assert_ratio
 * from .validator import _is_arraylike_1d, _is_numeric_dtype, validate_multioutput
 */
  __Pyx_TraceLine(45,0,__PYX_ERR(0, 45, __pyx_L1_error))
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_smart_format);
  __Pyx_GIVEREF(__pyx_n_s_smart_format);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_smart_format)) __PYX_ERR(0, 45, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_type_of_target);
  __Pyx_GIVEREF(__pyx_n_s_type_of_target);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_type_of_target)) __PYX_ERR(0, 45, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_is_iterable);
  __Pyx_GIVEREF(__pyx_n_s_is_iterable);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_s_is_iterable)) __PYX_ERR(0, 45, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_coreutils, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_smart_format); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_smart_format, __pyx_t_2) < 0) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_type_of_target); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_type_of_target, __pyx_t_2) < 0) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_is_iterable); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_iterable, __pyx_t_2) < 0) __PYX_ERR(0, 45, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":46
 * from .coreutils import to_numeric_dtypes, ellipsis2false
 * from .coreutils import smart_format, type_of_target, is_iterable
 * from .coreutils import reshape, assert_ratio             # <<<<<<<<<<<<<<
 * from .validator import _is_arraylike_1d, _is_numeric_dtype, validate_multioutput
 * from .validator import check_consistent_length
 */
  __Pyx_TraceLine(46,0,__PYX_ERR(0, 46, __pyx_L1_error))
  __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_reshape);
  __Pyx_GIVEREF(__pyx_n_s_reshape);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_reshape)) __PYX_ERR(0, 46, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_assert_ratio);
  __Pyx_GIVEREF(__pyx_n_s_assert_ratio);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_assert_ratio)) __PYX_ERR(0, 46, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_coreutils, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 46, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_reshape); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_reshape, __pyx_t_3) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_assert_ratio); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 46, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_assert_ratio, __pyx_t_3) < 0) __PYX_ERR(0, 46, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":47
 * from .coreutils import smart_format, type_of_target, is_iterable
 * from .coreutils import reshape, assert_ratio
 * from .validator import _is_arraylike_1d, _is_numeric_dtype, validate_multioutput             # <<<<<<<<<<<<<<
 * from .validator import check_consistent_length
 * from .validator import check_classification_targets, check_y
 */
  __Pyx_TraceLine(47,0,__PYX_ERR(0, 47, __pyx_L1_error))
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_is_arraylike_1d);
  __Pyx_GIVEREF(__pyx_n_s_is_arraylike_1d);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_is_arraylike_1d)) __PYX_ERR(0, 47, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_is_numeric_dtype);
  __Pyx_GIVEREF(__pyx_n_s_is_numeric_dtype);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_is_numeric_dtype)) __PYX_ERR(0, 47, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_validate_multioutput);
  __Pyx_GIVEREF(__pyx_n_s_validate_multioutput);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_s_validate_multioutput)) __PYX_ERR(0, 47, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_is_arraylike_1d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_arraylike_1d, __pyx_t_2) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_is_numeric_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_numeric_dtype, __pyx_t_2) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_validate_multioutput); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_validate_multioutput, __pyx_t_2) < 0) __PYX_ERR(0, 47, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":48
 * from .coreutils import reshape, assert_ratio
 * from .validator import _is_arraylike_1d, _is_numeric_dtype, validate_multioutput
 * from .validator import check_consistent_length             # <<<<<<<<<<<<<<
 * from .validator import check_classification_targets, check_y
 * from .validator import assert_xy_in, _ensure_y_is_valid, ensure_non_negative
 */
  __Pyx_TraceLine(48,0,__PYX_ERR(0, 48, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_check_consistent_length);
  __Pyx_GIVEREF(__pyx_n_s_check_consistent_length);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_check_consistent_length)) __PYX_ERR(0, 48, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_check_consistent_length); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_check_consistent_length, __pyx_t_3) < 0) __PYX_ERR(0, 48, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":49
 * from .validator import _is_arraylike_1d, _is_numeric_dtype, validate_multioutput
 * from .validator import check_consistent_length
 * from .validator import check_classification_targets, check_y             # <<<<<<<<<<<<<<
 * from .validator import assert_xy_in, _ensure_y_is_valid, ensure_non_negative
 * from .validator import check_epsilon, parameter_validator, is_binary_class
 */
  __Pyx_TraceLine(49,0,__PYX_ERR(0, 49, __pyx_L1_error))
  __pyx_t_2 = PyList_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_check_classification_targets);
  __Pyx_GIVEREF(__pyx_n_s_check_classification_targets);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_check_classification_targets)) __PYX_ERR(0, 49, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_check_y);
  __Pyx_GIVEREF(__pyx_n_s_check_y);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_check_y)) __PYX_ERR(0, 49, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_check_classification_targets); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_check_classification_targets, __pyx_t_2) < 0) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_check_y); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_check_y, __pyx_t_2) < 0) __PYX_ERR(0, 49, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":50
 * from .validator import check_consistent_length
 * from .validator import check_classification_targets, check_y
 * from .validator import assert_xy_in, _ensure_y_is_valid, ensure_non_negative             # <<<<<<<<<<<<<<
 * from .validator import check_epsilon, parameter_validator, is_binary_class
 * from .validator import validate_sample_weights, validate_multiclass_target
 */
  __Pyx_TraceLine(50,0,__PYX_ERR(0, 50, __pyx_L1_error))
  __pyx_t_3 = PyList_New(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_assert_xy_in);
  __Pyx_GIVEREF(__pyx_n_s_assert_xy_in);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_assert_xy_in)) __PYX_ERR(0, 50, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_ensure_y_is_valid);
  __Pyx_GIVEREF(__pyx_n_s_ensure_y_is_valid);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_ensure_y_is_valid)) __PYX_ERR(0, 50, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_ensure_non_negative);
  __Pyx_GIVEREF(__pyx_n_s_ensure_non_negative);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 2, __pyx_n_s_ensure_non_negative)) __PYX_ERR(0, 50, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_assert_xy_in); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_assert_xy_in, __pyx_t_3) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_ensure_y_is_valid); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ensure_y_is_valid, __pyx_t_3) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_ensure_non_negative); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ensure_non_negative, __pyx_t_3) < 0) __PYX_ERR(0, 50, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":51
 * from .validator import check_classification_targets, check_y
 * from .validator import assert_xy_in, _ensure_y_is_valid, ensure_non_negative
 * from .validator import check_epsilon, parameter_validator, is_binary_class             # <<<<<<<<<<<<<<
 * from .validator import validate_sample_weights, validate_multiclass_target
 * from .validator import validate_length_range, validate_scores, ensure_2d
 */
  __Pyx_TraceLine(51,0,__PYX_ERR(0, 51, __pyx_L1_error))
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_check_epsilon);
  __Pyx_GIVEREF(__pyx_n_s_check_epsilon);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_check_epsilon)) __PYX_ERR(0, 51, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_parameter_validator);
  __Pyx_GIVEREF(__pyx_n_s_parameter_validator);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_parameter_validator)) __PYX_ERR(0, 51, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_is_binary_class);
  __Pyx_GIVEREF(__pyx_n_s_is_binary_class);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_s_is_binary_class)) __PYX_ERR(0, 51, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_check_epsilon); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_check_epsilon, __pyx_t_2) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_parameter_validator); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_parameter_validator, __pyx_t_2) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_is_binary_class); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_binary_class, __pyx_t_2) < 0) __PYX_ERR(0, 51, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":52
 * from .validator import assert_xy_in, _ensure_y_is_valid, ensure_non_negative
 * from .validator import check_epsilon, parameter_validator, is_binary_class
 * from .validator import validate_sample_weights, validate_multiclass_target             # <<<<<<<<<<<<<<
 * from .validator import validate_length_range, validate_scores, ensure_2d
 * from .validator import is_frame
 */
  __Pyx_TraceLine(52,0,__PYX_ERR(0, 52, __pyx_L1_error))
  __pyx_t_3 = PyList_New(2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_validate_sample_weights);
  __Pyx_GIVEREF(__pyx_n_s_validate_sample_weights);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_validate_sample_weights)) __PYX_ERR(0, 52, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_validate_multiclass_target);
  __Pyx_GIVEREF(__pyx_n_s_validate_multiclass_target);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 1, __pyx_n_s_validate_multiclass_target)) __PYX_ERR(0, 52, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_validate_sample_weights); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_validate_sample_weights, __pyx_t_3) < 0) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_validate_multiclass_target); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_validate_multiclass_target, __pyx_t_3) < 0) __PYX_ERR(0, 52, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":53
 * from .validator import check_epsilon, parameter_validator, is_binary_class
 * from .validator import validate_sample_weights, validate_multiclass_target
 * from .validator import validate_length_range, validate_scores, ensure_2d             # <<<<<<<<<<<<<<
 * from .validator import is_frame
 * 
 */
  __Pyx_TraceLine(53,0,__PYX_ERR(0, 53, __pyx_L1_error))
  __pyx_t_2 = PyList_New(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_s_validate_length_range);
  __Pyx_GIVEREF(__pyx_n_s_validate_length_range);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_s_validate_length_range)) __PYX_ERR(0, 53, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_validate_scores);
  __Pyx_GIVEREF(__pyx_n_s_validate_scores);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_s_validate_scores)) __PYX_ERR(0, 53, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_s_ensure_2d);
  __Pyx_GIVEREF(__pyx_n_s_ensure_2d);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_s_ensure_2d)) __PYX_ERR(0, 53, __pyx_L1_error);
  __pyx_t_3 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_2, 1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_validate_length_range); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_validate_length_range, __pyx_t_2) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_validate_scores); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_validate_scores, __pyx_t_2) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_ImportFrom(__pyx_t_3, __pyx_n_s_ensure_2d); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_ensure_2d, __pyx_t_2) < 0) __PYX_ERR(0, 53, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":54
 * from .validator import validate_sample_weights, validate_multiclass_target
 * from .validator import validate_length_range, validate_scores, ensure_2d
 * from .validator import is_frame             # <<<<<<<<<<<<<<
 * 
 * _logger =gofastlog.get_gofast_logger(__name__)
 */
  __Pyx_TraceLine(54,0,__PYX_ERR(0, 54, __pyx_L1_error))
  __pyx_t_3 = PyList_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 54, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_INCREF(__pyx_n_s_is_frame);
  __Pyx_GIVEREF(__pyx_n_s_is_frame);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_3, 0, __pyx_n_s_is_frame)) __PYX_ERR(0, 54, __pyx_L1_error);
  __pyx_t_2 = __Pyx_Import(__pyx_n_s_validator, __pyx_t_3, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 54, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_ImportFrom(__pyx_t_2, __pyx_n_s_is_frame); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 54, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_is_frame, __pyx_t_3) < 0) __PYX_ERR(0, 54, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":56
 * from .validator import is_frame
 * 
 * _logger =gofastlog.get_gofast_logger(__name__)             # <<<<<<<<<<<<<<
 * 
 * mu0 = 4 * np.pi * 1e-7
 */
  __Pyx_TraceLine(56,0,__PYX_ERR(0, 56, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_gofastlog_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_get_gofast_logger); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 56, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 56, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_logger, __pyx_t_4) < 0) __PYX_ERR(0, 56, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":58
 * _logger =gofastlog.get_gofast_logger(__name__)
 * 
 * mu0 = 4 * np.pi * 1e-7             # <<<<<<<<<<<<<<
 * 
 * __all__=[
 */
  __Pyx_TraceLine(58,0,__PYX_ERR(0, 58, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_np); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_pi); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyInt_MultiplyCObj(__pyx_int_4, __pyx_t_2, 4, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = PyNumber_Multiply(__pyx_t_4, __pyx_float_1eneg_7); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_mu0, __pyx_t_2) < 0) __PYX_ERR(0, 58, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":60
 * mu0 = 4 * np.pi * 1e-7
 * 
 * __all__=[             # <<<<<<<<<<<<<<
 *     'adaptive_moving_average',
 *     'adjust_for_control_vars',
 */
  __Pyx_TraceLine(60,0,__PYX_ERR(0, 60, __pyx_L1_error))
  __pyx_t_2 = PyList_New(34); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 60, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_INCREF(__pyx_n_u_adaptive_moving_average);
  __Pyx_GIVEREF(__pyx_n_u_adaptive_moving_average);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 0, __pyx_n_u_adaptive_moving_average)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_adjust_for_control_vars);
  __Pyx_GIVEREF(__pyx_n_u_adjust_for_control_vars);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 1, __pyx_n_u_adjust_for_control_vars)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_calculate_adjusted_lr);
  __Pyx_GIVEREF(__pyx_n_u_calculate_adjusted_lr);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 2, __pyx_n_u_calculate_adjusted_lr)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_calculate_binary_iv);
  __Pyx_GIVEREF(__pyx_n_u_calculate_binary_iv);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 3, __pyx_n_u_calculate_binary_iv)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_calculate_optimal_bins);
  __Pyx_GIVEREF(__pyx_n_u_calculate_optimal_bins);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 4, __pyx_n_u_calculate_optimal_bins)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_calculate_residuals);
  __Pyx_GIVEREF(__pyx_n_u_calculate_residuals);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 5, __pyx_n_u_calculate_residuals)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_balance_accuracy);
  __Pyx_GIVEREF(__pyx_n_u_compute_balance_accuracy);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 6, __pyx_n_u_compute_balance_accuracy)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_effort_yield);
  __Pyx_GIVEREF(__pyx_n_u_compute_effort_yield);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 7, __pyx_n_u_compute_effort_yield)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_errors);
  __Pyx_GIVEREF(__pyx_n_u_compute_errors);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 8, __pyx_n_u_compute_errors)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_sunburst_data);
  __Pyx_GIVEREF(__pyx_n_u_compute_sunburst_data);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 9, __pyx_n_u_compute_sunburst_data)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_cost_based_threshold);
  __Pyx_GIVEREF(__pyx_n_u_compute_cost_based_threshold);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 10, __pyx_n_u_compute_cost_based_threshold)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_sensitivity_specificity_2);
  __Pyx_GIVEREF(__pyx_n_u_compute_sensitivity_specificity_2);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 11, __pyx_n_u_compute_sensitivity_specificity_2)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_youdens_index);
  __Pyx_GIVEREF(__pyx_n_u_compute_youdens_index);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 12, __pyx_n_u_compute_youdens_index)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_cubic_regression);
  __Pyx_GIVEREF(__pyx_n_u_cubic_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 13, __pyx_n_u_cubic_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_exponential_regression);
  __Pyx_GIVEREF(__pyx_n_u_exponential_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 14, __pyx_n_u_exponential_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_get_bearing);
  __Pyx_GIVEREF(__pyx_n_u_get_bearing);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 15, __pyx_n_u_get_bearing)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_get_distance);
  __Pyx_GIVEREF(__pyx_n_u_get_distance);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 16, __pyx_n_u_get_distance)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_infer_sankey_columns);
  __Pyx_GIVEREF(__pyx_n_u_infer_sankey_columns);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 17, __pyx_n_u_infer_sankey_columns)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_label_importance);
  __Pyx_GIVEREF(__pyx_n_u_label_importance);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 18, __pyx_n_u_label_importance)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_linear_regression);
  __Pyx_GIVEREF(__pyx_n_u_linear_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 19, __pyx_n_u_linear_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_linkage_matrix);
  __Pyx_GIVEREF(__pyx_n_u_linkage_matrix);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 20, __pyx_n_u_linkage_matrix)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_logarithmic_regression);
  __Pyx_GIVEREF(__pyx_n_u_logarithmic_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 21, __pyx_n_u_logarithmic_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_make_mxs);
  __Pyx_GIVEREF(__pyx_n_u_make_mxs);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 22, __pyx_n_u_make_mxs)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_minmax_scaler);
  __Pyx_GIVEREF(__pyx_n_u_minmax_scaler);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 23, __pyx_n_u_minmax_scaler)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_normalize);
  __Pyx_GIVEREF(__pyx_n_u_normalize);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 24, __pyx_n_u_normalize)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_optimized_spearmanr);
  __Pyx_GIVEREF(__pyx_n_u_optimized_spearmanr);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 25, __pyx_n_u_optimized_spearmanr)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_quadratic_regression);
  __Pyx_GIVEREF(__pyx_n_u_quadratic_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 26, __pyx_n_u_quadratic_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_rank_data);
  __Pyx_GIVEREF(__pyx_n_u_rank_data);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 27, __pyx_n_u_rank_data)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_savgol_filter);
  __Pyx_GIVEREF(__pyx_n_u_savgol_filter);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 28, __pyx_n_u_savgol_filter)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_sinusoidal_regression);
  __Pyx_GIVEREF(__pyx_n_u_sinusoidal_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 29, __pyx_n_u_sinusoidal_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_standard_scaler);
  __Pyx_GIVEREF(__pyx_n_u_standard_scaler);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 30, __pyx_n_u_standard_scaler)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_step_regression);
  __Pyx_GIVEREF(__pyx_n_u_step_regression);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 31, __pyx_n_u_step_regression)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_weighted_spearman_rank);
  __Pyx_GIVEREF(__pyx_n_u_weighted_spearman_rank);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 32, __pyx_n_u_weighted_spearman_rank)) __PYX_ERR(0, 60, __pyx_L1_error);
  __Pyx_INCREF(__pyx_n_u_compute_p_values);
  __Pyx_GIVEREF(__pyx_n_u_compute_p_values);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_2, 33, __pyx_n_u_compute_p_values)) __PYX_ERR(0, 60, __pyx_L1_error);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_all_2, __pyx_t_2) < 0) __PYX_ERR(0, 60, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":100
 *     data, depvar,
 *     method: str='pearson',
 *     significance_threshold: float=0.05,             # <<<<<<<<<<<<<<
 *     ignore: Optional [Union [str, list]]=None
 *     ):
 */
  __Pyx_TraceLine(100,0,__PYX_ERR(0, 100, __pyx_L1_error))
  __pyx_t_2 = PyFloat_FromDouble(((double)0.05)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 100, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":97
 *     ]
 * 
 * def compute_p_values(             # <<<<<<<<<<<<<<
 *     data, depvar,
 *     method: str='pearson',
 */
  __Pyx_TraceLine(97,0,__PYX_ERR(0, 97, __pyx_L1_error))
  __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(((PyObject*)__pyx_n_u_pearson));
  __Pyx_GIVEREF(((PyObject*)__pyx_n_u_pearson));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject*)__pyx_n_u_pearson))) __PYX_ERR(0, 97, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_2)) __PYX_ERR(0, 97, __pyx_L1_error);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 2, Py_None)) __PYX_ERR(0, 97, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_method, __pyx_n_s_str) < 0) __PYX_ERR(0, 97, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_significance_threshold, __pyx_n_s_float) < 0) __PYX_ERR(0, 97, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_ignore, __pyx_kp_s_Optional_Union_str_list) < 0) __PYX_ERR(0, 97, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_1compute_p_values, 0, __pyx_n_s_compute_p_values, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj_)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_t_4);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_p_values, __pyx_t_3) < 0) __PYX_ERR(0, 97, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":242
 *     return p_values
 * 
 * def compute_balance_accuracy(             # <<<<<<<<<<<<<<
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 */
  __Pyx_TraceLine(242,0,__PYX_ERR(0, 242, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_epsilon, __pyx_n_s_float) < 0) __PYX_ERR(0, 242, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_zero_division, __pyx_n_s_int) < 0) __PYX_ERR(0, 242, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_strategy, __pyx_n_s_str) < 0) __PYX_ERR(0, 242, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_normalize, __pyx_n_s_bool) < 0) __PYX_ERR(0, 242, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, __pyx_kp_s_Optional_ArrayLike) < 0) __PYX_ERR(0, 242, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_3compute_balance_accuracy, 0, __pyx_n_s_compute_balance_accuracy, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 242, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_2, sizeof(__pyx_defaults), 1)) __PYX_ERR(0, 242, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":245
 *     y_true, y_pred,
 *     epsilon:float=1e-15,
 *     zero_division: int=0,             # <<<<<<<<<<<<<<
 *     strategy: str="ovr",
 *     normalize: bool=False,
 */
  __Pyx_TraceLine(245,0,__PYX_ERR(0, 245, __pyx_L1_error))
  if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_0)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_0))) __PYX_ERR(0, 245, __pyx_L1_error)
  __Pyx_INCREF(__pyx_int_0);
  __Pyx_CyFunction_Defaults(__pyx_defaults, __pyx_t_2)->__pyx_arg_zero_division = ((PyObject*)__pyx_int_0);
  __Pyx_GIVEREF(__pyx_int_0);
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_2, __pyx_pf_6gofast_5tools_6mathex_134__defaults__);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_balance_accuracy, __pyx_t_2) < 0) __PYX_ERR(0, 242, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":344
 *     return scores
 * 
 * def _compute_balanced_accuracy_binary(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, epsilon=1e-15,
 *     zero_division=0, normalize =False,
 */
  __Pyx_TraceLine(344,0,__PYX_ERR(0, 344, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_5_compute_balanced_accuracy_binary, 0, __pyx_n_s_compute_balanced_accuracy_binar, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 344, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__155);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_balanced_accuracy_binar, __pyx_t_2) < 0) __PYX_ERR(0, 344, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":357
 *         sensitivity + specificity) else zero_division
 * 
 * def _balanced_accuracy_ovr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, labels, epsilon=1e-15,
 *     zero_division=0, normalize=False,
 */
  __Pyx_TraceLine(357,0,__PYX_ERR(0, 357, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_7_balanced_accuracy_ovr, 0, __pyx_n_s_balanced_accuracy_ovr, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__14)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 357, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__155);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_balanced_accuracy_ovr, __pyx_t_2) < 0) __PYX_ERR(0, 357, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":372
 *     return np.array(bal_acc_scores)
 * 
 * def _balanced_accuracy_ovo(y_true, y_pred, labels, sample_weight=None):             # <<<<<<<<<<<<<<
 *     le = LabelEncoder()
 *     y_true_encoded = le.fit_transform(y_true)
 */
  __Pyx_TraceLine(372,0,__PYX_ERR(0, 372, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_9_balanced_accuracy_ovo, 0, __pyx_n_s_balanced_accuracy_ovo, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__158);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_balanced_accuracy_ovo, __pyx_t_2) < 0) __PYX_ERR(0, 372, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":388
 *     return np.array(bal_acc_scores)
 * 
 * def compute_cost_based_threshold(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, costs, *,
 *     sample_weight=None
 */
  __Pyx_TraceLine(388,0,__PYX_ERR(0, 388, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 388, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":390
 * def compute_cost_based_threshold(
 *     y_true, y_scores, costs, *,
 *     sample_weight=None             # <<<<<<<<<<<<<<
 *     ):
 *     """
 */
  __Pyx_TraceLine(390,0,__PYX_ERR(0, 390, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, Py_None) < 0) __PYX_ERR(0, 388, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":388
 *     return np.array(bal_acc_scores)
 * 
 * def compute_cost_based_threshold(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, costs, *,
 *     sample_weight=None
 */
  __Pyx_TraceLine(388,0,__PYX_ERR(0, 388, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_11compute_cost_based_threshold, 0, __pyx_n_s_compute_cost_based_threshold, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__17)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 388, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_cost_based_threshold, __pyx_t_3) < 0) __PYX_ERR(0, 388, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":466
 *     return best_threshold, min_cost
 * 
 * def compute_youdens_index(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, *,
 *     sample_weight=None,
 */
  __Pyx_TraceLine(466,0,__PYX_ERR(0, 466, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);

  /* "gofast/tools/mathex.pyx":468
 * def compute_youdens_index(
 *     y_true, y_scores, *,
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     pos_label=None,
 *     drop_intermediate=True
 */
  __Pyx_TraceLine(468,0,__PYX_ERR(0, 468, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, Py_None) < 0) __PYX_ERR(0, 466, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":469
 *     y_true, y_scores, *,
 *     sample_weight=None,
 *     pos_label=None,             # <<<<<<<<<<<<<<
 *     drop_intermediate=True
 *     ):
 */
  __Pyx_TraceLine(469,0,__PYX_ERR(0, 469, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_pos_label, Py_None) < 0) __PYX_ERR(0, 466, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_drop_intermediate, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 466, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":466
 *     return best_threshold, min_cost
 * 
 * def compute_youdens_index(             # <<<<<<<<<<<<<<
 *     y_true, y_scores, *,
 *     sample_weight=None,
 */
  __Pyx_TraceLine(466,0,__PYX_ERR(0, 466, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_13compute_youdens_index, 0, __pyx_n_s_compute_youdens_index, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__18)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 466, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_youdens_index, __pyx_t_2) < 0) __PYX_ERR(0, 466, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":547
 *     return optimal_threshold, optimal_youden
 * 
 * def calculate_multiclass_avg_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     strategy='ovr',
 */
  __Pyx_TraceLine(547,0,__PYX_ERR(0, 547, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_strategy, ((PyObject*)__pyx_n_u_ovr)) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_consensus, ((PyObject*)__pyx_n_u_positive)) < 0) __PYX_ERR(0, 547, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":551
 *     strategy='ovr',
 *     consensus="positive",
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     multi_output='uniform_average',
 *     epsilon=1e-10
 */
  __Pyx_TraceLine(551,0,__PYX_ERR(0, 551, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, Py_None) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_multi_output, ((PyObject*)__pyx_n_u_uniform_average)) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_epsilon, ((PyObject*)__pyx_float_1eneg_10)) < 0) __PYX_ERR(0, 547, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":547
 *     return optimal_threshold, optimal_youden
 * 
 * def calculate_multiclass_avg_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     strategy='ovr',
 */
  __Pyx_TraceLine(547,0,__PYX_ERR(0, 547, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_15calculate_multiclass_avg_lr, 0, __pyx_n_s_calculate_multiclass_avg_lr, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__20)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_multiclass_avg_lr, __pyx_t_3) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":662
 *     return lr, avg_sensitivity, avg_specificity
 * 
 * def calculate_multiclass_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     consensus='positive',
 */
  __Pyx_TraceLine(662,0,__PYX_ERR(0, 662, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 662, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_consensus, ((PyObject*)__pyx_n_u_positive)) < 0) __PYX_ERR(0, 662, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":665
 *     y_true, y_pred, *,
 *     consensus='positive',
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     strategy='ovr',
 *     epsilon=1e-10,
 */
  __Pyx_TraceLine(665,0,__PYX_ERR(0, 665, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, Py_None) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_strategy, ((PyObject*)__pyx_n_u_ovr)) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_epsilon, ((PyObject*)__pyx_float_1eneg_10)) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_multi_output, ((PyObject*)__pyx_n_u_uniform_average)) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_apply_log_scale, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_include_metrics, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 662, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":662
 *     return lr, avg_sensitivity, avg_specificity
 * 
 * def calculate_multiclass_lr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     consensus='positive',
 */
  __Pyx_TraceLine(662,0,__PYX_ERR(0, 662, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_17calculate_multiclass_lr, 0, __pyx_n_s_calculate_multiclass_lr, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__22)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 662, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_multiclass_lr, __pyx_t_2) < 0) __PYX_ERR(0, 662, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":809
 *                 np.asarray(specificities)) if include_metrics else np.array(results)
 * 
 * def calculate_adjusted_lr(             # <<<<<<<<<<<<<<
 *     sensitivity,
 *     specificity,
 */
  __Pyx_TraceLine(809,0,__PYX_ERR(0, 809, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_19calculate_adjusted_lr, 0, __pyx_n_s_calculate_adjusted_lr, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__23)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 809, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__164);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_adjusted_lr, __pyx_t_2) < 0) __PYX_ERR(0, 809, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":920
 *     return lr
 * 
 * def _compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight=None, epsilon=1e-10):
 *     """
 */
  __Pyx_TraceLine(920,0,__PYX_ERR(0, 920, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_21_compute_sensitivity_specificity, 0, __pyx_n_s_compute_sensitivity_specificity, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__25)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 920, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__166);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_sensitivity_specificity, __pyx_t_2) < 0) __PYX_ERR(0, 920, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1001
 *     return sensitivity, specificity
 * 
 * def compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight=None,
 */
  __Pyx_TraceLine(1001,0,__PYX_ERR(0, 1001, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1001, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":1003
 * def compute_sensitivity_specificity(
 *     y_true, y_pred, *,
 *     sample_weight=None,             # <<<<<<<<<<<<<<
 *     strategy='ovr',
 *     average='macro',
 */
  __Pyx_TraceLine(1003,0,__PYX_ERR(0, 1003, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, Py_None) < 0) __PYX_ERR(0, 1001, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_strategy, ((PyObject*)__pyx_n_u_ovr)) < 0) __PYX_ERR(0, 1001, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_average, ((PyObject*)__pyx_n_u_macro)) < 0) __PYX_ERR(0, 1001, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_epsilon, ((PyObject*)__pyx_n_u_auto)) < 0) __PYX_ERR(0, 1001, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1001
 *     return sensitivity, specificity
 * 
 * def compute_sensitivity_specificity(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight=None,
 */
  __Pyx_TraceLine(1001,0,__PYX_ERR(0, 1001, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_23compute_sensitivity_specificity, 0, __pyx_n_s_compute_sensitivity_specificity_2, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__26)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1001, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_sensitivity_specificity_2, __pyx_t_3) < 0) __PYX_ERR(0, 1001, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1140
 *     return sensitivity, specificity
 * 
 * def _compute_ovo_sens_spec(y_true, y_pred, labels, return_array=True):             # <<<<<<<<<<<<<<
 *     """
 *     Compute sensitivity and specificity for each pair of classes
 */
  __Pyx_TraceLine(1140,0,__PYX_ERR(0, 1140, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_25_compute_ovo_sens_spec, 0, __pyx_n_s_compute_ovo_sens_spec, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__28)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1140, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__169);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_ovo_sens_spec, __pyx_t_3) < 0) __PYX_ERR(0, 1140, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1217
 *     return sensitivity, specificity
 * 
 * def calculate_histogram_bins(             # <<<<<<<<<<<<<<
 *         data:ArrayLike,  bins:Union [int, str, list]='auto', range:Tuple[float, float]=None, normalize: bool=False):
 *     """
 */
  __Pyx_TraceLine(1217,0,__PYX_ERR(0, 1217, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_data, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1217, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_bins, __pyx_kp_s_Union_int_str_list) < 0) __PYX_ERR(0, 1217, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_range, __pyx_kp_s_Tuple_float_float) < 0) __PYX_ERR(0, 1217, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_normalize, __pyx_n_s_bool) < 0) __PYX_ERR(0, 1217, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_27calculate_histogram_bins, 0, __pyx_n_s_calculate_histogram_bins, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__29)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1217, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__171);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_histogram_bins, __pyx_t_2) < 0) __PYX_ERR(0, 1217, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1263
 *     return bin_edges
 * 
 * def rank_data(data, method='average'):             # <<<<<<<<<<<<<<
 *     """
 *     Assigns ranks to data, handling ties according to the specified method.
 */
  __Pyx_TraceLine(1263,0,__PYX_ERR(0, 1263, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_29rank_data, 0, __pyx_n_s_rank_data, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__30)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1263, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__27);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_rank_data, __pyx_t_2) < 0) __PYX_ERR(0, 1263, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1351
 *     return ranks
 * 
 * def optimized_spearmanr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,
 */
  __Pyx_TraceLine(1351,0,__PYX_ERR(0, 1351, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":1353
 * def optimized_spearmanr(
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,             # <<<<<<<<<<<<<<
 *     tie_method:str='average',
 *     nan_policy:str='propagate',
 */
  __Pyx_TraceLine(1353,0,__PYX_ERR(0, 1353, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_sample_weight, Py_None) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_tie_method, ((PyObject*)__pyx_n_u_average)) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_nan_policy, ((PyObject*)__pyx_n_u_propagate)) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1356
 *     tie_method:str='average',
 *     nan_policy:str='propagate',
 *     control_vars:Optional[ArrayLike]=None,             # <<<<<<<<<<<<<<
 *     multioutput:str='uniform_average'
 *     ):
 */
  __Pyx_TraceLine(1356,0,__PYX_ERR(0, 1356, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_control_vars, Py_None) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_multioutput, ((PyObject*)__pyx_n_u_uniform_average)) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":1351
 *     return ranks
 * 
 * def optimized_spearmanr(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, *,
 *     sample_weight:Optional[ArrayLike]=None,
 */
  __Pyx_TraceLine(1351,0,__PYX_ERR(0, 1351, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_sample_weight, __pyx_kp_s_Optional_ArrayLike) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_tie_method, __pyx_n_s_str) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_nan_policy, __pyx_n_s_str) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_control_vars, __pyx_kp_s_Optional_ArrayLike) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_multioutput, __pyx_n_s_str) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_31optimized_spearmanr, 0, __pyx_n_s_optimized_spearmanr, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__32)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1351, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_4, __pyx_t_2);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_optimized_spearmanr, __pyx_t_4) < 0) __PYX_ERR(0, 1351, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1441
 *     return np.array(results) if multioutput == 'raw_values' else np.mean(results)
 * 
 * def _compute_spearmanr(             # <<<<<<<<<<<<<<
 *         y_true, y_pred, sample_weight, tie_method, nan_policy, control_vars):
 *     # The key addition is the handling of multioutput by reshaping inputs if
 */
  __Pyx_TraceLine(1441,0,__PYX_ERR(0, 1441, __pyx_L1_error))
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_33_compute_spearmanr, 0, __pyx_n_s_compute_spearmanr, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__33)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1441, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_spearmanr, __pyx_t_4) < 0) __PYX_ERR(0, 1441, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1505
 *     return corr
 * 
 * def adjust_for_control_vars(y_true:ArrayLike, y_pred:ArrayLike, control_vars:Optional[Union[ArrayLike, List[ArrayLike]]]=None):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts y_true and y_pred for either regression or classification tasks by
 */
  __Pyx_TraceLine(1505,0,__PYX_ERR(0, 1505, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1505, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_y_true, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1505, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_y_pred, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1505, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_control_vars, __pyx_kp_s_Optional_Union_ArrayLike_List_Ar) < 0) __PYX_ERR(0, 1505, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_35adjust_for_control_vars, 0, __pyx_n_s_adjust_for_control_vars, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__37)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1505, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__158);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_adjust_for_control_vars, __pyx_t_3) < 0) __PYX_ERR(0, 1505, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1587
 *     return adjusted_y_true, adjusted_y_true
 * 
 * def adjust_for_control_vars_regression(y_true:ArrayLike, y_pred: ArrayLike, control_vars: Union[ArrayLike, List[ArrayLike]]):             # <<<<<<<<<<<<<<
 *     """
 *     Adjust y_true and y_pred for regression tasks by accounting for the influence
 */
  __Pyx_TraceLine(1587,0,__PYX_ERR(0, 1587, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1587, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_true, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1587, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y_pred, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1587, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_control_vars, __pyx_kp_s_Union_ArrayLike_List_ArrayLike) < 0) __PYX_ERR(0, 1587, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_37adjust_for_control_vars_regression, 0, __pyx_n_s_adjust_for_control_vars_regressi, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__38)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1587, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_adjust_for_control_vars_regressi, __pyx_t_4) < 0) __PYX_ERR(0, 1587, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":1683
 *     return residuals_true, residuals_pred
 * 
 * def adjust_for_control_vars_classification(y_true:ArrayLike, y_pred:ArrayLike, control_vars:DataFrame):             # <<<<<<<<<<<<<<
 *     """
 *     Adjusts `y_true` and `y_pred` in a classification task by stratifying the
 */
  __Pyx_TraceLine(1683,0,__PYX_ERR(0, 1683, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_y_true, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1683, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_y_pred, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 1683, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_control_vars, __pyx_n_s_DataFrame) < 0) __PYX_ERR(0, 1683, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_39adjust_for_control_vars_classification, 0, __pyx_n_s_adjust_for_control_vars_classifi, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__42)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_adjust_for_control_vars_classifi, __pyx_t_3) < 0) __PYX_ERR(0, 1683, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1795
 *     return np.array(y_true), adjusted_y_pred
 * 
 * def weighted_spearman_rank(             # <<<<<<<<<<<<<<
 *     y_true, y_pred, sample_weight,
 *     return_weighted_rank=False,
 */
  __Pyx_TraceLine(1795,0,__PYX_ERR(0, 1795, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_41weighted_spearman_rank, 0, __pyx_n_s_weighted_spearman_rank, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__43)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__180);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_weighted_spearman_rank, __pyx_t_3) < 0) __PYX_ERR(0, 1795, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1895
 *     return rho
 * 
 * def calculate_optimal_bins(y_pred, method='freedman_diaconis', data_range=None):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the optimal number of bins for histogramming a given set of
 */
  __Pyx_TraceLine(1895,0,__PYX_ERR(0, 1895, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_43calculate_optimal_bins, 0, __pyx_n_s_calculate_optimal_bins, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__46)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1895, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__182);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_optimal_bins, __pyx_t_3) < 0) __PYX_ERR(0, 1895, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":1993
 *     return max(1, optimal_bins)  # Ensure at least one bin
 * 
 * def calculate_binary_iv(             # <<<<<<<<<<<<<<
 *     y_true,
 *     y_pred,
 */
  __Pyx_TraceLine(1993,0,__PYX_ERR(0, 1993, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_45calculate_binary_iv, 0, __pyx_n_s_calculate_binary_iv, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__49)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__184);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_binary_iv, __pyx_t_3) < 0) __PYX_ERR(0, 1993, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2148
 *         return iv
 * 
 * def determine_epsilon(y_pred, base_epsilon=1e-15, scale_factor=1e-5):             # <<<<<<<<<<<<<<
 *     """
 *     Determine an appropriate epsilon value based on the predictions.
 */
  __Pyx_TraceLine(2148,0,__PYX_ERR(0, 2148, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_47determine_epsilon, 0, __pyx_n_s_determine_epsilon, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__186);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_determine_epsilon, __pyx_t_3) < 0) __PYX_ERR(0, 2148, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2195
 *     return epsilon
 * 
 * def calculate_residuals(             # <<<<<<<<<<<<<<
 *     actual: ArrayLike,
 *     predicted: Union[np.ndarray, List[ArrayLike]],
 */
  __Pyx_TraceLine(2195,0,__PYX_ERR(0, 2195, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2195, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_actual, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 2195, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_predicted, __pyx_kp_s_Union_np_ndarray_List_ArrayLike) < 0) __PYX_ERR(0, 2195, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_task_type, __pyx_n_s_str) < 0) __PYX_ERR(0, 2195, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_predict_proba, __pyx_kp_s_Optional_ArrayLike) < 0) __PYX_ERR(0, 2195, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 2195, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_49calculate_residuals, 0, __pyx_n_s_calculate_residuals, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__54)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2195, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_tuple__188);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_calculate_residuals, __pyx_t_4) < 0) __PYX_ERR(0, 2195, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":2272
 *     return residuals
 * 
 * def infer_sankey_columns(data: DataFrame,             # <<<<<<<<<<<<<<
 *   ) -> Tuple[List[str], List[str], List[int]]:
 *     """
 */
  __Pyx_TraceLine(2272,0,__PYX_ERR(0, 2272, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_data, __pyx_n_s_DataFrame) < 0) __PYX_ERR(0, 2272, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_return, __pyx_kp_s_Tuple_List_str_List_str_List_int) < 0) __PYX_ERR(0, 2272, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_51infer_sankey_columns, 0, __pyx_n_s_infer_sankey_columns, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__59)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2272, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_infer_sankey_columns, __pyx_t_3) < 0) __PYX_ERR(0, 2272, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2348
 *     return sources, targets, values
 * 
 * def compute_sunburst_data(             # <<<<<<<<<<<<<<
 *     data: DataFrame,
 *     hierarchy: Optional[List[str]] = None,
 */
  __Pyx_TraceLine(2348,0,__PYX_ERR(0, 2348, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_data, __pyx_n_s_DataFrame) < 0) __PYX_ERR(0, 2348, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_hierarchy, __pyx_kp_s_Optional_List_str) < 0) __PYX_ERR(0, 2348, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_value_column, __pyx_kp_s_Optional_str) < 0) __PYX_ERR(0, 2348, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return, __pyx_kp_s_List_Dict_str_str) < 0) __PYX_ERR(0, 2348, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_53compute_sunburst_data, 0, __pyx_n_s_compute_sunburst_data, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__64)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2348, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_tuple__191);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_sunburst_data, __pyx_t_4) < 0) __PYX_ERR(0, 2348, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":2440
 *         tuple(x.items()) in seen or seen.add(tuple(x.items())))]
 * 
 * def compute_effort_yield(             # <<<<<<<<<<<<<<
 *         d: ArrayLike,  reverse: bool = True
 *         ) -> Tuple[ArrayLike, np.ndarray]:
 */
  __Pyx_TraceLine(2440,0,__PYX_ERR(0, 2440, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 2440, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_d, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 2440, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_reverse, __pyx_n_s_bool) < 0) __PYX_ERR(0, 2440, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_return, __pyx_kp_s_Tuple_ArrayLike_np_ndarray) < 0) __PYX_ERR(0, 2440, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_55compute_effort_yield, 0, __pyx_n_s_compute_effort_yield, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__66)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2440, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__169);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_effort_yield, __pyx_t_3) < 0) __PYX_ERR(0, 2440, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2514
 *     return effort, yield_
 * 
 * def make_mxs(             # <<<<<<<<<<<<<<
 *     y,
 *     yt,
 */
  __Pyx_TraceLine(2514,0,__PYX_ERR(0, 2514, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_57make_mxs, 0, __pyx_n_s_make_mxs, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__71)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2514, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__194);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_make_mxs, __pyx_t_3) < 0) __PYX_ERR(0, 2514, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2612
 *     return ymxs if return_ymxs else similarities
 * 
 * def label_importance(y, include_nan=False):             # <<<<<<<<<<<<<<
 *     """
 *     Compute the importance of each label in a target array.
 */
  __Pyx_TraceLine(2612,0,__PYX_ERR(0, 2612, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_59label_importance, 0, __pyx_n_s_label_importance, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__74)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2612, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__196);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_label_importance, __pyx_t_3) < 0) __PYX_ERR(0, 2612, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2659
 *     return {label: count / total for label, count in zip(labels, counts)}
 * 
 * def linear_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     linear regression.
 */
  __Pyx_TraceLine(2659,0,__PYX_ERR(0, 2659, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_61linear_regression, 0, __pyx_n_s_linear_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__75)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2659, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_linear_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2659, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2698
 *     return np.dot(X, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def quadratic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Quadratic regression.
 */
  __Pyx_TraceLine(2698,0,__PYX_ERR(0, 2698, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_63quadratic_regression, 0, __pyx_n_s_quadratic_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__76)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2698, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_quadratic_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2698, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2731
 *     return np.dot(X**2, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def cubic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Cubic regression.
 */
  __Pyx_TraceLine(2731,0,__PYX_ERR(0, 2731, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_65cubic_regression, 0, __pyx_n_s_cubic_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__77)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2731, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cubic_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2731, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2764
 *     return np.dot(X**3, coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def exponential_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Exponential regression.
 */
  __Pyx_TraceLine(2764,0,__PYX_ERR(0, 2764, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_67exponential_regression, 0, __pyx_n_s_exponential_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__78)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2764, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_exponential_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2764, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2796
 *     return np.exp(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def logarithmic_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Logarithmic regression.
 */
  __Pyx_TraceLine(2796,0,__PYX_ERR(0, 2796, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_69logarithmic_regression, 0, __pyx_n_s_logarithmic_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__79)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2796, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_logarithmic_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2796, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2829
 *     return np.dot(np.log(X), coef) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def sinusoidal_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Sinusoidal regression.
 */
  __Pyx_TraceLine(2829,0,__PYX_ERR(0, 2829, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_71sinusoidal_regression, 0, __pyx_n_s_sinusoidal_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__80)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_sinusoidal_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2829, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2861
 *     return np.sin(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def step_regression(X, coef, bias=0., noise=0.):             # <<<<<<<<<<<<<<
 *     """
 *     Step regression.
 */
  __Pyx_TraceLine(2861,0,__PYX_ERR(0, 2861, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_73step_regression, 0, __pyx_n_s_step_regression, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__81)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2861, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__198);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_step_regression, __pyx_t_3) < 0) __PYX_ERR(0, 2861, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2896
 *     return step_function(np.dot(X, coef)) + bias + noise * np.random.randn(X.shape[0])
 * 
 * def standard_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales features to have zero mean and unit variance.
 */
  __Pyx_TraceLine(2896,0,__PYX_ERR(0, 2896, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_75standard_scaler, 0, __pyx_n_s_standard_scaler, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__82)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__158);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_standard_scaler, __pyx_t_3) < 0) __PYX_ERR(0, 2896, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2947
 *     return X_scaled
 * 
 * def minmax_scaler(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales each feature to a given range, typically [0, 1].
 */
  __Pyx_TraceLine(2947,0,__PYX_ERR(0, 2947, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_77minmax_scaler, 0, __pyx_n_s_minmax_scaler, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__83)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__158);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_minmax_scaler, __pyx_t_3) < 0) __PYX_ERR(0, 2947, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":2997
 *     return X_scaled
 * 
 * def normalize(X, y=None):             # <<<<<<<<<<<<<<
 *     """
 *     Scales individual samples to have unit norm.
 */
  __Pyx_TraceLine(2997,0,__PYX_ERR(0, 2997, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_79normalize, 0, __pyx_n_s_normalize, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__84)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 2997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__158);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_normalize, __pyx_t_3) < 0) __PYX_ERR(0, 2997, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3046
 * 
 *     return X_normalized
 * def moving_average (             # <<<<<<<<<<<<<<
 *     y:ArrayLike,
 *     *,
 */
  __Pyx_TraceLine(3046,0,__PYX_ERR(0, 3046, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3046, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_y, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_window_size, __pyx_n_s_int) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_method, __pyx_n_s_str) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_mode, __pyx_n_s_str) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_alpha, __pyx_kp_s_Union_int_float) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_81moving_average, 0, __pyx_n_s_moving_average, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__85)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3046, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_4, sizeof(__pyx_defaults1), 1)) __PYX_ERR(0, 3046, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3049
 *     y:ArrayLike,
 *     *,
 *     window_size:int  = 3 ,             # <<<<<<<<<<<<<<
 *     method:str  ='sma',
 *     mode:str  ='same',
 */
  __Pyx_TraceLine(3049,0,__PYX_ERR(0, 3049, __pyx_L1_error))
  if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_3)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_3))) __PYX_ERR(0, 3049, __pyx_L1_error)
  __Pyx_INCREF(__pyx_int_3);
  __Pyx_CyFunction_Defaults(__pyx_defaults1, __pyx_t_4)->__pyx_arg_window_size = ((PyObject*)__pyx_int_3);
  __Pyx_GIVEREF(__pyx_int_3);
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_4, __pyx_pf_6gofast_5tools_6mathex_136__defaults__);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_moving_average, __pyx_t_4) < 0) __PYX_ERR(0, 3046, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":3171
 * 
 * 
 * def count_local_minima(arr,  method='robust', order=1):             # <<<<<<<<<<<<<<
 *     """
 *     Count the number of local minima in a 1D array.
 */
  __Pyx_TraceLine(3171,0,__PYX_ERR(0, 3171, __pyx_L1_error))
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_83count_local_minima, 0, __pyx_n_s_count_local_minima, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__91)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3171, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_tuple__205);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_count_local_minima, __pyx_t_4) < 0) __PYX_ERR(0, 3171, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */
  __Pyx_TraceLine(3229,0,__PYX_ERR(0, 3229, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":3233
 *     ylat:Union[ str, ArrayLike],
 *     *,
 *     data: DataFrame =None,             # <<<<<<<<<<<<<<
 *     utm_zone:str=None,
 *     projection:str='ll',
 */
  __Pyx_TraceLine(3233,0,__PYX_ERR(0, 3233, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_data, Py_None) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3234
 *     *,
 *     data: DataFrame =None,
 *     utm_zone:str=None,             # <<<<<<<<<<<<<<
 *     projection:str='ll',
 *     isdeg:bool=True,
 */
  __Pyx_TraceLine(3234,0,__PYX_ERR(0, 3234, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_utm_zone, Py_None) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_projection, ((PyObject*)__pyx_n_u_ll)) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_isdeg, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_mode, ((PyObject*)__pyx_n_u_soft)) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_extrapolate, ((PyObject *)Py_Ellipsis)) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_view, ((PyObject *)Py_Ellipsis)) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3229
 *         return len(local_minima_indices)
 * 
 * def get_azimuth (             # <<<<<<<<<<<<<<
 *     xlon: Union [str, ArrayLike],
 *     ylat:Union[ str, ArrayLike],
 */
  __Pyx_TraceLine(3229,0,__PYX_ERR(0, 3229, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(9); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_xlon, __pyx_kp_s_Union_str_ArrayLike) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_ylat, __pyx_kp_s_Union_str_ArrayLike) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_data, __pyx_n_s_DataFrame) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_utm_zone, __pyx_n_s_str) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_projection, __pyx_n_s_str) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_isdeg, __pyx_n_s_bool) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_mode, __pyx_n_s_str) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_extrapolate, __pyx_n_s_bool) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_view, __pyx_n_s_bool) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_85get_azimuth, 0, __pyx_n_s_get_azimuth, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__93)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3229, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_2, __pyx_t_4);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_azimuth, __pyx_t_2) < 0) __PYX_ERR(0, 3229, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3395
 *     return azim
 * 
 * def linkage_matrix(             # <<<<<<<<<<<<<<
 *     df: DataFrame ,
 *     columns:List[str] =None,
 */
  __Pyx_TraceLine(3395,0,__PYX_ERR(0, 3395, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_df, __pyx_n_s_DataFrame) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_columns, __pyx_kp_s_List_str) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_kind, __pyx_n_s_str) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_metric, __pyx_n_s_str) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_method, __pyx_n_s_str) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_return, __pyx_n_s_NDArray) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_87linkage_matrix, 0, __pyx_n_s_linkage_matrix, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__97)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3395, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__208);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_linkage_matrix, __pyx_t_3) < 0) __PYX_ERR(0, 3395, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */
  __Pyx_TraceLine(3596,0,__PYX_ERR(0, 3596, __pyx_L1_error))
  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_AppendDocReferences); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_refglossary); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_doc); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":3600
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 *         xdata: Union[ArrayLike, Series] = None,
 *         func: Optional[_F] = None,             # <<<<<<<<<<<<<<
 *         c_order: Optional[Union[int, str]] = 0,
 *         show: bool = False,
 */
  __Pyx_TraceLine(3600,0,__PYX_ERR(0, 3600, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_ydata, __pyx_kp_s_Union_ArrayLike__SP_Series_DataF) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_xdata, __pyx_kp_s_Union_ArrayLike_Series) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_func, __pyx_kp_s_Optional__F) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_c_order, __pyx_kp_s_Optional_Union_int_str) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_show, __pyx_n_s_bool) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":3596
 *     return row_clusters
 * 
 * @AppendDocReferences(refglossary.__doc__)             # <<<<<<<<<<<<<<
 * def scalePosition(
 *         ydata: Union[ArrayLike, _SP, Series, DataFrame],
 */
  __Pyx_TraceLine(3596,0,__PYX_ERR(0, 3596, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_89scalePosition, 0, __pyx_n_s_scalePosition, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__98)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__210);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_scalePosition, __pyx_t_4) < 0) __PYX_ERR(0, 3596, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":3746
 *     return ydata_new, popt, pcov
 * 
 * def detect_station_position (             # <<<<<<<<<<<<<<
 *         s : Union[str, int] ,
 *         p: _SP,
 */
  __Pyx_TraceLine(3746,0,__PYX_ERR(0, 3746, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3746, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_s, __pyx_kp_s_Union_str_int) < 0) __PYX_ERR(0, 3746, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_p, __pyx_n_s_SP) < 0) __PYX_ERR(0, 3746, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_return, __pyx_kp_s_Tuple_int_float) < 0) __PYX_ERR(0, 3746, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_91detect_station_position, 0, __pyx_n_s_detect_station_position, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__103)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3746, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_detect_station_position, __pyx_t_3) < 0) __PYX_ERR(0, 3746, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3826
 *     return int(s_index) , s
 * 
 * def _manage_colors (c, default = ['ok', 'ob-', 'r-']):             # <<<<<<<<<<<<<<
 *     """ Manage the ohmic-area plot colors """
 *     c = c or default
 */
  __Pyx_TraceLine(3826,0,__PYX_ERR(0, 3826, __pyx_L1_error))
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_93_manage_colors, 0, __pyx_n_s_manage_colors, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__108)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_3, sizeof(__pyx_defaults2), 1)) __PYX_ERR(0, 3826, __pyx_L1_error)
  __pyx_t_4 = PyList_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3826, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_INCREF(__pyx_n_u_ok_2);
  __Pyx_GIVEREF(__pyx_n_u_ok_2);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 0, __pyx_n_u_ok_2)) __PYX_ERR(0, 3826, __pyx_L1_error);
  __Pyx_INCREF(__pyx_kp_u_ob);
  __Pyx_GIVEREF(__pyx_kp_u_ob);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 1, __pyx_kp_u_ob)) __PYX_ERR(0, 3826, __pyx_L1_error);
  __Pyx_INCREF(__pyx_kp_u_r);
  __Pyx_GIVEREF(__pyx_kp_u_r);
  if (__Pyx_PyList_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u_r)) __PYX_ERR(0, 3826, __pyx_L1_error);
  __Pyx_CyFunction_Defaults(__pyx_defaults2, __pyx_t_3)->__pyx_arg_default = __pyx_t_4;
  __Pyx_GIVEREF(__pyx_t_4);
  __pyx_t_4 = 0;
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_3, __pyx_pf_6gofast_5tools_6mathex_138__defaults__);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_manage_colors, __pyx_t_3) < 0) __PYX_ERR(0, 3826, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3839
 * def convert_distance_to_m(
 *         value:_T ,
 *         converter:float =1e3,             # <<<<<<<<<<<<<<
 *         unit:str ='km'
 * )-> float:
 */
  __Pyx_TraceLine(3839,0,__PYX_ERR(0, 3839, __pyx_L1_error))
  __pyx_t_3 = PyFloat_FromDouble(((double)1e3)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3839, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);

  /* "gofast/tools/mathex.pyx":3837
 * 
 * 
 * def convert_distance_to_m(             # <<<<<<<<<<<<<<
 *         value:_T ,
 *         converter:float =1e3,
 */
  __Pyx_TraceLine(3837,0,__PYX_ERR(0, 3837, __pyx_L1_error))
  __pyx_t_4 = PyTuple_New(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 3837, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_GIVEREF(__pyx_t_3);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_t_3)) __PYX_ERR(0, 3837, __pyx_L1_error);
  __Pyx_INCREF(((PyObject*)__pyx_n_u_km));
  __Pyx_GIVEREF(((PyObject*)__pyx_n_u_km));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_4, 1, ((PyObject*)__pyx_n_u_km))) __PYX_ERR(0, 3837, __pyx_L1_error);
  __pyx_t_3 = 0;
  __pyx_t_3 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3837, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_value, __pyx_n_s_T) < 0) __PYX_ERR(0, 3837, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_converter, __pyx_n_s_float) < 0) __PYX_ERR(0, 3837, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_unit, __pyx_n_s_str) < 0) __PYX_ERR(0, 3837, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_return, __pyx_n_s_float) < 0) __PYX_ERR(0, 3837, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_95convert_distance_to_m, 0, __pyx_n_s_convert_distance_to_m, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__110)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3837, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_t_4);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_convert_distance_to_m, __pyx_t_2) < 0) __PYX_ERR(0, 3837, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3862
 *     return value
 * 
 * def get_station_number (             # <<<<<<<<<<<<<<
 *         dipole:float,
 *         distance:float ,
 */
  __Pyx_TraceLine(3862,0,__PYX_ERR(0, 3862, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3862, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_dipole, __pyx_n_s_float) < 0) __PYX_ERR(0, 3862, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_distance, __pyx_n_s_float) < 0) __PYX_ERR(0, 3862, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_from0, __pyx_n_s_bool) < 0) __PYX_ERR(0, 3862, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_return, __pyx_n_s_float) < 0) __PYX_ERR(0, 3862, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_97get_station_number, 0, __pyx_n_s_get_station_number, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__112)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3862, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_3, __pyx_tuple__196);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_station_number, __pyx_t_3) < 0) __PYX_ERR(0, 3862, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":3889
 * #FR3: #0A4CEE # (10, 76, 238)
 * 
 * def get_profile_angle (             # <<<<<<<<<<<<<<
 *         easting: float =None, northing: float =None, msg:str ="ignore" ):
 *     """
 */
  __Pyx_TraceLine(3889,0,__PYX_ERR(0, 3889, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 3889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_easting, __pyx_n_s_float) < 0) __PYX_ERR(0, 3889, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_northing, __pyx_n_s_float) < 0) __PYX_ERR(0, 3889, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_msg, __pyx_n_s_str) < 0) __PYX_ERR(0, 3889, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_99get_profile_angle, 0, __pyx_n_s_get_profile_angle, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__113)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3889, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__216);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_3);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_profile_angle, __pyx_t_2) < 0) __PYX_ERR(0, 3889, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":3949
 * 
 * 
 * def savgol_coeffs(window_length, polyorder, deriv=0, delta=1.0, pos=None,             # <<<<<<<<<<<<<<
 *                   use="conv"):
 *     """Compute the coefficients for a 1-D Savitzky-Golay FIR filter.
 */
  __Pyx_TraceLine(3949,0,__PYX_ERR(0, 3949, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_101savgol_coeffs, 0, __pyx_n_s_savgol_coeffs, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__117)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 3949, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__218);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_savgol_coeffs, __pyx_t_2) < 0) __PYX_ERR(0, 3949, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4078
 * 
 * 
 * def _polyder(p, m):             # <<<<<<<<<<<<<<
 *     """Differentiate polynomials represented with coefficients.
 * 
 */
  __Pyx_TraceLine(4078,0,__PYX_ERR(0, 4078, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_103_polyder, 0, __pyx_n_s_polyder, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__122)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4078, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_polyder, __pyx_t_2) < 0) __PYX_ERR(0, 4078, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4102
 * 
 * 
 * def _fit_edge(x, window_start, window_stop, interp_start, interp_stop,             # <<<<<<<<<<<<<<
 *               axis, polyorder, deriv, delta, y):
 *     """
 */
  __Pyx_TraceLine(4102,0,__PYX_ERR(0, 4102, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_105_fit_edge, 0, __pyx_n_s_fit_edge, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__126)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4102, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_fit_edge, __pyx_t_2) < 0) __PYX_ERR(0, 4102, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4145
 *     y_edge[...] = values
 * 
 * def _fit_edges_polyfit(x, window_length, polyorder, deriv, delta, axis, y):             # <<<<<<<<<<<<<<
 *     """
 *     Use polynomial interpolation of x at the low and high ends of the axis
 */
  __Pyx_TraceLine(4145,0,__PYX_ERR(0, 4145, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_107_fit_edges_polyfit, 0, __pyx_n_s_fit_edges_polyfit, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__127)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4145, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_fit_edges_polyfit, __pyx_t_2) < 0) __PYX_ERR(0, 4145, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4159
 *               polyorder, deriv, delta, y)
 * 
 * def savgol_filter(x, window_length, polyorder, deriv=0, delta=1.0,             # <<<<<<<<<<<<<<
 *                   axis=-1, mode='interp', cval=0.0):
 *     """ Apply a Savitzky-Golay filter to an array.
 */
  __Pyx_TraceLine(4159,0,__PYX_ERR(0, 4159, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_109savgol_filter, 0, __pyx_n_s_savgol_filter, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__128)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4159, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__223);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_savgol_filter, __pyx_t_2) < 0) __PYX_ERR(0, 4159, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4287
 *     return y
 * 
 * def compute_errors (             # <<<<<<<<<<<<<<
 *     arr,
 *     error ='std',
 */
  __Pyx_TraceLine(4287,0,__PYX_ERR(0, 4287, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_111compute_errors, 0, __pyx_n_s_compute_errors, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__131)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4287, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__225);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_compute_errors, __pyx_t_2) < 0) __PYX_ERR(0, 4287, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4411
 * def quality_control2(
 *     ar,
 *     tol: float= .5 ,             # <<<<<<<<<<<<<<
 *     return_data=False,
 *     to_log10: bool =False,
 */
  __Pyx_TraceLine(4411,0,__PYX_ERR(0, 4411, __pyx_L1_error))
  __pyx_t_2 = PyFloat_FromDouble(((double).5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4411, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":4409
 * 
 * 
 * def quality_control2(             # <<<<<<<<<<<<<<
 *     ar,
 *     tol: float= .5 ,
 */
  __Pyx_TraceLine(4409,0,__PYX_ERR(0, 4409, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4409, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 4409, __pyx_L1_error);
  __Pyx_INCREF(((PyObject *)Py_False));
  __Pyx_GIVEREF(((PyObject *)Py_False));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, ((PyObject *)Py_False))) __PYX_ERR(0, 4409, __pyx_L1_error);
  __Pyx_INCREF(((PyObject *)Py_False));
  __Pyx_GIVEREF(((PyObject *)Py_False));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 2, ((PyObject *)Py_False))) __PYX_ERR(0, 4409, __pyx_L1_error);
  __Pyx_INCREF(((PyObject *)Py_False));
  __Pyx_GIVEREF(((PyObject *)Py_False));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 3, ((PyObject *)Py_False))) __PYX_ERR(0, 4409, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_2 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4409, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_tol, __pyx_n_s_float) < 0) __PYX_ERR(0, 4409, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_to_log10, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4409, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_return_qco, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4409, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_return, __pyx_kp_s_Tuple_float_ArrayLike) < 0) __PYX_ERR(0, 4409, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_113quality_control2, 0, __pyx_n_s_quality_control2, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__134)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4409, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_t_3);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_quality_control2, __pyx_t_4) < 0) __PYX_ERR(0, 4409, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4518
 * 
 * 
 * def get_distance(             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike , *,
 */
  __Pyx_TraceLine(4518,0,__PYX_ERR(0, 4518, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4518, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_return_mean_dist, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 4518, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_is_latlon, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 4518, __pyx_L1_error)
  __pyx_t_2 = __Pyx_PyDict_NewPresized(3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4518, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_x, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 4518, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_y, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 4518, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_return_mean_dist, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4518, __pyx_L1_error)
  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_115get_distance, 0, __pyx_n_s_get_distance, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__135)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4518, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_3, __pyx_t_4);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_3, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_distance, __pyx_t_3) < 0) __PYX_ERR(0, 4518, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;

  /* "gofast/tools/mathex.pyx":4567
 *     return d.mean()  if return_mean_dist else d
 * 
 * def scale_positions (             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike,
 */
  __Pyx_TraceLine(4567,0,__PYX_ERR(0, 4567, __pyx_L1_error))
  __pyx_t_3 = __Pyx_PyDict_NewPresized(6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4567, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_is_latlon, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4572
 *     *,
 *     is_latlon:bool=False,
 *     step:float= None,             # <<<<<<<<<<<<<<
 *     use_average_dist:bool=False,
 *     utm_zone:str= None,
 */
  __Pyx_TraceLine(4572,0,__PYX_ERR(0, 4572, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_step, Py_None) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_use_average_dist, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4574
 *     step:float= None,
 *     use_average_dist:bool=False,
 *     utm_zone:str= None,             # <<<<<<<<<<<<<<
 *     shift: bool=True,
 *     view:bool = False,
 */
  __Pyx_TraceLine(4574,0,__PYX_ERR(0, 4574, __pyx_L1_error))
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_utm_zone, Py_None) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_shift, ((PyObject *)Py_True)) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_3, __pyx_n_s_view, ((PyObject *)Py_False)) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4567
 *     return d.mean()  if return_mean_dist else d
 * 
 * def scale_positions (             # <<<<<<<<<<<<<<
 *     x: ArrayLike,
 *     y:ArrayLike,
 */
  __Pyx_TraceLine(4567,0,__PYX_ERR(0, 4567, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(8); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4567, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_x, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_y, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_is_latlon, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_step, __pyx_n_s_float) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_use_average_dist, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_utm_zone, __pyx_n_s_str) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_shift, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_n_s_view, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_117scale_positions, 0, __pyx_n_s_scale_positions, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__136)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4567, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsKwDict(__pyx_t_4, __pyx_t_3);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_4, __pyx_t_2);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_scale_positions, __pyx_t_4) < 0) __PYX_ERR(0, 4567, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4685
 *     return xx, yy
 * 
 * def _assert_x_y_positions (x, y , islatlon = False, is_utm=True,  **kws):             # <<<<<<<<<<<<<<
 *     """ Assert the position x and y and return array of x and y  """
 *     from ..site import Location
 */
  __Pyx_TraceLine(4685,0,__PYX_ERR(0, 4685, __pyx_L1_error))
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_119_assert_x_y_positions, 0, __pyx_n_s_assert_x_y_positions, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__137)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4685, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_tuple__230);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_assert_x_y_positions, __pyx_t_4) < 0) __PYX_ERR(0, 4685, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4703
 *     return x, y
 * 
 * def get_bearing (latlon1, latlon2,  to_deg = True ):             # <<<<<<<<<<<<<<
 *     """
 *     Calculate the bearing between two points.
 */
  __Pyx_TraceLine(4703,0,__PYX_ERR(0, 4703, __pyx_L1_error))
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_121get_bearing, 0, __pyx_n_s_get_bearing, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__138)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4703, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_4, __pyx_tuple__169);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_get_bearing, __pyx_t_4) < 0) __PYX_ERR(0, 4703, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4771
 *     return b
 * 
 * def find_closest( arr, values ):             # <<<<<<<<<<<<<<
 *     """Get the closest value in array  from given values.
 * 
 */
  __Pyx_TraceLine(4771,0,__PYX_ERR(0, 4771, __pyx_L1_error))
  __pyx_t_4 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_123find_closest, 0, __pyx_n_s_find_closest, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__140)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4771, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_find_closest, __pyx_t_4) < 0) __PYX_ERR(0, 4771, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;

  /* "gofast/tools/mathex.pyx":4820
 *         )
 * 
 * def gradient_descent(             # <<<<<<<<<<<<<<
 *     z: ArrayLike,
 *     s:ArrayLike,
 */
  __Pyx_TraceLine(4820,0,__PYX_ERR(0, 4820, __pyx_L1_error))
  __pyx_t_4 = __Pyx_PyDict_NewPresized(7); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_z, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_s, __pyx_n_s_ArrayLike) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_alpha, __pyx_n_s_float) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_n_epochs, __pyx_n_s_int) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_kind, __pyx_n_s_str) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_degree, __pyx_n_s_int) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_raise_warn, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_125gradient_descent, 0, __pyx_n_s_gradient_descent, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__141)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4820, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (!__Pyx_CyFunction_InitDefaults(__pyx_t_2, sizeof(__pyx_defaults3), 2)) __PYX_ERR(0, 4820, __pyx_L1_error)

  /* "gofast/tools/mathex.pyx":4824
 *     s:ArrayLike,
 *     alpha:float=.01,
 *     n_epochs:int= 100,             # <<<<<<<<<<<<<<
 *     kind:str="linear",
 *     degree:int=1,
 */
  __Pyx_TraceLine(4824,0,__PYX_ERR(0, 4824, __pyx_L1_error))
  if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_100)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_100))) __PYX_ERR(0, 4824, __pyx_L1_error)
  __Pyx_INCREF(__pyx_int_100);
  __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_2)->__pyx_arg_n_epochs = ((PyObject*)__pyx_int_100);
  __Pyx_GIVEREF(__pyx_int_100);

  /* "gofast/tools/mathex.pyx":4826
 *     n_epochs:int= 100,
 *     kind:str="linear",
 *     degree:int=1,             # <<<<<<<<<<<<<<
 *     raise_warn:bool=False,
 *     ):
 */
  __Pyx_TraceLine(4826,0,__PYX_ERR(0, 4826, __pyx_L1_error))
  if (!(likely(__Pyx_Py3Int_CheckExact(__pyx_int_1)) || __Pyx_RaiseUnexpectedTypeError("int", __pyx_int_1))) __PYX_ERR(0, 4826, __pyx_L1_error)
  __Pyx_INCREF(__pyx_int_1);
  __Pyx_CyFunction_Defaults(__pyx_defaults3, __pyx_t_2)->__pyx_arg_degree = ((PyObject*)__pyx_int_1);
  __Pyx_GIVEREF(__pyx_int_1);
  __Pyx_CyFunction_SetDefaultsGetter(__pyx_t_2, __pyx_pf_6gofast_5tools_6mathex_140__defaults__);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gradient_descent, __pyx_t_2) < 0) __PYX_ERR(0, 4820, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4907
 *     return _F,W, cost_history
 * 
 * def _kind_of_model(degree, x, y) :             # <<<<<<<<<<<<<<
 *     """
 *     An isolated part of gradient descent computing.
 */
  __Pyx_TraceLine(4907,0,__PYX_ERR(0, 4907, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_127_kind_of_model, 0, __pyx_n_s_kind_of_model, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__142)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4907, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_kind_of_model, __pyx_t_2) < 0) __PYX_ERR(0, 4907, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4947
 *     return x, w  # Return the matrix x and the weights vector w
 * 
 * def adaptive_moving_average(data,  window_size_factor=0.1):             # <<<<<<<<<<<<<<
 *     """ Adaptative moving average as  smoothing technique.
 * 
 */
  __Pyx_TraceLine(4947,0,__PYX_ERR(0, 4947, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_129adaptive_moving_average, 0, __pyx_n_s_adaptive_moving_average, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__145)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4947, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__236);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_adaptive_moving_average, __pyx_t_2) < 0) __PYX_ERR(0, 4947, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":4999
 * def torres_verdin_filter(
 *     arr,
 *     weight_factor: float = 0.1,             # <<<<<<<<<<<<<<
 *     beta: float = 1.0,
 *     logify: bool = False,
 */
  __Pyx_TraceLine(4999,0,__PYX_ERR(0, 4999, __pyx_L1_error))
  __pyx_t_2 = PyFloat_FromDouble(((double)0.1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4999, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);

  /* "gofast/tools/mathex.pyx":5000
 *     arr,
 *     weight_factor: float = 0.1,
 *     beta: float = 1.0,             # <<<<<<<<<<<<<<
 *     logify: bool = False,
 *     axis: int = None,
 */
  __Pyx_TraceLine(5000,0,__PYX_ERR(0, 5000, __pyx_L1_error))
  __pyx_t_4 = PyFloat_FromDouble(((double)1.0)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 5000, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);

  /* "gofast/tools/mathex.pyx":4997
 *     return result
 * 
 * def torres_verdin_filter(             # <<<<<<<<<<<<<<
 *     arr,
 *     weight_factor: float = 0.1,
 */
  __Pyx_TraceLine(4997,0,__PYX_ERR(0, 4997, __pyx_L1_error))
  __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 4997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_3);
  __Pyx_GIVEREF(__pyx_t_2);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_t_2)) __PYX_ERR(0, 4997, __pyx_L1_error);
  __Pyx_GIVEREF(__pyx_t_4);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_4)) __PYX_ERR(0, 4997, __pyx_L1_error);
  __Pyx_INCREF(((PyObject *)Py_False));
  __Pyx_GIVEREF(((PyObject *)Py_False));
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 2, ((PyObject *)Py_False))) __PYX_ERR(0, 4997, __pyx_L1_error);
  __Pyx_INCREF(Py_None);
  __Pyx_GIVEREF(Py_None);
  if (__Pyx_PyTuple_SET_ITEM(__pyx_t_3, 3, Py_None)) __PYX_ERR(0, 4997, __pyx_L1_error);
  __pyx_t_2 = 0;
  __pyx_t_4 = 0;
  __pyx_t_4 = __Pyx_PyDict_NewPresized(4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 4997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_4);
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_weight_factor, __pyx_n_s_float) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_beta, __pyx_n_s_float) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_logify, __pyx_n_s_bool) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_4, __pyx_n_s_axis, __pyx_n_s_int) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_131torres_verdin_filter, 0, __pyx_n_s_torres_verdin_filter, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__146)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4997, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_t_3);
  __Pyx_CyFunction_SetAnnotationsDict(__pyx_t_2, __pyx_t_4);
  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_torres_verdin_filter, __pyx_t_2) < 0) __PYX_ERR(0, 4997, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":5101
 *     return arr
 * 
 * def gradient_boosting_regressor(             # <<<<<<<<<<<<<<
 *         X, y, n_estimators=100, learning_rate=0.1, max_depth=1):
 *     """
 */
  __Pyx_TraceLine(5101,0,__PYX_ERR(0, 5101, __pyx_L1_error))
  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_6gofast_5tools_6mathex_133gradient_boosting_regressor, 0, __pyx_n_s_gradient_boosting_regressor, NULL, __pyx_n_s_gofast_tools_mathex, __pyx_d, ((PyObject *)__pyx_codeobj__149)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 5101, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__239);
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_gradient_boosting_regressor, __pyx_t_2) < 0) __PYX_ERR(0, 5101, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;

  /* "gofast/tools/mathex.pyx":1
 * # -*- coding: utf-8 -*-             # <<<<<<<<<<<<<<
 * #   License: BSD-3-Clause
 * #   Author: LKouadio <etanoyau@gmail.com>
 */
  __Pyx_TraceLine(1,0,__PYX_ERR(0, 1, __pyx_L1_error))
  __pyx_t_2 = __Pyx_PyDict_NewPresized(45); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_GOTREF(__pyx_t_2);
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_p_values_line_97, __pyx_kp_u_Compute_p_values_for_the_correl) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_balance_accuracy_line_24, __pyx_kp_u_Compute_the_balanced_accuracy_f) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_cost_based_threshold_lin, __pyx_kp_u_Compute_threshold_using_a_cost) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_youdens_index_line_466, __pyx_kp_u_Compute_Youden_s_Index_and_opti) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_multiclass_avg_lr_line, __pyx_kp_u_Calculate_the_average_likelihoo) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_multiclass_lr_line_662, __pyx_kp_u_Calculate_the_multiclass_likeli) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_adjusted_lr_line_809, __pyx_kp_u_Calculate_the_likelihood_ratio) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_sensitivity_specificity_3, __pyx_kp_u_Calculate_sensitivity_and_speci) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_sensitivity_specificity_4, __pyx_kp_u_Calculate_sensitivity_and_speci_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_ovo_sens_spec_line_1140, __pyx_kp_u_Compute_sensitivity_and_specifi) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_histogram_bins_line_12, __pyx_kp_u_Calculates_histogram_bin_edges) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_rank_data_line_1263, __pyx_kp_u_Assigns_ranks_to_data_handling) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_optimized_spearmanr_line_1351, __pyx_kp_u_Compute_Spearman_s_rank_correla) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_adjust_for_control_vars_line_150, __pyx_kp_u_Adjusts_y_true_and_y_pred_for_e) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_adjust_for_control_vars_regressi_2, __pyx_kp_u_Adjust_y_true_and_y_pred_for_re) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_adjust_for_control_vars_classifi_2, __pyx_kp_u_Adjusts_y_true_and_y_pred_in_a) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_weighted_spearman_rank_line_1795, __pyx_kp_u_Compute_Spearman_s_rank_correla_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_optimal_bins_line_1895, __pyx_kp_u_Calculate_the_optimal_number_of) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_binary_iv_line_1993, __pyx_kp_u_Calculate_the_Information_Value) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_calculate_residuals_line_2195, __pyx_kp_u_Calculate_the_residuals_for_reg) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_infer_sankey_columns_line_2272, __pyx_kp_u_Infers_source_target_and_value) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_sunburst_data_line_2348, __pyx_kp_u_Computes_the_data_structure_req) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_effort_yield_line_2440, __pyx_kp_u_Compute_effort_and_yield_values) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_make_mxs_line_2514, __pyx_kp_u_Compute_the_similarity_between) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_label_importance_line_2612, __pyx_kp_u_Compute_the_importance_of_each) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_standard_scaler_line_2896, __pyx_kp_u_Scales_features_to_have_zero_me) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_minmax_scaler_line_2947, __pyx_kp_u_Scales_each_feature_to_a_given) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_normalize_line_2997, __pyx_kp_u_Scales_individual_samples_to_ha) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_moving_average_line_3046, __pyx_kp_u_A_moving_average_is_used_with_t) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_count_local_minima_line_3171, __pyx_kp_u_Count_the_number_of_local_minim) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_get_azimuth_line_3229, __pyx_kp_u_Compute_azimuth_from_coordinate) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_scalePosition_line_3596, __pyx_kp_u_Correct_data_location_or_positi) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_detect_station_position_line_374, __pyx_kp_u_Detect_station_position_and_ret) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_savgol_coeffs_line_3949, __pyx_kp_u_Compute_the_coefficients_for_a_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_savgol_filter_line_4159, __pyx_kp_u_Apply_a_Savitzky_Golay_filter_t) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_compute_errors_line_4287, __pyx_kp_u_Compute_Errors_Standard_Deviati) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_quality_control2_line_4409, __pyx_kp_u_Check_the_quality_control_in_th) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_get_distance_line_4518, __pyx_kp_u_Compute_distance_between_points) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_scale_positions_line_4567, __pyx_kp_u_Correct_the_position_coordinate) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_get_bearing_line_4703, __pyx_kp_u_Calculate_the_bearing_between_t) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_find_closest_line_4771, __pyx_kp_u_Get_the_closest_value_in_array_f) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_gradient_descent_line_4820, __pyx_kp_u_Gradient_descent_algorithm_to_f) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_adaptive_moving_average_line_494, __pyx_kp_u_Adaptative_moving_average_as_sm) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_torres_verdin_filter_line_4997, __pyx_kp_u_Calculates_the_adaptive_moving) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_t_2, __pyx_kp_u_gradient_boosting_regressor_line, __pyx_kp_u_Implement_a_simple_version_of_G) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
  __Pyx_TraceReturn(Py_None, 0);

  /*--- Wrapped vars code ---*/

  goto __pyx_L0;
  __pyx_L1_error:;
  __Pyx_XDECREF(__pyx_t_2);
  __Pyx_XDECREF(__pyx_t_3);
  __Pyx_XDECREF(__pyx_t_4);
  if (__pyx_m) {
    if (__pyx_d && stringtab_initialized) {
      __Pyx_AddTraceback("init gofast.tools.mathex", __pyx_clineno, __pyx_lineno, __pyx_filename);
    }
    #if !CYTHON_USE_MODULE_STATE
    Py_CLEAR(__pyx_m);
    #else
    Py_DECREF(__pyx_m);
    if (pystate_addmodule_run) {
      PyObject *tp, *value, *tb;
      PyErr_Fetch(&tp, &value, &tb);
      PyState_RemoveModule(&__pyx_moduledef);
      PyErr_Restore(tp, value, tb);
    }
    #endif
  } else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_ImportError, "init gofast.tools.mathex");
  }
  __pyx_L0:;
  __Pyx_RefNannyFinishContext();
  #if CYTHON_PEP489_MULTI_PHASE_INIT
  return (__pyx_m != NULL) ? 0 : -1;
  #elif PY_MAJOR_VERSION >= 3
  return __pyx_m;
  #else
  return;
  #endif
}
/* #### Code section: cleanup_globals ### */
/* #### Code section: cleanup_module ### */
/* #### Code section: main_method ### */
/* #### Code section: utility_code_pragmas ### */
#ifdef _MSC_VER
#pragma warning( push )
/* Warning 4127: conditional expression is constant
 * Cython uses constant conditional expressions to allow in inline functions to be optimized at
 * compile-time, so this warning is not useful
 */
#pragma warning( disable : 4127 )
#endif



/* #### Code section: utility_code_def ### */

/* --- Runtime support code --- */
/* Refnanny */
#if CYTHON_REFNANNY
static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
    PyObject *m = NULL, *p = NULL;
    void *r = NULL;
    m = PyImport_ImportModule(modname);
    if (!m) goto end;
    p = PyObject_GetAttrString(m, "RefNannyAPI");
    if (!p) goto end;
    r = PyLong_AsVoidPtr(p);
end:
    Py_XDECREF(p);
    Py_XDECREF(m);
    return (__Pyx_RefNannyAPIStruct *)r;
}
#endif

/* PyErrExceptionMatches */
#if CYTHON_FAST_THREAD_STATE
static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
    Py_ssize_t i, n;
    n = PyTuple_GET_SIZE(tuple);
#if PY_MAJOR_VERSION >= 3
    for (i=0; i<n; i++) {
        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
    }
#endif
    for (i=0; i<n; i++) {
        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
    }
    return 0;
}
static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
    int result;
    PyObject *exc_type;
#if PY_VERSION_HEX >= 0x030C00A6
    PyObject *current_exception = tstate->current_exception;
    if (unlikely(!current_exception)) return 0;
    exc_type = (PyObject*) Py_TYPE(current_exception);
    if (exc_type == err) return 1;
#else
    exc_type = tstate->curexc_type;
    if (exc_type == err) return 1;
    if (unlikely(!exc_type)) return 0;
#endif
    #if CYTHON_AVOID_BORROWED_REFS
    Py_INCREF(exc_type);
    #endif
    if (unlikely(PyTuple_Check(err))) {
        result = __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
    } else {
        result = __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
    }
    #if CYTHON_AVOID_BORROWED_REFS
    Py_DECREF(exc_type);
    #endif
    return result;
}
#endif

/* PyErrFetchRestore */
#if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
#if PY_VERSION_HEX >= 0x030C00A6
    PyObject *tmp_value;
    assert(type == NULL || (value != NULL && type == (PyObject*) Py_TYPE(value)));
    if (value) {
        #if CYTHON_COMPILING_IN_CPYTHON
        if (unlikely(((PyBaseExceptionObject*) value)->traceback != tb))
        #endif
            PyException_SetTraceback(value, tb);
    }
    tmp_value = tstate->current_exception;
    tstate->current_exception = value;
    Py_XDECREF(tmp_value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
#else
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    tmp_type = tstate->curexc_type;
    tmp_value = tstate->curexc_value;
    tmp_tb = tstate->curexc_traceback;
    tstate->curexc_type = type;
    tstate->curexc_value = value;
    tstate->curexc_traceback = tb;
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#endif
}
static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
#if PY_VERSION_HEX >= 0x030C00A6
    PyObject* exc_value;
    exc_value = tstate->current_exception;
    tstate->current_exception = 0;
    *value = exc_value;
    *type = NULL;
    *tb = NULL;
    if (exc_value) {
        *type = (PyObject*) Py_TYPE(exc_value);
        Py_INCREF(*type);
        #if CYTHON_COMPILING_IN_CPYTHON
        *tb = ((PyBaseExceptionObject*) exc_value)->traceback;
        Py_XINCREF(*tb);
        #else
        *tb = PyException_GetTraceback(exc_value);
        #endif
    }
#else
    *type = tstate->curexc_type;
    *value = tstate->curexc_value;
    *tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
#endif
}
#endif

/* PyObjectGetAttrStr */
#if CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro))
        return tp->tp_getattro(obj, attr_name);
#if PY_MAJOR_VERSION < 3
    if (likely(tp->tp_getattr))
        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
#endif
    return PyObject_GetAttr(obj, attr_name);
}
#endif

/* PyObjectGetAttrStrNoError */
#if __PYX_LIMITED_VERSION_HEX < 0x030d00A1
static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
        __Pyx_PyErr_Clear();
}
#endif
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
    PyObject *result;
#if __PYX_LIMITED_VERSION_HEX >= 0x030d00A1
    (void) PyObject_GetOptionalAttr(obj, attr_name, &result);
    return result;
#else
#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
    PyTypeObject* tp = Py_TYPE(obj);
    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
    }
#endif
    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
    if (unlikely(!result)) {
        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
    }
    return result;
#endif
}

/* GetBuiltinName */
static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
    if (unlikely(!result) && !PyErr_Occurred()) {
        PyErr_Format(PyExc_NameError,
#if PY_MAJOR_VERSION >= 3
            "name '%U' is not defined", name);
#else
            "name '%.200s' is not defined", PyString_AS_STRING(name));
#endif
    }
    return result;
}

/* TupleAndListFromArray */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
    PyObject *v;
    Py_ssize_t i;
    for (i = 0; i < length; i++) {
        v = dest[i] = src[i];
        Py_INCREF(v);
    }
}
static CYTHON_INLINE PyObject *
__Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n)
{
    PyObject *res;
    if (n <= 0) {
        Py_INCREF(__pyx_empty_tuple);
        return __pyx_empty_tuple;
    }
    res = PyTuple_New(n);
    if (unlikely(res == NULL)) return NULL;
    __Pyx_copy_object_array(src, ((PyTupleObject*)res)->ob_item, n);
    return res;
}
static CYTHON_INLINE PyObject *
__Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n)
{
    PyObject *res;
    if (n <= 0) {
        return PyList_New(0);
    }
    res = PyList_New(n);
    if (unlikely(res == NULL)) return NULL;
    __Pyx_copy_object_array(src, ((PyListObject*)res)->ob_item, n);
    return res;
}
#endif

/* BytesEquals */
static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
    return PyObject_RichCompareBool(s1, s2, equals);
#else
    if (s1 == s2) {
        return (equals == Py_EQ);
    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
        const char *ps1, *ps2;
        Py_ssize_t length = PyBytes_GET_SIZE(s1);
        if (length != PyBytes_GET_SIZE(s2))
            return (equals == Py_NE);
        ps1 = PyBytes_AS_STRING(s1);
        ps2 = PyBytes_AS_STRING(s2);
        if (ps1[0] != ps2[0]) {
            return (equals == Py_NE);
        } else if (length == 1) {
            return (equals == Py_EQ);
        } else {
            int result;
#if CYTHON_USE_UNICODE_INTERNALS && (PY_VERSION_HEX < 0x030B0000)
            Py_hash_t hash1, hash2;
            hash1 = ((PyBytesObject*)s1)->ob_shash;
            hash2 = ((PyBytesObject*)s2)->ob_shash;
            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
                return (equals == Py_NE);
            }
#endif
            result = memcmp(ps1, ps2, (size_t)length);
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
        return (equals == Py_NE);
    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
        return (equals == Py_NE);
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
#endif
}

/* UnicodeEquals */
static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
    return PyObject_RichCompareBool(s1, s2, equals);
#else
#if PY_MAJOR_VERSION < 3
    PyObject* owned_ref = NULL;
#endif
    int s1_is_unicode, s2_is_unicode;
    if (s1 == s2) {
        goto return_eq;
    }
    s1_is_unicode = PyUnicode_CheckExact(s1);
    s2_is_unicode = PyUnicode_CheckExact(s2);
#if PY_MAJOR_VERSION < 3
    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
        owned_ref = PyUnicode_FromObject(s2);
        if (unlikely(!owned_ref))
            return -1;
        s2 = owned_ref;
        s2_is_unicode = 1;
    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
        owned_ref = PyUnicode_FromObject(s1);
        if (unlikely(!owned_ref))
            return -1;
        s1 = owned_ref;
        s1_is_unicode = 1;
    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
        return __Pyx_PyBytes_Equals(s1, s2, equals);
    }
#endif
    if (s1_is_unicode & s2_is_unicode) {
        Py_ssize_t length;
        int kind;
        void *data1, *data2;
        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
            return -1;
        length = __Pyx_PyUnicode_GET_LENGTH(s1);
        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
            goto return_ne;
        }
#if CYTHON_USE_UNICODE_INTERNALS
        {
            Py_hash_t hash1, hash2;
        #if CYTHON_PEP393_ENABLED
            hash1 = ((PyASCIIObject*)s1)->hash;
            hash2 = ((PyASCIIObject*)s2)->hash;
        #else
            hash1 = ((PyUnicodeObject*)s1)->hash;
            hash2 = ((PyUnicodeObject*)s2)->hash;
        #endif
            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
                goto return_ne;
            }
        }
#endif
        kind = __Pyx_PyUnicode_KIND(s1);
        if (kind != __Pyx_PyUnicode_KIND(s2)) {
            goto return_ne;
        }
        data1 = __Pyx_PyUnicode_DATA(s1);
        data2 = __Pyx_PyUnicode_DATA(s2);
        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
            goto return_ne;
        } else if (length == 1) {
            goto return_eq;
        } else {
            int result = memcmp(data1, data2, (size_t)(length * kind));
            #if PY_MAJOR_VERSION < 3
            Py_XDECREF(owned_ref);
            #endif
            return (equals == Py_EQ) ? (result == 0) : (result != 0);
        }
    } else if ((s1 == Py_None) & s2_is_unicode) {
        goto return_ne;
    } else if ((s2 == Py_None) & s1_is_unicode) {
        goto return_ne;
    } else {
        int result;
        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
        #if PY_MAJOR_VERSION < 3
        Py_XDECREF(owned_ref);
        #endif
        if (!py_result)
            return -1;
        result = __Pyx_PyObject_IsTrue(py_result);
        Py_DECREF(py_result);
        return result;
    }
return_eq:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_EQ);
return_ne:
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(owned_ref);
    #endif
    return (equals == Py_NE);
#endif
}

/* fastcall */
#if CYTHON_METH_FASTCALL
static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s)
{
    Py_ssize_t i, n = PyTuple_GET_SIZE(kwnames);
    for (i = 0; i < n; i++)
    {
        if (s == PyTuple_GET_ITEM(kwnames, i)) return kwvalues[i];
    }
    for (i = 0; i < n; i++)
    {
        int eq = __Pyx_PyUnicode_Equals(s, PyTuple_GET_ITEM(kwnames, i), Py_EQ);
        if (unlikely(eq != 0)) {
            if (unlikely(eq < 0)) return NULL;
            return kwvalues[i];
        }
    }
    return NULL;
}
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030d0000
CYTHON_UNUSED static PyObject *__Pyx_KwargsAsDict_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues) {
    Py_ssize_t i, nkwargs = PyTuple_GET_SIZE(kwnames);
    PyObject *dict;
    dict = PyDict_New();
    if (unlikely(!dict))
        return NULL;
    for (i=0; i<nkwargs; i++) {
        PyObject *key = PyTuple_GET_ITEM(kwnames, i);
        if (unlikely(PyDict_SetItem(dict, key, kwvalues[i]) < 0))
            goto bad;
    }
    return dict;
bad:
    Py_DECREF(dict);
    return NULL;
}
#endif
#endif

/* RaiseArgTupleInvalid */
static void __Pyx_RaiseArgtupleInvalid(
    const char* func_name,
    int exact,
    Py_ssize_t num_min,
    Py_ssize_t num_max,
    Py_ssize_t num_found)
{
    Py_ssize_t num_expected;
    const char *more_or_less;
    if (num_found < num_min) {
        num_expected = num_min;
        more_or_less = "at least";
    } else {
        num_expected = num_max;
        more_or_less = "at most";
    }
    if (exact) {
        more_or_less = "exactly";
    }
    PyErr_Format(PyExc_TypeError,
                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 func_name, more_or_less, num_expected,
                 (num_expected == 1) ? "" : "s", num_found);
}

/* RaiseDoubleKeywords */
static void __Pyx_RaiseDoubleKeywordsError(
    const char* func_name,
    PyObject* kw_name)
{
    PyErr_Format(PyExc_TypeError,
        #if PY_MAJOR_VERSION >= 3
        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
        #else
        "%s() got multiple values for keyword argument '%s'", func_name,
        PyString_AsString(kw_name));
        #endif
}

/* ParseKeywords */
static int __Pyx_ParseOptionalKeywords(
    PyObject *kwds,
    PyObject *const *kwvalues,
    PyObject **argnames[],
    PyObject *kwds2,
    PyObject *values[],
    Py_ssize_t num_pos_args,
    const char* function_name)
{
    PyObject *key = 0, *value = 0;
    Py_ssize_t pos = 0;
    PyObject*** name;
    PyObject*** first_kw_arg = argnames + num_pos_args;
    int kwds_is_tuple = CYTHON_METH_FASTCALL && likely(PyTuple_Check(kwds));
    while (1) {
        Py_XDECREF(key); key = NULL;
        Py_XDECREF(value); value = NULL;
        if (kwds_is_tuple) {
            Py_ssize_t size;
#if CYTHON_ASSUME_SAFE_MACROS
            size = PyTuple_GET_SIZE(kwds);
#else
            size = PyTuple_Size(kwds);
            if (size < 0) goto bad;
#endif
            if (pos >= size) break;
#if CYTHON_AVOID_BORROWED_REFS
            key = __Pyx_PySequence_ITEM(kwds, pos);
            if (!key) goto bad;
#elif CYTHON_ASSUME_SAFE_MACROS
            key = PyTuple_GET_ITEM(kwds, pos);
#else
            key = PyTuple_GetItem(kwds, pos);
            if (!key) goto bad;
#endif
            value = kwvalues[pos];
            pos++;
        }
        else
        {
            if (!PyDict_Next(kwds, &pos, &key, &value)) break;
#if CYTHON_AVOID_BORROWED_REFS
            Py_INCREF(key);
#endif
        }
        name = first_kw_arg;
        while (*name && (**name != key)) name++;
        if (*name) {
            values[name-argnames] = value;
#if CYTHON_AVOID_BORROWED_REFS
            Py_INCREF(value);
            Py_DECREF(key);
#endif
            key = NULL;
            value = NULL;
            continue;
        }
#if !CYTHON_AVOID_BORROWED_REFS
        Py_INCREF(key);
#endif
        Py_INCREF(value);
        name = first_kw_arg;
        #if PY_MAJOR_VERSION < 3
        if (likely(PyString_Check(key))) {
            while (*name) {
                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
                        && _PyString_Eq(**name, key)) {
                    values[name-argnames] = value;
#if CYTHON_AVOID_BORROWED_REFS
                    value = NULL;
#endif
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    if ((**argname == key) || (
                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
                             && _PyString_Eq(**argname, key))) {
                        goto arg_passed_twice;
                    }
                    argname++;
                }
            }
        } else
        #endif
        if (likely(PyUnicode_Check(key))) {
            while (*name) {
                int cmp = (
                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                    (__Pyx_PyUnicode_GET_LENGTH(**name) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
                #endif
                    PyUnicode_Compare(**name, key)
                );
                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                if (cmp == 0) {
                    values[name-argnames] = value;
#if CYTHON_AVOID_BORROWED_REFS
                    value = NULL;
#endif
                    break;
                }
                name++;
            }
            if (*name) continue;
            else {
                PyObject*** argname = argnames;
                while (argname != first_kw_arg) {
                    int cmp = (**argname == key) ? 0 :
                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                        (__Pyx_PyUnicode_GET_LENGTH(**argname) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
                    #endif
                        PyUnicode_Compare(**argname, key);
                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                    if (cmp == 0) goto arg_passed_twice;
                    argname++;
                }
            }
        } else
            goto invalid_keyword_type;
        if (kwds2) {
            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
        } else {
            goto invalid_keyword;
        }
    }
    Py_XDECREF(key);
    Py_XDECREF(value);
    return 0;
arg_passed_twice:
    __Pyx_RaiseDoubleKeywordsError(function_name, key);
    goto bad;
invalid_keyword_type:
    PyErr_Format(PyExc_TypeError,
        "%.200s() keywords must be strings", function_name);
    goto bad;
invalid_keyword:
    #if PY_MAJOR_VERSION < 3
    PyErr_Format(PyExc_TypeError,
        "%.200s() got an unexpected keyword argument '%.200s'",
        function_name, PyString_AsString(key));
    #else
    PyErr_Format(PyExc_TypeError,
        "%s() got an unexpected keyword argument '%U'",
        function_name, key);
    #endif
bad:
    Py_XDECREF(key);
    Py_XDECREF(value);
    return -1;
}

/* ArgTypeTest */
static int __Pyx__ArgTypeTest(PyObject *obj, PyTypeObject *type, const char *name, int exact)
{
    __Pyx_TypeName type_name;
    __Pyx_TypeName obj_type_name;
    if (unlikely(!type)) {
        PyErr_SetString(PyExc_SystemError, "Missing type object");
        return 0;
    }
    else if (exact) {
        #if PY_MAJOR_VERSION == 2
        if ((type == &PyBaseString_Type) && likely(__Pyx_PyBaseString_CheckExact(obj))) return 1;
        #endif
    }
    else {
        if (likely(__Pyx_TypeCheck(obj, type))) return 1;
    }
    type_name = __Pyx_PyType_GetName(type);
    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
    PyErr_Format(PyExc_TypeError,
        "Argument '%.200s' has incorrect type (expected " __Pyx_FMT_TYPENAME
        ", got " __Pyx_FMT_TYPENAME ")", name, type_name, obj_type_name);
    __Pyx_DECREF_TypeName(type_name);
    __Pyx_DECREF_TypeName(obj_type_name);
    return 0;
}

/* Profile */
#if CYTHON_PROFILE
static int __Pyx_TraceSetupAndCall(PyCodeObject** code,
                                   PyFrameObject** frame,
                                   PyThreadState* tstate,
                                   const char *funcname,
                                   const char *srcfile,
                                   int firstlineno) {
    PyObject *type, *value, *traceback;
    int retval;
    if (*frame == NULL || !CYTHON_PROFILE_REUSE_FRAME) {
        if (*code == NULL) {
            *code = __Pyx_createFrameCodeObject(funcname, srcfile, firstlineno);
            if (*code == NULL) return 0;
        }
        *frame = PyFrame_New(
            tstate,                          /*PyThreadState *tstate*/
            *code,                           /*PyCodeObject *code*/
            __pyx_d,                  /*PyObject *globals*/
            0                                /*PyObject *locals*/
        );
        if (*frame == NULL) return 0;
        if (CYTHON_TRACE && (*frame)->f_trace == NULL) {
            Py_INCREF(Py_None);
            (*frame)->f_trace = Py_None;
        }
#if PY_VERSION_HEX < 0x030400B1
    } else {
        (*frame)->f_tstate = tstate;
#endif
    }
    __Pyx_PyFrame_SetLineNumber(*frame, firstlineno);
    retval = 1;
    __Pyx_EnterTracing(tstate);
    __Pyx_ErrFetchInState(tstate, &type, &value, &traceback);
    #if CYTHON_TRACE
    if (tstate->c_tracefunc)
        retval = tstate->c_tracefunc(tstate->c_traceobj, *frame, PyTrace_CALL, NULL) == 0;
    if (retval && tstate->c_profilefunc)
    #endif
        retval = tstate->c_profilefunc(tstate->c_profileobj, *frame, PyTrace_CALL, NULL) == 0;
    __Pyx_LeaveTracing(tstate);
    if (retval) {
        __Pyx_ErrRestoreInState(tstate, type, value, traceback);
        return __Pyx_IsTracing(tstate, 0, 0) && retval;
    } else {
        Py_XDECREF(type);
        Py_XDECREF(value);
        Py_XDECREF(traceback);
        return -1;
    }
}
static PyCodeObject *__Pyx_createFrameCodeObject(const char *funcname, const char *srcfile, int firstlineno) {
    PyCodeObject *py_code = 0;
#if PY_MAJOR_VERSION >= 3
    py_code = PyCode_NewEmpty(srcfile, funcname, firstlineno);
    if (likely(py_code)) {
        py_code->co_flags |= CO_OPTIMIZED | CO_NEWLOCALS;
    }
#else
    PyObject *py_srcfile = 0;
    PyObject *py_funcname = 0;
    py_funcname = PyString_FromString(funcname);
    if (unlikely(!py_funcname)) goto bad;
    py_srcfile = PyString_FromString(srcfile);
    if (unlikely(!py_srcfile)) goto bad;
    py_code = PyCode_New(
        0,
        0,
        0,
        CO_OPTIMIZED | CO_NEWLOCALS,
        __pyx_empty_bytes,     /*PyObject *code,*/
        __pyx_empty_tuple,     /*PyObject *consts,*/
        __pyx_empty_tuple,     /*PyObject *names,*/
        __pyx_empty_tuple,     /*PyObject *varnames,*/
        __pyx_empty_tuple,     /*PyObject *freevars,*/
        __pyx_empty_tuple,     /*PyObject *cellvars,*/
        py_srcfile,       /*PyObject *filename,*/
        py_funcname,      /*PyObject *name,*/
        firstlineno,
        __pyx_empty_bytes      /*PyObject *lnotab*/
    );
bad:
    Py_XDECREF(py_srcfile);
    Py_XDECREF(py_funcname);
#endif
    return py_code;
}
#endif

/* PyDictVersioning */
#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
    PyObject *dict = Py_TYPE(obj)->tp_dict;
    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
}
static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
    PyObject **dictptr = NULL;
    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
    if (offset) {
#if CYTHON_COMPILING_IN_CPYTHON
        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
#else
        dictptr = _PyObject_GetDictPtr(obj);
#endif
    }
    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
}
static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
    PyObject *dict = Py_TYPE(obj)->tp_dict;
    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
        return 0;
    return obj_dict_version == __Pyx_get_object_dict_version(obj);
}
#endif

/* GetModuleGlobalName */
#if CYTHON_USE_DICT_VERSIONS
static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
#else
static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
#endif
{
    PyObject *result;
#if !CYTHON_AVOID_BORROWED_REFS
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && PY_VERSION_HEX < 0x030d0000
    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    } else if (unlikely(PyErr_Occurred())) {
        return NULL;
    }
#elif CYTHON_COMPILING_IN_LIMITED_API
    if (unlikely(!__pyx_m)) {
        return NULL;
    }
    result = PyObject_GetAttr(__pyx_m, name);
    if (likely(result)) {
        return result;
    }
#else
    result = PyDict_GetItem(__pyx_d, name);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    }
#endif
#else
    result = PyObject_GetItem(__pyx_d, name);
    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
    if (likely(result)) {
        return __Pyx_NewRef(result);
    }
    PyErr_Clear();
#endif
    return __Pyx_GetBuiltinName(name);
}

/* PyFunctionFastCall */
#if CYTHON_FAST_PYCALL && !CYTHON_VECTORCALL
static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                               PyObject *globals) {
    PyFrameObject *f;
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    PyObject **fastlocals;
    Py_ssize_t i;
    PyObject *result;
    assert(globals != NULL);
    /* XXX Perhaps we should create a specialized
       PyFrame_New() that doesn't take locals, but does
       take builtins without sanity checking them.
       */
    assert(tstate != NULL);
    f = PyFrame_New(tstate, co, globals, NULL);
    if (f == NULL) {
        return NULL;
    }
    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
    for (i = 0; i < na; i++) {
        Py_INCREF(*args);
        fastlocals[i] = *args++;
    }
    result = PyEval_EvalFrameEx(f,0);
    ++tstate->recursion_depth;
    Py_DECREF(f);
    --tstate->recursion_depth;
    return result;
}
static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
    PyObject *globals = PyFunction_GET_GLOBALS(func);
    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
    PyObject *closure;
#if PY_MAJOR_VERSION >= 3
    PyObject *kwdefs;
#endif
    PyObject *kwtuple, **k;
    PyObject **d;
    Py_ssize_t nd;
    Py_ssize_t nk;
    PyObject *result;
    assert(kwargs == NULL || PyDict_Check(kwargs));
    nk = kwargs ? PyDict_Size(kwargs) : 0;
    #if PY_MAJOR_VERSION < 3
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object"))) {
        return NULL;
    }
    #else
    if (unlikely(Py_EnterRecursiveCall(" while calling a Python object"))) {
        return NULL;
    }
    #endif
    if (
#if PY_MAJOR_VERSION >= 3
            co->co_kwonlyargcount == 0 &&
#endif
            likely(kwargs == NULL || nk == 0) &&
            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
        if (argdefs == NULL && co->co_argcount == nargs) {
            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
            goto done;
        }
        else if (nargs == 0 && argdefs != NULL
                 && co->co_argcount == Py_SIZE(argdefs)) {
            /* function called with no arguments, but all parameters have
               a default value: use default values as arguments .*/
            args = &PyTuple_GET_ITEM(argdefs, 0);
            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
            goto done;
        }
    }
    if (kwargs != NULL) {
        Py_ssize_t pos, i;
        kwtuple = PyTuple_New(2 * nk);
        if (kwtuple == NULL) {
            result = NULL;
            goto done;
        }
        k = &PyTuple_GET_ITEM(kwtuple, 0);
        pos = i = 0;
        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
            Py_INCREF(k[i]);
            Py_INCREF(k[i+1]);
            i += 2;
        }
        nk = i / 2;
    }
    else {
        kwtuple = NULL;
        k = NULL;
    }
    closure = PyFunction_GET_CLOSURE(func);
#if PY_MAJOR_VERSION >= 3
    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
#endif
    if (argdefs != NULL) {
        d = &PyTuple_GET_ITEM(argdefs, 0);
        nd = Py_SIZE(argdefs);
    }
    else {
        d = NULL;
        nd = 0;
    }
#if PY_MAJOR_VERSION >= 3
    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
                               args, (int)nargs,
                               k, (int)nk,
                               d, (int)nd, kwdefs, closure);
#else
    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
                               args, (int)nargs,
                               k, (int)nk,
                               d, (int)nd, closure);
#endif
    Py_XDECREF(kwtuple);
done:
    Py_LeaveRecursiveCall();
    return result;
}
#endif

/* PyObjectCall */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyObject *result;
    ternaryfunc call = Py_TYPE(func)->tp_call;
    if (unlikely(!call))
        return PyObject_Call(func, arg, kw);
    #if PY_MAJOR_VERSION < 3
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    #else
    if (unlikely(Py_EnterRecursiveCall(" while calling a Python object")))
        return NULL;
    #endif
    result = (*call)(func, arg, kw);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectCallMethO */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
    PyObject *self, *result;
    PyCFunction cfunc;
    cfunc = __Pyx_CyOrPyCFunction_GET_FUNCTION(func);
    self = __Pyx_CyOrPyCFunction_GET_SELF(func);
    #if PY_MAJOR_VERSION < 3
    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
        return NULL;
    #else
    if (unlikely(Py_EnterRecursiveCall(" while calling a Python object")))
        return NULL;
    #endif
    result = cfunc(self, arg);
    Py_LeaveRecursiveCall();
    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
        PyErr_SetString(
            PyExc_SystemError,
            "NULL result without error in PyObject_Call");
    }
    return result;
}
#endif

/* PyObjectFastCall */
#if PY_VERSION_HEX < 0x03090000 || CYTHON_COMPILING_IN_LIMITED_API
static PyObject* __Pyx_PyObject_FastCall_fallback(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs) {
    PyObject *argstuple;
    PyObject *result = 0;
    size_t i;
    argstuple = PyTuple_New((Py_ssize_t)nargs);
    if (unlikely(!argstuple)) return NULL;
    for (i = 0; i < nargs; i++) {
        Py_INCREF(args[i]);
        if (__Pyx_PyTuple_SET_ITEM(argstuple, (Py_ssize_t)i, args[i]) < 0) goto bad;
    }
    result = __Pyx_PyObject_Call(func, argstuple, kwargs);
  bad:
    Py_DECREF(argstuple);
    return result;
}
#endif
static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t _nargs, PyObject *kwargs) {
    Py_ssize_t nargs = __Pyx_PyVectorcall_NARGS(_nargs);
#if CYTHON_COMPILING_IN_CPYTHON
    if (nargs == 0 && kwargs == NULL) {
        if (__Pyx_CyOrPyCFunction_Check(func) && likely( __Pyx_CyOrPyCFunction_GET_FLAGS(func) & METH_NOARGS))
            return __Pyx_PyObject_CallMethO(func, NULL);
    }
    else if (nargs == 1 && kwargs == NULL) {
        if (__Pyx_CyOrPyCFunction_Check(func) && likely( __Pyx_CyOrPyCFunction_GET_FLAGS(func) & METH_O))
            return __Pyx_PyObject_CallMethO(func, args[0]);
    }
#endif
    #if PY_VERSION_HEX < 0x030800B1
    #if CYTHON_FAST_PYCCALL
    if (PyCFunction_Check(func)) {
        if (kwargs) {
            return _PyCFunction_FastCallDict(func, args, nargs, kwargs);
        } else {
            return _PyCFunction_FastCallKeywords(func, args, nargs, NULL);
        }
    }
    #if PY_VERSION_HEX >= 0x030700A1
    if (!kwargs && __Pyx_IS_TYPE(func, &PyMethodDescr_Type)) {
        return _PyMethodDescr_FastCallKeywords(func, args, nargs, NULL);
    }
    #endif
    #endif
    #if CYTHON_FAST_PYCALL
    if (PyFunction_Check(func)) {
        return __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs);
    }
    #endif
    #endif
    if (kwargs == NULL) {
        #if CYTHON_VECTORCALL
        #if PY_VERSION_HEX < 0x03090000
        vectorcallfunc f = _PyVectorcall_Function(func);
        #else
        vectorcallfunc f = PyVectorcall_Function(func);
        #endif
        if (f) {
            return f(func, args, (size_t)nargs, NULL);
        }
        #elif defined(__Pyx_CyFunction_USED) && CYTHON_BACKPORT_VECTORCALL
        if (__Pyx_CyFunction_CheckExact(func)) {
            __pyx_vectorcallfunc f = __Pyx_CyFunction_func_vectorcall(func);
            if (f) return f(func, args, (size_t)nargs, NULL);
        }
        #endif
    }
    if (nargs == 0) {
        return __Pyx_PyObject_Call(func, __pyx_empty_tuple, kwargs);
    }
    #if PY_VERSION_HEX >= 0x03090000 && !CYTHON_COMPILING_IN_LIMITED_API
    return PyObject_VectorcallDict(func, args, (size_t)nargs, kwargs);
    #else
    return __Pyx_PyObject_FastCall_fallback(func, args, (size_t)nargs, kwargs);
    #endif
}

/* PyObjectFormatAndDecref */
static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatSimpleAndDecref(PyObject* s, PyObject* f) {
    if (unlikely(!s)) return NULL;
    if (likely(PyUnicode_CheckExact(s))) return s;
    #if PY_MAJOR_VERSION < 3
    if (likely(PyString_CheckExact(s))) {
        PyObject *result = PyUnicode_FromEncodedObject(s, NULL, "strict");
        Py_DECREF(s);
        return result;
    }
    #endif
    return __Pyx_PyObject_FormatAndDecref(s, f);
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatAndDecref(PyObject* s, PyObject* f) {
    PyObject *result;
    if (unlikely(!s)) return NULL;
    result = PyObject_Format(s, f);
    Py_DECREF(s);
    return result;
}

/* PyObjectCallOneArg */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
    PyObject *args[2] = {NULL, arg};
    return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
}

/* RaiseException */
#if PY_MAJOR_VERSION < 3
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    __Pyx_PyThreadState_declare
    CYTHON_UNUSED_VAR(cause);
    Py_XINCREF(type);
    if (!value || value == Py_None)
        value = NULL;
    else
        Py_INCREF(value);
    if (!tb || tb == Py_None)
        tb = NULL;
    else {
        Py_INCREF(tb);
        if (!PyTraceBack_Check(tb)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: arg 3 must be a traceback or None");
            goto raise_error;
        }
    }
    if (PyType_Check(type)) {
#if CYTHON_COMPILING_IN_PYPY
        if (!value) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#endif
        PyErr_NormalizeException(&type, &value, &tb);
    } else {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto raise_error;
        }
        value = type;
        type = (PyObject*) Py_TYPE(type);
        Py_INCREF(type);
        if (!PyType_IsSubtype((PyTypeObject *)type, (PyTypeObject *)PyExc_BaseException)) {
            PyErr_SetString(PyExc_TypeError,
                "raise: exception class must be a subclass of BaseException");
            goto raise_error;
        }
    }
    __Pyx_PyThreadState_assign
    __Pyx_ErrRestore(type, value, tb);
    return;
raise_error:
    Py_XDECREF(value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
    return;
}
#else
static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
    PyObject* owned_instance = NULL;
    if (tb == Py_None) {
        tb = 0;
    } else if (tb && !PyTraceBack_Check(tb)) {
        PyErr_SetString(PyExc_TypeError,
            "raise: arg 3 must be a traceback or None");
        goto bad;
    }
    if (value == Py_None)
        value = 0;
    if (PyExceptionInstance_Check(type)) {
        if (value) {
            PyErr_SetString(PyExc_TypeError,
                "instance exception may not have a separate value");
            goto bad;
        }
        value = type;
        type = (PyObject*) Py_TYPE(value);
    } else if (PyExceptionClass_Check(type)) {
        PyObject *instance_class = NULL;
        if (value && PyExceptionInstance_Check(value)) {
            instance_class = (PyObject*) Py_TYPE(value);
            if (instance_class != type) {
                int is_subclass = PyObject_IsSubclass(instance_class, type);
                if (!is_subclass) {
                    instance_class = NULL;
                } else if (unlikely(is_subclass == -1)) {
                    goto bad;
                } else {
                    type = instance_class;
                }
            }
        }
        if (!instance_class) {
            PyObject *args;
            if (!value)
                args = PyTuple_New(0);
            else if (PyTuple_Check(value)) {
                Py_INCREF(value);
                args = value;
            } else
                args = PyTuple_Pack(1, value);
            if (!args)
                goto bad;
            owned_instance = PyObject_Call(type, args, NULL);
            Py_DECREF(args);
            if (!owned_instance)
                goto bad;
            value = owned_instance;
            if (!PyExceptionInstance_Check(value)) {
                PyErr_Format(PyExc_TypeError,
                             "calling %R should have returned an instance of "
                             "BaseException, not %R",
                             type, Py_TYPE(value));
                goto bad;
            }
        }
    } else {
        PyErr_SetString(PyExc_TypeError,
            "raise: exception class must be a subclass of BaseException");
        goto bad;
    }
    if (cause) {
        PyObject *fixed_cause;
        if (cause == Py_None) {
            fixed_cause = NULL;
        } else if (PyExceptionClass_Check(cause)) {
            fixed_cause = PyObject_CallObject(cause, NULL);
            if (fixed_cause == NULL)
                goto bad;
        } else if (PyExceptionInstance_Check(cause)) {
            fixed_cause = cause;
            Py_INCREF(fixed_cause);
        } else {
            PyErr_SetString(PyExc_TypeError,
                            "exception causes must derive from "
                            "BaseException");
            goto bad;
        }
        PyException_SetCause(value, fixed_cause);
    }
    PyErr_SetObject(type, value);
    if (tb) {
      #if PY_VERSION_HEX >= 0x030C00A6
        PyException_SetTraceback(value, tb);
      #elif CYTHON_FAST_THREAD_STATE
        PyThreadState *tstate = __Pyx_PyThreadState_Current;
        PyObject* tmp_tb = tstate->curexc_traceback;
        if (tb != tmp_tb) {
            Py_INCREF(tb);
            tstate->curexc_traceback = tb;
            Py_XDECREF(tmp_tb);
        }
#else
        PyObject *tmp_type, *tmp_value, *tmp_tb;
        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
        Py_INCREF(tb);
        PyErr_Restore(tmp_type, tmp_value, tb);
        Py_XDECREF(tmp_tb);
#endif
    }
bad:
    Py_XDECREF(owned_instance);
    return;
}
#endif

/* JoinPyUnicode */
static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                      Py_UCS4 max_char) {
#if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    PyObject *result_uval;
    int result_ukind, kind_shift;
    Py_ssize_t i, char_pos;
    void *result_udata;
    CYTHON_MAYBE_UNUSED_VAR(max_char);
#if CYTHON_PEP393_ENABLED
    result_uval = PyUnicode_New(result_ulength, max_char);
    if (unlikely(!result_uval)) return NULL;
    result_ukind = (max_char <= 255) ? PyUnicode_1BYTE_KIND : (max_char <= 65535) ? PyUnicode_2BYTE_KIND : PyUnicode_4BYTE_KIND;
    kind_shift = (result_ukind == PyUnicode_4BYTE_KIND) ? 2 : result_ukind - 1;
    result_udata = PyUnicode_DATA(result_uval);
#else
    result_uval = PyUnicode_FromUnicode(NULL, result_ulength);
    if (unlikely(!result_uval)) return NULL;
    result_ukind = sizeof(Py_UNICODE);
    kind_shift = (result_ukind == 4) ? 2 : result_ukind - 1;
    result_udata = PyUnicode_AS_UNICODE(result_uval);
#endif
    assert(kind_shift == 2 || kind_shift == 1 || kind_shift == 0);
    char_pos = 0;
    for (i=0; i < value_count; i++) {
        int ukind;
        Py_ssize_t ulength;
        void *udata;
        PyObject *uval = PyTuple_GET_ITEM(value_tuple, i);
        if (unlikely(__Pyx_PyUnicode_READY(uval)))
            goto bad;
        ulength = __Pyx_PyUnicode_GET_LENGTH(uval);
        if (unlikely(!ulength))
            continue;
        if (unlikely((PY_SSIZE_T_MAX >> kind_shift) - ulength < char_pos))
            goto overflow;
        ukind = __Pyx_PyUnicode_KIND(uval);
        udata = __Pyx_PyUnicode_DATA(uval);
        if (!CYTHON_PEP393_ENABLED || ukind == result_ukind) {
            memcpy((char *)result_udata + (char_pos << kind_shift), udata, (size_t) (ulength << kind_shift));
        } else {
            #if PY_VERSION_HEX >= 0x030d0000
            if (unlikely(PyUnicode_CopyCharacters(result_uval, char_pos, uval, 0, ulength) < 0)) goto bad;
            #elif CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030300F0 || defined(_PyUnicode_FastCopyCharacters)
            _PyUnicode_FastCopyCharacters(result_uval, char_pos, uval, 0, ulength);
            #else
            Py_ssize_t j;
            for (j=0; j < ulength; j++) {
                Py_UCS4 uchar = __Pyx_PyUnicode_READ(ukind, udata, j);
                __Pyx_PyUnicode_WRITE(result_ukind, result_udata, char_pos+j, uchar);
            }
            #endif
        }
        char_pos += ulength;
    }
    return result_uval;
overflow:
    PyErr_SetString(PyExc_OverflowError, "join() result is too long for a Python string");
bad:
    Py_DECREF(result_uval);
    return NULL;
#else
    CYTHON_UNUSED_VAR(max_char);
    CYTHON_UNUSED_VAR(result_ulength);
    CYTHON_UNUSED_VAR(value_count);
    return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
#endif
}

/* GetItemInt */
static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
    PyObject *r;
    if (unlikely(!j)) return NULL;
    r = PyObject_GetItem(o, j);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    Py_ssize_t wrapped_i = i;
    if (wraparound & unlikely(i < 0)) {
        wrapped_i += PyList_GET_SIZE(o);
    }
    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                              CYTHON_NCP_UNUSED int wraparound,
                                                              CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    Py_ssize_t wrapped_i = i;
    if (wraparound & unlikely(i < 0)) {
        wrapped_i += PyTuple_GET_SIZE(o);
    }
    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
        Py_INCREF(r);
        return r;
    }
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
#else
    return PySequence_GetItem(o, i);
#endif
}
static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
                                                     CYTHON_NCP_UNUSED int wraparound,
                                                     CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
            PyObject *r = PyList_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    }
    else if (PyTuple_CheckExact(o)) {
        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
            PyObject *r = PyTuple_GET_ITEM(o, n);
            Py_INCREF(r);
            return r;
        }
    } else {
        PyMappingMethods *mm = Py_TYPE(o)->tp_as_mapping;
        PySequenceMethods *sm = Py_TYPE(o)->tp_as_sequence;
        if (mm && mm->mp_subscript) {
            PyObject *r, *key = PyInt_FromSsize_t(i);
            if (unlikely(!key)) return NULL;
            r = mm->mp_subscript(o, key);
            Py_DECREF(key);
            return r;
        }
        if (likely(sm && sm->sq_item)) {
            if (wraparound && unlikely(i < 0) && likely(sm->sq_length)) {
                Py_ssize_t l = sm->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return NULL;
                    PyErr_Clear();
                }
            }
            return sm->sq_item(o, i);
        }
    }
#else
    if (is_list || !PyMapping_Check(o)) {
        return PySequence_GetItem(o, i);
    }
#endif
    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
}

/* ObjectGetItem */
#if CYTHON_USE_TYPE_SLOTS
static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject *index) {
    PyObject *runerr = NULL;
    Py_ssize_t key_value;
    key_value = __Pyx_PyIndex_AsSsize_t(index);
    if (likely(key_value != -1 || !(runerr = PyErr_Occurred()))) {
        return __Pyx_GetItemInt_Fast(obj, key_value, 0, 1, 1);
    }
    if (PyErr_GivenExceptionMatches(runerr, PyExc_OverflowError)) {
        __Pyx_TypeName index_type_name = __Pyx_PyType_GetName(Py_TYPE(index));
        PyErr_Clear();
        PyErr_Format(PyExc_IndexError,
            "cannot fit '" __Pyx_FMT_TYPENAME "' into an index-sized integer", index_type_name);
        __Pyx_DECREF_TypeName(index_type_name);
    }
    return NULL;
}
static PyObject *__Pyx_PyObject_GetItem_Slow(PyObject *obj, PyObject *key) {
    __Pyx_TypeName obj_type_name;
    if (likely(PyType_Check(obj))) {
        PyObject *meth = __Pyx_PyObject_GetAttrStrNoError(obj, __pyx_n_s_class_getitem);
        if (!meth) {
            PyErr_Clear();
        } else {
            PyObject *result = __Pyx_PyObject_CallOneArg(meth, key);
            Py_DECREF(meth);
            return result;
        }
    }
    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
    PyErr_Format(PyExc_TypeError,
        "'" __Pyx_FMT_TYPENAME "' object is not subscriptable", obj_type_name);
    __Pyx_DECREF_TypeName(obj_type_name);
    return NULL;
}
static PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject *key) {
    PyTypeObject *tp = Py_TYPE(obj);
    PyMappingMethods *mm = tp->tp_as_mapping;
    PySequenceMethods *sm = tp->tp_as_sequence;
    if (likely(mm && mm->mp_subscript)) {
        return mm->mp_subscript(obj, key);
    }
    if (likely(sm && sm->sq_item)) {
        return __Pyx_PyObject_GetIndex(obj, key);
    }
    return __Pyx_PyObject_GetItem_Slow(obj, key);
}
#endif

/* GetAttr */
static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
#if CYTHON_USE_TYPE_SLOTS
#if PY_MAJOR_VERSION >= 3
    if (likely(PyUnicode_Check(n)))
#else
    if (likely(PyString_Check(n)))
#endif
        return __Pyx_PyObject_GetAttrStr(o, n);
#endif
    return PyObject_GetAttr(o, n);
}

/* HasAttr */
#if __PYX_LIMITED_VERSION_HEX < 0x030d00A1
static CYTHON_INLINE int __Pyx_HasAttr(PyObject *o, PyObject *n) {
    PyObject *r;
    if (unlikely(!__Pyx_PyBaseString_Check(n))) {
        PyErr_SetString(PyExc_TypeError,
                        "hasattr(): attribute name must be string");
        return -1;
    }
    r = __Pyx_GetAttr(o, n);
    if (!r) {
        PyErr_Clear();
        return 0;
    } else {
        Py_DECREF(r);
        return 1;
    }
}
#endif

/* PyIntCompare */
static CYTHON_INLINE int __Pyx_PyInt_BoolEqObjC(PyObject *op1, PyObject *op2, long intval, long inplace) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_UNUSED_VAR(inplace);
    if (op1 == op2) {
        return 1;
    }
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        return (a == b);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        int unequal;
        unsigned long uintval;
        Py_ssize_t size = __Pyx_PyLong_DigitCount(op1);
        const digit* digits = __Pyx_PyLong_Digits(op1);
        if (intval == 0) {
            return (__Pyx_PyLong_IsZero(op1) == 1);
        } else if (intval < 0) {
            if (__Pyx_PyLong_IsNonNeg(op1))
                return 0;
            intval = -intval;
        } else {
            if (__Pyx_PyLong_IsNeg(op1))
                return 0;
        }
        uintval = (unsigned long) intval;
#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 4)) {
            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 3)) {
            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 2)) {
            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 1)) {
            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
        return (unequal == 0);
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
        return ((double)a == (double)b);
    }
    return __Pyx_PyObject_IsTrueAndDecref(
        PyObject_RichCompare(op1, op2, Py_EQ));
}

/* DictGetItem */
#if PY_MAJOR_VERSION >= 3 && !CYTHON_COMPILING_IN_PYPY
static PyObject *__Pyx_PyDict_GetItem(PyObject *d, PyObject* key) {
    PyObject *value;
    value = PyDict_GetItemWithError(d, key);
    if (unlikely(!value)) {
        if (!PyErr_Occurred()) {
            if (unlikely(PyTuple_Check(key))) {
                PyObject* args = PyTuple_Pack(1, key);
                if (likely(args)) {
                    PyErr_SetObject(PyExc_KeyError, args);
                    Py_DECREF(args);
                }
            } else {
                PyErr_SetObject(PyExc_KeyError, key);
            }
        }
        return NULL;
    }
    Py_INCREF(value);
    return value;
}
#endif

/* RaiseTooManyValuesToUnpack */
static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
    PyErr_Format(PyExc_ValueError,
                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
}

/* RaiseNeedMoreValuesToUnpack */
static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
    PyErr_Format(PyExc_ValueError,
                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                 index, (index == 1) ? "" : "s");
}

/* IterFinish */
static CYTHON_INLINE int __Pyx_IterFinish(void) {
    PyObject* exc_type;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    exc_type = __Pyx_PyErr_CurrentExceptionType();
    if (unlikely(exc_type)) {
        if (unlikely(!__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))
            return -1;
        __Pyx_PyErr_Clear();
        return 0;
    }
    return 0;
}

/* UnpackItemEndCheck */
static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
    if (unlikely(retval)) {
        Py_DECREF(retval);
        __Pyx_RaiseTooManyValuesError(expected);
        return -1;
    }
    return __Pyx_IterFinish();
}

/* RaiseUnexpectedTypeError */
static int
__Pyx_RaiseUnexpectedTypeError(const char *expected, PyObject *obj)
{
    __Pyx_TypeName obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
    PyErr_Format(PyExc_TypeError, "Expected %s, got " __Pyx_FMT_TYPENAME,
                 expected, obj_type_name);
    __Pyx_DECREF_TypeName(obj_type_name);
    return 0;
}

/* RaiseUnboundLocalError */
static CYTHON_INLINE void __Pyx_RaiseUnboundLocalError(const char *varname) {
    PyErr_Format(PyExc_UnboundLocalError, "local variable '%s' referenced before assignment", varname);
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_TrueDivideObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        
            if (8 * sizeof(long) <= 53 || likely(labs(a) <= ((PY_LONG_LONG)1 << 53))) {
                return PyFloat_FromDouble((double)a / (double)b);
            }
            return PyInt_Type.tp_as_number->nb_true_divide(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
        if (unlikely(__Pyx_PyLong_IsZero(op1))) {
        }
        if (likely(__Pyx_PyLong_IsCompact(op1))) {
            a = __Pyx_PyLong_CompactValue(op1);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op1);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op1);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT && 1 * PyLong_SHIFT < 53) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT && 1 * PyLong_SHIFT < 53) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT && 2 * PyLong_SHIFT < 53) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT && 2 * PyLong_SHIFT < 53) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT && 3 * PyLong_SHIFT < 53) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT && 3 * PyLong_SHIFT < 53) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_true_divide(op1, op2);
            }
        }
                if ((8 * sizeof(long) <= 53 || likely(labs(a) <= ((PY_LONG_LONG)1 << 53)))
                        || __Pyx_PyLong_DigitCount(op1) <= 52 / PyLong_SHIFT) {
                    return PyFloat_FromDouble((double)a / (double)b);
                }
                return PyLong_Type.tp_as_number->nb_true_divide(op1, op2);
            return PyLong_FromLong(x);
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
            double result;
            
            PyFPE_START_PROTECT("divide", return NULL)
            result = ((double)a) / (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceTrueDivide : PyNumber_TrueDivide)(op1, op2);
}
#endif

/* SliceObject */
static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
        Py_ssize_t cstart, Py_ssize_t cstop,
        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
        int has_cstart, int has_cstop, int wraparound) {
    __Pyx_TypeName obj_type_name;
#if CYTHON_USE_TYPE_SLOTS
    PyMappingMethods* mp;
#if PY_MAJOR_VERSION < 3
    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
    if (likely(ms && ms->sq_slice)) {
        if (!has_cstart) {
            if (_py_start && (*_py_start != Py_None)) {
                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstart = 0;
        }
        if (!has_cstop) {
            if (_py_stop && (*_py_stop != Py_None)) {
                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
            } else
                cstop = PY_SSIZE_T_MAX;
        }
        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
            Py_ssize_t l = ms->sq_length(obj);
            if (likely(l >= 0)) {
                if (cstop < 0) {
                    cstop += l;
                    if (cstop < 0) cstop = 0;
                }
                if (cstart < 0) {
                    cstart += l;
                    if (cstart < 0) cstart = 0;
                }
            } else {
                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                    goto bad;
                PyErr_Clear();
            }
        }
        return ms->sq_slice(obj, cstart, cstop);
    }
#else
    CYTHON_UNUSED_VAR(wraparound);
#endif
    mp = Py_TYPE(obj)->tp_as_mapping;
    if (likely(mp && mp->mp_subscript))
#else
    CYTHON_UNUSED_VAR(wraparound);
#endif
    {
        PyObject* result;
        PyObject *py_slice, *py_start, *py_stop;
        if (_py_slice) {
            py_slice = *_py_slice;
        } else {
            PyObject* owned_start = NULL;
            PyObject* owned_stop = NULL;
            if (_py_start) {
                py_start = *_py_start;
            } else {
                if (has_cstart) {
                    owned_start = py_start = PyInt_FromSsize_t(cstart);
                    if (unlikely(!py_start)) goto bad;
                } else
                    py_start = Py_None;
            }
            if (_py_stop) {
                py_stop = *_py_stop;
            } else {
                if (has_cstop) {
                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
                    if (unlikely(!py_stop)) {
                        Py_XDECREF(owned_start);
                        goto bad;
                    }
                } else
                    py_stop = Py_None;
            }
            py_slice = PySlice_New(py_start, py_stop, Py_None);
            Py_XDECREF(owned_start);
            Py_XDECREF(owned_stop);
            if (unlikely(!py_slice)) goto bad;
        }
#if CYTHON_USE_TYPE_SLOTS
        result = mp->mp_subscript(obj, py_slice);
#else
        result = PyObject_GetItem(obj, py_slice);
#endif
        if (!_py_slice) {
            Py_DECREF(py_slice);
        }
        return result;
    }
    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
    PyErr_Format(PyExc_TypeError,
        "'" __Pyx_FMT_TYPENAME "' object is unsliceable", obj_type_name);
    __Pyx_DECREF_TypeName(obj_type_name);
bad:
    return NULL;
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
        
            x = (long)((unsigned long)a + (unsigned long)b);
            if (likely((x^a) >= 0 || (x^b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_add(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op1))) {
            return __Pyx_NewRef(op2);
        }
        if (likely(__Pyx_PyLong_IsCompact(op1))) {
            a = __Pyx_PyLong_CompactValue(op1);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op1);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op1);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_add(op1, op2);
            }
        }
                x = a + b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla + llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
            double result;
            
            PyFPE_START_PROTECT("add", return NULL)
            result = ((double)a) + (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceAdd : PyNumber_Add)(op1, op2);
}
#endif

/* pybytes_as_double */
static double __Pyx_SlowPyString_AsDouble(PyObject *obj) {
    PyObject *float_value;
#if PY_MAJOR_VERSION >= 3
    float_value = PyFloat_FromString(obj);
#else
    float_value = PyFloat_FromString(obj, 0);
#endif
    if (likely(float_value)) {
#if CYTHON_ASSUME_SAFE_MACROS
        double value = PyFloat_AS_DOUBLE(float_value);
#else
        double value = PyFloat_AsDouble(float_value);
#endif
        Py_DECREF(float_value);
        return value;
    }
    return (double)-1;
}
static const char* __Pyx__PyBytes_AsDouble_Copy(const char* start, char* buffer, Py_ssize_t length) {
    int last_was_punctuation = 1;
    Py_ssize_t i;
    for (i=0; i < length; i++) {
        char chr = start[i];
        int is_punctuation = (chr == '_') | (chr == '.') | (chr == 'e') | (chr == 'E');
        *buffer = chr;
        buffer += (chr != '_');
        if (unlikely(last_was_punctuation & is_punctuation)) goto parse_failure;
        last_was_punctuation = is_punctuation;
    }
    if (unlikely(last_was_punctuation)) goto parse_failure;
    *buffer = '\0';
    return buffer;
parse_failure:
    return NULL;
}
static double __Pyx__PyBytes_AsDouble_inf_nan(const char* start, Py_ssize_t length) {
    int matches = 1;
    char sign = start[0];
    int is_signed = (sign == '+') | (sign == '-');
    start += is_signed;
    length -= is_signed;
    switch (start[0]) {
        #ifdef Py_NAN
        case 'n':
        case 'N':
            if (unlikely(length != 3)) goto parse_failure;
            matches &= (start[1] == 'a' || start[1] == 'A');
            matches &= (start[2] == 'n' || start[2] == 'N');
            if (unlikely(!matches)) goto parse_failure;
            return (sign == '-') ? -Py_NAN : Py_NAN;
        #endif
        case 'i':
        case 'I':
            if (unlikely(length < 3)) goto parse_failure;
            matches &= (start[1] == 'n' || start[1] == 'N');
            matches &= (start[2] == 'f' || start[2] == 'F');
            if (likely(length == 3 && matches))
                return (sign == '-') ? -Py_HUGE_VAL : Py_HUGE_VAL;
            if (unlikely(length != 8)) goto parse_failure;
            matches &= (start[3] == 'i' || start[3] == 'I');
            matches &= (start[4] == 'n' || start[4] == 'N');
            matches &= (start[5] == 'i' || start[5] == 'I');
            matches &= (start[6] == 't' || start[6] == 'T');
            matches &= (start[7] == 'y' || start[7] == 'Y');
            if (unlikely(!matches)) goto parse_failure;
            return (sign == '-') ? -Py_HUGE_VAL : Py_HUGE_VAL;
        case '.': case '0': case '1': case '2': case '3': case '4': case '5': case '6': case '7': case '8': case '9':
            break;
        default:
            goto parse_failure;
    }
    return 0.0;
parse_failure:
    return -1.0;
}
static CYTHON_INLINE int __Pyx__PyBytes_AsDouble_IsSpace(char ch) {
    return (ch == 0x20) | !((ch < 0x9) | (ch > 0xd));
}
CYTHON_UNUSED static double __Pyx__PyBytes_AsDouble(PyObject *obj, const char* start, Py_ssize_t length) {
    double value;
    Py_ssize_t i, digits;
    const char *last = start + length;
    char *end;
    while (__Pyx__PyBytes_AsDouble_IsSpace(*start))
        start++;
    while (start < last - 1 && __Pyx__PyBytes_AsDouble_IsSpace(last[-1]))
        last--;
    length = last - start;
    if (unlikely(length <= 0)) goto fallback;
    value = __Pyx__PyBytes_AsDouble_inf_nan(start, length);
    if (unlikely(value == -1.0)) goto fallback;
    if (value != 0.0) return value;
    digits = 0;
    for (i=0; i < length; digits += start[i++] != '_');
    if (likely(digits == length)) {
        value = PyOS_string_to_double(start, &end, NULL);
    } else if (digits < 40) {
        char number[40];
        last = __Pyx__PyBytes_AsDouble_Copy(start, number, length);
        if (unlikely(!last)) goto fallback;
        value = PyOS_string_to_double(number, &end, NULL);
    } else {
        char *number = (char*) PyMem_Malloc((digits + 1) * sizeof(char));
        if (unlikely(!number)) goto fallback;
        last = __Pyx__PyBytes_AsDouble_Copy(start, number, length);
        if (unlikely(!last)) {
            PyMem_Free(number);
            goto fallback;
        }
        value = PyOS_string_to_double(number, &end, NULL);
        PyMem_Free(number);
    }
    if (likely(end == last) || (value == (double)-1 && PyErr_Occurred())) {
        return value;
    }
fallback:
    return __Pyx_SlowPyString_AsDouble(obj);
}

/* PyIntCompare */
static CYTHON_INLINE PyObject* __Pyx_PyInt_EqObjC(PyObject *op1, PyObject *op2, long intval, long inplace) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_UNUSED_VAR(inplace);
    if (op1 == op2) {
        Py_RETURN_TRUE;
    }
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        if (a == b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        int unequal;
        unsigned long uintval;
        Py_ssize_t size = __Pyx_PyLong_DigitCount(op1);
        const digit* digits = __Pyx_PyLong_Digits(op1);
        if (intval == 0) {
            if (__Pyx_PyLong_IsZero(op1) == 1) Py_RETURN_TRUE; else Py_RETURN_FALSE;
        } else if (intval < 0) {
            if (__Pyx_PyLong_IsNonNeg(op1))
                Py_RETURN_FALSE;
            intval = -intval;
        } else {
            if (__Pyx_PyLong_IsNeg(op1))
                Py_RETURN_FALSE;
        }
        uintval = (unsigned long) intval;
#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 4)) {
            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 3)) {
            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 2)) {
            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 1)) {
            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
        if (unequal == 0) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
        if ((double)a == (double)b) Py_RETURN_TRUE; else Py_RETURN_FALSE;
    }
    return (
        PyObject_RichCompare(op1, op2, Py_EQ));
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op2))) {
        const long a = intval;
        long x;
        long b = PyInt_AS_LONG(op2);
        
            x = (long)((unsigned long)a - (unsigned long)b);
            if (likely((x^a) >= 0 || (x^~b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op2))) {
        const long a = intval;
        long b, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG lla = intval;
        PY_LONG_LONG llb, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op2))) {
            return __Pyx_NewRef(op1);
        }
        if (likely(__Pyx_PyLong_IsCompact(op2))) {
            b = __Pyx_PyLong_CompactValue(op2);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op2);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op2);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        b = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        b = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        b = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        b = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        b = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        b = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
            }
        }
                x = a - b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla - llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op2)) {
        const long a = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double b = __pyx_PyFloat_AsDouble(op2);
#else
        double b = PyFloat_AS_DOUBLE(op2);
#endif
            double result;
            
            PyFPE_START_PROTECT("subtract", return NULL)
            result = ((double)a) - (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceSubtract : PyNumber_Subtract)(op1, op2);
}
#endif

/* SetItemInt */
static int __Pyx_SetItemInt_Generic(PyObject *o, PyObject *j, PyObject *v) {
    int r;
    if (unlikely(!j)) return -1;
    r = PyObject_SetItem(o, j, v);
    Py_DECREF(j);
    return r;
}
static CYTHON_INLINE int __Pyx_SetItemInt_Fast(PyObject *o, Py_ssize_t i, PyObject *v, int is_list,
                                               CYTHON_NCP_UNUSED int wraparound, CYTHON_NCP_UNUSED int boundscheck) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
    if (is_list || PyList_CheckExact(o)) {
        Py_ssize_t n = (!wraparound) ? i : ((likely(i >= 0)) ? i : i + PyList_GET_SIZE(o));
        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o)))) {
            PyObject* old = PyList_GET_ITEM(o, n);
            Py_INCREF(v);
            PyList_SET_ITEM(o, n, v);
            Py_DECREF(old);
            return 1;
        }
    } else {
        PyMappingMethods *mm = Py_TYPE(o)->tp_as_mapping;
        PySequenceMethods *sm = Py_TYPE(o)->tp_as_sequence;
        if (mm && mm->mp_ass_subscript) {
            int r;
            PyObject *key = PyInt_FromSsize_t(i);
            if (unlikely(!key)) return -1;
            r = mm->mp_ass_subscript(o, key, v);
            Py_DECREF(key);
            return r;
        }
        if (likely(sm && sm->sq_ass_item)) {
            if (wraparound && unlikely(i < 0) && likely(sm->sq_length)) {
                Py_ssize_t l = sm->sq_length(o);
                if (likely(l >= 0)) {
                    i += l;
                } else {
                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                        return -1;
                    PyErr_Clear();
                }
            }
            return sm->sq_ass_item(o, i, v);
        }
    }
#else
    if (is_list || !PyMapping_Check(o))
    {
        return PySequence_SetItem(o, i, v);
    }
#endif
    return __Pyx_SetItemInt_Generic(o, PyInt_FromSsize_t(i), v);
}

/* PyObjectCallNoArg */
static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
    PyObject *arg[2] = {NULL, NULL};
    return __Pyx_PyObject_FastCall(func, arg + 1, 0 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
}

/* PyObjectGetMethod */
static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
    PyObject *attr;
#if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
    __Pyx_TypeName type_name;
    PyTypeObject *tp = Py_TYPE(obj);
    PyObject *descr;
    descrgetfunc f = NULL;
    PyObject **dictptr, *dict;
    int meth_found = 0;
    assert (*method == NULL);
    if (unlikely(tp->tp_getattro != PyObject_GenericGetAttr)) {
        attr = __Pyx_PyObject_GetAttrStr(obj, name);
        goto try_unpack;
    }
    if (unlikely(tp->tp_dict == NULL) && unlikely(PyType_Ready(tp) < 0)) {
        return 0;
    }
    descr = _PyType_Lookup(tp, name);
    if (likely(descr != NULL)) {
        Py_INCREF(descr);
#if defined(Py_TPFLAGS_METHOD_DESCRIPTOR) && Py_TPFLAGS_METHOD_DESCRIPTOR
        if (__Pyx_PyType_HasFeature(Py_TYPE(descr), Py_TPFLAGS_METHOD_DESCRIPTOR))
#elif PY_MAJOR_VERSION >= 3
        #ifdef __Pyx_CyFunction_USED
        if (likely(PyFunction_Check(descr) || __Pyx_IS_TYPE(descr, &PyMethodDescr_Type) || __Pyx_CyFunction_Check(descr)))
        #else
        if (likely(PyFunction_Check(descr) || __Pyx_IS_TYPE(descr, &PyMethodDescr_Type)))
        #endif
#else
        #ifdef __Pyx_CyFunction_USED
        if (likely(PyFunction_Check(descr) || __Pyx_CyFunction_Check(descr)))
        #else
        if (likely(PyFunction_Check(descr)))
        #endif
#endif
        {
            meth_found = 1;
        } else {
            f = Py_TYPE(descr)->tp_descr_get;
            if (f != NULL && PyDescr_IsData(descr)) {
                attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
                Py_DECREF(descr);
                goto try_unpack;
            }
        }
    }
    dictptr = _PyObject_GetDictPtr(obj);
    if (dictptr != NULL && (dict = *dictptr) != NULL) {
        Py_INCREF(dict);
        attr = __Pyx_PyDict_GetItemStr(dict, name);
        if (attr != NULL) {
            Py_INCREF(attr);
            Py_DECREF(dict);
            Py_XDECREF(descr);
            goto try_unpack;
        }
        Py_DECREF(dict);
    }
    if (meth_found) {
        *method = descr;
        return 1;
    }
    if (f != NULL) {
        attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
        Py_DECREF(descr);
        goto try_unpack;
    }
    if (likely(descr != NULL)) {
        *method = descr;
        return 0;
    }
    type_name = __Pyx_PyType_GetName(tp);
    PyErr_Format(PyExc_AttributeError,
#if PY_MAJOR_VERSION >= 3
                 "'" __Pyx_FMT_TYPENAME "' object has no attribute '%U'",
                 type_name, name);
#else
                 "'" __Pyx_FMT_TYPENAME "' object has no attribute '%.400s'",
                 type_name, PyString_AS_STRING(name));
#endif
    __Pyx_DECREF_TypeName(type_name);
    return 0;
#else
    attr = __Pyx_PyObject_GetAttrStr(obj, name);
    goto try_unpack;
#endif
try_unpack:
#if CYTHON_UNPACK_METHODS
    if (likely(attr) && PyMethod_Check(attr) && likely(PyMethod_GET_SELF(attr) == obj)) {
        PyObject *function = PyMethod_GET_FUNCTION(attr);
        Py_INCREF(function);
        Py_DECREF(attr);
        *method = function;
        return 1;
    }
#endif
    *method = attr;
    return 0;
}

/* PyObjectCallMethod0 */
static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
    PyObject *method = NULL, *result = NULL;
    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
    if (likely(is_method)) {
        result = __Pyx_PyObject_CallOneArg(method, obj);
        Py_DECREF(method);
        return result;
    }
    if (unlikely(!method)) goto bad;
    result = __Pyx_PyObject_CallNoArg(method);
    Py_DECREF(method);
bad:
    return result;
}

/* RaiseNoneIterError */
static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
}

/* UnpackTupleError */
static void __Pyx_UnpackTupleError(PyObject *t, Py_ssize_t index) {
    if (t == Py_None) {
      __Pyx_RaiseNoneNotIterableError();
    } else if (PyTuple_GET_SIZE(t) < index) {
      __Pyx_RaiseNeedMoreValuesError(PyTuple_GET_SIZE(t));
    } else {
      __Pyx_RaiseTooManyValuesError(index);
    }
}

/* UnpackTuple2 */
static CYTHON_INLINE int __Pyx_unpack_tuple2_exact(
        PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2, int decref_tuple) {
    PyObject *value1 = NULL, *value2 = NULL;
#if CYTHON_COMPILING_IN_PYPY
    value1 = PySequence_ITEM(tuple, 0);  if (unlikely(!value1)) goto bad;
    value2 = PySequence_ITEM(tuple, 1);  if (unlikely(!value2)) goto bad;
#else
    value1 = PyTuple_GET_ITEM(tuple, 0);  Py_INCREF(value1);
    value2 = PyTuple_GET_ITEM(tuple, 1);  Py_INCREF(value2);
#endif
    if (decref_tuple) {
        Py_DECREF(tuple);
    }
    *pvalue1 = value1;
    *pvalue2 = value2;
    return 0;
#if CYTHON_COMPILING_IN_PYPY
bad:
    Py_XDECREF(value1);
    Py_XDECREF(value2);
    if (decref_tuple) { Py_XDECREF(tuple); }
    return -1;
#endif
}
static int __Pyx_unpack_tuple2_generic(PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2,
                                       int has_known_size, int decref_tuple) {
    Py_ssize_t index;
    PyObject *value1 = NULL, *value2 = NULL, *iter = NULL;
    iternextfunc iternext;
    iter = PyObject_GetIter(tuple);
    if (unlikely(!iter)) goto bad;
    if (decref_tuple) { Py_DECREF(tuple); tuple = NULL; }
    iternext = __Pyx_PyObject_GetIterNextFunc(iter);
    value1 = iternext(iter); if (unlikely(!value1)) { index = 0; goto unpacking_failed; }
    value2 = iternext(iter); if (unlikely(!value2)) { index = 1; goto unpacking_failed; }
    if (!has_known_size && unlikely(__Pyx_IternextUnpackEndCheck(iternext(iter), 2))) goto bad;
    Py_DECREF(iter);
    *pvalue1 = value1;
    *pvalue2 = value2;
    return 0;
unpacking_failed:
    if (!has_known_size && __Pyx_IterFinish() == 0)
        __Pyx_RaiseNeedMoreValuesError(index);
bad:
    Py_XDECREF(iter);
    Py_XDECREF(value1);
    Py_XDECREF(value2);
    if (decref_tuple) { Py_XDECREF(tuple); }
    return -1;
}

/* dict_iter */
#if CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
#include <string.h>
#endif
static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* iterable, int is_dict, PyObject* method_name,
                                                   Py_ssize_t* p_orig_length, int* p_source_is_dict) {
    is_dict = is_dict || likely(PyDict_CheckExact(iterable));
    *p_source_is_dict = is_dict;
    if (is_dict) {
#if !CYTHON_COMPILING_IN_PYPY
        *p_orig_length = PyDict_Size(iterable);
        Py_INCREF(iterable);
        return iterable;
#elif PY_MAJOR_VERSION >= 3
        static PyObject *py_items = NULL, *py_keys = NULL, *py_values = NULL;
        PyObject **pp = NULL;
        if (method_name) {
            const char *name = PyUnicode_AsUTF8(method_name);
            if (strcmp(name, "iteritems") == 0) pp = &py_items;
            else if (strcmp(name, "iterkeys") == 0) pp = &py_keys;
            else if (strcmp(name, "itervalues") == 0) pp = &py_values;
            if (pp) {
                if (!*pp) {
                    *pp = PyUnicode_FromString(name + 4);
                    if (!*pp)
                        return NULL;
                }
                method_name = *pp;
            }
        }
#endif
    }
    *p_orig_length = 0;
    if (method_name) {
        PyObject* iter;
        iterable = __Pyx_PyObject_CallMethod0(iterable, method_name);
        if (!iterable)
            return NULL;
#if !CYTHON_COMPILING_IN_PYPY
        if (PyTuple_CheckExact(iterable) || PyList_CheckExact(iterable))
            return iterable;
#endif
        iter = PyObject_GetIter(iterable);
        Py_DECREF(iterable);
        return iter;
    }
    return PyObject_GetIter(iterable);
}
static CYTHON_INLINE int __Pyx_dict_iter_next(
        PyObject* iter_obj, CYTHON_NCP_UNUSED Py_ssize_t orig_length, CYTHON_NCP_UNUSED Py_ssize_t* ppos,
        PyObject** pkey, PyObject** pvalue, PyObject** pitem, int source_is_dict) {
    PyObject* next_item;
#if !CYTHON_COMPILING_IN_PYPY
    if (source_is_dict) {
        PyObject *key, *value;
        if (unlikely(orig_length != PyDict_Size(iter_obj))) {
            PyErr_SetString(PyExc_RuntimeError, "dictionary changed size during iteration");
            return -1;
        }
        if (unlikely(!PyDict_Next(iter_obj, ppos, &key, &value))) {
            return 0;
        }
        if (pitem) {
            PyObject* tuple = PyTuple_New(2);
            if (unlikely(!tuple)) {
                return -1;
            }
            Py_INCREF(key);
            Py_INCREF(value);
            PyTuple_SET_ITEM(tuple, 0, key);
            PyTuple_SET_ITEM(tuple, 1, value);
            *pitem = tuple;
        } else {
            if (pkey) {
                Py_INCREF(key);
                *pkey = key;
            }
            if (pvalue) {
                Py_INCREF(value);
                *pvalue = value;
            }
        }
        return 1;
    } else if (PyTuple_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyTuple_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyTuple_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else if (PyList_CheckExact(iter_obj)) {
        Py_ssize_t pos = *ppos;
        if (unlikely(pos >= PyList_GET_SIZE(iter_obj))) return 0;
        *ppos = pos + 1;
        next_item = PyList_GET_ITEM(iter_obj, pos);
        Py_INCREF(next_item);
    } else
#endif
    {
        next_item = PyIter_Next(iter_obj);
        if (unlikely(!next_item)) {
            return __Pyx_IterFinish();
        }
    }
    if (pitem) {
        *pitem = next_item;
    } else if (pkey && pvalue) {
        if (__Pyx_unpack_tuple2(next_item, pkey, pvalue, source_is_dict, source_is_dict, 1))
            return -1;
    } else if (pkey) {
        *pkey = next_item;
    } else {
        *pvalue = next_item;
    }
    return 1;
}

/* FixUpExtensionType */
#if CYTHON_USE_TYPE_SPECS
static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type) {
#if PY_VERSION_HEX > 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
    CYTHON_UNUSED_VAR(spec);
    CYTHON_UNUSED_VAR(type);
#else
    const PyType_Slot *slot = spec->slots;
    while (slot && slot->slot && slot->slot != Py_tp_members)
        slot++;
    if (slot && slot->slot == Py_tp_members) {
        int changed = 0;
#if !(PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON)
        const
#endif
            PyMemberDef *memb = (PyMemberDef*) slot->pfunc;
        while (memb && memb->name) {
            if (memb->name[0] == '_' && memb->name[1] == '_') {
#if PY_VERSION_HEX < 0x030900b1
                if (strcmp(memb->name, "__weaklistoffset__") == 0) {
                    assert(memb->type == T_PYSSIZET);
                    assert(memb->flags == READONLY);
                    type->tp_weaklistoffset = memb->offset;
                    changed = 1;
                }
                else if (strcmp(memb->name, "__dictoffset__") == 0) {
                    assert(memb->type == T_PYSSIZET);
                    assert(memb->flags == READONLY);
                    type->tp_dictoffset = memb->offset;
                    changed = 1;
                }
#if CYTHON_METH_FASTCALL
                else if (strcmp(memb->name, "__vectorcalloffset__") == 0) {
                    assert(memb->type == T_PYSSIZET);
                    assert(memb->flags == READONLY);
#if PY_VERSION_HEX >= 0x030800b4
                    type->tp_vectorcall_offset = memb->offset;
#else
                    type->tp_print = (printfunc) memb->offset;
#endif
                    changed = 1;
                }
#endif
#else
                if ((0));
#endif
#if PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON
                else if (strcmp(memb->name, "__module__") == 0) {
                    PyObject *descr;
                    assert(memb->type == T_OBJECT);
                    assert(memb->flags == 0 || memb->flags == READONLY);
                    descr = PyDescr_NewMember(type, memb);
                    if (unlikely(!descr))
                        return -1;
                    if (unlikely(PyDict_SetItem(type->tp_dict, PyDescr_NAME(descr), descr) < 0)) {
                        Py_DECREF(descr);
                        return -1;
                    }
                    Py_DECREF(descr);
                    changed = 1;
                }
#endif
            }
            memb++;
        }
        if (changed)
            PyType_Modified(type);
    }
#endif
    return 0;
}
#endif

/* FetchSharedCythonModule */
static PyObject *__Pyx_FetchSharedCythonABIModule(void) {
    return __Pyx_PyImport_AddModuleRef((char*) __PYX_ABI_MODULE_NAME);
}

/* FetchCommonType */
static int __Pyx_VerifyCachedType(PyObject *cached_type,
                               const char *name,
                               Py_ssize_t basicsize,
                               Py_ssize_t expected_basicsize) {
    if (!PyType_Check(cached_type)) {
        PyErr_Format(PyExc_TypeError,
            "Shared Cython type %.200s is not a type object", name);
        return -1;
    }
    if (basicsize != expected_basicsize) {
        PyErr_Format(PyExc_TypeError,
            "Shared Cython type %.200s has the wrong size, try recompiling",
            name);
        return -1;
    }
    return 0;
}
#if !CYTHON_USE_TYPE_SPECS
static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
    PyObject* abi_module;
    const char* object_name;
    PyTypeObject *cached_type = NULL;
    abi_module = __Pyx_FetchSharedCythonABIModule();
    if (!abi_module) return NULL;
    object_name = strrchr(type->tp_name, '.');
    object_name = object_name ? object_name+1 : type->tp_name;
    cached_type = (PyTypeObject*) PyObject_GetAttrString(abi_module, object_name);
    if (cached_type) {
        if (__Pyx_VerifyCachedType(
              (PyObject *)cached_type,
              object_name,
              cached_type->tp_basicsize,
              type->tp_basicsize) < 0) {
            goto bad;
        }
        goto done;
    }
    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
    PyErr_Clear();
    if (PyType_Ready(type) < 0) goto bad;
    if (PyObject_SetAttrString(abi_module, object_name, (PyObject *)type) < 0)
        goto bad;
    Py_INCREF(type);
    cached_type = type;
done:
    Py_DECREF(abi_module);
    return cached_type;
bad:
    Py_XDECREF(cached_type);
    cached_type = NULL;
    goto done;
}
#else
static PyTypeObject *__Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases) {
    PyObject *abi_module, *cached_type = NULL;
    const char* object_name = strrchr(spec->name, '.');
    object_name = object_name ? object_name+1 : spec->name;
    abi_module = __Pyx_FetchSharedCythonABIModule();
    if (!abi_module) return NULL;
    cached_type = PyObject_GetAttrString(abi_module, object_name);
    if (cached_type) {
        Py_ssize_t basicsize;
#if CYTHON_COMPILING_IN_LIMITED_API
        PyObject *py_basicsize;
        py_basicsize = PyObject_GetAttrString(cached_type, "__basicsize__");
        if (unlikely(!py_basicsize)) goto bad;
        basicsize = PyLong_AsSsize_t(py_basicsize);
        Py_DECREF(py_basicsize);
        py_basicsize = 0;
        if (unlikely(basicsize == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
#else
        basicsize = likely(PyType_Check(cached_type)) ? ((PyTypeObject*) cached_type)->tp_basicsize : -1;
#endif
        if (__Pyx_VerifyCachedType(
              cached_type,
              object_name,
              basicsize,
              spec->basicsize) < 0) {
            goto bad;
        }
        goto done;
    }
    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
    PyErr_Clear();
    CYTHON_UNUSED_VAR(module);
    cached_type = __Pyx_PyType_FromModuleAndSpec(abi_module, spec, bases);
    if (unlikely(!cached_type)) goto bad;
    if (unlikely(__Pyx_fix_up_extension_type_from_spec(spec, (PyTypeObject *) cached_type) < 0)) goto bad;
    if (PyObject_SetAttrString(abi_module, object_name, cached_type) < 0) goto bad;
done:
    Py_DECREF(abi_module);
    assert(cached_type == NULL || PyType_Check(cached_type));
    return (PyTypeObject *) cached_type;
bad:
    Py_XDECREF(cached_type);
    cached_type = NULL;
    goto done;
}
#endif

/* PyVectorcallFastCallDict */
#if CYTHON_METH_FASTCALL
static PyObject *__Pyx_PyVectorcall_FastCallDict_kw(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
{
    PyObject *res = NULL;
    PyObject *kwnames;
    PyObject **newargs;
    PyObject **kwvalues;
    Py_ssize_t i, pos;
    size_t j;
    PyObject *key, *value;
    unsigned long keys_are_strings;
    Py_ssize_t nkw = PyDict_GET_SIZE(kw);
    newargs = (PyObject **)PyMem_Malloc((nargs + (size_t)nkw) * sizeof(args[0]));
    if (unlikely(newargs == NULL)) {
        PyErr_NoMemory();
        return NULL;
    }
    for (j = 0; j < nargs; j++) newargs[j] = args[j];
    kwnames = PyTuple_New(nkw);
    if (unlikely(kwnames == NULL)) {
        PyMem_Free(newargs);
        return NULL;
    }
    kwvalues = newargs + nargs;
    pos = i = 0;
    keys_are_strings = Py_TPFLAGS_UNICODE_SUBCLASS;
    while (PyDict_Next(kw, &pos, &key, &value)) {
        keys_are_strings &= Py_TYPE(key)->tp_flags;
        Py_INCREF(key);
        Py_INCREF(value);
        PyTuple_SET_ITEM(kwnames, i, key);
        kwvalues[i] = value;
        i++;
    }
    if (unlikely(!keys_are_strings)) {
        PyErr_SetString(PyExc_TypeError, "keywords must be strings");
        goto cleanup;
    }
    res = vc(func, newargs, nargs, kwnames);
cleanup:
    Py_DECREF(kwnames);
    for (i = 0; i < nkw; i++)
        Py_DECREF(kwvalues[i]);
    PyMem_Free(newargs);
    return res;
}
static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
{
    if (likely(kw == NULL) || PyDict_GET_SIZE(kw) == 0) {
        return vc(func, args, nargs, NULL);
    }
    return __Pyx_PyVectorcall_FastCallDict_kw(func, vc, args, nargs, kw);
}
#endif

/* CythonFunctionShared */
#if CYTHON_COMPILING_IN_LIMITED_API
static CYTHON_INLINE int __Pyx__IsSameCyOrCFunction(PyObject *func, void *cfunc) {
    if (__Pyx_CyFunction_Check(func)) {
        return PyCFunction_GetFunction(((__pyx_CyFunctionObject*)func)->func) == (PyCFunction) cfunc;
    } else if (PyCFunction_Check(func)) {
        return PyCFunction_GetFunction(func) == (PyCFunction) cfunc;
    }
    return 0;
}
#else
static CYTHON_INLINE int __Pyx__IsSameCyOrCFunction(PyObject *func, void *cfunc) {
    return __Pyx_CyOrPyCFunction_Check(func) && __Pyx_CyOrPyCFunction_GET_FUNCTION(func) == (PyCFunction) cfunc;
}
#endif
static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj) {
#if PY_VERSION_HEX < 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
    __Pyx_Py_XDECREF_SET(
        __Pyx_CyFunction_GetClassObj(f),
            ((classobj) ? __Pyx_NewRef(classobj) : NULL));
#else
    __Pyx_Py_XDECREF_SET(
        ((PyCMethodObject *) (f))->mm_class,
        (PyTypeObject*)((classobj) ? __Pyx_NewRef(classobj) : NULL));
#endif
}
static PyObject *
__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, void *closure)
{
    CYTHON_UNUSED_VAR(closure);
    if (unlikely(op->func_doc == NULL)) {
#if CYTHON_COMPILING_IN_LIMITED_API
        op->func_doc = PyObject_GetAttrString(op->func, "__doc__");
        if (unlikely(!op->func_doc)) return NULL;
#else
        if (((PyCFunctionObject*)op)->m_ml->ml_doc) {
#if PY_MAJOR_VERSION >= 3
            op->func_doc = PyUnicode_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
#else
            op->func_doc = PyString_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
#endif
            if (unlikely(op->func_doc == NULL))
                return NULL;
        } else {
            Py_INCREF(Py_None);
            return Py_None;
        }
#endif
    }
    Py_INCREF(op->func_doc);
    return op->func_doc;
}
static int
__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value, void *context)
{
    CYTHON_UNUSED_VAR(context);
    if (value == NULL) {
        value = Py_None;
    }
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(op->func_doc, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op, void *context)
{
    CYTHON_UNUSED_VAR(context);
    if (unlikely(op->func_name == NULL)) {
#if CYTHON_COMPILING_IN_LIMITED_API
        op->func_name = PyObject_GetAttrString(op->func, "__name__");
#elif PY_MAJOR_VERSION >= 3
        op->func_name = PyUnicode_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
#else
        op->func_name = PyString_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
#endif
        if (unlikely(op->func_name == NULL))
            return NULL;
    }
    Py_INCREF(op->func_name);
    return op->func_name;
}
static int
__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value, void *context)
{
    CYTHON_UNUSED_VAR(context);
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__name__ must be set to a string object");
        return -1;
    }
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(op->func_name, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op, void *context)
{
    CYTHON_UNUSED_VAR(context);
    Py_INCREF(op->func_qualname);
    return op->func_qualname;
}
static int
__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value, void *context)
{
    CYTHON_UNUSED_VAR(context);
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__qualname__ must be set to a string object");
        return -1;
    }
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(op->func_qualname, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op, void *context)
{
    CYTHON_UNUSED_VAR(context);
    if (unlikely(op->func_dict == NULL)) {
        op->func_dict = PyDict_New();
        if (unlikely(op->func_dict == NULL))
            return NULL;
    }
    Py_INCREF(op->func_dict);
    return op->func_dict;
}
static int
__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value, void *context)
{
    CYTHON_UNUSED_VAR(context);
    if (unlikely(value == NULL)) {
        PyErr_SetString(PyExc_TypeError,
               "function's dictionary may not be deleted");
        return -1;
    }
    if (unlikely(!PyDict_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
               "setting function's dictionary to a non-dict");
        return -1;
    }
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(op->func_dict, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op, void *context)
{
    CYTHON_UNUSED_VAR(context);
    Py_INCREF(op->func_globals);
    return op->func_globals;
}
static PyObject *
__Pyx_CyFunction_get_closure(__pyx_CyFunctionObject *op, void *context)
{
    CYTHON_UNUSED_VAR(op);
    CYTHON_UNUSED_VAR(context);
    Py_INCREF(Py_None);
    return Py_None;
}
static PyObject *
__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op, void *context)
{
    PyObject* result = (op->func_code) ? op->func_code : Py_None;
    CYTHON_UNUSED_VAR(context);
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
    int result = 0;
    PyObject *res = op->defaults_getter((PyObject *) op);
    if (unlikely(!res))
        return -1;
    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
    op->defaults_tuple = PyTuple_GET_ITEM(res, 0);
    Py_INCREF(op->defaults_tuple);
    op->defaults_kwdict = PyTuple_GET_ITEM(res, 1);
    Py_INCREF(op->defaults_kwdict);
    #else
    op->defaults_tuple = __Pyx_PySequence_ITEM(res, 0);
    if (unlikely(!op->defaults_tuple)) result = -1;
    else {
        op->defaults_kwdict = __Pyx_PySequence_ITEM(res, 1);
        if (unlikely(!op->defaults_kwdict)) result = -1;
    }
    #endif
    Py_DECREF(res);
    return result;
}
static int
__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
    CYTHON_UNUSED_VAR(context);
    if (!value) {
        value = Py_None;
    } else if (unlikely(value != Py_None && !PyTuple_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
                        "__defaults__ must be set to a tuple object");
        return -1;
    }
    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__defaults__ will not "
                 "currently affect the values used in function calls", 1);
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(op->defaults_tuple, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op, void *context) {
    PyObject* result = op->defaults_tuple;
    CYTHON_UNUSED_VAR(context);
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
            result = op->defaults_tuple;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
    CYTHON_UNUSED_VAR(context);
    if (!value) {
        value = Py_None;
    } else if (unlikely(value != Py_None && !PyDict_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
                        "__kwdefaults__ must be set to a dict object");
        return -1;
    }
    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__kwdefaults__ will not "
                 "currently affect the values used in function calls", 1);
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(op->defaults_kwdict, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op, void *context) {
    PyObject* result = op->defaults_kwdict;
    CYTHON_UNUSED_VAR(context);
    if (unlikely(!result)) {
        if (op->defaults_getter) {
            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
            result = op->defaults_kwdict;
        } else {
            result = Py_None;
        }
    }
    Py_INCREF(result);
    return result;
}
static int
__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
    CYTHON_UNUSED_VAR(context);
    if (!value || value == Py_None) {
        value = NULL;
    } else if (unlikely(!PyDict_Check(value))) {
        PyErr_SetString(PyExc_TypeError,
                        "__annotations__ must be set to a dict object");
        return -1;
    }
    Py_XINCREF(value);
    __Pyx_Py_XDECREF_SET(op->func_annotations, value);
    return 0;
}
static PyObject *
__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op, void *context) {
    PyObject* result = op->func_annotations;
    CYTHON_UNUSED_VAR(context);
    if (unlikely(!result)) {
        result = PyDict_New();
        if (unlikely(!result)) return NULL;
        op->func_annotations = result;
    }
    Py_INCREF(result);
    return result;
}
static PyObject *
__Pyx_CyFunction_get_is_coroutine(__pyx_CyFunctionObject *op, void *context) {
    int is_coroutine;
    CYTHON_UNUSED_VAR(context);
    if (op->func_is_coroutine) {
        return __Pyx_NewRef(op->func_is_coroutine);
    }
    is_coroutine = op->flags & __Pyx_CYFUNCTION_COROUTINE;
#if PY_VERSION_HEX >= 0x03050000
    if (is_coroutine) {
        PyObject *module, *fromlist, *marker = __pyx_n_s_is_coroutine;
        fromlist = PyList_New(1);
        if (unlikely(!fromlist)) return NULL;
        Py_INCREF(marker);
#if CYTHON_ASSUME_SAFE_MACROS
        PyList_SET_ITEM(fromlist, 0, marker);
#else
        if (unlikely(PyList_SetItem(fromlist, 0, marker) < 0)) {
            Py_DECREF(marker);
            Py_DECREF(fromlist);
            return NULL;
        }
#endif
        module = PyImport_ImportModuleLevelObject(__pyx_n_s_asyncio_coroutines, NULL, NULL, fromlist, 0);
        Py_DECREF(fromlist);
        if (unlikely(!module)) goto ignore;
        op->func_is_coroutine = __Pyx_PyObject_GetAttrStr(module, marker);
        Py_DECREF(module);
        if (likely(op->func_is_coroutine)) {
            return __Pyx_NewRef(op->func_is_coroutine);
        }
ignore:
        PyErr_Clear();
    }
#endif
    op->func_is_coroutine = __Pyx_PyBool_FromLong(is_coroutine);
    return __Pyx_NewRef(op->func_is_coroutine);
}
#if CYTHON_COMPILING_IN_LIMITED_API
static PyObject *
__Pyx_CyFunction_get_module(__pyx_CyFunctionObject *op, void *context) {
    CYTHON_UNUSED_VAR(context);
    return PyObject_GetAttrString(op->func, "__module__");
}
static int
__Pyx_CyFunction_set_module(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
    CYTHON_UNUSED_VAR(context);
    return PyObject_SetAttrString(op->func, "__module__", value);
}
#endif
static PyGetSetDef __pyx_CyFunction_getsets[] = {
    {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
    {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
    {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
    {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
    {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
    {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
    {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
    {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
    {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
    {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
    {(char *) "_is_coroutine", (getter)__Pyx_CyFunction_get_is_coroutine, 0, 0, 0},
#if CYTHON_COMPILING_IN_LIMITED_API
    {"__module__", (getter)__Pyx_CyFunction_get_module, (setter)__Pyx_CyFunction_set_module, 0, 0},
#endif
    {0, 0, 0, 0, 0}
};
static PyMemberDef __pyx_CyFunction_members[] = {
#if !CYTHON_COMPILING_IN_LIMITED_API
    {(char *) "__module__", T_OBJECT, offsetof(PyCFunctionObject, m_module), 0, 0},
#endif
#if CYTHON_USE_TYPE_SPECS
    {(char *) "__dictoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_dict), READONLY, 0},
#if CYTHON_METH_FASTCALL
#if CYTHON_BACKPORT_VECTORCALL
    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_vectorcall), READONLY, 0},
#else
#if !CYTHON_COMPILING_IN_LIMITED_API
    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(PyCFunctionObject, vectorcall), READONLY, 0},
#endif
#endif
#endif
#if PY_VERSION_HEX < 0x030500A0 || CYTHON_COMPILING_IN_LIMITED_API
    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_weakreflist), READONLY, 0},
#else
    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(PyCFunctionObject, m_weakreflist), READONLY, 0},
#endif
#endif
    {0, 0, 0,  0, 0}
};
static PyObject *
__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, PyObject *args)
{
    CYTHON_UNUSED_VAR(args);
#if PY_MAJOR_VERSION >= 3
    Py_INCREF(m->func_qualname);
    return m->func_qualname;
#else
    return PyString_FromString(((PyCFunctionObject*)m)->m_ml->ml_name);
#endif
}
static PyMethodDef __pyx_CyFunction_methods[] = {
    {"__reduce__", (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
    {0, 0, 0, 0}
};
#if PY_VERSION_HEX < 0x030500A0 || CYTHON_COMPILING_IN_LIMITED_API
#define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func_weakreflist)
#else
#define __Pyx_CyFunction_weakreflist(cyfunc) (((PyCFunctionObject*)cyfunc)->m_weakreflist)
#endif
static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject *op, PyMethodDef *ml, int flags, PyObject* qualname,
                                       PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
#if !CYTHON_COMPILING_IN_LIMITED_API
    PyCFunctionObject *cf = (PyCFunctionObject*) op;
#endif
    if (unlikely(op == NULL))
        return NULL;
#if CYTHON_COMPILING_IN_LIMITED_API
    op->func = PyCFunction_NewEx(ml, (PyObject*)op, module);
    if (unlikely(!op->func)) return NULL;
#endif
    op->flags = flags;
    __Pyx_CyFunction_weakreflist(op) = NULL;
#if !CYTHON_COMPILING_IN_LIMITED_API
    cf->m_ml = ml;
    cf->m_self = (PyObject *) op;
#endif
    Py_XINCREF(closure);
    op->func_closure = closure;
#if !CYTHON_COMPILING_IN_LIMITED_API
    Py_XINCREF(module);
    cf->m_module = module;
#endif
    op->func_dict = NULL;
    op->func_name = NULL;
    Py_INCREF(qualname);
    op->func_qualname = qualname;
    op->func_doc = NULL;
#if PY_VERSION_HEX < 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
    op->func_classobj = NULL;
#else
    ((PyCMethodObject*)op)->mm_class = NULL;
#endif
    op->func_globals = globals;
    Py_INCREF(op->func_globals);
    Py_XINCREF(code);
    op->func_code = code;
    op->defaults_pyobjects = 0;
    op->defaults_size = 0;
    op->defaults = NULL;
    op->defaults_tuple = NULL;
    op->defaults_kwdict = NULL;
    op->defaults_getter = NULL;
    op->func_annotations = NULL;
    op->func_is_coroutine = NULL;
#if CYTHON_METH_FASTCALL
    switch (ml->ml_flags & (METH_VARARGS | METH_FASTCALL | METH_NOARGS | METH_O | METH_KEYWORDS | METH_METHOD)) {
    case METH_NOARGS:
        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_NOARGS;
        break;
    case METH_O:
        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_O;
        break;
    case METH_METHOD | METH_FASTCALL | METH_KEYWORDS:
        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD;
        break;
    case METH_FASTCALL | METH_KEYWORDS:
        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS;
        break;
    case METH_VARARGS | METH_KEYWORDS:
        __Pyx_CyFunction_func_vectorcall(op) = NULL;
        break;
    default:
        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
        Py_DECREF(op);
        return NULL;
    }
#endif
    return (PyObject *) op;
}
static int
__Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
{
    Py_CLEAR(m->func_closure);
#if CYTHON_COMPILING_IN_LIMITED_API
    Py_CLEAR(m->func);
#else
    Py_CLEAR(((PyCFunctionObject*)m)->m_module);
#endif
    Py_CLEAR(m->func_dict);
    Py_CLEAR(m->func_name);
    Py_CLEAR(m->func_qualname);
    Py_CLEAR(m->func_doc);
    Py_CLEAR(m->func_globals);
    Py_CLEAR(m->func_code);
#if !CYTHON_COMPILING_IN_LIMITED_API
#if PY_VERSION_HEX < 0x030900B1
    Py_CLEAR(__Pyx_CyFunction_GetClassObj(m));
#else
    {
        PyObject *cls = (PyObject*) ((PyCMethodObject *) (m))->mm_class;
        ((PyCMethodObject *) (m))->mm_class = NULL;
        Py_XDECREF(cls);
    }
#endif
#endif
    Py_CLEAR(m->defaults_tuple);
    Py_CLEAR(m->defaults_kwdict);
    Py_CLEAR(m->func_annotations);
    Py_CLEAR(m->func_is_coroutine);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_XDECREF(pydefaults[i]);
        PyObject_Free(m->defaults);
        m->defaults = NULL;
    }
    return 0;
}
static void __Pyx__CyFunction_dealloc(__pyx_CyFunctionObject *m)
{
    if (__Pyx_CyFunction_weakreflist(m) != NULL)
        PyObject_ClearWeakRefs((PyObject *) m);
    __Pyx_CyFunction_clear(m);
    __Pyx_PyHeapTypeObject_GC_Del(m);
}
static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
{
    PyObject_GC_UnTrack(m);
    __Pyx__CyFunction_dealloc(m);
}
static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
{
    Py_VISIT(m->func_closure);
#if CYTHON_COMPILING_IN_LIMITED_API
    Py_VISIT(m->func);
#else
    Py_VISIT(((PyCFunctionObject*)m)->m_module);
#endif
    Py_VISIT(m->func_dict);
    Py_VISIT(m->func_name);
    Py_VISIT(m->func_qualname);
    Py_VISIT(m->func_doc);
    Py_VISIT(m->func_globals);
    Py_VISIT(m->func_code);
#if !CYTHON_COMPILING_IN_LIMITED_API
    Py_VISIT(__Pyx_CyFunction_GetClassObj(m));
#endif
    Py_VISIT(m->defaults_tuple);
    Py_VISIT(m->defaults_kwdict);
    Py_VISIT(m->func_is_coroutine);
    if (m->defaults) {
        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
        int i;
        for (i = 0; i < m->defaults_pyobjects; i++)
            Py_VISIT(pydefaults[i]);
    }
    return 0;
}
static PyObject*
__Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
{
#if PY_MAJOR_VERSION >= 3
    return PyUnicode_FromFormat("<cyfunction %U at %p>",
                                op->func_qualname, (void *)op);
#else
    return PyString_FromFormat("<cyfunction %s at %p>",
                               PyString_AsString(op->func_qualname), (void *)op);
#endif
}
static PyObject * __Pyx_CyFunction_CallMethod(PyObject *func, PyObject *self, PyObject *arg, PyObject *kw) {
#if CYTHON_COMPILING_IN_LIMITED_API
    PyObject *f = ((__pyx_CyFunctionObject*)func)->func;
    PyObject *py_name = NULL;
    PyCFunction meth;
    int flags;
    meth = PyCFunction_GetFunction(f);
    if (unlikely(!meth)) return NULL;
    flags = PyCFunction_GetFlags(f);
    if (unlikely(flags < 0)) return NULL;
#else
    PyCFunctionObject* f = (PyCFunctionObject*)func;
    PyCFunction meth = f->m_ml->ml_meth;
    int flags = f->m_ml->ml_flags;
#endif
    Py_ssize_t size;
    switch (flags & (METH_VARARGS | METH_KEYWORDS | METH_NOARGS | METH_O)) {
    case METH_VARARGS:
        if (likely(kw == NULL || PyDict_Size(kw) == 0))
            return (*meth)(self, arg);
        break;
    case METH_VARARGS | METH_KEYWORDS:
        return (*(PyCFunctionWithKeywords)(void*)meth)(self, arg, kw);
    case METH_NOARGS:
        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
#if CYTHON_ASSUME_SAFE_MACROS
            size = PyTuple_GET_SIZE(arg);
#else
            size = PyTuple_Size(arg);
            if (unlikely(size < 0)) return NULL;
#endif
            if (likely(size == 0))
                return (*meth)(self, NULL);
#if CYTHON_COMPILING_IN_LIMITED_API
            py_name = __Pyx_CyFunction_get_name((__pyx_CyFunctionObject*)func, NULL);
            if (!py_name) return NULL;
            PyErr_Format(PyExc_TypeError,
                "%.200S() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
                py_name, size);
            Py_DECREF(py_name);
#else
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
                f->m_ml->ml_name, size);
#endif
            return NULL;
        }
        break;
    case METH_O:
        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
#if CYTHON_ASSUME_SAFE_MACROS
            size = PyTuple_GET_SIZE(arg);
#else
            size = PyTuple_Size(arg);
            if (unlikely(size < 0)) return NULL;
#endif
            if (likely(size == 1)) {
                PyObject *result, *arg0;
                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                arg0 = PyTuple_GET_ITEM(arg, 0);
                #else
                arg0 = __Pyx_PySequence_ITEM(arg, 0); if (unlikely(!arg0)) return NULL;
                #endif
                result = (*meth)(self, arg0);
                #if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
                Py_DECREF(arg0);
                #endif
                return result;
            }
#if CYTHON_COMPILING_IN_LIMITED_API
            py_name = __Pyx_CyFunction_get_name((__pyx_CyFunctionObject*)func, NULL);
            if (!py_name) return NULL;
            PyErr_Format(PyExc_TypeError,
                "%.200S() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
                py_name, size);
            Py_DECREF(py_name);
#else
            PyErr_Format(PyExc_TypeError,
                "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
                f->m_ml->ml_name, size);
#endif
            return NULL;
        }
        break;
    default:
        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
        return NULL;
    }
#if CYTHON_COMPILING_IN_LIMITED_API
    py_name = __Pyx_CyFunction_get_name((__pyx_CyFunctionObject*)func, NULL);
    if (!py_name) return NULL;
    PyErr_Format(PyExc_TypeError, "%.200S() takes no keyword arguments",
                 py_name);
    Py_DECREF(py_name);
#else
    PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
                 f->m_ml->ml_name);
#endif
    return NULL;
}
static CYTHON_INLINE PyObject *__Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
    PyObject *self, *result;
#if CYTHON_COMPILING_IN_LIMITED_API
    self = PyCFunction_GetSelf(((__pyx_CyFunctionObject*)func)->func);
    if (unlikely(!self) && PyErr_Occurred()) return NULL;
#else
    self = ((PyCFunctionObject*)func)->m_self;
#endif
    result = __Pyx_CyFunction_CallMethod(func, self, arg, kw);
    return result;
}
static PyObject *__Pyx_CyFunction_CallAsMethod(PyObject *func, PyObject *args, PyObject *kw) {
    PyObject *result;
    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *) func;
#if CYTHON_METH_FASTCALL
     __pyx_vectorcallfunc vc = __Pyx_CyFunction_func_vectorcall(cyfunc);
    if (vc) {
#if CYTHON_ASSUME_SAFE_MACROS
        return __Pyx_PyVectorcall_FastCallDict(func, vc, &PyTuple_GET_ITEM(args, 0), (size_t)PyTuple_GET_SIZE(args), kw);
#else
        (void) &__Pyx_PyVectorcall_FastCallDict;
        return PyVectorcall_Call(func, args, kw);
#endif
    }
#endif
    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
        Py_ssize_t argc;
        PyObject *new_args;
        PyObject *self;
#if CYTHON_ASSUME_SAFE_MACROS
        argc = PyTuple_GET_SIZE(args);
#else
        argc = PyTuple_Size(args);
        if (unlikely(!argc) < 0) return NULL;
#endif
        new_args = PyTuple_GetSlice(args, 1, argc);
        if (unlikely(!new_args))
            return NULL;
        self = PyTuple_GetItem(args, 0);
        if (unlikely(!self)) {
            Py_DECREF(new_args);
#if PY_MAJOR_VERSION > 2
            PyErr_Format(PyExc_TypeError,
                         "unbound method %.200S() needs an argument",
                         cyfunc->func_qualname);
#else
            PyErr_SetString(PyExc_TypeError,
                            "unbound method needs an argument");
#endif
            return NULL;
        }
        result = __Pyx_CyFunction_CallMethod(func, self, new_args, kw);
        Py_DECREF(new_args);
    } else {
        result = __Pyx_CyFunction_Call(func, args, kw);
    }
    return result;
}
#if CYTHON_METH_FASTCALL
static CYTHON_INLINE int __Pyx_CyFunction_Vectorcall_CheckArgs(__pyx_CyFunctionObject *cyfunc, Py_ssize_t nargs, PyObject *kwnames)
{
    int ret = 0;
    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
        if (unlikely(nargs < 1)) {
            PyErr_Format(PyExc_TypeError, "%.200s() needs an argument",
                         ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
            return -1;
        }
        ret = 1;
    }
    if (unlikely(kwnames) && unlikely(PyTuple_GET_SIZE(kwnames))) {
        PyErr_Format(PyExc_TypeError,
                     "%.200s() takes no keyword arguments", ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
        return -1;
    }
    return ret;
}
static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
{
    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
#if CYTHON_BACKPORT_VECTORCALL
    Py_ssize_t nargs = (Py_ssize_t)nargsf;
#else
    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
#endif
    PyObject *self;
    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
    case 1:
        self = args[0];
        args += 1;
        nargs -= 1;
        break;
    case 0:
        self = ((PyCFunctionObject*)cyfunc)->m_self;
        break;
    default:
        return NULL;
    }
    if (unlikely(nargs != 0)) {
        PyErr_Format(PyExc_TypeError,
            "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
            def->ml_name, nargs);
        return NULL;
    }
    return def->ml_meth(self, NULL);
}
static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
{
    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
#if CYTHON_BACKPORT_VECTORCALL
    Py_ssize_t nargs = (Py_ssize_t)nargsf;
#else
    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
#endif
    PyObject *self;
    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
    case 1:
        self = args[0];
        args += 1;
        nargs -= 1;
        break;
    case 0:
        self = ((PyCFunctionObject*)cyfunc)->m_self;
        break;
    default:
        return NULL;
    }
    if (unlikely(nargs != 1)) {
        PyErr_Format(PyExc_TypeError,
            "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
            def->ml_name, nargs);
        return NULL;
    }
    return def->ml_meth(self, args[0]);
}
static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
{
    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
#if CYTHON_BACKPORT_VECTORCALL
    Py_ssize_t nargs = (Py_ssize_t)nargsf;
#else
    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
#endif
    PyObject *self;
    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
    case 1:
        self = args[0];
        args += 1;
        nargs -= 1;
        break;
    case 0:
        self = ((PyCFunctionObject*)cyfunc)->m_self;
        break;
    default:
        return NULL;
    }
    return ((__Pyx_PyCFunctionFastWithKeywords)(void(*)(void))def->ml_meth)(self, args, nargs, kwnames);
}
static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
{
    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
    PyTypeObject *cls = (PyTypeObject *) __Pyx_CyFunction_GetClassObj(cyfunc);
#if CYTHON_BACKPORT_VECTORCALL
    Py_ssize_t nargs = (Py_ssize_t)nargsf;
#else
    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
#endif
    PyObject *self;
    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
    case 1:
        self = args[0];
        args += 1;
        nargs -= 1;
        break;
    case 0:
        self = ((PyCFunctionObject*)cyfunc)->m_self;
        break;
    default:
        return NULL;
    }
    return ((__Pyx_PyCMethod)(void(*)(void))def->ml_meth)(self, cls, args, (size_t)nargs, kwnames);
}
#endif
#if CYTHON_USE_TYPE_SPECS
static PyType_Slot __pyx_CyFunctionType_slots[] = {
    {Py_tp_dealloc, (void *)__Pyx_CyFunction_dealloc},
    {Py_tp_repr, (void *)__Pyx_CyFunction_repr},
    {Py_tp_call, (void *)__Pyx_CyFunction_CallAsMethod},
    {Py_tp_traverse, (void *)__Pyx_CyFunction_traverse},
    {Py_tp_clear, (void *)__Pyx_CyFunction_clear},
    {Py_tp_methods, (void *)__pyx_CyFunction_methods},
    {Py_tp_members, (void *)__pyx_CyFunction_members},
    {Py_tp_getset, (void *)__pyx_CyFunction_getsets},
    {Py_tp_descr_get, (void *)__Pyx_PyMethod_New},
    {0, 0},
};
static PyType_Spec __pyx_CyFunctionType_spec = {
    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
    sizeof(__pyx_CyFunctionObject),
    0,
#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
    Py_TPFLAGS_METHOD_DESCRIPTOR |
#endif
#if (defined(_Py_TPFLAGS_HAVE_VECTORCALL) && CYTHON_METH_FASTCALL)
    _Py_TPFLAGS_HAVE_VECTORCALL |
#endif
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
    __pyx_CyFunctionType_slots
};
#else
static PyTypeObject __pyx_CyFunctionType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
    sizeof(__pyx_CyFunctionObject),
    0,
    (destructor) __Pyx_CyFunction_dealloc,
#if !CYTHON_METH_FASTCALL
    0,
#elif CYTHON_BACKPORT_VECTORCALL
    (printfunc)offsetof(__pyx_CyFunctionObject, func_vectorcall),
#else
    offsetof(PyCFunctionObject, vectorcall),
#endif
    0,
    0,
#if PY_MAJOR_VERSION < 3
    0,
#else
    0,
#endif
    (reprfunc) __Pyx_CyFunction_repr,
    0,
    0,
    0,
    0,
    __Pyx_CyFunction_CallAsMethod,
    0,
    0,
    0,
    0,
#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
    Py_TPFLAGS_METHOD_DESCRIPTOR |
#endif
#if defined(_Py_TPFLAGS_HAVE_VECTORCALL) && CYTHON_METH_FASTCALL
    _Py_TPFLAGS_HAVE_VECTORCALL |
#endif
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
    0,
    (traverseproc) __Pyx_CyFunction_traverse,
    (inquiry) __Pyx_CyFunction_clear,
    0,
#if PY_VERSION_HEX < 0x030500A0
    offsetof(__pyx_CyFunctionObject, func_weakreflist),
#else
    offsetof(PyCFunctionObject, m_weakreflist),
#endif
    0,
    0,
    __pyx_CyFunction_methods,
    __pyx_CyFunction_members,
    __pyx_CyFunction_getsets,
    0,
    0,
    __Pyx_PyMethod_New,
    0,
    offsetof(__pyx_CyFunctionObject, func_dict),
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
#if PY_VERSION_HEX >= 0x030400a1
    0,
#endif
#if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
    0,
#endif
#if __PYX_NEED_TP_PRINT_SLOT
    0,
#endif
#if PY_VERSION_HEX >= 0x030C0000
    0,
#endif
#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
    0,
#endif
};
#endif
static int __pyx_CyFunction_init(PyObject *module) {
#if CYTHON_USE_TYPE_SPECS
    __pyx_CyFunctionType = __Pyx_FetchCommonTypeFromSpec(module, &__pyx_CyFunctionType_spec, NULL);
#else
    CYTHON_UNUSED_VAR(module);
    __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
#endif
    if (unlikely(__pyx_CyFunctionType == NULL)) {
        return -1;
    }
    return 0;
}
static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults = PyObject_Malloc(size);
    if (unlikely(!m->defaults))
        return PyErr_NoMemory();
    memset(m->defaults, 0, size);
    m->defaults_pyobjects = pyobjects;
    m->defaults_size = size;
    return m->defaults;
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *func, PyObject *tuple) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_tuple = tuple;
    Py_INCREF(tuple);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->defaults_kwdict = dict;
    Py_INCREF(dict);
}
static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *func, PyObject *dict) {
    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
    m->func_annotations = dict;
    Py_INCREF(dict);
}

/* CythonFunction */
static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml, int flags, PyObject* qualname,
                                      PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
    PyObject *op = __Pyx_CyFunction_Init(
        PyObject_GC_New(__pyx_CyFunctionObject, __pyx_CyFunctionType),
        ml, flags, qualname, closure, module, globals, code
    );
    if (likely(op)) {
        PyObject_GC_Track(op);
    }
    return op;
}

/* Import */
static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
    PyObject *module = 0;
    PyObject *empty_dict = 0;
    PyObject *empty_list = 0;
    #if PY_MAJOR_VERSION < 3
    PyObject *py_import;
    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
    if (unlikely(!py_import))
        goto bad;
    if (!from_list) {
        empty_list = PyList_New(0);
        if (unlikely(!empty_list))
            goto bad;
        from_list = empty_list;
    }
    #endif
    empty_dict = PyDict_New();
    if (unlikely(!empty_dict))
        goto bad;
    {
        #if PY_MAJOR_VERSION >= 3
        if (level == -1) {
            if (strchr(__Pyx_MODULE_NAME, '.') != NULL) {
                module = PyImport_ImportModuleLevelObject(
                    name, __pyx_d, empty_dict, from_list, 1);
                if (unlikely(!module)) {
                    if (unlikely(!PyErr_ExceptionMatches(PyExc_ImportError)))
                        goto bad;
                    PyErr_Clear();
                }
            }
            level = 0;
        }
        #endif
        if (!module) {
            #if PY_MAJOR_VERSION < 3
            PyObject *py_level = PyInt_FromLong(level);
            if (unlikely(!py_level))
                goto bad;
            module = PyObject_CallFunctionObjArgs(py_import,
                name, __pyx_d, empty_dict, from_list, py_level, (PyObject *)NULL);
            Py_DECREF(py_level);
            #else
            module = PyImport_ImportModuleLevelObject(
                name, __pyx_d, empty_dict, from_list, level);
            #endif
        }
    }
bad:
    Py_XDECREF(empty_dict);
    Py_XDECREF(empty_list);
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(py_import);
    #endif
    return module;
}

/* ImportFrom */
static PyObject* __Pyx_ImportFrom(PyObject* module, PyObject* name) {
    PyObject* value = __Pyx_PyObject_GetAttrStr(module, name);
    if (unlikely(!value) && PyErr_ExceptionMatches(PyExc_AttributeError)) {
        const char* module_name_str = 0;
        PyObject* module_name = 0;
        PyObject* module_dot = 0;
        PyObject* full_name = 0;
        PyErr_Clear();
        module_name_str = PyModule_GetName(module);
        if (unlikely(!module_name_str)) { goto modbad; }
        module_name = PyUnicode_FromString(module_name_str);
        if (unlikely(!module_name)) { goto modbad; }
        module_dot = PyUnicode_Concat(module_name, __pyx_kp_u__39);
        if (unlikely(!module_dot)) { goto modbad; }
        full_name = PyUnicode_Concat(module_dot, name);
        if (unlikely(!full_name)) { goto modbad; }
        #if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
        {
            PyObject *modules = PyImport_GetModuleDict();
            if (unlikely(!modules))
                goto modbad;
            value = PyObject_GetItem(modules, full_name);
        }
        #else
        value = PyImport_GetModule(full_name);
        #endif
      modbad:
        Py_XDECREF(full_name);
        Py_XDECREF(module_dot);
        Py_XDECREF(module_name);
    }
    if (unlikely(!value)) {
        PyErr_Format(PyExc_ImportError,
        #if PY_MAJOR_VERSION < 3
            "cannot import name %.230s", PyString_AS_STRING(name));
        #else
            "cannot import name %S", name);
        #endif
    }
    return value;
}

/* GetException */
#if CYTHON_FAST_THREAD_STATE
static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
#else
static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
#endif
{
    PyObject *local_type = NULL, *local_value, *local_tb = NULL;
#if CYTHON_FAST_THREAD_STATE
    PyObject *tmp_type, *tmp_value, *tmp_tb;
  #if PY_VERSION_HEX >= 0x030C00A6
    local_value = tstate->current_exception;
    tstate->current_exception = 0;
    if (likely(local_value)) {
        local_type = (PyObject*) Py_TYPE(local_value);
        Py_INCREF(local_type);
        local_tb = PyException_GetTraceback(local_value);
    }
  #else
    local_type = tstate->curexc_type;
    local_value = tstate->curexc_value;
    local_tb = tstate->curexc_traceback;
    tstate->curexc_type = 0;
    tstate->curexc_value = 0;
    tstate->curexc_traceback = 0;
  #endif
#else
    PyErr_Fetch(&local_type, &local_value, &local_tb);
#endif
    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
#if CYTHON_FAST_THREAD_STATE && PY_VERSION_HEX >= 0x030C00A6
    if (unlikely(tstate->current_exception))
#elif CYTHON_FAST_THREAD_STATE
    if (unlikely(tstate->curexc_type))
#else
    if (unlikely(PyErr_Occurred()))
#endif
        goto bad;
    #if PY_MAJOR_VERSION >= 3
    if (local_tb) {
        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
            goto bad;
    }
    #endif
    Py_XINCREF(local_tb);
    Py_XINCREF(local_type);
    Py_XINCREF(local_value);
    *type = local_type;
    *value = local_value;
    *tb = local_tb;
#if CYTHON_FAST_THREAD_STATE
    #if CYTHON_USE_EXC_INFO_STACK
    {
        _PyErr_StackItem *exc_info = tstate->exc_info;
      #if PY_VERSION_HEX >= 0x030B00a4
        tmp_value = exc_info->exc_value;
        exc_info->exc_value = local_value;
        tmp_type = NULL;
        tmp_tb = NULL;
        Py_XDECREF(local_type);
        Py_XDECREF(local_tb);
      #else
        tmp_type = exc_info->exc_type;
        tmp_value = exc_info->exc_value;
        tmp_tb = exc_info->exc_traceback;
        exc_info->exc_type = local_type;
        exc_info->exc_value = local_value;
        exc_info->exc_traceback = local_tb;
      #endif
    }
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = local_type;
    tstate->exc_value = local_value;
    tstate->exc_traceback = local_tb;
    #endif
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
#else
    PyErr_SetExcInfo(local_type, local_value, local_tb);
#endif
    return 0;
bad:
    *type = 0;
    *value = 0;
    *tb = 0;
    Py_XDECREF(local_type);
    Py_XDECREF(local_value);
    Py_XDECREF(local_tb);
    return -1;
}

/* pep479 */
static void __Pyx_Generator_Replace_StopIteration(int in_async_gen) {
    PyObject *exc, *val, *tb, *cur_exc;
    __Pyx_PyThreadState_declare
    #ifdef __Pyx_StopAsyncIteration_USED
    int is_async_stopiteration = 0;
    #endif
    CYTHON_MAYBE_UNUSED_VAR(in_async_gen);
    cur_exc = PyErr_Occurred();
    if (likely(!__Pyx_PyErr_GivenExceptionMatches(cur_exc, PyExc_StopIteration))) {
        #ifdef __Pyx_StopAsyncIteration_USED
        if (in_async_gen && unlikely(__Pyx_PyErr_GivenExceptionMatches(cur_exc, __Pyx_PyExc_StopAsyncIteration))) {
            is_async_stopiteration = 1;
        } else
        #endif
            return;
    }
    __Pyx_PyThreadState_assign
    __Pyx_GetException(&exc, &val, &tb);
    Py_XDECREF(exc);
    Py_XDECREF(val);
    Py_XDECREF(tb);
    PyErr_SetString(PyExc_RuntimeError,
        #ifdef __Pyx_StopAsyncIteration_USED
        is_async_stopiteration ? "async generator raised StopAsyncIteration" :
        in_async_gen ? "async generator raised StopIteration" :
        #endif
        "generator raised StopIteration");
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_FloorDivideObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
        
            if (unlikely(b == -1 && ((unsigned long)a) == 0-(unsigned long)a))
                return PyInt_Type.tp_as_number->nb_floor_divide(op1, op2);
            else {
                long q, r;
                q = a / b;
                r = a - q*b;
                q -= ((r != 0) & ((r ^ b) < 0));
                x = q;
            }
            return PyInt_FromLong(x);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op1))) {
            return __Pyx_NewRef(op1);
        }
        if (likely(__Pyx_PyLong_IsCompact(op1))) {
            a = __Pyx_PyLong_CompactValue(op1);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op1);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op1);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_floor_divide(op1, op2);
            }
        }
                {
                    long q, r;
                    q = a / b;
                    r = a - q*b;
                    q -= ((r != 0) & ((r ^ b) < 0));
                    x = q;
                }
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                {
                    PY_LONG_LONG q, r;
                    q = lla / llb;
                    r = lla - q*llb;
                    q -= ((r != 0) & ((r ^ llb) < 0));
                    llx = q;
                }
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceFloorDivide : PyNumber_FloorDivide)(op1, op2);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_MultiplyCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op2))) {
        const long a = intval;
        long b = PyInt_AS_LONG(op2);
        
#ifdef HAVE_LONG_LONG
            if (sizeof(PY_LONG_LONG) > sizeof(long)) {
                PY_LONG_LONG result = (PY_LONG_LONG)a * (PY_LONG_LONG)b;
                return (result >= LONG_MIN && result <= LONG_MAX) ?
                    PyInt_FromLong((long)result) : PyLong_FromLongLong(result);
            }
#endif
#if CYTHON_USE_TYPE_SLOTS
            return PyInt_Type.tp_as_number->nb_multiply(op1, op2);
#else
            return PyNumber_Multiply(op1, op2);
#endif
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op2))) {
        const long a = intval;
        long b, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG lla = intval;
        PY_LONG_LONG llb, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op2))) {
            return __Pyx_NewRef(op2);
        }
        if (likely(__Pyx_PyLong_IsCompact(op2))) {
            b = __Pyx_PyLong_CompactValue(op2);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op2);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op2);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT+30) {
                        b = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT+30) {
                        llb = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT+30) {
                        b = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT+30) {
                        llb = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT+30) {
                        b = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT+30) {
                        llb = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT+30) {
                        b = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT+30) {
                        llb = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT+30) {
                        b = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT+30) {
                        llb = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT+30) {
                        b = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT+30) {
                        llb = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_multiply(op1, op2);
            }
        }
                CYTHON_UNUSED_VAR(a);
                CYTHON_UNUSED_VAR(b);
                #ifdef HAVE_LONG_LONG
                llb = b;
                goto long_long;
                #else
                return PyLong_Type.tp_as_number->nb_multiply(op1, op2);
                #endif
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla * llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op2)) {
        const long a = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double b = __pyx_PyFloat_AsDouble(op2);
#else
        double b = PyFloat_AS_DOUBLE(op2);
#endif
            double result;
            
            PyFPE_START_PROTECT("multiply", return NULL)
            result = ((double)a) * (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceMultiply : PyNumber_Multiply)(op1, op2);
}
#endif

/* pynumber_float */
static CYTHON_INLINE PyObject* __Pyx__PyNumber_Float(PyObject* obj) {
    double val;
    if (PyLong_CheckExact(obj)) {
#if CYTHON_USE_PYLONG_INTERNALS
        if (likely(__Pyx_PyLong_IsCompact(obj))) {
            val = (double) __Pyx_PyLong_CompactValue(obj);
            goto no_error;
        }
#endif
        val = PyLong_AsDouble(obj);
    } else if (PyUnicode_CheckExact(obj)) {
        val = __Pyx_PyUnicode_AsDouble(obj);
    } else if (PyBytes_CheckExact(obj)) {
        val = __Pyx_PyBytes_AsDouble(obj);
    } else if (PyByteArray_CheckExact(obj)) {
        val = __Pyx_PyByteArray_AsDouble(obj);
    } else {
        return PyNumber_Float(obj);
    }
    if (unlikely(val == -1 && PyErr_Occurred())) {
        return NULL;
    }
#if CYTHON_USE_PYLONG_INTERNALS
no_error:
#endif
    return PyFloat_FromDouble(val);
}

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_SubtractObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
        
            x = (long)((unsigned long)a - (unsigned long)b);
            if (likely((x^a) >= 0 || (x^~b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op1))) {
            return PyLong_FromLong(-intval);
        }
        if (likely(__Pyx_PyLong_IsCompact(op1))) {
            a = __Pyx_PyLong_CompactValue(op1);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op1);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op1);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_subtract(op1, op2);
            }
        }
                x = a - b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla - llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
            double result;
            
            PyFPE_START_PROTECT("subtract", return NULL)
            result = ((double)a) - (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceSubtract : PyNumber_Subtract)(op1, op2);
}
#endif

/* pyfrozenset_new */
static CYTHON_INLINE PyObject* __Pyx_PyFrozenSet_New(PyObject* it) {
    if (it) {
        PyObject* result;
#if CYTHON_COMPILING_IN_PYPY
        PyObject* args;
        args = PyTuple_Pack(1, it);
        if (unlikely(!args))
            return NULL;
        result = PyObject_Call((PyObject*)&PyFrozenSet_Type, args, NULL);
        Py_DECREF(args);
        return result;
#else
        if (PyFrozenSet_CheckExact(it)) {
            Py_INCREF(it);
            return it;
        }
        result = PyFrozenSet_New(it);
        if (unlikely(!result))
            return NULL;
        if ((PY_VERSION_HEX >= 0x031000A1) || likely(PySet_GET_SIZE(result)))
            return result;
        Py_DECREF(result);
#endif
    }
#if CYTHON_USE_TYPE_SLOTS
    return PyFrozenSet_Type.tp_new(&PyFrozenSet_Type, __pyx_empty_tuple, NULL);
#else
    return PyObject_Call((PyObject*)&PyFrozenSet_Type, __pyx_empty_tuple, NULL);
#endif
}

/* PySetContains */
static int __Pyx_PySet_ContainsUnhashable(PyObject *set, PyObject *key) {
    int result = -1;
    if (PySet_Check(key) && PyErr_ExceptionMatches(PyExc_TypeError)) {
        PyObject *tmpkey;
        PyErr_Clear();
        tmpkey = __Pyx_PyFrozenSet_New(key);
        if (tmpkey != NULL) {
            result = PySet_Contains(set, tmpkey);
            Py_DECREF(tmpkey);
        }
    }
    return result;
}
static CYTHON_INLINE int __Pyx_PySet_ContainsTF(PyObject* key, PyObject* set, int eq) {
    int result = PySet_Contains(set, key);
    if (unlikely(result < 0)) {
        result = __Pyx_PySet_ContainsUnhashable(set, key);
    }
    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
}

/* PyIntCompare */
static CYTHON_INLINE int __Pyx_PyInt_BoolNeObjC(PyObject *op1, PyObject *op2, long intval, long inplace) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_UNUSED_VAR(inplace);
    if (op1 == op2) {
        return 0;
    }
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        return (a != b);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        int unequal;
        unsigned long uintval;
        Py_ssize_t size = __Pyx_PyLong_DigitCount(op1);
        const digit* digits = __Pyx_PyLong_Digits(op1);
        if (intval == 0) {
            return (__Pyx_PyLong_IsZero(op1) != 1);
        } else if (intval < 0) {
            if (__Pyx_PyLong_IsNonNeg(op1))
                return 1;
            intval = -intval;
        } else {
            if (__Pyx_PyLong_IsNeg(op1))
                return 1;
        }
        uintval = (unsigned long) intval;
#if PyLong_SHIFT * 4 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 4)) {
            unequal = (size != 5) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[4] != ((uintval >> (4 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 3 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 3)) {
            unequal = (size != 4) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[3] != ((uintval >> (3 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 2 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 2)) {
            unequal = (size != 3) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK)) | (digits[2] != ((uintval >> (2 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
#if PyLong_SHIFT * 1 < SIZEOF_LONG*8
        if (uintval >> (PyLong_SHIFT * 1)) {
            unequal = (size != 2) || (digits[0] != (uintval & (unsigned long) PyLong_MASK))
                 | (digits[1] != ((uintval >> (1 * PyLong_SHIFT)) & (unsigned long) PyLong_MASK));
        } else
#endif
            unequal = (size != 1) || (((unsigned long) digits[0]) != (uintval & (unsigned long) PyLong_MASK));
        return (unequal != 0);
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
        return ((double)a != (double)b);
    }
    return __Pyx_PyObject_IsTrueAndDecref(
        PyObject_RichCompare(op1, op2, Py_NE));
}

/* UnicodeConcatInPlace */
# if CYTHON_COMPILING_IN_CPYTHON && PY_MAJOR_VERSION >= 3
static int
__Pyx_unicode_modifiable(PyObject *unicode)
{
    if (Py_REFCNT(unicode) != 1)
        return 0;
    if (!PyUnicode_CheckExact(unicode))
        return 0;
    if (PyUnicode_CHECK_INTERNED(unicode))
        return 0;
    return 1;
}
static CYTHON_INLINE PyObject *__Pyx_PyUnicode_ConcatInPlaceImpl(PyObject **p_left, PyObject *right
        #if CYTHON_REFNANNY
        , void* __pyx_refnanny
        #endif
    ) {
    PyObject *left = *p_left;
    Py_ssize_t left_len, right_len, new_len;
    if (unlikely(__Pyx_PyUnicode_READY(left) == -1))
        return NULL;
    if (unlikely(__Pyx_PyUnicode_READY(right) == -1))
        return NULL;
    left_len = PyUnicode_GET_LENGTH(left);
    if (left_len == 0) {
        Py_INCREF(right);
        return right;
    }
    right_len = PyUnicode_GET_LENGTH(right);
    if (right_len == 0) {
        Py_INCREF(left);
        return left;
    }
    if (unlikely(left_len > PY_SSIZE_T_MAX - right_len)) {
        PyErr_SetString(PyExc_OverflowError,
                        "strings are too large to concat");
        return NULL;
    }
    new_len = left_len + right_len;
    if (__Pyx_unicode_modifiable(left)
            && PyUnicode_CheckExact(right)
            && PyUnicode_KIND(right) <= PyUnicode_KIND(left)
            && !(PyUnicode_IS_ASCII(left) && !PyUnicode_IS_ASCII(right))) {
        int ret;
        __Pyx_GIVEREF(*p_left);
        ret = PyUnicode_Resize(p_left, new_len);
        __Pyx_GOTREF(*p_left);
        if (unlikely(ret != 0))
            return NULL;
        #if PY_VERSION_HEX >= 0x030d0000
        if (unlikely(PyUnicode_CopyCharacters(*p_left, left_len, right, 0, right_len) < 0)) return NULL;
        #else
        _PyUnicode_FastCopyCharacters(*p_left, left_len, right, 0, right_len);
        #endif
        __Pyx_INCREF(*p_left);
        __Pyx_GIVEREF(*p_left);
        return *p_left;
    } else {
        return __Pyx_PyUnicode_Concat(left, right);
    }
  }
#endif

/* GetTopmostException */
#if CYTHON_USE_EXC_INFO_STACK && CYTHON_FAST_THREAD_STATE
static _PyErr_StackItem *
__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
{
    _PyErr_StackItem *exc_info = tstate->exc_info;
    while ((exc_info->exc_value == NULL || exc_info->exc_value == Py_None) &&
           exc_info->previous_item != NULL)
    {
        exc_info = exc_info->previous_item;
    }
    return exc_info;
}
#endif

/* SaveResetException */
#if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
  #if CYTHON_USE_EXC_INFO_STACK && PY_VERSION_HEX >= 0x030B00a4
    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
    PyObject *exc_value = exc_info->exc_value;
    if (exc_value == NULL || exc_value == Py_None) {
        *value = NULL;
        *type = NULL;
        *tb = NULL;
    } else {
        *value = exc_value;
        Py_INCREF(*value);
        *type = (PyObject*) Py_TYPE(exc_value);
        Py_INCREF(*type);
        *tb = PyException_GetTraceback(exc_value);
    }
  #elif CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
    *type = exc_info->exc_type;
    *value = exc_info->exc_value;
    *tb = exc_info->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
  #else
    *type = tstate->exc_type;
    *value = tstate->exc_value;
    *tb = tstate->exc_traceback;
    Py_XINCREF(*type);
    Py_XINCREF(*value);
    Py_XINCREF(*tb);
  #endif
}
static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
  #if CYTHON_USE_EXC_INFO_STACK && PY_VERSION_HEX >= 0x030B00a4
    _PyErr_StackItem *exc_info = tstate->exc_info;
    PyObject *tmp_value = exc_info->exc_value;
    exc_info->exc_value = value;
    Py_XDECREF(tmp_value);
    Py_XDECREF(type);
    Py_XDECREF(tb);
  #else
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    #if CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = tstate->exc_info;
    tmp_type = exc_info->exc_type;
    tmp_value = exc_info->exc_value;
    tmp_tb = exc_info->exc_traceback;
    exc_info->exc_type = type;
    exc_info->exc_value = value;
    exc_info->exc_traceback = tb;
    #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = type;
    tstate->exc_value = value;
    tstate->exc_traceback = tb;
    #endif
    Py_XDECREF(tmp_type);
    Py_XDECREF(tmp_value);
    Py_XDECREF(tmp_tb);
  #endif
}
#endif

/* CIntToDigits */
static const char DIGIT_PAIRS_10[2*10*10+1] = {
    "00010203040506070809"
    "10111213141516171819"
    "20212223242526272829"
    "30313233343536373839"
    "40414243444546474849"
    "50515253545556575859"
    "60616263646566676869"
    "70717273747576777879"
    "80818283848586878889"
    "90919293949596979899"
};
static const char DIGIT_PAIRS_8[2*8*8+1] = {
    "0001020304050607"
    "1011121314151617"
    "2021222324252627"
    "3031323334353637"
    "4041424344454647"
    "5051525354555657"
    "6061626364656667"
    "7071727374757677"
};
static const char DIGITS_HEX[2*16+1] = {
    "0123456789abcdef"
    "0123456789ABCDEF"
};

/* BuildPyUnicode */
static PyObject* __Pyx_PyUnicode_BuildFromAscii(Py_ssize_t ulength, char* chars, int clength,
                                                int prepend_sign, char padding_char) {
    PyObject *uval;
    Py_ssize_t uoffset = ulength - clength;
#if CYTHON_USE_UNICODE_INTERNALS
    Py_ssize_t i;
#if CYTHON_PEP393_ENABLED
    void *udata;
    uval = PyUnicode_New(ulength, 127);
    if (unlikely(!uval)) return NULL;
    udata = PyUnicode_DATA(uval);
#else
    Py_UNICODE *udata;
    uval = PyUnicode_FromUnicode(NULL, ulength);
    if (unlikely(!uval)) return NULL;
    udata = PyUnicode_AS_UNICODE(uval);
#endif
    if (uoffset > 0) {
        i = 0;
        if (prepend_sign) {
            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, 0, '-');
            i++;
        }
        for (; i < uoffset; i++) {
            __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, i, padding_char);
        }
    }
    for (i=0; i < clength; i++) {
        __Pyx_PyUnicode_WRITE(PyUnicode_1BYTE_KIND, udata, uoffset+i, chars[i]);
    }
#else
    {
        PyObject *sign = NULL, *padding = NULL;
        uval = NULL;
        if (uoffset > 0) {
            prepend_sign = !!prepend_sign;
            if (uoffset > prepend_sign) {
                padding = PyUnicode_FromOrdinal(padding_char);
                if (likely(padding) && uoffset > prepend_sign + 1) {
                    PyObject *tmp;
                    PyObject *repeat = PyInt_FromSsize_t(uoffset - prepend_sign);
                    if (unlikely(!repeat)) goto done_or_error;
                    tmp = PyNumber_Multiply(padding, repeat);
                    Py_DECREF(repeat);
                    Py_DECREF(padding);
                    padding = tmp;
                }
                if (unlikely(!padding)) goto done_or_error;
            }
            if (prepend_sign) {
                sign = PyUnicode_FromOrdinal('-');
                if (unlikely(!sign)) goto done_or_error;
            }
        }
        uval = PyUnicode_DecodeASCII(chars, clength, NULL);
        if (likely(uval) && padding) {
            PyObject *tmp = PyNumber_Add(padding, uval);
            Py_DECREF(uval);
            uval = tmp;
        }
        if (likely(uval) && sign) {
            PyObject *tmp = PyNumber_Add(sign, uval);
            Py_DECREF(uval);
            uval = tmp;
        }
done_or_error:
        Py_XDECREF(padding);
        Py_XDECREF(sign);
    }
#endif
    return uval;
}

/* CIntToPyUnicode */
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_From_Py_ssize_t(Py_ssize_t value, Py_ssize_t width, char padding_char, char format_char) {
    char digits[sizeof(Py_ssize_t)*3+2];
    char *dpos, *end = digits + sizeof(Py_ssize_t)*3+2;
    const char *hex_digits = DIGITS_HEX;
    Py_ssize_t length, ulength;
    int prepend_sign, last_one_off;
    Py_ssize_t remaining;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const Py_ssize_t neg_one = (Py_ssize_t) -1, const_zero = (Py_ssize_t) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
    if (format_char == 'X') {
        hex_digits += 16;
        format_char = 'x';
    }
    remaining = value;
    last_one_off = 0;
    dpos = end;
    do {
        int digit_pos;
        switch (format_char) {
        case 'o':
            digit_pos = abs((int)(remaining % (8*8)));
            remaining = (Py_ssize_t) (remaining / (8*8));
            dpos -= 2;
            memcpy(dpos, DIGIT_PAIRS_8 + digit_pos * 2, 2);
            last_one_off = (digit_pos < 8);
            break;
        case 'd':
            digit_pos = abs((int)(remaining % (10*10)));
            remaining = (Py_ssize_t) (remaining / (10*10));
            dpos -= 2;
            memcpy(dpos, DIGIT_PAIRS_10 + digit_pos * 2, 2);
            last_one_off = (digit_pos < 10);
            break;
        case 'x':
            *(--dpos) = hex_digits[abs((int)(remaining % 16))];
            remaining = (Py_ssize_t) (remaining / 16);
            break;
        default:
            assert(0);
            break;
        }
    } while (unlikely(remaining != 0));
    assert(!last_one_off || *dpos == '0');
    dpos += last_one_off;
    length = end - dpos;
    ulength = length;
    prepend_sign = 0;
    if (!is_unsigned && value <= neg_one) {
        if (padding_char == ' ' || width <= length + 1) {
            *(--dpos) = '-';
            ++length;
        } else {
            prepend_sign = 1;
        }
        ++ulength;
    }
    if (width > ulength) {
        ulength = width;
    }
    if (ulength == 1) {
        return PyUnicode_FromOrdinal(*dpos);
    }
    return __Pyx_PyUnicode_BuildFromAscii(ulength, dpos, (int) length, prepend_sign, padding_char);
}

/* RaiseClosureNameError */
static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname) {
    PyErr_Format(PyExc_NameError, "free variable '%s' referenced before assignment in enclosing scope", varname);
}

/* PyObjectLookupSpecial */
#if CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
static CYTHON_INLINE PyObject* __Pyx__PyObject_LookupSpecial(PyObject* obj, PyObject* attr_name, int with_error) {
    PyObject *res;
    PyTypeObject *tp = Py_TYPE(obj);
#if PY_MAJOR_VERSION < 3
    if (unlikely(PyInstance_Check(obj)))
        return with_error ? __Pyx_PyObject_GetAttrStr(obj, attr_name) : __Pyx_PyObject_GetAttrStrNoError(obj, attr_name);
#endif
    res = _PyType_Lookup(tp, attr_name);
    if (likely(res)) {
        descrgetfunc f = Py_TYPE(res)->tp_descr_get;
        if (!f) {
            Py_INCREF(res);
        } else {
            res = f(res, obj, (PyObject *)tp);
        }
    } else if (with_error) {
        PyErr_SetObject(PyExc_AttributeError, attr_name);
    }
    return res;
}
#endif

/* pyobject_as_double */
static double __Pyx__PyObject_AsDouble(PyObject* obj) {
    if (PyUnicode_CheckExact(obj)) {
        return __Pyx_PyUnicode_AsDouble(obj);
    } else if (PyBytes_CheckExact(obj)) {
        return __Pyx_PyBytes_AsDouble(obj);
    } else if (PyByteArray_CheckExact(obj)) {
        return __Pyx_PyByteArray_AsDouble(obj);
    } else {
        PyObject* float_value;
#if !CYTHON_USE_TYPE_SLOTS
        float_value = PyNumber_Float(obj);  if ((0)) goto bad;
        (void)__Pyx_PyObject_CallOneArg;
#else
        PyNumberMethods *nb = Py_TYPE(obj)->tp_as_number;
        if (likely(nb) && likely(nb->nb_float)) {
            float_value = nb->nb_float(obj);
            if (likely(float_value) && unlikely(!PyFloat_Check(float_value))) {
                __Pyx_TypeName float_value_type_name = __Pyx_PyType_GetName(Py_TYPE(float_value));
                PyErr_Format(PyExc_TypeError,
                    "__float__ returned non-float (type " __Pyx_FMT_TYPENAME ")",
                    float_value_type_name);
                __Pyx_DECREF_TypeName(float_value_type_name);
                Py_DECREF(float_value);
                goto bad;
            }
        } else {
            float_value = __Pyx_PyObject_CallOneArg((PyObject*)&PyFloat_Type, obj);
        }
#endif
        if (likely(float_value)) {
            double value = PyFloat_AS_DOUBLE(float_value);
            Py_DECREF(float_value);
            return value;
        }
    }
bad:
    return (double)-1;
}

/* UnpackUnboundCMethod */
static PyObject *__Pyx_SelflessCall(PyObject *method, PyObject *args, PyObject *kwargs) {
    PyObject *result;
    PyObject *selfless_args = PyTuple_GetSlice(args, 1, PyTuple_Size(args));
    if (unlikely(!selfless_args)) return NULL;
    result = PyObject_Call(method, selfless_args, kwargs);
    Py_DECREF(selfless_args);
    return result;
}
static PyMethodDef __Pyx_UnboundCMethod_Def = {
     "CythonUnboundCMethod",
     __PYX_REINTERPRET_FUNCION(PyCFunction, __Pyx_SelflessCall),
     METH_VARARGS | METH_KEYWORDS,
     NULL
};
static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
    PyObject *method;
    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
    if (unlikely(!method))
        return -1;
    target->method = method;
#if CYTHON_COMPILING_IN_CPYTHON
    #if PY_MAJOR_VERSION >= 3
    if (likely(__Pyx_TypeCheck(method, &PyMethodDescr_Type)))
    #else
    if (likely(!__Pyx_CyOrPyCFunction_Check(method)))
    #endif
    {
        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
        target->func = descr->d_method->ml_meth;
        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
    } else
#endif
#if CYTHON_COMPILING_IN_PYPY
#else
    if (PyCFunction_Check(method))
#endif
    {
        PyObject *self;
        int self_found;
#if CYTHON_COMPILING_IN_LIMITED_API || CYTHON_COMPILING_IN_PYPY
        self = PyObject_GetAttrString(method, "__self__");
        if (!self) {
            PyErr_Clear();
        }
#else
        self = PyCFunction_GET_SELF(method);
#endif
        self_found = (self && self != Py_None);
#if CYTHON_COMPILING_IN_LIMITED_API || CYTHON_COMPILING_IN_PYPY
        Py_XDECREF(self);
#endif
        if (self_found) {
            PyObject *unbound_method = PyCFunction_New(&__Pyx_UnboundCMethod_Def, method);
            if (unlikely(!unbound_method)) return -1;
            Py_DECREF(method);
            target->method = unbound_method;
        }
    }
    return 0;
}

/* CallUnboundCMethod1 */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
    if (likely(cfunc->func)) {
        int flag = cfunc->flag;
        if (flag == METH_O) {
            return (*(cfunc->func))(self, arg);
        } else if ((PY_VERSION_HEX >= 0x030600B1) && flag == METH_FASTCALL) {
            #if PY_VERSION_HEX >= 0x030700A0
                return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
            #else
                return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
            #endif
        } else if ((PY_VERSION_HEX >= 0x030700A0) && flag == (METH_FASTCALL | METH_KEYWORDS)) {
            return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
        }
    }
    return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
}
#endif
static PyObject* __Pyx__CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg){
    PyObject *args, *result = NULL;
    if (unlikely(!cfunc->func && !cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
#if CYTHON_COMPILING_IN_CPYTHON
    if (cfunc->func && (cfunc->flag & METH_VARARGS)) {
        args = PyTuple_New(1);
        if (unlikely(!args)) goto bad;
        Py_INCREF(arg);
        PyTuple_SET_ITEM(args, 0, arg);
        if (cfunc->flag & METH_KEYWORDS)
            result = (*(PyCFunctionWithKeywords)(void*)(PyCFunction)cfunc->func)(self, args, NULL);
        else
            result = (*cfunc->func)(self, args);
    } else {
        args = PyTuple_New(2);
        if (unlikely(!args)) goto bad;
        Py_INCREF(self);
        PyTuple_SET_ITEM(args, 0, self);
        Py_INCREF(arg);
        PyTuple_SET_ITEM(args, 1, arg);
        result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
    }
#else
    args = PyTuple_Pack(2, self, arg);
    if (unlikely(!args)) goto bad;
    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
#endif
bad:
    Py_XDECREF(args);
    return result;
}

/* PyFloatBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyFloat_TrueDivideCObj(PyObject *op1, PyObject *op2, double floatval, int inplace, int zerodivision_check) {
    const double a = floatval;
    double b, result;
    CYTHON_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    if (likely(PyFloat_CheckExact(op2))) {
#if CYTHON_COMPILING_IN_LIMITED_API
        b = __pyx_PyFloat_AsDouble(op2);
#else
        b = PyFloat_AS_DOUBLE(op2);
#endif
        if (unlikely(zerodivision_check && ((b) == 0.0))) { PyErr_SetString(PyExc_ZeroDivisionError, "float division by zero"); return NULL;}
    } else
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op2))) {
        b = (double) PyInt_AS_LONG(op2);
        if (unlikely(zerodivision_check && ((b) == 0.0))) { PyErr_SetString(PyExc_ZeroDivisionError, "float division by zero"); return NULL;}
    } else
    #endif
    if (likely(PyLong_CheckExact(op2))) {
        #if CYTHON_USE_PYLONG_INTERNALS
        if (__Pyx_PyLong_IsZero(op2)) {
            b = 0.0;
            if (unlikely(zerodivision_check && ((b) == 0.0))) { PyErr_SetString(PyExc_ZeroDivisionError, "float division by zero"); return NULL;}
        } else if (__Pyx_PyLong_IsCompact(op2)) {
            b = (double) __Pyx_PyLong_CompactValue(op2);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op2);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op2);
            switch (size) {
                case -2:
                case 2:
                    if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (1 * PyLong_SHIFT < 53))) {
                        b = (double) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        if ((8 * sizeof(unsigned long) < 53) || (2 * PyLong_SHIFT < 53) || (b < (double) ((PY_LONG_LONG)1 << 53))) {
                            if (size == -2)
                                b = -b;
                            break;
                        }
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                case 3:
                    if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (2 * PyLong_SHIFT < 53))) {
                        b = (double) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        if ((8 * sizeof(unsigned long) < 53) || (3 * PyLong_SHIFT < 53) || (b < (double) ((PY_LONG_LONG)1 << 53))) {
                            if (size == -3)
                                b = -b;
                            break;
                        }
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                case 4:
                    if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT && ((8 * sizeof(unsigned long) < 53) || (3 * PyLong_SHIFT < 53))) {
                        b = (double) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        if ((8 * sizeof(unsigned long) < 53) || (4 * PyLong_SHIFT < 53) || (b < (double) ((PY_LONG_LONG)1 << 53))) {
                            if (size == -4)
                                b = -b;
                            break;
                        }
                    }
                    CYTHON_FALLTHROUGH;
                default:
        #endif
                    b = PyLong_AsDouble(op2);
                    if (unlikely(b == -1.0 && PyErr_Occurred())) return NULL;
                    #if !CYTHON_USE_PYLONG_INTERNALS
                    if (unlikely(zerodivision_check && ((b) == 0.0))) { PyErr_SetString(PyExc_ZeroDivisionError, "float division by zero"); return NULL;}
                    #endif
        #if CYTHON_USE_PYLONG_INTERNALS
            }
        }
        #endif
    } else {
        return (inplace ? PyNumber_InPlaceTrueDivide : PyNumber_TrueDivide)(op1, op2);
    }
        PyFPE_START_PROTECT("divide", return NULL)
        result = a / b;
        PyFPE_END_PROTECT(result)
        return PyFloat_FromDouble(result);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_RemainderObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long x;
        long a = PyInt_AS_LONG(op1);
        
            x = a % b;
            x += ((x != 0) & ((x ^ b) < 0)) * b;
            return PyInt_FromLong(x);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op1))) {
            return __Pyx_NewRef(op1);
        }
        if (likely(__Pyx_PyLong_IsCompact(op1))) {
            a = __Pyx_PyLong_CompactValue(op1);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op1);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op1);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_remainder(op1, op2);
            }
        }
                x = a % b;
                x += ((x != 0) & ((x ^ b) < 0)) * b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla % llb;
                llx += ((llx != 0) & ((llx ^ llb) < 0)) * llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    return (inplace ? PyNumber_InPlaceRemainder : PyNumber_Remainder)(op1, op2);
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_MultiplyObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op1))) {
        const long b = intval;
        long a = PyInt_AS_LONG(op1);
        
#ifdef HAVE_LONG_LONG
            if (sizeof(PY_LONG_LONG) > sizeof(long)) {
                PY_LONG_LONG result = (PY_LONG_LONG)a * (PY_LONG_LONG)b;
                return (result >= LONG_MIN && result <= LONG_MAX) ?
                    PyInt_FromLong((long)result) : PyLong_FromLongLong(result);
            }
#endif
#if CYTHON_USE_TYPE_SLOTS
            return PyInt_Type.tp_as_number->nb_multiply(op1, op2);
#else
            return PyNumber_Multiply(op1, op2);
#endif
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op1))) {
        const long b = intval;
        long a, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG llb = intval;
        PY_LONG_LONG lla, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op1))) {
            return __Pyx_NewRef(op1);
        }
        if (likely(__Pyx_PyLong_IsCompact(op1))) {
            a = __Pyx_PyLong_CompactValue(op1);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op1);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op1);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT+30) {
                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT+30) {
                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT+30) {
                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT+30) {
                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT+30) {
                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT+30) {
                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT+30) {
                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT+30) {
                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT+30) {
                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT+30) {
                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT+30) {
                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT+30) {
                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_multiply(op1, op2);
            }
        }
                CYTHON_UNUSED_VAR(a);
                CYTHON_UNUSED_VAR(b);
                #ifdef HAVE_LONG_LONG
                lla = a;
                goto long_long;
                #else
                return PyLong_Type.tp_as_number->nb_multiply(op1, op2);
                #endif
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla * llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op1)) {
        const long b = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double a = __pyx_PyFloat_AsDouble(op1);
#else
        double a = PyFloat_AS_DOUBLE(op1);
#endif
            double result;
            
            PyFPE_START_PROTECT("multiply", return NULL)
            result = ((double)a) * (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceMultiply : PyNumber_Multiply)(op1, op2);
}
#endif

/* SliceTupleAndList */
#if CYTHON_COMPILING_IN_CPYTHON
static CYTHON_INLINE void __Pyx_crop_slice(Py_ssize_t* _start, Py_ssize_t* _stop, Py_ssize_t* _length) {
    Py_ssize_t start = *_start, stop = *_stop, length = *_length;
    if (start < 0) {
        start += length;
        if (start < 0)
            start = 0;
    }
    if (stop < 0)
        stop += length;
    else if (stop > length)
        stop = length;
    *_length = stop - start;
    *_start = start;
    *_stop = stop;
}
static CYTHON_INLINE PyObject* __Pyx_PyList_GetSlice(
            PyObject* src, Py_ssize_t start, Py_ssize_t stop) {
    Py_ssize_t length = PyList_GET_SIZE(src);
    __Pyx_crop_slice(&start, &stop, &length);
    if (length <= 0) {
        return PyList_New(0);
    }
    return __Pyx_PyList_FromArray(((PyListObject*)src)->ob_item + start, length);
}
static CYTHON_INLINE PyObject* __Pyx_PyTuple_GetSlice(
            PyObject* src, Py_ssize_t start, Py_ssize_t stop) {
    Py_ssize_t length = PyTuple_GET_SIZE(src);
    __Pyx_crop_slice(&start, &stop, &length);
    return __Pyx_PyTuple_FromArray(((PyTupleObject*)src)->ob_item + start, length);
}
#endif

/* MergeKeywords */
static int __Pyx_MergeKeywords(PyObject *kwdict, PyObject *source_mapping) {
    PyObject *iter, *key = NULL, *value = NULL;
    int source_is_dict, result;
    Py_ssize_t orig_length, ppos = 0;
    iter = __Pyx_dict_iterator(source_mapping, 0, __pyx_n_s_items, &orig_length, &source_is_dict);
    if (unlikely(!iter)) {
        PyObject *args;
        if (unlikely(!PyErr_ExceptionMatches(PyExc_AttributeError))) goto bad;
        PyErr_Clear();
        args = PyTuple_Pack(1, source_mapping);
        if (likely(args)) {
            PyObject *fallback = PyObject_Call((PyObject*)&PyDict_Type, args, NULL);
            Py_DECREF(args);
            if (likely(fallback)) {
                iter = __Pyx_dict_iterator(fallback, 1, __pyx_n_s_items, &orig_length, &source_is_dict);
                Py_DECREF(fallback);
            }
        }
        if (unlikely(!iter)) goto bad;
    }
    while (1) {
        result = __Pyx_dict_iter_next(iter, orig_length, &ppos, &key, &value, NULL, source_is_dict);
        if (unlikely(result < 0)) goto bad;
        if (!result) break;
        if (unlikely(PyDict_Contains(kwdict, key))) {
            __Pyx_RaiseDoubleKeywordsError("function", key);
            result = -1;
        } else {
            result = PyDict_SetItem(kwdict, key, value);
        }
        Py_DECREF(key);
        Py_DECREF(value);
        if (unlikely(result < 0)) goto bad;
    }
    Py_XDECREF(iter);
    return 0;
bad:
    Py_XDECREF(iter);
    return -1;
}

/* PyUnicode_Unicode */
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_Unicode(PyObject *obj) {
    if (unlikely(obj == Py_None))
        obj = __pyx_kp_u_None;
    return __Pyx_NewRef(obj);
}

/* CallUnboundCMethod0 */
static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self) {
    PyObject *args, *result = NULL;
    if (unlikely(!cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
#if CYTHON_ASSUME_SAFE_MACROS
    args = PyTuple_New(1);
    if (unlikely(!args)) goto bad;
    Py_INCREF(self);
    PyTuple_SET_ITEM(args, 0, self);
#else
    args = PyTuple_Pack(1, self);
    if (unlikely(!args)) goto bad;
#endif
    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
    Py_DECREF(args);
bad:
    return result;
}

/* py_abs */
#if CYTHON_USE_PYLONG_INTERNALS
static PyObject *__Pyx_PyLong_AbsNeg(PyObject *n) {
#if PY_VERSION_HEX >= 0x030C00A7
    if (likely(__Pyx_PyLong_IsCompact(n))) {
        return PyLong_FromSize_t(__Pyx_PyLong_CompactValueUnsigned(n));
    }
#else
    if (likely(Py_SIZE(n) == -1)) {
        return PyLong_FromUnsignedLong(__Pyx_PyLong_Digits(n)[0]);
    }
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030d0000
    {
        PyObject *copy = _PyLong_Copy((PyLongObject*)n);
        if (likely(copy)) {
            #if PY_VERSION_HEX >= 0x030C00A7
            ((PyLongObject*)copy)->long_value.lv_tag = ((PyLongObject*)copy)->long_value.lv_tag & ~_PyLong_SIGN_MASK;
            #else
            __Pyx_SET_SIZE(copy, -Py_SIZE(copy));
            #endif
        }
        return copy;
    }
#else
    return PyNumber_Negative(n);
#endif
}
#endif

/* PyIntBinop */
#if !CYTHON_COMPILING_IN_PYPY
static PyObject* __Pyx_PyInt_AddCObj(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check) {
    CYTHON_MAYBE_UNUSED_VAR(intval);
    CYTHON_MAYBE_UNUSED_VAR(inplace);
    CYTHON_UNUSED_VAR(zerodivision_check);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyInt_CheckExact(op2))) {
        const long a = intval;
        long x;
        long b = PyInt_AS_LONG(op2);
        
            x = (long)((unsigned long)a + (unsigned long)b);
            if (likely((x^a) >= 0 || (x^b) >= 0))
                return PyInt_FromLong(x);
            return PyLong_Type.tp_as_number->nb_add(op1, op2);
    }
    #endif
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(PyLong_CheckExact(op2))) {
        const long a = intval;
        long b, x;
#ifdef HAVE_LONG_LONG
        const PY_LONG_LONG lla = intval;
        PY_LONG_LONG llb, llx;
#endif
        if (unlikely(__Pyx_PyLong_IsZero(op2))) {
            return __Pyx_NewRef(op1);
        }
        if (likely(__Pyx_PyLong_IsCompact(op2))) {
            b = __Pyx_PyLong_CompactValue(op2);
        } else {
            const digit* digits = __Pyx_PyLong_Digits(op2);
            const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(op2);
            switch (size) {
                case -2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        b = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 2:
                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
                        b = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        b = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 3:
                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
                        b = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case -4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        b = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        llb = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                case 4:
                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
                        b = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
                        break;
                    #ifdef HAVE_LONG_LONG
                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
                        llb = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
                        goto long_long;
                    #endif
                    }
                    CYTHON_FALLTHROUGH;
                default: return PyLong_Type.tp_as_number->nb_add(op1, op2);
            }
        }
                x = a + b;
            return PyLong_FromLong(x);
#ifdef HAVE_LONG_LONG
        long_long:
                llx = lla + llb;
            return PyLong_FromLongLong(llx);
#endif
        
        
    }
    #endif
    if (PyFloat_CheckExact(op2)) {
        const long a = intval;
#if CYTHON_COMPILING_IN_LIMITED_API
        double b = __pyx_PyFloat_AsDouble(op2);
#else
        double b = PyFloat_AS_DOUBLE(op2);
#endif
            double result;
            
            PyFPE_START_PROTECT("add", return NULL)
            result = ((double)a) + (double)b;
            PyFPE_END_PROTECT(result)
            return PyFloat_FromDouble(result);
    }
    return (inplace ? PyNumber_InPlaceAdd : PyNumber_Add)(op1, op2);
}
#endif

/* ValidateBasesTuple */
#if CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_LIMITED_API || CYTHON_USE_TYPE_SPECS
static int __Pyx_validate_bases_tuple(const char *type_name, Py_ssize_t dictoffset, PyObject *bases) {
    Py_ssize_t i, n;
#if CYTHON_ASSUME_SAFE_MACROS
    n = PyTuple_GET_SIZE(bases);
#else
    n = PyTuple_Size(bases);
    if (n < 0) return -1;
#endif
    for (i = 1; i < n; i++)
    {
#if CYTHON_AVOID_BORROWED_REFS
        PyObject *b0 = PySequence_GetItem(bases, i);
        if (!b0) return -1;
#elif CYTHON_ASSUME_SAFE_MACROS
        PyObject *b0 = PyTuple_GET_ITEM(bases, i);
#else
        PyObject *b0 = PyTuple_GetItem(bases, i);
        if (!b0) return -1;
#endif
        PyTypeObject *b;
#if PY_MAJOR_VERSION < 3
        if (PyClass_Check(b0))
        {
            PyErr_Format(PyExc_TypeError, "base class '%.200s' is an old-style class",
                         PyString_AS_STRING(((PyClassObject*)b0)->cl_name));
#if CYTHON_AVOID_BORROWED_REFS
            Py_DECREF(b0);
#endif
            return -1;
        }
#endif
        b = (PyTypeObject*) b0;
        if (!__Pyx_PyType_HasFeature(b, Py_TPFLAGS_HEAPTYPE))
        {
            __Pyx_TypeName b_name = __Pyx_PyType_GetName(b);
            PyErr_Format(PyExc_TypeError,
                "base class '" __Pyx_FMT_TYPENAME "' is not a heap type", b_name);
            __Pyx_DECREF_TypeName(b_name);
#if CYTHON_AVOID_BORROWED_REFS
            Py_DECREF(b0);
#endif
            return -1;
        }
        if (dictoffset == 0)
        {
            Py_ssize_t b_dictoffset = 0;
#if CYTHON_USE_TYPE_SLOTS || CYTHON_COMPILING_IN_PYPY
            b_dictoffset = b->tp_dictoffset;
#else
            PyObject *py_b_dictoffset = PyObject_GetAttrString((PyObject*)b, "__dictoffset__");
            if (!py_b_dictoffset) goto dictoffset_return;
            b_dictoffset = PyLong_AsSsize_t(py_b_dictoffset);
            Py_DECREF(py_b_dictoffset);
            if (b_dictoffset == -1 && PyErr_Occurred()) goto dictoffset_return;
#endif
            if (b_dictoffset) {
                {
                    __Pyx_TypeName b_name = __Pyx_PyType_GetName(b);
                    PyErr_Format(PyExc_TypeError,
                        "extension type '%.200s' has no __dict__ slot, "
                        "but base type '" __Pyx_FMT_TYPENAME "' has: "
                        "either add 'cdef dict __dict__' to the extension type "
                        "or add '__slots__ = [...]' to the base type",
                        type_name, b_name);
                    __Pyx_DECREF_TypeName(b_name);
                }
#if !(CYTHON_USE_TYPE_SLOTS || CYTHON_COMPILING_IN_PYPY)
              dictoffset_return:
#endif
#if CYTHON_AVOID_BORROWED_REFS
                Py_DECREF(b0);
#endif
                return -1;
            }
        }
#if CYTHON_AVOID_BORROWED_REFS
        Py_DECREF(b0);
#endif
    }
    return 0;
}
#endif

/* PyType_Ready */
static int __Pyx_PyType_Ready(PyTypeObject *t) {
#if CYTHON_USE_TYPE_SPECS || !(CYTHON_COMPILING_IN_CPYTHON || CYTHON_COMPILING_IN_LIMITED_API) || defined(PYSTON_MAJOR_VERSION)
    (void)__Pyx_PyObject_CallMethod0;
#if CYTHON_USE_TYPE_SPECS
    (void)__Pyx_validate_bases_tuple;
#endif
    return PyType_Ready(t);
#else
    int r;
    PyObject *bases = __Pyx_PyType_GetSlot(t, tp_bases, PyObject*);
    if (bases && unlikely(__Pyx_validate_bases_tuple(t->tp_name, t->tp_dictoffset, bases) == -1))
        return -1;
#if PY_VERSION_HEX >= 0x03050000 && !defined(PYSTON_MAJOR_VERSION)
    {
        int gc_was_enabled;
    #if PY_VERSION_HEX >= 0x030A00b1
        gc_was_enabled = PyGC_Disable();
        (void)__Pyx_PyObject_CallMethod0;
    #else
        PyObject *ret, *py_status;
        PyObject *gc = NULL;
        #if PY_VERSION_HEX >= 0x030700a1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM+0 >= 0x07030400)
        gc = PyImport_GetModule(__pyx_kp_u_gc);
        #endif
        if (unlikely(!gc)) gc = PyImport_Import(__pyx_kp_u_gc);
        if (unlikely(!gc)) return -1;
        py_status = __Pyx_PyObject_CallMethod0(gc, __pyx_kp_u_isenabled);
        if (unlikely(!py_status)) {
            Py_DECREF(gc);
            return -1;
        }
        gc_was_enabled = __Pyx_PyObject_IsTrue(py_status);
        Py_DECREF(py_status);
        if (gc_was_enabled > 0) {
            ret = __Pyx_PyObject_CallMethod0(gc, __pyx_kp_u_disable);
            if (unlikely(!ret)) {
                Py_DECREF(gc);
                return -1;
            }
            Py_DECREF(ret);
        } else if (unlikely(gc_was_enabled == -1)) {
            Py_DECREF(gc);
            return -1;
        }
    #endif
        t->tp_flags |= Py_TPFLAGS_HEAPTYPE;
#if PY_VERSION_HEX >= 0x030A0000
        t->tp_flags |= Py_TPFLAGS_IMMUTABLETYPE;
#endif
#else
        (void)__Pyx_PyObject_CallMethod0;
#endif
    r = PyType_Ready(t);
#if PY_VERSION_HEX >= 0x03050000 && !defined(PYSTON_MAJOR_VERSION)
        t->tp_flags &= ~Py_TPFLAGS_HEAPTYPE;
    #if PY_VERSION_HEX >= 0x030A00b1
        if (gc_was_enabled)
            PyGC_Enable();
    #else
        if (gc_was_enabled) {
            PyObject *tp, *v, *tb;
            PyErr_Fetch(&tp, &v, &tb);
            ret = __Pyx_PyObject_CallMethod0(gc, __pyx_kp_u_enable);
            if (likely(ret || r == -1)) {
                Py_XDECREF(ret);
                PyErr_Restore(tp, v, tb);
            } else {
                Py_XDECREF(tp);
                Py_XDECREF(v);
                Py_XDECREF(tb);
                r = -1;
            }
        }
        Py_DECREF(gc);
    #endif
    }
#endif
    return r;
#endif
}

/* PyObject_GenericGetAttrNoDict */
#if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
static PyObject *__Pyx_RaiseGenericGetAttributeError(PyTypeObject *tp, PyObject *attr_name) {
    __Pyx_TypeName type_name = __Pyx_PyType_GetName(tp);
    PyErr_Format(PyExc_AttributeError,
#if PY_MAJOR_VERSION >= 3
                 "'" __Pyx_FMT_TYPENAME "' object has no attribute '%U'",
                 type_name, attr_name);
#else
                 "'" __Pyx_FMT_TYPENAME "' object has no attribute '%.400s'",
                 type_name, PyString_AS_STRING(attr_name));
#endif
    __Pyx_DECREF_TypeName(type_name);
    return NULL;
}
static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name) {
    PyObject *descr;
    PyTypeObject *tp = Py_TYPE(obj);
    if (unlikely(!PyString_Check(attr_name))) {
        return PyObject_GenericGetAttr(obj, attr_name);
    }
    assert(!tp->tp_dictoffset);
    descr = _PyType_Lookup(tp, attr_name);
    if (unlikely(!descr)) {
        return __Pyx_RaiseGenericGetAttributeError(tp, attr_name);
    }
    Py_INCREF(descr);
    #if PY_MAJOR_VERSION < 3
    if (likely(PyType_HasFeature(Py_TYPE(descr), Py_TPFLAGS_HAVE_CLASS)))
    #endif
    {
        descrgetfunc f = Py_TYPE(descr)->tp_descr_get;
        if (unlikely(f)) {
            PyObject *res = f(descr, obj, (PyObject *)tp);
            Py_DECREF(descr);
            return res;
        }
    }
    return descr;
}
#endif

/* ImportDottedModule */
#if PY_MAJOR_VERSION >= 3
static PyObject *__Pyx__ImportDottedModule_Error(PyObject *name, PyObject *parts_tuple, Py_ssize_t count) {
    PyObject *partial_name = NULL, *slice = NULL, *sep = NULL;
    if (unlikely(PyErr_Occurred())) {
        PyErr_Clear();
    }
    if (likely(PyTuple_GET_SIZE(parts_tuple) == count)) {
        partial_name = name;
    } else {
        slice = PySequence_GetSlice(parts_tuple, 0, count);
        if (unlikely(!slice))
            goto bad;
        sep = PyUnicode_FromStringAndSize(".", 1);
        if (unlikely(!sep))
            goto bad;
        partial_name = PyUnicode_Join(sep, slice);
    }
    PyErr_Format(
#if PY_MAJOR_VERSION < 3
        PyExc_ImportError,
        "No module named '%s'", PyString_AS_STRING(partial_name));
#else
#if PY_VERSION_HEX >= 0x030600B1
        PyExc_ModuleNotFoundError,
#else
        PyExc_ImportError,
#endif
        "No module named '%U'", partial_name);
#endif
bad:
    Py_XDECREF(sep);
    Py_XDECREF(slice);
    Py_XDECREF(partial_name);
    return NULL;
}
#endif
#if PY_MAJOR_VERSION >= 3
static PyObject *__Pyx__ImportDottedModule_Lookup(PyObject *name) {
    PyObject *imported_module;
#if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
    PyObject *modules = PyImport_GetModuleDict();
    if (unlikely(!modules))
        return NULL;
    imported_module = __Pyx_PyDict_GetItemStr(modules, name);
    Py_XINCREF(imported_module);
#else
    imported_module = PyImport_GetModule(name);
#endif
    return imported_module;
}
#endif
#if PY_MAJOR_VERSION >= 3
static PyObject *__Pyx_ImportDottedModule_WalkParts(PyObject *module, PyObject *name, PyObject *parts_tuple) {
    Py_ssize_t i, nparts;
    nparts = PyTuple_GET_SIZE(parts_tuple);
    for (i=1; i < nparts && module; i++) {
        PyObject *part, *submodule;
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
        part = PyTuple_GET_ITEM(parts_tuple, i);
#else
        part = PySequence_ITEM(parts_tuple, i);
#endif
        submodule = __Pyx_PyObject_GetAttrStrNoError(module, part);
#if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
        Py_DECREF(part);
#endif
        Py_DECREF(module);
        module = submodule;
    }
    if (unlikely(!module)) {
        return __Pyx__ImportDottedModule_Error(name, parts_tuple, i);
    }
    return module;
}
#endif
static PyObject *__Pyx__ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
#if PY_MAJOR_VERSION < 3
    PyObject *module, *from_list, *star = __pyx_n_s__70;
    CYTHON_UNUSED_VAR(parts_tuple);
    from_list = PyList_New(1);
    if (unlikely(!from_list))
        return NULL;
    Py_INCREF(star);
    PyList_SET_ITEM(from_list, 0, star);
    module = __Pyx_Import(name, from_list, 0);
    Py_DECREF(from_list);
    return module;
#else
    PyObject *imported_module;
    PyObject *module = __Pyx_Import(name, NULL, 0);
    if (!parts_tuple || unlikely(!module))
        return module;
    imported_module = __Pyx__ImportDottedModule_Lookup(name);
    if (likely(imported_module)) {
        Py_DECREF(module);
        return imported_module;
    }
    PyErr_Clear();
    return __Pyx_ImportDottedModule_WalkParts(module, name, parts_tuple);
#endif
}
static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030400B1
    PyObject *module = __Pyx__ImportDottedModule_Lookup(name);
    if (likely(module)) {
        PyObject *spec = __Pyx_PyObject_GetAttrStrNoError(module, __pyx_n_s_spec);
        if (likely(spec)) {
            PyObject *unsafe = __Pyx_PyObject_GetAttrStrNoError(spec, __pyx_n_s_initializing);
            if (likely(!unsafe || !__Pyx_PyObject_IsTrue(unsafe))) {
                Py_DECREF(spec);
                spec = NULL;
            }
            Py_XDECREF(unsafe);
        }
        if (likely(!spec)) {
            PyErr_Clear();
            return module;
        }
        Py_DECREF(spec);
        Py_DECREF(module);
    } else if (PyErr_Occurred()) {
        PyErr_Clear();
    }
#endif
    return __Pyx__ImportDottedModule(name, parts_tuple);
}

/* PatchModuleWithCoroutine */
static PyObject* __Pyx_Coroutine_patch_module(PyObject* module, const char* py_code) {
#if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
    int result;
    PyObject *globals, *result_obj;
    globals = PyDict_New();  if (unlikely(!globals)) goto ignore;
    result = PyDict_SetItemString(globals, "_cython_coroutine_type",
    #ifdef __Pyx_Coroutine_USED
        (PyObject*)__pyx_CoroutineType);
    #else
        Py_None);
    #endif
    if (unlikely(result < 0)) goto ignore;
    result = PyDict_SetItemString(globals, "_cython_generator_type",
    #ifdef __Pyx_Generator_USED
        (PyObject*)__pyx_GeneratorType);
    #else
        Py_None);
    #endif
    if (unlikely(result < 0)) goto ignore;
    if (unlikely(PyDict_SetItemString(globals, "_module", module) < 0)) goto ignore;
    if (unlikely(PyDict_SetItemString(globals, "__builtins__", __pyx_b) < 0)) goto ignore;
    result_obj = PyRun_String(py_code, Py_file_input, globals, globals);
    if (unlikely(!result_obj)) goto ignore;
    Py_DECREF(result_obj);
    Py_DECREF(globals);
    return module;
ignore:
    Py_XDECREF(globals);
    PyErr_WriteUnraisable(module);
    if (unlikely(PyErr_WarnEx(PyExc_RuntimeWarning, "Cython module failed to patch module with custom type", 1) < 0)) {
        Py_DECREF(module);
        module = NULL;
    }
#else
    py_code++;
#endif
    return module;
}

/* PatchInspect */
static PyObject* __Pyx_patch_inspect(PyObject* module) {
#if defined(__Pyx_Generator_USED) && (!defined(CYTHON_PATCH_INSPECT) || CYTHON_PATCH_INSPECT)
    static int inspect_patched = 0;
    if (unlikely((!inspect_patched) && module)) {
        module = __Pyx_Coroutine_patch_module(
            module, ""
"old_types = getattr(_module.isgenerator, '_cython_generator_types', None)\n"
"if old_types is None or not isinstance(old_types, set):\n"
"    old_types = set()\n"
"    def cy_wrap(orig_func, type=type, cython_generator_types=old_types):\n"
"        def cy_isgenerator(obj): return type(obj) in cython_generator_types or orig_func(obj)\n"
"        cy_isgenerator._cython_generator_types = cython_generator_types\n"
"        return cy_isgenerator\n"
"    _module.isgenerator = cy_wrap(_module.isgenerator)\n"
"old_types.add(_cython_generator_type)\n"
        );
        inspect_patched = 1;
    }
#else
    if ((0)) return __Pyx_Coroutine_patch_module(module, NULL);
#endif
    return module;
}

/* CLineInTraceback */
#ifndef CYTHON_CLINE_IN_TRACEBACK
static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line) {
    PyObject *use_cline;
    PyObject *ptype, *pvalue, *ptraceback;
#if CYTHON_COMPILING_IN_CPYTHON
    PyObject **cython_runtime_dict;
#endif
    CYTHON_MAYBE_UNUSED_VAR(tstate);
    if (unlikely(!__pyx_cython_runtime)) {
        return c_line;
    }
    __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
#if CYTHON_COMPILING_IN_CPYTHON
    cython_runtime_dict = _PyObject_GetDictPtr(__pyx_cython_runtime);
    if (likely(cython_runtime_dict)) {
        __PYX_PY_DICT_LOOKUP_IF_MODIFIED(
            use_cline, *cython_runtime_dict,
            __Pyx_PyDict_GetItemStr(*cython_runtime_dict, __pyx_n_s_cline_in_traceback))
    } else
#endif
    {
      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStrNoError(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
      if (use_cline_obj) {
        use_cline = PyObject_Not(use_cline_obj) ? Py_False : Py_True;
        Py_DECREF(use_cline_obj);
      } else {
        PyErr_Clear();
        use_cline = NULL;
      }
    }
    if (!use_cline) {
        c_line = 0;
        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
    }
    else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
        c_line = 0;
    }
    __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
    return c_line;
}
#endif

/* CodeObjectCache */
#if !CYTHON_COMPILING_IN_LIMITED_API
static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
    int start = 0, mid = 0, end = count - 1;
    if (end >= 0 && code_line > entries[end].code_line) {
        return count;
    }
    while (start < end) {
        mid = start + (end - start) / 2;
        if (code_line < entries[mid].code_line) {
            end = mid;
        } else if (code_line > entries[mid].code_line) {
             start = mid + 1;
        } else {
            return mid;
        }
    }
    if (code_line <= entries[mid].code_line) {
        return mid;
    } else {
        return mid + 1;
    }
}
static PyCodeObject *__pyx_find_code_object(int code_line) {
    PyCodeObject* code_object;
    int pos;
    if (unlikely(!code_line) || unlikely(!__pyx_code_cache.entries)) {
        return NULL;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if (unlikely(pos >= __pyx_code_cache.count) || unlikely(__pyx_code_cache.entries[pos].code_line != code_line)) {
        return NULL;
    }
    code_object = __pyx_code_cache.entries[pos].code_object;
    Py_INCREF(code_object);
    return code_object;
}
static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object) {
    int pos, i;
    __Pyx_CodeObjectCacheEntry* entries = __pyx_code_cache.entries;
    if (unlikely(!code_line)) {
        return;
    }
    if (unlikely(!entries)) {
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Malloc(64*sizeof(__Pyx_CodeObjectCacheEntry));
        if (likely(entries)) {
            __pyx_code_cache.entries = entries;
            __pyx_code_cache.max_count = 64;
            __pyx_code_cache.count = 1;
            entries[0].code_line = code_line;
            entries[0].code_object = code_object;
            Py_INCREF(code_object);
        }
        return;
    }
    pos = __pyx_bisect_code_objects(__pyx_code_cache.entries, __pyx_code_cache.count, code_line);
    if ((pos < __pyx_code_cache.count) && unlikely(__pyx_code_cache.entries[pos].code_line == code_line)) {
        PyCodeObject* tmp = entries[pos].code_object;
        entries[pos].code_object = code_object;
        Py_DECREF(tmp);
        return;
    }
    if (__pyx_code_cache.count == __pyx_code_cache.max_count) {
        int new_max = __pyx_code_cache.max_count + 64;
        entries = (__Pyx_CodeObjectCacheEntry*)PyMem_Realloc(
            __pyx_code_cache.entries, ((size_t)new_max) * sizeof(__Pyx_CodeObjectCacheEntry));
        if (unlikely(!entries)) {
            return;
        }
        __pyx_code_cache.entries = entries;
        __pyx_code_cache.max_count = new_max;
    }
    for (i=__pyx_code_cache.count; i>pos; i--) {
        entries[i] = entries[i-1];
    }
    entries[pos].code_line = code_line;
    entries[pos].code_object = code_object;
    __pyx_code_cache.count++;
    Py_INCREF(code_object);
}
#endif

/* AddTraceback */
#include "compile.h"
#include "frameobject.h"
#include "traceback.h"
#if PY_VERSION_HEX >= 0x030b00a6 && !CYTHON_COMPILING_IN_LIMITED_API
  #ifndef Py_BUILD_CORE
    #define Py_BUILD_CORE 1
  #endif
  #include "internal/pycore_frame.h"
#endif
#if CYTHON_COMPILING_IN_LIMITED_API
static PyObject *__Pyx_PyCode_Replace_For_AddTraceback(PyObject *code, PyObject *scratch_dict,
                                                       PyObject *firstlineno, PyObject *name) {
    PyObject *replace = NULL;
    if (unlikely(PyDict_SetItemString(scratch_dict, "co_firstlineno", firstlineno))) return NULL;
    if (unlikely(PyDict_SetItemString(scratch_dict, "co_name", name))) return NULL;
    replace = PyObject_GetAttrString(code, "replace");
    if (likely(replace)) {
        PyObject *result;
        result = PyObject_Call(replace, __pyx_empty_tuple, scratch_dict);
        Py_DECREF(replace);
        return result;
    }
    PyErr_Clear();
    #if __PYX_LIMITED_VERSION_HEX < 0x030780000
    {
        PyObject *compiled = NULL, *result = NULL;
        if (unlikely(PyDict_SetItemString(scratch_dict, "code", code))) return NULL;
        if (unlikely(PyDict_SetItemString(scratch_dict, "type", (PyObject*)(&PyType_Type)))) return NULL;
        compiled = Py_CompileString(
            "out = type(code)(\n"
            "  code.co_argcount, code.co_kwonlyargcount, code.co_nlocals, code.co_stacksize,\n"
            "  code.co_flags, code.co_code, code.co_consts, code.co_names,\n"
            "  code.co_varnames, code.co_filename, co_name, co_firstlineno,\n"
            "  code.co_lnotab)\n", "<dummy>", Py_file_input);
        if (!compiled) return NULL;
        result = PyEval_EvalCode(compiled, scratch_dict, scratch_dict);
        Py_DECREF(compiled);
        if (!result) PyErr_Print();
        Py_DECREF(result);
        result = PyDict_GetItemString(scratch_dict, "out");
        if (result) Py_INCREF(result);
        return result;
    }
    #else
    return NULL;
    #endif
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyObject *code_object = NULL, *py_py_line = NULL, *py_funcname = NULL, *dict = NULL;
    PyObject *replace = NULL, *getframe = NULL, *frame = NULL;
    PyObject *exc_type, *exc_value, *exc_traceback;
    int success = 0;
    if (c_line) {
        (void) __pyx_cfilenm;
        (void) __Pyx_CLineForTraceback(__Pyx_PyThreadState_Current, c_line);
    }
    PyErr_Fetch(&exc_type, &exc_value, &exc_traceback);
    code_object = Py_CompileString("_getframe()", filename, Py_eval_input);
    if (unlikely(!code_object)) goto bad;
    py_py_line = PyLong_FromLong(py_line);
    if (unlikely(!py_py_line)) goto bad;
    py_funcname = PyUnicode_FromString(funcname);
    if (unlikely(!py_funcname)) goto bad;
    dict = PyDict_New();
    if (unlikely(!dict)) goto bad;
    {
        PyObject *old_code_object = code_object;
        code_object = __Pyx_PyCode_Replace_For_AddTraceback(code_object, dict, py_py_line, py_funcname);
        Py_DECREF(old_code_object);
    }
    if (unlikely(!code_object)) goto bad;
    getframe = PySys_GetObject("_getframe");
    if (unlikely(!getframe)) goto bad;
    if (unlikely(PyDict_SetItemString(dict, "_getframe", getframe))) goto bad;
    frame = PyEval_EvalCode(code_object, dict, dict);
    if (unlikely(!frame) || frame == Py_None) goto bad;
    success = 1;
  bad:
    PyErr_Restore(exc_type, exc_value, exc_traceback);
    Py_XDECREF(code_object);
    Py_XDECREF(py_py_line);
    Py_XDECREF(py_funcname);
    Py_XDECREF(dict);
    Py_XDECREF(replace);
    if (success) {
        PyTraceBack_Here(
            (struct _frame*)frame);
    }
    Py_XDECREF(frame);
}
#else
static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
            const char *funcname, int c_line,
            int py_line, const char *filename) {
    PyCodeObject *py_code = NULL;
    PyObject *py_funcname = NULL;
    #if PY_MAJOR_VERSION < 3
    PyObject *py_srcfile = NULL;
    py_srcfile = PyString_FromString(filename);
    if (!py_srcfile) goto bad;
    #endif
    if (c_line) {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        if (!py_funcname) goto bad;
        #else
        py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
        if (!py_funcname) goto bad;
        funcname = PyUnicode_AsUTF8(py_funcname);
        if (!funcname) goto bad;
        #endif
    }
    else {
        #if PY_MAJOR_VERSION < 3
        py_funcname = PyString_FromString(funcname);
        if (!py_funcname) goto bad;
        #endif
    }
    #if PY_MAJOR_VERSION < 3
    py_code = __Pyx_PyCode_New(
        0,
        0,
        0,
        0,
        0,
        0,
        __pyx_empty_bytes, /*PyObject *code,*/
        __pyx_empty_tuple, /*PyObject *consts,*/
        __pyx_empty_tuple, /*PyObject *names,*/
        __pyx_empty_tuple, /*PyObject *varnames,*/
        __pyx_empty_tuple, /*PyObject *freevars,*/
        __pyx_empty_tuple, /*PyObject *cellvars,*/
        py_srcfile,   /*PyObject *filename,*/
        py_funcname,  /*PyObject *name,*/
        py_line,
        __pyx_empty_bytes  /*PyObject *lnotab*/
    );
    Py_DECREF(py_srcfile);
    #else
    py_code = PyCode_NewEmpty(filename, funcname, py_line);
    #endif
    Py_XDECREF(py_funcname);
    return py_code;
bad:
    Py_XDECREF(py_funcname);
    #if PY_MAJOR_VERSION < 3
    Py_XDECREF(py_srcfile);
    #endif
    return NULL;
}
static void __Pyx_AddTraceback(const char *funcname, int c_line,
                               int py_line, const char *filename) {
    PyCodeObject *py_code = 0;
    PyFrameObject *py_frame = 0;
    PyThreadState *tstate = __Pyx_PyThreadState_Current;
    PyObject *ptype, *pvalue, *ptraceback;
    if (c_line) {
        c_line = __Pyx_CLineForTraceback(tstate, c_line);
    }
    py_code = __pyx_find_code_object(c_line ? -c_line : py_line);
    if (!py_code) {
        __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
        py_code = __Pyx_CreateCodeObjectForTraceback(
            funcname, c_line, py_line, filename);
        if (!py_code) {
            /* If the code object creation fails, then we should clear the
               fetched exception references and propagate the new exception */
            Py_XDECREF(ptype);
            Py_XDECREF(pvalue);
            Py_XDECREF(ptraceback);
            goto bad;
        }
        __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
        __pyx_insert_code_object(c_line ? -c_line : py_line, py_code);
    }
    py_frame = PyFrame_New(
        tstate,            /*PyThreadState *tstate,*/
        py_code,           /*PyCodeObject *code,*/
        __pyx_d,    /*PyObject *globals,*/
        0                  /*PyObject *locals*/
    );
    if (!py_frame) goto bad;
    __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
    PyTraceBack_Here(py_frame);
bad:
    Py_XDECREF(py_code);
    Py_XDECREF(py_frame);
}
#endif

/* CIntToPy */
static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const long neg_one = (long) -1, const_zero = (long) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
    if (is_unsigned) {
        if (sizeof(long) < sizeof(long)) {
            return PyInt_FromLong((long) value);
        } else if (sizeof(long) <= sizeof(unsigned long)) {
            return PyLong_FromUnsignedLong((unsigned long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
#endif
        }
    } else {
        if (sizeof(long) <= sizeof(long)) {
            return PyInt_FromLong((long) value);
#ifdef HAVE_LONG_LONG
        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
            return PyLong_FromLongLong((PY_LONG_LONG) value);
#endif
        }
    }
    {
        int one = 1; int little = (int)*(unsigned char *)&one;
        unsigned char *bytes = (unsigned char *)&value;
#if !CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030d0000
        return _PyLong_FromByteArray(bytes, sizeof(long),
                                     little, !is_unsigned);
#else
        PyObject *from_bytes, *result = NULL;
        PyObject *py_bytes = NULL, *arg_tuple = NULL, *kwds = NULL, *order_str = NULL;
        from_bytes = PyObject_GetAttrString((PyObject*)&PyLong_Type, "from_bytes");
        if (!from_bytes) return NULL;
        py_bytes = PyBytes_FromStringAndSize((char*)bytes, sizeof(long));
        if (!py_bytes) goto limited_bad;
        order_str = PyUnicode_FromString(little ? "little" : "big");
        if (!order_str) goto limited_bad;
        arg_tuple = PyTuple_Pack(2, py_bytes, order_str);
        if (!arg_tuple) goto limited_bad;
        if (!is_unsigned) {
            kwds = PyDict_New();
            if (!kwds) goto limited_bad;
            if (PyDict_SetItemString(kwds, "signed", __Pyx_NewRef(Py_True))) goto limited_bad;
        }
        result = PyObject_Call(from_bytes, arg_tuple, kwds);
        limited_bad:
        Py_XDECREF(kwds);
        Py_XDECREF(arg_tuple);
        Py_XDECREF(order_str);
        Py_XDECREF(py_bytes);
        Py_XDECREF(from_bytes);
        return result;
#endif
    }
}

/* FormatTypeName */
#if CYTHON_COMPILING_IN_LIMITED_API
static __Pyx_TypeName
__Pyx_PyType_GetName(PyTypeObject* tp)
{
    PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
                                               __pyx_n_s_name);
    if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
        PyErr_Clear();
        Py_XDECREF(name);
        name = __Pyx_NewRef(__pyx_n_s__240);
    }
    return name;
}
#endif

/* CIntFromPyVerify */
#define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
#define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
    __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
#define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
    {\
        func_type value = func_value;\
        if (sizeof(target_type) < sizeof(func_type)) {\
            if (unlikely(value != (func_type) (target_type) value)) {\
                func_type zero = 0;\
                if (exc && unlikely(value == (func_type)-1 && PyErr_Occurred()))\
                    return (target_type) -1;\
                if (is_unsigned && unlikely(value < zero))\
                    goto raise_neg_overflow;\
                else\
                    goto raise_overflow;\
            }\
        }\
        return (target_type) value;\
    }

/* CIntFromPy */
static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const long neg_one = (long) -1, const_zero = (long) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if ((sizeof(long) < sizeof(long))) {
            __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (long) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
                goto raise_neg_overflow;
            } else if (__Pyx_PyLong_IsCompact(x)) {
                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
            } else {
                const digit* digits = __Pyx_PyLong_Digits(x);
                assert(__Pyx_PyLong_DigitCount(x) > 1);
                switch (__Pyx_PyLong_DigitCount(x)) {
                    case 2:
                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) >= 2 * PyLong_SHIFT)) {
                                return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                            }
                        }
                        break;
                    case 3:
                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) >= 3 * PyLong_SHIFT)) {
                                return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                            }
                        }
                        break;
                    case 4:
                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) >= 4 * PyLong_SHIFT)) {
                                return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
                            }
                        }
                        break;
                }
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (long) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if ((sizeof(long) <= sizeof(unsigned long))) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if ((sizeof(long) <= sizeof(unsigned PY_LONG_LONG))) {
                __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            if (__Pyx_PyLong_IsCompact(x)) {
                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
            } else {
                const digit* digits = __Pyx_PyLong_Digits(x);
                assert(__Pyx_PyLong_DigitCount(x) > 1);
                switch (__Pyx_PyLong_SignedDigitCount(x)) {
                    case -2:
                        if ((8 * sizeof(long) - 1 > 1 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
                                return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                            }
                        }
                        break;
                    case 2:
                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
                                return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                            }
                        }
                        break;
                    case -3:
                        if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
                                return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                            }
                        }
                        break;
                    case 3:
                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
                                return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                            }
                        }
                        break;
                    case -4:
                        if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
                                return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                            }
                        }
                        break;
                    case 4:
                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
                                return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
                            }
                        }
                        break;
                }
            }
#endif
            if ((sizeof(long) <= sizeof(long))) {
                __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if ((sizeof(long) <= sizeof(PY_LONG_LONG))) {
                __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
            long val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
#if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
#endif
            if (likely(v)) {
                int ret = -1;
#if PY_VERSION_HEX < 0x030d0000 && !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                ret = _PyLong_AsByteArray((PyLongObject *)v,
                                           bytes, sizeof(val),
                                           is_little, !is_unsigned);
#else
                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
                int bits, remaining_bits, is_negative = 0;
                long idigit;
                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
                if (unlikely(!PyLong_CheckExact(v))) {
                    PyObject *tmp = v;
                    v = PyNumber_Long(v);
                    assert(PyLong_CheckExact(v));
                    Py_DECREF(tmp);
                    if (unlikely(!v)) return (long) -1;
                }
#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
                if (Py_SIZE(x) == 0)
                    return (long) 0;
                is_negative = Py_SIZE(x) < 0;
#else
                {
                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                    if (unlikely(result < 0))
                        return (long) -1;
                    is_negative = result == 1;
                }
#endif
                if (is_unsigned && unlikely(is_negative)) {
                    goto raise_neg_overflow;
                } else if (is_negative) {
                    stepval = PyNumber_Invert(v);
                    if (unlikely(!stepval))
                        return (long) -1;
                } else {
                    stepval = __Pyx_NewRef(v);
                }
                val = (long) 0;
                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
                for (bits = 0; bits < (int) sizeof(long) * 8 - chunk_size; bits += chunk_size) {
                    PyObject *tmp, *digit;
                    digit = PyNumber_And(stepval, mask);
                    if (unlikely(!digit)) goto done;
                    idigit = PyLong_AsLong(digit);
                    Py_DECREF(digit);
                    if (unlikely(idigit < 0)) goto done;
                    tmp = PyNumber_Rshift(stepval, shift);
                    if (unlikely(!tmp)) goto done;
                    Py_DECREF(stepval); stepval = tmp;
                    val |= ((long) idigit) << bits;
                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
                    if (Py_SIZE(stepval) == 0)
                        goto unpacking_done;
                    #endif
                }
                idigit = PyLong_AsLong(stepval);
                if (unlikely(idigit < 0)) goto done;
                remaining_bits = ((int) sizeof(long) * 8) - bits - (is_unsigned ? 0 : 1);
                if (unlikely(idigit >= (1L << remaining_bits)))
                    goto raise_overflow;
                val |= ((long) idigit) << bits;
            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
            unpacking_done:
            #endif
                if (!is_unsigned) {
                    if (unlikely(val & (((long) 1) << (sizeof(long) * 8 - 1))))
                        goto raise_overflow;
                    if (is_negative)
                        val = ~val;
                }
                ret = 0;
            done:
                Py_XDECREF(shift);
                Py_XDECREF(mask);
                Py_XDECREF(stepval);
#endif
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
            return (long) -1;
        }
    } else {
        long val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (long) -1;
        val = __Pyx_PyInt_As_long(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to long");
    return (long) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to long");
    return (long) -1;
}

/* CIntFromPy */
static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic push
#pragma GCC diagnostic ignored "-Wconversion"
#endif
    const int neg_one = (int) -1, const_zero = (int) 0;
#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
#pragma GCC diagnostic pop
#endif
    const int is_unsigned = neg_one > const_zero;
#if PY_MAJOR_VERSION < 3
    if (likely(PyInt_Check(x))) {
        if ((sizeof(int) < sizeof(long))) {
            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
        } else {
            long val = PyInt_AS_LONG(x);
            if (is_unsigned && unlikely(val < 0)) {
                goto raise_neg_overflow;
            }
            return (int) val;
        }
    } else
#endif
    if (likely(PyLong_Check(x))) {
        if (is_unsigned) {
#if CYTHON_USE_PYLONG_INTERNALS
            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
                goto raise_neg_overflow;
            } else if (__Pyx_PyLong_IsCompact(x)) {
                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
            } else {
                const digit* digits = __Pyx_PyLong_Digits(x);
                assert(__Pyx_PyLong_DigitCount(x) > 1);
                switch (__Pyx_PyLong_DigitCount(x)) {
                    case 2:
                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) >= 2 * PyLong_SHIFT)) {
                                return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                            }
                        }
                        break;
                    case 3:
                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) >= 3 * PyLong_SHIFT)) {
                                return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                            }
                        }
                        break;
                    case 4:
                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) >= 4 * PyLong_SHIFT)) {
                                return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
                            }
                        }
                        break;
                }
            }
#endif
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
            if (unlikely(Py_SIZE(x) < 0)) {
                goto raise_neg_overflow;
            }
#else
            {
                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                if (unlikely(result < 0))
                    return (int) -1;
                if (unlikely(result == 1))
                    goto raise_neg_overflow;
            }
#endif
            if ((sizeof(int) <= sizeof(unsigned long))) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
#ifdef HAVE_LONG_LONG
            } else if ((sizeof(int) <= sizeof(unsigned PY_LONG_LONG))) {
                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
#endif
            }
        } else {
#if CYTHON_USE_PYLONG_INTERNALS
            if (__Pyx_PyLong_IsCompact(x)) {
                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
            } else {
                const digit* digits = __Pyx_PyLong_Digits(x);
                assert(__Pyx_PyLong_DigitCount(x) > 1);
                switch (__Pyx_PyLong_SignedDigitCount(x)) {
                    case -2:
                        if ((8 * sizeof(int) - 1 > 1 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
                                return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                            }
                        }
                        break;
                    case 2:
                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
                                return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                            }
                        }
                        break;
                    case -3:
                        if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
                                return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                            }
                        }
                        break;
                    case 3:
                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
                                return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                            }
                        }
                        break;
                    case -4:
                        if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
                                return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                            }
                        }
                        break;
                    case 4:
                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
                                return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
                            }
                        }
                        break;
                }
            }
#endif
            if ((sizeof(int) <= sizeof(long))) {
                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
#ifdef HAVE_LONG_LONG
            } else if ((sizeof(int) <= sizeof(PY_LONG_LONG))) {
                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
#endif
            }
        }
        {
            int val;
            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
#if PY_MAJOR_VERSION < 3
            if (likely(v) && !PyLong_Check(v)) {
                PyObject *tmp = v;
                v = PyNumber_Long(tmp);
                Py_DECREF(tmp);
            }
#endif
            if (likely(v)) {
                int ret = -1;
#if PY_VERSION_HEX < 0x030d0000 && !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                int one = 1; int is_little = (int)*(unsigned char *)&one;
                unsigned char *bytes = (unsigned char *)&val;
                ret = _PyLong_AsByteArray((PyLongObject *)v,
                                           bytes, sizeof(val),
                                           is_little, !is_unsigned);
#else
                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
                int bits, remaining_bits, is_negative = 0;
                long idigit;
                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
                if (unlikely(!PyLong_CheckExact(v))) {
                    PyObject *tmp = v;
                    v = PyNumber_Long(v);
                    assert(PyLong_CheckExact(v));
                    Py_DECREF(tmp);
                    if (unlikely(!v)) return (int) -1;
                }
#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
                if (Py_SIZE(x) == 0)
                    return (int) 0;
                is_negative = Py_SIZE(x) < 0;
#else
                {
                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                    if (unlikely(result < 0))
                        return (int) -1;
                    is_negative = result == 1;
                }
#endif
                if (is_unsigned && unlikely(is_negative)) {
                    goto raise_neg_overflow;
                } else if (is_negative) {
                    stepval = PyNumber_Invert(v);
                    if (unlikely(!stepval))
                        return (int) -1;
                } else {
                    stepval = __Pyx_NewRef(v);
                }
                val = (int) 0;
                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
                for (bits = 0; bits < (int) sizeof(int) * 8 - chunk_size; bits += chunk_size) {
                    PyObject *tmp, *digit;
                    digit = PyNumber_And(stepval, mask);
                    if (unlikely(!digit)) goto done;
                    idigit = PyLong_AsLong(digit);
                    Py_DECREF(digit);
                    if (unlikely(idigit < 0)) goto done;
                    tmp = PyNumber_Rshift(stepval, shift);
                    if (unlikely(!tmp)) goto done;
                    Py_DECREF(stepval); stepval = tmp;
                    val |= ((int) idigit) << bits;
                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
                    if (Py_SIZE(stepval) == 0)
                        goto unpacking_done;
                    #endif
                }
                idigit = PyLong_AsLong(stepval);
                if (unlikely(idigit < 0)) goto done;
                remaining_bits = ((int) sizeof(int) * 8) - bits - (is_unsigned ? 0 : 1);
                if (unlikely(idigit >= (1L << remaining_bits)))
                    goto raise_overflow;
                val |= ((int) idigit) << bits;
            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
            unpacking_done:
            #endif
                if (!is_unsigned) {
                    if (unlikely(val & (((int) 1) << (sizeof(int) * 8 - 1))))
                        goto raise_overflow;
                    if (is_negative)
                        val = ~val;
                }
                ret = 0;
            done:
                Py_XDECREF(shift);
                Py_XDECREF(mask);
                Py_XDECREF(stepval);
#endif
                Py_DECREF(v);
                if (likely(!ret))
                    return val;
            }
            return (int) -1;
        }
    } else {
        int val;
        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
        if (!tmp) return (int) -1;
        val = __Pyx_PyInt_As_int(tmp);
        Py_DECREF(tmp);
        return val;
    }
raise_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "value too large to convert to int");
    return (int) -1;
raise_neg_overflow:
    PyErr_SetString(PyExc_OverflowError,
        "can't convert negative value to int");
    return (int) -1;
}

/* FastTypeChecks */
#if CYTHON_COMPILING_IN_CPYTHON
static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
    while (a) {
        a = __Pyx_PyType_GetSlot(a, tp_base, PyTypeObject*);
        if (a == b)
            return 1;
    }
    return b == &PyBaseObject_Type;
}
static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b) {
    PyObject *mro;
    if (a == b) return 1;
    mro = a->tp_mro;
    if (likely(mro)) {
        Py_ssize_t i, n;
        n = PyTuple_GET_SIZE(mro);
        for (i = 0; i < n; i++) {
            if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                return 1;
        }
        return 0;
    }
    return __Pyx_InBases(a, b);
}
static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b) {
    PyObject *mro;
    if (cls == a || cls == b) return 1;
    mro = cls->tp_mro;
    if (likely(mro)) {
        Py_ssize_t i, n;
        n = PyTuple_GET_SIZE(mro);
        for (i = 0; i < n; i++) {
            PyObject *base = PyTuple_GET_ITEM(mro, i);
            if (base == (PyObject *)a || base == (PyObject *)b)
                return 1;
        }
        return 0;
    }
    return __Pyx_InBases(cls, a) || __Pyx_InBases(cls, b);
}
#if PY_MAJOR_VERSION == 2
static int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject* exc_type2) {
    PyObject *exception, *value, *tb;
    int res;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&exception, &value, &tb);
    res = exc_type1 ? PyObject_IsSubclass(err, exc_type1) : 0;
    if (unlikely(res == -1)) {
        PyErr_WriteUnraisable(err);
        res = 0;
    }
    if (!res) {
        res = PyObject_IsSubclass(err, exc_type2);
        if (unlikely(res == -1)) {
            PyErr_WriteUnraisable(err);
            res = 0;
        }
    }
    __Pyx_ErrRestore(exception, value, tb);
    return res;
}
#else
static CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {
    if (exc_type1) {
        return __Pyx_IsAnySubtype2((PyTypeObject*)err, (PyTypeObject*)exc_type1, (PyTypeObject*)exc_type2);
    } else {
        return __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
    }
}
#endif
static int __Pyx_PyErr_GivenExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
    Py_ssize_t i, n;
    assert(PyExceptionClass_Check(exc_type));
    n = PyTuple_GET_SIZE(tuple);
#if PY_MAJOR_VERSION >= 3
    for (i=0; i<n; i++) {
        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
    }
#endif
    for (i=0; i<n; i++) {
        PyObject *t = PyTuple_GET_ITEM(tuple, i);
        #if PY_MAJOR_VERSION < 3
        if (likely(exc_type == t)) return 1;
        #endif
        if (likely(PyExceptionClass_Check(t))) {
            if (__Pyx_inner_PyErr_GivenExceptionMatches2(exc_type, NULL, t)) return 1;
        } else {
        }
    }
    return 0;
}
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject* exc_type) {
    if (likely(err == exc_type)) return 1;
    if (likely(PyExceptionClass_Check(err))) {
        if (likely(PyExceptionClass_Check(exc_type))) {
            return __Pyx_inner_PyErr_GivenExceptionMatches2(err, NULL, exc_type);
        } else if (likely(PyTuple_Check(exc_type))) {
            return __Pyx_PyErr_GivenExceptionMatchesTuple(err, exc_type);
        } else {
        }
    }
    return PyErr_GivenExceptionMatches(err, exc_type);
}
static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *exc_type1, PyObject *exc_type2) {
    assert(PyExceptionClass_Check(exc_type1));
    assert(PyExceptionClass_Check(exc_type2));
    if (likely(err == exc_type1 || err == exc_type2)) return 1;
    if (likely(PyExceptionClass_Check(err))) {
        return __Pyx_inner_PyErr_GivenExceptionMatches2(err, exc_type1, exc_type2);
    }
    return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
}
#endif

/* SwapException */
#if CYTHON_FAST_THREAD_STATE
static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
  #if CYTHON_USE_EXC_INFO_STACK && PY_VERSION_HEX >= 0x030B00a4
    _PyErr_StackItem *exc_info = tstate->exc_info;
    tmp_value = exc_info->exc_value;
    exc_info->exc_value = *value;
    if (tmp_value == NULL || tmp_value == Py_None) {
        Py_XDECREF(tmp_value);
        tmp_value = NULL;
        tmp_type = NULL;
        tmp_tb = NULL;
    } else {
        tmp_type = (PyObject*) Py_TYPE(tmp_value);
        Py_INCREF(tmp_type);
        #if CYTHON_COMPILING_IN_CPYTHON
        tmp_tb = ((PyBaseExceptionObject*) tmp_value)->traceback;
        Py_XINCREF(tmp_tb);
        #else
        tmp_tb = PyException_GetTraceback(tmp_value);
        #endif
    }
  #elif CYTHON_USE_EXC_INFO_STACK
    _PyErr_StackItem *exc_info = tstate->exc_info;
    tmp_type = exc_info->exc_type;
    tmp_value = exc_info->exc_value;
    tmp_tb = exc_info->exc_traceback;
    exc_info->exc_type = *type;
    exc_info->exc_value = *value;
    exc_info->exc_traceback = *tb;
  #else
    tmp_type = tstate->exc_type;
    tmp_value = tstate->exc_value;
    tmp_tb = tstate->exc_traceback;
    tstate->exc_type = *type;
    tstate->exc_value = *value;
    tstate->exc_traceback = *tb;
  #endif
    *type = tmp_type;
    *value = tmp_value;
    *tb = tmp_tb;
}
#else
static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
    PyObject *tmp_type, *tmp_value, *tmp_tb;
    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
    PyErr_SetExcInfo(*type, *value, *tb);
    *type = tmp_type;
    *value = tmp_value;
    *tb = tmp_tb;
}
#endif

/* PyObjectCall2Args */
static CYTHON_INLINE PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
    PyObject *args[3] = {NULL, arg1, arg2};
    return __Pyx_PyObject_FastCall(function, args+1, 2 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
}

/* PyObjectCallMethod1 */
#if !(CYTHON_VECTORCALL && __PYX_LIMITED_VERSION_HEX >= 0x030C00A2)
static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
    PyObject *result = __Pyx_PyObject_CallOneArg(method, arg);
    Py_DECREF(method);
    return result;
}
#endif
static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
#if CYTHON_VECTORCALL && __PYX_LIMITED_VERSION_HEX >= 0x030C00A2
    PyObject *args[2] = {obj, arg};
    (void) __Pyx_PyObject_GetMethod;
    (void) __Pyx_PyObject_CallOneArg;
    (void) __Pyx_PyObject_Call2Args;
    return PyObject_VectorcallMethod(method_name, args, 2 | PY_VECTORCALL_ARGUMENTS_OFFSET, NULL);
#else
    PyObject *method = NULL, *result;
    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
    if (likely(is_method)) {
        result = __Pyx_PyObject_Call2Args(method, obj, arg);
        Py_DECREF(method);
        return result;
    }
    if (unlikely(!method)) return NULL;
    return __Pyx__PyObject_CallMethod1(method, arg);
#endif
}

/* CoroutineBase */
#include <frameobject.h>
#if PY_VERSION_HEX >= 0x030b00a6
  #ifndef Py_BUILD_CORE
    #define Py_BUILD_CORE 1
  #endif
  #include "internal/pycore_frame.h"
#endif
#define __Pyx_Coroutine_Undelegate(gen) Py_CLEAR((gen)->yieldfrom)
static int __Pyx_PyGen__FetchStopIterationValue(PyThreadState *__pyx_tstate, PyObject **pvalue) {
    PyObject *et, *ev, *tb;
    PyObject *value = NULL;
    CYTHON_UNUSED_VAR(__pyx_tstate);
    __Pyx_ErrFetch(&et, &ev, &tb);
    if (!et) {
        Py_XDECREF(tb);
        Py_XDECREF(ev);
        Py_INCREF(Py_None);
        *pvalue = Py_None;
        return 0;
    }
    if (likely(et == PyExc_StopIteration)) {
        if (!ev) {
            Py_INCREF(Py_None);
            value = Py_None;
        }
#if PY_VERSION_HEX >= 0x030300A0
        else if (likely(__Pyx_IS_TYPE(ev, (PyTypeObject*)PyExc_StopIteration))) {
            value = ((PyStopIterationObject *)ev)->value;
            Py_INCREF(value);
            Py_DECREF(ev);
        }
#endif
        else if (unlikely(PyTuple_Check(ev))) {
            if (PyTuple_GET_SIZE(ev) >= 1) {
#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
                value = PyTuple_GET_ITEM(ev, 0);
                Py_INCREF(value);
#else
                value = PySequence_ITEM(ev, 0);
#endif
            } else {
                Py_INCREF(Py_None);
                value = Py_None;
            }
            Py_DECREF(ev);
        }
        else if (!__Pyx_TypeCheck(ev, (PyTypeObject*)PyExc_StopIteration)) {
            value = ev;
        }
        if (likely(value)) {
            Py_XDECREF(tb);
            Py_DECREF(et);
            *pvalue = value;
            return 0;
        }
    } else if (!__Pyx_PyErr_GivenExceptionMatches(et, PyExc_StopIteration)) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    PyErr_NormalizeException(&et, &ev, &tb);
    if (unlikely(!PyObject_TypeCheck(ev, (PyTypeObject*)PyExc_StopIteration))) {
        __Pyx_ErrRestore(et, ev, tb);
        return -1;
    }
    Py_XDECREF(tb);
    Py_DECREF(et);
#if PY_VERSION_HEX >= 0x030300A0
    value = ((PyStopIterationObject *)ev)->value;
    Py_INCREF(value);
    Py_DECREF(ev);
#else
    {
        PyObject* args = __Pyx_PyObject_GetAttrStr(ev, __pyx_n_s_args);
        Py_DECREF(ev);
        if (likely(args)) {
            value = PySequence_GetItem(args, 0);
            Py_DECREF(args);
        }
        if (unlikely(!value)) {
            __Pyx_ErrRestore(NULL, NULL, NULL);
            Py_INCREF(Py_None);
            value = Py_None;
        }
    }
#endif
    *pvalue = value;
    return 0;
}
static CYTHON_INLINE
void __Pyx_Coroutine_ExceptionClear(__Pyx_ExcInfoStruct *exc_state) {
#if PY_VERSION_HEX >= 0x030B00a4
    Py_CLEAR(exc_state->exc_value);
#else
    PyObject *t, *v, *tb;
    t = exc_state->exc_type;
    v = exc_state->exc_value;
    tb = exc_state->exc_traceback;
    exc_state->exc_type = NULL;
    exc_state->exc_value = NULL;
    exc_state->exc_traceback = NULL;
    Py_XDECREF(t);
    Py_XDECREF(v);
    Py_XDECREF(tb);
#endif
}
#define __Pyx_Coroutine_AlreadyRunningError(gen)  (__Pyx__Coroutine_AlreadyRunningError(gen), (PyObject*)NULL)
static void __Pyx__Coroutine_AlreadyRunningError(__pyx_CoroutineObject *gen) {
    const char *msg;
    CYTHON_MAYBE_UNUSED_VAR(gen);
    if ((0)) {
    #ifdef __Pyx_Coroutine_USED
    } else if (__Pyx_Coroutine_Check((PyObject*)gen)) {
        msg = "coroutine already executing";
    #endif
    #ifdef __Pyx_AsyncGen_USED
    } else if (__Pyx_AsyncGen_CheckExact((PyObject*)gen)) {
        msg = "async generator already executing";
    #endif
    } else {
        msg = "generator already executing";
    }
    PyErr_SetString(PyExc_ValueError, msg);
}
#define __Pyx_Coroutine_NotStartedError(gen)  (__Pyx__Coroutine_NotStartedError(gen), (PyObject*)NULL)
static void __Pyx__Coroutine_NotStartedError(PyObject *gen) {
    const char *msg;
    CYTHON_MAYBE_UNUSED_VAR(gen);
    if ((0)) {
    #ifdef __Pyx_Coroutine_USED
    } else if (__Pyx_Coroutine_Check(gen)) {
        msg = "can't send non-None value to a just-started coroutine";
    #endif
    #ifdef __Pyx_AsyncGen_USED
    } else if (__Pyx_AsyncGen_CheckExact(gen)) {
        msg = "can't send non-None value to a just-started async generator";
    #endif
    } else {
        msg = "can't send non-None value to a just-started generator";
    }
    PyErr_SetString(PyExc_TypeError, msg);
}
#define __Pyx_Coroutine_AlreadyTerminatedError(gen, value, closing)  (__Pyx__Coroutine_AlreadyTerminatedError(gen, value, closing), (PyObject*)NULL)
static void __Pyx__Coroutine_AlreadyTerminatedError(PyObject *gen, PyObject *value, int closing) {
    CYTHON_MAYBE_UNUSED_VAR(gen);
    CYTHON_MAYBE_UNUSED_VAR(closing);
    #ifdef __Pyx_Coroutine_USED
    if (!closing && __Pyx_Coroutine_Check(gen)) {
        PyErr_SetString(PyExc_RuntimeError, "cannot reuse already awaited coroutine");
    } else
    #endif
    if (value) {
        #ifdef __Pyx_AsyncGen_USED
        if (__Pyx_AsyncGen_CheckExact(gen))
            PyErr_SetNone(__Pyx_PyExc_StopAsyncIteration);
        else
        #endif
        PyErr_SetNone(PyExc_StopIteration);
    }
}
static
PyObject *__Pyx_Coroutine_SendEx(__pyx_CoroutineObject *self, PyObject *value, int closing) {
    __Pyx_PyThreadState_declare
    PyThreadState *tstate;
    __Pyx_ExcInfoStruct *exc_state;
    PyObject *retval;
    assert(!self->is_running);
    if (unlikely(self->resume_label == 0)) {
        if (unlikely(value && value != Py_None)) {
            return __Pyx_Coroutine_NotStartedError((PyObject*)self);
        }
    }
    if (unlikely(self->resume_label == -1)) {
        return __Pyx_Coroutine_AlreadyTerminatedError((PyObject*)self, value, closing);
    }
#if CYTHON_FAST_THREAD_STATE
    __Pyx_PyThreadState_assign
    tstate = __pyx_tstate;
#else
    tstate = __Pyx_PyThreadState_Current;
#endif
    exc_state = &self->gi_exc_state;
    if (exc_state->exc_value) {
        #if CYTHON_COMPILING_IN_PYPY
        #else
        PyObject *exc_tb;
        #if PY_VERSION_HEX >= 0x030B00a4 && !CYTHON_COMPILING_IN_CPYTHON
        exc_tb = PyException_GetTraceback(exc_state->exc_value);
        #elif PY_VERSION_HEX >= 0x030B00a4
        exc_tb = ((PyBaseExceptionObject*) exc_state->exc_value)->traceback;
        #else
        exc_tb = exc_state->exc_traceback;
        #endif
        if (exc_tb) {
            PyTracebackObject *tb = (PyTracebackObject *) exc_tb;
            PyFrameObject *f = tb->tb_frame;
            assert(f->f_back == NULL);
            #if PY_VERSION_HEX >= 0x030B00A1
            f->f_back = PyThreadState_GetFrame(tstate);
            #else
            Py_XINCREF(tstate->frame);
            f->f_back = tstate->frame;
            #endif
            #if PY_VERSION_HEX >= 0x030B00a4 && !CYTHON_COMPILING_IN_CPYTHON
            Py_DECREF(exc_tb);
            #endif
        }
        #endif
    }
#if CYTHON_USE_EXC_INFO_STACK
    exc_state->previous_item = tstate->exc_info;
    tstate->exc_info = exc_state;
#else
    if (exc_state->exc_type) {
        __Pyx_ExceptionSwap(&exc_state->exc_type, &exc_state->exc_value, &exc_state->exc_traceback);
    } else {
        __Pyx_Coroutine_ExceptionClear(exc_state);
        __Pyx_ExceptionSave(&exc_state->exc_type, &exc_state->exc_value, &exc_state->exc_traceback);
    }
#endif
    self->is_running = 1;
    retval = self->body(self, tstate, value);
    self->is_running = 0;
#if CYTHON_USE_EXC_INFO_STACK
    exc_state = &self->gi_exc_state;
    tstate->exc_info = exc_state->previous_item;
    exc_state->previous_item = NULL;
    __Pyx_Coroutine_ResetFrameBackpointer(exc_state);
#endif
    return retval;
}
static CYTHON_INLINE void __Pyx_Coroutine_ResetFrameBackpointer(__Pyx_ExcInfoStruct *exc_state) {
#if CYTHON_COMPILING_IN_PYPY
    CYTHON_UNUSED_VAR(exc_state);
#else
    PyObject *exc_tb;
    #if PY_VERSION_HEX >= 0x030B00a4
    if (!exc_state->exc_value) return;
    exc_tb = PyException_GetTraceback(exc_state->exc_value);
    #else
    exc_tb = exc_state->exc_traceback;
    #endif
    if (likely(exc_tb)) {
        PyTracebackObject *tb = (PyTracebackObject *) exc_tb;
        PyFrameObject *f = tb->tb_frame;
        Py_CLEAR(f->f_back);
        #if PY_VERSION_HEX >= 0x030B00a4
        Py_DECREF(exc_tb);
        #endif
    }
#endif
}
static CYTHON_INLINE
PyObject *__Pyx_Coroutine_MethodReturn(PyObject* gen, PyObject *retval) {
    CYTHON_MAYBE_UNUSED_VAR(gen);
    if (unlikely(!retval)) {
        __Pyx_PyThreadState_declare
        __Pyx_PyThreadState_assign
        if (!__Pyx_PyErr_Occurred()) {
            PyObject *exc = PyExc_StopIteration;
            #ifdef __Pyx_AsyncGen_USED
            if (__Pyx_AsyncGen_CheckExact(gen))
                exc = __Pyx_PyExc_StopAsyncIteration;
            #endif
            __Pyx_PyErr_SetNone(exc);
        }
    }
    return retval;
}
#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03030000 && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
static CYTHON_INLINE
PyObject *__Pyx_PyGen_Send(PyGenObject *gen, PyObject *arg) {
#if PY_VERSION_HEX <= 0x030A00A1
    return _PyGen_Send(gen, arg);
#else
    PyObject *result;
    if (PyIter_Send((PyObject*)gen, arg ? arg : Py_None, &result) == PYGEN_RETURN) {
        if (PyAsyncGen_CheckExact(gen)) {
            assert(result == Py_None);
            PyErr_SetNone(PyExc_StopAsyncIteration);
        }
        else if (result == Py_None) {
            PyErr_SetNone(PyExc_StopIteration);
        }
        else {
#if PY_VERSION_HEX < 0x030d00A1
            _PyGen_SetStopIterationValue(result);
#else
            if (!PyTuple_Check(result) && !PyExceptionInstance_Check(result)) {
                PyErr_SetObject(PyExc_StopIteration, result);
            } else {
                PyObject *exc = __Pyx_PyObject_CallOneArg(PyExc_StopIteration, result);
                if (likely(exc != NULL)) {
                    PyErr_SetObject(PyExc_StopIteration, exc);
                    Py_DECREF(exc);
                }
            }
#endif
        }
        Py_DECREF(result);
        result = NULL;
    }
    return result;
#endif
}
#endif
static CYTHON_INLINE
PyObject *__Pyx_Coroutine_FinishDelegation(__pyx_CoroutineObject *gen) {
    PyObject *ret;
    PyObject *val = NULL;
    __Pyx_Coroutine_Undelegate(gen);
    __Pyx_PyGen__FetchStopIterationValue(__Pyx_PyThreadState_Current, &val);
    ret = __Pyx_Coroutine_SendEx(gen, val, 0);
    Py_XDECREF(val);
    return ret;
}
static PyObject *__Pyx_Coroutine_Send(PyObject *self, PyObject *value) {
    PyObject *retval;
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        #ifdef __Pyx_Generator_USED
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Coroutine_Send(yf, value);
        } else
        #endif
        #ifdef __Pyx_Coroutine_USED
        if (__Pyx_Coroutine_Check(yf)) {
            ret = __Pyx_Coroutine_Send(yf, value);
        } else
        #endif
        #ifdef __Pyx_AsyncGen_USED
        if (__pyx_PyAsyncGenASend_CheckExact(yf)) {
            ret = __Pyx_async_gen_asend_send(yf, value);
        } else
        #endif
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03030000 && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
        if (PyGen_CheckExact(yf)) {
            ret = __Pyx_PyGen_Send((PyGenObject*)yf, value == Py_None ? NULL : value);
        } else
        #endif
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03050000 && defined(PyCoro_CheckExact) && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
        if (PyCoro_CheckExact(yf)) {
            ret = __Pyx_PyGen_Send((PyGenObject*)yf, value == Py_None ? NULL : value);
        } else
        #endif
        {
            if (value == Py_None)
                ret = __Pyx_PyObject_GetIterNextFunc(yf)(yf);
            else
                ret = __Pyx_PyObject_CallMethod1(yf, __pyx_n_s_send, value);
        }
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        retval = __Pyx_Coroutine_FinishDelegation(gen);
    } else {
        retval = __Pyx_Coroutine_SendEx(gen, value, 0);
    }
    return __Pyx_Coroutine_MethodReturn(self, retval);
}
static int __Pyx_Coroutine_CloseIter(__pyx_CoroutineObject *gen, PyObject *yf) {
    PyObject *retval = NULL;
    int err = 0;
    #ifdef __Pyx_Generator_USED
    if (__Pyx_Generator_CheckExact(yf)) {
        retval = __Pyx_Coroutine_Close(yf);
        if (!retval)
            return -1;
    } else
    #endif
    #ifdef __Pyx_Coroutine_USED
    if (__Pyx_Coroutine_Check(yf)) {
        retval = __Pyx_Coroutine_Close(yf);
        if (!retval)
            return -1;
    } else
    if (__Pyx_CoroutineAwait_CheckExact(yf)) {
        retval = __Pyx_CoroutineAwait_Close((__pyx_CoroutineAwaitObject*)yf, NULL);
        if (!retval)
            return -1;
    } else
    #endif
    #ifdef __Pyx_AsyncGen_USED
    if (__pyx_PyAsyncGenASend_CheckExact(yf)) {
        retval = __Pyx_async_gen_asend_close(yf, NULL);
    } else
    if (__pyx_PyAsyncGenAThrow_CheckExact(yf)) {
        retval = __Pyx_async_gen_athrow_close(yf, NULL);
    } else
    #endif
    {
        PyObject *meth;
        gen->is_running = 1;
        meth = __Pyx_PyObject_GetAttrStrNoError(yf, __pyx_n_s_close);
        if (unlikely(!meth)) {
            if (unlikely(PyErr_Occurred())) {
                PyErr_WriteUnraisable(yf);
            }
        } else {
            retval = __Pyx_PyObject_CallNoArg(meth);
            Py_DECREF(meth);
            if (unlikely(!retval))
                err = -1;
        }
        gen->is_running = 0;
    }
    Py_XDECREF(retval);
    return err;
}
static PyObject *__Pyx_Generator_Next(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject*) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        PyObject *ret;
        gen->is_running = 1;
        #ifdef __Pyx_Generator_USED
        if (__Pyx_Generator_CheckExact(yf)) {
            ret = __Pyx_Generator_Next(yf);
        } else
        #endif
        #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03030000 && (defined(__linux__) || PY_VERSION_HEX >= 0x030600B3)
        if (PyGen_CheckExact(yf)) {
            ret = __Pyx_PyGen_Send((PyGenObject*)yf, NULL);
        } else
        #endif
        #ifdef __Pyx_Coroutine_USED
        if (__Pyx_Coroutine_Check(yf)) {
            ret = __Pyx_Coroutine_Send(yf, Py_None);
        } else
        #endif
            ret = __Pyx_PyObject_GetIterNextFunc(yf)(yf);
        gen->is_running = 0;
        if (likely(ret)) {
            return ret;
        }
        return __Pyx_Coroutine_FinishDelegation(gen);
    }
    return __Pyx_Coroutine_SendEx(gen, Py_None, 0);
}
static PyObject *__Pyx_Coroutine_Close_Method(PyObject *self, PyObject *arg) {
    CYTHON_UNUSED_VAR(arg);
    return __Pyx_Coroutine_Close(self);
}
static PyObject *__Pyx_Coroutine_Close(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    PyObject *retval, *raised_exception;
    PyObject *yf = gen->yieldfrom;
    int err = 0;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        Py_INCREF(yf);
        err = __Pyx_Coroutine_CloseIter(gen, yf);
        __Pyx_Coroutine_Undelegate(gen);
        Py_DECREF(yf);
    }
    if (err == 0)
        PyErr_SetNone(PyExc_GeneratorExit);
    retval = __Pyx_Coroutine_SendEx(gen, NULL, 1);
    if (unlikely(retval)) {
        const char *msg;
        Py_DECREF(retval);
        if ((0)) {
        #ifdef __Pyx_Coroutine_USED
        } else if (__Pyx_Coroutine_Check(self)) {
            msg = "coroutine ignored GeneratorExit";
        #endif
        #ifdef __Pyx_AsyncGen_USED
        } else if (__Pyx_AsyncGen_CheckExact(self)) {
#if PY_VERSION_HEX < 0x03060000
            msg = "async generator ignored GeneratorExit - might require Python 3.6+ finalisation (PEP 525)";
#else
            msg = "async generator ignored GeneratorExit";
#endif
        #endif
        } else {
            msg = "generator ignored GeneratorExit";
        }
        PyErr_SetString(PyExc_RuntimeError, msg);
        return NULL;
    }
    raised_exception = PyErr_Occurred();
    if (likely(!raised_exception || __Pyx_PyErr_GivenExceptionMatches2(raised_exception, PyExc_GeneratorExit, PyExc_StopIteration))) {
        if (raised_exception) PyErr_Clear();
        Py_INCREF(Py_None);
        return Py_None;
    }
    return NULL;
}
static PyObject *__Pyx__Coroutine_Throw(PyObject *self, PyObject *typ, PyObject *val, PyObject *tb,
                                        PyObject *args, int close_on_genexit) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    PyObject *yf = gen->yieldfrom;
    if (unlikely(gen->is_running))
        return __Pyx_Coroutine_AlreadyRunningError(gen);
    if (yf) {
        PyObject *ret;
        Py_INCREF(yf);
        if (__Pyx_PyErr_GivenExceptionMatches(typ, PyExc_GeneratorExit) && close_on_genexit) {
            int err = __Pyx_Coroutine_CloseIter(gen, yf);
            Py_DECREF(yf);
            __Pyx_Coroutine_Undelegate(gen);
            if (err < 0)
                return __Pyx_Coroutine_MethodReturn(self, __Pyx_Coroutine_SendEx(gen, NULL, 0));
            goto throw_here;
        }
        gen->is_running = 1;
        if (0
        #ifdef __Pyx_Generator_USED
            || __Pyx_Generator_CheckExact(yf)
        #endif
        #ifdef __Pyx_Coroutine_USED
            || __Pyx_Coroutine_Check(yf)
        #endif
            ) {
            ret = __Pyx__Coroutine_Throw(yf, typ, val, tb, args, close_on_genexit);
        #ifdef __Pyx_Coroutine_USED
        } else if (__Pyx_CoroutineAwait_CheckExact(yf)) {
            ret = __Pyx__Coroutine_Throw(((__pyx_CoroutineAwaitObject*)yf)->coroutine, typ, val, tb, args, close_on_genexit);
        #endif
        } else {
            PyObject *meth = __Pyx_PyObject_GetAttrStrNoError(yf, __pyx_n_s_throw);
            if (unlikely(!meth)) {
                Py_DECREF(yf);
                if (unlikely(PyErr_Occurred())) {
                    gen->is_running = 0;
                    return NULL;
                }
                __Pyx_Coroutine_Undelegate(gen);
                gen->is_running = 0;
                goto throw_here;
            }
            if (likely(args)) {
                ret = __Pyx_PyObject_Call(meth, args, NULL);
            } else {
                PyObject *cargs[4] = {NULL, typ, val, tb};
                ret = __Pyx_PyObject_FastCall(meth, cargs+1, 3 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
            }
            Py_DECREF(meth);
        }
        gen->is_running = 0;
        Py_DECREF(yf);
        if (!ret) {
            ret = __Pyx_Coroutine_FinishDelegation(gen);
        }
        return __Pyx_Coroutine_MethodReturn(self, ret);
    }
throw_here:
    __Pyx_Raise(typ, val, tb, NULL);
    return __Pyx_Coroutine_MethodReturn(self, __Pyx_Coroutine_SendEx(gen, NULL, 0));
}
static PyObject *__Pyx_Coroutine_Throw(PyObject *self, PyObject *args) {
    PyObject *typ;
    PyObject *val = NULL;
    PyObject *tb = NULL;
    if (unlikely(!PyArg_UnpackTuple(args, (char *)"throw", 1, 3, &typ, &val, &tb)))
        return NULL;
    return __Pyx__Coroutine_Throw(self, typ, val, tb, args, 1);
}
static CYTHON_INLINE int __Pyx_Coroutine_traverse_excstate(__Pyx_ExcInfoStruct *exc_state, visitproc visit, void *arg) {
#if PY_VERSION_HEX >= 0x030B00a4
    Py_VISIT(exc_state->exc_value);
#else
    Py_VISIT(exc_state->exc_type);
    Py_VISIT(exc_state->exc_value);
    Py_VISIT(exc_state->exc_traceback);
#endif
    return 0;
}
static int __Pyx_Coroutine_traverse(__pyx_CoroutineObject *gen, visitproc visit, void *arg) {
    Py_VISIT(gen->closure);
    Py_VISIT(gen->classobj);
    Py_VISIT(gen->yieldfrom);
    return __Pyx_Coroutine_traverse_excstate(&gen->gi_exc_state, visit, arg);
}
static int __Pyx_Coroutine_clear(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    Py_CLEAR(gen->closure);
    Py_CLEAR(gen->classobj);
    Py_CLEAR(gen->yieldfrom);
    __Pyx_Coroutine_ExceptionClear(&gen->gi_exc_state);
#ifdef __Pyx_AsyncGen_USED
    if (__Pyx_AsyncGen_CheckExact(self)) {
        Py_CLEAR(((__pyx_PyAsyncGenObject*)gen)->ag_finalizer);
    }
#endif
    Py_CLEAR(gen->gi_code);
    Py_CLEAR(gen->gi_frame);
    Py_CLEAR(gen->gi_name);
    Py_CLEAR(gen->gi_qualname);
    Py_CLEAR(gen->gi_modulename);
    return 0;
}
static void __Pyx_Coroutine_dealloc(PyObject *self) {
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    PyObject_GC_UnTrack(gen);
    if (gen->gi_weakreflist != NULL)
        PyObject_ClearWeakRefs(self);
    if (gen->resume_label >= 0) {
        PyObject_GC_Track(self);
#if PY_VERSION_HEX >= 0x030400a1 && CYTHON_USE_TP_FINALIZE
        if (unlikely(PyObject_CallFinalizerFromDealloc(self)))
#else
        Py_TYPE(gen)->tp_del(self);
        if (unlikely(Py_REFCNT(self) > 0))
#endif
        {
            return;
        }
        PyObject_GC_UnTrack(self);
    }
#ifdef __Pyx_AsyncGen_USED
    if (__Pyx_AsyncGen_CheckExact(self)) {
        /* We have to handle this case for asynchronous generators
           right here, because this code has to be between UNTRACK
           and GC_Del. */
        Py_CLEAR(((__pyx_PyAsyncGenObject*)self)->ag_finalizer);
    }
#endif
    __Pyx_Coroutine_clear(self);
    __Pyx_PyHeapTypeObject_GC_Del(gen);
}
static void __Pyx_Coroutine_del(PyObject *self) {
    PyObject *error_type, *error_value, *error_traceback;
    __pyx_CoroutineObject *gen = (__pyx_CoroutineObject *) self;
    __Pyx_PyThreadState_declare
    if (gen->resume_label < 0) {
        return;
    }
#if !CYTHON_USE_TP_FINALIZE
    assert(self->ob_refcnt == 0);
    __Pyx_SET_REFCNT(self, 1);
#endif
    __Pyx_PyThreadState_assign
    __Pyx_ErrFetch(&error_type, &error_value, &error_traceback);
#ifdef __Pyx_AsyncGen_USED
    if (__Pyx_AsyncGen_CheckExact(self)) {
        __pyx_PyAsyncGenObject *agen = (__pyx_PyAsyncGenObject*)self;
        PyObject *finalizer = agen->ag_finalizer;
        if (finalizer && !agen->ag_closed) {
            PyObject *res = __Pyx_PyObject_CallOneArg(finalizer, self);
            if (unlikely(!res)) {
                PyErr_WriteUnraisable(self);
            } else {
                Py_DECREF(res);
            }
            __Pyx_ErrRestore(error_type, error_value, error_traceback);
            return;
        }
    }
#endif
    if (unlikely(gen->resume_label == 0 && !error_value)) {
#ifdef __Pyx_Coroutine_USED
#ifdef __Pyx_Generator_USED
    if (!__Pyx_Generator_CheckExact(self))
#endif
        {
        PyObject_GC_UnTrack(self);
#if PY_MAJOR_VERSION >= 3  || defined(PyErr_WarnFormat)
        if (unlikely(PyErr_WarnFormat(PyExc_RuntimeWarning, 1, "coroutine '%.50S' was never awaited", gen->gi_qualname) < 0))
            PyErr_WriteUnraisable(self);
#else
        {PyObject *msg;
        char *cmsg;
        #if CYTHON_COMPILING_IN_PYPY
        msg = NULL;
        cmsg = (char*) "coroutine was never awaited";
        #else
        char *cname;
        PyObject *qualname;
        qualname = gen->gi_qualname;
        cname = PyString_AS_STRING(qualname);
        msg = PyString_FromFormat("coroutine '%.50s' was never awaited", cname);
        if (unlikely(!msg)) {
            PyErr_Clear();
            cmsg = (char*) "coroutine was never awaited";
        } else {
            cmsg = PyString_AS_STRING(msg);
        }
        #endif
        if (unlikely(PyErr_WarnEx(PyExc_RuntimeWarning, cmsg, 1) < 0))
            PyErr_WriteUnraisable(self);
        Py_XDECREF(msg);}
#endif
        PyObject_GC_Track(self);
        }
#endif
    } else {
        PyObject *res = __Pyx_Coroutine_Close(self);
        if (unlikely(!res)) {
            if (PyErr_Occurred())
                PyErr_WriteUnraisable(self);
        } else {
            Py_DECREF(res);
        }
    }
    __Pyx_ErrRestore(error_type, error_value, error_traceback);
#if !CYTHON_USE_TP_FINALIZE
    assert(Py_REFCNT(self) > 0);
    if (likely(--self->ob_refcnt == 0)) {
        return;
    }
    {
        Py_ssize_t refcnt = Py_REFCNT(self);
        _Py_NewReference(self);
        __Pyx_SET_REFCNT(self, refcnt);
    }
#if CYTHON_COMPILING_IN_CPYTHON
    assert(PyType_IS_GC(Py_TYPE(self)) &&
           _Py_AS_GC(self)->gc.gc_refs != _PyGC_REFS_UNTRACKED);
    _Py_DEC_REFTOTAL;
#endif
#ifdef COUNT_ALLOCS
    --Py_TYPE(self)->tp_frees;
    --Py_TYPE(self)->tp_allocs;
#endif
#endif
}
static PyObject *
__Pyx_Coroutine_get_name(__pyx_CoroutineObject *self, void *context)
{
    PyObject *name = self->gi_name;
    CYTHON_UNUSED_VAR(context);
    if (unlikely(!name)) name = Py_None;
    Py_INCREF(name);
    return name;
}
static int
__Pyx_Coroutine_set_name(__pyx_CoroutineObject *self, PyObject *value, void *context)
{
    CYTHON_UNUSED_VAR(context);
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__name__ must be set to a string object");
        return -1;
    }
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(self->gi_name, value);
    return 0;
}
static PyObject *
__Pyx_Coroutine_get_qualname(__pyx_CoroutineObject *self, void *context)
{
    PyObject *name = self->gi_qualname;
    CYTHON_UNUSED_VAR(context);
    if (unlikely(!name)) name = Py_None;
    Py_INCREF(name);
    return name;
}
static int
__Pyx_Coroutine_set_qualname(__pyx_CoroutineObject *self, PyObject *value, void *context)
{
    CYTHON_UNUSED_VAR(context);
#if PY_MAJOR_VERSION >= 3
    if (unlikely(value == NULL || !PyUnicode_Check(value)))
#else
    if (unlikely(value == NULL || !PyString_Check(value)))
#endif
    {
        PyErr_SetString(PyExc_TypeError,
                        "__qualname__ must be set to a string object");
        return -1;
    }
    Py_INCREF(value);
    __Pyx_Py_XDECREF_SET(self->gi_qualname, value);
    return 0;
}
static PyObject *
__Pyx_Coroutine_get_frame(__pyx_CoroutineObject *self, void *context)
{
    PyObject *frame = self->gi_frame;
    CYTHON_UNUSED_VAR(context);
    if (!frame) {
        if (unlikely(!self->gi_code)) {
            Py_RETURN_NONE;
        }
        frame = (PyObject *) PyFrame_New(
            PyThreadState_Get(),            /*PyThreadState *tstate,*/
            (PyCodeObject*) self->gi_code,  /*PyCodeObject *code,*/
            __pyx_d,                 /*PyObject *globals,*/
            0                               /*PyObject *locals*/
        );
        if (unlikely(!frame))
            return NULL;
        self->gi_frame = frame;
    }
    Py_INCREF(frame);
    return frame;
}
static __pyx_CoroutineObject *__Pyx__Coroutine_New(
            PyTypeObject* type, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
            PyObject *name, PyObject *qualname, PyObject *module_name) {
    __pyx_CoroutineObject *gen = PyObject_GC_New(__pyx_CoroutineObject, type);
    if (unlikely(!gen))
        return NULL;
    return __Pyx__Coroutine_NewInit(gen, body, code, closure, name, qualname, module_name);
}
static __pyx_CoroutineObject *__Pyx__Coroutine_NewInit(
            __pyx_CoroutineObject *gen, __pyx_coroutine_body_t body, PyObject *code, PyObject *closure,
            PyObject *name, PyObject *qualname, PyObject *module_name) {
    gen->body = body;
    gen->closure = closure;
    Py_XINCREF(closure);
    gen->is_running = 0;
    gen->resume_label = 0;
    gen->classobj = NULL;
    gen->yieldfrom = NULL;
    #if PY_VERSION_HEX >= 0x030B00a4
    gen->gi_exc_state.exc_value = NULL;
    #else
    gen->gi_exc_state.exc_type = NULL;
    gen->gi_exc_state.exc_value = NULL;
    gen->gi_exc_state.exc_traceback = NULL;
    #endif
#if CYTHON_USE_EXC_INFO_STACK
    gen->gi_exc_state.previous_item = NULL;
#endif
    gen->gi_weakreflist = NULL;
    Py_XINCREF(qualname);
    gen->gi_qualname = qualname;
    Py_XINCREF(name);
    gen->gi_name = name;
    Py_XINCREF(module_name);
    gen->gi_modulename = module_name;
    Py_XINCREF(code);
    gen->gi_code = code;
    gen->gi_frame = NULL;
    PyObject_GC_Track(gen);
    return gen;
}

/* PatchGeneratorABC */
#ifndef CYTHON_REGISTER_ABCS
#define CYTHON_REGISTER_ABCS 1
#endif
#if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
static PyObject* __Pyx_patch_abc_module(PyObject *module);
static PyObject* __Pyx_patch_abc_module(PyObject *module) {
    module = __Pyx_Coroutine_patch_module(
        module, ""
"if _cython_generator_type is not None:\n"
"    try: Generator = _module.Generator\n"
"    except AttributeError: pass\n"
"    else: Generator.register(_cython_generator_type)\n"
"if _cython_coroutine_type is not None:\n"
"    try: Coroutine = _module.Coroutine\n"
"    except AttributeError: pass\n"
"    else: Coroutine.register(_cython_coroutine_type)\n"
    );
    return module;
}
#endif
static int __Pyx_patch_abc(void) {
#if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
    static int abc_patched = 0;
    if (CYTHON_REGISTER_ABCS && !abc_patched) {
        PyObject *module;
        module = PyImport_ImportModule((PY_MAJOR_VERSION >= 3) ? "collections.abc" : "collections");
        if (unlikely(!module)) {
            PyErr_WriteUnraisable(NULL);
            if (unlikely(PyErr_WarnEx(PyExc_RuntimeWarning,
                    ((PY_MAJOR_VERSION >= 3) ?
                        "Cython module failed to register with collections.abc module" :
                        "Cython module failed to register with collections module"), 1) < 0)) {
                return -1;
            }
        } else {
            module = __Pyx_patch_abc_module(module);
            abc_patched = 1;
            if (unlikely(!module))
                return -1;
            Py_DECREF(module);
        }
        module = PyImport_ImportModule("backports_abc");
        if (module) {
            module = __Pyx_patch_abc_module(module);
            Py_XDECREF(module);
        }
        if (!module) {
            PyErr_Clear();
        }
    }
#else
    if ((0)) __Pyx_Coroutine_patch_module(NULL, NULL);
#endif
    return 0;
}

/* Generator */
static PyMethodDef __pyx_Generator_methods[] = {
    {"send", (PyCFunction) __Pyx_Coroutine_Send, METH_O,
     (char*) PyDoc_STR("send(arg) -> send 'arg' into generator,\nreturn next yielded value or raise StopIteration.")},
    {"throw", (PyCFunction) __Pyx_Coroutine_Throw, METH_VARARGS,
     (char*) PyDoc_STR("throw(typ[,val[,tb]]) -> raise exception in generator,\nreturn next yielded value or raise StopIteration.")},
    {"close", (PyCFunction) __Pyx_Coroutine_Close_Method, METH_NOARGS,
     (char*) PyDoc_STR("close() -> raise GeneratorExit inside generator.")},
    {0, 0, 0, 0}
};
static PyMemberDef __pyx_Generator_memberlist[] = {
    {(char *) "gi_running", T_BOOL, offsetof(__pyx_CoroutineObject, is_running), READONLY, NULL},
    {(char*) "gi_yieldfrom", T_OBJECT, offsetof(__pyx_CoroutineObject, yieldfrom), READONLY,
     (char*) PyDoc_STR("object being iterated by 'yield from', or None")},
    {(char*) "gi_code", T_OBJECT, offsetof(__pyx_CoroutineObject, gi_code), READONLY, NULL},
    {(char *) "__module__", T_OBJECT, offsetof(__pyx_CoroutineObject, gi_modulename), 0, 0},
#if CYTHON_USE_TYPE_SPECS
    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(__pyx_CoroutineObject, gi_weakreflist), READONLY, 0},
#endif
    {0, 0, 0, 0, 0}
};
static PyGetSetDef __pyx_Generator_getsets[] = {
    {(char *) "__name__", (getter)__Pyx_Coroutine_get_name, (setter)__Pyx_Coroutine_set_name,
     (char*) PyDoc_STR("name of the generator"), 0},
    {(char *) "__qualname__", (getter)__Pyx_Coroutine_get_qualname, (setter)__Pyx_Coroutine_set_qualname,
     (char*) PyDoc_STR("qualified name of the generator"), 0},
    {(char *) "gi_frame", (getter)__Pyx_Coroutine_get_frame, NULL,
     (char*) PyDoc_STR("Frame of the generator"), 0},
    {0, 0, 0, 0, 0}
};
#if CYTHON_USE_TYPE_SPECS
static PyType_Slot __pyx_GeneratorType_slots[] = {
    {Py_tp_dealloc, (void *)__Pyx_Coroutine_dealloc},
    {Py_tp_traverse, (void *)__Pyx_Coroutine_traverse},
    {Py_tp_iter, (void *)PyObject_SelfIter},
    {Py_tp_iternext, (void *)__Pyx_Generator_Next},
    {Py_tp_methods, (void *)__pyx_Generator_methods},
    {Py_tp_members, (void *)__pyx_Generator_memberlist},
    {Py_tp_getset, (void *)__pyx_Generator_getsets},
    {Py_tp_getattro, (void *) __Pyx_PyObject_GenericGetAttrNoDict},
#if CYTHON_USE_TP_FINALIZE
    {Py_tp_finalize, (void *)__Pyx_Coroutine_del},
#endif
    {0, 0},
};
static PyType_Spec __pyx_GeneratorType_spec = {
    __PYX_TYPE_MODULE_PREFIX "generator",
    sizeof(__pyx_CoroutineObject),
    0,
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_HAVE_FINALIZE,
    __pyx_GeneratorType_slots
};
#else
static PyTypeObject __pyx_GeneratorType_type = {
    PyVarObject_HEAD_INIT(0, 0)
    __PYX_TYPE_MODULE_PREFIX "generator",
    sizeof(__pyx_CoroutineObject),
    0,
    (destructor) __Pyx_Coroutine_dealloc,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_HAVE_FINALIZE,
    0,
    (traverseproc) __Pyx_Coroutine_traverse,
    0,
    0,
    offsetof(__pyx_CoroutineObject, gi_weakreflist),
    0,
    (iternextfunc) __Pyx_Generator_Next,
    __pyx_Generator_methods,
    __pyx_Generator_memberlist,
    __pyx_Generator_getsets,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
    0,
#if CYTHON_USE_TP_FINALIZE
    0,
#else
    __Pyx_Coroutine_del,
#endif
    0,
#if CYTHON_USE_TP_FINALIZE
    __Pyx_Coroutine_del,
#elif PY_VERSION_HEX >= 0x030400a1
    0,
#endif
#if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
    0,
#endif
#if __PYX_NEED_TP_PRINT_SLOT
    0,
#endif
#if PY_VERSION_HEX >= 0x030C0000
    0,
#endif
#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
    0,
#endif
};
#endif
static int __pyx_Generator_init(PyObject *module) {
#if CYTHON_USE_TYPE_SPECS
    __pyx_GeneratorType = __Pyx_FetchCommonTypeFromSpec(module, &__pyx_GeneratorType_spec, NULL);
#else
    CYTHON_UNUSED_VAR(module);
    __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
    __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
    __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
#endif
    if (unlikely(!__pyx_GeneratorType)) {
        return -1;
    }
    return 0;
}

/* CheckBinaryVersion */
static unsigned long __Pyx_get_runtime_version(void) {
#if __PYX_LIMITED_VERSION_HEX >= 0x030B00A4
    return Py_Version & ~0xFFUL;
#else
    const char* rt_version = Py_GetVersion();
    unsigned long version = 0;
    unsigned long factor = 0x01000000UL;
    unsigned int digit = 0;
    int i = 0;
    while (factor) {
        while ('0' <= rt_version[i] && rt_version[i] <= '9') {
            digit = digit * 10 + (unsigned int) (rt_version[i] - '0');
            ++i;
        }
        version += factor * digit;
        if (rt_version[i] != '.')
            break;
        digit = 0;
        factor >>= 8;
        ++i;
    }
    return version;
#endif
}
static int __Pyx_check_binary_version(unsigned long ct_version, unsigned long rt_version, int allow_newer) {
    const unsigned long MAJOR_MINOR = 0xFFFF0000UL;
    if ((rt_version & MAJOR_MINOR) == (ct_version & MAJOR_MINOR))
        return 0;
    if (likely(allow_newer && (rt_version & MAJOR_MINOR) > (ct_version & MAJOR_MINOR)))
        return 1;
    {
        char message[200];
        PyOS_snprintf(message, sizeof(message),
                      "compile time Python version %d.%d "
                      "of module '%.100s' "
                      "%s "
                      "runtime version %d.%d",
                       (int) (ct_version >> 24), (int) ((ct_version >> 16) & 0xFF),
                       __Pyx_MODULE_NAME,
                       (allow_newer) ? "was newer than" : "does not match",
                       (int) (rt_version >> 24), (int) ((rt_version >> 16) & 0xFF)
       );
        return PyErr_WarnEx(NULL, message, 1);
    }
}

/* InitStrings */
#if PY_MAJOR_VERSION >= 3
static int __Pyx_InitString(__Pyx_StringTabEntry t, PyObject **str) {
    if (t.is_unicode | t.is_str) {
        if (t.intern) {
            *str = PyUnicode_InternFromString(t.s);
        } else if (t.encoding) {
            *str = PyUnicode_Decode(t.s, t.n - 1, t.encoding, NULL);
        } else {
            *str = PyUnicode_FromStringAndSize(t.s, t.n - 1);
        }
    } else {
        *str = PyBytes_FromStringAndSize(t.s, t.n - 1);
    }
    if (!*str)
        return -1;
    if (PyObject_Hash(*str) == -1)
        return -1;
    return 0;
}
#endif
static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
    while (t->p) {
        #if PY_MAJOR_VERSION >= 3
        __Pyx_InitString(*t, t->p);
        #else
        if (t->is_unicode) {
            *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
        } else if (t->intern) {
            *t->p = PyString_InternFromString(t->s);
        } else {
            *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
        }
        if (!*t->p)
            return -1;
        if (PyObject_Hash(*t->p) == -1)
            return -1;
        #endif
        ++t;
    }
    return 0;
}

#include <string.h>
static CYTHON_INLINE Py_ssize_t __Pyx_ssize_strlen(const char *s) {
    size_t len = strlen(s);
    if (unlikely(len > (size_t) PY_SSIZE_T_MAX)) {
        PyErr_SetString(PyExc_OverflowError, "byte string is too long");
        return -1;
    }
    return (Py_ssize_t) len;
}
static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
    Py_ssize_t len = __Pyx_ssize_strlen(c_str);
    if (unlikely(len < 0)) return NULL;
    return __Pyx_PyUnicode_FromStringAndSize(c_str, len);
}
static CYTHON_INLINE PyObject* __Pyx_PyByteArray_FromString(const char* c_str) {
    Py_ssize_t len = __Pyx_ssize_strlen(c_str);
    if (unlikely(len < 0)) return NULL;
    return PyByteArray_FromStringAndSize(c_str, len);
}
static CYTHON_INLINE const char* __Pyx_PyObject_AsString(PyObject* o) {
    Py_ssize_t ignore;
    return __Pyx_PyObject_AsStringAndSize(o, &ignore);
}
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
#if !CYTHON_PEP393_ENABLED
static const char* __Pyx_PyUnicode_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
    char* defenc_c;
    PyObject* defenc = _PyUnicode_AsDefaultEncodedString(o, NULL);
    if (!defenc) return NULL;
    defenc_c = PyBytes_AS_STRING(defenc);
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
    {
        char* end = defenc_c + PyBytes_GET_SIZE(defenc);
        char* c;
        for (c = defenc_c; c < end; c++) {
            if ((unsigned char) (*c) >= 128) {
                PyUnicode_AsASCIIString(o);
                return NULL;
            }
        }
    }
#endif
    *length = PyBytes_GET_SIZE(defenc);
    return defenc_c;
}
#else
static CYTHON_INLINE const char* __Pyx_PyUnicode_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
    if (unlikely(__Pyx_PyUnicode_READY(o) == -1)) return NULL;
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
    if (likely(PyUnicode_IS_ASCII(o))) {
        *length = PyUnicode_GET_LENGTH(o);
        return PyUnicode_AsUTF8(o);
    } else {
        PyUnicode_AsASCIIString(o);
        return NULL;
    }
#else
    return PyUnicode_AsUTF8AndSize(o, length);
#endif
}
#endif
#endif
static CYTHON_INLINE const char* __Pyx_PyObject_AsStringAndSize(PyObject* o, Py_ssize_t *length) {
#if __PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT
    if (
#if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
            __Pyx_sys_getdefaultencoding_not_ascii &&
#endif
            PyUnicode_Check(o)) {
        return __Pyx_PyUnicode_AsStringAndSize(o, length);
    } else
#endif
#if (!CYTHON_COMPILING_IN_PYPY && !CYTHON_COMPILING_IN_LIMITED_API) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
    if (PyByteArray_Check(o)) {
        *length = PyByteArray_GET_SIZE(o);
        return PyByteArray_AS_STRING(o);
    } else
#endif
    {
        char* result;
        int r = PyBytes_AsStringAndSize(o, &result, length);
        if (unlikely(r < 0)) {
            return NULL;
        } else {
            return result;
        }
    }
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject* x) {
   int is_true = x == Py_True;
   if (is_true | (x == Py_False) | (x == Py_None)) return is_true;
   else return PyObject_IsTrue(x);
}
static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject* x) {
    int retval;
    if (unlikely(!x)) return -1;
    retval = __Pyx_PyObject_IsTrue(x);
    Py_DECREF(x);
    return retval;
}
static PyObject* __Pyx_PyNumber_IntOrLongWrongResultType(PyObject* result, const char* type_name) {
    __Pyx_TypeName result_type_name = __Pyx_PyType_GetName(Py_TYPE(result));
#if PY_MAJOR_VERSION >= 3
    if (PyLong_Check(result)) {
        if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,
                "__int__ returned non-int (type " __Pyx_FMT_TYPENAME ").  "
                "The ability to return an instance of a strict subclass of int is deprecated, "
                "and may be removed in a future version of Python.",
                result_type_name)) {
            __Pyx_DECREF_TypeName(result_type_name);
            Py_DECREF(result);
            return NULL;
        }
        __Pyx_DECREF_TypeName(result_type_name);
        return result;
    }
#endif
    PyErr_Format(PyExc_TypeError,
                 "__%.4s__ returned non-%.4s (type " __Pyx_FMT_TYPENAME ")",
                 type_name, type_name, result_type_name);
    __Pyx_DECREF_TypeName(result_type_name);
    Py_DECREF(result);
    return NULL;
}
static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
#if CYTHON_USE_TYPE_SLOTS
  PyNumberMethods *m;
#endif
  const char *name = NULL;
  PyObject *res = NULL;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_Check(x) || PyLong_Check(x)))
#else
  if (likely(PyLong_Check(x)))
#endif
    return __Pyx_NewRef(x);
#if CYTHON_USE_TYPE_SLOTS
  m = Py_TYPE(x)->tp_as_number;
  #if PY_MAJOR_VERSION < 3
  if (m && m->nb_int) {
    name = "int";
    res = m->nb_int(x);
  }
  else if (m && m->nb_long) {
    name = "long";
    res = m->nb_long(x);
  }
  #else
  if (likely(m && m->nb_int)) {
    name = "int";
    res = m->nb_int(x);
  }
  #endif
#else
  if (!PyBytes_CheckExact(x) && !PyUnicode_CheckExact(x)) {
    res = PyNumber_Int(x);
  }
#endif
  if (likely(res)) {
#if PY_MAJOR_VERSION < 3
    if (unlikely(!PyInt_Check(res) && !PyLong_Check(res))) {
#else
    if (unlikely(!PyLong_CheckExact(res))) {
#endif
        return __Pyx_PyNumber_IntOrLongWrongResultType(res, name);
    }
  }
  else if (!PyErr_Occurred()) {
    PyErr_SetString(PyExc_TypeError,
                    "an integer is required");
  }
  return res;
}
static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject* b) {
  Py_ssize_t ival;
  PyObject *x;
#if PY_MAJOR_VERSION < 3
  if (likely(PyInt_CheckExact(b))) {
    if (sizeof(Py_ssize_t) >= sizeof(long))
        return PyInt_AS_LONG(b);
    else
        return PyInt_AsSsize_t(b);
  }
#endif
  if (likely(PyLong_CheckExact(b))) {
    #if CYTHON_USE_PYLONG_INTERNALS
    if (likely(__Pyx_PyLong_IsCompact(b))) {
        return __Pyx_PyLong_CompactValue(b);
    } else {
      const digit* digits = __Pyx_PyLong_Digits(b);
      const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(b);
      switch (size) {
         case 2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -2:
           if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -3:
           if (8 * sizeof(Py_ssize_t) > 3 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case 4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return (Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
         case -4:
           if (8 * sizeof(Py_ssize_t) > 4 * PyLong_SHIFT) {
             return -(Py_ssize_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
           }
           break;
      }
    }
    #endif
    return PyLong_AsSsize_t(b);
  }
  x = PyNumber_Index(b);
  if (!x) return -1;
  ival = PyInt_AsSsize_t(x);
  Py_DECREF(x);
  return ival;
}
static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
#if PY_MAJOR_VERSION < 3
  } else if (likely(PyInt_CheckExact(o))) {
    return PyInt_AS_LONG(o);
#endif
  } else {
    Py_ssize_t ival;
    PyObject *x;
    x = PyNumber_Index(o);
    if (!x) return -1;
    ival = PyInt_AsLong(x);
    Py_DECREF(x);
    return ival;
  }
}
static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
  return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
}
static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
    return PyInt_FromSize_t(ival);
}


/* #### Code section: utility_code_pragmas_end ### */
#ifdef _MSC_VER
#pragma warning( pop )
#endif



/* #### Code section: end ### */
#endif /* Py_PYTHON_H */
